const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as o,a as e,o as s,d as _e,r as L,b as u,t as g,n as me,e as F,f as G,u as we,w as se,g as Le,h as T,F as Z,i as X,j as de,k as qe,l as Y,v as ne,m as Q,p as ie,q as je,s as Se,x as re,y as ce,z as fe,A as Ue,B as Fe,C as Be,D as pe,E as be,G as Ve,H as ze}from"./vue-vendor-BChC3Sgv.js";import{m as he,p as Te}from"./markdown-vendor-CQ3OZdP9.js";import{c as Ge}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&i(v)}).observe(document,{childList:!0,subtree:!0});function l(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=l(r);fetch(r.href,a)}})();const Je={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},Ke={__name:"NoSessionSelected",setup(n){return(t,l)=>(s(),o("div",Je,[...l[0]||(l[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},Ye="modulepreload",Qe=function(n){return"/"+n},Ie={},ae=function(t,l,i){let r=Promise.resolve();if(l&&l.length>0){let d=function(f){return Promise.all(f.map(p=>Promise.resolve(p).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),_=v?.nonce||v?.getAttribute("nonce");r=d(l.map(f=>{if(f=Qe(f),f in Ie)return;Ie[f]=!0;const p=f.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${y}`))return;const w=document.createElement("link");if(w.rel=p?"stylesheet":Ye,p||(w.as="script"),w.crossOrigin="",w.href=f,_&&w.setAttribute("nonce",_),document.head.appendChild(w),p)return new Promise((S,E)=>{w.addEventListener("load",S),w.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(v){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=v,window.dispatchEvent(_),!_.defaultPrevented)throw v}return r.then(v=>{for(const _ of v||[])_.status==="rejected"&&a(_.reason);return t().catch(a)})};class Ce extends Error{constructor(t,l,i){super(t),this.name="APIError",this.status=l,this.data=i}}async function ye(n,t={}){try{const l=await fetch(n,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!l.ok){let r;try{r=await l.json()}catch{r={detail:l.statusText}}throw new Ce(r.detail||`HTTP ${l.status}: ${l.statusText}`,l.status,r)}const i=l.headers.get("content-type");return i&&i.includes("application/json")?await l.json():await l.text()}catch(l){throw l instanceof Ce?l:(console.error("API request failed:",l),new Ce(`Network error: ${l.message}`,0,null))}}async function Ze(n,t={}){let l=n;if(t.params){const i=new URLSearchParams;for(const[_,d]of Object.entries(t.params))d!=null&&i.append(_,d);const r=i.toString();r&&(l=`${n}?${r}`);const{params:a,...v}=t;return ye(l,{...v,method:"GET"})}return ye(l,{...t,method:"GET"})}async function Xe(n,t,l={}){return ye(n,{...l,method:"POST",body:JSON.stringify(t)})}async function et(n,t,l={}){return ye(n,{...l,method:"PUT",body:JSON.stringify(t)})}async function tt(n,t={}){return ye(n,{...t,method:"DELETE"})}const K={get:Ze,post:Xe,put:et,delete:tt},J=_e("session",()=>{const n=L(new Map),t=L(null),l=L(new Map),i=L(new Map),r=L(new Set),a=L(!1);let v=null;const _=u(()=>n.value.get(t.value)),d=u(()=>Array.from(n.value.values()).sort((C,P)=>C.order-P.order)),f=C=>u(()=>d.value.filter(P=>P.project_id===C)),p=u({get:()=>l.value.get(t.value)||"",set:C=>{t.value&&l.value.set(t.value,C)}});async function y(){try{const C=await K.get("/api/sessions");return n.value.clear(),C.sessions.forEach(P=>{n.value.set(P.session_id,P)}),console.log(`Loaded ${n.value.size} sessions`),C.sessions}catch(C){throw console.error("Failed to fetch sessions:",C),C}}async function w(C,P){try{const R=(await K.post("/api/sessions",{project_id:C,...P})).session_id,m=(await K.get(`/api/sessions/${R}`)).session;return n.value.set(R,m),n.value=new Map(n.value),console.log(`Created session ${R}`),m}catch(H){throw console.error("Failed to create session:",H),H}}async function S(C){if(t.value===C&&!a.value)return;v&&(console.log(`Aborting pending selection to switch to ${C}`),v.abort(),v=null);const P=new AbortController;v=P,a.value=!0;try{if(t.value=C,P.signal.aborted){console.log(`Selection of ${C} aborted early`);return}let H=n.value.get(C);if(!H)try{const m=await K.get(`/api/sessions/${C}`);if(P.signal.aborted){console.log(`Selection of ${C} aborted after fetch`);return}H=m.session,n.value.set(C,H),n.value=new Map(n.value),console.log(`Fetched session ${C} for deeplink`)}catch(m){console.error(`Failed to fetch session ${C}:`,m);return}if(H&&(H.state==="created"||H.state==="terminated"))try{if(await x(C),P.signal.aborted){console.log(`Selection of ${C} aborted after start`);return}console.log(`Auto-started session ${C} (was in ${H.state} state)`);const m=6e4,j=200,A=5e3;let N=0,M=0;for(;N<m;){if(P.signal.aborted){console.log(`Selection of ${C} aborted during state wait`);return}const W=n.value.get(C);if(W&&W.state==="active"){console.log(`Session ${C} is now active after ${N}ms`);break}if(N-M>=A){const V=n.value.get(C)?.state||"unknown";console.log(`Waiting for session ${C} to become active (current: ${V}, ${N/1e3}s elapsed)`),M=N}await new Promise(V=>setTimeout(V,j)),N+=j}const I=n.value.get(C);I&&I.state!=="active"&&console.warn(`Session ${C} did not become active within ${m/1e3}s (state: ${I.state}), continuing anyway`)}catch(m){console.error(`Failed to auto-start session ${C}:`,m)}if(P.signal.aborted){console.log(`Selection of ${C} aborted before message load`);return}if(await(await ae(()=>Promise.resolve().then(()=>$t),void 0)).useMessageStore().loadMessages(C),P.signal.aborted){console.log(`Selection of ${C} aborted after message load`);return}await(await ae(()=>Promise.resolve().then(()=>Ht),void 0)).useWebSocketStore().connectSession(C),P.signal.aborted||console.log(`Selected session ${C}`)}finally{v===P&&(v=null),a.value=!1}}function E(C,P){const H=n.value.get(C);H&&(Object.assign(H,P),n.value=new Map(n.value))}async function k(C){r.value.add(C);try{await K.delete(`/api/sessions/${C}`),n.value.delete(C),l.value.delete(C),i.value.delete(C),n.value=new Map(n.value),t.value===C&&(t.value=null),console.log(`Deleted session ${C}`)}catch(P){throw console.error("Failed to delete session:",P),P}finally{r.value.delete(C)}}async function $(C,P){try{await K.put(`/api/sessions/${C}/name`,{name:P}),E(C,{name:P}),console.log(`Updated session ${C} name to "${P}"`)}catch(H){throw console.error("Failed to update session name:",H),H}}async function h(C,P){try{await K.post(`/api/sessions/${C}/permission-mode`,{mode:P}),E(C,{current_permission_mode:P});const H=i.value.get(C);H&&(H.permissionMode=P,i.value.set(C,H)),console.log(`Set permission mode for session ${C} to ${P}`)}catch(H){throw console.error("Failed to set permission mode:",H),H}}async function x(C){try{await K.post(`/api/sessions/${C}/start`),console.log(`Started session ${C}`)}catch(P){throw console.error("Failed to start session:",P),P}}async function b(C){try{await K.post(`/api/sessions/${C}/pause`),console.log(`Paused session ${C}`)}catch(P){throw console.error("Failed to pause session:",P),P}}async function c(C){try{await K.post(`/api/sessions/${C}/terminate`),console.log(`Terminated session ${C}`)}catch(P){throw console.error("Failed to terminate session:",P),P}}function O(C){return n.value.get(C)}function q(C,P){i.value.set(C,P),P.permissionMode&&E(C,{current_permission_mode:P.permissionMode})}return{sessions:n,currentSessionId:t,inputCache:l,initData:i,deletingSessions:r,currentSession:_,orderedSessions:d,sessionsInProject:f,currentInput:p,fetchSessions:y,createSession:w,selectSession:S,updateSession:E,deleteSession:k,updateSessionName:$,setPermissionMode:h,startSession:x,pauseSession:b,terminateSession:c,getSession:O,storeInitData:q}}),De=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:J},Symbol.toStringTag,{value:"Module"})),te=_e("ui",()=>{const n=L(window.innerWidth<768),t=L(300),l=L(window.innerWidth),i=u(()=>l.value<768),r=L(!0),a=L(null),v=L(null),_=u(()=>a.value?{name:a.value,data:v.value}:null),d=L(!1),f=L("Loading...");function p(){n.value=!n.value}function y(b){n.value=b}function w(b){t.value=Math.max(200,Math.min(b,window.innerWidth*.3))}function S(b){r.value=b}function E(b,c=null){a.value=null,v.value=null,setTimeout(()=>{a.value=b,v.value=c},0)}function k(){a.value=null,v.value=null}function $(b="Loading..."){d.value=!0,f.value=b}function h(){d.value=!1}function x(){const b=l.value;l.value=window.innerWidth,l.value<768&&b>=768?n.value=!0:l.value>=768&&b<768&&(n.value=!1)}return{sidebarCollapsed:n,sidebarWidth:t,isMobile:i,autoScrollEnabled:r,activeModal:a,modalData:v,currentModal:_,isLoading:d,loadingMessage:f,toggleSidebar:p,setSidebarCollapsed:y,setSidebarWidth:w,setAutoScroll:S,showModal:E,hideModal:k,showLoading:$,hideLoading:h,handleResize:x}}),le=_e("project",()=>{const n=L(new Map),t=L(null),l=u(()=>n.value.get(t.value)),i=u(()=>Array.from(n.value.values()).sort((k,$)=>k.order-$.order)),r=k=>n.value.get(k)?.is_multi_agent||!1;async function a(){try{const k=await K.get("/api/projects");return n.value.clear(),k.projects.forEach($=>{n.value.set($.project_id,$)}),console.log(`Loaded ${n.value.size} projects`),k.projects}catch(k){throw console.error("Failed to fetch projects:",k),k}}async function v(k,$,h=!1){try{const b=(await K.post("/api/projects",{name:k,working_directory:$,is_multi_agent:h})).project;return n.value.set(b.project_id,b),n.value=new Map(n.value),console.log(`Created project ${b.project_id}`),b}catch(x){throw console.error("Failed to create project:",x),x}}async function _(k,$){try{await K.put(`/api/projects/${k}`,$),d(k,$),console.log(`Updated project ${k}`,$)}catch(h){throw console.error("Failed to update project:",h),h}}function d(k,$){const h=n.value.get(k);h&&(Object.assign(h,$),n.value=new Map(n.value))}async function f(k){try{await K.delete(`/api/projects/${k}`),n.value.delete(k),n.value=new Map(n.value),t.value===k&&(t.value=null),console.log(`Deleted project ${k}`)}catch($){throw console.error("Failed to delete project:",$),$}}async function p(k){try{const $=await K.put(`/api/projects/${k}/toggle-expansion`),h=n.value.get(k);return h&&(h.is_expanded=$.is_expanded,n.value=new Map(n.value)),$.is_expanded}catch($){throw console.error("Failed to toggle expansion:",$),$}}async function y(k){try{await K.put("/api/projects/reorder",{project_ids:k}),k.forEach(($,h)=>{const x=n.value.get($);x&&(x.order=h)}),n.value=new Map(n.value),console.log("Reordered projects",k)}catch($){throw console.error("Failed to reorder projects:",$),$}}async function w(k,$){try{await K.put(`/api/projects/${k}/sessions/reorder`,{session_ids:$});const h=n.value.get(k);h&&(h.session_ids=$,n.value=new Map(n.value)),console.log(`Reordered sessions in project ${k}`,$)}catch(h){throw console.error("Failed to reorder sessions:",h),h}}function S(k){return n.value.get(k)}function E(k){if(!k)return"";const $=k.split(/[/\\]/).filter(h=>h);return $.length===0?"/":$.length===1?`/${$[0]}`:$.length===2?`/${$.join("/")}`:`.../${$.slice(-2).join("/")}`}return{projects:n,currentProjectId:t,currentProject:l,orderedProjects:i,isMultiAgent:r,fetchProjects:a,createProject:v,updateProject:_,updateProjectLocal:d,deleteProject:f,toggleExpansion:p,reorderProjects:y,reorderSessionsInProject:w,getProject:S,formatPath:E}}),B=(n,t)=>{const l=n.__vccOpts||n;for(const[i,r]of t)l[i]=r;return l},st={class:"session-header border-bottom p-3"},ot={class:"project-name"},nt=["title"],lt={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=le(),r=u(()=>l.sessions.get(t.sessionId)),a=u(()=>r.value?.name||t.sessionId),v=u(()=>{for(const d of i.projects.values())if(d.session_ids?.includes(t.sessionId))return d;return null}),_=u(()=>v.value?.name||"Unknown Project");return(d,f)=>(s(),o("div",st,[e("div",null,[e("div",ot,g(_.value),1),e("div",{class:"session-name",title:n.sessionId},g(a.value),9,nt)])]))}},at=B(lt,[["__scopeId","data-v-89e9c269"]]),rt={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},it=["title"],ct={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},dt={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=u(()=>l.sessions.get(t.sessionId)),r=u(()=>i.value?i.value.state==="paused"&&i.value.is_processing?"pending-prompt":i.value.is_processing?"processing":i.value.state:"unknown"),a=u(()=>{const d=r.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[d]||"#d3d3d3"}),v=u(()=>{const d=r.value;return d==="starting"||d==="processing"||d==="pending-prompt"}),_=u(()=>{if(!i.value)return"No session selected";const d=r.value,f=d.charAt(0).toUpperCase()+d.slice(1).replace("-"," "),p=i.value.name||"Unnamed Session",y=i.value.is_minion&&i.value.role?` (${i.value.role})`:"";return`${p}${y}: ${f}`});return(d,f)=>(s(),o("div",rt,[i.value?(s(),o("div",{key:0,class:F(["progress-bar",{"progress-bar-striped progress-bar-animated":v.value}]),style:me({width:"100%",backgroundColor:a.value}),title:_.value},null,14,it)):(s(),o("div",ct))]))}},ut=B(dt,[["__scopeId","data-v-e8795bb7"]]),mt={class:"session-status-bar border-top p-2 bg-light"},pt={class:"d-flex justify-content-between align-items-center gap-2"},vt={class:"d-flex gap-2"},ft=["disabled"],gt={class:"mode-label"},_t=["disabled"],bt=["disabled"],ht={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=te(),r=u(()=>l.sessions.get(t.sessionId)),a=u(()=>r.value?.current_permission_mode||"default"),v={default:"🔒",acceptEdits:"✏️",plan:"📋",bypassPermissions:"☢️"},_=u(()=>v[a.value]||"🔒"),d=u(()=>a.value),f=["default","acceptEdits","plan"],p=async()=>{if(!r.value)return;if(a.value==="bypassPermissions"){try{await l.setPermissionMode(t.sessionId,"default")}catch(h){console.error("Failed to cycle permission mode:",h)}return}const k=(f.indexOf(a.value)+1)%f.length,$=f[k];try{await l.setPermissionMode(t.sessionId,$)}catch(h){console.error("Failed to cycle permission mode:",h)}},y=()=>{i.showModal("session-info",{sessionId:t.sessionId})},w=()=>{i.showModal("manage-session",{session:r.value})},S=()=>{i.setAutoScroll(!i.autoScrollEnabled)};return(E,k)=>(s(),o("div",mt,[e("div",pt,[e("div",vt,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:p,disabled:!r.value},[G(g(_.value)+" ",1),e("span",gt,g(d.value),1)],8,ft),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:y,disabled:!r.value},[...k[0]||(k[0]=[G(" ℹ️ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,_t),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:w,disabled:!r.value},[...k[1]||(k[1]=[G(" ⚙️ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,bt)]),e("div",null,[e("button",{class:F(["btn btn-sm",we(i).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:S}," ⬇️ "+g(we(i).autoScrollEnabled?"ON":"OFF"),3)])])]))}},yt=B(ht,[["__scopeId","data-v-fdcd3535"]]),ue=_e("message",()=>{const n=L(new Map),t=L(new Map),l=L(new Map),i=L(new Map),r=L(new Map),a=L(new Map),v=L(new Map),_=u(()=>{const m=J();return n.value.get(m.currentSessionId)||[]}),d=u(()=>{const m=J();return t.value.get(m.currentSessionId)||[]});async function f(m,j=null,A=0){try{const N=j||1e4,M=await K.get(`/api/sessions/${m}/messages?limit=${N}&offset=${A}`),I=M.messages||[],W=M.total_count||I.length,V=M.has_more||!1;if(console.log(`Loaded ${I.length} of ${W} messages for session ${m}`),n.value.set(m,I),I.length>0){const U=I[I.length-1];U.timestamp&&(v.value.set(m,U.timestamp),console.log(`Tracked last received timestamp for session ${m}: ${U.timestamp}`))}const z=new Set;I.forEach(U=>{U.type==="assistant"&&U.metadata?.tool_uses&&U.metadata.tool_uses.forEach(ee=>{z.add(ee.id)}),U.type==="user"&&U.metadata?.tool_results&&U.metadata.tool_results.forEach(ee=>{z.delete(ee.tool_use_id);const $e=a.value.get(m);$e&&$e.delete(ee.tool_use_id)}),U.type==="system"&&U.metadata?.subtype==="client_launched"&&(z.forEach(ee=>{c(m,ee,"Session was restarted")}),z.clear()),U.type==="system"&&U.metadata?.subtype==="interrupt"&&(z.forEach(ee=>{c(m,ee,"Session was interrupted")}),z.clear()),U.metadata?.has_tool_uses&&U.metadata.tool_uses&&U.metadata.tool_uses.forEach(ee=>{E(m,ee)}),U.metadata?.has_tool_results&&U.metadata.tool_results&&U.metadata.tool_results.forEach(ee=>{h(m,ee)}),(U.type==="permission_request"||U.metadata?.has_permission_requests)&&k(m,U),U.type==="system"&&(U.subtype==="init"||U.metadata?.subtype==="init")&&U.metadata?.init_data&&J().storeInitData(m,U.metadata.init_data)});const ve=J().sessions.get(m);return ve&&!["active","paused","starting"].includes(ve.state)&&(z.forEach(U=>{c(m,U,"Session was terminated")}),z.clear()),r.value.set(m,z),n.value=new Map(n.value),V&&console.warn(`Warning: Only loaded ${I.length} of ${W} messages. Some messages may be missing.`),{messages:I,totalCount:W,hasMore:V}}catch(N){throw console.error("Failed to load messages:",N),N}}function p(m,j){const A=r.value.get(m)||new Set;j.type==="assistant"&&j.metadata?.tool_uses&&j.metadata.tool_uses.forEach(N=>{A.add(N.id)}),j.type==="user"&&j.metadata?.tool_results&&j.metadata.tool_results.forEach(N=>{A.delete(N.tool_use_id);const M=a.value.get(m);M&&M.delete(N.tool_use_id)}),j.type==="system"&&j.metadata?.subtype==="client_launched"&&(A.forEach(N=>{c(m,N,"Session was restarted")}),A.clear()),j.type==="system"&&j.metadata?.subtype==="interrupt"&&(A.forEach(N=>{c(m,N,"Session was interrupted")}),A.clear()),r.value.set(m,A)}function y(m,j){n.value.has(m)||n.value.set(m,[]),n.value.get(m).push(j),j.timestamp&&v.value.set(m,j.timestamp),p(m,j),n.value=new Map(n.value)}function w(m,j){t.value.has(m)||t.value.set(m,[]),t.value.get(m).push(j),t.value=new Map(t.value)}function S(m,j,A){const N=t.value.get(m);if(N){const M=N.find(I=>I.id===j);M&&(Object.assign(M,A),t.value=new Map(t.value))}}function E(m,j){const A=b(j.name,j.input);l.value.set(A,j.id);const N={id:j.id,name:j.name,input:j.input,signature:A,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return w(m,N),console.log(`Created tool call ${N.id} for ${N.name}`),N}function k(m,j){console.log("handlePermissionRequest received:",j);const A=j.metadata?.tool_name||j.tool_name,N=j.metadata?.input_params||j.input_params,M=j.metadata?.request_id||j.request_id,I=j.metadata?.suggestions||j.suggestions||[];console.log("Extracted data:",{toolName:A,inputParams:N,requestId:M,suggestions:I});const W=b(A,N),V=l.value.get(W);V?(i.value.set(M,V),S(m,V,{status:"permission_required",permissionRequestId:M,suggestions:I}),console.log(`Permission required for tool ${V}`,{suggestions:I})):console.warn("No tool use ID found for permission request signature:",W,{toolName:A,inputParams:N,availableSignatures:Array.from(l.value.keys())})}function $(m,j){const A=i.value.get(j.request_id);if(A){const N={permissionDecision:j.decision,appliedUpdates:j.applied_updates||[]};j.decision==="allow"?N.status="executing":(N.status="completed",N.result={error:!0,message:j.reasoning||"Permission denied"},N.isExpanded=!1),S(m,A,N),console.log(`Permission ${j.decision} for tool ${A}`)}}function h(m,j){const A=j.tool_use_id;S(m,A,{status:j.is_error?"error":"completed",result:{error:j.is_error,content:j.content},isExpanded:!1}),console.log(`Tool ${A} ${j.is_error?"failed":"completed"}`)}function x(m,j){const A=t.value.get(m);if(A){const N=A.find(M=>M.id===j);N&&(N.isExpanded=!N.isExpanded,t.value=new Map(t.value))}}function b(m,j){if(!m)return"unknown:{}";if(!j||typeof j!="object")return`${m}:{}`;const A=JSON.stringify(j,Object.keys(j).sort());return`${m}:${A}`}function c(m,j,A){const N=a.value.get(m)||new Map;N.set(j,{reason:"denied",message:A}),a.value.set(m,N);const M=t.value.get(m);if(M){const I=M.find(W=>W.id===j);I&&I.isExpanded&&(I.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${j} as orphaned: ${A}`)}function O(m,j){return a.value.get(m)?.has(j)||!1}function q(m,j){return a.value.get(m)?.get(j)}function C(m,j){const A=r.value.get(m);A&&A.size>0&&(A.forEach(N=>c(m,N,j)),A.clear())}function P(m){n.value.delete(m),t.value.delete(m),n.value=new Map(n.value),t.value=new Map(t.value)}function H(m){return v.value.get(m)}async function R(m){const j=v.value.get(m);if(!j)return console.log(`No sync needed for session ${m} (no previous messages)`),{syncedCount:0,hasMore:!1};try{console.log(`Syncing messages for session ${m} since ${j}`);const A=await K.get(`/api/sessions/${m}/messages?limit=1000&offset=0`),N=A.messages||[],M=A.has_more||!1,I=new Date(j).getTime(),W=N.filter(U=>U.timestamp?new Date(U.timestamp).getTime()>I:!1);if(W.length===0)return console.log(`No missed messages for session ${m}`),{syncedCount:0,hasMore:!1};console.log(`Synced ${W.length} missed messages for session ${m}`);const V=n.value.get(m)||[],z=new Set(V.map(U=>U.id).filter(Boolean)),oe=W.filter(U=>!U.id||!z.has(U.id));console.log(`After deduplication: ${oe.length} unique new messages`);const ve=[...V,...oe].sort((U,ee)=>{const $e=new Date(U.timestamp||0).getTime(),He=new Date(ee.timestamp||0).getTime();return $e-He});if(n.value.set(m,ve),oe.forEach(U=>{p(m,U),U.metadata?.has_tool_uses&&U.metadata.tool_uses&&U.metadata.tool_uses.forEach(ee=>{E(m,ee)}),U.metadata?.has_tool_results&&U.metadata.tool_results&&U.metadata.tool_results.forEach(ee=>{h(m,ee)}),(U.type==="permission_request"||U.metadata?.has_permission_requests)&&k(m,U),U.type==="system"&&(U.subtype==="init"||U.metadata?.subtype==="init")&&U.metadata?.init_data&&J().storeInitData(m,U.metadata.init_data)}),ve.length>0){const U=ve[ve.length-1];U.timestamp&&v.value.set(m,U.timestamp)}return n.value=new Map(n.value),{syncedCount:oe.length,hasMore:M}}catch(A){return console.error(`Failed to sync messages for session ${m}:`,A),{syncedCount:0,hasMore:!1,error:A.message}}}const D=J();return se(()=>Array.from(D.sessions.values()).map(j=>({id:j.session_id,state:j.state})),(m,j)=>{j&&m.forEach((A,N)=>{const M=j[N];if(!M||M.id!==A.id)return;const I=["active","paused","starting"].includes(M.state),W=!["active","paused","starting"].includes(A.state);I&&W&&C(A.id,"Session was terminated")})},{deep:!0}),{messagesBySession:n,toolCallsBySession:t,activeToolUses:Le(r),orphanedToolUses:Le(a),currentMessages:_,currentToolCalls:d,loadMessages:f,addMessage:y,addToolCall:w,updateToolCall:S,handleToolUse:E,handlePermissionRequest:k,handlePermissionResponse:$,handleToolResult:h,toggleToolExpansion:x,clearMessages:P,markToolUseOrphaned:c,isToolUseOrphaned:O,getOrphanedInfo:q,clearOrphanedToolUses:C,getLastReceivedTimestamp:H,syncMessages:R}}),$t=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:ue},Symbol.toStringTag,{value:"Module"}));function wt(n){if(!n)return new Date;if(typeof n=="string"){const t=new Date(n);return isNaN(t.getTime())?new Date:t}return typeof n=="number"?n<1e10?new Date(n*1e3):new Date(n):new Date}function ke(n){return wt(n).toLocaleTimeString()}const St={class:"card user-message bg-light border-start border-primary border-3"},kt={class:"card-body"},Ct={class:"d-flex justify-content-between align-items-center mb-2"},xt={class:"text-muted"},Mt=["innerHTML"],jt={key:0,class:"tool-results mt-3"},Tt={class:"tool-results-header text-muted small mb-2"},Et={class:"d-flex align-items-start gap-2"},Pt={class:"flex-grow-1"},Lt={class:"text-muted"},It={key:0,class:"text-danger small"},Dt={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n;he.setOptions({breaks:!0,gfm:!0});const l=u(()=>ke(t.message.timestamp)),i=u(()=>{const _=t.message.content||"",d=he.parse(_);return Te.sanitize(d)}),r=u(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),a=u(()=>t.message.metadata?.tool_results||[]);function v(_,d){return _?_.length<=d?_:_.substring(0,d)+"...":""}return(_,d)=>(s(),o("div",St,[e("div",kt,[e("div",Ct,[d[0]||(d[0]=e("div",{class:"d-flex align-items-center gap-2"},[e("span",{class:"message-icon"},"👤"),e("strong",{class:"message-role"},"User")],-1)),e("small",xt,g(l.value),1)]),e("div",{class:"message-content",innerHTML:i.value},null,8,Mt),r.value?(s(),o("div",jt,[e("div",Tt,[d[1]||(d[1]=e("i",{class:"bi bi-tools"},null,-1)),G(" Tool Results ("+g(a.value.length)+") ",1)]),(s(!0),o(Z,null,X(a.value,(f,p)=>(s(),o("div",{key:p,class:F(["tool-result-summary p-2 mb-2 rounded",f.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",Et,[e("span",null,g(f.is_error?"❌":"✅"),1),e("div",Pt,[e("small",Lt,"Tool: "+g(f.tool_use_id),1),f.is_error?(s(),o("div",It,g(v(f.content,200)),1)):T("",!0)])])],2))),128))])):T("",!0)])]))}},Ot=B(Dt,[["__scopeId","data-v-532549d1"]]),Nt={class:"thinking-block"},At={class:"text-muted ms-auto"},Rt={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},qt=["innerHTML"],Ut={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(n){const t=n,l=L(!1),i=u(()=>t.thinking?.length||0),r=u(()=>{const v=t.thinking||"",_=he.parse(v);return Te.sanitize(_)});function a(){l.value=!l.value}return(v,_)=>(s(),o("div",Nt,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:a},[e("i",{class:F(["bi",l.value?"bi-chevron-down":"bi-chevron-right"])},null,2),_[0]||(_[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),G(" Thinking ")],-1)),e("small",At,g(i.value)+" characters",1)]),l.value?(s(),o("div",Rt,[e("div",{class:"thinking-text",innerHTML:r.value},null,8,qt)])):T("",!0)]))}},Wt=B(Ut,[["__scopeId","data-v-619a8344"]]),ge=_e("websocket",()=>{const n=L(null),t=L(!1),l=L(0),i=10,r=L(null),a=L(!1),v=L(0),_=5,d=L(null);let f=null;const p=L(0),y=L(null),w=L(new Map),S=L(null),E=L(!1),k=L(0),$=5,h=L(null),x=u(()=>t.value&&(a.value||!d.value)?"connected":t.value?"partial":"disconnected");function b(M){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${M}`}function c(){if(n.value)return;const M=b("/ws/ui");console.log(`Connecting to UI WebSocket: ${M}`),n.value=new WebSocket(M),n.value.onopen=()=>{t.value=!0,l.value=0,console.log("UI WebSocket connected")},n.value.onmessage=I=>{const W=JSON.parse(I.data);D(W)},n.value.onclose=()=>{if(t.value=!1,n.value=null,console.log("UI WebSocket closed"),l.value<i){l.value++;const I=Math.min(2e3*l.value,3e4);console.log(`Reconnecting UI WebSocket in ${I}ms (attempt ${l.value})`),setTimeout(c,I)}},n.value.onerror=I=>{console.error("UI WebSocket error:",I)}}function O(){n.value&&(n.value.close(),n.value=null,t.value=!1)}async function q(M){p.value++;const I=p.value;if(console.log(`[Gen ${I}] Starting connection to session ${M}`),f&&(clearTimeout(f),f=null),await C(),p.value!==I){console.log(`[Gen ${I}] Connection cancelled (current generation: ${p.value})`);return}d.value=M,y.value=I;const W=b(`/ws/session/${M}`);console.log(`[Gen ${I}] Connecting to Session WebSocket: ${W}`),r.value=new WebSocket(W),r.value.onopen=async()=>{if(y.value!==I){console.log(`[Gen ${I}] Ignoring onopen (stale connection, current: ${y.value})`),r.value.close();return}a.value=!0,v.value=0,console.log(`[Gen ${I}] Session WebSocket connected for ${M}`);const V=w.value.get(M);if(w.value.set(M,!0),V){console.log(`[Gen ${I}] Reconnection detected, syncing missed messages...`);try{const oe=await ue().syncMessages(M);oe.syncedCount>0?console.log(`[Gen ${I}] ✅ Synced ${oe.syncedCount} missed messages`):oe.error?console.warn(`[Gen ${I}] ⚠️ Message sync failed: ${oe.error}`):console.log(`[Gen ${I}] No missed messages to sync`),oe.hasMore&&console.warn(`[Gen ${I}] ⚠️ More than 1000 missed messages, showing recent 1000 only`)}catch(z){console.error(`[Gen ${I}] Error during message sync:`,z)}}else console.log(`[Gen ${I}] Initial connection, no sync needed`)},r.value.onmessage=V=>{if(y.value!==I){console.log(`[Gen ${I}] Ignoring message (stale connection, current: ${y.value})`);return}const z=JSON.parse(V.data);m(z,M)},r.value.onclose=()=>{a.value=!1,r.value=null,console.log(`[Gen ${I}] Session WebSocket closed for ${M}`);const V=J();if(V.currentSessionId===M&&y.value===I&&v.value<_){v.value++;const z=Math.min(2e3*v.value,3e4);console.log(`[Gen ${I}] Reconnecting Session WebSocket in ${z}ms (attempt ${v.value})`),f=setTimeout(()=>{y.value===I&&V.currentSessionId===M?(f=null,q(M)):console.log(`[Gen ${I}] Skipping reconnect (generation or session changed)`)},z)}},r.value.onerror=V=>{console.error(`[Gen ${I}] Session WebSocket error:`,V)}}function C(){return new Promise(M=>{if(f&&(clearTimeout(f),f=null,console.log("Cancelled pending session reconnect timer")),r.value){const I=()=>{r.value=null,a.value=!1,d.value=null,y.value=null,v.value=0,w.value.delete(sessionId),M()};if(r.value.readyState===WebSocket.CLOSED)I();else{const W=setTimeout(()=>{console.warn("Session WebSocket close timeout - forcing cleanup"),I()},2e3);r.value.addEventListener("close",()=>{clearTimeout(W),I()},{once:!0}),r.value.close()}}else d.value=null,y.value=null,M()})}function P(M){r.value&&a.value?(r.value.send(JSON.stringify({type:"send_message",content:M})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function H(M,I,W=!1,V=null){if(r.value&&a.value){const z={type:"permission_response",request_id:M,decision:I,apply_suggestions:W,timestamp:new Date().toISOString()};V&&(z.clarification_message=V),r.value.send(JSON.stringify(z)),console.log(`Sent permission ${I} for request ${M}`,{applySuggestions:W,clarification:V})}}function R(){r.value&&a.value&&(r.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function D(M){const I=J(),W=le();switch(M.type){case"sessions_list":M.sessions&&Array.isArray(M.sessions)&&M.sessions.forEach(V=>{I.updateSession(V.session_id,V)});break;case"state_change":M.data&&M.data.session_id&&M.data.session&&I.updateSession(M.data.session_id,M.data.session);break;case"project_updated":if(M.data&&M.data.project){const V=M.data.project;W.updateProjectLocal(V.project_id,V)}break;case"project_deleted":M.data&&M.data.project_id&&W.projects.delete(M.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":n.value?.readyState===WebSocket.OPEN&&n.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",M.type)}}function m(M,I){const W=J();if(W.currentSessionId!==I){console.warn(`Ignoring message for session ${I} (current: ${W.currentSessionId})`);return}const V=ue();switch(M.type){case"message":const z=M.data;if(!z||!z.type){console.warn("Received message event with invalid data:",M);break}if(z.type==="permission_request"){V.handlePermissionRequest(I,z);break}if(z.type==="permission_response"){V.handlePermissionResponse(I,z);break}z.metadata?.has_tool_uses&&z.metadata.tool_uses.forEach(oe=>{V.handleToolUse(I,oe)}),z.metadata?.has_tool_results&&z.metadata.tool_results.forEach(oe=>{V.handleToolResult(I,oe)}),z.type==="system"&&(z.subtype==="init"||z.metadata?.subtype==="init")&&z.metadata?.init_data&&W.storeInitData(I,z.metadata.init_data),V.addMessage(I,z);break;case"permission_request":V.handlePermissionRequest(I,M);break;case"permission_response":V.handlePermissionResponse(I,M);break;case"tool_result":V.handleToolResult(I,M);break;case"state_change":W.updateSession(I,M.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${I}`);break;case"ping":r.value?.readyState===WebSocket.OPEN&&r.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function j(M){A(),h.value=M;const I=b(`/ws/legion/${M}`);console.log(`Connecting to Legion WebSocket: ${I}`),S.value=new WebSocket(I),S.value.onopen=()=>{E.value=!0,k.value=0,console.log(`Legion WebSocket connected for ${M}`)},S.value.onmessage=W=>{const V=JSON.parse(W.data);N(V,M)},S.value.onclose=()=>{if(E.value=!1,S.value=null,console.log(`Legion WebSocket closed for ${M}`),h.value===M&&k.value<$){k.value++;const W=Math.min(2e3*k.value,3e4);setTimeout(()=>j(M),W)}},S.value.onerror=W=>{console.error("Legion WebSocket error:",W)}}function A(){S.value&&(S.value.close(),S.value=null,E.value=!1,h.value=null)}function N(M,I){ae(async()=>{const{useLegionStore:W}=await Promise.resolve().then(()=>pr);return{useLegionStore:W}},void 0).then(({useLegionStore:W})=>{const V=W();switch(M.type){case"comm":M.comm&&(V.addComm(I,M.comm),console.log("Legion WebSocket: Received new comm",M.comm));break;case"minion_created":M.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",M.data),ae(async()=>{const{useSessionStore:z}=await Promise.resolve().then(()=>De);return{useSessionStore:z}},void 0).then(({useSessionStore:z})=>{z().loadSessions()}));break;case"minion_updated":M.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",M.data),ae(async()=>{const{useSessionStore:z}=await Promise.resolve().then(()=>De);return{useSessionStore:z}},void 0).then(({useSessionStore:z})=>{z().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${I}`);break;case"ping":S.value?.readyState===WebSocket.OPEN&&S.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",M.type)}})}return{uiConnected:t,sessionConnected:a,legionConnected:E,overallStatus:x,connectUI:c,disconnectUI:O,connectSession:q,disconnectSession:C,sendMessage:P,sendPermissionResponse:H,interruptSession:R,connectLegion:j,disconnectLegion:A}}),Ht=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:ge},Symbol.toStringTag,{value:"Module"})),Ft={class:"base-tool-handler"},Bt={class:"tool-section mb-3"},Vt={class:"tool-parameters"},zt={class:"tool-code"},Gt={key:0,class:"tool-section"},Jt={class:"tool-section-label"},Kt={class:"tool-code"},Yt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),i=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),r=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),a=u(()=>{if(!i.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)});return(v,_)=>(s(),o("div",Ft,[e("div",Bt,[_[0]||(_[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Vt,[e("pre",zt,g(l.value),1)])]),i.value?(s(),o("div",Gt,[e("div",Jt,g(r.value?"Error:":"Result:"),1),e("div",{class:F(["tool-result",{"tool-result-error":r.value}])},[e("pre",Kt,g(a.value),1)],2)])):T("",!0)]))}},Qt=B(Yt,[["__scopeId","data-v-06a1b6c0"]]),Zt={class:"read-tool-handler"},Xt={class:"tool-section mb-3"},es={class:"read-file-info"},ts={class:"file-path"},ss={key:0,class:"read-range"},os={key:0,class:"tool-section"},ns={key:0,class:"tool-result tool-result-error"},ls={class:"tool-code"},as={key:1,class:"file-content-preview"},rs={class:"content-header"},is={class:"line-count-badge"},cs={key:0,class:"preview-note"},ds={class:"tool-code content-display"},us={key:0,class:"more-indicator"},xe=100,ms={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.file_path||"Unknown"),i=u(()=>{const S=t.toolCall.input?.offset,E=t.toolCall.input?.limit;return S!==void 0||E!==void 0}),r=u(()=>{const S=t.toolCall.input?.offset;return S!==void 0?S+1:1}),a=u(()=>{const S=t.toolCall.input?.offset||0,E=t.toolCall.input?.limit;return E!==void 0?S+E:"∞"}),v=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),_=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),d=u(()=>{if(!v.value)return"";const S=t.toolCall.result;return S.content!==void 0?typeof S.content=="string"?S.content:JSON.stringify(S.content,null,2):S.message?S.message:JSON.stringify(S,null,2)}),f=u(()=>_.value||!d.value?[]:d.value.split(`
`)),p=u(()=>f.value.length),y=u(()=>p.value>xe),w=u(()=>_.value?"":f.value.slice(0,xe).join(`
`));return(S,E)=>(s(),o("div",Zt,[e("div",Xt,[e("div",es,[E[0]||(E[0]=e("span",{class:"file-icon"},"📄",-1)),E[1]||(E[1]=e("strong",null,"Reading:",-1)),e("code",ts,g(l.value),1),i.value?(s(),o("span",ss,"Lines "+g(r.value)+"-"+g(a.value),1)):T("",!0)])]),v.value?(s(),o("div",os,[_.value?(s(),o("div",ns,[e("pre",ls,g(d.value),1)])):(s(),o("div",as,[e("div",rs,[E[2]||(E[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",is,g(p.value)+" lines",1),y.value?(s(),o("span",cs,"(showing first "+g(xe)+")")):T("",!0)]),e("pre",ds,g(w.value),1),y.value?(s(),o("div",us,"...")):T("",!0)]))])):T("",!0)]))}},ps=B(ms,[["__scopeId","data-v-0382f812"]]),vs={class:"write-tool-handler"},fs={class:"tool-section mb-3"},gs={class:"write-file-info mb-2"},_s={class:"file-path"},bs={class:"write-content-preview"},hs={class:"content-header"},ys={class:"line-count-badge"},$s={key:0,class:"preview-note"},ws={class:"tool-code content-display"},Ss={key:0,class:"more-indicator"},ks={key:0,class:"tool-section"},Cs={key:0,class:"tool-result tool-result-error"},xs={class:"tool-code"},Ms={key:1,class:"tool-result tool-result-success"},js={class:"success-message"},Me=100,Ts={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.file_path||"Unknown"),i=u(()=>t.toolCall.input?.content||""),r=u(()=>i.value.split(`
`)),a=u(()=>r.value.length),v=u(()=>a.value>Me),_=u(()=>r.value.slice(0,Me).join(`
`)),d=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),f=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),p=u(()=>{if(!d.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)});return(y,w)=>(s(),o("div",vs,[e("div",fs,[e("div",gs,[w[0]||(w[0]=e("span",{class:"file-icon"},"📝",-1)),w[1]||(w[1]=e("strong",null,"Writing:",-1)),e("code",_s,g(l.value),1)]),e("div",bs,[e("div",hs,[w[2]||(w[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",ys,g(a.value)+" lines",1),v.value?(s(),o("span",$s,"(showing first "+g(Me)+")")):T("",!0)]),e("pre",ws,g(_.value),1),v.value?(s(),o("div",Ss,"...")):T("",!0)])]),d.value?(s(),o("div",ks,[f.value?(s(),o("div",Cs,[w[3]||(w[3]=e("strong",null,"Error:",-1)),e("pre",xs,g(p.value),1)])):(s(),o("div",Ms,[e("div",js,[w[4]||(w[4]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"File created successfully ("+g(a.value)+" lines written)",1)])]))])):T("",!0)]))}},Es=B(Ts,[["__scopeId","data-v-d09b89ef"]]),Ps={class:"bash-tool-handler"},Ls={class:"tool-section mb-3"},Is={class:"bash-header"},Ds={class:"bash-header-content"},Os={key:0,class:"bash-description"},Ns={key:1,class:"bash-flags"},As={class:"bash-command-section"},Rs={class:"bash-command-content"},qs={key:0,class:"tool-section"},Us={key:0,class:"bash-output"},Ws={key:1,class:"bash-output-empty"},Hs={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.command||""),i=u(()=>t.toolCall.input?.description||""),r=u(()=>t.toolCall.input?.timeout),a=u(()=>t.toolCall.input?.run_in_background||!1),v=u(()=>r.value||a.value),_=u(()=>{const w=[];return r.value&&w.push(`timeout: ${r.value}ms`),a.value&&w.push("background"),w.join(", ")}),d=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),f=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),p=u(()=>f.value?"tool-result-error":"tool-result-success"),y=u(()=>{if(!d.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)});return(w,S)=>(s(),o("div",Ps,[e("div",Ls,[e("div",Is,[S[1]||(S[1]=e("span",{class:"bash-icon"},"💻",-1)),e("div",Ds,[i.value?(s(),o("div",Os,[S[0]||(S[0]=e("strong",null,"Description:",-1)),G(" "+g(i.value),1)])):T("",!0),v.value?(s(),o("div",Ns,g(_.value),1)):T("",!0)])]),e("div",As,[S[2]||(S[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",Rs,g(l.value),1)])]),d.value?(s(),o("div",qs,[e("div",{class:F(["tool-result",p.value])},[S[3]||(S[3]=e("strong",null,"Output:",-1)),y.value?(s(),o("pre",Us,g(y.value),1)):(s(),o("div",Ws,"No output"))],2)])):T("",!0)]))}},Fs=B(Hs,[["__scopeId","data-v-dc93bb16"]]),Bs={class:"todo-tool-handler"},Vs={class:"tool-section mb-3"},zs={class:"todo-header"},Gs={class:"todo-summary"},Js={key:0,class:"todo-count todo-count-completed"},Ks={key:1,class:"todo-count todo-count-in-progress"},Ys={key:2,class:"todo-count todo-count-pending"},Qs={class:"todo-checklist"},Zs={class:"todo-checkbox"},Xs={class:"todo-content"},eo={key:0,class:"tool-section"},to={key:0,class:"tool-result tool-result-error"},so={class:"tool-code"},oo={key:1,class:"tool-result tool-result-success"},no={class:"success-message"},lo={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.todos||[]),i=u(()=>l.value.filter(p=>p.status==="completed").length),r=u(()=>l.value.filter(p=>p.status==="in_progress").length),a=u(()=>l.value.filter(p=>p.status==="pending").length);function v(p){return{pending:"☐",in_progress:"◐",completed:"☑"}[p]||"☐"}const _=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),d=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),f=u(()=>{if(!_.value)return"";const p=t.toolCall.result;return p.content!==void 0?typeof p.content=="string"?p.content:JSON.stringify(p.content,null,2):p.message?p.message:JSON.stringify(p,null,2)});return(p,y)=>(s(),o("div",Bs,[e("div",Vs,[e("div",zs,[y[0]||(y[0]=e("span",{class:"todo-icon"},"📋",-1)),y[1]||(y[1]=e("strong",null,"Task List:",-1)),e("div",Gs,[i.value>0?(s(),o("span",Js,g(i.value)+" completed ",1)):T("",!0),r.value>0?(s(),o("span",Ks,g(r.value)+" in progress ",1)):T("",!0),a.value>0?(s(),o("span",Ys,g(a.value)+" pending ",1)):T("",!0)])]),e("div",Qs,[(s(!0),o(Z,null,X(l.value,(w,S)=>(s(),o("div",{key:S,class:F(["todo-item",`todo-${w.status}`])},[e("span",Zs,g(v(w.status)),1),e("span",Xs,g(w.content),1)],2))),128))])]),_.value?(s(),o("div",eo,[d.value?(s(),o("div",to,[y[2]||(y[2]=e("strong",null,"Error:",-1)),e("pre",so,g(f.value),1)])):(s(),o("div",oo,[e("div",no,[y[3]||(y[3]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"Task list updated ("+g(l.value.length)+" tasks)",1)])]))])):T("",!0)]))}},ao=B(lo,[["__scopeId","data-v-0984bcf9"]]),ro={class:"edit-tool-handler"},io={class:"tool-section mb-3"},co={class:"edit-file-info"},uo={class:"file-path"},mo={key:0,class:"replace-all-badge"},po={class:"edit-diff-container"},vo={class:"diff-header"},fo={class:"diff-stats"},go={class:"stat-removed"},_o={class:"stat-added"},bo={class:"unified-diff"},ho={class:"diff-scroll-container"},yo={class:"diff-marker"},$o={class:"diff-content"},wo={key:0,class:"tool-section"},So={key:0,class:"tool-result tool-result-error"},ko={class:"tool-code"},Co={key:1,class:"tool-result tool-result-success"},xo={class:"success-message"},Mo={key:0,class:"success-detail"},jo={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.file_path||"Unknown"),i=u(()=>t.toolCall.input?.old_string||""),r=u(()=>t.toolCall.input?.new_string||""),a=u(()=>t.toolCall.input?.replace_all||!1),v=u(()=>{const S=Ge(l.value,i.value,r.value,"","",{context:3}).split(`
`),E=[];for(let k=4;k<S.length;k++){const $=S[k];$&&($.startsWith("-")?E.push({type:"removed",content:$.substring(1)}):$.startsWith("+")?E.push({type:"added",content:$.substring(1)}):$.startsWith(" ")?E.push({type:"context",content:$.substring(1)}):$.startsWith("@@")&&E.push({type:"hunk",content:$}))}return E}),_=u(()=>v.value.filter(w=>w.type==="removed").length),d=u(()=>v.value.filter(w=>w.type==="added").length),f=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),p=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),y=u(()=>{if(!f.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)});return(w,S)=>(s(),o("div",ro,[e("div",io,[e("div",co,[S[0]||(S[0]=e("span",{class:"file-icon"},"✏️",-1)),S[1]||(S[1]=e("strong",null,"Editing:",-1)),e("code",uo,g(l.value),1),a.value?(s(),o("span",mo,"Replace All")):T("",!0)]),e("div",po,[e("div",vo,[S[2]||(S[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",fo,[e("span",go,"-"+g(_.value),1),e("span",_o,"+"+g(d.value),1)])]),e("div",bo,[e("div",ho,[(s(!0),o(Z,null,X(v.value,(E,k)=>(s(),o("div",{key:k,class:F(["diff-line",{"diff-line-removed":E.type==="removed","diff-line-added":E.type==="added","diff-line-context":E.type==="context","diff-line-hunk":E.type==="hunk"}])},[e("span",yo,g(E.type==="removed"?"-":E.type==="added"?"+":E.type==="hunk"?"@":" "),1),e("span",$o,g(E.content),1)],2))),128))])])])]),f.value?(s(),o("div",wo,[p.value?(s(),o("div",So,[S[3]||(S[3]=e("strong",null,"Error:",-1)),e("pre",ko,g(y.value),1)])):(s(),o("div",Co,[e("div",xo,[S[4]||(S[4]=e("span",{class:"success-icon"},"✅",-1)),S[5]||(S[5]=e("strong",null,"File edited successfully",-1)),a.value?(s(),o("span",Mo,"(all occurrences replaced)")):T("",!0)])]))])):T("",!0)]))}},To=B(jo,[["__scopeId","data-v-b06adbf2"]]),Eo={class:"search-tool-handler"},Po={class:"tool-section mb-3"},Lo={class:"search-info"},Io={class:"search-icon"},Do={class:"search-pattern"},Oo={key:0,class:"search-path"},No={key:1,class:"search-filters"},Ao={key:0,class:"filter-badge"},Ro={key:1,class:"filter-badge"},qo={key:2,class:"filter-badge"},Uo={key:0,class:"tool-section"},Wo={key:0,class:"tool-result tool-result-error"},Ho={class:"tool-code"},Fo={key:1,class:"search-results"},Bo={class:"results-header"},Vo={class:"results-label"},zo={class:"results-count-badge"},Go={class:"results-content"},Jo={class:"tool-code"},Ko={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.name==="Grep");u(()=>t.toolCall.name==="Glob");const i=u(()=>t.toolCall.input?.pattern||"Unknown"),r=u(()=>t.toolCall.input?.path||null),a=u(()=>t.toolCall.input?.type||null),v=u(()=>t.toolCall.input?.glob||null),_=u(()=>t.toolCall.input?.["-i"]||!1),d=u(()=>a.value||v.value||_.value),f=u(()=>l.value?"🔍":"📁"),p=u(()=>l.value?"Searching content":"Finding files"),y=u(()=>l.value?"Matches":"Files found"),w=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),S=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),E=u(()=>{if(!w.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)}),k=u(()=>!w.value||S.value||!E.value?0:E.value.split(`
`).filter(h=>h.trim()).length);return($,h)=>(s(),o("div",Eo,[e("div",Po,[e("div",Lo,[e("span",Io,g(f.value),1),e("strong",null,g(p.value)+":",1),e("code",Do,g(i.value),1),r.value?(s(),o("span",Oo,"in "+g(r.value),1)):T("",!0),d.value?(s(),o("span",No,[a.value?(s(),o("span",Ao,"type: "+g(a.value),1)):T("",!0),v.value?(s(),o("span",Ro,"glob: "+g(v.value),1)):T("",!0),_.value?(s(),o("span",qo,"case-insensitive")):T("",!0)])):T("",!0)])]),w.value?(s(),o("div",Uo,[S.value?(s(),o("div",Wo,[h[0]||(h[0]=e("strong",null,"Error:",-1)),e("pre",Ho,g(E.value),1)])):(s(),o("div",Fo,[e("div",Bo,[e("span",Vo,g(y.value)+":",1),e("span",zo,g(k.value)+" "+g(k.value===1?"match":"matches"),1)]),e("div",Go,[e("pre",Jo,g(E.value),1)])]))])):T("",!0)]))}},Oe=B(Ko,[["__scopeId","data-v-dc01ae0d"]]),Yo={class:"web-tool-handler"},Qo={class:"tool-section mb-3"},Zo={class:"web-info"},Xo={class:"web-icon"},en=["href"],tn={key:1,class:"web-query"},sn={key:0,class:"web-prompt-container"},on={class:"prompt-content"},nn={key:1,class:"web-domains"},ln={class:"domains-label"},an={key:0,class:"tool-section"},rn={key:0,class:"tool-result tool-result-error"},cn={class:"tool-code"},dn={key:1,class:"web-results"},un={class:"results-header"},mn={class:"results-label"},pn={class:"results-content"},vn={class:"tool-code"},fn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.name==="WebFetch");u(()=>t.toolCall.name==="WebSearch");const i=u(()=>t.toolCall.input?.url||null),r=u(()=>t.toolCall.input?.query||null),a=u(()=>t.toolCall.input?.prompt||null),v=u(()=>t.toolCall.input?.allowed_domains||[]),_=u(()=>t.toolCall.input?.blocked_domains||[]),d=u(()=>v.value.length>0?v.value:_.value.length>0?_.value:[]),f=u(()=>v.value.length>0?"Allowed domains":_.value.length>0?"Blocked domains":"Domains"),p=u(()=>l.value?"🌐":"🔎"),y=u(()=>l.value?"Fetching URL":"Searching web"),w=u(()=>l.value?"Fetched content":"Search results"),S=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),E=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),k=u(()=>{if(!S.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)});return($,h)=>(s(),o("div",Yo,[e("div",Qo,[e("div",Zo,[e("span",Xo,g(p.value),1),e("strong",null,g(y.value)+":",1),i.value?(s(),o("a",{key:0,href:i.value,target:"_blank",class:"web-url"},g(i.value),9,en)):r.value?(s(),o("code",tn,g(r.value),1)):T("",!0)]),a.value?(s(),o("div",sn,[h[0]||(h[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",on,g(a.value),1)])):T("",!0),d.value.length>0?(s(),o("div",nn,[e("span",ln,g(f.value)+":",1),(s(!0),o(Z,null,X(d.value,x=>(s(),o("span",{key:x,class:"domain-badge"},g(x),1))),128))])):T("",!0)]),S.value?(s(),o("div",an,[E.value?(s(),o("div",rn,[h[1]||(h[1]=e("strong",null,"Error:",-1)),e("pre",cn,g(k.value),1)])):(s(),o("div",dn,[e("div",un,[e("span",mn,g(w.value)+":",1)]),e("div",pn,[e("pre",vn,g(k.value),1)])]))])):T("",!0)]))}},Ne=B(fn,[["__scopeId","data-v-49e16a90"]]),gn={class:"task-tool-handler"},_n={class:"tool-section mb-3"},bn={class:"task-header"},hn={key:0,class:"agent-type-badge"},yn={key:0,class:"task-description"},$n={class:"description-content"},wn={key:1,class:"task-prompt-container"},Sn={class:"prompt-header"},kn={class:"prompt-length"},Cn={class:"prompt-code"},xn={key:0,class:"tool-section"},Mn={key:0,class:"tool-result tool-result-error"},jn={class:"tool-code"},Tn={key:1,class:"agent-output"},En={class:"output-header"},Pn={key:0,class:"output-count-badge"},Ln={class:"output-content"},In={class:"tool-code"},Dn={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.description||null),i=u(()=>t.toolCall.input?.prompt||null),r=u(()=>t.toolCall.input?.subagent_type||null),a=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),_=u(()=>{if(!a.value)return"";const f=t.toolCall.result;return f.content!==void 0?typeof f.content=="string"?f.content:JSON.stringify(f.content,null,2):f.message?f.message:JSON.stringify(f,null,2)}),d=u(()=>_.value?_.value.split(`
`).length:0);return(f,p)=>(s(),o("div",gn,[e("div",_n,[e("div",bn,[p[0]||(p[0]=e("span",{class:"task-icon"},"🤖",-1)),p[1]||(p[1]=e("strong",null,"Agent Task:",-1)),r.value?(s(),o("span",hn,g(r.value),1)):T("",!0)]),l.value?(s(),o("div",yn,[p[2]||(p[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",$n,g(l.value),1)])):T("",!0),i.value?(s(),o("div",wn,[e("div",Sn,[p[3]||(p[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",kn,g(i.value.length)+" characters",1)]),e("pre",Cn,g(i.value),1)])):T("",!0)]),a.value?(s(),o("div",xn,[v.value?(s(),o("div",Mn,[p[4]||(p[4]=e("strong",null,"Error:",-1)),e("pre",jn,g(_.value),1)])):(s(),o("div",Tn,[e("div",En,[p[5]||(p[5]=e("span",{class:"output-label"},"Agent Output:",-1)),d.value>0?(s(),o("span",Pn,g(d.value)+" lines",1)):T("",!0)]),e("div",Ln,[e("pre",In,g(_.value),1)])]))])):T("",!0)]))}},On=B(Dn,[["__scopeId","data-v-513043f9"]]),Nn={class:"notebook-edit-tool-handler"},An={class:"tool-section mb-3"},Rn={class:"notebook-info"},qn={class:"file-path"},Un={class:"cell-info mt-2"},Wn={class:"info-row"},Hn={class:"info-row"},Fn={key:0,class:"info-row"},Bn={class:"badge bg-info"},Vn={key:0,class:"source-preview mt-3"},zn={class:"preview-header"},Gn={class:"preview-stats"},Jn={class:"source-code"},Kn={key:0,class:"tool-section"},Yn={key:0},Qn={key:1,class:"text-danger"},Zn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.notebook_path||"Unknown"),i=u(()=>t.toolCall.input?.cell_id),r=u(()=>t.toolCall.input?.cell_type||"code"),a=u(()=>t.toolCall.input?.edit_mode||"replace"),v=u(()=>t.toolCall.input?.new_source||""),_=u(()=>v.value.split(`
`).length),d=u(()=>r.value==="code"?"bg-primary":"bg-secondary"),f=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),p=u(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const y=a.value;return y==="insert"?"Cell inserted successfully":y==="delete"?"Cell deleted successfully":"Cell updated successfully"});return(y,w)=>(s(),o("div",Nn,[e("div",An,[e("div",Rn,[w[0]||(w[0]=e("span",{class:"notebook-icon"},"📓",-1)),w[1]||(w[1]=e("strong",null,"Notebook:",-1)),e("code",qn,g(l.value),1)]),e("div",Un,[e("div",Wn,[w[2]||(w[2]=e("strong",null,"Cell ID:",-1)),e("code",null,g(i.value||"N/A"),1)]),e("div",Hn,[w[3]||(w[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:F(["badge",d.value])},g(r.value),3)]),a.value?(s(),o("div",Fn,[w[4]||(w[4]=e("strong",null,"Edit Mode:",-1)),e("span",Bn,g(a.value),1)])):T("",!0)]),v.value?(s(),o("div",Vn,[e("div",zn,[w[5]||(w[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",Gn,g(_.value)+" lines",1)]),e("pre",Jn,[e("code",null,g(v.value),1)])])):T("",!0)]),n.toolCall.result?(s(),o("div",Kn,[w[8]||(w[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:F(["tool-result",f.value])},[n.toolCall.result.success!==!1?(s(),o("div",Yn,[w[6]||(w[6]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+g(p.value),1)])):(s(),o("div",Qn,[w[7]||(w[7]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+g(n.toolCall.result.error||"Operation failed"),1)]))],2)])):T("",!0)]))}},Xn=B(Zn,[["__scopeId","data-v-3261abc1"]]),el={class:"shell-tool-handler"},tl={class:"tool-section mb-3"},sl={class:"shell-info"},ol={class:"shell-icon"},nl={key:0,class:"shell-id"},ll={key:0,class:"filter-info mt-2"},al={class:"filter-pattern"},rl={key:0,class:"tool-section"},il={class:"result-header mb-2"},cl={key:0,class:"shell-output"},dl={key:0},ul={key:1,class:"text-danger"},ml={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.name==="BashOutput"?"📤":t.toolCall.name==="KillShell"?"🛑":"🐚"),i=u(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),r=u(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),a=u(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),v=u(()=>t.toolCall.input?.filter),_=u(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),d=u(()=>t.toolCall.result?.status),f=u(()=>{const w=d.value;return w==="running"?"bg-success":w==="completed"?"bg-secondary":w==="killed"||w==="terminated"?"bg-danger":"bg-info"}),p=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),y=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return(w,S)=>(s(),o("div",el,[e("div",tl,[e("div",sl,[e("span",ol,g(l.value),1),e("strong",null,g(i.value)+":",1),a.value?(s(),o("code",nl,"Shell "+g(a.value),1)):T("",!0)]),n.toolCall.name==="BashOutput"&&v.value?(s(),o("div",ll,[S[0]||(S[0]=e("strong",null,"Filter:",-1)),e("code",al,g(v.value),1)])):T("",!0)]),n.toolCall.result?(s(),o("div",rl,[e("div",il,[e("strong",null,g(r.value)+":",1),d.value?(s(),o("span",{key:0,class:F(["badge",f.value])},g(d.value),3)):T("",!0)]),_.value?(s(),o("div",cl,[e("pre",null,[e("code",null,g(_.value),1)])])):(s(),o("div",{key:1,class:F(["tool-result",p.value])},[n.toolCall.result.success!==!1?(s(),o("div",dl,[S[1]||(S[1]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+g(y.value),1)])):(s(),o("div",ul,[S[2]||(S[2]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+g(n.toolCall.result.error||"Operation failed"),1)]))],2))])):T("",!0)]))}},Ae=B(ml,[["__scopeId","data-v-fc9da4c0"]]),pl={class:"skill-tool-handler"},vl={class:"tool-section mb-3"},fl={class:"skill-info"},gl={class:"skill-name"},_l={key:0,class:"tool-section mb-3"},bl={class:"base-directory-info"},hl={class:"directory-path"},yl={key:1,class:"tool-section"},$l={class:"d-flex align-items-center gap-2"},wl={class:"text-muted small"},Sl={key:0,class:"skill-content-body"},kl={class:"skill-content-text"},Cl={key:2,class:"tool-section mt-3"},xl={class:"tool-result tool-result-error"},Ml={class:"tool-code"},jl={__name:"SkillToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=ue(),i=J(),r=L(!1);function a(){r.value=!r.value}const v=u(()=>t.toolCall.input?.command||"Unknown Skill"),_=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),d=u(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}}),f=u(()=>{const $=i.currentSessionId;if(!$)return{running:null,content:null};const h=l.messagesBySession.get($)||[],x=h.findIndex(O=>O.type==="user"&&O.metadata?.has_tool_results&&O.metadata?.tool_results?.some(q=>q.tool_use_id===t.toolCall.id));if(x===-1)return{running:null,content:null};let b=null,c=null;for(let O=x+1;O<Math.min(x+3,h.length);O++){const q=h[O];if(q.type!=="user")continue;const C=q.content||"";C.includes("<command-message>")&&C.includes("skill is running")?b=q:C.startsWith("Base directory for this skill:")&&(c=q)}return{running:b,content:c}}),p=u(()=>{const $=f.value.content;if(!$)return null;const x=($.content||"").match(/Base directory(?:\s+for\s+this\s+skill)?:\s*(.+?)(?:\n|$)/i);return x&&x[1]?x[1].trim():null}),y=u(()=>{const $=f.value.content;if(!$)return"";const h=$.content||"",x=/Base directory(?:\s+for\s+this\s+skill)?:.*?\n/i;return h.replace(x,"").trim()}),w=u(()=>y.value.length>0),S=u(()=>y.value?y.value.split(`
`).length:0),E=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),k=u(()=>{if(!E.value)return"";const $=t.toolCall.result;return $?.message?$.message:$?.error?$.error:"An error occurred"});return($,h)=>(s(),o("div",pl,[e("div",vl,[e("div",fl,[h[0]||(h[0]=e("span",{class:"skill-icon"},"📋",-1)),h[1]||(h[1]=e("strong",null,"Skill:",-1)),e("code",gl,g(v.value),1),e("span",{class:F(["skill-status-badge",d.value])},g(_.value),3)])]),p.value?(s(),o("div",_l,[e("div",bl,[h[2]||(h[2]=e("span",{class:"directory-icon"},"📁",-1)),h[3]||(h[3]=e("strong",null,"Base directory:",-1)),e("code",hl,g(p.value),1)])])):T("",!0),w.value?(s(),o("div",yl,[e("div",{class:"skill-content-header",onClick:a},[e("div",$l,[e("i",{class:F(["bi",r.value?"bi-chevron-down":"bi-chevron-right"])},null,2),h[4]||(h[4]=e("strong",null,"Skill Content",-1)),e("span",wl,"("+g(S.value)+" lines)",1)])]),r.value?(s(),o("div",Sl,[e("pre",kl,g(y.value),1)])):T("",!0)])):T("",!0),E.value?(s(),o("div",Cl,[h[5]||(h[5]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",xl,[e("pre",Ml,g(k.value),1)])])):T("",!0)]))}},Tl=B(jl,[["__scopeId","data-v-a9fab5d1"]]),El={class:"slashcommand-tool-handler"},Pl={class:"tool-section mb-3"},Ll={class:"command-info"},Il={class:"command-name"},Dl={key:0,class:"tool-section mb-3"},Ol={class:"arguments-info"},Nl={class:"arguments-text"},Al={key:1,class:"tool-section"},Rl={class:"d-flex align-items-center gap-2"},ql={class:"text-muted small"},Ul={key:0,class:"command-content-body"},Wl={class:"command-content-text"},Hl={key:2,class:"tool-section mt-3"},Fl={class:"tool-result tool-result-error"},Bl={class:"tool-code"},Vl={__name:"SlashCommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=ue(),i=J(),r=L(!1);function a(){r.value=!r.value}const v=u(()=>t.toolCall.input?.command||"Unknown Command"),_=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),d=u(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}}),f=u(()=>{const $=i.currentSessionId;if(!$)return{running:null,content:null};const h=l.messagesBySession.get($)||[],x=h.findIndex(O=>O.type==="user"&&O.metadata?.has_tool_results&&O.metadata?.tool_results?.some(q=>q.tool_use_id===t.toolCall.id));if(x===-1)return{running:null,content:null};let b=null,c=null;for(let O=x+1;O<Math.min(x+3,h.length);O++){const q=h[O];if(q.type!=="user")continue;const C=q.content||"";C.includes("<command-message>")&&C.includes("<command-name>")&&C.includes("<command-args>")?b=q:C.includes("ARGUMENTS:")&&(c=q)}return{running:b,content:c}}),p=u(()=>{const $=f.value.running;if(!$)return null;const x=($.content||"").match(/<command-args>(.+?)<\/command-args>/s);return x&&x[1]?x[1].trim():null}),y=u(()=>{const $=f.value.content;if(!$)return"";const h=$.content||"",x=/\nARGUMENTS:.*$/s;return h.replace(x,"").replace(/<command-message>.*?<\/command-message>/s,"").replace(/<command-name>.*?<\/command-name>/s,"").replace(/<command-args>.*?<\/command-args>/s,"").trim()}),w=u(()=>y.value.length>0),S=u(()=>y.value?y.value.split(`
`).length:0),E=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),k=u(()=>{if(!E.value)return"";const $=t.toolCall.result;return $?.message?$.message:$?.error?$.error:"An error occurred"});return($,h)=>(s(),o("div",El,[e("div",Pl,[e("div",Ll,[h[0]||(h[0]=e("span",{class:"command-icon"},"/",-1)),h[1]||(h[1]=e("strong",null,"Slash Command:",-1)),e("code",Il,g(v.value),1),e("span",{class:F(["command-status-badge",d.value])},g(_.value),3)])]),p.value?(s(),o("div",Dl,[e("div",Ol,[h[2]||(h[2]=e("span",{class:"arguments-icon"},"📌",-1)),h[3]||(h[3]=e("strong",null,"Arguments:",-1)),e("code",Nl,g(p.value),1)])])):T("",!0),w.value?(s(),o("div",Al,[e("div",{class:"command-content-header",onClick:a},[e("div",Rl,[e("i",{class:F(["bi",r.value?"bi-chevron-down":"bi-chevron-right"])},null,2),h[4]||(h[4]=e("strong",null,"Command Content",-1)),e("span",ql,"("+g(S.value)+" lines)",1)])]),r.value?(s(),o("div",Ul,[e("pre",Wl,g(y.value),1)])):T("",!0)])):T("",!0),E.value?(s(),o("div",Hl,[h[5]||(h[5]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",Fl,[e("pre",Bl,g(k.value),1)])])):T("",!0)]))}},zl=B(Vl,[["__scopeId","data-v-9be4c14e"]]),Gl={class:"exit-plan-mode-tool-handler"},Jl={class:"tool-section mb-3"},Kl={key:0,class:"plan-content mt-2"},Yl={class:"plan-text"},Ql={key:0,class:"tool-section"},Zl={key:0},Xl={key:1,class:"text-danger"},ea={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.plan),i=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(r,a)=>(s(),o("div",Gl,[e("div",Jl,[a[1]||(a[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"📋"),e("strong",null,"Exiting Plan Mode")],-1)),l.value?(s(),o("div",Kl,[a[0]||(a[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",Yl,g(l.value),1)])):T("",!0)]),n.toolCall.result?(s(),o("div",Ql,[a[4]||(a[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:F(["tool-result",i.value])},[n.toolCall.result.success!==!1?(s(),o("div",Zl,[...a[2]||(a[2]=[e("i",{class:"bi bi-check-circle"},null,-1),G(" Permission mode reverted to default ",-1)])])):(s(),o("div",Xl,[a[3]||(a[3]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+g(n.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):T("",!0)]))}},ta=B(ea,[["__scopeId","data-v-f1d32203"]]),sa={class:"d-flex align-items-center gap-2 flex-grow-1 min-width-0"},oa={class:"tool-status-icon"},na=["title"],la={class:"text-muted small"},aa={class:"d-flex align-items-center gap-2"},ra={class:"text-muted"},ia={key:0,class:"card-body"},ca={key:0,class:"alert alert-warning mb-3"},da={class:"d-flex align-items-center"},ua={class:"mb-0 small"},ma={key:1,class:"permission-prompt mt-3"},pa={class:"alert alert-warning mb-3"},va={class:"mb-0"},fa={class:"tool-name"},ga={key:0,class:"suggestions-section mb-3"},_a={class:"alert alert-info mb-0"},ba={class:"suggestion-details p-2 bg-white rounded"},ha={class:"permission-buttons d-flex gap-2 mb-3"},ya=["disabled"],$a=["disabled"],wa=["disabled"],Sa={class:"guidance-section mt-3"},ka=["disabled"],Ca=["disabled"],xa={key:2,class:"mt-3"},Ma={class:"alert alert-warning mb-0"},ja={class:"d-flex align-items-center"},Ta={class:"mb-0 small"},Ea={key:3,class:"tool-section mt-3"},Pa={class:"alert alert-danger mb-0"},La={key:0},Ia={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=ue(),i=J(),r=ge(),a=L(!1),v=L(null),_=L(""),d=u(()=>l.isToolUseOrphaned(i.currentSessionId,t.toolCall.id)),f=u(()=>l.getOrphanedInfo(i.currentSessionId,t.toolCall.id)),p={Read:ps,Write:Es,Bash:Fs,TodoWrite:ao,Edit:To,Grep:Oe,Glob:Oe,WebFetch:Ne,WebSearch:Ne,Task:On,NotebookEdit:Xn,BashOutput:Ae,KillShell:Ae,SlashCommand:zl,Skill:Tl,ExitPlanMode:ta},y=u(()=>{const D=t.toolCall.name;return p[D]?p[D]:Qt}),w=u(()=>{const D=[];switch(t.toolCall.status){case"pending":D.push("border-secondary");break;case"permission_required":D.push("border-warning");break;case"executing":D.push("border-primary");break;case"completed":$.value||t.toolCall.permissionDecision==="deny"?D.push("border-danger"):D.push("border-success");break;case"error":D.push("border-danger");break}return D.join(" ")}),S=u(()=>{switch(t.toolCall.status){case"pending":return"🔄";case"permission_required":return"❓";case"executing":return"⚡";case"completed":return t.toolCall.permissionDecision==="deny"?"❌":$.value?"💥":"✅";case"error":return"💥";default:return"🔧"}}),E=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Executing...";case"completed":return t.toolCall.permissionDecision==="deny"?"Denied":$.value?"Error":"Completed";case"error":return"Error";default:return"Unknown"}}),k=u(()=>ke(t.toolCall.timestamp)),$=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),h=u(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function x(D){if(!D)return"";const m=D.replace(/\\/g,"/").split("/");return m[m.length-1]}function b(D,m=200){return D?D.length<=m?D:D.substring(0,m)+"...":""}function c(D){if(!D)return null;if(D.content){const m=D.content.match(/exit code (\d+)/i);if(m)return parseInt(m[1])}return D.error?1:0}function O(D,m){const j=D?D.split(`
`).length:0;return{added:m?m.split(`
`).length:0,removed:j}}const q=u(()=>{const D=t.toolCall.name,m=t.toolCall.input||{},j=t.toolCall.result,A=t.toolCall.status;switch(D){case"Bash":case"Shell":case"Command":case"SlashCommand":{const N=b(m.command,200);if(A==="completed"&&j){const M=c(j);return`Bash: ${N} (exit ${M})`}return`Bash: ${N}`}case"Edit":{const N=x(m.file_path);if(A==="completed"&&j&&!j.error){const{added:M,removed:I}=O(m.old_string,m.new_string);return M===I?`Edit: ${N} (${M} lines changed)`:`Edit: ${N} (${M} lines added, ${I} removed)`}return`Edit: ${N}`}case"Read":{const N=x(m.file_path);if(m.offset!==void 0||m.limit!==void 0){const I=(m.offset||0)+1,W=m.limit?(m.offset||0)+m.limit:"∞";return`Read: ${N} (lines ${I}-${W})`}return`Read: ${N} (full file)`}case"Write":{const N=x(m.file_path);if(A==="completed"&&j&&!j.error&&m.content){const M=m.content.split(`
`).length;return`Write: ${N} (${M} lines written)`}return`Write: ${N}`}case"Skill":{const N=m.command||"Unknown";return A==="completed"&&j?j.error?`Skill: ${N} (error)`:`Skill: ${N} (completed)`:`Skill: ${N}`}case"Task":{const N=m.subagent_type||"general",M=m.description||"Task";return A==="completed"&&j?j.error?`Task: (${N}) ${M} (error)`:`Task: (${N}) ${M} (completed)`:`Task: (${N}) ${M}`}case"TodoWrite":{if(m.todos&&Array.isArray(m.todos)){const N=m.todos.filter(W=>W.status==="completed").length,M=m.todos.length,I=m.todos.find(W=>W.status==="in_progress");return I?`Todo: Working on "${I.content}"`:`Todo: ${N}/${M} Tasks Completed`}return"Todo: Updated"}case"Grep":case"Glob":{const N=m.pattern||"",M=D==="Grep"?"Grep":"Glob";if(A==="completed"&&j&&!j.error){let I=0;return j.content&&(I=j.content.split(`
`).filter(V=>V.trim()).length),`${M}: "${N}" (${I} results)`}return`${M}: "${N}"`}case"WebFetch":case"WebSearch":{const N=m.url||m.query||"";let M="";try{N&&(M=new URL(N.startsWith("http")?N:`https://${N}`).hostname)}catch{M=N.length>50?N.substring(0,50)+"...":N}return A==="completed"&&j?j.error?`Web: ${M} (error)`:`Web: ${M} (success)`:`Web: ${M||N}`}case"NotebookEdit":{const N=x(m.notebook_path),M=m.cell_number!==void 0?m.cell_number:"?",I=m.edit_mode||"replace";return`NotebookEdit: ${N} cell #${M} (${I})`}case"ExitPlanMode":return"ExitPlanMode: Plan submitted";case"BashOutput":return`BashOutput: Read output from ${m.bash_id||"unknown"}`;case"KillShell":return`KillShell: Terminate ${m.shell_id||"unknown"}`;default:return`${D}: executed`}}),C=u(()=>{const D=t.toolCall.name,m=t.toolCall.input||{};return["Bash","Shell","Command","SlashCommand"].includes(D)?m.command||D:["Edit","Read","Write","NotebookEdit"].includes(D)&&(m.file_path||m.notebook_path)||D});function P(){const D=i.currentSessionId;D&&l.toggleToolExpansion(D,t.toolCall.id)}function H(D){return D.type==="setMode"?`Set permission mode to "${D.mode}"`:D.type==="allow"?`Allow tool: ${D.tool}`:JSON.stringify(D)}async function R(D,m,j=null){if(!a.value){a.value=!0,D==="allow"?v.value=m?"approve-apply":"approve":j?v.value="deny-guidance":v.value="deny";try{const A=i.currentSessionId;if(A){const N=m&&t.toolCall.suggestions?t.toolCall.suggestions:[];l.handlePermissionResponse(A,{request_id:t.toolCall.permissionRequestId,decision:D,reasoning:D==="allow"?"User allowed permission":"User denied permission",applied_updates:N})}await r.sendPermissionResponse(t.toolCall.permissionRequestId,D,m,j)}catch(A){console.error("Failed to send permission response:",A)}finally{a.value=!1,v.value=null}}}return(D,m)=>(s(),o("div",{class:F(["tool-call-card card mb-3",w.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:P},[e("div",sa,[e("span",oa,g(S.value),1),e("strong",{class:"tool-name",title:C.value},g(q.value),9,na),e("span",la,g(E.value),1)]),e("div",aa,[e("small",ra,g(k.value),1),e("i",{class:F(["bi",n.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),n.toolCall.isExpanded?(s(),o("div",ia,[d.value?(s(),o("div",ca,[e("div",da,[m[6]||(m[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[m[5]||(m[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",ua,g(f.value?.message||"Session was terminated"),1)])])])):T("",!0),(s(),de(qe(y.value),{toolCall:n.toolCall},null,8,["toolCall"])),n.toolCall.status==="permission_required"&&!d.value?(s(),o("div",ma,[e("div",pa,[m[9]||(m[9]=e("p",{class:"mb-2"},[e("strong",null,"🔐 Permission Required")],-1)),e("p",va,[m[7]||(m[7]=G("Claude wants to use the ",-1)),e("code",fa,g(n.toolCall.name),1),m[8]||(m[8]=G(" tool.",-1))])]),h.value?(s(),o("div",ga,[e("div",_a,[m[10]||(m[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),G(" Suggested Permission Update ")],-1)),m[11]||(m[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",ba,[(s(!0),o(Z,null,X(n.toolCall.suggestions,(j,A)=>(s(),o("div",{key:A,class:"suggestion-item"},[e("code",null,g(H(j)),1)]))),128))]),m[12]||(m[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):T("",!0),e("div",ha,[h.value?(s(),o("button",{key:0,class:"btn btn-success",onClick:m[0]||(m[0]=j=>R("allow",!0)),disabled:a.value},[m[13]||(m[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+g(a.value&&v.value==="approve-apply"?"⏳ Submitting...":"✅ Approve & Apply"),1)],8,ya)):T("",!0),e("button",{class:F(["btn",h.value?"btn-outline-success":"btn-success"]),onClick:m[1]||(m[1]=j=>R("allow",!1)),disabled:a.value},[m[14]||(m[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+g(a.value&&v.value==="approve"?"⏳ Submitting...":h.value?"✅ Approve Only":"✅ Approve"),1)],10,$a),e("button",{class:"btn btn-danger",onClick:m[2]||(m[2]=j=>R("deny",!1)),disabled:a.value},[m[15]||(m[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),G(" "+g(a.value&&v.value==="deny"?"⏳ Submitting...":"❌ Deny"),1)],8,wa)]),e("div",Sa,[m[17]||(m[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),G(" Provide Guidance (Optional) ")],-1)),m[18]||(m[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),Y(e("textarea",{"onUpdate:modelValue":m[3]||(m[3]=j=>_.value=j),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:a.value},null,8,ka),[[ne,_.value]]),_.value.trim()?(s(),o("button",{key:0,class:"btn btn-warning btn-sm",onClick:m[4]||(m[4]=j=>R("deny",!1,_.value)),disabled:a.value},[m[16]||(m[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),G(" "+g(a.value&&v.value==="deny-guidance"?"⏳ Submitting...":"💡 Provide Guidance & Continue"),1)],8,Ca)):T("",!0)])])):T("",!0),n.toolCall.status==="permission_required"&&d.value?(s(),o("div",xa,[e("div",Ma,[e("div",ja,[m[20]||(m[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[m[19]||(m[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",Ta,g(f.value?.message||"Session was terminated before permission could be granted"),1)])])])])):T("",!0),n.toolCall.permissionDecision==="deny"?(s(),o("div",Ea,[e("div",Pa,[m[21]||(m[21]=e("i",{class:"bi bi-x-circle"},null,-1)),m[22]||(m[22]=G(" Permission denied ",-1)),n.toolCall.result?.message?(s(),o("span",La," - "+g(n.toolCall.result.message),1)):T("",!0)])])):T("",!0)])):T("",!0)],2))}},Da=B(Ia,[["__scopeId","data-v-5d9ac928"]]),Oa={class:"card assistant-message bg-white border-start border-success border-3"},Na={class:"card-body"},Aa={class:"d-flex justify-content-between align-items-center mb-2"},Ra={class:"d-flex align-items-center gap-2"},qa={key:0,class:"text-muted"},Ua={class:"text-muted"},Wa={key:0,class:"thinking-block mb-3"},Ha=["innerHTML"],Fa={key:2,class:"tool-calls mt-3"},Ba={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n,l=ue(),i=J();he.setOptions({breaks:!0,gfm:!0});const r=u(()=>ke(t.message.timestamp)),a=u(()=>t.message.metadata?.model||null),v=u(()=>{const S=t.message.content||"";return S.trim().length>0&&S!=="Assistant response"}),_=u(()=>{const S=t.message.content||"",E=he.parse(S);return Te.sanitize(E)}),d=u(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),f=u(()=>t.message.metadata?.thinking_content||""),p=u(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),y=u(()=>t.message.metadata?.tool_uses||[]),w=u(()=>{const S=i.currentSessionId;if(!S)return[];const E=l.toolCallsBySession.get(S)||[];return y.value.map(k=>{const $=E.find(h=>h.id===k.id);return $||{id:k.id,name:k.name,input:k.input,status:"pending",result:null,timestamp:k.timestamp||t.message.timestamp,isExpanded:!0}})});return(S,E)=>(s(),o("div",Oa,[e("div",Na,[e("div",Aa,[e("div",Ra,[E[0]||(E[0]=e("span",{class:"message-icon"},"🤖",-1)),E[1]||(E[1]=e("strong",{class:"message-role"},"Assistant",-1)),a.value?(s(),o("small",qa,g(a.value),1)):T("",!0)]),e("small",Ua,g(r.value),1)]),d.value?(s(),o("div",Wa,[Q(Wt,{thinking:f.value},null,8,["thinking"])])):T("",!0),v.value?(s(),o("div",{key:1,class:"message-content",innerHTML:_.value},null,8,Ha)):T("",!0),p.value?(s(),o("div",Fa,[(s(!0),o(Z,null,X(w.value,k=>(s(),de(Da,{key:k.id,toolCall:k},null,8,["toolCall"]))),128))])):T("",!0)])]))}},Va=B(Ba,[["__scopeId","data-v-25a87a40"]]),za={class:"card system-message bg-info bg-opacity-10 border-info"},Ga={class:"card-body py-2 px-3"},Ja={class:"d-flex align-items-center gap-2"},Ka={class:"text-muted flex-grow-1"},Ya={class:"text-muted"},Qa={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>ke(t.message.timestamp));return(i,r)=>(s(),o("div",za,[e("div",Ga,[e("div",Ja,[r[0]||(r[0]=e("i",{class:"bi bi-info-circle text-info"},null,-1)),e("small",Ka,g(n.message.content),1),e("small",Ya,g(l.value),1)])])]))}},Re=B(Qa,[["__scopeId","data-v-bba7a395"]]),Za={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>{switch(t.message.type){case"user":return Ot;case"assistant":return Va;case"system":return Re;default:return Re}});return(i,r)=>(s(),o("div",{class:F(["message-item mb-3",`message-${n.message.type}`])},[(s(),de(qe(l.value),{message:n.message},null,8,["message"]))],2))}},Xa=B(Za,[["__scopeId","data-v-fbd275ac"]]),er={key:0,class:"text-muted text-center py-5"},tr={__name:"MessageList",setup(n){const t=ue(),l=te(),i=L(null),r=u(()=>t.currentMessages.filter(d=>v(d)));u(()=>t.currentToolCalls);async function a(){l.autoScrollEnabled&&(await je(),i.value&&(i.value.scrollTop=i.value.scrollHeight))}se(()=>t.currentMessages.length,a),se(()=>t.currentToolCalls.length,a),se(()=>t.currentToolCalls.map(d=>`${d.id}-${d.status}`).join(","),a),ie(()=>{setTimeout(()=>{a()},100)});function v(d){const f=d.subtype||d.metadata?.subtype;if(d.type==="system"&&f==="init"||d.type==="result"||d.type==="permission_request"||d.type==="permission_response")return!1;if(d.type==="user"&&d.metadata?.has_tool_results){const p=d.content||"";if(p.match(/^Tool results?: \d+ results?$/i)||p.trim()==="")return!1}if(d.type==="user"){const p=d.content||"";if(p.includes("<command-message>")&&p.includes("skill is running")||p.startsWith("Base directory for this skill:"))return!1}if(d.type==="user"){const p=d.content||"";if(p.includes("<command-message>")&&p.includes("<command-name>")&&p.includes("<command-args>")||p.includes("ARGUMENTS:")&&(p.includes("<command-name>")||p.match(/\nARGUMENTS:/)))return!1}return!0}function _(d){return{type:d.type||"unknown",content:d.content||"",timestamp:d.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...d.metadata}}}return(d,f)=>(s(),o("div",{class:"messages-area flex-grow-1 overflow-auto p-3",ref_key:"messagesArea",ref:i},[r.value.length===0?(s(),o("div",er," No messages yet. Start a conversation! ")):T("",!0),(s(!0),o(Z,null,X(r.value,(p,y)=>(s(),de(Xa,{key:`msg-${p.timestamp}-${y}`,message:_(p)},null,8,["message"]))),128))],512))}},sr=B(tr,[["__scopeId","data-v-54f5badf"]]),or={class:"border-top bg-light"},nr={class:"d-flex gap-2 align-items-end px-2 py-1"},lr=["placeholder","disabled","onKeydown"],ar=["disabled"],rr={__name:"InputArea",setup(n){const t=J(),l=ge(),i=L(null),r=u({get:()=>t.currentInput,set:w=>{t.currentInput=w}}),a=u(()=>t.currentSession?.is_processing||!1),v=u(()=>l.sessionConnected),_=u(()=>t.currentSession?.state==="starting"),d=u(()=>_.value?"Session is starting...":v.value?"Type your message to Claude Code...":"Waiting for connection...");function f(){const w=i.value;if(!w)return;w.style.height="auto";const S=Math.min(w.scrollHeight,parseInt(getComputedStyle(w).maxHeight));w.style.height=S+"px"}function p(){r.value.trim()&&(l.sendMessage(r.value),r.value="",i.value&&(i.value.style.height="auto"))}function y(){l.interruptSession()}return(w,S)=>(s(),o("div",or,[e("div",nr,[Y(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:i,"onUpdate:modelValue":S[0]||(S[0]=E=>r.value=E),class:"form-control",placeholder:d.value,disabled:_.value||!v.value,rows:"1",onInput:f,onKeydown:Se(re(p,["exact","prevent"]),["enter"])},null,40,lr),[[ne,r.value]]),a.value?(s(),o("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:y}," Stop ")):(s(),o("button",{key:1,class:"btn btn-primary",disabled:!r.value.trim()||!v.value||_.value,onClick:p}," Send ",8,ar))])]))}},ir=B(rr,[["__scopeId","data-v-a72bf16a"]]),cr={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},dr={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},ur={class:"text-secondary"},mr={class:"d-flex flex-column flex-grow-1 overflow-hidden"},We={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=te(),r=u(()=>l.currentSession),a=u(()=>i.isLoading),v=u(()=>i.loadingMessage);return ie(async()=>{if(t.sessionId!==l.currentSessionId){i.showLoading("Loading session...");try{await l.selectSession(t.sessionId)}finally{i.hideLoading()}}}),se(()=>t.sessionId,async(_,d)=>{if(_!==d&&_!==l.currentSessionId){i.showLoading("Loading session...");try{await l.selectSession(_)}finally{i.hideLoading()}}}),ce(()=>{}),(_,d)=>(s(),o("div",cr,[a.value?(s(),o("div",dr,[d[0]||(d[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",ur,g(v.value),1)])):T("",!0),r.value?(s(),de(at,{key:1,"session-id":t.sessionId},null,8,["session-id"])):T("",!0),e("div",mr,[Q(sr)]),Q(ir),r.value?(s(),de(ut,{key:2,"session-id":t.sessionId},null,8,["session-id"])):T("",!0),r.value?(s(),de(yt,{key:3,"session-id":t.sessionId},null,8,["session-id"])):T("",!0)]))}},Ee=_e("legion",()=>{const n=L(new Map),t=L(new Map),l=L(new Map),i=L(new Map),r=L(null),a=u(()=>n.value.get(r.value)||[]),v=u(()=>t.value.get(r.value)||[]),_=u(()=>l.value.get(r.value)||[]),d=u(()=>i.value.get(r.value)||[]);function f(x){r.value=x}async function p(x,b=100,c=0){try{const O=await K.get(`/api/legions/${x}/timeline?limit=${b}&offset=${c}`),q=O.comms||[],C=O.total_count||q.length,P=O.has_more||!1;return q.sort((H,R)=>new Date(H.timestamp)-new Date(R.timestamp)),console.log(`Loaded ${q.length} of ${C} comms for legion ${x}`),n.value.set(x,q),n.value=new Map(n.value),{comms:q,totalCount:C,hasMore:P}}catch(O){throw console.error("Failed to load timeline:",O),O}}function y(x,b){n.value.has(x)||n.value.set(x,[]),n.value.get(x).push(b),n.value=new Map(n.value)}async function w(x,b){try{const O=(await K.post(`/api/legions/${x}/comms`,b)).comm;return console.log(`Sent comm ${O.comm_id} to legion ${x}`),O}catch(c){throw console.error("Failed to send comm:",c),c}}async function S(x){return console.log(`Minions for legion ${x} are already available in session store`),[]}async function E(x,b){try{const O=(await K.post(`/api/legions/${x}/minions`,b)).minion;return await S(x),console.log(`Created minion ${O.minion_id} in legion ${x}`),O}catch(c){throw console.error("Failed to create minion:",c),c}}async function k(x){try{const c=(await K.get(`/api/legions/${x}/hordes`)).hordes||[];return console.log(`Loaded ${c.length} hordes for legion ${x}`),l.value.set(x,c),l.value=new Map(l.value),c}catch(b){throw console.error("Failed to load hordes:",b),b}}async function $(x){try{const c=(await K.get(`/api/legions/${x}/channels`)).channels||[];return console.log(`Loaded ${c.length} channels for legion ${x}`),i.value.set(x,c),i.value=new Map(i.value),c}catch(b){throw console.error("Failed to load channels:",b),b}}function h(x){n.value.delete(x),t.value.delete(x),l.value.delete(x),i.value.delete(x),n.value=new Map(n.value),t.value=new Map(t.value),l.value=new Map(l.value),i.value=new Map(i.value)}return{commsByLegion:n,minionsByLegion:t,hordesByLegion:l,channelsByLegion:i,currentLegionId:r,currentComms:a,currentMinions:v,currentHordes:_,currentChannels:d,setCurrentLegion:f,loadTimeline:p,addComm:y,sendComm:w,loadMinions:S,createMinion:E,loadHordes:k,loadChannels:$,clearLegionData:h}}),pr=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:Ee},Symbol.toStringTag,{value:"Module"})),vr={class:"timeline-header border-bottom p-3"},fr={class:"project-name"},gr=["title"],_r={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(n){const t=n,l=le(),i=u(()=>l.projects.get(t.legionId)),r=u(()=>i.value?.name||"Legion");return(a,v)=>(s(),o("div",vr,[e("div",null,[e("div",fr,g(r.value),1),e("div",{class:"view-name",title:n.legionId},"Timeline",8,gr)])]))}},br=B(_r,[["__scopeId","data-v-44f386f5"]]),hr={class:"timeline-status-bar border-top p-2 bg-light"},yr={class:"d-flex justify-content-end"},$r={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(n){const t=te();function l(){t.setAutoScroll(!t.autoScrollEnabled)}return(i,r)=>(s(),o("div",hr,[e("div",yr,[e("button",{class:F(["btn btn-sm",we(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:l}," ⬇️ "+g(we(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},wr=B($r,[["__scopeId","data-v-891c73db"]]),Sr={class:"comm-composer border-top p-3"},kr={class:"d-flex gap-2 mb-2"},Cr={class:"flex-grow-1"},xr=["disabled"],Mr={label:"Minions"},jr=["value"],Tr={key:0,label:"Channels"},Er=["value"],Pr={style:{"min-width":"150px"}},Lr=["disabled"],Ir={class:"d-flex gap-2 align-items-end position-relative"},Dr={class:"flex-grow-1 position-relative"},Or=["disabled"],Nr=["onClick","onMouseenter"],Ar=["disabled"],Rr={key:0},qr={key:1},Ur={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(n){const t=n,l=Ee(),i=J(),r=le(),a=L(""),v=L("task"),_=L(""),d=L(!1),f=L(!1),p=L([]),y=L(0),w=L(-1),S=L(null),E=L(null),k=u(()=>{const R=r.projects.get(t.legionId);return!R||!R.session_ids?[]:R.session_ids.map(D=>i.sessions.get(D)).filter(D=>D&&D.is_minion)}),$=u(()=>l.currentChannels||[]),h=u(()=>a.value&&_.value.trim().length>0);function x(R){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[R.state]||"○"}function b(R){return R.is_minion&&R.role?`${R.name} (${R.role})`:R.name}function c(){const R=S.value;if(!R)return;R.style.height="auto";const D=Math.min(R.scrollHeight,parseInt(getComputedStyle(R).maxHeight));R.style.height=D+"px"}function O(){const R=S.value;if(!R)return;c();const D=_.value,m=R.selectionStart,j=D.substring(0,m),A=j.lastIndexOf("#");if(A===-1){f.value=!1;return}const N=j.substring(A+1).toLowerCase();if(N.includes(" ")){f.value=!1;return}const M=k.value.filter(I=>I.name.toLowerCase().includes(N)).map(I=>({type:"minion",name:I.name,role:I.role,id:I.session_id,state:I.state}));if(M.length===0){f.value=!1;return}p.value=M,y.value=0,w.value=A,f.value=!0}function q(){if(!E.value)return;const R=E.value,D=R.children[y.value];if(!D)return;const m=D.offsetTop,j=D.offsetHeight,A=R.scrollTop,N=R.clientHeight;m<A?R.scrollTop=m:m+j>A+N&&(R.scrollTop=m+j-N)}function C(R){if(!f.value){R.key==="Enter"&&!R.shiftKey&&h.value&&(R.preventDefault(),H());return}if(R.key==="ArrowDown")R.preventDefault(),y.value=(y.value+1)%p.value.length,q();else if(R.key==="ArrowUp")R.preventDefault(),y.value=y.value===0?p.value.length-1:y.value-1,q();else if(R.key==="Enter"){R.preventDefault();const D=p.value[y.value];D&&P(D)}else R.key==="Escape"&&(f.value=!1)}function P(R){const D=S.value;if(!D)return;const m=_.value,j=D.selectionStart,A=m.substring(0,w.value)+"#"+R.name+" "+m.substring(j);_.value=A;const N=w.value+R.name.length+2;setTimeout(()=>{D.setSelectionRange(N,N),D.focus()},0),f.value=!1}async function H(){if(!(!h.value||d.value)){d.value=!0;try{const[R,D]=a.value.split(":"),m={comm_type:v.value,content:_.value.trim()};R==="minion"?m.to_minion_id=D:R==="channel"&&(m.to_channel_id=D),await l.sendComm(t.legionId,m),_.value="",c()}catch(R){console.error("Failed to send comm:",R),alert(`Failed to send comm: ${R.message}`)}finally{d.value=!1}}}return se(f,R=>{if(R){const D=m=>{m.target.closest(".comm-composer")||(f.value=!1,document.removeEventListener("click",D))};setTimeout(()=>document.addEventListener("click",D),0)}}),(R,D)=>(s(),o("div",Sr,[e("div",kr,[e("div",Cr,[Y(e("select",{"onUpdate:modelValue":D[0]||(D[0]=m=>a.value=m),class:"form-select form-select-sm",disabled:d.value},[D[3]||(D[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",Mr,[(s(!0),o(Z,null,X(k.value,m=>(s(),o("option",{key:m.session_id,value:`minion:${m.session_id}`},g(x(m))+" "+g(b(m)),9,jr))),128))]),$.value.length>0?(s(),o("optgroup",Tr,[(s(!0),o(Z,null,X($.value,m=>(s(),o("option",{key:m.channel_id,value:`channel:${m.channel_id}`}," #️⃣ "+g(m.name),9,Er))),128))])):T("",!0)],8,xr),[[fe,a.value]])]),e("div",Pr,[Y(e("select",{"onUpdate:modelValue":D[1]||(D[1]=m=>v.value=m),class:"form-select form-select-sm",disabled:d.value},[...D[4]||(D[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,Lr),[[fe,v.value]])])]),e("div",Ir,[e("div",Dr,[Y(e("textarea",{ref_key:"contentTextarea",ref:S,"onUpdate:modelValue":D[2]||(D[2]=m=>_.value=m),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:d.value,onInput:O,onKeydown:C},null,40,Or),[[ne,_.value]]),f.value?(s(),o("div",{key:0,ref_key:"autocompleteDropdown",ref:E,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(s(!0),o(Z,null,X(p.value,(m,j)=>(s(),o("div",{key:m.id,class:F(["autocomplete-item px-2 py-1",{"bg-light":j===y.value}]),onClick:A=>P(m),onMouseenter:A=>y.value=j},g(m.type==="minion"?x(m):"#️⃣")+" "+g(m.name)+g(m.role?` (${m.role})`:""),43,Nr))),128))],512)):T("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!h.value||d.value,onClick:H},[d.value?(s(),o("span",Rr,[...D[5]||(D[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),G(" Sending... ",-1)])])):(s(),o("span",qr,"Send"))],8,Ar)])])]))}},Wr=B(Ur,[["__scopeId","data-v-ffa54193"]]),Hr={class:"timeline-view d-flex flex-column h-100"},Fr={key:0,class:"text-center text-muted"},Br={key:1,class:"text-center text-danger"},Vr={key:2,class:"text-center text-muted"},zr={key:3,class:"comm-list"},Gr={class:"col-auto message-speaker text-end pe-3"},Jr={class:"text-muted"},Kr={class:"col message-content-column"},Yr={class:"comm-card card"},Qr={class:"card-body p-2"},Zr={class:"d-flex justify-content-between align-items-start mb-1"},Xr={class:"ms-2"},ei={class:"comm-content"},ti={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(n){const t=n,l=Ee(),i=le(),r=J(),a=ge(),v=te(),_=L(!0),d=L(null),f=L(null),p=u(()=>i.projects.get(t.legionId));u(()=>p.value?.name||"Legion");const y=u(()=>l.currentComms);u(()=>l.currentMinions);function w(c){return c.from_user?"You":c.from_minion_id&&r.sessions.get(c.from_minion_id)?.name||"Unknown"}function S(c){return c.to_user?"You":c.to_minion_id?r.sessions.get(c.to_minion_id)?.name||"Unknown":c.to_channel_id?`#${c.to_channel_id}`:"All"}function E(c){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[c]||"bg-secondary"}function k(c){return new Date(c).toLocaleTimeString()}async function $(){v.autoScrollEnabled&&(await je(),f.value&&(f.value.scrollTop=f.value.scrollHeight))}async function h(){_.value=!0,d.value=null;try{l.setCurrentLegion(t.legionId),await Promise.all([l.loadTimeline(t.legionId),l.loadMinions(t.legionId)]),await je(),await $(),setTimeout(()=>{$()},100)}catch(c){console.error("Failed to load timeline:",c),c.response?d.value=`${c.message} (${c.response.status})`:d.value=c.message||"Unknown error"}finally{_.value=!1}}function x(){a.connectLegion(t.legionId)}function b(){a.disconnectLegion()}return se(()=>y.value.length,()=>{$()}),ie(()=>{h(),x(),setTimeout(()=>{$()},100)}),ce(()=>{b()}),(c,O)=>(s(),o("div",Hr,[Q(br,{"legion-id":n.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:f,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[_.value?(s(),o("div",Fr,[...O[0]||(O[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),G(" Loading timeline... ",-1)])])):d.value?(s(),o("div",Br," Failed to load timeline: "+g(d.value),1)):y.value.length===0?(s(),o("div",Vr," No messages yet. Minions will appear here once they start communicating. ")):(s(),o("div",zr,[(s(!0),o(Z,null,X(y.value,q=>(s(),o("div",{key:q.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",Gr,[e("small",Jr,g(k(q.timestamp)),1)]),e("div",Kr,[e("div",Yr,[e("div",Qr,[e("div",Zr,[e("div",null,[e("span",{class:F(["badge",E(q.comm_type)])},g(q.comm_type),3),e("strong",Xr,g(w(q)),1),O[1]||(O[1]=e("span",{class:"text-muted mx-1"},"→",-1)),e("strong",null,g(S(q)),1)])]),e("div",ei,g(q.content),1)])])])]))),128))]))],512),Q(Wr,{"legion-id":n.legionId},null,8,["legion-id"]),Q(wr,{"legion-id":n.legionId},null,8,["legion-id"])]))}},si=B(ti,[["__scopeId","data-v-d4c7422e"]]),oi={class:"spy-view d-flex flex-column overflow-hidden"},ni={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(n){return(t,l)=>(s(),o("div",oi,[Q(We,{"session-id":n.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},li=B(ni,[["__scopeId","data-v-43a24eaf"]]),ai={class:"horde-header border-bottom p-3"},ri={class:"project-name"},ii=["title"],ci={__name:"HordeHeader",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(n){const t=n,l=le(),i=J(),r=u(()=>l.projects.get(t.legionId)),a=u(()=>r.value?.name||"Legion"),v=u(()=>i.sessions.get(t.overseerId)),_=u(()=>v.value?.name||"Overseer");return(d,f)=>(s(),o("div",ai,[e("div",null,[e("div",ri,g(a.value),1),e("div",{class:"view-name",title:n.overseerId},g(_.value)+"'s Horde",9,ii)])]))}},di=B(ci,[["__scopeId","data-v-775da47d"]]),ui={class:"horde-status-bar border-top p-2 bg-light"},mi={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(n){return(t,l)=>(s(),o("div",ui,[...l[0]||(l[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},pi=B(mi,[["__scopeId","data-v-7f3c847f"]]),vi={class:"minion-card p-2 border-start border-2 mb-2"},fi={class:"d-flex align-items-center"},gi={class:"me-2"},_i={key:0,class:"me-2"},bi={key:1,class:"text-muted ms-2"},hi={key:2,class:"badge bg-secondary ms-2"},yi={class:"text-muted small ms-4"},$i={key:0,class:"minion-children"},wi={key:1,class:"text-danger small ms-4"},Si={__name:"MinionTreeNode",props:{minionId:{type:String,required:!0},level:{type:Number,default:0}},setup(n){const t=n,l=J(),i=u(()=>l.sessions.get(t.minionId)),r=u(()=>t.level*24),a=u(()=>{const f=i.value&&i.value.child_minion_ids&&i.value.child_minion_ids.length>0;return i.value&&i.value.child_minion_ids&&i.value.child_minion_ids.length>0&&console.log(`Minion ${i.value.name} has ${i.value.child_minion_ids.length} children:`,i.value.child_minion_ids),f}),v=u(()=>i.value&&i.value.is_overseer&&a.value),_={created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"},d=u(()=>_[i.value?.state]||"○");return(f,p)=>{const y=Ue("MinionTreeNode",!0);return i.value?(s(),o("div",{key:0,class:"minion-tree-node",style:me({marginLeft:`${r.value}px`})},[e("div",vi,[e("div",fi,[e("span",gi,g(d.value),1),v.value?(s(),o("span",_i,"👑")):T("",!0),e("strong",null,g(i.value.name),1),i.value.role?(s(),o("span",bi,g(i.value.role),1)):T("",!0),v.value?(s(),o("span",hi,g(i.value.child_minion_ids.length)+" "+g(i.value.child_minion_ids.length===1?"child":"children"),1)):T("",!0)]),e("div",yi," Level "+g(i.value.overseer_level||0)+" • "+g(i.value.state),1)]),a.value?(s(),o("div",$i,[(s(!0),o(Z,null,X(i.value.child_minion_ids,w=>(s(),de(y,{key:w,"minion-id":w,level:n.level+1},null,8,["minion-id","level"]))),128))])):T("",!0)],4)):t.minionId?(s(),o("div",wi," ⚠ Minion data not found for ID: "+g(t.minionId),1)):T("",!0)}}},ki=B(Si,[["__scopeId","data-v-120682eb"]]),Ci={class:"horde-view d-flex flex-column h-100"},xi={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},Mi={key:0,class:"alert alert-danger"},ji={key:1,class:"horde-tree"},Ti={__name:"HordeView",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=le(),r=u(()=>i.projects.get(t.legionId));u(()=>r.value?.name||"Legion");const a=u(()=>l.sessions.get(t.overseerId));return(v,_)=>(s(),o("div",Ci,[Q(di,{"legion-id":n.legionId,"overseer-id":n.overseerId},null,8,["legion-id","overseer-id"]),e("div",xi,[a.value?(s(),o("div",ji,[Q(ki,{"minion-id":n.overseerId,level:0},null,8,["minion-id"])])):(s(),o("div",Mi," Overseer not found "))]),Q(pi,{"legion-id":n.legionId,"overseer-id":n.overseerId},null,8,["legion-id","overseer-id"])]))}},Ei=B(Ti,[["__scopeId","data-v-b928719b"]]),Pi=[{path:"/",name:"home",component:Ke},{path:"/session/:sessionId",name:"session",component:We,props:!0},{path:"/timeline/:legionId",name:"timeline",component:si,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:li,props:!0},{path:"/horde/:legionId/:overseerId",name:"horde",component:Ei,props:!0}],Li=Fe({history:Be(),routes:Pi}),Ii={__name:"ConnectionIndicator",setup(n){const t=ge(),l=u(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),i=u(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(r,a)=>(s(),o("span",{id:"connection-indicator",class:F(["badge",l.value])},g(i.value),3))}},Di={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},Oi={class:"d-flex align-items-center gap-2"},Ni={__name:"AppHeader",setup(n){const t=te();function l(){t.toggleSidebar()}return(i,r)=>(s(),o("header",Di,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:l},[...r[0]||(r[0]=[e("span",null,"☰",-1)])]),r[1]||(r[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",Oi,[Q(Ii)])]))}},Ai={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},Ri={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},qi=["title"],Ui={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,l=u(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function i(_){return _.state==="paused"&&_.is_processing?"pending-prompt":_.is_processing?"processing":_.state}function r(_){const d=i(_);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[d]||"#d3d3d3"}function a(_){const d=i(_);return d==="starting"||d==="processing"||d==="pending-prompt"}function v(_){const d=i(_),f=d.charAt(0).toUpperCase()+d.slice(1),p=_.name||"Unnamed Session",y=_.is_minion&&_.role?` (${_.role})`:"";return`${p}${y}: ${f}`}return(_,d)=>(s(),o("div",Ai,[!n.sessions||n.sessions.length===0?(s(),o("div",Ri)):(s(!0),o(Z,{key:1},X(n.sessions,f=>(s(),o("div",{key:f.session_id,class:F(["progress-bar",{"progress-bar-striped progress-bar-animated":a(f)}]),style:me({width:l.value,backgroundColor:r(f),cursor:"help"}),title:v(f)},null,14,qi))),128))]))}},Wi=B(Ui,[["__scopeId","data-v-a79cfeec"]]),Hi={class:"flex-grow-1"},Fi={key:0,class:"text-muted small ms-1"},Bi={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(n){const t=n,l=pe(),i=J(),r=le(),a=te(),v=u(()=>i.currentSessionId===t.session.session_id),_=u(()=>i.deletingSessions.has(t.session.session_id)),d=u(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),f=u(()=>{const h=d.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[h]||"status-dot-grey"}),p=u(()=>{const h=d.value,x={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},b={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:x[h]||"#d3d3d3",borderColor:b[h]||"#6c757d"}});function y(){i.selectSession(t.session.session_id),l.push(`/session/${t.session.session_id}`)}function w(){a.showModal("edit-session",{session:t.session})}function S(h){h.dataTransfer.effectAllowed="move",h.dataTransfer.setData("application/session-id",t.session.session_id),h.dataTransfer.setData("application/project-id",t.projectId),h.dataTransfer.setData("text/plain",t.session.session_id),h.target.classList.add("dragging")}function E(h){h.target.classList.remove("dragging")}function k(h){h.preventDefault(),h.dataTransfer.dropEffect="move";const x=h.currentTarget.getBoundingClientRect(),b=x.top+x.height/2;h.clientY<b?(h.currentTarget.classList.add("drop-above"),h.currentTarget.classList.remove("drop-below")):(h.currentTarget.classList.add("drop-below"),h.currentTarget.classList.remove("drop-above"))}function $(h){h.preventDefault(),h.currentTarget.classList.remove("drop-above","drop-below");const x=h.dataTransfer.getData("application/session-id")||h.dataTransfer.getData("text/plain"),b=h.dataTransfer.getData("application/project-id");if(!x||x===t.session.session_id||b!==t.projectId)return;const c=h.currentTarget.getBoundingClientRect(),O=c.top+c.height/2,q=h.clientY<O,C=r.getProject(t.projectId);if(!C||!C.session_ids)return;const P=[...C.session_ids],H=P.indexOf(t.session.session_id),R=P.indexOf(x);if(H===-1||R===-1)return;const D=[...P],[m]=D.splice(R,1);let j=q?H:H+1;R<H&&j--,D.splice(j,0,m),r.reorderSessionsInProject(t.projectId,D)}return(h,x)=>(s(),o("div",{class:F(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:v.value,"session-deleting":_.value}]),style:{cursor:"pointer"},draggable:"true",onClick:y,onDragstart:S,onDragend:E,onDragover:k,onDrop:$},[e("div",{class:F(["status-dot me-2",f.value]),style:me(p.value)},null,6),e("div",Hi,[e("span",null,g(n.session.name||n.session.session_id),1),n.session.is_minion&&n.session.role?(s(),o("span",Fi,"("+g(n.session.role)+")",1)):T("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:re(w,["stop"])}," ✏️ ")],34))}},Vi=B(Bi,[["__scopeId","data-v-07ecbf94"]]),zi={class:"d-flex align-items-center gap-2"},Gi=["value"],Ji={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,l=pe(),i=J(),r=te(),a=L("");se(()=>l.currentRoute.value,k=>{!a.value&&k.name==="spy"&&k.params.minionId&&k.params.legionId===t.project.project_id&&(a.value=k.params.minionId)},{immediate:!0});const v=u(()=>a.value?t.sessions.find(k=>k.session_id===a.value):null),_=u(()=>{const k=l.currentRoute.value;return k.name==="spy"&&k.params.legionId===t.project.project_id}),d=u(()=>{if(!v.value)return"";if(v.value.state==="paused"&&v.value.is_processing)return"status-blinking";const k=v.value.is_processing?"processing":v.value.state;return k==="starting"||k==="processing"?"status-blinking":""}),f=u(()=>{if(!v.value)return{};if(v.value.state==="paused"&&v.value.is_processing)return{backgroundColor:"#ffc107"};const k=v.value.is_processing?"processing":v.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[k]||"#d3d3d3"}});function p(k){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[k.state]||"○"}function y(k){return k.is_minion&&k.role?`${k.name} (${k.role})`:k.name}function w(){a.value&&l.push(`/spy/${t.project.project_id}/${a.value}`)}function S(){a.value?l.push(`/spy/${t.project.project_id}/${a.value}`):l.push("/")}function E(){v.value&&r.showModal("minion-view",{session:v.value})}return se(()=>i.currentSessionId,k=>{if(k)t.sessions.some($=>$.session_id===k)&&(a.value=k);else{a.value="";const $=l.currentRoute.value;$.name==="spy"&&$.params.legionId===t.project.project_id&&l.push("/")}}),(k,$)=>(s(),o("div",{class:F(["list-group-item list-group-item-action p-2",{active:_.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:me({cursor:a.value?"pointer":"default"}),onClick:w},[$[1]||($[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🔍"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),e("div",zi,[v.value?(s(),o("button",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:re(E,["stop"]),title:"View minion details"}," 👁️ ")):T("",!0),v.value?(s(),o("span",{key:1,class:F(["minion-state-indicator",d.value]),style:me(f.value)}," 👤 ",6)):T("",!0)])],4),Y(e("select",{"onUpdate:modelValue":$[0]||($[0]=h=>a.value=h),class:"form-select form-select-sm",onChange:S},[$[2]||($[2]=e("option",{value:""},"-- Select Minion --",-1)),(s(!0),o(Z,null,X(n.sessions,h=>(s(),o("option",{key:h.session_id,value:h.session_id},g(p(h))+" "+g(y(h)),9,Gi))),128))],544),[[fe,a.value]])],2))}},Ki=B(Ji,[["__scopeId","data-v-579589fb"]]),Yi=["value"],Qi={__name:"HordeSelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,l=pe(),i=L("");se(()=>l.currentRoute.value,f=>{!i.value&&f.name==="horde"&&f.params.overseerId&&f.params.legionId===t.project.project_id&&(i.value=f.params.overseerId)},{immediate:!0});const r=u(()=>t.sessions.filter(f=>f.is_overseer===!0)),a=u(()=>{const f=l.currentRoute.value;return f.name==="horde"&&f.params.legionId===t.project.project_id});function v(f){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[f.state]||"○"}function _(){i.value&&l.push(`/horde/${t.project.project_id}/${i.value}`)}function d(){i.value&&l.push(`/horde/${t.project.project_id}/${i.value}`)}return(f,p)=>(s(),o("div",{class:F(["list-group-item list-group-item-action p-2",{active:a.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:me({cursor:i.value?"pointer":"default"}),onClick:_},[...p[1]||(p[1]=[e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🌳"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],4),Y(e("select",{"onUpdate:modelValue":p[0]||(p[0]=y=>i.value=y),class:"form-select form-select-sm",onChange:d},[p[2]||(p[2]=e("option",{value:""},"-- Select Overseer --",-1)),(s(!0),o(Z,null,X(r.value,y=>(s(),o("option",{key:y.session_id,value:y.session_id},g(v(y))+" "+g(y.name),9,Yi))),128))],544),[[fe,i.value]])],2))}},Zi=B(Qi,[["__scopeId","data-v-ca33279d"]]),Xi=["data-project-id"],ec=["id"],tc=["aria-expanded","aria-controls","onKeydown"],sc={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},oc={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},nc={class:"fw-semibold",style:{"flex-shrink":"0"}},lc={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},ac={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},rc=["title"],ic=["title"],cc=["id","aria-labelledby"],dc={class:"accordion-body p-0"},uc={class:"list-group list-group-flush"},mc={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(n){const t=n,l=pe(),i=le(),r=J(),a=te(),v=L(t.project.is_expanded||!1),_=u(()=>i.formatPath(t.project.working_directory)),d=u(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(c=>r.getSession(c)).filter(c=>c!=null)),f=u(()=>{const c=l.currentRoute.value;return c.name==="timeline"&&c.params.legionId===t.project.project_id});function p(c){const O=window.bootstrap;if(!O)return;const q=document.getElementById(`collapse-${t.project.project_id}`);if(!q)return;O.Collapse.getOrCreateInstance(q).toggle()}function y(){v.value||(i.toggleExpansion(t.project.project_id),v.value=!0)}function w(){if(v.value){i.toggleExpansion(t.project.project_id),v.value=!1;const c=r.currentSessionId;c&&r.getSession(c)&&t.project.session_ids?.includes(c)&&l.push("/"),i.currentProjectId===t.project.project_id&&l.push("/")}}function S(){a.showModal("edit-project",{project:t.project})}function E(){t.project.is_multi_agent?a.showModal("create-minion",{project:t.project}):a.showModal("create-session",{project:t.project})}function k(){l.push(`/timeline/${t.project.project_id}`)}function $(c){c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("application/project-id",t.project.project_id),c.dataTransfer.setData("text/plain",t.project.project_id),c.target.classList.add("dragging")}function h(c){c.target.classList.remove("dragging")}function x(c){c.preventDefault(),c.dataTransfer.dropEffect="move";const O=c.currentTarget.getBoundingClientRect(),q=O.top+O.height/2;c.clientY<q?(c.currentTarget.classList.add("drop-above"),c.currentTarget.classList.remove("drop-below")):(c.currentTarget.classList.add("drop-below"),c.currentTarget.classList.remove("drop-above"))}function b(c){c.preventDefault(),c.currentTarget.classList.remove("drop-above","drop-below");const O=c.dataTransfer.getData("application/project-id")||c.dataTransfer.getData("text/plain");if(!O||O===t.project.project_id)return;const q=c.currentTarget.getBoundingClientRect(),C=q.top+q.height/2,P=c.clientY<C,H=i.orderedProjects,R=H.findIndex(M=>M.project_id===t.project.project_id),D=H.findIndex(M=>M.project_id===O);if(R===-1||D===-1)return;const m=[...H],[j]=m.splice(D,1);let A=P?R:R+1;D<R&&A--,m.splice(A,0,j);const N=m.map(M=>M.project_id);i.reorderProjects(N)}return(c,O)=>(s(),o("div",{class:"accordion-item border rounded mb-2","data-project-id":n.project.project_id,draggable:"true",onDragstart:$,onDragend:h,onDragover:x,onDrop:b},[e("h2",{class:"accordion-header",id:`heading-${n.project.project_id}`},[e("div",{class:F(["accordion-button bg-white p-2",{collapsed:!v.value}]),role:"button",tabindex:"0","aria-expanded":v.value,"aria-controls":`collapse-${n.project.project_id}`,onClick:p,onKeydown:[Se(re(p,["prevent"]),["enter"]),Se(re(p,["prevent"]),["space"])]},[e("div",sc,[e("div",oc,[e("div",nc,[n.project.is_multi_agent?(s(),o("span",lc,"🏛")):T("",!0),G(" "+g(n.project.name),1)]),e("div",ac,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:re(S,["stop"])}," ✏️ "),e("button",{class:"btn btn-sm btn-outline-primary",title:n.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:re(E,["stop"])}," ➕ ",8,rc)])]),e("small",{class:"text-muted font-monospace",title:n.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},g(_.value),9,ic)])],42,tc)],8,ec),Q(Wi,{project:n.project,sessions:d.value},null,8,["project","sessions"]),e("div",{id:`collapse-${n.project.project_id}`,class:F(["accordion-collapse collapse",{show:v.value}]),"aria-labelledby":`heading-${n.project.project_id}`,onShown:y,onHidden:w},[e("div",dc,[e("div",uc,[n.project.is_multi_agent?(s(),o("div",{key:0,class:F(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:f.value}]),style:{cursor:"pointer"},onClick:k},[...O[0]||(O[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"📊"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):T("",!0),n.project.is_multi_agent?(s(),o(Z,{key:1},[Q(Ki,{project:n.project,sessions:d.value},null,8,["project","sessions"]),Q(Zi,{project:n.project,sessions:d.value},null,8,["project","sessions"])],64)):(s(!0),o(Z,{key:2},X(d.value,q=>(s(),de(Vi,{key:q.session_id,session:q,"project-id":n.project.project_id},null,8,["session","project-id"]))),128))])])],42,cc)],40,Xi))}},pc=B(mc,[["__scopeId","data-v-f7cce2fb"]]),vc={class:"project-list"},fc={key:0,class:"text-muted text-center py-3"},gc={__name:"ProjectList",setup(n){const t=le(),l=u(()=>t.orderedProjects);return(i,r)=>(s(),o("div",vc,[l.value.length===0?(s(),o("div",fc,' No projects yet. Click "New" to create one. ')):T("",!0),(s(!0),o(Z,null,X(l.value,a=>(s(),de(pc,{key:a.project_id,project:a},null,8,["project"]))),128))]))}},_c={class:"flex-grow-1 overflow-auto p-3"},bc={id:"sessions-container"},hc={__name:"Sidebar",setup(n){const t=te(),l=u(()=>t.sidebarCollapsed),i=u(()=>t.isMobile),r=u(()=>{if(i.value)return{};const p=`${t.sidebarWidth}px`;return{width:p,minWidth:"200px",maxWidth:"30vw","--sidebar-width":p}});function a(){t.showModal("create-project")}const v=L(!1);function _(p){v.value=!0,document.addEventListener("mousemove",d),document.addEventListener("mouseup",f)}function d(p){v.value&&t.setSidebarWidth(p.clientX)}function f(){v.value=!1,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",f)}return(p,y)=>(s(),o("aside",{id:"sidebar",class:F(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:l.value,"mobile-open":!l.value&&i.value,"desktop-collapsed":l.value&&!i.value}]),style:me(r.value)},[e("div",_c,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[y[0]||(y[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:a}," 📁 New ")]),e("div",bc,[Q(gc)])]),e("div",{class:"sidebar-resize-handle",onMousedown:_},null,32)],6))}},yc=B(hc,[["__scopeId","data-v-d792f0f0"]]),$c={class:"modal-dialog modal-lg"},wc={class:"modal-content"},Sc={class:"modal-body"},kc={class:"mb-3"},Cc={class:"input-group"},xc=["disabled"],Mc={key:0,class:"text-center py-4"},jc={key:1,class:"alert alert-danger",role:"alert"},Tc={key:2,class:"folder-list"},Ec=["onClick","onDblclick"],Pc={class:"d-flex align-items-center flex-grow-1"},Lc=["onClick"],Ic={key:1,class:"text-center text-muted py-3"},Dc={class:"modal-footer"},Oc=["disabled"],Nc={__name:"FolderBrowserModal",setup(n){const t=te(),l=L(""),i=L(""),r=L([]),a=L(!1),v=L(""),_=L(null);let d=null,f=null;const p=u(()=>{if(!l.value)return null;const b=l.value.split(/[\\/]/).filter(Boolean);return b.length<=1?null:(b.pop(),b.length>0?b.join("/"):"/")});function y(b){if(!b)return"";const c=b.split(/[\\/]/).filter(Boolean);return c.length<=2?b:".../"+c.slice(-2).join("/")}async function w(){a.value=!0,v.value="",r.value=[],i.value="";try{const b=l.value?{path:l.value}:{},c=await K.get("/api/filesystem/browse",{params:b});c.current_path&&(l.value=c.current_path),r.value=c.directories||[]}catch(b){console.error("Failed to load directory:",b),v.value=b.message||"Failed to load directory"}finally{a.value=!1}}function S(b){i.value=b.path}function E(b){l.value=b.path,i.value="",w()}function k(){p.value&&(l.value=p.value,i.value="",w())}function $(){const b=i.value||l.value;b&&f&&f(b),d&&d.hide()}function h(){w()}function x(){r.value=[],i.value="",v.value="",f=null,t.hideModal()}return se(()=>t.currentModal,b=>{if(b?.name==="folder-browser"&&d){const c=b.data||{};l.value=c.currentPath||"",f=c.onSelect||null,d.show()}}),ie(()=>{_.value&&ae(async()=>{const{default:b}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:b}},__vite__mapDeps([0,1])).then(({default:b})=>{d=new b(_.value),_.value.addEventListener("shown.bs.modal",h),_.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{_.value&&(_.value.removeEventListener("shown.bs.modal",h),_.value.removeEventListener("hidden.bs.modal",x)),d&&d.dispose()}),(b,c)=>(s(),o("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:_},[e("div",$c,[e("div",wc,[c[7]||(c[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Sc,[e("div",kc,[c[2]||(c[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",Cc,[Y(e("input",{type:"text",class:"form-control","onUpdate:modelValue":c[0]||(c[0]=O=>l.value=O),onKeyup:Se(w,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[ne,l.value]]),e("button",{class:"btn btn-outline-secondary",onClick:w,disabled:a.value},[...c[1]||(c[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),G(" Refresh ",-1)])],8,xc)])]),a.value?(s(),o("div",Mc,[...c[3]||(c[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):v.value?(s(),o("div",jc,g(v.value),1)):(s(),o("div",Tc,[p.value?(s(),o("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:k,role:"button"},[...c[4]||(c[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):T("",!0),(s(!0),o(Z,null,X(r.value,O=>(s(),o("div",{key:O.path,class:F(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:O.path===i.value}]),onClick:q=>S(O),onDblclick:q=>E(O),role:"button"},[e("div",Pc,[c[5]||(c[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,g(O.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:re(q=>E(O),["stop"])}," Open ",8,Lc)],42,Ec))),128)),r.value.length===0?(s(),o("div",Ic," No subdirectories found ")):T("",!0)]))]),e("div",Dc,[c[6]||(c[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:$,disabled:!i.value},' Select "'+g(y(i.value||l.value))+'" ',9,Oc)])])])],512))}},Ac=B(Nc,[["__scopeId","data-v-667c51a9"]]),Rc={class:"modal-dialog"},qc={class:"modal-content"},Uc={class:"modal-body"},Wc={class:"mb-3"},Hc={key:0,class:"invalid-feedback"},Fc={class:"mb-3"},Bc={class:"input-group"},Vc={key:0,class:"invalid-feedback"},zc={class:"mb-3 form-check"},Gc={class:"mb-3 form-check"},Jc={class:"form-check-label",for:"createSession"},Kc={key:0,class:"mb-3 ms-4"},Yc={for:"sessionName",class:"form-label"},Qc={key:1,class:"alert alert-danger",role:"alert"},Zc={class:"modal-footer"},Xc=["disabled"],ed={key:0,class:"spinner-border spinner-border-sm me-2"},td={__name:"ProjectCreateModal",setup(n){const t=le(),l=J(),i=te(),r=L({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),a=L({name:"",workingDirectory:""}),v=L(!1),_=L(""),d=L(null);let f=null;function p(){i.showModal("folder-browser",{currentPath:r.value.workingDirectory||"",onSelect:$=>{r.value.workingDirectory=$,a.value.workingDirectory=""}})}function y(){a.value={};let $=!0;return r.value.name.trim()||(a.value.name="Project name is required",$=!1),r.value.workingDirectory.trim()||(a.value.workingDirectory="Working directory is required",$=!1),$}async function w(){if(y()){v.value=!0,_.value="";try{const $=await t.createProject(r.value.name,r.value.workingDirectory,r.value.isMultiAgent);r.value.createSession&&await l.createSession($.project_id,{name:r.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),f&&f.hide(),S()}catch($){console.error("Failed to create project:",$),_.value=$.message||"Failed to create project. Please try again."}finally{v.value=!1}}}function S(){r.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},a.value={},_.value=""}function E(){const $=document.getElementById("projectName");$&&$.focus()}function k(){S(),i.hideModal()}return se(()=>i.currentModal,$=>{$?.name==="create-project"&&f&&f.show()}),ie(()=>{d.value&&ae(async()=>{const{default:$}=await import("./modal-B4rHLo2F.js").then(h=>h.m);return{default:$}},__vite__mapDeps([0,1])).then(({default:$})=>{f=new $(d.value),d.value.addEventListener("shown.bs.modal",E),d.value.addEventListener("hidden.bs.modal",k)})}),ce(()=>{d.value&&(d.value.removeEventListener("shown.bs.modal",E),d.value.removeEventListener("hidden.bs.modal",k)),f&&f.dispose()}),($,h)=>(s(),o("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:d},[e("div",Rc,[e("div",qc,[h[11]||(h[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Uc,[e("form",{onSubmit:re(w,["prevent"])},[e("div",Wc,[h[5]||(h[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),Y(e("input",{type:"text",class:F(["form-control",{"is-invalid":a.value.name}]),id:"projectName","onUpdate:modelValue":h[0]||(h[0]=x=>r.value.name=x),placeholder:"My Project",required:""},null,2),[[ne,r.value.name]]),a.value.name?(s(),o("div",Hc,g(a.value.name),1)):T("",!0)]),e("div",Fc,[h[6]||(h[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",Bc,[Y(e("input",{type:"text",class:F(["form-control",{"is-invalid":a.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":h[1]||(h[1]=x=>r.value.workingDirectory=x),placeholder:"/path/to/project",required:""},null,2),[[ne,r.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:p}," Browse... "),a.value.workingDirectory?(s(),o("div",Vc,g(a.value.workingDirectory),1)):T("",!0)]),h[7]||(h[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",zc,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":h[2]||(h[2]=x=>r.value.isMultiAgent=x)},null,512),[[be,r.value.isMultiAgent]]),h[8]||(h[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," 🏛 Multi-Agent Project (Legion) ",-1)),h[9]||(h[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",Gc,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":h[3]||(h[3]=x=>r.value.createSession=x)},null,512),[[be,r.value.createSession]]),e("label",Jc," Create initial "+g(r.value.isMultiAgent?"minion":"session"),1)]),r.value.createSession?(s(),o("div",Kc,[e("label",Yc," Initial "+g(r.value.isMultiAgent?"Minion":"Session")+" Name ",1),Y(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":h[4]||(h[4]=x=>r.value.sessionName=x),placeholder:"main"},null,512),[[ne,r.value.sessionName]])])):T("",!0),_.value?(s(),o("div",Qc,g(_.value),1)):T("",!0)],32)]),e("div",Zc,[h[10]||(h[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:w,disabled:v.value},[v.value?(s(),o("span",ed)):T("",!0),G(" "+g(v.value?"Creating...":"Create Project"),1)],8,Xc)])])])],512))}},sd=B(td,[["__scopeId","data-v-adf50394"]]),od={class:"modal-dialog"},nd={class:"modal-content"},ld={class:"modal-body"},ad={class:"mb-3"},rd={key:0,class:"invalid-feedback"},id={class:"mb-3"},cd=["value"],dd={key:0,class:"alert alert-danger",role:"alert"},ud={class:"danger-zone"},md={class:"text-muted small"},pd=["disabled"],vd={key:0,class:"alert alert-warning mt-3",role:"alert"},fd={class:"mb-2"},gd={class:"d-flex gap-2"},_d=["disabled"],bd={key:0,class:"spinner-border spinner-border-sm me-2"},hd=["disabled"],yd={class:"modal-footer"},$d=["disabled"],wd={key:0,class:"spinner-border spinner-border-sm me-2"},Sd={__name:"ProjectEditModal",setup(n){const t=le(),l=te(),i=L(null),r=L({name:""}),a=L({name:""}),v=L(!1),_=L(!1),d=L(""),f=L(!1),p=L(null);let y=null;const w=u(()=>i.value?.session_ids?.length||0);function S(){a.value={};let b=!0;return r.value.name.trim()||(a.value.name="Project name is required",b=!1),b}async function E(){if(!(!S()||!i.value)){v.value=!0,d.value="";try{await t.updateProject(i.value.project_id,{name:r.value.name}),y&&y.hide()}catch(b){console.error("Failed to update project:",b),d.value=b.message||"Failed to update project. Please try again."}finally{v.value=!1}}}async function k(){if(i.value){_.value=!0,d.value="";try{await t.deleteProject(i.value.project_id),y&&y.hide()}catch(b){console.error("Failed to delete project:",b),d.value=b.message||"Failed to delete project. Please try again."}finally{_.value=!1}}}function $(){r.value={name:""},a.value={},d.value="",f.value=!1}function h(){const b=document.getElementById("editProjectName");b&&(b.focus(),b.select())}function x(){$(),i.value=null,l.hideModal()}return se(()=>l.currentModal,b=>{if(b?.name==="edit-project"&&y){const c=b.data||{};i.value=c.project,i.value&&(r.value.name=i.value.name),y.show()}}),ie(()=>{p.value&&ae(async()=>{const{default:b}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:b}},__vite__mapDeps([0,1])).then(({default:b})=>{y=new b(p.value),p.value.addEventListener("shown.bs.modal",h),p.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{p.value&&(p.value.removeEventListener("shown.bs.modal",h),p.value.removeEventListener("hidden.bs.modal",x)),y&&y.dispose()}),(b,c)=>(s(),o("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:p},[e("div",od,[e("div",nd,[c[11]||(c[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",ld,[e("form",{onSubmit:re(E,["prevent"])},[e("div",ad,[c[3]||(c[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),Y(e("input",{type:"text",class:F(["form-control",{"is-invalid":a.value.name}]),id:"editProjectName","onUpdate:modelValue":c[0]||(c[0]=O=>r.value.name=O),placeholder:"My Project",required:""},null,2),[[ne,r.value.name]]),a.value.name?(s(),o("div",rd,g(a.value.name),1)):T("",!0)]),e("div",id,[c[4]||(c[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:i.value?.working_directory,disabled:"",readonly:""},null,8,cd),c[5]||(c[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),d.value?(s(),o("div",dd,g(d.value),1)):T("",!0)],32),c[9]||(c[9]=e("hr",null,null,-1)),e("div",ud,[c[7]||(c[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",md," Deleting this project will also delete all "+g(w.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:c[1]||(c[1]=O=>f.value=!0),disabled:_.value},[...c[6]||(c[6]=[e("i",{class:"bi bi-trash"},null,-1),G(" Delete Project ",-1)])],8,pd)]),f.value?(s(),o("div",vd,[c[8]||(c[8]=e("strong",null,"Are you sure?",-1)),e("p",fd,' This will permanently delete the project "'+g(i.value?.name)+'" and all '+g(w.value)+" session(s). ",1),e("div",gd,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:k,disabled:_.value},[_.value?(s(),o("span",bd)):T("",!0),G(" "+g(_.value?"Deleting...":"Yes, Delete Permanently"),1)],8,_d),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:c[2]||(c[2]=O=>f.value=!1),disabled:_.value}," Cancel ",8,hd)])])):T("",!0)]),e("div",yd,[c[10]||(c[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:E,disabled:v.value},[v.value?(s(),o("span",wd)):T("",!0),G(" "+g(v.value?"Saving...":"Save Changes"),1)],8,$d)])])])],512))}},kd=B(Sd,[["__scopeId","data-v-6f299f35"]]),Cd={class:"modal-dialog modal-lg"},xd={class:"modal-content"},Md={class:"modal-header"},jd={class:"modal-title",id:"createSessionModalLabel"},Td={key:0,class:"text-muted small"},Ed={class:"modal-body"},Pd={class:"mb-3"},Ld={key:0,class:"invalid-feedback"},Id={class:"mb-3"},Dd={class:"mb-3"},Od={class:"mb-3"},Nd={class:"form-text d-flex justify-content-between"},Ad={key:0,class:"invalid-feedback"},Rd={class:"mb-3 form-check"},qd={key:0,class:"form-text text-warning"},Ud={class:"mb-3"},Wd={class:"mb-3 form-check"},Hd={key:0,class:"alert alert-danger",role:"alert"},Fd={class:"modal-footer"},Bd=["disabled"],Vd={key:0,class:"spinner-border spinner-border-sm me-2"},zd={__name:"SessionCreateModal",setup(n){const t=pe();le();const l=J(),i=te(),r=L(null),a=L({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0}),v=L({name:""}),_=L(!1),d=L(""),f=L(null);let p=null;const y=u(()=>a.value.system_prompt.length),w=u(()=>y.value>6e3),S=u(()=>y.value>5500&&y.value<=6e3);function E(){v.value={};let b=!0;return a.value.name.trim()||(v.value.name="Session name is required",b=!1),w.value&&(b=!1),b}async function k(){if(!(!E()||!r.value)){_.value=!0,d.value="";try{const b=a.value.tools.split(",").map(q=>q.trim()).filter(q=>q.length>0),c={name:a.value.name,permission_mode:a.value.permission_mode,model:a.value.model,system_prompt:a.value.system_prompt.trim()||null,override_system_prompt:a.value.override_system_prompt,tools:b},O=await l.createSession(r.value.project_id,c);a.value.startImmediately&&await l.startSession(O.session_id),t.push(`/session/${O.session_id}`),p&&p.hide(),$()}catch(b){console.error("Failed to create session:",b),d.value=b.message||"Failed to create session. Please try again."}finally{_.value=!1}}}function $(){a.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0},v.value={},d.value=""}function h(){const b=document.getElementById("sessionName");b&&b.focus()}function x(){$(),r.value=null,i.hideModal()}return se(()=>i.currentModal,b=>{if(b?.name==="create-session"&&p){const c=b.data||{};r.value=c.project,p.show()}}),ie(()=>{f.value&&ae(async()=>{const{default:b}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:b}},__vite__mapDeps([0,1])).then(({default:b})=>{p=new b(f.value),f.value.addEventListener("shown.bs.modal",h),f.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{f.value&&(f.value.removeEventListener("shown.bs.modal",h),f.value.removeEventListener("hidden.bs.modal",x)),p&&p.dispose()}),(b,c)=>(s(),o("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:f},[e("div",Cd,[e("div",xd,[e("div",Md,[e("h5",jd,[c[7]||(c[7]=G(" Create New Session ",-1)),r.value?(s(),o("span",Td,"in "+g(r.value.name),1)):T("",!0)]),c[8]||(c[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Ed,[e("form",{onSubmit:re(k,["prevent"])},[e("div",Pd,[c[9]||(c[9]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),Y(e("input",{type:"text",class:F(["form-control",{"is-invalid":v.value.name}]),id:"sessionName","onUpdate:modelValue":c[0]||(c[0]=O=>a.value.name=O),placeholder:"main",required:""},null,2),[[ne,a.value.name]]),v.value.name?(s(),o("div",Ld,g(v.value.name),1)):T("",!0)]),e("div",Id,[c[11]||(c[11]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Y(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":c[1]||(c[1]=O=>a.value.permission_mode=O)},[...c[10]||(c[10]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"⚠️ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[fe,a.value.permission_mode]]),c[12]||(c[12]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",Dd,[c[14]||(c[14]=e("label",{for:"model",class:"form-label"},"Model",-1)),Y(e("select",{class:"form-select",id:"model","onUpdate:modelValue":c[2]||(c[2]=O=>a.value.model=O)},[...c[13]||(c[13]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[fe,a.value.model]])]),e("div",Od,[c[15]||(c[15]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),Y(e("textarea",{class:F(["form-control",{"is-invalid":w.value}]),id:"systemPrompt","onUpdate:modelValue":c[3]||(c[3]=O=>a.value.system_prompt=O),rows:"3",maxlength:6e3,placeholder:"Additional instructions to append to the system prompt..."},null,2),[[ne,a.value.system_prompt]]),e("div",Nd,[e("span",null,g(a.value.override_system_prompt?"These instructions will replace Claude Code's default system prompt":"These instructions will be appended to Claude Code's default system prompt"),1),e("span",{class:F({"text-danger":w.value,"text-warning":S.value})},g(y.value)+" / 6000 chars ",3)]),w.value?(s(),o("div",Ad," System prompt exceeds 6000 character limit (Windows command-line constraint) ")):T("",!0)]),e("div",Rd,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":c[4]||(c[4]=O=>a.value.override_system_prompt=O)},null,512),[[be,a.value.override_system_prompt]]),c[17]||(c[17]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom prompt only) ",-1)),a.value.override_system_prompt?(s(),o("div",qd,[...c[16]||(c[16]=[e("small",null,"⚠️ Override mode may cause unexpected behaviors. Only custom instructions will be used (no Claude Code preset).",-1)])])):T("",!0)]),e("div",Ud,[c[18]||(c[18]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),Y(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":c[5]||(c[5]=O=>a.value.tools=O),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[ne,a.value.tools]]),c[19]||(c[19]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",Wd,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":c[6]||(c[6]=O=>a.value.startImmediately=O)},null,512),[[be,a.value.startImmediately]]),c[20]||(c[20]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),d.value?(s(),o("div",Hd,g(d.value),1)):T("",!0)],32)]),e("div",Fd,[c[21]||(c[21]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:k,disabled:_.value},[_.value?(s(),o("span",Vd)):T("",!0),G(" "+g(_.value?"Creating...":"Create Session"),1)],8,Bd)])])])],512))}},Gd=B(zd,[["__scopeId","data-v-5aef47e0"]]),Jd={class:"modal-dialog"},Kd={class:"modal-content"},Yd={class:"modal-body"},Qd={class:"mb-3"},Zd={key:0,class:"invalid-feedback"},Xd={class:"mb-3"},eu=["value"],tu={class:"mb-3"},su={class:"form-control-plaintext"},ou={class:"mb-3"},nu=["disabled"],lu={key:0,value:"bypassPermissions"},au={class:"form-text"},ru={key:0,class:"text-warning"},iu={key:1},cu={key:0,class:"mb-3"},du={class:"card"},uu={class:"card-body"},mu={key:0,class:"mb-2"},pu={key:1,class:"mb-2"},vu={key:2,class:"mt-2"},fu={class:"form-control",style:{height:"auto","min-height":"60px","white-space":"pre-wrap"},readonly:""},gu={key:1,class:"alert alert-danger",role:"alert"},_u={class:"modal-footer"},bu=["disabled"],hu={key:0,class:"spinner-border spinner-border-sm me-2"},yu={__name:"SessionEditModal",setup(n){const t=J(),l=te(),i=L(null),r=L({name:"",permission_mode:"default"}),a=L({name:""}),v=L(!1),_=L(""),d=L(null);let f=null;const p=u(()=>i.value?.state==="active"||i.value?.state==="starting"),y=u(()=>i.value?.initial_permission_mode==="bypassPermissions");function w(x){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[x]||"bg-secondary"}function S(){a.value={};let x=!0;return r.value.name.trim()||(a.value.name="Session name is required",x=!1),x}async function E(){if(!(!S()||!i.value)){v.value=!0,_.value="";try{await t.updateSessionName(i.value.session_id,r.value.name),r.value.permission_mode!==i.value.current_permission_mode&&await t.setPermissionMode(i.value.session_id,r.value.permission_mode),f&&f.hide()}catch(x){console.error("Failed to update session:",x),_.value=x.message||"Failed to update session. Please try again."}finally{v.value=!1}}}function k(){r.value={name:"",permission_mode:"default"},a.value={},_.value=""}function $(){const x=document.getElementById("editSessionName");x&&(x.focus(),x.select())}function h(){k(),i.value=null,l.hideModal()}return se(()=>l.currentModal,x=>{if(x?.name==="edit-session"&&f){const b=x.data||{};i.value=b.session,i.value&&(r.value.name=i.value.name,r.value.permission_mode=i.value.current_permission_mode||"default"),f.show()}}),ie(()=>{d.value&&ae(async()=>{const{default:x}=await import("./modal-B4rHLo2F.js").then(b=>b.m);return{default:x}},__vite__mapDeps([0,1])).then(({default:x})=>{f=new x(d.value),d.value.addEventListener("shown.bs.modal",$),d.value.addEventListener("hidden.bs.modal",h)})}),ce(()=>{d.value&&(d.value.removeEventListener("shown.bs.modal",$),d.value.removeEventListener("hidden.bs.modal",h)),f&&f.dispose()}),(x,b)=>(s(),o("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:d},[e("div",Jd,[e("div",Kd,[b[15]||(b[15]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Yd,[e("form",{onSubmit:re(E,["prevent"])},[e("div",Qd,[b[2]||(b[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),Y(e("input",{type:"text",class:F(["form-control",{"is-invalid":a.value.name}]),id:"editSessionName","onUpdate:modelValue":b[0]||(b[0]=c=>r.value.name=c),placeholder:"Session Name",required:""},null,2),[[ne,r.value.name]]),a.value.name?(s(),o("div",Zd,g(a.value.name),1)):T("",!0)]),e("div",Xd,[b[3]||(b[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:i.value?.working_directory,disabled:"",readonly:""},null,8,eu),b[4]||(b[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",tu,[b[5]||(b[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",su,[e("span",{class:F(["badge",w(i.value?.state)])},g(i.value?.state),3)])]),e("div",ou,[b[9]||(b[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Y(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":b[1]||(b[1]=c=>r.value.permission_mode=c),disabled:!p.value},[b[6]||(b[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),b[7]||(b[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),b[8]||(b[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),y.value?(s(),o("option",lu,"⚠️ Bypass Permissions (No prompts)")):T("",!0)],8,nu),[[fe,r.value.permission_mode]]),e("div",au,[p.value?(s(),o("span",iu," Controls which tool actions require permission prompts ")):(s(),o("span",ru," ⚠️ Session must be active to change permission mode. Start the session first. "))])]),i.value?.system_prompt||i.value?.override_system_prompt?(s(),o("div",cu,[b[13]||(b[13]=e("label",{class:"form-label"},"System Prompt Configuration",-1)),e("div",du,[e("div",uu,[i.value?.override_system_prompt?(s(),o("div",mu,[...b[10]||(b[10]=[e("span",{class:"badge bg-warning text-dark"},"Override Mode",-1),e("div",{class:"form-text text-warning mt-1"}," Using custom prompt only (no Claude Code preset) ",-1)])])):(s(),o("div",pu,[...b[11]||(b[11]=[e("span",{class:"badge bg-info"},"Append Mode",-1),e("div",{class:"form-text mt-1"}," Custom instructions appended to Claude Code preset ",-1)])])),i.value?.system_prompt?(s(),o("div",vu,[b[12]||(b[12]=e("strong",{class:"small"},"Custom Instructions:",-1)),e("div",fu,g(i.value.system_prompt),1)])):T("",!0)])])])):T("",!0),_.value?(s(),o("div",gu,g(_.value),1)):T("",!0)],32)]),e("div",_u,[b[14]||(b[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:E,disabled:v.value},[v.value?(s(),o("span",hu)):T("",!0),G(" "+g(v.value?"Saving...":"Save Changes"),1)],8,bu)])])])],512))}},$u=B(yu,[["__scopeId","data-v-c99ca17f"]]),wu={class:"modal-dialog modal-dialog-centered"},Su={class:"modal-content"},ku={class:"modal-header"},Cu={class:"modal-title",id:"manageSessionModalLabel"},xu={class:"modal-body"},Mu={key:0,class:"text-center py-4"},ju={class:"text-muted"},Tu={key:1},Eu={key:2},Pu={class:"text-muted"},Lu={key:3},Iu={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Du={class:"d-grid gap-2"},Ou=["disabled"],Nu=["disabled"],Au=["disabled"],Ru=["disabled"],qu={class:"modal-footer"},Uu={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Wu={__name:"SessionManageModal",setup(n){const t=pe(),l=J(),i=te(),r=ge();ue();const a=L(null),v=L(!1),_=L(""),d=L(""),f=L(null),p=L(null);let y=null;const w=u(()=>f.value==="reset"?"Reset Session":f.value==="delete"?"Delete Session":"Manage Session");function S(){f.value="reset"}function E(){f.value="delete"}function k(){f.value=null}async function $(){f.value==="reset"?await b():f.value==="delete"&&await c()}async function h(){if(a.value){v.value=!0,_.value="Restarting session...";try{const C=a.value.session_id,P=await K.post(`/api/sessions/${C}/restart`);if(P.success)console.log("Session restarted successfully, reconnecting"),await r.disconnectSession(),l.currentSessionId=null,await l.selectSession(C),y&&y.hide();else{const H=P.error||P.detail||"Failed to restart session";console.error("Failed to restart session:",H),d.value=`Failed to restart session: ${H}`}}catch(C){console.error("Error restarting session:",C);const P=C.data?.detail||C.message||"Unknown error";d.value=`Error restarting session: ${P}`}finally{v.value=!1}}}async function x(){if(a.value)try{y&&y.hide(),console.log("Ending session",a.value.session_id);const C=a.value.session_id;await K.post(`/api/sessions/${C}/terminate`),await r.disconnectSession(),l.currentSessionId===C&&(l.currentSessionId=null),t.push("/")}catch(C){console.error("Error ending session:",C),await r.disconnectSession(),l.currentSessionId===a.value?.session_id&&(l.currentSessionId=null),t.push("/")}}async function b(){if(a.value){v.value=!0,_.value="Resetting session...";try{const C=a.value.session_id,P=await K.post(`/api/sessions/${C}/reset`);if(P.success)console.log("Session reset successfully, reconnecting"),await r.disconnectSession(),l.currentSessionId=null,await l.selectSession(C),y&&y.hide();else{const H=P.error||P.detail||"Failed to reset session";console.error("Failed to reset session:",H),d.value=`Failed to reset session: ${H}`,f.value=null}}catch(C){console.error("Error resetting session:",C);const P=C.data?.detail||C.message||"Unknown error";d.value=`Error resetting session: ${P}`,f.value=null}finally{v.value=!1}}}async function c(){if(a.value){v.value=!0,_.value="Deleting session...";try{const C=a.value.session_id;await l.deleteSession(C),t.currentRoute.value.params.sessionId===C&&t.push("/"),y&&y.hide()}catch(C){console.error("Error deleting session:",C);const P=C.data?.detail||C.message||"Unknown error";d.value=`Error deleting session: ${P}`,f.value=null}finally{v.value=!1}}}function O(){f.value=null,v.value=!1,_.value="",d.value=""}function q(){O(),a.value=null,i.hideModal()}return se(()=>i.currentModal,C=>{if(C?.name==="manage-session"&&y){const P=C.data||{};a.value=P.session,O(),y.show()}}),ie(()=>{p.value&&ae(async()=>{const{default:C}=await import("./modal-B4rHLo2F.js").then(P=>P.m);return{default:C}},__vite__mapDeps([0,1])).then(({default:C})=>{y=new C(p.value),p.value.addEventListener("hidden.bs.modal",q)})}),ce(()=>{p.value&&p.value.removeEventListener("hidden.bs.modal",q),y&&y.dispose()}),(C,P)=>(s(),o("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:p},[e("div",wu,[e("div",Su,[e("div",ku,[e("h5",Cu,g(f.value?w.value:"Manage Session"),1),P[1]||(P[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",xu,[v.value?(s(),o("div",Mu,[P[2]||(P[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",ju,g(_.value),1)])):f.value==="reset"?(s(),o("div",Tu,[...P[3]||(P[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):f.value==="delete"?(s(),o("div",Eu,[P[6]||(P[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1)),e("p",Pu,[P[4]||(P[4]=G("This will permanently delete session ",-1)),e("strong",null,g(a.value?.name),1),P[5]||(P[5]=G(".",-1))]),P[7]||(P[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(s(),o("div",Lu,[d.value?(s(),o("div",Iu,[P[8]||(P[8]=e("strong",null,"Error:",-1)),G(" "+g(d.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:P[0]||(P[0]=H=>d.value="")})])):T("",!0),P[15]||(P[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",Du,[e("button",{class:"btn btn-outline-primary text-start",onClick:h,disabled:v.value},[...P[9]||(P[9]=[e("strong",null,"🔄 Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,Ou),e("button",{class:"btn btn-outline-secondary text-start",onClick:x,disabled:v.value},[...P[10]||(P[10]=[e("strong",null,"🚪 End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,Nu),P[13]||(P[13]=e("hr",{class:"my-2"},null,-1)),P[14]||(P[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"⚠️ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:S,disabled:v.value},[...P[11]||(P[11]=[e("strong",null,"🗑️ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,Au),e("button",{class:"btn btn-outline-danger text-start",onClick:E,disabled:v.value},[...P[12]||(P[12]=[e("strong",null,"❌ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,Ru)]),P[16]||(P[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),G(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",qu,[f.value&&!v.value?(s(),o(Z,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:k},"Cancel"),e("button",{type:"button",class:F(["btn",f.value==="delete"?"btn-danger":"btn-warning"]),onClick:$},g(f.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):v.value?T("",!0):(s(),o("button",Uu,"Cancel"))])])])],512))}},Hu=B(Wu,[["__scopeId","data-v-de7ff18c"]]),Fu={class:"modal-dialog modal-dialog-centered modal-lg"},Bu={class:"modal-content"},Vu={class:"modal-body"},zu={key:0,class:"text-center text-muted py-4"},Gu={key:1},Ju={class:"mb-3"},Ku={class:"font-monospace small"},Yu={class:"mb-3"},Qu={class:"font-monospace small"},Zu={class:"mb-3"},Xu={class:"mb-3"},em={class:"mb-3"},tm={key:0},sm={class:"d-flex flex-wrap gap-1"},om={key:1,class:"text-muted small"},nm={key:0,class:"mb-3"},lm={class:"d-flex flex-wrap gap-1"},am={key:1,class:"mb-3"},rm={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},im={class:"mb-3"},cm={class:"text-muted"},dm={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},um={__name:"SessionInfoModal",setup(n){const t=J(),l=ue(),i=te(),r=L(null),a=L(!1),v=L(null);let _=null;const d=u(()=>{if(!r.value)return null;const w=t.initData.get(r.value);return w||(l.messagesBySession.get(r.value)||[]).find(k=>k.type==="system"&&(k.subtype==="init"||k.metadata?.subtype==="init")&&k.metadata?.init_data)?.metadata?.init_data||null});function f(w){return typeof w=="string"?w:typeof w=="object"&&w.type==="preset"?`Preset: ${w.preset}`:JSON.stringify(w,null,2)}function p(){r.value=null,a.value=!1}function y(){p(),i.hideModal()}return se(()=>i.currentModal,w=>{if(w?.name==="session-info"&&_){const S=w.data||{};r.value=S.sessionId,a.value=!1,_.show()}}),ie(()=>{v.value&&ae(async()=>{const{default:w}=await import("./modal-B4rHLo2F.js").then(S=>S.m);return{default:w}},__vite__mapDeps([0,1])).then(({default:w})=>{_=new w(v.value),v.value.addEventListener("hidden.bs.modal",y)})}),ce(()=>{v.value&&v.value.removeEventListener("hidden.bs.modal",y),_&&_.dispose()}),(w,S)=>(s(),o("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",Fu,[e("div",Bu,[S[9]||(S[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Vu,[d.value?(s(),o("div",Gu,[e("div",Ju,[S[1]||(S[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Ku,g(r.value),1)]),e("div",Yu,[S[2]||(S[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",Qu,g(d.value.cwd||"Not specified"),1)]),e("div",Zu,[S[3]||(S[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,g(d.value.model||"Default"),1)]),e("div",Xu,[S[4]||(S[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,g(d.value.permissionMode||"default"),1)]),e("div",em,[S[5]||(S[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),d.value.tools&&d.value.tools.length>0?(s(),o("div",tm,[e("div",sm,[(s(!0),o(Z,null,X(d.value.tools,E=>(s(),o("span",{key:E,class:"badge bg-secondary"},g(E),1))),128))])])):(s(),o("div",om,"All tools available"))]),d.value.commands&&d.value.commands.length>0?(s(),o("div",nm,[S[6]||(S[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",lm,[(s(!0),o(Z,null,X(d.value.commands,E=>(s(),o("span",{key:E,class:"badge bg-info"},g(E),1))),128))])])):T("",!0),d.value.systemPrompt?(s(),o("div",am,[S[7]||(S[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",rm,g(f(d.value.systemPrompt)),1)])):T("",!0),e("div",im,[e("h6",cm,[S[8]||(S[8]=G(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:S[0]||(S[0]=E=>a.value=!a.value)},g(a.value?"Hide":"Show"),1)]),a.value?(s(),o("pre",dm,g(JSON.stringify(d.value,null,2)),1)):T("",!0)])])):(s(),o("div",zu," No session configuration data available "))]),S[10]||(S[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},mm=B(um,[["__scopeId","data-v-809e2099"]]),pm={class:"modal-dialog modal-dialog-centered"},vm={class:"modal-content"},fm={class:"modal-body"},gm={class:"mb-3"},_m={class:"mb-3"},bm={class:"mb-3"},hm={class:"form-text d-flex justify-content-between"},ym={key:0,class:"invalid-feedback"},$m={class:"mb-3 form-check"},wm={key:0,class:"form-text text-warning"},Sm={class:"mb-3"},km={key:0,class:"alert alert-danger"},Cm={class:"modal-footer"},xm=["disabled"],Mm={key:0,class:"spinner-border spinner-border-sm me-2"},jm={__name:"CreateMinionModal",setup(n){const t=pe(),l=le(),i=J(),r=te(),a=L(null);let v=null;const _=L(null),d=L({name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]}),f=L(""),p=L(""),y=L(!1),w=u(()=>f.value.trim()?f.value.split(",").map(b=>b.trim()).filter(b=>b.length>0):[]),S=u(()=>d.value.initialization_context.length),E=u(()=>S.value>2e3),k=u(()=>S.value>1800&&S.value<=2e3);function $(){d.value={name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]},f.value="",p.value="",y.value=!1}function h(){$(),r.hideModal()}async function x(){if(!d.value.name.trim()){p.value="Minion name is required";return}if(d.value.name.includes(" ")){p.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(E.value){p.value="Initialization context exceeds 2000 character limit";return}if(!_.value){p.value="Legion ID is missing";return}y.value=!0,p.value="";try{const b={name:d.value.name.trim(),role:d.value.role.trim(),initialization_context:d.value.initialization_context.trim(),override_system_prompt:d.value.override_system_prompt,capabilities:w.value},c=await K.post(`/api/legions/${_.value}/minions`,b);c.success&&c.minion_id?(await l.fetchProjects(),await i.fetchSessions(),v&&v.hide(),t.push(`/spy/${_.value}/${c.minion_id}`)):p.value="Failed to create minion"}catch(b){console.error("Failed to create minion:",b),p.value=b.response?.data?.detail||"Failed to create minion"}finally{y.value=!1}}return se(()=>r.currentModal,b=>{if(b?.name==="create-minion"&&v){const c=b.data||{};_.value=c.project?.project_id||null,$(),v.show()}}),ie(()=>{a.value&&ae(()=>import("./modal-B4rHLo2F.js").then(b=>b.m),__vite__mapDeps([0,1])).then(b=>{const c=b.default;v=new c(a.value),a.value.addEventListener("hidden.bs.modal",h)})}),ce(()=>{a.value&&a.value.removeEventListener("hidden.bs.modal",h),v&&v.dispose()}),(b,c)=>(s(),o("div",{ref_key:"modalElement",ref:a,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",pm,[e("div",vm,[c[15]||(c[15]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",fm,[e("form",{onSubmit:re(x,["prevent"])},[e("div",gm,[c[5]||(c[5]=e("label",{for:"minion-name",class:"form-label"},[G(" Name "),e("span",{class:"text-danger"},"*")],-1)),Y(e("input",{id:"minion-name","onUpdate:modelValue":c[0]||(c[0]=O=>d.value.name=O),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[ne,d.value.name]]),c[6]||(c[6]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",_m,[c[7]||(c[7]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),Y(e("input",{id:"minion-role","onUpdate:modelValue":c[1]||(c[1]=O=>d.value.role=O),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[ne,d.value.role]]),c[8]||(c[8]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",bm,[c[9]||(c[9]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),Y(e("textarea",{id:"minion-context","onUpdate:modelValue":c[2]||(c[2]=O=>d.value.initialization_context=O),class:F(["form-control",{"is-invalid":E.value}]),rows:"4",maxlength:2e3,placeholder:"Instructions and context for the minion..."},null,2),[[ne,d.value.initialization_context]]),e("div",hm,[e("span",null,g(d.value.override_system_prompt?"This context will replace Claude Code's preset and legion guide":"This context will be appended to legion guide and Claude Code's preset"),1),e("span",{class:F({"text-danger":E.value,"text-warning":k.value})},g(S.value)+" / 2000 chars ",3)]),E.value?(s(),o("div",ym," Initialization context exceeds 2000 character limit (Windows command-line constraint) ")):T("",!0)]),e("div",$m,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":c[3]||(c[3]=O=>d.value.override_system_prompt=O)},null,512),[[be,d.value.override_system_prompt]]),c[11]||(c[11]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom context only) ",-1)),d.value.override_system_prompt?(s(),o("div",wm,[...c[10]||(c[10]=[e("small",null,"⚠️ Override mode may cause unexpected behaviors. Only custom context will be used (no legion guide or Claude Code preset).",-1)])])):T("",!0)]),e("div",Sm,[c[12]||(c[12]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),Y(e("input",{id:"minion-capabilities","onUpdate:modelValue":c[4]||(c[4]=O=>f.value=O),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[ne,f.value]]),c[13]||(c[13]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),p.value?(s(),o("div",km,g(p.value),1)):T("",!0)],32)]),e("div",Cm,[c[14]||(c[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!d.value.name.trim()||y.value,onClick:x},[y.value?(s(),o("span",Mm)):T("",!0),G(" "+g(y.value?"Creating...":"Create Minion"),1)],8,xm)])])])],512))}},Tm=B(jm,[["__scopeId","data-v-d7434e2a"]]),Em={class:"modal-dialog modal-dialog-centered modal-lg"},Pm={class:"modal-content"},Lm={class:"modal-body"},Im={key:0,class:"text-center text-muted py-4"},Dm={key:1},Om={class:"mb-3"},Nm={class:"mb-3"},Am={class:"font-monospace small"},Rm={class:"mb-3"},qm={class:"mb-3"},Um={class:"mb-3"},Wm={key:0},Hm={class:"d-flex flex-wrap gap-1"},Fm={key:1,class:"text-muted small"},Bm={class:"mb-3"},Vm={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto","white-space":"pre-wrap"}},zm={key:1,class:"text-muted small"},Gm={class:"mb-3"},Jm={key:0,class:"badge bg-info"},Km={key:1,class:"badge bg-secondary"},Ym={class:"mb-3"},Qm={key:0,class:"font-monospace small"},Zm={key:1,class:"text-muted small"},Xm={key:0,class:"mb-3"},ep={key:0},tp={class:"list-unstyled mb-0"},sp={key:1,class:"text-muted small"},op={class:"mb-3"},np={key:0,class:"font-monospace small"},lp={key:1,class:"text-muted small"},ap={class:"mb-3"},rp={key:0},ip={class:"d-flex flex-wrap gap-1"},cp={key:1,class:"text-muted small"},dp={class:"mb-3"},up={class:"small"},mp={class:"mb-3"},pp={class:"small"},vp={__name:"MinionViewModal",setup(n){const t=te(),l=L(null),i=L(null);let r=null;function a(f){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[f]||"bg-secondary"}function v(f){if(!f)return"N/A";try{const p=new Date(f);return isNaN(p.getTime())?"Invalid date":p.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(p){return console.error("Error formatting timestamp:",p),"Invalid date"}}function _(){l.value=null}function d(){_(),t.hideModal()}return se(()=>t.currentModal,f=>{if(f?.name==="minion-view"&&r){const p=f.data||{};l.value=p.session,r.show()}}),ie(()=>{i.value&&ae(async()=>{const{default:f}=await import("./modal-B4rHLo2F.js").then(p=>p.m);return{default:f}},__vite__mapDeps([0,1])).then(({default:f})=>{r=new f(i.value),i.value.addEventListener("hidden.bs.modal",d)})}),ce(()=>{i.value&&i.value.removeEventListener("hidden.bs.modal",d),r&&r.dispose()}),(f,p)=>(s(),o("div",{class:"modal fade",id:"minionViewModal",tabindex:"-1","aria-labelledby":"minionViewModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",Em,[e("div",Pm,[p[13]||(p[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"minionViewModalLabel"},"Minion Details"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Lm,[l.value?(s(),o("div",Dm,[e("div",Om,[p[0]||(p[0]=e("h6",{class:"text-muted"},"Name",-1)),e("div",null,g(l.value.name||"Unnamed Minion"),1)]),e("div",Nm,[p[1]||(p[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Am,g(l.value.session_id),1)]),e("div",Rm,[p[2]||(p[2]=e("h6",{class:"text-muted"},"Role",-1)),e("div",null,g(l.value.role||"Not specified"),1)]),e("div",qm,[p[3]||(p[3]=e("h6",{class:"text-muted"},"Current State",-1)),e("div",null,[e("span",{class:F(["badge",a(l.value.state)])},g(l.value.state),3)])]),e("div",Um,[p[4]||(p[4]=e("h6",{class:"text-muted"},"Capabilities",-1)),l.value.capabilities&&l.value.capabilities.length>0?(s(),o("div",Wm,[e("div",Hm,[(s(!0),o(Z,null,X(l.value.capabilities,y=>(s(),o("span",{key:y,class:"badge bg-secondary"},g(y),1))),128))])])):(s(),o("div",Fm,"None"))]),e("div",Bm,[p[5]||(p[5]=e("h6",{class:"text-muted"},"Initialization Context",-1)),l.value.initialization_context?(s(),o("div",Vm,g(l.value.initialization_context),1)):(s(),o("div",zm,"Not specified"))]),e("div",Gm,[p[6]||(p[6]=e("h6",{class:"text-muted"},"Overseer",-1)),e("div",null,[l.value.is_overseer?(s(),o("span",Jm,"Yes")):(s(),o("span",Km,"No"))])]),e("div",Ym,[p[7]||(p[7]=e("h6",{class:"text-muted"},"Parent Overseer",-1)),l.value.parent_overseer_id?(s(),o("div",Qm,g(l.value.parent_overseer_id),1)):(s(),o("div",Zm,g(l.value.is_minion?"Root overseer (user-created)":"N/A"),1))]),l.value.is_overseer?(s(),o("div",Xm,[p[8]||(p[8]=e("h6",{class:"text-muted"},"Child Minions",-1)),l.value.child_minion_ids&&l.value.child_minion_ids.length>0?(s(),o("div",ep,[e("ul",tp,[(s(!0),o(Z,null,X(l.value.child_minion_ids,y=>(s(),o("li",{key:y,class:"font-monospace small"},g(y),1))),128))])])):(s(),o("div",sp,"No children"))])):T("",!0),e("div",op,[p[9]||(p[9]=e("h6",{class:"text-muted"},"Horde Membership",-1)),l.value.horde_id?(s(),o("div",np,g(l.value.horde_id),1)):(s(),o("div",lp,"Not in a horde"))]),e("div",ap,[p[10]||(p[10]=e("h6",{class:"text-muted"},"Channel Memberships",-1)),l.value.channel_ids&&l.value.channel_ids.length>0?(s(),o("div",rp,[e("div",ip,[(s(!0),o(Z,null,X(l.value.channel_ids,y=>(s(),o("span",{key:y,class:"badge bg-info"},g(y),1))),128))])])):(s(),o("div",cp,"No channels"))]),e("div",dp,[p[11]||(p[11]=e("h6",{class:"text-muted"},"Created",-1)),e("div",up,g(v(l.value.created_at)),1)]),e("div",mp,[p[12]||(p[12]=e("h6",{class:"text-muted"},"Last Active",-1)),e("div",pp,g(v(l.value.updated_at)),1)])])):(s(),o("div",Im," No minion data available "))]),p[14]||(p[14]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},fp=B(vp,[["__scopeId","data-v-c44eaee2"]]),gp={class:"container-fluid vh-100 d-flex flex-column p-0"},_p={class:"d-flex flex-grow-1 overflow-hidden position-relative"},bp={class:"flex-grow-1 d-flex flex-column overflow-hidden"},hp={__name:"App",setup(n){const t=te(),l=ge(),i=J(),r=le(),a=pe(),v=u(()=>t.sidebarCollapsed),_=u(()=>t.isMobile);ie(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),l.connectUI(),await Promise.all([r.fetchProjects(),i.fetchSessions()]);const p=window.location.hash;if(p.startsWith("#/session/")){const y=p.replace("#/session/","");i.sessions.has(y)&&await i.selectSession(y)}else if(p.startsWith("#/timeline/")){const y=p.replace("#/timeline/","");a.push(`/timeline/${y}`)}window.addEventListener("popstate",d),window.addEventListener("resize",t.handleResize)}),ce(()=>{window.removeEventListener("popstate",d),window.removeEventListener("resize",t.handleResize),l.disconnectUI()});function d(){const p=window.location.hash;if(p.startsWith("#/session/")){const y=p.replace("#/session/","");i.sessions.has(y)&&i.selectSession(y)}}function f(){t.toggleSidebar()}return(p,y)=>{const w=Ue("router-view");return s(),o("div",gp,[Q(Ni),e("div",{id:"sidebar-backdrop",class:F({show:!v.value&&_.value}),onClick:f},null,2),e("div",_p,[Q(yc),e("main",bp,[Q(w)])]),Q(Ac),Q(sd),Q(kd),Q(Gd),Q($u),Q(Hu),Q(mm),Q(Tm),Q(fp)])}}},Pe=Ve(hp);Pe.use(ze());Pe.use(Li);Pe.mount("#app");
