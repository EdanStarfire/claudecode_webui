const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as r,a as e,o as l,d as ve,r as I,b as u,t as g,n as de,e as W,f as H,u as be,w as X,g as Me,h as P,F as Q,i as Z,j as re,k as Ne,l as K,v as te,m as Y,p as le,q as Se,s as Ae,x as ie,y as ae,z as ce,A as Re,B as Ue,C as We,D as ue,E as fe,G as He,H as Fe}from"./vue-vendor-BChC3Sgv.js";import{m as ge,p as ke}from"./markdown-vendor-CQ3OZdP9.js";import{c as Be}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function d(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=d(n);fetch(n.href,o)}})();const Ve={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},ze={__name:"NoSessionSelected",setup(s){return(t,d)=>(l(),r("div",Ve,[...d[0]||(d[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},Je="modulepreload",Ge=function(s){return"/"+s},Te={},ne=function(t,d,a){let n=Promise.resolve();if(d&&d.length>0){let i=function(v){return Promise.all(v.map(h=>Promise.resolve(h).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),f=p?.nonce||p?.getAttribute("nonce");n=i(d.map(v=>{if(v=Ge(v),v in Te)return;Te[v]=!0;const h=v.endsWith(".css"),y=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${y}`))return;const _=document.createElement("link");if(_.rel=h?"stylesheet":Je,h||(_.as="script"),_.crossOrigin="",_.href=v,f&&_.setAttribute("nonce",f),document.head.appendChild(_),h)return new Promise((b,x)=>{_.addEventListener("load",b),_.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${v}`)))})}))}function o(p){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=p,window.dispatchEvent(f),!f.defaultPrevented)throw p}return n.then(p=>{for(const f of p||[])f.status==="rejected"&&o(f.reason);return t().catch(o)})};class ye extends Error{constructor(t,d,a){super(t),this.name="APIError",this.status=d,this.data=a}}async function _e(s,t={}){try{const d=await fetch(s,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!d.ok){let n;try{n=await d.json()}catch{n={detail:d.statusText}}throw new ye(n.detail||`HTTP ${d.status}: ${d.statusText}`,d.status,n)}const a=d.headers.get("content-type");return a&&a.includes("application/json")?await d.json():await d.text()}catch(d){throw d instanceof ye?d:(console.error("API request failed:",d),new ye(`Network error: ${d.message}`,0,null))}}async function Ke(s,t={}){let d=s;if(t.params){const a=new URLSearchParams;for(const[f,i]of Object.entries(t.params))i!=null&&a.append(f,i);const n=a.toString();n&&(d=`${s}?${n}`);const{params:o,...p}=t;return _e(d,{...p,method:"GET"})}return _e(d,{...t,method:"GET"})}async function Ye(s,t,d={}){return _e(s,{...d,method:"POST",body:JSON.stringify(t)})}async function Qe(s,t,d={}){return _e(s,{...d,method:"PUT",body:JSON.stringify(t)})}async function Ze(s,t={}){return _e(s,{...t,method:"DELETE"})}const G={get:Ke,post:Ye,put:Qe,delete:Ze},J=ve("session",()=>{const s=I(new Map),t=I(null),d=I(new Map),a=I(new Map),n=I(new Set),o=I(!1);let p=null;const f=u(()=>s.value.get(t.value)),i=u(()=>Array.from(s.value.values()).sort((S,C)=>S.order-C.order)),v=S=>u(()=>i.value.filter(C=>C.project_id===S)),h=u({get:()=>d.value.get(t.value)||"",set:S=>{t.value&&d.value.set(t.value,S)}});async function y(){try{const S=await G.get("/api/sessions");return s.value.clear(),S.sessions.forEach(C=>{s.value.set(C.session_id,C)}),console.log(`Loaded ${s.value.size} sessions`),S.sessions}catch(S){throw console.error("Failed to fetch sessions:",S),S}}async function _(S,C){try{const $=(await G.post("/api/sessions",{project_id:S,...C})).session_id,L=(await G.get(`/api/sessions/${$}`)).session;return s.value.set($,L),s.value=new Map(s.value),console.log(`Created session ${$}`),L}catch(M){throw console.error("Failed to create session:",M),M}}async function b(S){if(t.value===S&&!o.value)return;p&&(console.log(`Aborting pending selection to switch to ${S}`),p.abort(),p=null);const C=new AbortController;p=C,o.value=!0;try{if(t.value=S,C.signal.aborted){console.log(`Selection of ${S} aborted early`);return}let M=s.value.get(S);if(!M)try{const L=await G.get(`/api/sessions/${S}`);if(C.signal.aborted){console.log(`Selection of ${S} aborted after fetch`);return}M=L.session,s.value.set(S,M),s.value=new Map(s.value),console.log(`Fetched session ${S} for deeplink`)}catch(L){console.error(`Failed to fetch session ${S}:`,L);return}if(M&&(M.state==="created"||M.state==="terminated"))try{if(await j(S),C.signal.aborted){console.log(`Selection of ${S} aborted after start`);return}console.log(`Auto-started session ${S} (was in ${M.state} state)`);const L=6e4,U=200,B=5e3;let D=0,A=0;for(;D<L;){if(C.signal.aborted){console.log(`Selection of ${S} aborted during state wait`);return}const V=s.value.get(S);if(V&&V.state==="active"){console.log(`Session ${S} is now active after ${D}ms`);break}if(D-A>=B){const F=s.value.get(S)?.state||"unknown";console.log(`Waiting for session ${S} to become active (current: ${F}, ${D/1e3}s elapsed)`),A=D}await new Promise(F=>setTimeout(F,U)),D+=U}const R=s.value.get(S);R&&R.state!=="active"&&console.warn(`Session ${S} did not become active within ${L/1e3}s (state: ${R.state}), continuing anyway`)}catch(L){console.error(`Failed to auto-start session ${S}:`,L)}if(C.signal.aborted){console.log(`Selection of ${S} aborted before message load`);return}if(await(await ne(()=>Promise.resolve().then(()=>bt),void 0)).useMessageStore().loadMessages(S),C.signal.aborted){console.log(`Selection of ${S} aborted after message load`);return}await(await ne(()=>Promise.resolve().then(()=>qt),void 0)).useWebSocketStore().connectSession(S),C.signal.aborted||console.log(`Selected session ${S}`)}finally{p===C&&(p=null),o.value=!1}}function x(S,C){const M=s.value.get(S);M&&(Object.assign(M,C),s.value=new Map(s.value))}async function T(S){n.value.add(S);try{await G.delete(`/api/sessions/${S}`),s.value.delete(S),d.value.delete(S),a.value.delete(S),s.value=new Map(s.value),t.value===S&&(t.value=null),console.log(`Deleted session ${S}`)}catch(C){throw console.error("Failed to delete session:",C),C}finally{n.value.delete(S)}}async function w(S,C){try{await G.put(`/api/sessions/${S}/name`,{name:C}),x(S,{name:C}),console.log(`Updated session ${S} name to "${C}"`)}catch(M){throw console.error("Failed to update session name:",M),M}}async function k(S,C){try{await G.post(`/api/sessions/${S}/permission-mode`,{mode:C}),x(S,{current_permission_mode:C});const M=a.value.get(S);M&&(M.permissionMode=C,a.value.set(S,M)),console.log(`Set permission mode for session ${S} to ${C}`)}catch(M){throw console.error("Failed to set permission mode:",M),M}}async function j(S){try{await G.post(`/api/sessions/${S}/start`),console.log(`Started session ${S}`)}catch(C){throw console.error("Failed to start session:",C),C}}async function m(S){try{await G.post(`/api/sessions/${S}/pause`),console.log(`Paused session ${S}`)}catch(C){throw console.error("Failed to pause session:",C),C}}async function c(S){try{await G.post(`/api/sessions/${S}/terminate`),console.log(`Terminated session ${S}`)}catch(C){throw console.error("Failed to terminate session:",C),C}}function E(S){return s.value.get(S)}function N(S,C){a.value.set(S,C),C.permissionMode&&x(S,{current_permission_mode:C.permissionMode})}return{sessions:s,currentSessionId:t,inputCache:d,initData:a,deletingSessions:n,currentSession:f,orderedSessions:i,sessionsInProject:v,currentInput:h,fetchSessions:y,createSession:_,selectSession:b,updateSession:x,deleteSession:T,updateSessionName:w,setPermissionMode:k,startSession:j,pauseSession:m,terminateSession:c,getSession:E,storeInitData:N}}),Ee=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:J},Symbol.toStringTag,{value:"Module"})),ee=ve("ui",()=>{const s=I(window.innerWidth<768),t=I(300),d=I(window.innerWidth),a=u(()=>d.value<768),n=I(!0),o=I(null),p=I(null),f=u(()=>o.value?{name:o.value,data:p.value}:null),i=I(!1),v=I("Loading...");function h(){s.value=!s.value}function y(m){s.value=m}function _(m){t.value=Math.max(200,Math.min(m,window.innerWidth*.3))}function b(m){n.value=m}function x(m,c=null){o.value=null,p.value=null,setTimeout(()=>{o.value=m,p.value=c},0)}function T(){o.value=null,p.value=null}function w(m="Loading..."){i.value=!0,v.value=m}function k(){i.value=!1}function j(){const m=d.value;d.value=window.innerWidth,d.value<768&&m>=768?s.value=!0:d.value>=768&&m<768&&(s.value=!1)}return{sidebarCollapsed:s,sidebarWidth:t,isMobile:a,autoScrollEnabled:n,activeModal:o,modalData:p,currentModal:f,isLoading:i,loadingMessage:v,toggleSidebar:h,setSidebarCollapsed:y,setSidebarWidth:_,setAutoScroll:b,showModal:x,hideModal:T,showLoading:w,hideLoading:k,handleResize:j}}),se=ve("project",()=>{const s=I(new Map),t=I(null),d=u(()=>s.value.get(t.value)),a=u(()=>Array.from(s.value.values()).sort((T,w)=>T.order-w.order)),n=T=>s.value.get(T)?.is_multi_agent||!1;async function o(){try{const T=await G.get("/api/projects");return s.value.clear(),T.projects.forEach(w=>{s.value.set(w.project_id,w)}),console.log(`Loaded ${s.value.size} projects`),T.projects}catch(T){throw console.error("Failed to fetch projects:",T),T}}async function p(T,w,k=!1){try{const m=(await G.post("/api/projects",{name:T,working_directory:w,is_multi_agent:k})).project;return s.value.set(m.project_id,m),s.value=new Map(s.value),console.log(`Created project ${m.project_id}`),m}catch(j){throw console.error("Failed to create project:",j),j}}async function f(T,w){try{await G.put(`/api/projects/${T}`,w),i(T,w),console.log(`Updated project ${T}`,w)}catch(k){throw console.error("Failed to update project:",k),k}}function i(T,w){const k=s.value.get(T);k&&(Object.assign(k,w),s.value=new Map(s.value))}async function v(T){try{await G.delete(`/api/projects/${T}`),s.value.delete(T),s.value=new Map(s.value),t.value===T&&(t.value=null),console.log(`Deleted project ${T}`)}catch(w){throw console.error("Failed to delete project:",w),w}}async function h(T){try{const w=await G.put(`/api/projects/${T}/toggle-expansion`),k=s.value.get(T);return k&&(k.is_expanded=w.is_expanded,s.value=new Map(s.value)),w.is_expanded}catch(w){throw console.error("Failed to toggle expansion:",w),w}}async function y(T){try{await G.put("/api/projects/reorder",{project_ids:T}),T.forEach((w,k)=>{const j=s.value.get(w);j&&(j.order=k)}),s.value=new Map(s.value),console.log("Reordered projects",T)}catch(w){throw console.error("Failed to reorder projects:",w),w}}async function _(T,w){try{await G.put(`/api/projects/${T}/sessions/reorder`,{session_ids:w});const k=s.value.get(T);k&&(k.session_ids=w,s.value=new Map(s.value)),console.log(`Reordered sessions in project ${T}`,w)}catch(k){throw console.error("Failed to reorder sessions:",k),k}}function b(T){return s.value.get(T)}function x(T){if(!T)return"";const w=T.split(/[/\\]/).filter(k=>k);return w.length===0?"/":w.length===1?`/${w[0]}`:w.length===2?`/${w.join("/")}`:`.../${w.slice(-2).join("/")}`}return{projects:s,currentProjectId:t,currentProject:d,orderedProjects:a,isMultiAgent:n,fetchProjects:o,createProject:p,updateProject:f,updateProjectLocal:i,deleteProject:v,toggleExpansion:h,reorderProjects:y,reorderSessionsInProject:_,getProject:b,formatPath:x}}),q=(s,t)=>{const d=s.__vccOpts||s;for(const[a,n]of t)d[a]=n;return d},Xe={class:"session-header border-bottom p-3"},et={class:"project-name"},tt=["title"],st={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,d=J(),a=se(),n=u(()=>d.sessions.get(t.sessionId)),o=u(()=>n.value?.name||t.sessionId),p=u(()=>{for(const i of a.projects.values())if(i.session_ids?.includes(t.sessionId))return i;return null}),f=u(()=>p.value?.name||"Unknown Project");return(i,v)=>(l(),r("div",Xe,[e("div",null,[e("div",et,g(f.value),1),e("div",{class:"session-name",title:s.sessionId},g(o.value),9,tt)])]))}},ot=q(st,[["__scopeId","data-v-89e9c269"]]),nt={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},lt=["title"],at={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},rt={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,d=J(),a=u(()=>d.sessions.get(t.sessionId)),n=u(()=>a.value?a.value.state==="paused"&&a.value.is_processing?"pending-prompt":a.value.is_processing?"processing":a.value.state:"unknown"),o=u(()=>{const i=n.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[i]||"#d3d3d3"}),p=u(()=>{const i=n.value;return i==="starting"||i==="processing"||i==="pending-prompt"}),f=u(()=>{if(!a.value)return"No session selected";const i=n.value,v=i.charAt(0).toUpperCase()+i.slice(1).replace("-"," "),h=a.value.name||"Unnamed Session",y=a.value.is_minion&&a.value.role?` (${a.value.role})`:"";return`${h}${y}: ${v}`});return(i,v)=>(l(),r("div",nt,[a.value?(l(),r("div",{key:0,class:W(["progress-bar",{"progress-bar-striped progress-bar-animated":p.value}]),style:de({width:"100%",backgroundColor:o.value}),title:f.value},null,14,lt)):(l(),r("div",at))]))}},it=q(rt,[["__scopeId","data-v-e8795bb7"]]),dt={class:"session-status-bar border-top p-2 bg-light"},ut={class:"d-flex justify-content-between align-items-center gap-2"},ct={class:"d-flex gap-2"},mt=["disabled"],pt={class:"mode-label"},vt=["disabled"],ft=["disabled"],gt={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,d=J(),a=ee(),n=u(()=>d.sessions.get(t.sessionId)),o=u(()=>n.value?.current_permission_mode||"default"),p={default:"🔒",acceptEdits:"✏️",plan:"📋",bypassPermissions:"☢️"},f=u(()=>p[o.value]||"🔒"),i=u(()=>o.value),v=["default","acceptEdits","plan"],h=async()=>{if(!n.value)return;if(o.value==="bypassPermissions"){try{await d.setPermissionMode(t.sessionId,"default")}catch(k){console.error("Failed to cycle permission mode:",k)}return}const T=(v.indexOf(o.value)+1)%v.length,w=v[T];try{await d.setPermissionMode(t.sessionId,w)}catch(k){console.error("Failed to cycle permission mode:",k)}},y=()=>{a.showModal("session-info",{sessionId:t.sessionId})},_=()=>{a.showModal("manage-session",{session:n.value})},b=()=>{a.setAutoScroll(!a.autoScrollEnabled)};return(x,T)=>(l(),r("div",dt,[e("div",ut,[e("div",ct,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:h,disabled:!n.value},[H(g(f.value)+" ",1),e("span",pt,g(i.value),1)],8,mt),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:y,disabled:!n.value},[...T[0]||(T[0]=[H(" ℹ️ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,vt),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:_,disabled:!n.value},[...T[1]||(T[1]=[H(" ⚙️ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,ft)]),e("div",null,[e("button",{class:W(["btn btn-sm",be(a).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:b}," ⬇️ "+g(be(a).autoScrollEnabled?"ON":"OFF"),3)])])]))}},_t=q(gt,[["__scopeId","data-v-fdcd3535"]]),me=ve("message",()=>{const s=I(new Map),t=I(new Map),d=I(new Map),a=I(new Map),n=I(new Map),o=I(new Map),p=u(()=>{const M=J();return s.value.get(M.currentSessionId)||[]}),f=u(()=>{const M=J();return t.value.get(M.currentSessionId)||[]});async function i(M,$=null,O=0){try{const L=$||1e4,U=await G.get(`/api/sessions/${M}/messages?limit=${L}&offset=${O}`),B=U.messages||[],D=U.total_count||B.length,A=U.has_more||!1;console.log(`Loaded ${B.length} of ${D} messages for session ${M}`),s.value.set(M,B);const R=new Set;B.forEach(z=>{z.type==="assistant"&&z.metadata?.tool_uses&&z.metadata.tool_uses.forEach(oe=>{R.add(oe.id)}),z.type==="user"&&z.metadata?.tool_results&&z.metadata.tool_results.forEach(oe=>{R.delete(oe.tool_use_id);const je=o.value.get(M);je&&je.delete(oe.tool_use_id)}),z.type==="system"&&z.metadata?.subtype==="client_launched"&&(R.forEach(oe=>{m(M,oe,"Session was restarted")}),R.clear()),z.type==="system"&&z.metadata?.subtype==="interrupt"&&(R.forEach(oe=>{m(M,oe,"Session was interrupted")}),R.clear()),z.metadata?.has_tool_uses&&z.metadata.tool_uses&&z.metadata.tool_uses.forEach(oe=>{b(M,oe)}),z.metadata?.has_tool_results&&z.metadata.tool_results&&z.metadata.tool_results.forEach(oe=>{w(M,oe)}),(z.type==="permission_request"||z.metadata?.has_permission_requests)&&x(M,z),z.type==="system"&&(z.subtype==="init"||z.metadata?.subtype==="init")&&z.metadata?.init_data&&J().storeInitData(M,z.metadata.init_data)});const F=J().sessions.get(M);return F&&!["active","paused","starting"].includes(F.state)&&(R.forEach(z=>{m(M,z,"Session was terminated")}),R.clear()),n.value.set(M,R),s.value=new Map(s.value),A&&console.warn(`Warning: Only loaded ${B.length} of ${D} messages. Some messages may be missing.`),{messages:B,totalCount:D,hasMore:A}}catch(L){throw console.error("Failed to load messages:",L),L}}function v(M,$){const O=n.value.get(M)||new Set;$.type==="assistant"&&$.metadata?.tool_uses&&$.metadata.tool_uses.forEach(L=>{O.add(L.id)}),$.type==="user"&&$.metadata?.tool_results&&$.metadata.tool_results.forEach(L=>{O.delete(L.tool_use_id);const U=o.value.get(M);U&&U.delete(L.tool_use_id)}),$.type==="system"&&$.metadata?.subtype==="client_launched"&&(O.forEach(L=>{m(M,L,"Session was restarted")}),O.clear()),$.type==="system"&&$.metadata?.subtype==="interrupt"&&(O.forEach(L=>{m(M,L,"Session was interrupted")}),O.clear()),n.value.set(M,O)}function h(M,$){s.value.has(M)||s.value.set(M,[]),s.value.get(M).push($),v(M,$),s.value=new Map(s.value)}function y(M,$){t.value.has(M)||t.value.set(M,[]),t.value.get(M).push($),t.value=new Map(t.value)}function _(M,$,O){const L=t.value.get(M);if(L){const U=L.find(B=>B.id===$);U&&(Object.assign(U,O),t.value=new Map(t.value))}}function b(M,$){const O=j($.name,$.input);d.value.set(O,$.id);const L={id:$.id,name:$.name,input:$.input,signature:O,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return y(M,L),console.log(`Created tool call ${L.id} for ${L.name}`),L}function x(M,$){console.log("handlePermissionRequest received:",$);const O=$.metadata?.tool_name||$.tool_name,L=$.metadata?.input_params||$.input_params,U=$.metadata?.request_id||$.request_id,B=$.metadata?.suggestions||$.suggestions||[];console.log("Extracted data:",{toolName:O,inputParams:L,requestId:U,suggestions:B});const D=j(O,L),A=d.value.get(D);A?(a.value.set(U,A),_(M,A,{status:"permission_required",permissionRequestId:U,suggestions:B}),console.log(`Permission required for tool ${A}`,{suggestions:B})):console.warn("No tool use ID found for permission request signature:",D,{toolName:O,inputParams:L,availableSignatures:Array.from(d.value.keys())})}function T(M,$){const O=a.value.get($.request_id);if(O){const L={permissionDecision:$.decision,appliedUpdates:$.applied_updates||[]};$.decision==="allow"?L.status="executing":(L.status="completed",L.result={error:!0,message:$.reasoning||"Permission denied"},L.isExpanded=!1),_(M,O,L),console.log(`Permission ${$.decision} for tool ${O}`)}}function w(M,$){const O=$.tool_use_id;_(M,O,{status:$.is_error?"error":"completed",result:{error:$.is_error,content:$.content},isExpanded:!1}),console.log(`Tool ${O} ${$.is_error?"failed":"completed"}`)}function k(M,$){const O=t.value.get(M);if(O){const L=O.find(U=>U.id===$);L&&(L.isExpanded=!L.isExpanded,t.value=new Map(t.value))}}function j(M,$){if(!M)return"unknown:{}";if(!$||typeof $!="object")return`${M}:{}`;const O=JSON.stringify($,Object.keys($).sort());return`${M}:${O}`}function m(M,$,O){const L=o.value.get(M)||new Map;L.set($,{reason:"denied",message:O}),o.value.set(M,L);const U=t.value.get(M);if(U){const B=U.find(D=>D.id===$);B&&B.isExpanded&&(B.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${$} as orphaned: ${O}`)}function c(M,$){return o.value.get(M)?.has($)||!1}function E(M,$){return o.value.get(M)?.get($)}function N(M,$){const O=n.value.get(M);O&&O.size>0&&(O.forEach(L=>m(M,L,$)),O.clear())}function S(M){s.value.delete(M),t.value.delete(M),s.value=new Map(s.value),t.value=new Map(t.value)}const C=J();return X(()=>Array.from(C.sessions.values()).map($=>({id:$.session_id,state:$.state})),(M,$)=>{$&&M.forEach((O,L)=>{const U=$[L];if(!U||U.id!==O.id)return;const B=["active","paused","starting"].includes(U.state),D=!["active","paused","starting"].includes(O.state);B&&D&&N(O.id,"Session was terminated")})},{deep:!0}),{messagesBySession:s,toolCallsBySession:t,activeToolUses:Me(n),orphanedToolUses:Me(o),currentMessages:p,currentToolCalls:f,loadMessages:i,addMessage:h,addToolCall:y,updateToolCall:_,handleToolUse:b,handlePermissionRequest:x,handlePermissionResponse:T,handleToolResult:w,toggleToolExpansion:k,clearMessages:S,markToolUseOrphaned:m,isToolUseOrphaned:c,getOrphanedInfo:E,clearOrphanedToolUses:N}}),bt=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:me},Symbol.toStringTag,{value:"Module"}));function ht(s){if(!s)return new Date;if(typeof s=="string"){const t=new Date(s);return isNaN(t.getTime())?new Date:t}return typeof s=="number"?s<1e10?new Date(s*1e3):new Date(s):new Date}function he(s){return ht(s).toLocaleTimeString()}const yt={class:"card user-message bg-light border-start border-primary border-3"},$t={class:"card-body"},wt={class:"d-flex justify-content-between align-items-center mb-2"},St={class:"text-muted"},kt=["innerHTML"],Ct={key:0,class:"tool-results mt-3"},xt={class:"tool-results-header text-muted small mb-2"},jt={class:"d-flex align-items-start gap-2"},Mt={class:"flex-grow-1"},Tt={class:"text-muted"},Et={key:0,class:"text-danger small"},Pt={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s;ge.setOptions({breaks:!0,gfm:!0});const d=u(()=>he(t.message.timestamp)),a=u(()=>{const f=t.message.content||"",i=ge.parse(f);return ke.sanitize(i)}),n=u(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),o=u(()=>t.message.metadata?.tool_results||[]);function p(f,i){return f?f.length<=i?f:f.substring(0,i)+"...":""}return(f,i)=>(l(),r("div",yt,[e("div",$t,[e("div",wt,[i[0]||(i[0]=e("div",{class:"d-flex align-items-center gap-2"},[e("span",{class:"message-icon"},"👤"),e("strong",{class:"message-role"},"User")],-1)),e("small",St,g(d.value),1)]),e("div",{class:"message-content",innerHTML:a.value},null,8,kt),n.value?(l(),r("div",Ct,[e("div",xt,[i[1]||(i[1]=e("i",{class:"bi bi-tools"},null,-1)),H(" Tool Results ("+g(o.value.length)+") ",1)]),(l(!0),r(Q,null,Z(o.value,(v,h)=>(l(),r("div",{key:h,class:W(["tool-result-summary p-2 mb-2 rounded",v.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",jt,[e("span",null,g(v.is_error?"❌":"✅"),1),e("div",Mt,[e("small",Tt,"Tool: "+g(v.tool_use_id),1),v.is_error?(l(),r("div",Et,g(p(v.content,200)),1)):P("",!0)])])],2))),128))])):P("",!0)])]))}},It=q(Pt,[["__scopeId","data-v-532549d1"]]),Lt={class:"thinking-block"},Dt={class:"text-muted ms-auto"},Ot={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},Nt=["innerHTML"],At={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(s){const t=s,d=I(!1),a=u(()=>t.thinking?.length||0),n=u(()=>{const p=t.thinking||"",f=ge.parse(p);return ke.sanitize(f)});function o(){d.value=!d.value}return(p,f)=>(l(),r("div",Lt,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:o},[e("i",{class:W(["bi",d.value?"bi-chevron-down":"bi-chevron-right"])},null,2),f[0]||(f[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),H(" Thinking ")],-1)),e("small",Dt,g(a.value)+" characters",1)]),d.value?(l(),r("div",Ot,[e("div",{class:"thinking-text",innerHTML:n.value},null,8,Nt)])):P("",!0)]))}},Rt=q(At,[["__scopeId","data-v-619a8344"]]),pe=ve("websocket",()=>{const s=I(null),t=I(!1),d=I(0),a=10,n=I(null),o=I(!1),p=I(0),f=5,i=I(null);let v=null;const h=I(0),y=I(null),_=I(null),b=I(!1),x=I(0),T=5,w=I(null),k=u(()=>t.value&&(o.value||!i.value)?"connected":t.value?"partial":"disconnected");function j(D){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${D}`}function m(){if(s.value)return;const D=j("/ws/ui");console.log(`Connecting to UI WebSocket: ${D}`),s.value=new WebSocket(D),s.value.onopen=()=>{t.value=!0,d.value=0,console.log("UI WebSocket connected")},s.value.onmessage=A=>{const R=JSON.parse(A.data);$(R)},s.value.onclose=()=>{if(t.value=!1,s.value=null,console.log("UI WebSocket closed"),d.value<a){d.value++;const A=Math.min(2e3*d.value,3e4);console.log(`Reconnecting UI WebSocket in ${A}ms (attempt ${d.value})`),setTimeout(m,A)}},s.value.onerror=A=>{console.error("UI WebSocket error:",A)}}function c(){s.value&&(s.value.close(),s.value=null,t.value=!1)}async function E(D){h.value++;const A=h.value;if(console.log(`[Gen ${A}] Starting connection to session ${D}`),v&&(clearTimeout(v),v=null),await N(),h.value!==A){console.log(`[Gen ${A}] Connection cancelled (current generation: ${h.value})`);return}i.value=D,y.value=A;const R=j(`/ws/session/${D}`);console.log(`[Gen ${A}] Connecting to Session WebSocket: ${R}`),n.value=new WebSocket(R),n.value.onopen=()=>{if(y.value!==A){console.log(`[Gen ${A}] Ignoring onopen (stale connection, current: ${y.value})`),n.value.close();return}o.value=!0,p.value=0,console.log(`[Gen ${A}] Session WebSocket connected for ${D}`)},n.value.onmessage=V=>{if(y.value!==A){console.log(`[Gen ${A}] Ignoring message (stale connection, current: ${y.value})`);return}const F=JSON.parse(V.data);O(F,D)},n.value.onclose=()=>{o.value=!1,n.value=null,console.log(`[Gen ${A}] Session WebSocket closed for ${D}`);const V=J();if(V.currentSessionId===D&&y.value===A&&p.value<f){p.value++;const F=Math.min(2e3*p.value,3e4);console.log(`[Gen ${A}] Reconnecting Session WebSocket in ${F}ms (attempt ${p.value})`),v=setTimeout(()=>{y.value===A&&V.currentSessionId===D?(v=null,E(D)):console.log(`[Gen ${A}] Skipping reconnect (generation or session changed)`)},F)}},n.value.onerror=V=>{console.error(`[Gen ${A}] Session WebSocket error:`,V)}}function N(){return new Promise(D=>{if(v&&(clearTimeout(v),v=null,console.log("Cancelled pending session reconnect timer")),n.value){const A=()=>{n.value=null,o.value=!1,i.value=null,y.value=null,p.value=0,D()};if(n.value.readyState===WebSocket.CLOSED)A();else{const R=setTimeout(()=>{console.warn("Session WebSocket close timeout - forcing cleanup"),A()},2e3);n.value.addEventListener("close",()=>{clearTimeout(R),A()},{once:!0}),n.value.close()}}else i.value=null,y.value=null,D()})}function S(D){n.value&&o.value?(n.value.send(JSON.stringify({type:"send_message",content:D})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function C(D,A,R=!1,V=null){if(n.value&&o.value){const F={type:"permission_response",request_id:D,decision:A,apply_suggestions:R,timestamp:new Date().toISOString()};V&&(F.clarification_message=V),n.value.send(JSON.stringify(F)),console.log(`Sent permission ${A} for request ${D}`,{applySuggestions:R,clarification:V})}}function M(){n.value&&o.value&&(n.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function $(D){const A=J(),R=se();switch(D.type){case"sessions_list":D.sessions&&Array.isArray(D.sessions)&&D.sessions.forEach(V=>{A.updateSession(V.session_id,V)});break;case"state_change":D.data&&D.data.session_id&&D.data.session&&A.updateSession(D.data.session_id,D.data.session);break;case"project_updated":if(D.data&&D.data.project){const V=D.data.project;R.updateProjectLocal(V.project_id,V)}break;case"project_deleted":D.data&&D.data.project_id&&R.projects.delete(D.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":s.value?.readyState===WebSocket.OPEN&&s.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",D.type)}}function O(D,A){const R=J();if(R.currentSessionId!==A){console.warn(`Ignoring message for session ${A} (current: ${R.currentSessionId})`);return}const V=me();switch(D.type){case"message":const F=D.data;if(!F||!F.type){console.warn("Received message event with invalid data:",D);break}if(F.type==="permission_request"){V.handlePermissionRequest(A,F);break}if(F.type==="permission_response"){V.handlePermissionResponse(A,F);break}F.metadata?.has_tool_uses&&F.metadata.tool_uses.forEach(z=>{V.handleToolUse(A,z)}),F.metadata?.has_tool_results&&F.metadata.tool_results.forEach(z=>{V.handleToolResult(A,z)}),F.type==="system"&&(F.subtype==="init"||F.metadata?.subtype==="init")&&F.metadata?.init_data&&R.storeInitData(A,F.metadata.init_data),V.addMessage(A,F);break;case"permission_request":V.handlePermissionRequest(A,D);break;case"permission_response":V.handlePermissionResponse(A,D);break;case"tool_result":V.handleToolResult(A,D);break;case"state_change":R.updateSession(A,D.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${A}`);break;case"ping":n.value?.readyState===WebSocket.OPEN&&n.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function L(D){U(),w.value=D;const A=j(`/ws/legion/${D}`);console.log(`Connecting to Legion WebSocket: ${A}`),_.value=new WebSocket(A),_.value.onopen=()=>{b.value=!0,x.value=0,console.log(`Legion WebSocket connected for ${D}`)},_.value.onmessage=R=>{const V=JSON.parse(R.data);B(V,D)},_.value.onclose=()=>{if(b.value=!1,_.value=null,console.log(`Legion WebSocket closed for ${D}`),w.value===D&&x.value<T){x.value++;const R=Math.min(2e3*x.value,3e4);setTimeout(()=>L(D),R)}},_.value.onerror=R=>{console.error("Legion WebSocket error:",R)}}function U(){_.value&&(_.value.close(),_.value=null,b.value=!1,w.value=null)}function B(D,A){ne(async()=>{const{useLegionStore:R}=await Promise.resolve().then(()=>Wa);return{useLegionStore:R}},void 0).then(({useLegionStore:R})=>{const V=R();switch(D.type){case"comm":D.comm&&(V.addComm(A,D.comm),console.log("Legion WebSocket: Received new comm",D.comm));break;case"minion_created":D.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",D.data),ne(async()=>{const{useSessionStore:F}=await Promise.resolve().then(()=>Ee);return{useSessionStore:F}},void 0).then(({useSessionStore:F})=>{F().loadSessions()}));break;case"minion_updated":D.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",D.data),ne(async()=>{const{useSessionStore:F}=await Promise.resolve().then(()=>Ee);return{useSessionStore:F}},void 0).then(({useSessionStore:F})=>{F().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${A}`);break;case"ping":_.value?.readyState===WebSocket.OPEN&&_.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",D.type)}})}return{uiConnected:t,sessionConnected:o,legionConnected:b,overallStatus:k,connectUI:m,disconnectUI:c,connectSession:E,disconnectSession:N,sendMessage:S,sendPermissionResponse:C,interruptSession:M,connectLegion:L,disconnectLegion:U}}),qt=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:pe},Symbol.toStringTag,{value:"Module"})),Ut={class:"base-tool-handler"},Wt={class:"tool-section mb-3"},Ht={class:"tool-parameters"},Ft={class:"tool-code"},Bt={key:0,class:"tool-section"},Vt={class:"tool-section-label"},zt={class:"tool-code"},Jt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),a=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),n=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),o=u(()=>{if(!a.value)return"";const p=t.toolCall.result;return p.content!==void 0?typeof p.content=="string"?p.content:JSON.stringify(p.content,null,2):p.message?p.message:JSON.stringify(p,null,2)});return(p,f)=>(l(),r("div",Ut,[e("div",Wt,[f[0]||(f[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Ht,[e("pre",Ft,g(d.value),1)])]),a.value?(l(),r("div",Bt,[e("div",Vt,g(n.value?"Error:":"Result:"),1),e("div",{class:W(["tool-result",{"tool-result-error":n.value}])},[e("pre",zt,g(o.value),1)],2)])):P("",!0)]))}},Gt=q(Jt,[["__scopeId","data-v-06a1b6c0"]]),Kt={class:"read-tool-handler"},Yt={class:"tool-section mb-3"},Qt={class:"read-file-info"},Zt={class:"file-path"},Xt={key:0,class:"read-range"},es={key:0,class:"tool-section"},ts={key:0,class:"tool-result tool-result-error"},ss={class:"tool-code"},os={key:1,class:"file-content-preview"},ns={class:"content-header"},ls={class:"line-count-badge"},as={key:0,class:"preview-note"},rs={class:"tool-code content-display"},is={key:0,class:"more-indicator"},$e=100,ds={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.input?.file_path||"Unknown"),a=u(()=>{const b=t.toolCall.input?.offset,x=t.toolCall.input?.limit;return b!==void 0||x!==void 0}),n=u(()=>{const b=t.toolCall.input?.offset;return b!==void 0?b+1:1}),o=u(()=>{const b=t.toolCall.input?.offset||0,x=t.toolCall.input?.limit;return x!==void 0?b+x:"∞"}),p=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),f=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),i=u(()=>{if(!p.value)return"";const b=t.toolCall.result;return b.content!==void 0?typeof b.content=="string"?b.content:JSON.stringify(b.content,null,2):b.message?b.message:JSON.stringify(b,null,2)}),v=u(()=>f.value||!i.value?[]:i.value.split(`
`)),h=u(()=>v.value.length),y=u(()=>h.value>$e),_=u(()=>f.value?"":v.value.slice(0,$e).join(`
`));return(b,x)=>(l(),r("div",Kt,[e("div",Yt,[e("div",Qt,[x[0]||(x[0]=e("span",{class:"file-icon"},"📄",-1)),x[1]||(x[1]=e("strong",null,"Reading:",-1)),e("code",Zt,g(d.value),1),a.value?(l(),r("span",Xt,"Lines "+g(n.value)+"-"+g(o.value),1)):P("",!0)])]),p.value?(l(),r("div",es,[f.value?(l(),r("div",ts,[e("pre",ss,g(i.value),1)])):(l(),r("div",os,[e("div",ns,[x[2]||(x[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",ls,g(h.value)+" lines",1),y.value?(l(),r("span",as,"(showing first "+g($e)+")")):P("",!0)]),e("pre",rs,g(_.value),1),y.value?(l(),r("div",is,"...")):P("",!0)]))])):P("",!0)]))}},us=q(ds,[["__scopeId","data-v-0382f812"]]),cs={class:"write-tool-handler"},ms={class:"tool-section mb-3"},ps={class:"write-file-info mb-2"},vs={class:"file-path"},fs={class:"write-content-preview"},gs={class:"content-header"},_s={class:"line-count-badge"},bs={key:0,class:"preview-note"},hs={class:"tool-code content-display"},ys={key:0,class:"more-indicator"},$s={key:0,class:"tool-section"},ws={key:0,class:"tool-result tool-result-error"},Ss={class:"tool-code"},ks={key:1,class:"tool-result tool-result-success"},Cs={class:"success-message"},we=100,xs={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.input?.file_path||"Unknown"),a=u(()=>t.toolCall.input?.content||""),n=u(()=>a.value.split(`
`)),o=u(()=>n.value.length),p=u(()=>o.value>we),f=u(()=>n.value.slice(0,we).join(`
`)),i=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),h=u(()=>{if(!i.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)});return(y,_)=>(l(),r("div",cs,[e("div",ms,[e("div",ps,[_[0]||(_[0]=e("span",{class:"file-icon"},"📝",-1)),_[1]||(_[1]=e("strong",null,"Writing:",-1)),e("code",vs,g(d.value),1)]),e("div",fs,[e("div",gs,[_[2]||(_[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",_s,g(o.value)+" lines",1),p.value?(l(),r("span",bs,"(showing first "+g(we)+")")):P("",!0)]),e("pre",hs,g(f.value),1),p.value?(l(),r("div",ys,"...")):P("",!0)])]),i.value?(l(),r("div",$s,[v.value?(l(),r("div",ws,[_[3]||(_[3]=e("strong",null,"Error:",-1)),e("pre",Ss,g(h.value),1)])):(l(),r("div",ks,[e("div",Cs,[_[4]||(_[4]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"File created successfully ("+g(o.value)+" lines written)",1)])]))])):P("",!0)]))}},js=q(xs,[["__scopeId","data-v-d09b89ef"]]),Ms={class:"bash-tool-handler"},Ts={class:"tool-section mb-3"},Es={class:"bash-header"},Ps={class:"bash-header-content"},Is={key:0,class:"bash-description"},Ls={key:1,class:"bash-flags"},Ds={class:"bash-command-section"},Os={class:"bash-command-content"},Ns={key:0,class:"tool-section"},As={key:0,class:"bash-output"},Rs={key:1,class:"bash-output-empty"},qs={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.input?.command||""),a=u(()=>t.toolCall.input?.description||""),n=u(()=>t.toolCall.input?.timeout),o=u(()=>t.toolCall.input?.run_in_background||!1),p=u(()=>n.value||o.value),f=u(()=>{const _=[];return n.value&&_.push(`timeout: ${n.value}ms`),o.value&&_.push("background"),_.join(", ")}),i=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),h=u(()=>v.value?"tool-result-error":"tool-result-success"),y=u(()=>{if(!i.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)});return(_,b)=>(l(),r("div",Ms,[e("div",Ts,[e("div",Es,[b[1]||(b[1]=e("span",{class:"bash-icon"},"💻",-1)),e("div",Ps,[a.value?(l(),r("div",Is,[b[0]||(b[0]=e("strong",null,"Description:",-1)),H(" "+g(a.value),1)])):P("",!0),p.value?(l(),r("div",Ls,g(f.value),1)):P("",!0)])]),e("div",Ds,[b[2]||(b[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",Os,g(d.value),1)])]),i.value?(l(),r("div",Ns,[e("div",{class:W(["tool-result",h.value])},[b[3]||(b[3]=e("strong",null,"Output:",-1)),y.value?(l(),r("pre",As,g(y.value),1)):(l(),r("div",Rs,"No output"))],2)])):P("",!0)]))}},Us=q(qs,[["__scopeId","data-v-dc93bb16"]]),Ws={class:"todo-tool-handler"},Hs={class:"tool-section mb-3"},Fs={class:"todo-header"},Bs={class:"todo-summary"},Vs={key:0,class:"todo-count todo-count-completed"},zs={key:1,class:"todo-count todo-count-in-progress"},Js={key:2,class:"todo-count todo-count-pending"},Gs={class:"todo-checklist"},Ks={class:"todo-checkbox"},Ys={class:"todo-content"},Qs={key:0,class:"tool-section"},Zs={key:0,class:"tool-result tool-result-error"},Xs={class:"tool-code"},eo={key:1,class:"tool-result tool-result-success"},to={class:"success-message"},so={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.input?.todos||[]),a=u(()=>d.value.filter(h=>h.status==="completed").length),n=u(()=>d.value.filter(h=>h.status==="in_progress").length),o=u(()=>d.value.filter(h=>h.status==="pending").length);function p(h){return{pending:"☐",in_progress:"◐",completed:"☑"}[h]||"☐"}const f=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),i=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),v=u(()=>{if(!f.value)return"";const h=t.toolCall.result;return h.content!==void 0?typeof h.content=="string"?h.content:JSON.stringify(h.content,null,2):h.message?h.message:JSON.stringify(h,null,2)});return(h,y)=>(l(),r("div",Ws,[e("div",Hs,[e("div",Fs,[y[0]||(y[0]=e("span",{class:"todo-icon"},"📋",-1)),y[1]||(y[1]=e("strong",null,"Task List:",-1)),e("div",Bs,[a.value>0?(l(),r("span",Vs,g(a.value)+" completed ",1)):P("",!0),n.value>0?(l(),r("span",zs,g(n.value)+" in progress ",1)):P("",!0),o.value>0?(l(),r("span",Js,g(o.value)+" pending ",1)):P("",!0)])]),e("div",Gs,[(l(!0),r(Q,null,Z(d.value,(_,b)=>(l(),r("div",{key:b,class:W(["todo-item",`todo-${_.status}`])},[e("span",Ks,g(p(_.status)),1),e("span",Ys,g(_.content),1)],2))),128))])]),f.value?(l(),r("div",Qs,[i.value?(l(),r("div",Zs,[y[2]||(y[2]=e("strong",null,"Error:",-1)),e("pre",Xs,g(v.value),1)])):(l(),r("div",eo,[e("div",to,[y[3]||(y[3]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"Task list updated ("+g(d.value.length)+" tasks)",1)])]))])):P("",!0)]))}},oo=q(so,[["__scopeId","data-v-0984bcf9"]]),no={class:"edit-tool-handler"},lo={class:"tool-section mb-3"},ao={class:"edit-file-info"},ro={class:"file-path"},io={key:0,class:"replace-all-badge"},uo={class:"edit-diff-container"},co={class:"diff-header"},mo={class:"diff-stats"},po={class:"stat-removed"},vo={class:"stat-added"},fo={class:"unified-diff"},go={class:"diff-scroll-container"},_o={class:"diff-marker"},bo={class:"diff-content"},ho={key:0,class:"tool-section"},yo={key:0,class:"tool-result tool-result-error"},$o={class:"tool-code"},wo={key:1,class:"tool-result tool-result-success"},So={class:"success-message"},ko={key:0,class:"success-detail"},Co={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.input?.file_path||"Unknown"),a=u(()=>t.toolCall.input?.old_string||""),n=u(()=>t.toolCall.input?.new_string||""),o=u(()=>t.toolCall.input?.replace_all||!1),p=u(()=>{const b=Be(d.value,a.value,n.value,"","",{context:3}).split(`
`),x=[];for(let T=4;T<b.length;T++){const w=b[T];w&&(w.startsWith("-")?x.push({type:"removed",content:w.substring(1)}):w.startsWith("+")?x.push({type:"added",content:w.substring(1)}):w.startsWith(" ")?x.push({type:"context",content:w.substring(1)}):w.startsWith("@@")&&x.push({type:"hunk",content:w}))}return x}),f=u(()=>p.value.filter(_=>_.type==="removed").length),i=u(()=>p.value.filter(_=>_.type==="added").length),v=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),h=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),y=u(()=>{if(!v.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)});return(_,b)=>(l(),r("div",no,[e("div",lo,[e("div",ao,[b[0]||(b[0]=e("span",{class:"file-icon"},"✏️",-1)),b[1]||(b[1]=e("strong",null,"Editing:",-1)),e("code",ro,g(d.value),1),o.value?(l(),r("span",io,"Replace All")):P("",!0)]),e("div",uo,[e("div",co,[b[2]||(b[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",mo,[e("span",po,"-"+g(f.value),1),e("span",vo,"+"+g(i.value),1)])]),e("div",fo,[e("div",go,[(l(!0),r(Q,null,Z(p.value,(x,T)=>(l(),r("div",{key:T,class:W(["diff-line",{"diff-line-removed":x.type==="removed","diff-line-added":x.type==="added","diff-line-context":x.type==="context","diff-line-hunk":x.type==="hunk"}])},[e("span",_o,g(x.type==="removed"?"-":x.type==="added"?"+":x.type==="hunk"?"@":" "),1),e("span",bo,g(x.content),1)],2))),128))])])])]),v.value?(l(),r("div",ho,[h.value?(l(),r("div",yo,[b[3]||(b[3]=e("strong",null,"Error:",-1)),e("pre",$o,g(y.value),1)])):(l(),r("div",wo,[e("div",So,[b[4]||(b[4]=e("span",{class:"success-icon"},"✅",-1)),b[5]||(b[5]=e("strong",null,"File edited successfully",-1)),o.value?(l(),r("span",ko,"(all occurrences replaced)")):P("",!0)])]))])):P("",!0)]))}},xo=q(Co,[["__scopeId","data-v-b06adbf2"]]),jo={class:"search-tool-handler"},Mo={class:"tool-section mb-3"},To={class:"search-info"},Eo={class:"search-icon"},Po={class:"search-pattern"},Io={key:0,class:"search-path"},Lo={key:1,class:"search-filters"},Do={key:0,class:"filter-badge"},Oo={key:1,class:"filter-badge"},No={key:2,class:"filter-badge"},Ao={key:0,class:"tool-section"},Ro={key:0,class:"tool-result tool-result-error"},qo={class:"tool-code"},Uo={key:1,class:"search-results"},Wo={class:"results-header"},Ho={class:"results-label"},Fo={class:"results-count-badge"},Bo={class:"results-content"},Vo={class:"tool-code"},zo={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.name==="Grep");u(()=>t.toolCall.name==="Glob");const a=u(()=>t.toolCall.input?.pattern||"Unknown"),n=u(()=>t.toolCall.input?.path||null),o=u(()=>t.toolCall.input?.type||null),p=u(()=>t.toolCall.input?.glob||null),f=u(()=>t.toolCall.input?.["-i"]||!1),i=u(()=>o.value||p.value||f.value),v=u(()=>d.value?"🔍":"📁"),h=u(()=>d.value?"Searching content":"Finding files"),y=u(()=>d.value?"Matches":"Files found"),_=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),b=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),x=u(()=>{if(!_.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)}),T=u(()=>!_.value||b.value||!x.value?0:x.value.split(`
`).filter(k=>k.trim()).length);return(w,k)=>(l(),r("div",jo,[e("div",Mo,[e("div",To,[e("span",Eo,g(v.value),1),e("strong",null,g(h.value)+":",1),e("code",Po,g(a.value),1),n.value?(l(),r("span",Io,"in "+g(n.value),1)):P("",!0),i.value?(l(),r("span",Lo,[o.value?(l(),r("span",Do,"type: "+g(o.value),1)):P("",!0),p.value?(l(),r("span",Oo,"glob: "+g(p.value),1)):P("",!0),f.value?(l(),r("span",No,"case-insensitive")):P("",!0)])):P("",!0)])]),_.value?(l(),r("div",Ao,[b.value?(l(),r("div",Ro,[k[0]||(k[0]=e("strong",null,"Error:",-1)),e("pre",qo,g(x.value),1)])):(l(),r("div",Uo,[e("div",Wo,[e("span",Ho,g(y.value)+":",1),e("span",Fo,g(T.value)+" "+g(T.value===1?"match":"matches"),1)]),e("div",Bo,[e("pre",Vo,g(x.value),1)])]))])):P("",!0)]))}},Pe=q(zo,[["__scopeId","data-v-dc01ae0d"]]),Jo={class:"web-tool-handler"},Go={class:"tool-section mb-3"},Ko={class:"web-info"},Yo={class:"web-icon"},Qo=["href"],Zo={key:1,class:"web-query"},Xo={key:0,class:"web-prompt-container"},en={class:"prompt-content"},tn={key:1,class:"web-domains"},sn={class:"domains-label"},on={key:0,class:"tool-section"},nn={key:0,class:"tool-result tool-result-error"},ln={class:"tool-code"},an={key:1,class:"web-results"},rn={class:"results-header"},dn={class:"results-label"},un={class:"results-content"},cn={class:"tool-code"},mn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.name==="WebFetch");u(()=>t.toolCall.name==="WebSearch");const a=u(()=>t.toolCall.input?.url||null),n=u(()=>t.toolCall.input?.query||null),o=u(()=>t.toolCall.input?.prompt||null),p=u(()=>t.toolCall.input?.allowed_domains||[]),f=u(()=>t.toolCall.input?.blocked_domains||[]),i=u(()=>p.value.length>0?p.value:f.value.length>0?f.value:[]),v=u(()=>p.value.length>0?"Allowed domains":f.value.length>0?"Blocked domains":"Domains"),h=u(()=>d.value?"🌐":"🔎"),y=u(()=>d.value?"Fetching URL":"Searching web"),_=u(()=>d.value?"Fetched content":"Search results"),b=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),x=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),T=u(()=>{if(!b.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)});return(w,k)=>(l(),r("div",Jo,[e("div",Go,[e("div",Ko,[e("span",Yo,g(h.value),1),e("strong",null,g(y.value)+":",1),a.value?(l(),r("a",{key:0,href:a.value,target:"_blank",class:"web-url"},g(a.value),9,Qo)):n.value?(l(),r("code",Zo,g(n.value),1)):P("",!0)]),o.value?(l(),r("div",Xo,[k[0]||(k[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",en,g(o.value),1)])):P("",!0),i.value.length>0?(l(),r("div",tn,[e("span",sn,g(v.value)+":",1),(l(!0),r(Q,null,Z(i.value,j=>(l(),r("span",{key:j,class:"domain-badge"},g(j),1))),128))])):P("",!0)]),b.value?(l(),r("div",on,[x.value?(l(),r("div",nn,[k[1]||(k[1]=e("strong",null,"Error:",-1)),e("pre",ln,g(T.value),1)])):(l(),r("div",an,[e("div",rn,[e("span",dn,g(_.value)+":",1)]),e("div",un,[e("pre",cn,g(T.value),1)])]))])):P("",!0)]))}},Ie=q(mn,[["__scopeId","data-v-49e16a90"]]),pn={class:"task-tool-handler"},vn={class:"tool-section mb-3"},fn={class:"task-header"},gn={key:0,class:"agent-type-badge"},_n={key:0,class:"task-description"},bn={class:"description-content"},hn={key:1,class:"task-prompt-container"},yn={class:"prompt-header"},$n={class:"prompt-length"},wn={class:"prompt-code"},Sn={key:0,class:"tool-section"},kn={key:0,class:"tool-result tool-result-error"},Cn={class:"tool-code"},xn={key:1,class:"agent-output"},jn={class:"output-header"},Mn={key:0,class:"output-count-badge"},Tn={class:"output-content"},En={class:"tool-code"},Pn={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.input?.description||null),a=u(()=>t.toolCall.input?.prompt||null),n=u(()=>t.toolCall.input?.subagent_type||null),o=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),p=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),f=u(()=>{if(!o.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)}),i=u(()=>f.value?f.value.split(`
`).length:0);return(v,h)=>(l(),r("div",pn,[e("div",vn,[e("div",fn,[h[0]||(h[0]=e("span",{class:"task-icon"},"🤖",-1)),h[1]||(h[1]=e("strong",null,"Agent Task:",-1)),n.value?(l(),r("span",gn,g(n.value),1)):P("",!0)]),d.value?(l(),r("div",_n,[h[2]||(h[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",bn,g(d.value),1)])):P("",!0),a.value?(l(),r("div",hn,[e("div",yn,[h[3]||(h[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",$n,g(a.value.length)+" characters",1)]),e("pre",wn,g(a.value),1)])):P("",!0)]),o.value?(l(),r("div",Sn,[p.value?(l(),r("div",kn,[h[4]||(h[4]=e("strong",null,"Error:",-1)),e("pre",Cn,g(f.value),1)])):(l(),r("div",xn,[e("div",jn,[h[5]||(h[5]=e("span",{class:"output-label"},"Agent Output:",-1)),i.value>0?(l(),r("span",Mn,g(i.value)+" lines",1)):P("",!0)]),e("div",Tn,[e("pre",En,g(f.value),1)])]))])):P("",!0)]))}},In=q(Pn,[["__scopeId","data-v-513043f9"]]),Ln={class:"notebook-edit-tool-handler"},Dn={class:"tool-section mb-3"},On={class:"notebook-info"},Nn={class:"file-path"},An={class:"cell-info mt-2"},Rn={class:"info-row"},qn={class:"info-row"},Un={key:0,class:"info-row"},Wn={class:"badge bg-info"},Hn={key:0,class:"source-preview mt-3"},Fn={class:"preview-header"},Bn={class:"preview-stats"},Vn={class:"source-code"},zn={key:0,class:"tool-section"},Jn={key:0},Gn={key:1,class:"text-danger"},Kn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.input?.notebook_path||"Unknown"),a=u(()=>t.toolCall.input?.cell_id),n=u(()=>t.toolCall.input?.cell_type||"code"),o=u(()=>t.toolCall.input?.edit_mode||"replace"),p=u(()=>t.toolCall.input?.new_source||""),f=u(()=>p.value.split(`
`).length),i=u(()=>n.value==="code"?"bg-primary":"bg-secondary"),v=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),h=u(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const y=o.value;return y==="insert"?"Cell inserted successfully":y==="delete"?"Cell deleted successfully":"Cell updated successfully"});return(y,_)=>(l(),r("div",Ln,[e("div",Dn,[e("div",On,[_[0]||(_[0]=e("span",{class:"notebook-icon"},"📓",-1)),_[1]||(_[1]=e("strong",null,"Notebook:",-1)),e("code",Nn,g(d.value),1)]),e("div",An,[e("div",Rn,[_[2]||(_[2]=e("strong",null,"Cell ID:",-1)),e("code",null,g(a.value||"N/A"),1)]),e("div",qn,[_[3]||(_[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:W(["badge",i.value])},g(n.value),3)]),o.value?(l(),r("div",Un,[_[4]||(_[4]=e("strong",null,"Edit Mode:",-1)),e("span",Wn,g(o.value),1)])):P("",!0)]),p.value?(l(),r("div",Hn,[e("div",Fn,[_[5]||(_[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",Bn,g(f.value)+" lines",1)]),e("pre",Vn,[e("code",null,g(p.value),1)])])):P("",!0)]),s.toolCall.result?(l(),r("div",zn,[_[8]||(_[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:W(["tool-result",v.value])},[s.toolCall.result.success!==!1?(l(),r("div",Jn,[_[6]||(_[6]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+g(h.value),1)])):(l(),r("div",Gn,[_[7]||(_[7]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+g(s.toolCall.result.error||"Operation failed"),1)]))],2)])):P("",!0)]))}},Yn=q(Kn,[["__scopeId","data-v-3261abc1"]]),Qn={class:"shell-tool-handler"},Zn={class:"tool-section mb-3"},Xn={class:"shell-info"},el={class:"shell-icon"},tl={key:0,class:"shell-id"},sl={key:0,class:"filter-info mt-2"},ol={class:"filter-pattern"},nl={key:0,class:"tool-section"},ll={class:"result-header mb-2"},al={key:0,class:"shell-output"},rl={key:0},il={key:1,class:"text-danger"},dl={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.name==="BashOutput"?"📤":t.toolCall.name==="KillShell"?"🛑":"🐚"),a=u(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),n=u(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),o=u(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),p=u(()=>t.toolCall.input?.filter),f=u(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),i=u(()=>t.toolCall.result?.status),v=u(()=>{const _=i.value;return _==="running"?"bg-success":_==="completed"?"bg-secondary":_==="killed"||_==="terminated"?"bg-danger":"bg-info"}),h=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),y=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return(_,b)=>(l(),r("div",Qn,[e("div",Zn,[e("div",Xn,[e("span",el,g(d.value),1),e("strong",null,g(a.value)+":",1),o.value?(l(),r("code",tl,"Shell "+g(o.value),1)):P("",!0)]),s.toolCall.name==="BashOutput"&&p.value?(l(),r("div",sl,[b[0]||(b[0]=e("strong",null,"Filter:",-1)),e("code",ol,g(p.value),1)])):P("",!0)]),s.toolCall.result?(l(),r("div",nl,[e("div",ll,[e("strong",null,g(n.value)+":",1),i.value?(l(),r("span",{key:0,class:W(["badge",v.value])},g(i.value),3)):P("",!0)]),f.value?(l(),r("div",al,[e("pre",null,[e("code",null,g(f.value),1)])])):(l(),r("div",{key:1,class:W(["tool-result",h.value])},[s.toolCall.result.success!==!1?(l(),r("div",rl,[b[1]||(b[1]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+g(y.value),1)])):(l(),r("div",il,[b[2]||(b[2]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+g(s.toolCall.result.error||"Operation failed"),1)]))],2))])):P("",!0)]))}},Le=q(dl,[["__scopeId","data-v-fc9da4c0"]]),ul={class:"command-tool-handler"},cl={class:"tool-section mb-3"},ml={class:"command-info"},pl={class:"command-icon"},vl={class:"command-code"},fl={key:0,class:"prompt-info mt-2"},gl={class:"prompt-content"},_l={key:0,class:"tool-section"},bl={key:0},hl={key:1,class:"text-danger"},yl={__name:"CommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.name==="SlashCommand"?"/":t.toolCall.name==="Skill"?"⚡":"🔧"),a=u(()=>t.toolCall.name==="SlashCommand"?"Slash Command":t.toolCall.name==="Skill"?"Skill":"Command"),n=u(()=>t.toolCall.input?.command||"Unknown"),o=u(()=>t.toolCall.result?.prompt||t.toolCall.result?.description),p=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),f=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="SlashCommand"?"Slash command executed successfully":t.toolCall.name==="Skill"?"Skill executed successfully":"Command completed");return(i,v)=>(l(),r("div",ul,[e("div",cl,[e("div",ml,[e("span",pl,g(d.value),1),e("strong",null,g(a.value)+":",1),e("code",vl,g(n.value),1)]),o.value?(l(),r("div",fl,[v[0]||(v[0]=e("div",{class:"prompt-header"},[e("strong",null,"Expanded Prompt:")],-1)),e("div",gl,g(o.value),1)])):P("",!0)]),s.toolCall.result?(l(),r("div",_l,[v[3]||(v[3]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:W(["tool-result",p.value])},[s.toolCall.result.success!==!1?(l(),r("div",bl,[v[1]||(v[1]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+g(f.value),1)])):(l(),r("div",hl,[v[2]||(v[2]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+g(s.toolCall.result.error||"Command execution failed"),1)]))],2)])):P("",!0)]))}},De=q(yl,[["__scopeId","data-v-57a8f93b"]]),$l={class:"exit-plan-mode-tool-handler"},wl={class:"tool-section mb-3"},Sl={key:0,class:"plan-content mt-2"},kl={class:"plan-text"},Cl={key:0,class:"tool-section"},xl={key:0},jl={key:1,class:"text-danger"},Ml={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>t.toolCall.input?.plan),a=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(n,o)=>(l(),r("div",$l,[e("div",wl,[o[1]||(o[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"📋"),e("strong",null,"Exiting Plan Mode")],-1)),d.value?(l(),r("div",Sl,[o[0]||(o[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",kl,g(d.value),1)])):P("",!0)]),s.toolCall.result?(l(),r("div",Cl,[o[4]||(o[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:W(["tool-result",a.value])},[s.toolCall.result.success!==!1?(l(),r("div",xl,[...o[2]||(o[2]=[e("i",{class:"bi bi-check-circle"},null,-1),H(" Permission mode reverted to default ",-1)])])):(l(),r("div",jl,[o[3]||(o[3]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+g(s.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):P("",!0)]))}},Tl=q(Ml,[["__scopeId","data-v-f1d32203"]]),El={class:"d-flex align-items-center gap-2 flex-grow-1"},Pl={class:"tool-status-icon"},Il={class:"tool-name"},Ll={class:"text-muted small"},Dl={class:"d-flex align-items-center gap-2"},Ol={class:"text-muted"},Nl={key:0,class:"card-body"},Al={key:0,class:"alert alert-warning mb-3"},Rl={class:"d-flex align-items-center"},ql={class:"mb-0 small"},Ul={key:1,class:"permission-prompt mt-3"},Wl={class:"alert alert-warning mb-3"},Hl={class:"mb-0"},Fl={class:"tool-name"},Bl={key:0,class:"suggestions-section mb-3"},Vl={class:"alert alert-info mb-0"},zl={class:"suggestion-details p-2 bg-white rounded"},Jl={class:"permission-buttons d-flex gap-2 mb-3"},Gl=["disabled"],Kl=["disabled"],Yl=["disabled"],Ql={class:"guidance-section mt-3"},Zl=["disabled"],Xl=["disabled"],ea={key:2,class:"mt-3"},ta={class:"alert alert-warning mb-0"},sa={class:"d-flex align-items-center"},oa={class:"mb-0 small"},na={key:3,class:"tool-section mt-3"},la={class:"alert alert-danger mb-0"},aa={key:0},ra={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,d=me(),a=J(),n=pe(),o=I(!1),p=I(null),f=I(""),i=u(()=>d.isToolUseOrphaned(a.currentSessionId,t.toolCall.id)),v=u(()=>d.getOrphanedInfo(a.currentSessionId,t.toolCall.id)),h={Read:us,Write:js,Bash:Us,TodoWrite:oo,Edit:xo,Grep:Pe,Glob:Pe,WebFetch:Ie,WebSearch:Ie,Task:In,NotebookEdit:Yn,BashOutput:Le,KillShell:Le,SlashCommand:De,Skill:De,ExitPlanMode:Tl},y=u(()=>{const E=t.toolCall.name;return h[E]?h[E]:Gt}),_=u(()=>{const E=[];switch(t.toolCall.status){case"pending":E.push("border-secondary");break;case"permission_required":E.push("border-warning");break;case"executing":E.push("border-primary");break;case"completed":w.value||t.toolCall.permissionDecision==="deny"?E.push("border-danger"):E.push("border-success");break;case"error":E.push("border-danger");break}return E.join(" ")}),b=u(()=>{switch(t.toolCall.status){case"pending":return"🔄";case"permission_required":return"❓";case"executing":return"⚡";case"completed":return t.toolCall.permissionDecision==="deny"?"❌":w.value?"💥":"✅";case"error":return"💥";default:return"🔧"}}),x=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Executing...";case"completed":return t.toolCall.permissionDecision==="deny"?"Denied":w.value?"Error":"Completed";case"error":return"Error";default:return"Unknown"}}),T=u(()=>he(t.toolCall.timestamp)),w=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),k=u(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function j(){const E=a.currentSessionId;E&&d.toggleToolExpansion(E,t.toolCall.id)}function m(E){return E.type==="setMode"?`Set permission mode to "${E.mode}"`:E.type==="allow"?`Allow tool: ${E.tool}`:JSON.stringify(E)}async function c(E,N,S=null){if(!o.value){o.value=!0,E==="allow"?p.value=N?"approve-apply":"approve":S?p.value="deny-guidance":p.value="deny";try{const C=a.currentSessionId;if(C){const M=N&&t.toolCall.suggestions?t.toolCall.suggestions:[];d.handlePermissionResponse(C,{request_id:t.toolCall.permissionRequestId,decision:E,reasoning:E==="allow"?"User allowed permission":"User denied permission",applied_updates:M})}await n.sendPermissionResponse(t.toolCall.permissionRequestId,E,N,S)}catch(C){console.error("Failed to send permission response:",C)}finally{o.value=!1,p.value=null}}}return(E,N)=>(l(),r("div",{class:W(["tool-call-card card mb-3",_.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:j},[e("div",El,[e("span",Pl,g(b.value),1),e("strong",Il,g(s.toolCall.name),1),e("span",Ll,g(x.value),1)]),e("div",Dl,[e("small",Ol,g(T.value),1),e("i",{class:W(["bi",s.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),s.toolCall.isExpanded?(l(),r("div",Nl,[i.value?(l(),r("div",Al,[e("div",Rl,[N[6]||(N[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[N[5]||(N[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",ql,g(v.value?.message||"Session was terminated"),1)])])])):P("",!0),(l(),re(Ne(y.value),{toolCall:s.toolCall},null,8,["toolCall"])),s.toolCall.status==="permission_required"&&!i.value?(l(),r("div",Ul,[e("div",Wl,[N[9]||(N[9]=e("p",{class:"mb-2"},[e("strong",null,"🔐 Permission Required")],-1)),e("p",Hl,[N[7]||(N[7]=H("Claude wants to use the ",-1)),e("code",Fl,g(s.toolCall.name),1),N[8]||(N[8]=H(" tool.",-1))])]),k.value?(l(),r("div",Bl,[e("div",Vl,[N[10]||(N[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),H(" Suggested Permission Update ")],-1)),N[11]||(N[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",zl,[(l(!0),r(Q,null,Z(s.toolCall.suggestions,(S,C)=>(l(),r("div",{key:C,class:"suggestion-item"},[e("code",null,g(m(S)),1)]))),128))]),N[12]||(N[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):P("",!0),e("div",Jl,[k.value?(l(),r("button",{key:0,class:"btn btn-success",onClick:N[0]||(N[0]=S=>c("allow",!0)),disabled:o.value},[N[13]||(N[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),H(" "+g(o.value&&p.value==="approve-apply"?"⏳ Submitting...":"✅ Approve & Apply"),1)],8,Gl)):P("",!0),e("button",{class:W(["btn",k.value?"btn-outline-success":"btn-success"]),onClick:N[1]||(N[1]=S=>c("allow",!1)),disabled:o.value},[N[14]||(N[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),H(" "+g(o.value&&p.value==="approve"?"⏳ Submitting...":k.value?"✅ Approve Only":"✅ Approve"),1)],10,Kl),e("button",{class:"btn btn-danger",onClick:N[2]||(N[2]=S=>c("deny",!1)),disabled:o.value},[N[15]||(N[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),H(" "+g(o.value&&p.value==="deny"?"⏳ Submitting...":"❌ Deny"),1)],8,Yl)]),e("div",Ql,[N[17]||(N[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),H(" Provide Guidance (Optional) ")],-1)),N[18]||(N[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),K(e("textarea",{"onUpdate:modelValue":N[3]||(N[3]=S=>f.value=S),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:o.value},null,8,Zl),[[te,f.value]]),f.value.trim()?(l(),r("button",{key:0,class:"btn btn-warning btn-sm",onClick:N[4]||(N[4]=S=>c("deny",!1,f.value)),disabled:o.value},[N[16]||(N[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),H(" "+g(o.value&&p.value==="deny-guidance"?"⏳ Submitting...":"💡 Provide Guidance & Continue"),1)],8,Xl)):P("",!0)])])):P("",!0),s.toolCall.status==="permission_required"&&i.value?(l(),r("div",ea,[e("div",ta,[e("div",sa,[N[20]||(N[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[N[19]||(N[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",oa,g(v.value?.message||"Session was terminated before permission could be granted"),1)])])])])):P("",!0),s.toolCall.permissionDecision==="deny"?(l(),r("div",na,[e("div",la,[N[21]||(N[21]=e("i",{class:"bi bi-x-circle"},null,-1)),N[22]||(N[22]=H(" Permission denied ",-1)),s.toolCall.result?.message?(l(),r("span",aa," - "+g(s.toolCall.result.message),1)):P("",!0)])])):P("",!0)])):P("",!0)],2))}},ia=q(ra,[["__scopeId","data-v-194786d1"]]),da={class:"card assistant-message bg-white border-start border-success border-3"},ua={class:"card-body"},ca={class:"d-flex justify-content-between align-items-center mb-2"},ma={class:"d-flex align-items-center gap-2"},pa={key:0,class:"text-muted"},va={class:"text-muted"},fa={key:0,class:"thinking-block mb-3"},ga=["innerHTML"],_a={key:2,class:"tool-calls mt-3"},ba={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,d=me(),a=J();ge.setOptions({breaks:!0,gfm:!0});const n=u(()=>he(t.message.timestamp)),o=u(()=>t.message.metadata?.model||null),p=u(()=>{const b=t.message.content||"";return b.trim().length>0&&b!=="Assistant response"}),f=u(()=>{const b=t.message.content||"",x=ge.parse(b);return ke.sanitize(x)}),i=u(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),v=u(()=>t.message.metadata?.thinking_content||""),h=u(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),y=u(()=>t.message.metadata?.tool_uses||[]),_=u(()=>{const b=a.currentSessionId;if(!b)return[];const x=d.toolCallsBySession.get(b)||[];return y.value.map(T=>{const w=x.find(k=>k.id===T.id);return w||{id:T.id,name:T.name,input:T.input,status:"pending",result:null,timestamp:T.timestamp||t.message.timestamp,isExpanded:!0}})});return(b,x)=>(l(),r("div",da,[e("div",ua,[e("div",ca,[e("div",ma,[x[0]||(x[0]=e("span",{class:"message-icon"},"🤖",-1)),x[1]||(x[1]=e("strong",{class:"message-role"},"Assistant",-1)),o.value?(l(),r("small",pa,g(o.value),1)):P("",!0)]),e("small",va,g(n.value),1)]),i.value?(l(),r("div",fa,[Y(Rt,{thinking:v.value},null,8,["thinking"])])):P("",!0),p.value?(l(),r("div",{key:1,class:"message-content",innerHTML:f.value},null,8,ga)):P("",!0),h.value?(l(),r("div",_a,[(l(!0),r(Q,null,Z(_.value,T=>(l(),re(ia,{key:T.id,toolCall:T},null,8,["toolCall"]))),128))])):P("",!0)])]))}},ha=q(ba,[["__scopeId","data-v-25a87a40"]]),ya={class:"card system-message bg-info bg-opacity-10 border-info"},$a={class:"card-body py-2 px-3"},wa={class:"d-flex align-items-center gap-2"},Sa={class:"text-muted flex-grow-1"},ka={class:"text-muted"},Ca={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>he(t.message.timestamp));return(a,n)=>(l(),r("div",ya,[e("div",$a,[e("div",wa,[n[0]||(n[0]=e("i",{class:"bi bi-info-circle text-info"},null,-1)),e("small",Sa,g(s.message.content),1),e("small",ka,g(d.value),1)])])]))}},Oe=q(Ca,[["__scopeId","data-v-bba7a395"]]),xa={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(s){const t=s,d=u(()=>{switch(t.message.type){case"user":return It;case"assistant":return ha;case"system":return Oe;default:return Oe}});return(a,n)=>(l(),r("div",{class:W(["message-item mb-3",`message-${s.message.type}`])},[(l(),re(Ne(d.value),{message:s.message},null,8,["message"]))],2))}},ja=q(xa,[["__scopeId","data-v-fbd275ac"]]),Ma={key:0,class:"text-muted text-center py-5"},Ta={__name:"MessageList",setup(s){const t=me(),d=ee(),a=I(null),n=u(()=>t.currentMessages.filter(i=>p(i)));u(()=>t.currentToolCalls);async function o(){d.autoScrollEnabled&&(await Se(),a.value&&(a.value.scrollTop=a.value.scrollHeight))}X(()=>t.currentMessages.length,o),X(()=>t.currentToolCalls.length,o),X(()=>t.currentToolCalls.map(i=>`${i.id}-${i.status}`).join(","),o),le(()=>{setTimeout(()=>{o()},100)});function p(i){const v=i.subtype||i.metadata?.subtype;if(i.type==="system"&&v==="init"||i.type==="result"||i.type==="permission_request"||i.type==="permission_response")return!1;if(i.type==="user"&&i.metadata?.has_tool_results){const h=i.content||"";if(h.match(/^Tool results?: \d+ results?$/i)||h.trim()==="")return!1}return!0}function f(i){return{type:i.type||"unknown",content:i.content||"",timestamp:i.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...i.metadata}}}return(i,v)=>(l(),r("div",{class:"messages-area flex-grow-1 overflow-auto p-3",ref_key:"messagesArea",ref:a},[n.value.length===0?(l(),r("div",Ma," No messages yet. Start a conversation! ")):P("",!0),(l(!0),r(Q,null,Z(n.value,(h,y)=>(l(),re(ja,{key:`msg-${h.timestamp}-${y}`,message:f(h)},null,8,["message"]))),128))],512))}},Ea=q(Ta,[["__scopeId","data-v-1884c681"]]),Pa={class:"border-top bg-light"},Ia={class:"d-flex gap-2 align-items-end px-2 py-1"},La=["placeholder","disabled","onKeydown"],Da=["disabled"],Oa={__name:"InputArea",setup(s){const t=J(),d=pe(),a=I(null),n=u({get:()=>t.currentInput,set:_=>{t.currentInput=_}}),o=u(()=>t.currentSession?.is_processing||!1),p=u(()=>d.sessionConnected),f=u(()=>t.currentSession?.state==="starting"),i=u(()=>f.value?"Session is starting...":p.value?"Type your message to Claude Code...":"Waiting for connection...");function v(){const _=a.value;if(!_)return;_.style.height="auto";const b=Math.min(_.scrollHeight,parseInt(getComputedStyle(_).maxHeight));_.style.height=b+"px"}function h(){n.value.trim()&&(d.sendMessage(n.value),n.value="",a.value&&(a.value.style.height="auto"))}function y(){d.interruptSession()}return(_,b)=>(l(),r("div",Pa,[e("div",Ia,[K(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:a,"onUpdate:modelValue":b[0]||(b[0]=x=>n.value=x),class:"form-control",placeholder:i.value,disabled:f.value||!p.value,rows:"1",onInput:v,onKeydown:Ae(ie(h,["exact","prevent"]),["enter"])},null,40,La),[[te,n.value]]),o.value?(l(),r("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:y}," Stop ")):(l(),r("button",{key:1,class:"btn btn-primary",disabled:!n.value.trim()||!p.value||f.value,onClick:h}," Send ",8,Da))])]))}},Na=q(Oa,[["__scopeId","data-v-a72bf16a"]]),Aa={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},Ra={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},qa={class:"text-secondary"},Ua={class:"d-flex flex-column flex-grow-1 overflow-hidden"},qe={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,d=J(),a=ee(),n=u(()=>d.currentSession),o=u(()=>a.isLoading),p=u(()=>a.loadingMessage);return le(async()=>{if(t.sessionId!==d.currentSessionId){a.showLoading("Loading session...");try{await d.selectSession(t.sessionId)}finally{a.hideLoading()}}}),X(()=>t.sessionId,async(f,i)=>{if(f!==i&&f!==d.currentSessionId){a.showLoading("Loading session...");try{await d.selectSession(f)}finally{a.hideLoading()}}}),ae(()=>{}),(f,i)=>(l(),r("div",Aa,[o.value?(l(),r("div",Ra,[i[0]||(i[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",qa,g(p.value),1)])):P("",!0),n.value?(l(),re(ot,{key:1,"session-id":t.sessionId},null,8,["session-id"])):P("",!0),e("div",Ua,[Y(Ea)]),Y(Na),n.value?(l(),re(it,{key:2,"session-id":t.sessionId},null,8,["session-id"])):P("",!0),n.value?(l(),re(_t,{key:3,"session-id":t.sessionId},null,8,["session-id"])):P("",!0)]))}},Ce=ve("legion",()=>{const s=I(new Map),t=I(new Map),d=I(new Map),a=I(new Map),n=I(null),o=u(()=>s.value.get(n.value)||[]),p=u(()=>t.value.get(n.value)||[]),f=u(()=>d.value.get(n.value)||[]),i=u(()=>a.value.get(n.value)||[]);function v(j){n.value=j}async function h(j,m=100,c=0){try{const E=await G.get(`/api/legions/${j}/timeline?limit=${m}&offset=${c}`),N=E.comms||[],S=E.total_count||N.length,C=E.has_more||!1;return N.sort((M,$)=>new Date(M.timestamp)-new Date($.timestamp)),console.log(`Loaded ${N.length} of ${S} comms for legion ${j}`),s.value.set(j,N),s.value=new Map(s.value),{comms:N,totalCount:S,hasMore:C}}catch(E){throw console.error("Failed to load timeline:",E),E}}function y(j,m){s.value.has(j)||s.value.set(j,[]),s.value.get(j).push(m),s.value=new Map(s.value)}async function _(j,m){try{const E=(await G.post(`/api/legions/${j}/comms`,m)).comm;return console.log(`Sent comm ${E.comm_id} to legion ${j}`),E}catch(c){throw console.error("Failed to send comm:",c),c}}async function b(j){return console.log(`Minions for legion ${j} are already available in session store`),[]}async function x(j,m){try{const E=(await G.post(`/api/legions/${j}/minions`,m)).minion;return await b(j),console.log(`Created minion ${E.minion_id} in legion ${j}`),E}catch(c){throw console.error("Failed to create minion:",c),c}}async function T(j){try{const c=(await G.get(`/api/legions/${j}/hordes`)).hordes||[];return console.log(`Loaded ${c.length} hordes for legion ${j}`),d.value.set(j,c),d.value=new Map(d.value),c}catch(m){throw console.error("Failed to load hordes:",m),m}}async function w(j){try{const c=(await G.get(`/api/legions/${j}/channels`)).channels||[];return console.log(`Loaded ${c.length} channels for legion ${j}`),a.value.set(j,c),a.value=new Map(a.value),c}catch(m){throw console.error("Failed to load channels:",m),m}}function k(j){s.value.delete(j),t.value.delete(j),d.value.delete(j),a.value.delete(j),s.value=new Map(s.value),t.value=new Map(t.value),d.value=new Map(d.value),a.value=new Map(a.value)}return{commsByLegion:s,minionsByLegion:t,hordesByLegion:d,channelsByLegion:a,currentLegionId:n,currentComms:o,currentMinions:p,currentHordes:f,currentChannels:i,setCurrentLegion:v,loadTimeline:h,addComm:y,sendComm:_,loadMinions:b,createMinion:x,loadHordes:T,loadChannels:w,clearLegionData:k}}),Wa=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:Ce},Symbol.toStringTag,{value:"Module"})),Ha={class:"timeline-header border-bottom p-3"},Fa={class:"project-name"},Ba=["title"],Va={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(s){const t=s,d=se(),a=u(()=>d.projects.get(t.legionId)),n=u(()=>a.value?.name||"Legion");return(o,p)=>(l(),r("div",Ha,[e("div",null,[e("div",Fa,g(n.value),1),e("div",{class:"view-name",title:s.legionId},"Timeline",8,Ba)])]))}},za=q(Va,[["__scopeId","data-v-44f386f5"]]),Ja={class:"timeline-status-bar border-top p-2 bg-light"},Ga={class:"d-flex justify-content-end"},Ka={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(s){const t=ee();function d(){t.setAutoScroll(!t.autoScrollEnabled)}return(a,n)=>(l(),r("div",Ja,[e("div",Ga,[e("button",{class:W(["btn btn-sm",be(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:d}," ⬇️ "+g(be(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},Ya=q(Ka,[["__scopeId","data-v-891c73db"]]),Qa={class:"comm-composer border-top p-3"},Za={class:"d-flex gap-2 mb-2"},Xa={class:"flex-grow-1"},er=["disabled"],tr={label:"Minions"},sr=["value"],or={key:0,label:"Channels"},nr=["value"],lr={style:{"min-width":"150px"}},ar=["disabled"],rr={class:"d-flex gap-2 align-items-end position-relative"},ir={class:"flex-grow-1 position-relative"},dr=["disabled"],ur=["onClick","onMouseenter"],cr=["disabled"],mr={key:0},pr={key:1},vr={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(s){const t=s,d=Ce(),a=J(),n=se(),o=I(""),p=I("task"),f=I(""),i=I(!1),v=I(!1),h=I([]),y=I(0),_=I(-1),b=I(null),x=I(null),T=u(()=>{const $=n.projects.get(t.legionId);return!$||!$.session_ids?[]:$.session_ids.map(O=>a.sessions.get(O)).filter(O=>O&&O.is_minion)}),w=u(()=>d.currentChannels||[]),k=u(()=>o.value&&f.value.trim().length>0);function j($){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[$.state]||"○"}function m($){return $.is_minion&&$.role?`${$.name} (${$.role})`:$.name}function c(){const $=b.value;if(!$)return;$.style.height="auto";const O=Math.min($.scrollHeight,parseInt(getComputedStyle($).maxHeight));$.style.height=O+"px"}function E(){const $=b.value;if(!$)return;c();const O=f.value,L=$.selectionStart,U=O.substring(0,L),B=U.lastIndexOf("#");if(B===-1){v.value=!1;return}const D=U.substring(B+1).toLowerCase();if(D.includes(" ")){v.value=!1;return}const A=T.value.filter(R=>R.name.toLowerCase().includes(D)).map(R=>({type:"minion",name:R.name,role:R.role,id:R.session_id,state:R.state}));if(A.length===0){v.value=!1;return}h.value=A,y.value=0,_.value=B,v.value=!0}function N(){if(!x.value)return;const $=x.value,O=$.children[y.value];if(!O)return;const L=O.offsetTop,U=O.offsetHeight,B=$.scrollTop,D=$.clientHeight;L<B?$.scrollTop=L:L+U>B+D&&($.scrollTop=L+U-D)}function S($){if(!v.value){$.key==="Enter"&&!$.shiftKey&&k.value&&($.preventDefault(),M());return}if($.key==="ArrowDown")$.preventDefault(),y.value=(y.value+1)%h.value.length,N();else if($.key==="ArrowUp")$.preventDefault(),y.value=y.value===0?h.value.length-1:y.value-1,N();else if($.key==="Enter"){$.preventDefault();const O=h.value[y.value];O&&C(O)}else $.key==="Escape"&&(v.value=!1)}function C($){const O=b.value;if(!O)return;const L=f.value,U=O.selectionStart,B=L.substring(0,_.value)+"#"+$.name+" "+L.substring(U);f.value=B;const D=_.value+$.name.length+2;setTimeout(()=>{O.setSelectionRange(D,D),O.focus()},0),v.value=!1}async function M(){if(!(!k.value||i.value)){i.value=!0;try{const[$,O]=o.value.split(":"),L={comm_type:p.value,content:f.value.trim()};$==="minion"?L.to_minion_id=O:$==="channel"&&(L.to_channel_id=O),await d.sendComm(t.legionId,L),f.value="",c()}catch($){console.error("Failed to send comm:",$),alert(`Failed to send comm: ${$.message}`)}finally{i.value=!1}}}return X(v,$=>{if($){const O=L=>{L.target.closest(".comm-composer")||(v.value=!1,document.removeEventListener("click",O))};setTimeout(()=>document.addEventListener("click",O),0)}}),($,O)=>(l(),r("div",Qa,[e("div",Za,[e("div",Xa,[K(e("select",{"onUpdate:modelValue":O[0]||(O[0]=L=>o.value=L),class:"form-select form-select-sm",disabled:i.value},[O[3]||(O[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",tr,[(l(!0),r(Q,null,Z(T.value,L=>(l(),r("option",{key:L.session_id,value:`minion:${L.session_id}`},g(j(L))+" "+g(m(L)),9,sr))),128))]),w.value.length>0?(l(),r("optgroup",or,[(l(!0),r(Q,null,Z(w.value,L=>(l(),r("option",{key:L.channel_id,value:`channel:${L.channel_id}`}," #️⃣ "+g(L.name),9,nr))),128))])):P("",!0)],8,er),[[ce,o.value]])]),e("div",lr,[K(e("select",{"onUpdate:modelValue":O[1]||(O[1]=L=>p.value=L),class:"form-select form-select-sm",disabled:i.value},[...O[4]||(O[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,ar),[[ce,p.value]])])]),e("div",rr,[e("div",ir,[K(e("textarea",{ref_key:"contentTextarea",ref:b,"onUpdate:modelValue":O[2]||(O[2]=L=>f.value=L),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:i.value,onInput:E,onKeydown:S},null,40,dr),[[te,f.value]]),v.value?(l(),r("div",{key:0,ref_key:"autocompleteDropdown",ref:x,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(l(!0),r(Q,null,Z(h.value,(L,U)=>(l(),r("div",{key:L.id,class:W(["autocomplete-item px-2 py-1",{"bg-light":U===y.value}]),onClick:B=>C(L),onMouseenter:B=>y.value=U},g(L.type==="minion"?j(L):"#️⃣")+" "+g(L.name)+g(L.role?` (${L.role})`:""),43,ur))),128))],512)):P("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!k.value||i.value,onClick:M},[i.value?(l(),r("span",mr,[...O[5]||(O[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),H(" Sending... ",-1)])])):(l(),r("span",pr,"Send"))],8,cr)])])]))}},fr=q(vr,[["__scopeId","data-v-ffa54193"]]),gr={class:"timeline-view d-flex flex-column h-100"},_r={key:0,class:"text-center text-muted"},br={key:1,class:"text-center text-danger"},hr={key:2,class:"text-center text-muted"},yr={key:3,class:"comm-list"},$r={class:"col-auto message-speaker text-end pe-3"},wr={class:"text-muted"},Sr={class:"col message-content-column"},kr={class:"comm-card card"},Cr={class:"card-body p-2"},xr={class:"d-flex justify-content-between align-items-start mb-1"},jr={class:"ms-2"},Mr={class:"comm-content"},Tr={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(s){const t=s,d=Ce(),a=se(),n=J(),o=pe(),p=ee(),f=I(!0),i=I(null),v=I(null),h=u(()=>a.projects.get(t.legionId));u(()=>h.value?.name||"Legion");const y=u(()=>d.currentComms);u(()=>d.currentMinions);function _(c){return c.from_user?"You":c.from_minion_id&&n.sessions.get(c.from_minion_id)?.name||"Unknown"}function b(c){return c.to_user?"You":c.to_minion_id?n.sessions.get(c.to_minion_id)?.name||"Unknown":c.to_channel_id?`#${c.to_channel_id}`:"All"}function x(c){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[c]||"bg-secondary"}function T(c){return new Date(c).toLocaleTimeString()}async function w(){p.autoScrollEnabled&&(await Se(),v.value&&(v.value.scrollTop=v.value.scrollHeight))}async function k(){f.value=!0,i.value=null;try{d.setCurrentLegion(t.legionId),await Promise.all([d.loadTimeline(t.legionId),d.loadMinions(t.legionId)]),await Se(),await w(),setTimeout(()=>{w()},100)}catch(c){console.error("Failed to load timeline:",c),c.response?i.value=`${c.message} (${c.response.status})`:i.value=c.message||"Unknown error"}finally{f.value=!1}}function j(){o.connectLegion(t.legionId)}function m(){o.disconnectLegion()}return X(()=>y.value.length,()=>{w()}),le(()=>{k(),j(),setTimeout(()=>{w()},100)}),ae(()=>{m()}),(c,E)=>(l(),r("div",gr,[Y(za,{"legion-id":s.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:v,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[f.value?(l(),r("div",_r,[...E[0]||(E[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),H(" Loading timeline... ",-1)])])):i.value?(l(),r("div",br," Failed to load timeline: "+g(i.value),1)):y.value.length===0?(l(),r("div",hr," No messages yet. Minions will appear here once they start communicating. ")):(l(),r("div",yr,[(l(!0),r(Q,null,Z(y.value,N=>(l(),r("div",{key:N.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",$r,[e("small",wr,g(T(N.timestamp)),1)]),e("div",Sr,[e("div",kr,[e("div",Cr,[e("div",xr,[e("div",null,[e("span",{class:W(["badge",x(N.comm_type)])},g(N.comm_type),3),e("strong",jr,g(_(N)),1),E[1]||(E[1]=e("span",{class:"text-muted mx-1"},"→",-1)),e("strong",null,g(b(N)),1)])]),e("div",Mr,g(N.content),1)])])])]))),128))]))],512),Y(fr,{"legion-id":s.legionId},null,8,["legion-id"]),Y(Ya,{"legion-id":s.legionId},null,8,["legion-id"])]))}},Er=q(Tr,[["__scopeId","data-v-d4c7422e"]]),Pr={class:"spy-view d-flex flex-column overflow-hidden"},Ir={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(s){return(t,d)=>(l(),r("div",Pr,[Y(qe,{"session-id":s.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},Lr=q(Ir,[["__scopeId","data-v-43a24eaf"]]),Dr={class:"horde-header border-bottom p-3"},Or={class:"project-name"},Nr=["title"],Ar={__name:"HordeHeader",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,d=se(),a=J(),n=u(()=>d.projects.get(t.legionId)),o=u(()=>n.value?.name||"Legion"),p=u(()=>a.sessions.get(t.overseerId)),f=u(()=>p.value?.name||"Overseer");return(i,v)=>(l(),r("div",Dr,[e("div",null,[e("div",Or,g(o.value),1),e("div",{class:"view-name",title:s.overseerId},g(f.value)+"'s Horde",9,Nr)])]))}},Rr=q(Ar,[["__scopeId","data-v-775da47d"]]),qr={class:"horde-status-bar border-top p-2 bg-light"},Ur={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){return(t,d)=>(l(),r("div",qr,[...d[0]||(d[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},Wr=q(Ur,[["__scopeId","data-v-7f3c847f"]]),Hr={class:"minion-card p-2 border-start border-2 mb-2"},Fr={class:"d-flex align-items-center"},Br={class:"me-2"},Vr={key:0,class:"me-2"},zr={key:1,class:"text-muted ms-2"},Jr={key:2,class:"badge bg-secondary ms-2"},Gr={class:"text-muted small ms-4"},Kr={key:0,class:"minion-children"},Yr={key:1,class:"text-danger small ms-4"},Qr={__name:"MinionTreeNode",props:{minionId:{type:String,required:!0},level:{type:Number,default:0}},setup(s){const t=s,d=J(),a=u(()=>d.sessions.get(t.minionId)),n=u(()=>t.level*24),o=u(()=>{const v=a.value&&a.value.child_minion_ids&&a.value.child_minion_ids.length>0;return a.value&&a.value.child_minion_ids&&a.value.child_minion_ids.length>0&&console.log(`Minion ${a.value.name} has ${a.value.child_minion_ids.length} children:`,a.value.child_minion_ids),v}),p=u(()=>a.value&&a.value.is_overseer&&o.value),f={created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"},i=u(()=>f[a.value?.state]||"○");return(v,h)=>{const y=Re("MinionTreeNode",!0);return a.value?(l(),r("div",{key:0,class:"minion-tree-node",style:de({marginLeft:`${n.value}px`})},[e("div",Hr,[e("div",Fr,[e("span",Br,g(i.value),1),p.value?(l(),r("span",Vr,"👑")):P("",!0),e("strong",null,g(a.value.name),1),a.value.role?(l(),r("span",zr,g(a.value.role),1)):P("",!0),p.value?(l(),r("span",Jr,g(a.value.child_minion_ids.length)+" "+g(a.value.child_minion_ids.length===1?"child":"children"),1)):P("",!0)]),e("div",Gr," Level "+g(a.value.overseer_level||0)+" • "+g(a.value.state),1)]),o.value?(l(),r("div",Kr,[(l(!0),r(Q,null,Z(a.value.child_minion_ids,_=>(l(),re(y,{key:_,"minion-id":_,level:s.level+1},null,8,["minion-id","level"]))),128))])):P("",!0)],4)):t.minionId?(l(),r("div",Yr," ⚠ Minion data not found for ID: "+g(t.minionId),1)):P("",!0)}}},Zr=q(Qr,[["__scopeId","data-v-120682eb"]]),Xr={class:"horde-view d-flex flex-column h-100"},ei={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},ti={key:0,class:"alert alert-danger"},si={key:1,class:"horde-tree"},oi={__name:"HordeView",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,d=J(),a=se(),n=u(()=>a.projects.get(t.legionId));u(()=>n.value?.name||"Legion");const o=u(()=>d.sessions.get(t.overseerId));return(p,f)=>(l(),r("div",Xr,[Y(Rr,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"]),e("div",ei,[o.value?(l(),r("div",si,[Y(Zr,{"minion-id":s.overseerId,level:0},null,8,["minion-id"])])):(l(),r("div",ti," Overseer not found "))]),Y(Wr,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"])]))}},ni=q(oi,[["__scopeId","data-v-b928719b"]]),li=[{path:"/",name:"home",component:ze},{path:"/session/:sessionId",name:"session",component:qe,props:!0},{path:"/timeline/:legionId",name:"timeline",component:Er,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:Lr,props:!0},{path:"/horde/:legionId/:overseerId",name:"horde",component:ni,props:!0}],ai=Ue({history:We(),routes:li}),ri={__name:"ConnectionIndicator",setup(s){const t=pe(),d=u(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),a=u(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(n,o)=>(l(),r("span",{id:"connection-indicator",class:W(["badge",d.value])},g(a.value),3))}},ii={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},di={class:"d-flex align-items-center gap-2"},ui={__name:"AppHeader",setup(s){const t=ee();function d(){t.toggleSidebar()}return(a,n)=>(l(),r("header",ii,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:d},[...n[0]||(n[0]=[e("span",null,"☰",-1)])]),n[1]||(n[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",di,[Y(ri)])]))}},ci={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},mi={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},pi=["title"],vi={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,d=u(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function a(f){return f.state==="paused"&&f.is_processing?"pending-prompt":f.is_processing?"processing":f.state}function n(f){const i=a(f);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[i]||"#d3d3d3"}function o(f){const i=a(f);return i==="starting"||i==="processing"||i==="pending-prompt"}function p(f){const i=a(f),v=i.charAt(0).toUpperCase()+i.slice(1),h=f.name||"Unnamed Session",y=f.is_minion&&f.role?` (${f.role})`:"";return`${h}${y}: ${v}`}return(f,i)=>(l(),r("div",ci,[!s.sessions||s.sessions.length===0?(l(),r("div",mi)):(l(!0),r(Q,{key:1},Z(s.sessions,v=>(l(),r("div",{key:v.session_id,class:W(["progress-bar",{"progress-bar-striped progress-bar-animated":o(v)}]),style:de({width:d.value,backgroundColor:n(v),cursor:"help"}),title:p(v)},null,14,pi))),128))]))}},fi=q(vi,[["__scopeId","data-v-a79cfeec"]]),gi={class:"flex-grow-1"},_i={key:0,class:"text-muted small ms-1"},bi={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(s){const t=s,d=ue(),a=J(),n=se(),o=ee(),p=u(()=>a.currentSessionId===t.session.session_id),f=u(()=>a.deletingSessions.has(t.session.session_id)),i=u(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),v=u(()=>{const k=i.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[k]||"status-dot-grey"}),h=u(()=>{const k=i.value,j={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},m={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:j[k]||"#d3d3d3",borderColor:m[k]||"#6c757d"}});function y(){a.selectSession(t.session.session_id),d.push(`/session/${t.session.session_id}`)}function _(){o.showModal("edit-session",{session:t.session})}function b(k){k.dataTransfer.effectAllowed="move",k.dataTransfer.setData("application/session-id",t.session.session_id),k.dataTransfer.setData("application/project-id",t.projectId),k.dataTransfer.setData("text/plain",t.session.session_id),k.target.classList.add("dragging")}function x(k){k.target.classList.remove("dragging")}function T(k){k.preventDefault(),k.dataTransfer.dropEffect="move";const j=k.currentTarget.getBoundingClientRect(),m=j.top+j.height/2;k.clientY<m?(k.currentTarget.classList.add("drop-above"),k.currentTarget.classList.remove("drop-below")):(k.currentTarget.classList.add("drop-below"),k.currentTarget.classList.remove("drop-above"))}function w(k){k.preventDefault(),k.currentTarget.classList.remove("drop-above","drop-below");const j=k.dataTransfer.getData("application/session-id")||k.dataTransfer.getData("text/plain"),m=k.dataTransfer.getData("application/project-id");if(!j||j===t.session.session_id||m!==t.projectId)return;const c=k.currentTarget.getBoundingClientRect(),E=c.top+c.height/2,N=k.clientY<E,S=n.getProject(t.projectId);if(!S||!S.session_ids)return;const C=[...S.session_ids],M=C.indexOf(t.session.session_id),$=C.indexOf(j);if(M===-1||$===-1)return;const O=[...C],[L]=O.splice($,1);let U=N?M:M+1;$<M&&U--,O.splice(U,0,L),n.reorderSessionsInProject(t.projectId,O)}return(k,j)=>(l(),r("div",{class:W(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:p.value,"session-deleting":f.value}]),style:{cursor:"pointer"},draggable:"true",onClick:y,onDragstart:b,onDragend:x,onDragover:T,onDrop:w},[e("div",{class:W(["status-dot me-2",v.value]),style:de(h.value)},null,6),e("div",gi,[e("span",null,g(s.session.name||s.session.session_id),1),s.session.is_minion&&s.session.role?(l(),r("span",_i,"("+g(s.session.role)+")",1)):P("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:ie(_,["stop"])}," ✏️ ")],34))}},hi=q(bi,[["__scopeId","data-v-07ecbf94"]]),yi=["value"],$i={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,d=ue(),a=J(),n=I("");X(()=>d.currentRoute.value,b=>{!n.value&&b.name==="spy"&&b.params.minionId&&b.params.legionId===t.project.project_id&&(n.value=b.params.minionId)},{immediate:!0});const o=u(()=>n.value?t.sessions.find(b=>b.session_id===n.value):null),p=u(()=>{const b=d.currentRoute.value;return b.name==="spy"&&b.params.legionId===t.project.project_id}),f=u(()=>{if(!o.value)return"";if(o.value.state==="paused"&&o.value.is_processing)return"status-blinking";const b=o.value.is_processing?"processing":o.value.state;return b==="starting"||b==="processing"?"status-blinking":""}),i=u(()=>{if(!o.value)return{};if(o.value.state==="paused"&&o.value.is_processing)return{backgroundColor:"#ffc107"};const b=o.value.is_processing?"processing":o.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[b]||"#d3d3d3"}});function v(b){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[b.state]||"○"}function h(b){return b.is_minion&&b.role?`${b.name} (${b.role})`:b.name}function y(){n.value&&d.push(`/spy/${t.project.project_id}/${n.value}`)}function _(){n.value?d.push(`/spy/${t.project.project_id}/${n.value}`):d.push("/")}return X(()=>a.currentSessionId,b=>{b&&t.sessions.some(x=>x.session_id===b)&&(n.value=b)}),(b,x)=>(l(),r("div",{class:W(["list-group-item list-group-item-action p-2",{active:p.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:de({cursor:n.value?"pointer":"default"}),onClick:y},[x[1]||(x[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🔍"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),o.value?(l(),r("span",{key:0,class:W(["minion-state-indicator",f.value]),style:de(i.value)}," 👤 ",6)):P("",!0)],4),K(e("select",{"onUpdate:modelValue":x[0]||(x[0]=T=>n.value=T),class:"form-select form-select-sm",onChange:_},[x[2]||(x[2]=e("option",{value:""},"-- Select Minion --",-1)),(l(!0),r(Q,null,Z(s.sessions,T=>(l(),r("option",{key:T.session_id,value:T.session_id},g(v(T))+" "+g(h(T)),9,yi))),128))],544),[[ce,n.value]])],2))}},wi=q($i,[["__scopeId","data-v-9632f72c"]]),Si=["value"],ki={__name:"HordeSelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,d=ue(),a=I("");X(()=>d.currentRoute.value,v=>{!a.value&&v.name==="horde"&&v.params.overseerId&&v.params.legionId===t.project.project_id&&(a.value=v.params.overseerId)},{immediate:!0});const n=u(()=>t.sessions.filter(v=>v.is_overseer===!0)),o=u(()=>{const v=d.currentRoute.value;return v.name==="horde"&&v.params.legionId===t.project.project_id});function p(v){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[v.state]||"○"}function f(){a.value&&d.push(`/horde/${t.project.project_id}/${a.value}`)}function i(){a.value&&d.push(`/horde/${t.project.project_id}/${a.value}`)}return(v,h)=>(l(),r("div",{class:W(["list-group-item list-group-item-action p-2",{active:o.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:de({cursor:a.value?"pointer":"default"}),onClick:f},[...h[1]||(h[1]=[e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🌳"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],4),K(e("select",{"onUpdate:modelValue":h[0]||(h[0]=y=>a.value=y),class:"form-select form-select-sm",onChange:i},[h[2]||(h[2]=e("option",{value:""},"-- Select Overseer --",-1)),(l(!0),r(Q,null,Z(n.value,y=>(l(),r("option",{key:y.session_id,value:y.session_id},g(p(y))+" "+g(y.name),9,Si))),128))],544),[[ce,a.value]])],2))}},Ci=q(ki,[["__scopeId","data-v-ca33279d"]]),xi=["data-project-id"],ji=["id"],Mi=["data-bs-target","aria-expanded","aria-controls"],Ti={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},Ei={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},Pi={class:"fw-semibold",style:{"flex-shrink":"0"}},Ii={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},Li={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},Di=["title"],Oi=["title"],Ni=["id","aria-labelledby"],Ai={class:"accordion-body p-0"},Ri={class:"list-group list-group-flush"},qi={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(s){const t=s,d=ue(),a=se(),n=J(),o=ee(),p=I(t.project.is_expanded||!1),f=u(()=>a.formatPath(t.project.working_directory)),i=u(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(m=>n.getSession(m)).filter(m=>m!=null)),v=u(()=>{const m=d.currentRoute.value;return m.name==="timeline"&&m.params.legionId===t.project.project_id});function h(){p.value||(a.toggleExpansion(t.project.project_id),p.value=!0)}function y(){if(p.value){a.toggleExpansion(t.project.project_id),p.value=!1;const m=n.currentSessionId;m&&n.getSession(m)&&t.project.session_ids?.includes(m)&&d.push("/"),a.currentProjectId===t.project.project_id&&d.push("/")}}function _(){o.showModal("edit-project",{project:t.project})}function b(){t.project.is_multi_agent?o.showModal("create-minion",{project:t.project}):o.showModal("create-session",{project:t.project})}function x(){d.push(`/timeline/${t.project.project_id}`)}function T(m){m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("application/project-id",t.project.project_id),m.dataTransfer.setData("text/plain",t.project.project_id),m.target.classList.add("dragging")}function w(m){m.target.classList.remove("dragging")}function k(m){m.preventDefault(),m.dataTransfer.dropEffect="move";const c=m.currentTarget.getBoundingClientRect(),E=c.top+c.height/2;m.clientY<E?(m.currentTarget.classList.add("drop-above"),m.currentTarget.classList.remove("drop-below")):(m.currentTarget.classList.add("drop-below"),m.currentTarget.classList.remove("drop-above"))}function j(m){m.preventDefault(),m.currentTarget.classList.remove("drop-above","drop-below");const c=m.dataTransfer.getData("application/project-id")||m.dataTransfer.getData("text/plain");if(!c||c===t.project.project_id)return;const E=m.currentTarget.getBoundingClientRect(),N=E.top+E.height/2,S=m.clientY<N,C=a.orderedProjects,M=C.findIndex(D=>D.project_id===t.project.project_id),$=C.findIndex(D=>D.project_id===c);if(M===-1||$===-1)return;const O=[...C],[L]=O.splice($,1);let U=S?M:M+1;$<M&&U--,O.splice(U,0,L);const B=O.map(D=>D.project_id);a.reorderProjects(B)}return(m,c)=>(l(),r("div",{class:"accordion-item border rounded mb-2","data-project-id":s.project.project_id,draggable:"true",onDragstart:T,onDragend:w,onDragover:k,onDrop:j},[e("h2",{class:"accordion-header",id:`heading-${s.project.project_id}`},[e("button",{class:W(["accordion-button bg-white p-2",{collapsed:!p.value}]),type:"button","data-bs-toggle":"collapse","data-bs-target":`#collapse-${s.project.project_id}`,"aria-expanded":p.value,"aria-controls":`collapse-${s.project.project_id}`},[e("div",Ti,[e("div",Ei,[e("div",Pi,[s.project.is_multi_agent?(l(),r("span",Ii,"🏛")):P("",!0),H(" "+g(s.project.name),1)]),e("div",Li,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:ie(_,["stop","prevent"])}," ✏️ "),e("button",{class:"btn btn-sm btn-outline-primary",title:s.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:ie(b,["stop","prevent"])}," ➕ ",8,Di)])]),e("small",{class:"text-muted font-monospace",title:s.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},g(f.value),9,Oi)])],10,Mi)],8,ji),Y(fi,{project:s.project,sessions:i.value},null,8,["project","sessions"]),e("div",{id:`collapse-${s.project.project_id}`,class:W(["accordion-collapse collapse",{show:p.value}]),"aria-labelledby":`heading-${s.project.project_id}`,onShown:h,onHidden:y},[e("div",Ai,[e("div",Ri,[s.project.is_multi_agent?(l(),r("div",{key:0,class:W(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:v.value}]),style:{cursor:"pointer"},onClick:x},[...c[0]||(c[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"📊"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):P("",!0),s.project.is_multi_agent?(l(),r(Q,{key:1},[Y(wi,{project:s.project,sessions:i.value},null,8,["project","sessions"]),Y(Ci,{project:s.project,sessions:i.value},null,8,["project","sessions"])],64)):(l(!0),r(Q,{key:2},Z(i.value,E=>(l(),re(hi,{key:E.session_id,session:E,"project-id":s.project.project_id},null,8,["session","project-id"]))),128))])])],42,Ni)],40,xi))}},Ui=q(qi,[["__scopeId","data-v-4cc3dd53"]]),Wi={class:"project-list"},Hi={key:0,class:"text-muted text-center py-3"},Fi={__name:"ProjectList",setup(s){const t=se(),d=u(()=>t.orderedProjects);return(a,n)=>(l(),r("div",Wi,[d.value.length===0?(l(),r("div",Hi,' No projects yet. Click "New" to create one. ')):P("",!0),(l(!0),r(Q,null,Z(d.value,o=>(l(),re(Ui,{key:o.project_id,project:o},null,8,["project"]))),128))]))}},Bi={class:"flex-grow-1 overflow-auto p-3"},Vi={id:"sessions-container"},zi={__name:"Sidebar",setup(s){const t=ee(),d=u(()=>t.sidebarCollapsed),a=u(()=>t.isMobile),n=u(()=>{if(a.value)return{};const h=`${t.sidebarWidth}px`;return{width:h,minWidth:"200px",maxWidth:"30vw","--sidebar-width":h}});function o(){t.showModal("create-project")}const p=I(!1);function f(h){p.value=!0,document.addEventListener("mousemove",i),document.addEventListener("mouseup",v)}function i(h){p.value&&t.setSidebarWidth(h.clientX)}function v(){p.value=!1,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",v)}return(h,y)=>(l(),r("aside",{id:"sidebar",class:W(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:d.value,"mobile-open":!d.value&&a.value,"desktop-collapsed":d.value&&!a.value}]),style:de(n.value)},[e("div",Bi,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[y[0]||(y[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:o}," 📁 New ")]),e("div",Vi,[Y(Fi)])]),e("div",{class:"sidebar-resize-handle",onMousedown:f},null,32)],6))}},Ji=q(zi,[["__scopeId","data-v-d792f0f0"]]),Gi={class:"modal-dialog modal-lg"},Ki={class:"modal-content"},Yi={class:"modal-body"},Qi={class:"mb-3"},Zi={class:"input-group"},Xi=["disabled"],ed={key:0,class:"text-center py-4"},td={key:1,class:"alert alert-danger",role:"alert"},sd={key:2,class:"folder-list"},od=["onClick","onDblclick"],nd={class:"d-flex align-items-center flex-grow-1"},ld=["onClick"],ad={key:1,class:"text-center text-muted py-3"},rd={class:"modal-footer"},id=["disabled"],dd={__name:"FolderBrowserModal",setup(s){const t=ee(),d=I(""),a=I(""),n=I([]),o=I(!1),p=I(""),f=I(null);let i=null,v=null;const h=u(()=>{if(!d.value)return null;const m=d.value.split(/[\\/]/).filter(Boolean);return m.length<=1?null:(m.pop(),m.length>0?m.join("/"):"/")});function y(m){if(!m)return"";const c=m.split(/[\\/]/).filter(Boolean);return c.length<=2?m:".../"+c.slice(-2).join("/")}async function _(){o.value=!0,p.value="",n.value=[],a.value="";try{const m=d.value?{path:d.value}:{},c=await G.get("/api/filesystem/browse",{params:m});c.current_path&&(d.value=c.current_path),n.value=c.directories||[]}catch(m){console.error("Failed to load directory:",m),p.value=m.message||"Failed to load directory"}finally{o.value=!1}}function b(m){a.value=m.path}function x(m){d.value=m.path,a.value="",_()}function T(){h.value&&(d.value=h.value,a.value="",_())}function w(){const m=a.value||d.value;m&&v&&v(m),i&&i.hide()}function k(){_()}function j(){n.value=[],a.value="",p.value="",v=null,t.hideModal()}return X(()=>t.currentModal,m=>{if(m?.name==="folder-browser"&&i){const c=m.data||{};d.value=c.currentPath||"",v=c.onSelect||null,i.show()}}),le(()=>{f.value&&ne(async()=>{const{default:m}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:m}},__vite__mapDeps([0,1])).then(({default:m})=>{i=new m(f.value),f.value.addEventListener("shown.bs.modal",k),f.value.addEventListener("hidden.bs.modal",j)})}),ae(()=>{f.value&&(f.value.removeEventListener("shown.bs.modal",k),f.value.removeEventListener("hidden.bs.modal",j)),i&&i.dispose()}),(m,c)=>(l(),r("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:f},[e("div",Gi,[e("div",Ki,[c[7]||(c[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Yi,[e("div",Qi,[c[2]||(c[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",Zi,[K(e("input",{type:"text",class:"form-control","onUpdate:modelValue":c[0]||(c[0]=E=>d.value=E),onKeyup:Ae(_,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[te,d.value]]),e("button",{class:"btn btn-outline-secondary",onClick:_,disabled:o.value},[...c[1]||(c[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),H(" Refresh ",-1)])],8,Xi)])]),o.value?(l(),r("div",ed,[...c[3]||(c[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):p.value?(l(),r("div",td,g(p.value),1)):(l(),r("div",sd,[h.value?(l(),r("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:T,role:"button"},[...c[4]||(c[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):P("",!0),(l(!0),r(Q,null,Z(n.value,E=>(l(),r("div",{key:E.path,class:W(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:E.path===a.value}]),onClick:N=>b(E),onDblclick:N=>x(E),role:"button"},[e("div",nd,[c[5]||(c[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,g(E.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:ie(N=>x(E),["stop"])}," Open ",8,ld)],42,od))),128)),n.value.length===0?(l(),r("div",ad," No subdirectories found ")):P("",!0)]))]),e("div",rd,[c[6]||(c[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:w,disabled:!a.value},' Select "'+g(y(a.value||d.value))+'" ',9,id)])])])],512))}},ud=q(dd,[["__scopeId","data-v-667c51a9"]]),cd={class:"modal-dialog"},md={class:"modal-content"},pd={class:"modal-body"},vd={class:"mb-3"},fd={key:0,class:"invalid-feedback"},gd={class:"mb-3"},_d={class:"input-group"},bd={key:0,class:"invalid-feedback"},hd={class:"mb-3 form-check"},yd={class:"mb-3 form-check"},$d={class:"form-check-label",for:"createSession"},wd={key:0,class:"mb-3 ms-4"},Sd={for:"sessionName",class:"form-label"},kd={key:1,class:"alert alert-danger",role:"alert"},Cd={class:"modal-footer"},xd=["disabled"],jd={key:0,class:"spinner-border spinner-border-sm me-2"},Md={__name:"ProjectCreateModal",setup(s){const t=se(),d=J(),a=ee(),n=I({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),o=I({name:"",workingDirectory:""}),p=I(!1),f=I(""),i=I(null);let v=null;function h(){a.showModal("folder-browser",{currentPath:n.value.workingDirectory||"",onSelect:w=>{n.value.workingDirectory=w,o.value.workingDirectory=""}})}function y(){o.value={};let w=!0;return n.value.name.trim()||(o.value.name="Project name is required",w=!1),n.value.workingDirectory.trim()||(o.value.workingDirectory="Working directory is required",w=!1),w}async function _(){if(y()){p.value=!0,f.value="";try{const w=await t.createProject(n.value.name,n.value.workingDirectory,n.value.isMultiAgent);n.value.createSession&&await d.createSession(w.project_id,{name:n.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),v&&v.hide(),b()}catch(w){console.error("Failed to create project:",w),f.value=w.message||"Failed to create project. Please try again."}finally{p.value=!1}}}function b(){n.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},o.value={},f.value=""}function x(){const w=document.getElementById("projectName");w&&w.focus()}function T(){b(),a.hideModal()}return X(()=>a.currentModal,w=>{w?.name==="create-project"&&v&&v.show()}),le(()=>{i.value&&ne(async()=>{const{default:w}=await import("./modal-B4rHLo2F.js").then(k=>k.m);return{default:w}},__vite__mapDeps([0,1])).then(({default:w})=>{v=new w(i.value),i.value.addEventListener("shown.bs.modal",x),i.value.addEventListener("hidden.bs.modal",T)})}),ae(()=>{i.value&&(i.value.removeEventListener("shown.bs.modal",x),i.value.removeEventListener("hidden.bs.modal",T)),v&&v.dispose()}),(w,k)=>(l(),r("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",cd,[e("div",md,[k[11]||(k[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",pd,[e("form",{onSubmit:ie(_,["prevent"])},[e("div",vd,[k[5]||(k[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),K(e("input",{type:"text",class:W(["form-control",{"is-invalid":o.value.name}]),id:"projectName","onUpdate:modelValue":k[0]||(k[0]=j=>n.value.name=j),placeholder:"My Project",required:""},null,2),[[te,n.value.name]]),o.value.name?(l(),r("div",fd,g(o.value.name),1)):P("",!0)]),e("div",gd,[k[6]||(k[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",_d,[K(e("input",{type:"text",class:W(["form-control",{"is-invalid":o.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":k[1]||(k[1]=j=>n.value.workingDirectory=j),placeholder:"/path/to/project",required:""},null,2),[[te,n.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:h}," Browse... "),o.value.workingDirectory?(l(),r("div",bd,g(o.value.workingDirectory),1)):P("",!0)]),k[7]||(k[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",hd,[K(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":k[2]||(k[2]=j=>n.value.isMultiAgent=j)},null,512),[[fe,n.value.isMultiAgent]]),k[8]||(k[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," 🏛 Multi-Agent Project (Legion) ",-1)),k[9]||(k[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",yd,[K(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":k[3]||(k[3]=j=>n.value.createSession=j)},null,512),[[fe,n.value.createSession]]),e("label",$d," Create initial "+g(n.value.isMultiAgent?"minion":"session"),1)]),n.value.createSession?(l(),r("div",wd,[e("label",Sd," Initial "+g(n.value.isMultiAgent?"Minion":"Session")+" Name ",1),K(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":k[4]||(k[4]=j=>n.value.sessionName=j),placeholder:"main"},null,512),[[te,n.value.sessionName]])])):P("",!0),f.value?(l(),r("div",kd,g(f.value),1)):P("",!0)],32)]),e("div",Cd,[k[10]||(k[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:_,disabled:p.value},[p.value?(l(),r("span",jd)):P("",!0),H(" "+g(p.value?"Creating...":"Create Project"),1)],8,xd)])])])],512))}},Td=q(Md,[["__scopeId","data-v-adf50394"]]),Ed={class:"modal-dialog"},Pd={class:"modal-content"},Id={class:"modal-body"},Ld={class:"mb-3"},Dd={key:0,class:"invalid-feedback"},Od={class:"mb-3"},Nd=["value"],Ad={key:0,class:"alert alert-danger",role:"alert"},Rd={class:"danger-zone"},qd={class:"text-muted small"},Ud=["disabled"],Wd={key:0,class:"alert alert-warning mt-3",role:"alert"},Hd={class:"mb-2"},Fd={class:"d-flex gap-2"},Bd=["disabled"],Vd={key:0,class:"spinner-border spinner-border-sm me-2"},zd=["disabled"],Jd={class:"modal-footer"},Gd=["disabled"],Kd={key:0,class:"spinner-border spinner-border-sm me-2"},Yd={__name:"ProjectEditModal",setup(s){const t=se(),d=ee(),a=I(null),n=I({name:""}),o=I({name:""}),p=I(!1),f=I(!1),i=I(""),v=I(!1),h=I(null);let y=null;const _=u(()=>a.value?.session_ids?.length||0);function b(){o.value={};let m=!0;return n.value.name.trim()||(o.value.name="Project name is required",m=!1),m}async function x(){if(!(!b()||!a.value)){p.value=!0,i.value="";try{await t.updateProject(a.value.project_id,{name:n.value.name}),y&&y.hide()}catch(m){console.error("Failed to update project:",m),i.value=m.message||"Failed to update project. Please try again."}finally{p.value=!1}}}async function T(){if(a.value){f.value=!0,i.value="";try{await t.deleteProject(a.value.project_id),y&&y.hide()}catch(m){console.error("Failed to delete project:",m),i.value=m.message||"Failed to delete project. Please try again."}finally{f.value=!1}}}function w(){n.value={name:""},o.value={},i.value="",v.value=!1}function k(){const m=document.getElementById("editProjectName");m&&(m.focus(),m.select())}function j(){w(),a.value=null,d.hideModal()}return X(()=>d.currentModal,m=>{if(m?.name==="edit-project"&&y){const c=m.data||{};a.value=c.project,a.value&&(n.value.name=a.value.name),y.show()}}),le(()=>{h.value&&ne(async()=>{const{default:m}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:m}},__vite__mapDeps([0,1])).then(({default:m})=>{y=new m(h.value),h.value.addEventListener("shown.bs.modal",k),h.value.addEventListener("hidden.bs.modal",j)})}),ae(()=>{h.value&&(h.value.removeEventListener("shown.bs.modal",k),h.value.removeEventListener("hidden.bs.modal",j)),y&&y.dispose()}),(m,c)=>(l(),r("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:h},[e("div",Ed,[e("div",Pd,[c[11]||(c[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Id,[e("form",{onSubmit:ie(x,["prevent"])},[e("div",Ld,[c[3]||(c[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),K(e("input",{type:"text",class:W(["form-control",{"is-invalid":o.value.name}]),id:"editProjectName","onUpdate:modelValue":c[0]||(c[0]=E=>n.value.name=E),placeholder:"My Project",required:""},null,2),[[te,n.value.name]]),o.value.name?(l(),r("div",Dd,g(o.value.name),1)):P("",!0)]),e("div",Od,[c[4]||(c[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:a.value?.working_directory,disabled:"",readonly:""},null,8,Nd),c[5]||(c[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),i.value?(l(),r("div",Ad,g(i.value),1)):P("",!0)],32),c[9]||(c[9]=e("hr",null,null,-1)),e("div",Rd,[c[7]||(c[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",qd," Deleting this project will also delete all "+g(_.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:c[1]||(c[1]=E=>v.value=!0),disabled:f.value},[...c[6]||(c[6]=[e("i",{class:"bi bi-trash"},null,-1),H(" Delete Project ",-1)])],8,Ud)]),v.value?(l(),r("div",Wd,[c[8]||(c[8]=e("strong",null,"Are you sure?",-1)),e("p",Hd,' This will permanently delete the project "'+g(a.value?.name)+'" and all '+g(_.value)+" session(s). ",1),e("div",Fd,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:T,disabled:f.value},[f.value?(l(),r("span",Vd)):P("",!0),H(" "+g(f.value?"Deleting...":"Yes, Delete Permanently"),1)],8,Bd),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:c[2]||(c[2]=E=>v.value=!1),disabled:f.value}," Cancel ",8,zd)])])):P("",!0)]),e("div",Jd,[c[10]||(c[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:x,disabled:p.value},[p.value?(l(),r("span",Kd)):P("",!0),H(" "+g(p.value?"Saving...":"Save Changes"),1)],8,Gd)])])])],512))}},Qd=q(Yd,[["__scopeId","data-v-6f299f35"]]),Zd={class:"modal-dialog modal-lg"},Xd={class:"modal-content"},eu={class:"modal-header"},tu={class:"modal-title",id:"createSessionModalLabel"},su={key:0,class:"text-muted small"},ou={class:"modal-body"},nu={class:"mb-3"},lu={key:0,class:"invalid-feedback"},au={class:"mb-3"},ru={class:"mb-3"},iu={class:"mb-3"},du={class:"form-text d-flex justify-content-between"},uu={key:0,class:"invalid-feedback"},cu={class:"mb-3 form-check"},mu={key:0,class:"form-text text-warning"},pu={class:"mb-3"},vu={class:"mb-3 form-check"},fu={key:0,class:"alert alert-danger",role:"alert"},gu={class:"modal-footer"},_u=["disabled"],bu={key:0,class:"spinner-border spinner-border-sm me-2"},hu={__name:"SessionCreateModal",setup(s){const t=ue();se();const d=J(),a=ee(),n=I(null),o=I({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0}),p=I({name:""}),f=I(!1),i=I(""),v=I(null);let h=null;const y=u(()=>o.value.system_prompt.length),_=u(()=>y.value>6e3),b=u(()=>y.value>5500&&y.value<=6e3);function x(){p.value={};let m=!0;return o.value.name.trim()||(p.value.name="Session name is required",m=!1),_.value&&(m=!1),m}async function T(){if(!(!x()||!n.value)){f.value=!0,i.value="";try{const m=o.value.tools.split(",").map(N=>N.trim()).filter(N=>N.length>0),c={name:o.value.name,permission_mode:o.value.permission_mode,model:o.value.model,system_prompt:o.value.system_prompt.trim()||null,override_system_prompt:o.value.override_system_prompt,tools:m},E=await d.createSession(n.value.project_id,c);o.value.startImmediately&&await d.startSession(E.session_id),t.push(`/session/${E.session_id}`),h&&h.hide(),w()}catch(m){console.error("Failed to create session:",m),i.value=m.message||"Failed to create session. Please try again."}finally{f.value=!1}}}function w(){o.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0},p.value={},i.value=""}function k(){const m=document.getElementById("sessionName");m&&m.focus()}function j(){w(),n.value=null,a.hideModal()}return X(()=>a.currentModal,m=>{if(m?.name==="create-session"&&h){const c=m.data||{};n.value=c.project,h.show()}}),le(()=>{v.value&&ne(async()=>{const{default:m}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:m}},__vite__mapDeps([0,1])).then(({default:m})=>{h=new m(v.value),v.value.addEventListener("shown.bs.modal",k),v.value.addEventListener("hidden.bs.modal",j)})}),ae(()=>{v.value&&(v.value.removeEventListener("shown.bs.modal",k),v.value.removeEventListener("hidden.bs.modal",j)),h&&h.dispose()}),(m,c)=>(l(),r("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",Zd,[e("div",Xd,[e("div",eu,[e("h5",tu,[c[7]||(c[7]=H(" Create New Session ",-1)),n.value?(l(),r("span",su,"in "+g(n.value.name),1)):P("",!0)]),c[8]||(c[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",ou,[e("form",{onSubmit:ie(T,["prevent"])},[e("div",nu,[c[9]||(c[9]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),K(e("input",{type:"text",class:W(["form-control",{"is-invalid":p.value.name}]),id:"sessionName","onUpdate:modelValue":c[0]||(c[0]=E=>o.value.name=E),placeholder:"main",required:""},null,2),[[te,o.value.name]]),p.value.name?(l(),r("div",lu,g(p.value.name),1)):P("",!0)]),e("div",au,[c[11]||(c[11]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),K(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":c[1]||(c[1]=E=>o.value.permission_mode=E)},[...c[10]||(c[10]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"⚠️ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[ce,o.value.permission_mode]]),c[12]||(c[12]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",ru,[c[14]||(c[14]=e("label",{for:"model",class:"form-label"},"Model",-1)),K(e("select",{class:"form-select",id:"model","onUpdate:modelValue":c[2]||(c[2]=E=>o.value.model=E)},[...c[13]||(c[13]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[ce,o.value.model]])]),e("div",iu,[c[15]||(c[15]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),K(e("textarea",{class:W(["form-control",{"is-invalid":_.value}]),id:"systemPrompt","onUpdate:modelValue":c[3]||(c[3]=E=>o.value.system_prompt=E),rows:"3",maxlength:6e3,placeholder:"Additional instructions to append to the system prompt..."},null,2),[[te,o.value.system_prompt]]),e("div",du,[e("span",null,g(o.value.override_system_prompt?"These instructions will replace Claude Code's default system prompt":"These instructions will be appended to Claude Code's default system prompt"),1),e("span",{class:W({"text-danger":_.value,"text-warning":b.value})},g(y.value)+" / 6000 chars ",3)]),_.value?(l(),r("div",uu," System prompt exceeds 6000 character limit (Windows command-line constraint) ")):P("",!0)]),e("div",cu,[K(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":c[4]||(c[4]=E=>o.value.override_system_prompt=E)},null,512),[[fe,o.value.override_system_prompt]]),c[17]||(c[17]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom prompt only) ",-1)),o.value.override_system_prompt?(l(),r("div",mu,[...c[16]||(c[16]=[e("small",null,"⚠️ Override mode may cause unexpected behaviors. Only custom instructions will be used (no Claude Code preset).",-1)])])):P("",!0)]),e("div",pu,[c[18]||(c[18]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),K(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":c[5]||(c[5]=E=>o.value.tools=E),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[te,o.value.tools]]),c[19]||(c[19]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",vu,[K(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":c[6]||(c[6]=E=>o.value.startImmediately=E)},null,512),[[fe,o.value.startImmediately]]),c[20]||(c[20]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),i.value?(l(),r("div",fu,g(i.value),1)):P("",!0)],32)]),e("div",gu,[c[21]||(c[21]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:T,disabled:f.value},[f.value?(l(),r("span",bu)):P("",!0),H(" "+g(f.value?"Creating...":"Create Session"),1)],8,_u)])])])],512))}},yu=q(hu,[["__scopeId","data-v-5aef47e0"]]),$u={class:"modal-dialog"},wu={class:"modal-content"},Su={class:"modal-body"},ku={class:"mb-3"},Cu={key:0,class:"invalid-feedback"},xu={class:"mb-3"},ju=["value"],Mu={class:"mb-3"},Tu={class:"form-control-plaintext"},Eu={class:"mb-3"},Pu=["disabled"],Iu={key:0,value:"bypassPermissions"},Lu={class:"form-text"},Du={key:0,class:"text-warning"},Ou={key:1},Nu={key:0,class:"mb-3"},Au={class:"card"},Ru={class:"card-body"},qu={key:0,class:"mb-2"},Uu={key:1,class:"mb-2"},Wu={key:2,class:"mt-2"},Hu={class:"form-control",style:{height:"auto","min-height":"60px","white-space":"pre-wrap"},readonly:""},Fu={key:1,class:"alert alert-danger",role:"alert"},Bu={class:"modal-footer"},Vu=["disabled"],zu={key:0,class:"spinner-border spinner-border-sm me-2"},Ju={__name:"SessionEditModal",setup(s){const t=J(),d=ee(),a=I(null),n=I({name:"",permission_mode:"default"}),o=I({name:""}),p=I(!1),f=I(""),i=I(null);let v=null;const h=u(()=>a.value?.state==="active"||a.value?.state==="starting"),y=u(()=>a.value?.initial_permission_mode==="bypassPermissions");function _(j){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[j]||"bg-secondary"}function b(){o.value={};let j=!0;return n.value.name.trim()||(o.value.name="Session name is required",j=!1),j}async function x(){if(!(!b()||!a.value)){p.value=!0,f.value="";try{await t.updateSessionName(a.value.session_id,n.value.name),n.value.permission_mode!==a.value.current_permission_mode&&await t.setPermissionMode(a.value.session_id,n.value.permission_mode),v&&v.hide()}catch(j){console.error("Failed to update session:",j),f.value=j.message||"Failed to update session. Please try again."}finally{p.value=!1}}}function T(){n.value={name:"",permission_mode:"default"},o.value={},f.value=""}function w(){const j=document.getElementById("editSessionName");j&&(j.focus(),j.select())}function k(){T(),a.value=null,d.hideModal()}return X(()=>d.currentModal,j=>{if(j?.name==="edit-session"&&v){const m=j.data||{};a.value=m.session,a.value&&(n.value.name=a.value.name,n.value.permission_mode=a.value.current_permission_mode||"default"),v.show()}}),le(()=>{i.value&&ne(async()=>{const{default:j}=await import("./modal-B4rHLo2F.js").then(m=>m.m);return{default:j}},__vite__mapDeps([0,1])).then(({default:j})=>{v=new j(i.value),i.value.addEventListener("shown.bs.modal",w),i.value.addEventListener("hidden.bs.modal",k)})}),ae(()=>{i.value&&(i.value.removeEventListener("shown.bs.modal",w),i.value.removeEventListener("hidden.bs.modal",k)),v&&v.dispose()}),(j,m)=>(l(),r("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",$u,[e("div",wu,[m[15]||(m[15]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Su,[e("form",{onSubmit:ie(x,["prevent"])},[e("div",ku,[m[2]||(m[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),K(e("input",{type:"text",class:W(["form-control",{"is-invalid":o.value.name}]),id:"editSessionName","onUpdate:modelValue":m[0]||(m[0]=c=>n.value.name=c),placeholder:"Session Name",required:""},null,2),[[te,n.value.name]]),o.value.name?(l(),r("div",Cu,g(o.value.name),1)):P("",!0)]),e("div",xu,[m[3]||(m[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:a.value?.working_directory,disabled:"",readonly:""},null,8,ju),m[4]||(m[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",Mu,[m[5]||(m[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",Tu,[e("span",{class:W(["badge",_(a.value?.state)])},g(a.value?.state),3)])]),e("div",Eu,[m[9]||(m[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),K(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":m[1]||(m[1]=c=>n.value.permission_mode=c),disabled:!h.value},[m[6]||(m[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),m[7]||(m[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),m[8]||(m[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),y.value?(l(),r("option",Iu,"⚠️ Bypass Permissions (No prompts)")):P("",!0)],8,Pu),[[ce,n.value.permission_mode]]),e("div",Lu,[h.value?(l(),r("span",Ou," Controls which tool actions require permission prompts ")):(l(),r("span",Du," ⚠️ Session must be active to change permission mode. Start the session first. "))])]),a.value?.system_prompt||a.value?.override_system_prompt?(l(),r("div",Nu,[m[13]||(m[13]=e("label",{class:"form-label"},"System Prompt Configuration",-1)),e("div",Au,[e("div",Ru,[a.value?.override_system_prompt?(l(),r("div",qu,[...m[10]||(m[10]=[e("span",{class:"badge bg-warning text-dark"},"Override Mode",-1),e("div",{class:"form-text text-warning mt-1"}," Using custom prompt only (no Claude Code preset) ",-1)])])):(l(),r("div",Uu,[...m[11]||(m[11]=[e("span",{class:"badge bg-info"},"Append Mode",-1),e("div",{class:"form-text mt-1"}," Custom instructions appended to Claude Code preset ",-1)])])),a.value?.system_prompt?(l(),r("div",Wu,[m[12]||(m[12]=e("strong",{class:"small"},"Custom Instructions:",-1)),e("div",Hu,g(a.value.system_prompt),1)])):P("",!0)])])])):P("",!0),f.value?(l(),r("div",Fu,g(f.value),1)):P("",!0)],32)]),e("div",Bu,[m[14]||(m[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:x,disabled:p.value},[p.value?(l(),r("span",zu)):P("",!0),H(" "+g(p.value?"Saving...":"Save Changes"),1)],8,Vu)])])])],512))}},Gu=q(Ju,[["__scopeId","data-v-c99ca17f"]]),Ku={class:"modal-dialog modal-dialog-centered"},Yu={class:"modal-content"},Qu={class:"modal-header"},Zu={class:"modal-title",id:"manageSessionModalLabel"},Xu={class:"modal-body"},ec={key:0,class:"text-center py-4"},tc={class:"text-muted"},sc={key:1},oc={key:2},nc={class:"text-muted"},lc={key:3},ac={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},rc={class:"d-grid gap-2"},ic=["disabled"],dc=["disabled"],uc=["disabled"],cc=["disabled"],mc={class:"modal-footer"},pc={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},vc={__name:"SessionManageModal",setup(s){const t=ue(),d=J(),a=ee(),n=pe();me();const o=I(null),p=I(!1),f=I(""),i=I(""),v=I(null),h=I(null);let y=null;const _=u(()=>v.value==="reset"?"Reset Session":v.value==="delete"?"Delete Session":"Manage Session");function b(){v.value="reset"}function x(){v.value="delete"}function T(){v.value=null}async function w(){v.value==="reset"?await m():v.value==="delete"&&await c()}async function k(){if(o.value){p.value=!0,f.value="Restarting session...";try{const S=o.value.session_id,C=await G.post(`/api/sessions/${S}/restart`);if(C.success)console.log("Session restarted successfully, reconnecting"),await n.disconnectSession(),d.currentSessionId=null,await d.selectSession(S),y&&y.hide();else{const M=C.error||C.detail||"Failed to restart session";console.error("Failed to restart session:",M),i.value=`Failed to restart session: ${M}`}}catch(S){console.error("Error restarting session:",S);const C=S.data?.detail||S.message||"Unknown error";i.value=`Error restarting session: ${C}`}finally{p.value=!1}}}async function j(){if(o.value)try{y&&y.hide(),console.log("Ending session",o.value.session_id);const S=o.value.session_id;await G.post(`/api/sessions/${S}/terminate`),await n.disconnectSession(),d.currentSessionId===S&&(d.currentSessionId=null),t.push("/")}catch(S){console.error("Error ending session:",S),await n.disconnectSession(),d.currentSessionId===o.value?.session_id&&(d.currentSessionId=null),t.push("/")}}async function m(){if(o.value){p.value=!0,f.value="Resetting session...";try{const S=o.value.session_id,C=await G.post(`/api/sessions/${S}/reset`);if(C.success)console.log("Session reset successfully, reconnecting"),await n.disconnectSession(),d.currentSessionId=null,await d.selectSession(S),y&&y.hide();else{const M=C.error||C.detail||"Failed to reset session";console.error("Failed to reset session:",M),i.value=`Failed to reset session: ${M}`,v.value=null}}catch(S){console.error("Error resetting session:",S);const C=S.data?.detail||S.message||"Unknown error";i.value=`Error resetting session: ${C}`,v.value=null}finally{p.value=!1}}}async function c(){if(o.value){p.value=!0,f.value="Deleting session...";try{const S=o.value.session_id;await d.deleteSession(S),t.currentRoute.value.params.sessionId===S&&t.push("/"),y&&y.hide()}catch(S){console.error("Error deleting session:",S);const C=S.data?.detail||S.message||"Unknown error";i.value=`Error deleting session: ${C}`,v.value=null}finally{p.value=!1}}}function E(){v.value=null,p.value=!1,f.value="",i.value=""}function N(){E(),o.value=null,a.hideModal()}return X(()=>a.currentModal,S=>{if(S?.name==="manage-session"&&y){const C=S.data||{};o.value=C.session,E(),y.show()}}),le(()=>{h.value&&ne(async()=>{const{default:S}=await import("./modal-B4rHLo2F.js").then(C=>C.m);return{default:S}},__vite__mapDeps([0,1])).then(({default:S})=>{y=new S(h.value),h.value.addEventListener("hidden.bs.modal",N)})}),ae(()=>{h.value&&h.value.removeEventListener("hidden.bs.modal",N),y&&y.dispose()}),(S,C)=>(l(),r("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:h},[e("div",Ku,[e("div",Yu,[e("div",Qu,[e("h5",Zu,g(v.value?_.value:"Manage Session"),1),C[1]||(C[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Xu,[p.value?(l(),r("div",ec,[C[2]||(C[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",tc,g(f.value),1)])):v.value==="reset"?(l(),r("div",sc,[...C[3]||(C[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):v.value==="delete"?(l(),r("div",oc,[C[6]||(C[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1)),e("p",nc,[C[4]||(C[4]=H("This will permanently delete session ",-1)),e("strong",null,g(o.value?.name),1),C[5]||(C[5]=H(".",-1))]),C[7]||(C[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(l(),r("div",lc,[i.value?(l(),r("div",ac,[C[8]||(C[8]=e("strong",null,"Error:",-1)),H(" "+g(i.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:C[0]||(C[0]=M=>i.value="")})])):P("",!0),C[15]||(C[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",rc,[e("button",{class:"btn btn-outline-primary text-start",onClick:k,disabled:p.value},[...C[9]||(C[9]=[e("strong",null,"🔄 Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,ic),e("button",{class:"btn btn-outline-secondary text-start",onClick:j,disabled:p.value},[...C[10]||(C[10]=[e("strong",null,"🚪 End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,dc),C[13]||(C[13]=e("hr",{class:"my-2"},null,-1)),C[14]||(C[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"⚠️ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:b,disabled:p.value},[...C[11]||(C[11]=[e("strong",null,"🗑️ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,uc),e("button",{class:"btn btn-outline-danger text-start",onClick:x,disabled:p.value},[...C[12]||(C[12]=[e("strong",null,"❌ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,cc)]),C[16]||(C[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),H(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",mc,[v.value&&!p.value?(l(),r(Q,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:T},"Cancel"),e("button",{type:"button",class:W(["btn",v.value==="delete"?"btn-danger":"btn-warning"]),onClick:w},g(v.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):p.value?P("",!0):(l(),r("button",pc,"Cancel"))])])])],512))}},fc=q(vc,[["__scopeId","data-v-de7ff18c"]]),gc={class:"modal-dialog modal-dialog-centered modal-lg"},_c={class:"modal-content"},bc={class:"modal-body"},hc={key:0,class:"text-center text-muted py-4"},yc={key:1},$c={class:"mb-3"},wc={class:"font-monospace small"},Sc={class:"mb-3"},kc={class:"font-monospace small"},Cc={class:"mb-3"},xc={class:"mb-3"},jc={class:"mb-3"},Mc={key:0},Tc={class:"d-flex flex-wrap gap-1"},Ec={key:1,class:"text-muted small"},Pc={key:0,class:"mb-3"},Ic={class:"d-flex flex-wrap gap-1"},Lc={key:1,class:"mb-3"},Dc={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},Oc={class:"mb-3"},Nc={class:"text-muted"},Ac={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},Rc={__name:"SessionInfoModal",setup(s){const t=J(),d=me(),a=ee(),n=I(null),o=I(!1),p=I(null);let f=null;const i=u(()=>{if(!n.value)return null;const _=t.initData.get(n.value);return _||(d.messagesBySession.get(n.value)||[]).find(T=>T.type==="system"&&(T.subtype==="init"||T.metadata?.subtype==="init")&&T.metadata?.init_data)?.metadata?.init_data||null});function v(_){return typeof _=="string"?_:typeof _=="object"&&_.type==="preset"?`Preset: ${_.preset}`:JSON.stringify(_,null,2)}function h(){n.value=null,o.value=!1}function y(){h(),a.hideModal()}return X(()=>a.currentModal,_=>{if(_?.name==="session-info"&&f){const b=_.data||{};n.value=b.sessionId,o.value=!1,f.show()}}),le(()=>{p.value&&ne(async()=>{const{default:_}=await import("./modal-B4rHLo2F.js").then(b=>b.m);return{default:_}},__vite__mapDeps([0,1])).then(({default:_})=>{f=new _(p.value),p.value.addEventListener("hidden.bs.modal",y)})}),ae(()=>{p.value&&p.value.removeEventListener("hidden.bs.modal",y),f&&f.dispose()}),(_,b)=>(l(),r("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:p},[e("div",gc,[e("div",_c,[b[9]||(b[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",bc,[i.value?(l(),r("div",yc,[e("div",$c,[b[1]||(b[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",wc,g(n.value),1)]),e("div",Sc,[b[2]||(b[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",kc,g(i.value.cwd||"Not specified"),1)]),e("div",Cc,[b[3]||(b[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,g(i.value.model||"Default"),1)]),e("div",xc,[b[4]||(b[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,g(i.value.permissionMode||"default"),1)]),e("div",jc,[b[5]||(b[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),i.value.tools&&i.value.tools.length>0?(l(),r("div",Mc,[e("div",Tc,[(l(!0),r(Q,null,Z(i.value.tools,x=>(l(),r("span",{key:x,class:"badge bg-secondary"},g(x),1))),128))])])):(l(),r("div",Ec,"All tools available"))]),i.value.commands&&i.value.commands.length>0?(l(),r("div",Pc,[b[6]||(b[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",Ic,[(l(!0),r(Q,null,Z(i.value.commands,x=>(l(),r("span",{key:x,class:"badge bg-info"},g(x),1))),128))])])):P("",!0),i.value.systemPrompt?(l(),r("div",Lc,[b[7]||(b[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",Dc,g(v(i.value.systemPrompt)),1)])):P("",!0),e("div",Oc,[e("h6",Nc,[b[8]||(b[8]=H(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:b[0]||(b[0]=x=>o.value=!o.value)},g(o.value?"Hide":"Show"),1)]),o.value?(l(),r("pre",Ac,g(JSON.stringify(i.value,null,2)),1)):P("",!0)])])):(l(),r("div",hc," No session configuration data available "))]),b[10]||(b[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},qc=q(Rc,[["__scopeId","data-v-809e2099"]]),Uc={class:"modal-dialog modal-dialog-centered"},Wc={class:"modal-content"},Hc={class:"modal-body"},Fc={class:"mb-3"},Bc={class:"mb-3"},Vc={class:"mb-3"},zc={class:"form-text d-flex justify-content-between"},Jc={key:0,class:"invalid-feedback"},Gc={class:"mb-3 form-check"},Kc={key:0,class:"form-text text-warning"},Yc={class:"mb-3"},Qc={key:0,class:"alert alert-danger"},Zc={class:"modal-footer"},Xc=["disabled"],em={key:0,class:"spinner-border spinner-border-sm me-2"},tm={__name:"CreateMinionModal",setup(s){const t=ue(),d=se(),a=J(),n=ee(),o=I(null);let p=null;const f=I(null),i=I({name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]}),v=I(""),h=I(""),y=I(!1),_=u(()=>v.value.trim()?v.value.split(",").map(m=>m.trim()).filter(m=>m.length>0):[]),b=u(()=>i.value.initialization_context.length),x=u(()=>b.value>2e3),T=u(()=>b.value>1800&&b.value<=2e3);function w(){i.value={name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]},v.value="",h.value="",y.value=!1}function k(){w(),n.hideModal()}async function j(){if(!i.value.name.trim()){h.value="Minion name is required";return}if(i.value.name.includes(" ")){h.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(x.value){h.value="Initialization context exceeds 2000 character limit";return}if(!f.value){h.value="Legion ID is missing";return}y.value=!0,h.value="";try{const m={name:i.value.name.trim(),role:i.value.role.trim(),initialization_context:i.value.initialization_context.trim(),override_system_prompt:i.value.override_system_prompt,capabilities:_.value},c=await G.post(`/api/legions/${f.value}/minions`,m);c.success&&c.minion_id?(await d.fetchProjects(),await a.fetchSessions(),p&&p.hide(),t.push(`/spy/${f.value}/${c.minion_id}`)):h.value="Failed to create minion"}catch(m){console.error("Failed to create minion:",m),h.value=m.response?.data?.detail||"Failed to create minion"}finally{y.value=!1}}return X(()=>n.currentModal,m=>{if(m?.name==="create-minion"&&p){const c=m.data||{};f.value=c.project?.project_id||null,w(),p.show()}}),le(()=>{o.value&&ne(()=>import("./modal-B4rHLo2F.js").then(m=>m.m),__vite__mapDeps([0,1])).then(m=>{const c=m.default;p=new c(o.value),o.value.addEventListener("hidden.bs.modal",k)})}),ae(()=>{o.value&&o.value.removeEventListener("hidden.bs.modal",k),p&&p.dispose()}),(m,c)=>(l(),r("div",{ref_key:"modalElement",ref:o,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",Uc,[e("div",Wc,[c[15]||(c[15]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Hc,[e("form",{onSubmit:ie(j,["prevent"])},[e("div",Fc,[c[5]||(c[5]=e("label",{for:"minion-name",class:"form-label"},[H(" Name "),e("span",{class:"text-danger"},"*")],-1)),K(e("input",{id:"minion-name","onUpdate:modelValue":c[0]||(c[0]=E=>i.value.name=E),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[te,i.value.name]]),c[6]||(c[6]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",Bc,[c[7]||(c[7]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),K(e("input",{id:"minion-role","onUpdate:modelValue":c[1]||(c[1]=E=>i.value.role=E),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[te,i.value.role]]),c[8]||(c[8]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",Vc,[c[9]||(c[9]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),K(e("textarea",{id:"minion-context","onUpdate:modelValue":c[2]||(c[2]=E=>i.value.initialization_context=E),class:W(["form-control",{"is-invalid":x.value}]),rows:"4",maxlength:2e3,placeholder:"Instructions and context for the minion..."},null,2),[[te,i.value.initialization_context]]),e("div",zc,[e("span",null,g(i.value.override_system_prompt?"This context will replace Claude Code's preset and legion guide":"This context will be appended to legion guide and Claude Code's preset"),1),e("span",{class:W({"text-danger":x.value,"text-warning":T.value})},g(b.value)+" / 2000 chars ",3)]),x.value?(l(),r("div",Jc," Initialization context exceeds 2000 character limit (Windows command-line constraint) ")):P("",!0)]),e("div",Gc,[K(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":c[3]||(c[3]=E=>i.value.override_system_prompt=E)},null,512),[[fe,i.value.override_system_prompt]]),c[11]||(c[11]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom context only) ",-1)),i.value.override_system_prompt?(l(),r("div",Kc,[...c[10]||(c[10]=[e("small",null,"⚠️ Override mode may cause unexpected behaviors. Only custom context will be used (no legion guide or Claude Code preset).",-1)])])):P("",!0)]),e("div",Yc,[c[12]||(c[12]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),K(e("input",{id:"minion-capabilities","onUpdate:modelValue":c[4]||(c[4]=E=>v.value=E),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[te,v.value]]),c[13]||(c[13]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),h.value?(l(),r("div",Qc,g(h.value),1)):P("",!0)],32)]),e("div",Zc,[c[14]||(c[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!i.value.name.trim()||y.value,onClick:j},[y.value?(l(),r("span",em)):P("",!0),H(" "+g(y.value?"Creating...":"Create Minion"),1)],8,Xc)])])])],512))}},sm=q(tm,[["__scopeId","data-v-d7434e2a"]]),om={class:"container-fluid vh-100 d-flex flex-column p-0"},nm={class:"d-flex flex-grow-1 overflow-hidden position-relative"},lm={class:"flex-grow-1 d-flex flex-column overflow-hidden"},am={__name:"App",setup(s){const t=ee(),d=pe(),a=J(),n=se(),o=ue(),p=u(()=>t.sidebarCollapsed),f=u(()=>t.isMobile);le(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),d.connectUI(),await Promise.all([n.fetchProjects(),a.fetchSessions()]);const h=window.location.hash;if(h.startsWith("#/session/")){const y=h.replace("#/session/","");a.sessions.has(y)&&await a.selectSession(y)}else if(h.startsWith("#/timeline/")){const y=h.replace("#/timeline/","");o.push(`/timeline/${y}`)}window.addEventListener("popstate",i),window.addEventListener("resize",t.handleResize)}),ae(()=>{window.removeEventListener("popstate",i),window.removeEventListener("resize",t.handleResize),d.disconnectUI()});function i(){const h=window.location.hash;if(h.startsWith("#/session/")){const y=h.replace("#/session/","");a.sessions.has(y)&&a.selectSession(y)}}function v(){t.toggleSidebar()}return(h,y)=>{const _=Re("router-view");return l(),r("div",om,[Y(ui),e("div",{id:"sidebar-backdrop",class:W({show:!p.value&&f.value}),onClick:v},null,2),e("div",nm,[Y(Ji),e("main",lm,[Y(_)])]),Y(ud),Y(Td),Y(Qd),Y(yu),Y(Gu),Y(fc),Y(qc),Y(sm)])}}},xe=He(am);xe.use(Fe());xe.use(ai);xe.mount("#app");
