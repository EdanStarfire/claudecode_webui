const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-_9qZhl31.js","assets/diff-vendor-Ewcr12io.js"])))=>i.map(i=>d[i]);
import{c as r,a as e,o as l,d as fe,r as I,b as c,t as y,e as F,n as H,u as be,w as Q,f as Ae,g as L,F as G,h as Y,i as ae,j as Ve,k as K,v as X,l as J,m as oe,p as Se,q as ze,s as le,x as ne,y as ue,z as Je,A as de,B as Ge,C as Ye,D as ie,E as ke,G as Qe,H as Ze}from"./vue-vendor-pF9JsJ7a.js";import{m as ge,p as Ce}from"./markdown-vendor-NDeOd9Uw.js";import{c as Xe}from"./diff-vendor-Ewcr12io.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function u(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=u(o);fetch(o.href,a)}})();const et={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},tt={__name:"NoSessionSelected",setup(s){return(t,u)=>(l(),r("div",et,[...u[0]||(u[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},st="modulepreload",ot=function(s){return"/"+s},qe={},se=function(t,u,i){let o=Promise.resolve();if(u&&u.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),g=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));o=Promise.allSettled(u.map(n=>{if(n=ot(n),n in qe)return;qe[n]=!0;const v=n.endsWith(".css"),h=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${h}`))return;const $=document.createElement("link");if($.rel=v?"stylesheet":st,v||($.as="script"),$.crossOrigin="",$.href=n,g&&$.setAttribute("nonce",g),document.head.appendChild($),v)return new Promise((d,_)=>{$.addEventListener("load",d),$.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${n}`)))})}))}function a(f){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=f,window.dispatchEvent(g),!g.defaultPrevented)throw f}return o.then(f=>{for(const g of f||[])g.status==="rejected"&&a(g.reason);return t().catch(a)})};class ye extends Error{constructor(t,u,i){super(t),this.name="APIError",this.status=u,this.data=i}}async function _e(s,t={}){try{const u=await fetch(s,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!u.ok){let o;try{o=await u.json()}catch{o={detail:u.statusText}}throw new ye(o.detail||`HTTP ${u.status}: ${u.statusText}`,u.status,o)}const i=u.headers.get("content-type");return i&&i.includes("application/json")?await u.json():await u.text()}catch(u){throw u instanceof ye?u:(console.error("API request failed:",u),new ye(`Network error: ${u.message}`,0,null))}}async function nt(s,t={}){let u=s;if(t.params){const i=new URLSearchParams;for(const[g,n]of Object.entries(t.params))n!=null&&i.append(g,n);const o=i.toString();o&&(u=`${s}?${o}`);const{params:a,...f}=t;return _e(u,{...f,method:"GET"})}return _e(u,{...t,method:"GET"})}async function lt(s,t,u={}){return _e(s,{...u,method:"POST",body:JSON.stringify(t)})}async function at(s,t,u={}){return _e(s,{...u,method:"PUT",body:JSON.stringify(t)})}async function rt(s,t={}){return _e(s,{...t,method:"DELETE"})}const z={get:nt,post:lt,put:at,delete:rt},V=fe("session",()=>{const s=I(new Map),t=I(null),u=I(new Map),i=I(new Map),o=I(new Set),a=c(()=>s.value.get(t.value)),f=c(()=>Array.from(s.value.values()).sort((S,M)=>S.order-M.order)),g=S=>c(()=>f.value.filter(M=>M.project_id===S)),n=c({get:()=>u.value.get(t.value)||"",set:S=>{t.value&&u.value.set(t.value,S)}});async function v(){try{const S=await z.get("/api/sessions");return s.value.clear(),S.sessions.forEach(M=>{s.value.set(M.session_id,M)}),console.log(`Loaded ${s.value.size} sessions`),S.sessions}catch(S){throw console.error("Failed to fetch sessions:",S),S}}async function h(S,M){try{const A=(await z.post("/api/sessions",{project_id:S,...M})).session_id,w=(await z.get(`/api/sessions/${A}`)).session;return s.value.set(A,w),s.value=new Map(s.value),console.log(`Created session ${A}`),w}catch(q){throw console.error("Failed to create session:",q),q}}async function $(S){var k;if(t.value===S)return;t.value=S;let M=s.value.get(S);if(!M)try{M=(await z.get(`/api/sessions/${S}`)).session,s.value.set(S,M),s.value=new Map(s.value),console.log(`Fetched session ${S} for deeplink`)}catch(w){console.error(`Failed to fetch session ${S}:`,w);return}if(M&&(M.state==="created"||M.state==="terminated"))try{await m(S),console.log(`Auto-started session ${S} (was in ${M.state} state)`);const w=6e4,P=200,j=5e3;let D=0,O=0;for(;D<w;){const W=s.value.get(S);if(W&&W.state==="active"){console.log(`Session ${S} is now active after ${D}ms`);break}if(D-O>=j){const B=((k=s.value.get(S))==null?void 0:k.state)||"unknown";console.log(`Waiting for session ${S} to become active (current: ${B}, ${D/1e3}s elapsed)`),O=D}await new Promise(B=>setTimeout(B,P)),D+=P}const N=s.value.get(S);N&&N.state!=="active"&&console.warn(`Session ${S} did not become active within ${w/1e3}s (state: ${N.state}), continuing anyway`)}catch(w){console.error(`Failed to auto-start session ${S}:`,w)}await(await se(()=>Promise.resolve().then(()=>wt),void 0)).useMessageStore().loadMessages(S),(await se(()=>Promise.resolve().then(()=>Wt),void 0)).useWebSocketStore().connectSession(S),console.log(`Selected session ${S}`)}function d(S,M){const q=s.value.get(S);q&&(Object.assign(q,M),s.value=new Map(s.value))}async function _(S){o.value.add(S);try{await z.delete(`/api/sessions/${S}`),s.value.delete(S),u.value.delete(S),i.value.delete(S),s.value=new Map(s.value),t.value===S&&(t.value=null),console.log(`Deleted session ${S}`)}catch(M){throw console.error("Failed to delete session:",M),M}finally{o.value.delete(S)}}async function E(S,M){try{await z.put(`/api/sessions/${S}/name`,{name:M}),d(S,{name:M}),console.log(`Updated session ${S} name to "${M}"`)}catch(q){throw console.error("Failed to update session name:",q),q}}async function T(S,M){try{await z.post(`/api/sessions/${S}/permission-mode`,{mode:M}),d(S,{current_permission_mode:M});const q=i.value.get(S);q&&(q.permissionMode=M,i.value.set(S,q)),console.log(`Set permission mode for session ${S} to ${M}`)}catch(q){throw console.error("Failed to set permission mode:",q),q}}async function m(S){try{await z.post(`/api/sessions/${S}/start`),console.log(`Started session ${S}`)}catch(M){throw console.error("Failed to start session:",M),M}}async function p(S){try{await z.post(`/api/sessions/${S}/pause`),console.log(`Paused session ${S}`)}catch(M){throw console.error("Failed to pause session:",M),M}}async function C(S){try{await z.post(`/api/sessions/${S}/terminate`),console.log(`Terminated session ${S}`)}catch(M){throw console.error("Failed to terminate session:",M),M}}function b(S){return s.value.get(S)}function x(S,M){i.value.set(S,M),M.permissionMode&&d(S,{current_permission_mode:M.permissionMode})}return{sessions:s,currentSessionId:t,inputCache:u,initData:i,deletingSessions:o,currentSession:a,orderedSessions:f,sessionsInProject:g,currentInput:n,fetchSessions:v,createSession:h,selectSession:$,updateSession:d,deleteSession:_,updateSessionName:E,setPermissionMode:T,startSession:m,pauseSession:p,terminateSession:C,getSession:b,storeInitData:x}}),Re=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:V},Symbol.toStringTag,{value:"Module"})),Z=fe("ui",()=>{const s=I(window.innerWidth<768),t=I(300),u=I(window.innerWidth),i=c(()=>u.value<768),o=I(!0),a=I(null),f=I(null),g=c(()=>a.value?{name:a.value,data:f.value}:null),n=I(!1),v=I("Loading...");function h(){s.value=!s.value}function $(b){s.value=b}function d(b){t.value=Math.max(200,Math.min(b,window.innerWidth*.3))}function _(b){o.value=b}function E(b,x=null){a.value=null,f.value=null,setTimeout(()=>{a.value=b,f.value=x},0)}function T(){a.value=null,f.value=null}function m(b="Loading..."){n.value=!0,v.value=b}function p(){n.value=!1}function C(){const b=u.value;u.value=window.innerWidth,u.value<768&&b>=768?s.value=!0:u.value>=768&&b<768&&(s.value=!1)}return{sidebarCollapsed:s,sidebarWidth:t,isMobile:i,autoScrollEnabled:o,activeModal:a,modalData:f,currentModal:g,isLoading:n,loadingMessage:v,toggleSidebar:h,setSidebarCollapsed:$,setSidebarWidth:d,setAutoScroll:_,showModal:E,hideModal:T,showLoading:m,hideLoading:p,handleResize:C}}),ee=fe("project",()=>{const s=I(new Map),t=I(null),u=c(()=>s.value.get(t.value)),i=c(()=>Array.from(s.value.values()).sort((T,m)=>T.order-m.order)),o=T=>{const m=s.value.get(T);return(m==null?void 0:m.is_multi_agent)||!1};async function a(){try{const T=await z.get("/api/projects");return s.value.clear(),T.projects.forEach(m=>{s.value.set(m.project_id,m)}),console.log(`Loaded ${s.value.size} projects`),T.projects}catch(T){throw console.error("Failed to fetch projects:",T),T}}async function f(T,m,p=!1){try{const b=(await z.post("/api/projects",{name:T,working_directory:m,is_multi_agent:p})).project;return s.value.set(b.project_id,b),s.value=new Map(s.value),console.log(`Created project ${b.project_id}`),b}catch(C){throw console.error("Failed to create project:",C),C}}async function g(T,m){try{await z.put(`/api/projects/${T}`,m),n(T,m),console.log(`Updated project ${T}`,m)}catch(p){throw console.error("Failed to update project:",p),p}}function n(T,m){const p=s.value.get(T);p&&(Object.assign(p,m),s.value=new Map(s.value))}async function v(T){try{await z.delete(`/api/projects/${T}`),s.value.delete(T),s.value=new Map(s.value),t.value===T&&(t.value=null),console.log(`Deleted project ${T}`)}catch(m){throw console.error("Failed to delete project:",m),m}}async function h(T){try{const m=await z.put(`/api/projects/${T}/toggle-expansion`),p=s.value.get(T);return p&&(p.is_expanded=m.is_expanded,s.value=new Map(s.value)),m.is_expanded}catch(m){throw console.error("Failed to toggle expansion:",m),m}}async function $(T){try{await z.put("/api/projects/reorder",{project_ids:T}),T.forEach((m,p)=>{const C=s.value.get(m);C&&(C.order=p)}),s.value=new Map(s.value),console.log("Reordered projects",T)}catch(m){throw console.error("Failed to reorder projects:",m),m}}async function d(T,m){try{await z.put(`/api/projects/${T}/sessions/reorder`,{session_ids:m});const p=s.value.get(T);p&&(p.session_ids=m,s.value=new Map(s.value)),console.log(`Reordered sessions in project ${T}`,m)}catch(p){throw console.error("Failed to reorder sessions:",p),p}}function _(T){return s.value.get(T)}function E(T){if(!T)return"";const m=T.split(/[/\\]/).filter(p=>p);return m.length===0?"/":m.length===1?`/${m[0]}`:m.length===2?`/${m.join("/")}`:`.../${m.slice(-2).join("/")}`}return{projects:s,currentProjectId:t,currentProject:u,orderedProjects:i,isMultiAgent:o,fetchProjects:a,createProject:f,updateProject:g,updateProjectLocal:n,deleteProject:v,toggleExpansion:h,reorderProjects:$,reorderSessionsInProject:d,getProject:_,formatPath:E}}),U=(s,t)=>{const u=s.__vccOpts||s;for(const[i,o]of t)u[i]=o;return u},it={class:"session-header border-bottom p-3"},ut={class:"project-name"},dt=["title"],ct={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,u=V(),i=ee(),o=c(()=>u.sessions.get(t.sessionId)),a=c(()=>{var n;return((n=o.value)==null?void 0:n.name)||t.sessionId}),f=c(()=>{var n;for(const v of i.projects.values())if((n=v.session_ids)!=null&&n.includes(t.sessionId))return v;return null}),g=c(()=>{var n;return((n=f.value)==null?void 0:n.name)||"Unknown Project"});return(n,v)=>(l(),r("div",it,[e("div",null,[e("div",ut,y(g.value),1),e("div",{class:"session-name",title:s.sessionId},y(a.value),9,dt)])]))}},mt=U(ct,[["__scopeId","data-v-89e9c269"]]),pt={class:"session-status-bar border-top p-2 bg-light"},vt={class:"d-flex justify-content-between align-items-center gap-2"},ft={class:"d-flex gap-2"},gt=["disabled"],_t={class:"mode-label"},bt=["disabled"],ht=["disabled"],yt={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,u=V(),i=Z(),o=c(()=>u.sessions.get(t.sessionId)),a=c(()=>{var E;return((E=o.value)==null?void 0:E.current_permission_mode)||"default"}),f={default:"ðŸ”’",acceptEdits:"âœï¸",plan:"ðŸ“‹",bypassPermissions:"â˜¢ï¸"},g=c(()=>f[a.value]||"ðŸ”’"),n=c(()=>a.value),v=["default","acceptEdits","plan"],h=async()=>{if(!o.value)return;if(a.value==="bypassPermissions"){try{await u.setPermissionMode(t.sessionId,"default")}catch(p){console.error("Failed to cycle permission mode:",p)}return}const T=(v.indexOf(a.value)+1)%v.length,m=v[T];try{await u.setPermissionMode(t.sessionId,m)}catch(p){console.error("Failed to cycle permission mode:",p)}},$=()=>{i.showModal("session-info",{sessionId:t.sessionId})},d=()=>{i.showModal("manage-session",{session:o.value})},_=()=>{i.setAutoScroll(!i.autoScrollEnabled)};return(E,T)=>(l(),r("div",pt,[e("div",vt,[e("div",ft,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:h,disabled:!o.value},[F(y(g.value)+" ",1),e("span",_t,y(n.value),1)],8,gt),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:$,disabled:!o.value},[...T[0]||(T[0]=[F(" â„¹ï¸ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,bt),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:d,disabled:!o.value},[...T[1]||(T[1]=[F(" âš™ï¸ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,ht)]),e("div",null,[e("button",{class:H(["btn btn-sm",be(i).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:_}," â¬‡ï¸ "+y(be(i).autoScrollEnabled?"ON":"OFF"),3)])])]))}},$t=U(yt,[["__scopeId","data-v-fdcd3535"]]),ce=fe("message",()=>{const s=I(new Map),t=I(new Map),u=I(new Map),i=I(new Map),o=I(new Map),a=I(new Map),f=c(()=>{const k=V();return s.value.get(k.currentSessionId)||[]}),g=c(()=>{const k=V();return t.value.get(k.currentSessionId)||[]});async function n(k,w=null,P=0){try{const j=w||1e4,D=await z.get(`/api/sessions/${k}/messages?limit=${j}&offset=${P}`),O=D.messages||[],N=D.total_count||O.length,W=D.has_more||!1;console.log(`Loaded ${O.length} of ${N} messages for session ${k}`),s.value.set(k,O);const B=new Set;O.forEach(R=>{var ve,Me,Te,Ee,Pe,Ie,Le,De,Oe;R.type==="assistant"&&((ve=R.metadata)!=null&&ve.tool_uses)&&R.metadata.tool_uses.forEach(te=>{B.add(te.id)}),R.type==="user"&&((Me=R.metadata)!=null&&Me.tool_results)&&R.metadata.tool_results.forEach(te=>{B.delete(te.tool_use_id);const Ne=a.value.get(k);Ne&&Ne.delete(te.tool_use_id)}),R.type==="system"&&((Te=R.metadata)==null?void 0:Te.subtype)==="client_launched"&&(B.forEach(te=>{b(k,te,"Session was restarted")}),B.clear()),R.type==="system"&&((Ee=R.metadata)==null?void 0:Ee.subtype)==="interrupt"&&(B.forEach(te=>{b(k,te,"Session was interrupted")}),B.clear()),(Pe=R.metadata)!=null&&Pe.has_tool_uses&&R.metadata.tool_uses&&R.metadata.tool_uses.forEach(te=>{_(k,te)}),(Ie=R.metadata)!=null&&Ie.has_tool_results&&R.metadata.tool_results&&R.metadata.tool_results.forEach(te=>{m(k,te)}),(R.type==="permission_request"||(Le=R.metadata)!=null&&Le.has_permission_requests)&&E(k,R),R.type==="system"&&(R.subtype==="init"||((De=R.metadata)==null?void 0:De.subtype)==="init")&&((Oe=R.metadata)!=null&&Oe.init_data)&&V().storeInitData(k,R.metadata.init_data)});const re=V().sessions.get(k);return re&&!["active","paused","starting"].includes(re.state)&&(B.forEach(R=>{b(k,R,"Session was terminated")}),B.clear()),o.value.set(k,B),s.value=new Map(s.value),W&&console.warn(`Warning: Only loaded ${O.length} of ${N} messages. Some messages may be missing.`),{messages:O,totalCount:N,hasMore:W}}catch(j){throw console.error("Failed to load messages:",j),j}}function v(k,w){var j,D,O,N;const P=o.value.get(k)||new Set;w.type==="assistant"&&((j=w.metadata)!=null&&j.tool_uses)&&w.metadata.tool_uses.forEach(W=>{P.add(W.id)}),w.type==="user"&&((D=w.metadata)!=null&&D.tool_results)&&w.metadata.tool_results.forEach(W=>{P.delete(W.tool_use_id);const B=a.value.get(k);B&&B.delete(W.tool_use_id)}),w.type==="system"&&((O=w.metadata)==null?void 0:O.subtype)==="client_launched"&&(P.forEach(W=>{b(k,W,"Session was restarted")}),P.clear()),w.type==="system"&&((N=w.metadata)==null?void 0:N.subtype)==="interrupt"&&(P.forEach(W=>{b(k,W,"Session was interrupted")}),P.clear()),o.value.set(k,P)}function h(k,w){s.value.has(k)||s.value.set(k,[]),s.value.get(k).push(w),v(k,w),s.value=new Map(s.value)}function $(k,w){t.value.has(k)||t.value.set(k,[]),t.value.get(k).push(w),t.value=new Map(t.value)}function d(k,w,P){const j=t.value.get(k);if(j){const D=j.find(O=>O.id===w);D&&(Object.assign(D,P),t.value=new Map(t.value))}}function _(k,w){const P=C(w.name,w.input);u.value.set(P,w.id);const j={id:w.id,name:w.name,input:w.input,signature:P,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return $(k,j),console.log(`Created tool call ${j.id} for ${j.name}`),j}function E(k,w){var B,pe,re,R;console.log("handlePermissionRequest received:",w);const P=((B=w.metadata)==null?void 0:B.tool_name)||w.tool_name,j=((pe=w.metadata)==null?void 0:pe.input_params)||w.input_params,D=((re=w.metadata)==null?void 0:re.request_id)||w.request_id,O=((R=w.metadata)==null?void 0:R.suggestions)||w.suggestions||[];console.log("Extracted data:",{toolName:P,inputParams:j,requestId:D,suggestions:O});const N=C(P,j),W=u.value.get(N);W?(i.value.set(D,W),d(k,W,{status:"permission_required",permissionRequestId:D,suggestions:O}),console.log(`Permission required for tool ${W}`,{suggestions:O})):console.warn("No tool use ID found for permission request signature:",N,{toolName:P,inputParams:j,availableSignatures:Array.from(u.value.keys())})}function T(k,w){const P=i.value.get(w.request_id);if(P){const j={permissionDecision:w.decision,appliedUpdates:w.applied_updates||[]};w.decision==="allow"?j.status="executing":(j.status="completed",j.result={error:!0,message:w.reasoning||"Permission denied"},j.isExpanded=!1),d(k,P,j),console.log(`Permission ${w.decision} for tool ${P}`)}}function m(k,w){const P=w.tool_use_id;d(k,P,{status:w.is_error?"error":"completed",result:{error:w.is_error,content:w.content},isExpanded:!1}),console.log(`Tool ${P} ${w.is_error?"failed":"completed"}`)}function p(k,w){const P=t.value.get(k);if(P){const j=P.find(D=>D.id===w);j&&(j.isExpanded=!j.isExpanded,t.value=new Map(t.value))}}function C(k,w){if(!k)return"unknown:{}";if(!w||typeof w!="object")return`${k}:{}`;const P=JSON.stringify(w,Object.keys(w).sort());return`${k}:${P}`}function b(k,w,P){const j=a.value.get(k)||new Map;j.set(w,{reason:"denied",message:P}),a.value.set(k,j);const D=t.value.get(k);if(D){const O=D.find(N=>N.id===w);O&&O.isExpanded&&(O.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${w} as orphaned: ${P}`)}function x(k,w){var P;return((P=a.value.get(k))==null?void 0:P.has(w))||!1}function S(k,w){var P;return(P=a.value.get(k))==null?void 0:P.get(w)}function M(k,w){const P=o.value.get(k);P&&P.size>0&&(P.forEach(j=>b(k,j,w)),P.clear())}function q(k){s.value.delete(k),t.value.delete(k),s.value=new Map(s.value),t.value=new Map(t.value)}const A=V();return Q(()=>Array.from(A.sessions.values()).map(w=>({id:w.session_id,state:w.state})),(k,w)=>{w&&k.forEach((P,j)=>{const D=w[j];if(!D||D.id!==P.id)return;const O=["active","paused","starting"].includes(D.state),N=!["active","paused","starting"].includes(P.state);O&&N&&M(P.id,"Session was terminated")})},{deep:!0}),{messagesBySession:s,toolCallsBySession:t,activeToolUses:Ae(o),orphanedToolUses:Ae(a),currentMessages:f,currentToolCalls:g,loadMessages:n,addMessage:h,addToolCall:$,updateToolCall:d,handleToolUse:_,handlePermissionRequest:E,handlePermissionResponse:T,handleToolResult:m,toggleToolExpansion:p,clearMessages:q,markToolUseOrphaned:b,isToolUseOrphaned:x,getOrphanedInfo:S,clearOrphanedToolUses:M}}),wt=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:ce},Symbol.toStringTag,{value:"Module"}));function St(s){if(!s)return new Date;if(typeof s=="string"){const t=new Date(s);return isNaN(t.getTime())?new Date:t}return typeof s=="number"?s<1e10?new Date(s*1e3):new Date(s):new Date}function he(s){return St(s).toLocaleTimeString()}const kt={class:"card user-message bg-light border-start border-primary border-3"},Ct={class:"card-body"},xt={class:"d-flex justify-content-between align-items-center mb-2"},jt={class:"text-muted"},Mt=["innerHTML"],Tt={key:0,class:"tool-results mt-3"},Et={class:"tool-results-header text-muted small mb-2"},Pt={class:"d-flex align-items-start gap-2"},It={class:"flex-grow-1"},Lt={class:"text-muted"},Dt={key:0,class:"text-danger small"},Ot={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s;ge.setOptions({breaks:!0,gfm:!0});const u=c(()=>he(t.message.timestamp)),i=c(()=>{const g=t.message.content||"",n=ge.parse(g);return Ce.sanitize(n)}),o=c(()=>{var g,n,v;return((g=t.message.metadata)==null?void 0:g.has_tool_results)&&((v=(n=t.message.metadata)==null?void 0:n.tool_results)==null?void 0:v.length)>0}),a=c(()=>{var g;return((g=t.message.metadata)==null?void 0:g.tool_results)||[]});function f(g,n){return g?g.length<=n?g:g.substring(0,n)+"...":""}return(g,n)=>(l(),r("div",kt,[e("div",Ct,[e("div",xt,[n[0]||(n[0]=e("div",{class:"d-flex align-items-center gap-2"},[e("span",{class:"message-icon"},"ðŸ‘¤"),e("strong",{class:"message-role"},"User")],-1)),e("small",jt,y(u.value),1)]),e("div",{class:"message-content",innerHTML:i.value},null,8,Mt),o.value?(l(),r("div",Tt,[e("div",Et,[n[1]||(n[1]=e("i",{class:"bi bi-tools"},null,-1)),F(" Tool Results ("+y(a.value.length)+") ",1)]),(l(!0),r(G,null,Y(a.value,(v,h)=>(l(),r("div",{key:h,class:H(["tool-result-summary p-2 mb-2 rounded",v.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",Pt,[e("span",null,y(v.is_error?"âŒ":"âœ…"),1),e("div",It,[e("small",Lt,"Tool: "+y(v.tool_use_id),1),v.is_error?(l(),r("div",Dt,y(f(v.content,200)),1)):L("",!0)])])],2))),128))])):L("",!0)])]))}},Nt=U(Ot,[["__scopeId","data-v-532549d1"]]),At={class:"thinking-block"},qt={class:"text-muted ms-auto"},Rt={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},Ut=["innerHTML"],Ft={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(s){const t=s,u=I(!1),i=c(()=>{var f;return((f=t.thinking)==null?void 0:f.length)||0}),o=c(()=>{const f=t.thinking||"",g=ge.parse(f);return Ce.sanitize(g)});function a(){u.value=!u.value}return(f,g)=>(l(),r("div",At,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:a},[e("i",{class:H(["bi",u.value?"bi-chevron-down":"bi-chevron-right"])},null,2),g[0]||(g[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),F(" Thinking ")],-1)),e("small",qt,y(i.value)+" characters",1)]),u.value?(l(),r("div",Rt,[e("div",{class:"thinking-text",innerHTML:o.value},null,8,Ut)])):L("",!0)]))}},Ht=U(Ft,[["__scopeId","data-v-619a8344"]]),me=fe("websocket",()=>{const s=I(null),t=I(!1),u=I(0),i=10,o=I(null),a=I(!1),f=I(0),g=5,n=I(null),v=I(null),h=I(!1),$=I(0),d=5,_=I(null),E=c(()=>t.value&&(a.value||!n.value)?"connected":t.value?"partial":"disconnected");function T(j){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${j}`}function m(){if(s.value)return;const j=T("/ws/ui");console.log(`Connecting to UI WebSocket: ${j}`),s.value=new WebSocket(j),s.value.onopen=()=>{t.value=!0,u.value=0,console.log("UI WebSocket connected")},s.value.onmessage=D=>{const O=JSON.parse(D.data);q(O)},s.value.onclose=()=>{if(t.value=!1,s.value=null,console.log("UI WebSocket closed"),u.value<i){u.value++;const D=Math.min(2e3*u.value,3e4);console.log(`Reconnecting UI WebSocket in ${D}ms (attempt ${u.value})`),setTimeout(m,D)}},s.value.onerror=D=>{console.error("UI WebSocket error:",D)}}function p(){s.value&&(s.value.close(),s.value=null,t.value=!1)}function C(j){b(),n.value=j;const D=T(`/ws/session/${j}`);console.log(`Connecting to Session WebSocket: ${D}`),o.value=new WebSocket(D),o.value.onopen=()=>{a.value=!0,f.value=0,console.log(`Session WebSocket connected for ${j}`)},o.value.onmessage=O=>{const N=JSON.parse(O.data);A(N,j)},o.value.onclose=()=>{if(a.value=!1,o.value=null,console.log(`Session WebSocket closed for ${j}`),V().currentSessionId===j&&f.value<g){f.value++;const N=Math.min(2e3*f.value,3e4);console.log(`Reconnecting Session WebSocket in ${N}ms (attempt ${f.value})`),setTimeout(()=>C(j),N)}},o.value.onerror=O=>{console.error("Session WebSocket error:",O)}}function b(){o.value&&(o.value.close(),o.value=null,a.value=!1,n.value=null)}function x(j){o.value&&a.value?(o.value.send(JSON.stringify({type:"send_message",content:j})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function S(j,D,O=!1,N=null){if(o.value&&a.value){const W={type:"permission_response",request_id:j,decision:D,apply_suggestions:O,timestamp:new Date().toISOString()};N&&(W.clarification_message=N),o.value.send(JSON.stringify(W)),console.log(`Sent permission ${D} for request ${j}`,{applySuggestions:O,clarification:N})}}function M(){o.value&&a.value&&(o.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function q(j){const D=V(),O=ee();switch(j.type){case"sessions_list":j.sessions&&Array.isArray(j.sessions)&&j.sessions.forEach(N=>{D.updateSession(N.session_id,N)});break;case"state_change":j.data&&j.data.session_id&&j.data.session&&D.updateSession(j.data.session_id,j.data.session);break;case"project_updated":if(j.data&&j.data.project){const N=j.data.project;O.updateProjectLocal(N.project_id,N)}break;case"project_deleted":j.data&&j.data.project_id&&O.projects.delete(j.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":break;default:console.warn("Unknown UI WebSocket message type:",j.type)}}function A(j,D){var W,B,pe,re;const O=ce(),N=V();switch(j.type){case"message":const R=j.data;if(!R||!R.type){console.warn("Received message event with invalid data:",j);break}if(R.type==="permission_request"){O.handlePermissionRequest(D,R);break}if(R.type==="permission_response"){O.handlePermissionResponse(D,R);break}(W=R.metadata)!=null&&W.has_tool_uses&&R.metadata.tool_uses.forEach(ve=>{O.handleToolUse(D,ve)}),(B=R.metadata)!=null&&B.has_tool_results&&R.metadata.tool_results.forEach(ve=>{O.handleToolResult(D,ve)}),R.type==="system"&&(R.subtype==="init"||((pe=R.metadata)==null?void 0:pe.subtype)==="init")&&((re=R.metadata)!=null&&re.init_data)&&N.storeInitData(D,R.metadata.init_data),O.addMessage(D,R);break;case"permission_request":O.handlePermissionRequest(D,j);break;case"permission_response":O.handlePermissionResponse(D,j);break;case"tool_result":O.handleToolResult(D,j);break;case"state_change":N.updateSession(D,j.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${D}`);break;case"ping":break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function k(j){w(),_.value=j;const D=T(`/ws/legion/${j}`);console.log(`Connecting to Legion WebSocket: ${D}`),v.value=new WebSocket(D),v.value.onopen=()=>{h.value=!0,$.value=0,console.log(`Legion WebSocket connected for ${j}`)},v.value.onmessage=O=>{const N=JSON.parse(O.data);P(N,j)},v.value.onclose=()=>{if(h.value=!1,v.value=null,console.log(`Legion WebSocket closed for ${j}`),_.value===j&&$.value<d){$.value++;const O=Math.min(2e3*$.value,3e4);setTimeout(()=>k(j),O)}},v.value.onerror=O=>{console.error("Legion WebSocket error:",O)}}function w(){v.value&&(v.value.close(),v.value=null,h.value=!1,_.value=null)}function P(j,D){se(async()=>{const{useLegionStore:O}=await Promise.resolve().then(()=>Va);return{useLegionStore:O}},void 0).then(({useLegionStore:O})=>{const N=O();switch(j.type){case"comm":j.comm&&(N.addComm(D,j.comm),console.log("Legion WebSocket: Received new comm",j.comm));break;case"minion_created":j.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",j.data),se(async()=>{const{useSessionStore:W}=await Promise.resolve().then(()=>Re);return{useSessionStore:W}},void 0).then(({useSessionStore:W})=>{W().loadSessions()}));break;case"minion_updated":j.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",j.data),se(async()=>{const{useSessionStore:W}=await Promise.resolve().then(()=>Re);return{useSessionStore:W}},void 0).then(({useSessionStore:W})=>{W().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${D}`);break;case"ping":break;default:console.warn("Unknown Legion WebSocket message type:",j.type)}})}return{uiConnected:t,sessionConnected:a,legionConnected:h,overallStatus:E,connectUI:m,disconnectUI:p,connectSession:C,disconnectSession:b,sendMessage:x,sendPermissionResponse:S,interruptSession:M,connectLegion:k,disconnectLegion:w}}),Wt=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:me},Symbol.toStringTag,{value:"Module"})),Bt={class:"base-tool-handler"},Vt={class:"tool-section mb-3"},zt={class:"tool-parameters"},Jt={class:"tool-code"},Kt={key:0,class:"tool-section"},Gt={class:"tool-section-label"},Yt={class:"tool-code"},Qt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),i=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),o=c(()=>{var f;return((f=t.toolCall.result)==null?void 0:f.error)||t.toolCall.status==="error"}),a=c(()=>{if(!i.value)return"";const f=t.toolCall.result;return f.content!==void 0?typeof f.content=="string"?f.content:JSON.stringify(f.content,null,2):f.message?f.message:JSON.stringify(f,null,2)});return(f,g)=>(l(),r("div",Bt,[e("div",Vt,[g[0]||(g[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",zt,[e("pre",Jt,y(u.value),1)])]),i.value?(l(),r("div",Kt,[e("div",Gt,y(o.value?"Error:":"Result:"),1),e("div",{class:H(["tool-result",{"tool-result-error":o.value}])},[e("pre",Yt,y(a.value),1)],2)])):L("",!0)]))}},Zt=U(Qt,[["__scopeId","data-v-06a1b6c0"]]),Xt={class:"read-tool-handler"},es={class:"tool-section mb-3"},ts={class:"read-file-info"},ss={class:"file-path"},os={key:0,class:"read-range"},ns={key:0,class:"tool-section"},ls={key:0,class:"tool-result tool-result-error"},as={class:"tool-code"},rs={key:1,class:"file-content-preview"},is={class:"content-header"},us={class:"line-count-badge"},ds={key:0,class:"preview-note"},cs={class:"tool-code content-display"},ms={key:0,class:"more-indicator"},$e=100,ps={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>{var _;return((_=t.toolCall.input)==null?void 0:_.file_path)||"Unknown"}),i=c(()=>{var T,m;const _=(T=t.toolCall.input)==null?void 0:T.offset,E=(m=t.toolCall.input)==null?void 0:m.limit;return _!==void 0||E!==void 0}),o=c(()=>{var E;const _=(E=t.toolCall.input)==null?void 0:E.offset;return _!==void 0?_+1:1}),a=c(()=>{var T,m;const _=((T=t.toolCall.input)==null?void 0:T.offset)||0,E=(m=t.toolCall.input)==null?void 0:m.limit;return E!==void 0?_+E:"âˆž"}),f=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),g=c(()=>{var _;return((_=t.toolCall.result)==null?void 0:_.error)||t.toolCall.status==="error"}),n=c(()=>{if(!f.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)}),v=c(()=>g.value||!n.value?[]:n.value.split(`
`)),h=c(()=>v.value.length),$=c(()=>h.value>$e),d=c(()=>g.value?"":v.value.slice(0,$e).join(`
`));return(_,E)=>(l(),r("div",Xt,[e("div",es,[e("div",ts,[E[0]||(E[0]=e("span",{class:"file-icon"},"ðŸ“„",-1)),E[1]||(E[1]=e("strong",null,"Reading:",-1)),e("code",ss,y(u.value),1),i.value?(l(),r("span",os,"Lines "+y(o.value)+"-"+y(a.value),1)):L("",!0)])]),f.value?(l(),r("div",ns,[g.value?(l(),r("div",ls,[e("pre",as,y(n.value),1)])):(l(),r("div",rs,[e("div",is,[E[2]||(E[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",us,y(h.value)+" lines",1),$.value?(l(),r("span",ds,"(showing first "+y($e)+")")):L("",!0)]),e("pre",cs,y(d.value),1),$.value?(l(),r("div",ms,"...")):L("",!0)]))])):L("",!0)]))}},vs=U(ps,[["__scopeId","data-v-0382f812"]]),fs={class:"write-tool-handler"},gs={class:"tool-section mb-3"},_s={class:"write-file-info mb-2"},bs={class:"file-path"},hs={class:"write-content-preview"},ys={class:"content-header"},$s={class:"line-count-badge"},ws={key:0,class:"preview-note"},Ss={class:"tool-code content-display"},ks={key:0,class:"more-indicator"},Cs={key:0,class:"tool-section"},xs={key:0,class:"tool-result tool-result-error"},js={class:"tool-code"},Ms={key:1,class:"tool-result tool-result-success"},Ts={class:"success-message"},we=100,Es={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>{var $;return(($=t.toolCall.input)==null?void 0:$.file_path)||"Unknown"}),i=c(()=>{var $;return(($=t.toolCall.input)==null?void 0:$.content)||""}),o=c(()=>i.value.split(`
`)),a=c(()=>o.value.length),f=c(()=>a.value>we),g=c(()=>o.value.slice(0,we).join(`
`)),n=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=c(()=>{var $;return(($=t.toolCall.result)==null?void 0:$.error)||t.toolCall.status==="error"}),h=c(()=>{if(!n.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)});return($,d)=>(l(),r("div",fs,[e("div",gs,[e("div",_s,[d[0]||(d[0]=e("span",{class:"file-icon"},"ðŸ“",-1)),d[1]||(d[1]=e("strong",null,"Writing:",-1)),e("code",bs,y(u.value),1)]),e("div",hs,[e("div",ys,[d[2]||(d[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",$s,y(a.value)+" lines",1),f.value?(l(),r("span",ws,"(showing first "+y(we)+")")):L("",!0)]),e("pre",Ss,y(g.value),1),f.value?(l(),r("div",ks,"...")):L("",!0)])]),n.value?(l(),r("div",Cs,[v.value?(l(),r("div",xs,[d[3]||(d[3]=e("strong",null,"Error:",-1)),e("pre",js,y(h.value),1)])):(l(),r("div",Ms,[e("div",Ts,[d[4]||(d[4]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"File created successfully ("+y(a.value)+" lines written)",1)])]))])):L("",!0)]))}},Ps=U(Es,[["__scopeId","data-v-d09b89ef"]]),Is={class:"bash-tool-handler"},Ls={class:"tool-section mb-3"},Ds={class:"bash-header"},Os={class:"bash-header-content"},Ns={key:0,class:"bash-description"},As={key:1,class:"bash-flags"},qs={class:"bash-command-section"},Rs={class:"bash-command-content"},Us={key:0,class:"tool-section"},Fs={key:0,class:"bash-output"},Hs={key:1,class:"bash-output-empty"},Ws={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>{var d;return((d=t.toolCall.input)==null?void 0:d.command)||""}),i=c(()=>{var d;return((d=t.toolCall.input)==null?void 0:d.description)||""}),o=c(()=>{var d;return(d=t.toolCall.input)==null?void 0:d.timeout}),a=c(()=>{var d;return((d=t.toolCall.input)==null?void 0:d.run_in_background)||!1}),f=c(()=>o.value||a.value),g=c(()=>{const d=[];return o.value&&d.push(`timeout: ${o.value}ms`),a.value&&d.push("background"),d.join(", ")}),n=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=c(()=>{var d;return((d=t.toolCall.result)==null?void 0:d.error)||t.toolCall.status==="error"}),h=c(()=>v.value?"tool-result-error":"tool-result-success"),$=c(()=>{if(!n.value)return"";const d=t.toolCall.result;return d.content!==void 0?typeof d.content=="string"?d.content:JSON.stringify(d.content,null,2):d.message?d.message:JSON.stringify(d,null,2)});return(d,_)=>(l(),r("div",Is,[e("div",Ls,[e("div",Ds,[_[1]||(_[1]=e("span",{class:"bash-icon"},"ðŸ’»",-1)),e("div",Os,[i.value?(l(),r("div",Ns,[_[0]||(_[0]=e("strong",null,"Description:",-1)),F(" "+y(i.value),1)])):L("",!0),f.value?(l(),r("div",As,y(g.value),1)):L("",!0)])]),e("div",qs,[_[2]||(_[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",Rs,y(u.value),1)])]),n.value?(l(),r("div",Us,[e("div",{class:H(["tool-result",h.value])},[_[3]||(_[3]=e("strong",null,"Output:",-1)),$.value?(l(),r("pre",Fs,y($.value),1)):(l(),r("div",Hs,"No output"))],2)])):L("",!0)]))}},Bs=U(Ws,[["__scopeId","data-v-055645e9"]]),Vs={class:"todo-tool-handler"},zs={class:"tool-section mb-3"},Js={class:"todo-header"},Ks={class:"todo-summary"},Gs={key:0,class:"todo-count todo-count-completed"},Ys={key:1,class:"todo-count todo-count-in-progress"},Qs={key:2,class:"todo-count todo-count-pending"},Zs={class:"todo-checklist"},Xs={class:"todo-checkbox"},eo={class:"todo-content"},to={key:0,class:"tool-section"},so={key:0,class:"tool-result tool-result-error"},oo={class:"tool-code"},no={key:1,class:"tool-result tool-result-success"},lo={class:"success-message"},ao={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>{var h;return((h=t.toolCall.input)==null?void 0:h.todos)||[]}),i=c(()=>u.value.filter(h=>h.status==="completed").length),o=c(()=>u.value.filter(h=>h.status==="in_progress").length),a=c(()=>u.value.filter(h=>h.status==="pending").length);function f(h){return{pending:"â˜",in_progress:"â—",completed:"â˜‘"}[h]||"â˜"}const g=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),n=c(()=>{var h;return((h=t.toolCall.result)==null?void 0:h.error)||t.toolCall.status==="error"}),v=c(()=>{if(!g.value)return"";const h=t.toolCall.result;return h.content!==void 0?typeof h.content=="string"?h.content:JSON.stringify(h.content,null,2):h.message?h.message:JSON.stringify(h,null,2)});return(h,$)=>(l(),r("div",Vs,[e("div",zs,[e("div",Js,[$[0]||($[0]=e("span",{class:"todo-icon"},"ðŸ“‹",-1)),$[1]||($[1]=e("strong",null,"Task List:",-1)),e("div",Ks,[i.value>0?(l(),r("span",Gs,y(i.value)+" completed ",1)):L("",!0),o.value>0?(l(),r("span",Ys,y(o.value)+" in progress ",1)):L("",!0),a.value>0?(l(),r("span",Qs,y(a.value)+" pending ",1)):L("",!0)])]),e("div",Zs,[(l(!0),r(G,null,Y(u.value,(d,_)=>(l(),r("div",{key:_,class:H(["todo-item",`todo-${d.status}`])},[e("span",Xs,y(f(d.status)),1),e("span",eo,y(d.content),1)],2))),128))])]),g.value?(l(),r("div",to,[n.value?(l(),r("div",so,[$[2]||($[2]=e("strong",null,"Error:",-1)),e("pre",oo,y(v.value),1)])):(l(),r("div",no,[e("div",lo,[$[3]||($[3]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"Task list updated ("+y(u.value.length)+" tasks)",1)])]))])):L("",!0)]))}},ro=U(ao,[["__scopeId","data-v-0984bcf9"]]),io={class:"edit-tool-handler"},uo={class:"tool-section mb-3"},co={class:"edit-file-info"},mo={class:"file-path"},po={key:0,class:"replace-all-badge"},vo={class:"edit-diff-container"},fo={class:"diff-header"},go={class:"diff-stats"},_o={class:"stat-removed"},bo={class:"stat-added"},ho={class:"unified-diff"},yo={class:"diff-scroll-container"},$o={class:"diff-marker"},wo={class:"diff-content"},So={key:0,class:"tool-section"},ko={key:0,class:"tool-result tool-result-error"},Co={class:"tool-code"},xo={key:1,class:"tool-result tool-result-success"},jo={class:"success-message"},Mo={key:0,class:"success-detail"},To={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>{var d;return((d=t.toolCall.input)==null?void 0:d.file_path)||"Unknown"}),i=c(()=>{var d;return((d=t.toolCall.input)==null?void 0:d.old_string)||""}),o=c(()=>{var d;return((d=t.toolCall.input)==null?void 0:d.new_string)||""}),a=c(()=>{var d;return((d=t.toolCall.input)==null?void 0:d.replace_all)||!1}),f=c(()=>{const _=Xe(u.value,i.value,o.value,"","",{context:3}).split(`
`),E=[];for(let T=4;T<_.length;T++){const m=_[T];m&&(m.startsWith("-")?E.push({type:"removed",content:m.substring(1)}):m.startsWith("+")?E.push({type:"added",content:m.substring(1)}):m.startsWith(" ")?E.push({type:"context",content:m.substring(1)}):m.startsWith("@@")&&E.push({type:"hunk",content:m}))}return E}),g=c(()=>f.value.filter(d=>d.type==="removed").length),n=c(()=>f.value.filter(d=>d.type==="added").length),v=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),h=c(()=>{var d;return((d=t.toolCall.result)==null?void 0:d.error)||t.toolCall.status==="error"}),$=c(()=>{if(!v.value)return"";const d=t.toolCall.result;return d.content!==void 0?typeof d.content=="string"?d.content:JSON.stringify(d.content,null,2):d.message?d.message:JSON.stringify(d,null,2)});return(d,_)=>(l(),r("div",io,[e("div",uo,[e("div",co,[_[0]||(_[0]=e("span",{class:"file-icon"},"âœï¸",-1)),_[1]||(_[1]=e("strong",null,"Editing:",-1)),e("code",mo,y(u.value),1),a.value?(l(),r("span",po,"Replace All")):L("",!0)]),e("div",vo,[e("div",fo,[_[2]||(_[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",go,[e("span",_o,"-"+y(g.value),1),e("span",bo,"+"+y(n.value),1)])]),e("div",ho,[e("div",yo,[(l(!0),r(G,null,Y(f.value,(E,T)=>(l(),r("div",{key:T,class:H(["diff-line",{"diff-line-removed":E.type==="removed","diff-line-added":E.type==="added","diff-line-context":E.type==="context","diff-line-hunk":E.type==="hunk"}])},[e("span",$o,y(E.type==="removed"?"-":E.type==="added"?"+":E.type==="hunk"?"@":" "),1),e("span",wo,y(E.content),1)],2))),128))])])])]),v.value?(l(),r("div",So,[h.value?(l(),r("div",ko,[_[3]||(_[3]=e("strong",null,"Error:",-1)),e("pre",Co,y($.value),1)])):(l(),r("div",xo,[e("div",jo,[_[4]||(_[4]=e("span",{class:"success-icon"},"âœ…",-1)),_[5]||(_[5]=e("strong",null,"File edited successfully",-1)),a.value?(l(),r("span",Mo,"(all occurrences replaced)")):L("",!0)])]))])):L("",!0)]))}},Eo=U(To,[["__scopeId","data-v-b06adbf2"]]),Po={class:"search-tool-handler"},Io={class:"tool-section mb-3"},Lo={class:"search-info"},Do={class:"search-icon"},Oo={class:"search-pattern"},No={key:0,class:"search-path"},Ao={key:1,class:"search-filters"},qo={key:0,class:"filter-badge"},Ro={key:1,class:"filter-badge"},Uo={key:2,class:"filter-badge"},Fo={key:0,class:"tool-section"},Ho={key:0,class:"tool-result tool-result-error"},Wo={class:"tool-code"},Bo={key:1,class:"search-results"},Vo={class:"results-header"},zo={class:"results-label"},Jo={class:"results-count-badge"},Ko={class:"results-content"},Go={class:"tool-code"},Yo={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>t.toolCall.name==="Grep");c(()=>t.toolCall.name==="Glob");const i=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m.pattern)||"Unknown"}),o=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m.path)||null}),a=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m.type)||null}),f=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m.glob)||null}),g=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m["-i"])||!1}),n=c(()=>a.value||f.value||g.value),v=c(()=>u.value?"ðŸ”":"ðŸ“"),h=c(()=>u.value?"Searching content":"Finding files"),$=c(()=>u.value?"Matches":"Files found"),d=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),_=c(()=>{var m;return((m=t.toolCall.result)==null?void 0:m.error)||t.toolCall.status==="error"}),E=c(()=>{if(!d.value)return"";const m=t.toolCall.result;return m.content!==void 0?typeof m.content=="string"?m.content:JSON.stringify(m.content,null,2):m.message?m.message:JSON.stringify(m,null,2)}),T=c(()=>!d.value||_.value||!E.value?0:E.value.split(`
`).filter(p=>p.trim()).length);return(m,p)=>(l(),r("div",Po,[e("div",Io,[e("div",Lo,[e("span",Do,y(v.value),1),e("strong",null,y(h.value)+":",1),e("code",Oo,y(i.value),1),o.value?(l(),r("span",No,"in "+y(o.value),1)):L("",!0),n.value?(l(),r("span",Ao,[a.value?(l(),r("span",qo,"type: "+y(a.value),1)):L("",!0),f.value?(l(),r("span",Ro,"glob: "+y(f.value),1)):L("",!0),g.value?(l(),r("span",Uo,"case-insensitive")):L("",!0)])):L("",!0)])]),d.value?(l(),r("div",Fo,[_.value?(l(),r("div",Ho,[p[0]||(p[0]=e("strong",null,"Error:",-1)),e("pre",Wo,y(E.value),1)])):(l(),r("div",Bo,[e("div",Vo,[e("span",zo,y($.value)+":",1),e("span",Jo,y(T.value)+" "+y(T.value===1?"match":"matches"),1)]),e("div",Ko,[e("pre",Go,y(E.value),1)])]))])):L("",!0)]))}},Ue=U(Yo,[["__scopeId","data-v-dc01ae0d"]]),Qo={class:"web-tool-handler"},Zo={class:"tool-section mb-3"},Xo={class:"web-info"},en={class:"web-icon"},tn=["href"],sn={key:1,class:"web-query"},on={key:0,class:"web-prompt-container"},nn={class:"prompt-content"},ln={key:1,class:"web-domains"},an={class:"domains-label"},rn={key:0,class:"tool-section"},un={key:0,class:"tool-result tool-result-error"},dn={class:"tool-code"},cn={key:1,class:"web-results"},mn={class:"results-header"},pn={class:"results-label"},vn={class:"results-content"},fn={class:"tool-code"},gn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>t.toolCall.name==="WebFetch");c(()=>t.toolCall.name==="WebSearch");const i=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m.url)||null}),o=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m.query)||null}),a=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m.prompt)||null}),f=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m.allowed_domains)||[]}),g=c(()=>{var m;return((m=t.toolCall.input)==null?void 0:m.blocked_domains)||[]}),n=c(()=>f.value.length>0?f.value:g.value.length>0?g.value:[]),v=c(()=>f.value.length>0?"Allowed domains":g.value.length>0?"Blocked domains":"Domains"),h=c(()=>u.value?"ðŸŒ":"ðŸ”Ž"),$=c(()=>u.value?"Fetching URL":"Searching web"),d=c(()=>u.value?"Fetched content":"Search results"),_=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),E=c(()=>{var m;return((m=t.toolCall.result)==null?void 0:m.error)||t.toolCall.status==="error"}),T=c(()=>{if(!_.value)return"";const m=t.toolCall.result;return m.content!==void 0?typeof m.content=="string"?m.content:JSON.stringify(m.content,null,2):m.message?m.message:JSON.stringify(m,null,2)});return(m,p)=>(l(),r("div",Qo,[e("div",Zo,[e("div",Xo,[e("span",en,y(h.value),1),e("strong",null,y($.value)+":",1),i.value?(l(),r("a",{key:0,href:i.value,target:"_blank",class:"web-url"},y(i.value),9,tn)):o.value?(l(),r("code",sn,y(o.value),1)):L("",!0)]),a.value?(l(),r("div",on,[p[0]||(p[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",nn,y(a.value),1)])):L("",!0),n.value.length>0?(l(),r("div",ln,[e("span",an,y(v.value)+":",1),(l(!0),r(G,null,Y(n.value,C=>(l(),r("span",{key:C,class:"domain-badge"},y(C),1))),128))])):L("",!0)]),_.value?(l(),r("div",rn,[E.value?(l(),r("div",un,[p[1]||(p[1]=e("strong",null,"Error:",-1)),e("pre",dn,y(T.value),1)])):(l(),r("div",cn,[e("div",mn,[e("span",pn,y(d.value)+":",1)]),e("div",vn,[e("pre",fn,y(T.value),1)])]))])):L("",!0)]))}},Fe=U(gn,[["__scopeId","data-v-49e16a90"]]),_n={class:"task-tool-handler"},bn={class:"tool-section mb-3"},hn={class:"task-header"},yn={key:0,class:"agent-type-badge"},$n={key:0,class:"task-description"},wn={class:"description-content"},Sn={key:1,class:"task-prompt-container"},kn={class:"prompt-header"},Cn={class:"prompt-length"},xn={class:"prompt-code"},jn={key:0,class:"tool-section"},Mn={key:0,class:"tool-result tool-result-error"},Tn={class:"tool-code"},En={key:1,class:"agent-output"},Pn={class:"output-header"},In={key:0,class:"output-count-badge"},Ln={class:"output-content"},Dn={class:"tool-code"},On={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>{var v;return((v=t.toolCall.input)==null?void 0:v.description)||null}),i=c(()=>{var v;return((v=t.toolCall.input)==null?void 0:v.prompt)||null}),o=c(()=>{var v;return((v=t.toolCall.input)==null?void 0:v.subagent_type)||null}),a=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),f=c(()=>{var v;return((v=t.toolCall.result)==null?void 0:v.error)||t.toolCall.status==="error"}),g=c(()=>{if(!a.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)}),n=c(()=>g.value?g.value.split(`
`).length:0);return(v,h)=>(l(),r("div",_n,[e("div",bn,[e("div",hn,[h[0]||(h[0]=e("span",{class:"task-icon"},"ðŸ¤–",-1)),h[1]||(h[1]=e("strong",null,"Agent Task:",-1)),o.value?(l(),r("span",yn,y(o.value),1)):L("",!0)]),u.value?(l(),r("div",$n,[h[2]||(h[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",wn,y(u.value),1)])):L("",!0),i.value?(l(),r("div",Sn,[e("div",kn,[h[3]||(h[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",Cn,y(i.value.length)+" characters",1)]),e("pre",xn,y(i.value),1)])):L("",!0)]),a.value?(l(),r("div",jn,[f.value?(l(),r("div",Mn,[h[4]||(h[4]=e("strong",null,"Error:",-1)),e("pre",Tn,y(g.value),1)])):(l(),r("div",En,[e("div",Pn,[h[5]||(h[5]=e("span",{class:"output-label"},"Agent Output:",-1)),n.value>0?(l(),r("span",In,y(n.value)+" lines",1)):L("",!0)]),e("div",Ln,[e("pre",Dn,y(g.value),1)])]))])):L("",!0)]))}},Nn=U(On,[["__scopeId","data-v-513043f9"]]),An={class:"notebook-edit-tool-handler"},qn={class:"tool-section mb-3"},Rn={class:"notebook-info"},Un={class:"file-path"},Fn={class:"cell-info mt-2"},Hn={class:"info-row"},Wn={class:"info-row"},Bn={key:0,class:"info-row"},Vn={class:"badge bg-info"},zn={key:0,class:"source-preview mt-3"},Jn={class:"preview-header"},Kn={class:"preview-stats"},Gn={class:"source-code"},Yn={key:0,class:"tool-section"},Qn={key:0},Zn={key:1,class:"text-danger"},Xn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>{var $;return(($=t.toolCall.input)==null?void 0:$.notebook_path)||"Unknown"}),i=c(()=>{var $;return($=t.toolCall.input)==null?void 0:$.cell_id}),o=c(()=>{var $;return(($=t.toolCall.input)==null?void 0:$.cell_type)||"code"}),a=c(()=>{var $;return(($=t.toolCall.input)==null?void 0:$.edit_mode)||"replace"}),f=c(()=>{var $;return(($=t.toolCall.input)==null?void 0:$.new_source)||""}),g=c(()=>f.value.split(`
`).length),n=c(()=>o.value==="code"?"bg-primary":"bg-secondary"),v=c(()=>{var $;return(($=t.toolCall.result)==null?void 0:$.success)===!1?"tool-result-error":"tool-result-success"}),h=c(()=>{var d;if((d=t.toolCall.result)!=null&&d.message)return t.toolCall.result.message;const $=a.value;return $==="insert"?"Cell inserted successfully":$==="delete"?"Cell deleted successfully":"Cell updated successfully"});return($,d)=>(l(),r("div",An,[e("div",qn,[e("div",Rn,[d[0]||(d[0]=e("span",{class:"notebook-icon"},"ðŸ““",-1)),d[1]||(d[1]=e("strong",null,"Notebook:",-1)),e("code",Un,y(u.value),1)]),e("div",Fn,[e("div",Hn,[d[2]||(d[2]=e("strong",null,"Cell ID:",-1)),e("code",null,y(i.value||"N/A"),1)]),e("div",Wn,[d[3]||(d[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:H(["badge",n.value])},y(o.value),3)]),a.value?(l(),r("div",Bn,[d[4]||(d[4]=e("strong",null,"Edit Mode:",-1)),e("span",Vn,y(a.value),1)])):L("",!0)]),f.value?(l(),r("div",zn,[e("div",Jn,[d[5]||(d[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",Kn,y(g.value)+" lines",1)]),e("pre",Gn,[e("code",null,y(f.value),1)])])):L("",!0)]),s.toolCall.result?(l(),r("div",Yn,[d[8]||(d[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:H(["tool-result",v.value])},[s.toolCall.result.success!==!1?(l(),r("div",Qn,[d[6]||(d[6]=e("i",{class:"bi bi-check-circle"},null,-1)),F(" "+y(h.value),1)])):(l(),r("div",Zn,[d[7]||(d[7]=e("i",{class:"bi bi-x-circle"},null,-1)),F(" "+y(s.toolCall.result.error||"Operation failed"),1)]))],2)])):L("",!0)]))}},el=U(Xn,[["__scopeId","data-v-3261abc1"]]),tl={class:"shell-tool-handler"},sl={class:"tool-section mb-3"},ol={class:"shell-info"},nl={class:"shell-icon"},ll={key:0,class:"shell-id"},al={key:0,class:"filter-info mt-2"},rl={class:"filter-pattern"},il={key:0,class:"tool-section"},ul={class:"result-header mb-2"},dl={key:0,class:"shell-output"},cl={key:0},ml={key:1,class:"text-danger"},pl={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>t.toolCall.name==="BashOutput"?"ðŸ“¤":t.toolCall.name==="KillShell"?"ðŸ›‘":"ðŸš"),i=c(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),o=c(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),a=c(()=>{var d,_;return((d=t.toolCall.input)==null?void 0:d.bash_id)||((_=t.toolCall.input)==null?void 0:_.shell_id)}),f=c(()=>{var d;return(d=t.toolCall.input)==null?void 0:d.filter}),g=c(()=>{var d,_;return t.toolCall.name==="BashOutput"?((d=t.toolCall.result)==null?void 0:d.output)||((_=t.toolCall.result)==null?void 0:_.stdout):null}),n=c(()=>{var d;return(d=t.toolCall.result)==null?void 0:d.status}),v=c(()=>{const d=n.value;return d==="running"?"bg-success":d==="completed"?"bg-secondary":d==="killed"||d==="terminated"?"bg-danger":"bg-info"}),h=c(()=>{var d;return((d=t.toolCall.result)==null?void 0:d.success)===!1?"tool-result-error":"tool-result-success"}),$=c(()=>{var d;return(d=t.toolCall.result)!=null&&d.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed"});return(d,_)=>(l(),r("div",tl,[e("div",sl,[e("div",ol,[e("span",nl,y(u.value),1),e("strong",null,y(i.value)+":",1),a.value?(l(),r("code",ll,"Shell "+y(a.value),1)):L("",!0)]),s.toolCall.name==="BashOutput"&&f.value?(l(),r("div",al,[_[0]||(_[0]=e("strong",null,"Filter:",-1)),e("code",rl,y(f.value),1)])):L("",!0)]),s.toolCall.result?(l(),r("div",il,[e("div",ul,[e("strong",null,y(o.value)+":",1),n.value?(l(),r("span",{key:0,class:H(["badge",v.value])},y(n.value),3)):L("",!0)]),g.value?(l(),r("div",dl,[e("pre",null,[e("code",null,y(g.value),1)])])):(l(),r("div",{key:1,class:H(["tool-result",h.value])},[s.toolCall.result.success!==!1?(l(),r("div",cl,[_[1]||(_[1]=e("i",{class:"bi bi-check-circle"},null,-1)),F(" "+y($.value),1)])):(l(),r("div",ml,[_[2]||(_[2]=e("i",{class:"bi bi-x-circle"},null,-1)),F(" "+y(s.toolCall.result.error||"Operation failed"),1)]))],2))])):L("",!0)]))}},He=U(pl,[["__scopeId","data-v-fc9da4c0"]]),vl={class:"command-tool-handler"},fl={class:"tool-section mb-3"},gl={class:"command-info"},_l={class:"command-icon"},bl={class:"command-code"},hl={key:0,class:"prompt-info mt-2"},yl={class:"prompt-content"},$l={key:0,class:"tool-section"},wl={key:0},Sl={key:1,class:"text-danger"},kl={__name:"CommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>t.toolCall.name==="SlashCommand"?"/":t.toolCall.name==="Skill"?"âš¡":"ðŸ”§"),i=c(()=>t.toolCall.name==="SlashCommand"?"Slash Command":t.toolCall.name==="Skill"?"Skill":"Command"),o=c(()=>{var n;return((n=t.toolCall.input)==null?void 0:n.command)||"Unknown"}),a=c(()=>{var n,v;return((n=t.toolCall.result)==null?void 0:n.prompt)||((v=t.toolCall.result)==null?void 0:v.description)}),f=c(()=>{var n;return((n=t.toolCall.result)==null?void 0:n.success)===!1?"tool-result-error":"tool-result-success"}),g=c(()=>{var n;return(n=t.toolCall.result)!=null&&n.message?t.toolCall.result.message:t.toolCall.name==="SlashCommand"?"Slash command executed successfully":t.toolCall.name==="Skill"?"Skill executed successfully":"Command completed"});return(n,v)=>(l(),r("div",vl,[e("div",fl,[e("div",gl,[e("span",_l,y(u.value),1),e("strong",null,y(i.value)+":",1),e("code",bl,y(o.value),1)]),a.value?(l(),r("div",hl,[v[0]||(v[0]=e("div",{class:"prompt-header"},[e("strong",null,"Expanded Prompt:")],-1)),e("div",yl,y(a.value),1)])):L("",!0)]),s.toolCall.result?(l(),r("div",$l,[v[3]||(v[3]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:H(["tool-result",f.value])},[s.toolCall.result.success!==!1?(l(),r("div",wl,[v[1]||(v[1]=e("i",{class:"bi bi-check-circle"},null,-1)),F(" "+y(g.value),1)])):(l(),r("div",Sl,[v[2]||(v[2]=e("i",{class:"bi bi-x-circle"},null,-1)),F(" "+y(s.toolCall.result.error||"Command execution failed"),1)]))],2)])):L("",!0)]))}},We=U(kl,[["__scopeId","data-v-57a8f93b"]]),Cl={class:"exit-plan-mode-tool-handler"},xl={class:"tool-section mb-3"},jl={key:0,class:"plan-content mt-2"},Ml={class:"plan-text"},Tl={key:0,class:"tool-section"},El={key:0},Pl={key:1,class:"text-danger"},Il={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>{var o;return(o=t.toolCall.input)==null?void 0:o.plan}),i=c(()=>{var o;return((o=t.toolCall.result)==null?void 0:o.success)===!1?"tool-result-error":"tool-result-success"});return(o,a)=>(l(),r("div",Cl,[e("div",xl,[a[1]||(a[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"ðŸ“‹"),e("strong",null,"Exiting Plan Mode")],-1)),u.value?(l(),r("div",jl,[a[0]||(a[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",Ml,y(u.value),1)])):L("",!0)]),s.toolCall.result?(l(),r("div",Tl,[a[4]||(a[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:H(["tool-result",i.value])},[s.toolCall.result.success!==!1?(l(),r("div",El,[...a[2]||(a[2]=[e("i",{class:"bi bi-check-circle"},null,-1),F(" Permission mode reverted to default ",-1)])])):(l(),r("div",Pl,[a[3]||(a[3]=e("i",{class:"bi bi-x-circle"},null,-1)),F(" "+y(s.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):L("",!0)]))}},Ll=U(Il,[["__scopeId","data-v-f1d32203"]]),Dl={class:"d-flex align-items-center gap-2 flex-grow-1"},Ol={class:"tool-status-icon"},Nl={class:"tool-name"},Al={class:"text-muted small"},ql={class:"d-flex align-items-center gap-2"},Rl={class:"text-muted"},Ul={key:0,class:"card-body"},Fl={key:0,class:"alert alert-warning mb-3"},Hl={class:"d-flex align-items-center"},Wl={class:"mb-0 small"},Bl={key:1,class:"permission-prompt mt-3"},Vl={class:"alert alert-warning mb-3"},zl={class:"mb-0"},Jl={class:"tool-name"},Kl={key:0,class:"suggestions-section mb-3"},Gl={class:"alert alert-info mb-0"},Yl={class:"suggestion-details p-2 bg-white rounded"},Ql={class:"permission-buttons d-flex gap-2 mb-3"},Zl=["disabled"],Xl=["disabled"],ea=["disabled"],ta={class:"guidance-section mt-3"},sa=["disabled"],oa=["disabled"],na={key:2,class:"mt-3"},la={class:"alert alert-warning mb-0"},aa={class:"d-flex align-items-center"},ra={class:"mb-0 small"},ia={key:3,class:"tool-section mt-3"},ua={class:"alert alert-danger mb-0"},da={key:0},ca={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,u=ce(),i=V(),o=me(),a=I(!1),f=I(null),g=I(""),n=c(()=>u.isToolUseOrphaned(i.currentSessionId,t.toolCall.id)),v=c(()=>u.getOrphanedInfo(i.currentSessionId,t.toolCall.id)),h={Read:vs,Write:Ps,Bash:Bs,TodoWrite:ro,Edit:Eo,Grep:Ue,Glob:Ue,WebFetch:Fe,WebSearch:Fe,Task:Nn,NotebookEdit:el,BashOutput:He,KillShell:He,SlashCommand:We,Skill:We,ExitPlanMode:Ll},$=c(()=>{const S=t.toolCall.name;return h[S]?h[S]:Zt}),d=c(()=>{const S=[];switch(t.toolCall.status){case"pending":S.push("border-secondary");break;case"permission_required":S.push("border-warning");break;case"executing":S.push("border-primary");break;case"completed":m.value||t.toolCall.permissionDecision==="deny"?S.push("border-danger"):S.push("border-success");break;case"error":S.push("border-danger");break}return S.join(" ")}),_=c(()=>{switch(t.toolCall.status){case"pending":return"ðŸ”„";case"permission_required":return"â“";case"executing":return"âš¡";case"completed":return t.toolCall.permissionDecision==="deny"?"âŒ":m.value?"ðŸ’¥":"âœ…";case"error":return"ðŸ’¥";default:return"ðŸ”§"}}),E=c(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Executing...";case"completed":return t.toolCall.permissionDecision==="deny"?"Denied":m.value?"Error":"Completed";case"error":return"Error";default:return"Unknown"}}),T=c(()=>he(t.toolCall.timestamp)),m=c(()=>{var S;return((S=t.toolCall.result)==null?void 0:S.error)||t.toolCall.status==="error"}),p=c(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function C(){const S=i.currentSessionId;S&&u.toggleToolExpansion(S,t.toolCall.id)}function b(S){return S.type==="setMode"?`Set permission mode to "${S.mode}"`:S.type==="allow"?`Allow tool: ${S.tool}`:JSON.stringify(S)}async function x(S,M,q=null){if(!a.value){a.value=!0,S==="allow"?f.value=M?"approve-apply":"approve":q?f.value="deny-guidance":f.value="deny";try{const A=i.currentSessionId;if(A){const k=M&&t.toolCall.suggestions?t.toolCall.suggestions:[];u.handlePermissionResponse(A,{request_id:t.toolCall.permissionRequestId,decision:S,reasoning:S==="allow"?"User allowed permission":"User denied permission",applied_updates:k})}await o.sendPermissionResponse(t.toolCall.permissionRequestId,S,M,q)}catch(A){console.error("Failed to send permission response:",A)}finally{a.value=!1,f.value=null}}}return(S,M)=>{var q,A,k;return l(),r("div",{class:H(["tool-call-card card mb-3",d.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:C},[e("div",Dl,[e("span",Ol,y(_.value),1),e("strong",Nl,y(s.toolCall.name),1),e("span",Al,y(E.value),1)]),e("div",ql,[e("small",Rl,y(T.value),1),e("i",{class:H(["bi",s.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),s.toolCall.isExpanded?(l(),r("div",Ul,[n.value?(l(),r("div",Fl,[e("div",Hl,[M[6]||(M[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[M[5]||(M[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",Wl,y(((q=v.value)==null?void 0:q.message)||"Session was terminated"),1)])])])):L("",!0),(l(),ae(Ve($.value),{toolCall:s.toolCall},null,8,["toolCall"])),s.toolCall.status==="permission_required"&&!n.value?(l(),r("div",Bl,[e("div",Vl,[M[9]||(M[9]=e("p",{class:"mb-2"},[e("strong",null,"ðŸ” Permission Required")],-1)),e("p",zl,[M[7]||(M[7]=F("Claude wants to use the ",-1)),e("code",Jl,y(s.toolCall.name),1),M[8]||(M[8]=F(" tool.",-1))])]),p.value?(l(),r("div",Kl,[e("div",Gl,[M[10]||(M[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),F(" Suggested Permission Update ")],-1)),M[11]||(M[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",Yl,[(l(!0),r(G,null,Y(s.toolCall.suggestions,(w,P)=>(l(),r("div",{key:P,class:"suggestion-item"},[e("code",null,y(b(w)),1)]))),128))]),M[12]||(M[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):L("",!0),e("div",Ql,[p.value?(l(),r("button",{key:0,class:"btn btn-success",onClick:M[0]||(M[0]=w=>x("allow",!0)),disabled:a.value},[M[13]||(M[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),F(" "+y(a.value&&f.value==="approve-apply"?"â³ Submitting...":"âœ… Approve & Apply"),1)],8,Zl)):L("",!0),e("button",{class:H(["btn",p.value?"btn-outline-success":"btn-success"]),onClick:M[1]||(M[1]=w=>x("allow",!1)),disabled:a.value},[M[14]||(M[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),F(" "+y(a.value&&f.value==="approve"?"â³ Submitting...":p.value?"âœ… Approve Only":"âœ… Approve"),1)],10,Xl),e("button",{class:"btn btn-danger",onClick:M[2]||(M[2]=w=>x("deny",!1)),disabled:a.value},[M[15]||(M[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),F(" "+y(a.value&&f.value==="deny"?"â³ Submitting...":"âŒ Deny"),1)],8,ea)]),e("div",ta,[M[17]||(M[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),F(" Provide Guidance (Optional) ")],-1)),M[18]||(M[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),K(e("textarea",{"onUpdate:modelValue":M[3]||(M[3]=w=>g.value=w),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:a.value},null,8,sa),[[X,g.value]]),g.value.trim()?(l(),r("button",{key:0,class:"btn btn-warning btn-sm",onClick:M[4]||(M[4]=w=>x("deny",!1,g.value)),disabled:a.value},[M[16]||(M[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),F(" "+y(a.value&&f.value==="deny-guidance"?"â³ Submitting...":"ðŸ’¡ Provide Guidance & Continue"),1)],8,oa)):L("",!0)])])):L("",!0),s.toolCall.status==="permission_required"&&n.value?(l(),r("div",na,[e("div",la,[e("div",aa,[M[20]||(M[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[M[19]||(M[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",ra,y(((A=v.value)==null?void 0:A.message)||"Session was terminated before permission could be granted"),1)])])])])):L("",!0),s.toolCall.permissionDecision==="deny"?(l(),r("div",ia,[e("div",ua,[M[21]||(M[21]=e("i",{class:"bi bi-x-circle"},null,-1)),M[22]||(M[22]=F(" Permission denied ",-1)),(k=s.toolCall.result)!=null&&k.message?(l(),r("span",da," - "+y(s.toolCall.result.message),1)):L("",!0)])])):L("",!0)])):L("",!0)],2)}}},ma=U(ca,[["__scopeId","data-v-194786d1"]]),pa={class:"card assistant-message bg-white border-start border-success border-3"},va={class:"card-body"},fa={class:"d-flex justify-content-between align-items-center mb-2"},ga={class:"d-flex align-items-center gap-2"},_a={key:0,class:"text-muted"},ba={class:"text-muted"},ha={key:0,class:"thinking-block mb-3"},ya=["innerHTML"],$a={key:2,class:"tool-calls mt-3"},wa={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,u=ce(),i=V();ge.setOptions({breaks:!0,gfm:!0});const o=c(()=>he(t.message.timestamp)),a=c(()=>{var _;return((_=t.message.metadata)==null?void 0:_.model)||null}),f=c(()=>{const _=t.message.content||"";return _.trim().length>0&&_!=="Assistant response"}),g=c(()=>{const _=t.message.content||"",E=ge.parse(_);return Ce.sanitize(E)}),n=c(()=>{var _,E;return((_=t.message.metadata)==null?void 0:_.has_thinking)&&((E=t.message.metadata)==null?void 0:E.thinking_content)}),v=c(()=>{var _;return((_=t.message.metadata)==null?void 0:_.thinking_content)||""}),h=c(()=>{var _,E,T;return((_=t.message.metadata)==null?void 0:_.has_tool_uses)&&((T=(E=t.message.metadata)==null?void 0:E.tool_uses)==null?void 0:T.length)>0}),$=c(()=>{var _;return((_=t.message.metadata)==null?void 0:_.tool_uses)||[]}),d=c(()=>{const _=i.currentSessionId;if(!_)return[];const E=u.toolCallsBySession.get(_)||[];return $.value.map(T=>{const m=E.find(p=>p.id===T.id);return m||{id:T.id,name:T.name,input:T.input,status:"pending",result:null,timestamp:T.timestamp||t.message.timestamp,isExpanded:!0}})});return(_,E)=>(l(),r("div",pa,[e("div",va,[e("div",fa,[e("div",ga,[E[0]||(E[0]=e("span",{class:"message-icon"},"ðŸ¤–",-1)),E[1]||(E[1]=e("strong",{class:"message-role"},"Assistant",-1)),a.value?(l(),r("small",_a,y(a.value),1)):L("",!0)]),e("small",ba,y(o.value),1)]),n.value?(l(),r("div",ha,[J(Ht,{thinking:v.value},null,8,["thinking"])])):L("",!0),f.value?(l(),r("div",{key:1,class:"message-content",innerHTML:g.value},null,8,ya)):L("",!0),h.value?(l(),r("div",$a,[(l(!0),r(G,null,Y(d.value,T=>(l(),ae(ma,{key:T.id,toolCall:T},null,8,["toolCall"]))),128))])):L("",!0)])]))}},Sa=U(wa,[["__scopeId","data-v-25a87a40"]]),ka={class:"card system-message bg-info bg-opacity-10 border-info"},Ca={class:"card-body py-2 px-3"},xa={class:"d-flex align-items-center gap-2"},ja={class:"text-muted flex-grow-1"},Ma={class:"text-muted"},Ta={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>he(t.message.timestamp));return(i,o)=>(l(),r("div",ka,[e("div",Ca,[e("div",xa,[o[0]||(o[0]=e("i",{class:"bi bi-info-circle text-info"},null,-1)),e("small",ja,y(s.message.content),1),e("small",Ma,y(u.value),1)])])]))}},Be=U(Ta,[["__scopeId","data-v-bba7a395"]]),Ea={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(s){const t=s,u=c(()=>{switch(t.message.type){case"user":return Nt;case"assistant":return Sa;case"system":return Be;default:return Be}});return(i,o)=>(l(),r("div",{class:H(["message-item mb-3",`message-${s.message.type}`])},[(l(),ae(Ve(u.value),{message:s.message},null,8,["message"]))],2))}},Pa=U(Ea,[["__scopeId","data-v-fbd275ac"]]),Ia={key:0,class:"text-muted text-center py-5"},La={__name:"MessageList",setup(s){const t=ce(),u=Z(),i=I(null),o=c(()=>t.currentMessages.filter(n=>f(n)));c(()=>t.currentToolCalls);async function a(){u.autoScrollEnabled&&(await Se(),i.value&&(i.value.scrollTop=i.value.scrollHeight))}Q(()=>t.currentMessages.length,a),Q(()=>t.currentToolCalls.length,a),Q(()=>t.currentToolCalls.map(n=>`${n.id}-${n.status}`).join(","),a),oe(()=>{setTimeout(()=>{a()},100)});function f(n){var h,$;const v=n.subtype||((h=n.metadata)==null?void 0:h.subtype);if(n.type==="system"&&v==="init"||n.type==="result"||n.type==="permission_request"||n.type==="permission_response")return!1;if(n.type==="user"&&(($=n.metadata)!=null&&$.has_tool_results)){const d=n.content||"";if(d.match(/^Tool results?: \d+ results?$/i)||d.trim()==="")return!1}return!0}function g(n){return{type:n.type||"unknown",content:n.content||"",timestamp:n.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...n.metadata}}}return(n,v)=>(l(),r("div",{class:"messages-area flex-grow-1 overflow-auto p-3",ref_key:"messagesArea",ref:i},[o.value.length===0?(l(),r("div",Ia," No messages yet. Start a conversation! ")):L("",!0),(l(!0),r(G,null,Y(o.value,(h,$)=>(l(),ae(Pa,{key:`msg-${h.timestamp}-${$}`,message:g(h)},null,8,["message"]))),128))],512))}},Da=U(La,[["__scopeId","data-v-1884c681"]]),Oa={class:"border-top bg-light"},Na={class:"d-flex gap-2 align-items-end px-2 py-1"},Aa=["placeholder","disabled","onKeydown"],qa=["disabled"],Ra={__name:"InputArea",setup(s){const t=V(),u=me(),i=c({get:()=>t.currentInput,set:h=>{t.currentInput=h}}),o=c(()=>{var h;return((h=t.currentSession)==null?void 0:h.is_processing)||!1}),a=c(()=>u.sessionConnected),f=c(()=>{var h;return((h=t.currentSession)==null?void 0:h.state)==="starting"}),g=c(()=>f.value?"Session is starting...":a.value?"Type your message to Claude Code...":"Waiting for connection...");function n(){i.value.trim()&&(u.sendMessage(i.value),i.value="")}function v(){u.interruptSession()}return(h,$)=>(l(),r("div",Oa,[e("div",Na,[K(e("textarea",{id:"message-input","onUpdate:modelValue":$[0]||($[0]=d=>i.value=d),class:"form-control",placeholder:g.value,disabled:f.value,rows:"1",onKeydown:ze(le(n,["exact","prevent"]),["enter"])},null,40,Aa),[[X,i.value]]),o.value?(l(),r("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:v}," Stop ")):(l(),r("button",{key:1,class:"btn btn-primary",disabled:!i.value.trim()||!a.value||f.value,onClick:n}," Send ",8,qa))])]))}},Ua=U(Ra,[["__scopeId","data-v-2e976a07"]]),Fa={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},Ha={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},Wa={class:"text-secondary"},Ba={class:"d-flex flex-column flex-grow-1 overflow-hidden"},Ke={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,u=V(),i=Z(),o=c(()=>u.currentSession),a=c(()=>i.isLoading),f=c(()=>i.loadingMessage);return oe(async()=>{if(t.sessionId!==u.currentSessionId){i.showLoading("Loading session...");try{await u.selectSession(t.sessionId)}finally{i.hideLoading()}}}),Q(()=>t.sessionId,async(g,n)=>{if(g!==n&&g!==u.currentSessionId){i.showLoading("Loading session...");try{await u.selectSession(g)}finally{i.hideLoading()}}}),ne(()=>{}),(g,n)=>(l(),r("div",Fa,[a.value?(l(),r("div",Ha,[n[0]||(n[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Wa,y(f.value),1)])):L("",!0),o.value?(l(),ae(mt,{key:1,"session-id":t.sessionId},null,8,["session-id"])):L("",!0),e("div",Ba,[J(Da)]),J(Ua),o.value?(l(),ae($t,{key:2,"session-id":t.sessionId},null,8,["session-id"])):L("",!0)]))}},xe=fe("legion",()=>{const s=I(new Map),t=I(new Map),u=I(new Map),i=I(new Map),o=I(null),a=c(()=>s.value.get(o.value)||[]),f=c(()=>t.value.get(o.value)||[]),g=c(()=>u.value.get(o.value)||[]),n=c(()=>i.value.get(o.value)||[]);function v(C){o.value=C}async function h(C,b=100,x=0){try{const S=await z.get(`/api/legions/${C}/timeline?limit=${b}&offset=${x}`),M=S.comms||[],q=S.total_count||M.length,A=S.has_more||!1;return M.sort((k,w)=>new Date(k.timestamp)-new Date(w.timestamp)),console.log(`Loaded ${M.length} of ${q} comms for legion ${C}`),s.value.set(C,M),s.value=new Map(s.value),{comms:M,totalCount:q,hasMore:A}}catch(S){throw console.error("Failed to load timeline:",S),S}}function $(C,b){s.value.has(C)||s.value.set(C,[]),s.value.get(C).push(b),s.value=new Map(s.value)}async function d(C,b){try{const S=(await z.post(`/api/legions/${C}/comms`,b)).comm;return console.log(`Sent comm ${S.comm_id} to legion ${C}`),S}catch(x){throw console.error("Failed to send comm:",x),x}}async function _(C){return console.log(`Minions for legion ${C} are already available in session store`),[]}async function E(C,b){try{const S=(await z.post(`/api/legions/${C}/minions`,b)).minion;return await _(C),console.log(`Created minion ${S.minion_id} in legion ${C}`),S}catch(x){throw console.error("Failed to create minion:",x),x}}async function T(C){try{const x=(await z.get(`/api/legions/${C}/hordes`)).hordes||[];return console.log(`Loaded ${x.length} hordes for legion ${C}`),u.value.set(C,x),u.value=new Map(u.value),x}catch(b){throw console.error("Failed to load hordes:",b),b}}async function m(C){try{const x=(await z.get(`/api/legions/${C}/channels`)).channels||[];return console.log(`Loaded ${x.length} channels for legion ${C}`),i.value.set(C,x),i.value=new Map(i.value),x}catch(b){throw console.error("Failed to load channels:",b),b}}function p(C){s.value.delete(C),t.value.delete(C),u.value.delete(C),i.value.delete(C),s.value=new Map(s.value),t.value=new Map(t.value),u.value=new Map(u.value),i.value=new Map(i.value)}return{commsByLegion:s,minionsByLegion:t,hordesByLegion:u,channelsByLegion:i,currentLegionId:o,currentComms:a,currentMinions:f,currentHordes:g,currentChannels:n,setCurrentLegion:v,loadTimeline:h,addComm:$,sendComm:d,loadMinions:_,createMinion:E,loadHordes:T,loadChannels:m,clearLegionData:p}}),Va=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:xe},Symbol.toStringTag,{value:"Module"})),za={class:"timeline-header border-bottom p-3"},Ja={class:"project-name"},Ka=["title"],Ga={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(s){const t=s,u=ee(),i=c(()=>u.projects.get(t.legionId)),o=c(()=>{var a;return((a=i.value)==null?void 0:a.name)||"Legion"});return(a,f)=>(l(),r("div",za,[e("div",null,[e("div",Ja,y(o.value),1),e("div",{class:"view-name",title:s.legionId},"Timeline",8,Ka)])]))}},Ya=U(Ga,[["__scopeId","data-v-44f386f5"]]),Qa={class:"timeline-status-bar border-top p-2 bg-light"},Za={class:"d-flex justify-content-end"},Xa={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(s){const t=Z();function u(){t.setAutoScroll(!t.autoScrollEnabled)}return(i,o)=>(l(),r("div",Qa,[e("div",Za,[e("button",{class:H(["btn btn-sm",be(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:u}," â¬‡ï¸ "+y(be(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},er=U(Xa,[["__scopeId","data-v-891c73db"]]),tr={class:"comm-composer border-top p-3"},sr={class:"d-flex gap-2 mb-2"},or={class:"flex-grow-1"},nr=["disabled"],lr={label:"Minions"},ar=["value"],rr={key:0,label:"Channels"},ir=["value"],ur={style:{"min-width":"150px"}},dr=["disabled"],cr={class:"d-flex gap-2 align-items-end position-relative"},mr={class:"flex-grow-1 position-relative"},pr=["disabled"],vr=["onClick","onMouseenter"],fr=["disabled"],gr={key:0},_r={key:1},br={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(s){const t=s,u=xe(),i=V(),o=ee(),a=I(""),f=I("task"),g=I(""),n=I(!1),v=I(!1),h=I([]),$=I(0),d=I(-1),_=I(null),E=I(null),T=c(()=>{const w=o.projects.get(t.legionId);return!w||!w.session_ids?[]:w.session_ids.map(P=>i.sessions.get(P)).filter(P=>P&&P.is_minion)}),m=c(()=>u.currentChannels||[]),p=c(()=>a.value&&g.value.trim().length>0);function C(w){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[w.state]||"â—‹"}function b(w){return w.is_minion&&w.role?`${w.name} (${w.role})`:w.name}function x(){const w=_.value;if(!w)return;w.style.height="auto";const P=Math.min(w.scrollHeight,parseInt(getComputedStyle(w).maxHeight));w.style.height=P+"px"}function S(){const w=_.value;if(!w)return;x();const P=g.value,j=w.selectionStart,D=P.substring(0,j),O=D.lastIndexOf("#");if(O===-1){v.value=!1;return}const N=D.substring(O+1).toLowerCase();if(N.includes(" ")){v.value=!1;return}const W=T.value.filter(B=>B.name.toLowerCase().includes(N)).map(B=>({type:"minion",name:B.name,role:B.role,id:B.session_id,state:B.state}));if(W.length===0){v.value=!1;return}h.value=W,$.value=0,d.value=O,v.value=!0}function M(){if(!E.value)return;const w=E.value,P=w.children[$.value];if(!P)return;const j=P.offsetTop,D=P.offsetHeight,O=w.scrollTop,N=w.clientHeight;j<O?w.scrollTop=j:j+D>O+N&&(w.scrollTop=j+D-N)}function q(w){if(!v.value){w.key==="Enter"&&!w.shiftKey&&p.value&&(w.preventDefault(),k());return}if(w.key==="ArrowDown")w.preventDefault(),$.value=($.value+1)%h.value.length,M();else if(w.key==="ArrowUp")w.preventDefault(),$.value=$.value===0?h.value.length-1:$.value-1,M();else if(w.key==="Enter"){w.preventDefault();const P=h.value[$.value];P&&A(P)}else w.key==="Escape"&&(v.value=!1)}function A(w){const P=_.value;if(!P)return;const j=g.value,D=P.selectionStart,O=j.substring(0,d.value)+"#"+w.name+" "+j.substring(D);g.value=O;const N=d.value+w.name.length+2;setTimeout(()=>{P.setSelectionRange(N,N),P.focus()},0),v.value=!1}async function k(){if(!(!p.value||n.value)){n.value=!0;try{const[w,P]=a.value.split(":"),j={comm_type:f.value,content:g.value.trim()};w==="minion"?j.to_minion_id=P:w==="channel"&&(j.to_channel_id=P),await u.sendComm(t.legionId,j),g.value="",x()}catch(w){console.error("Failed to send comm:",w),alert(`Failed to send comm: ${w.message}`)}finally{n.value=!1}}}return Q(v,w=>{if(w){const P=j=>{j.target.closest(".comm-composer")||(v.value=!1,document.removeEventListener("click",P))};setTimeout(()=>document.addEventListener("click",P),0)}}),(w,P)=>(l(),r("div",tr,[e("div",sr,[e("div",or,[K(e("select",{"onUpdate:modelValue":P[0]||(P[0]=j=>a.value=j),class:"form-select form-select-sm",disabled:n.value},[P[3]||(P[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",lr,[(l(!0),r(G,null,Y(T.value,j=>(l(),r("option",{key:j.session_id,value:`minion:${j.session_id}`},y(C(j))+" "+y(b(j)),9,ar))),128))]),m.value.length>0?(l(),r("optgroup",rr,[(l(!0),r(G,null,Y(m.value,j=>(l(),r("option",{key:j.channel_id,value:`channel:${j.channel_id}`}," #ï¸âƒ£ "+y(j.name),9,ir))),128))])):L("",!0)],8,nr),[[ue,a.value]])]),e("div",ur,[K(e("select",{"onUpdate:modelValue":P[1]||(P[1]=j=>f.value=j),class:"form-select form-select-sm",disabled:n.value},[...P[4]||(P[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,dr),[[ue,f.value]])])]),e("div",cr,[e("div",mr,[K(e("textarea",{ref_key:"contentTextarea",ref:_,"onUpdate:modelValue":P[2]||(P[2]=j=>g.value=j),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:n.value,onInput:S,onKeydown:q},null,40,pr),[[X,g.value]]),v.value?(l(),r("div",{key:0,ref_key:"autocompleteDropdown",ref:E,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(l(!0),r(G,null,Y(h.value,(j,D)=>(l(),r("div",{key:j.id,class:H(["autocomplete-item px-2 py-1",{"bg-light":D===$.value}]),onClick:O=>A(j),onMouseenter:O=>$.value=D},y(j.type==="minion"?C(j):"#ï¸âƒ£")+" "+y(j.name)+y(j.role?` (${j.role})`:""),43,vr))),128))],512)):L("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!p.value||n.value,onClick:k},[n.value?(l(),r("span",gr,[...P[5]||(P[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),F(" Sending... ",-1)])])):(l(),r("span",_r,"Send"))],8,fr)])])]))}},hr=U(br,[["__scopeId","data-v-ffa54193"]]),yr={class:"timeline-view d-flex flex-column h-100"},$r={key:0,class:"text-center text-muted"},wr={key:1,class:"text-center text-danger"},Sr={key:2,class:"text-center text-muted"},kr={key:3,class:"comm-list"},Cr={class:"col-auto message-speaker text-end pe-3"},xr={class:"text-muted"},jr={class:"col message-content-column"},Mr={class:"comm-card card"},Tr={class:"card-body p-2"},Er={class:"d-flex justify-content-between align-items-start mb-1"},Pr={class:"ms-2"},Ir={class:"comm-content"},Lr={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(s){const t=s,u=xe(),i=ee(),o=V(),a=me(),f=Z(),g=I(!0),n=I(null),v=I(null),h=c(()=>i.projects.get(t.legionId));c(()=>{var x;return((x=h.value)==null?void 0:x.name)||"Legion"});const $=c(()=>u.currentComms);c(()=>u.currentMinions);function d(x){if(x.from_user)return"You";if(x.from_minion_id){const S=o.sessions.get(x.from_minion_id);return(S==null?void 0:S.name)||"Unknown"}return"Unknown"}function _(x){if(x.to_user)return"You";if(x.to_minion_id){const S=o.sessions.get(x.to_minion_id);return(S==null?void 0:S.name)||"Unknown"}return x.to_channel_id?`#${x.to_channel_id}`:"All"}function E(x){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[x]||"bg-secondary"}function T(x){return new Date(x).toLocaleTimeString()}async function m(){f.autoScrollEnabled&&(await Se(),v.value&&(v.value.scrollTop=v.value.scrollHeight))}async function p(){g.value=!0,n.value=null;try{u.setCurrentLegion(t.legionId),await Promise.all([u.loadTimeline(t.legionId),u.loadMinions(t.legionId)]),await Se(),await m(),setTimeout(()=>{m()},100)}catch(x){console.error("Failed to load timeline:",x),x.response?n.value=`${x.message} (${x.response.status})`:n.value=x.message||"Unknown error"}finally{g.value=!1}}function C(){a.connectLegion(t.legionId)}function b(){a.disconnectLegion()}return Q(()=>$.value.length,()=>{m()}),oe(()=>{p(),C(),setTimeout(()=>{m()},100)}),ne(()=>{b()}),(x,S)=>(l(),r("div",yr,[J(Ya,{"legion-id":s.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:v,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[g.value?(l(),r("div",$r,[...S[0]||(S[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),F(" Loading timeline... ",-1)])])):n.value?(l(),r("div",wr," Failed to load timeline: "+y(n.value),1)):$.value.length===0?(l(),r("div",Sr," No messages yet. Minions will appear here once they start communicating. ")):(l(),r("div",kr,[(l(!0),r(G,null,Y($.value,M=>(l(),r("div",{key:M.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",Cr,[e("small",xr,y(T(M.timestamp)),1)]),e("div",jr,[e("div",Mr,[e("div",Tr,[e("div",Er,[e("div",null,[e("span",{class:H(["badge",E(M.comm_type)])},y(M.comm_type),3),e("strong",Pr,y(d(M)),1),S[1]||(S[1]=e("span",{class:"text-muted mx-1"},"â†’",-1)),e("strong",null,y(_(M)),1)])]),e("div",Ir,y(M.content),1)])])])]))),128))]))],512),J(hr,{"legion-id":s.legionId},null,8,["legion-id"]),J(er,{"legion-id":s.legionId},null,8,["legion-id"])]))}},Dr=U(Lr,[["__scopeId","data-v-d4c7422e"]]),Or={class:"spy-view d-flex flex-column overflow-hidden"},Nr={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(s){return(t,u)=>(l(),r("div",Or,[J(Ke,{"session-id":s.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},Ar=U(Nr,[["__scopeId","data-v-43a24eaf"]]),qr={class:"horde-header border-bottom p-3"},Rr={class:"project-name"},Ur=["title"],Fr={__name:"HordeHeader",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,u=ee(),i=V(),o=c(()=>u.projects.get(t.legionId)),a=c(()=>{var n;return((n=o.value)==null?void 0:n.name)||"Legion"}),f=c(()=>i.sessions.get(t.overseerId)),g=c(()=>{var n;return((n=f.value)==null?void 0:n.name)||"Overseer"});return(n,v)=>(l(),r("div",qr,[e("div",null,[e("div",Rr,y(a.value),1),e("div",{class:"view-name",title:s.overseerId},y(g.value)+"'s Horde",9,Ur)])]))}},Hr=U(Fr,[["__scopeId","data-v-775da47d"]]),Wr={class:"horde-status-bar border-top p-2 bg-light"},Br={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){return(t,u)=>(l(),r("div",Wr,[...u[0]||(u[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},Vr=U(Br,[["__scopeId","data-v-7f3c847f"]]),zr={class:"minion-card p-2 border-start border-2 mb-2"},Jr={class:"d-flex align-items-center"},Kr={class:"me-2"},Gr={key:0,class:"me-2"},Yr={key:1,class:"text-muted ms-2"},Qr={key:2,class:"badge bg-secondary ms-2"},Zr={class:"text-muted small ms-4"},Xr={key:0,class:"minion-children"},ei={key:1,class:"text-danger small ms-4"},ti={__name:"MinionTreeNode",props:{minionId:{type:String,required:!0},level:{type:Number,default:0}},setup(s){const t=s,u=V(),i=c(()=>u.sessions.get(t.minionId)),o=c(()=>t.level*24),a=c(()=>{const v=i.value&&i.value.child_minion_ids&&i.value.child_minion_ids.length>0;return i.value&&i.value.child_minion_ids&&i.value.child_minion_ids.length>0&&console.log(`Minion ${i.value.name} has ${i.value.child_minion_ids.length} children:`,i.value.child_minion_ids),v}),f=c(()=>i.value&&i.value.is_overseer&&a.value),g={created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "},n=c(()=>{var v;return g[(v=i.value)==null?void 0:v.state]||"â—‹"});return(v,h)=>{const $=Je("MinionTreeNode",!0);return i.value?(l(),r("div",{key:0,class:"minion-tree-node",style:de({marginLeft:`${o.value}px`})},[e("div",zr,[e("div",Jr,[e("span",Kr,y(n.value),1),f.value?(l(),r("span",Gr,"ðŸ‘‘")):L("",!0),e("strong",null,y(i.value.name),1),i.value.role?(l(),r("span",Yr,y(i.value.role),1)):L("",!0),f.value?(l(),r("span",Qr,y(i.value.child_minion_ids.length)+" "+y(i.value.child_minion_ids.length===1?"child":"children"),1)):L("",!0)]),e("div",Zr," Level "+y(i.value.overseer_level||0)+" â€¢ "+y(i.value.state),1)]),a.value?(l(),r("div",Xr,[(l(!0),r(G,null,Y(i.value.child_minion_ids,d=>(l(),ae($,{key:d,"minion-id":d,level:s.level+1},null,8,["minion-id","level"]))),128))])):L("",!0)],4)):t.minionId?(l(),r("div",ei," âš  Minion data not found for ID: "+y(t.minionId),1)):L("",!0)}}},si=U(ti,[["__scopeId","data-v-120682eb"]]),oi={class:"horde-view d-flex flex-column h-100"},ni={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},li={key:0,class:"alert alert-danger"},ai={key:1,class:"horde-tree"},ri={__name:"HordeView",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,u=V(),i=ee(),o=c(()=>i.projects.get(t.legionId));c(()=>{var f;return((f=o.value)==null?void 0:f.name)||"Legion"});const a=c(()=>u.sessions.get(t.overseerId));return(f,g)=>(l(),r("div",oi,[J(Hr,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"]),e("div",ni,[a.value?(l(),r("div",ai,[J(si,{"minion-id":s.overseerId,level:0},null,8,["minion-id"])])):(l(),r("div",li," Overseer not found "))]),J(Vr,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"])]))}},ii=U(ri,[["__scopeId","data-v-b928719b"]]),ui=[{path:"/",name:"home",component:tt},{path:"/session/:sessionId",name:"session",component:Ke,props:!0},{path:"/timeline/:legionId",name:"timeline",component:Dr,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:Ar,props:!0},{path:"/horde/:legionId/:overseerId",name:"horde",component:ii,props:!0}],di=Ge({history:Ye(),routes:ui}),ci={__name:"ConnectionIndicator",setup(s){const t=me(),u=c(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),i=c(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(o,a)=>(l(),r("span",{id:"connection-indicator",class:H(["badge",u.value])},y(i.value),3))}},mi={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},pi={class:"d-flex align-items-center gap-2"},vi={__name:"AppHeader",setup(s){const t=Z();function u(){t.toggleSidebar()}return(i,o)=>(l(),r("header",mi,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:u},[...o[0]||(o[0]=[e("span",null,"â˜°",-1)])]),o[1]||(o[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",pi,[J(ci)])]))}},fi={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},gi={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},_i=["title"],bi={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,u=c(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function i(g){return g.state==="paused"&&g.is_processing?"pending-prompt":g.is_processing?"processing":g.state}function o(g){const n=i(g);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[n]||"#d3d3d3"}function a(g){const n=i(g);return n==="starting"||n==="processing"||n==="pending-prompt"}function f(g){const n=i(g),v=n.charAt(0).toUpperCase()+n.slice(1),h=g.name||"Unnamed Session",$=g.is_minion&&g.role?` (${g.role})`:"";return`${h}${$}: ${v}`}return(g,n)=>(l(),r("div",fi,[!s.sessions||s.sessions.length===0?(l(),r("div",gi)):(l(!0),r(G,{key:1},Y(s.sessions,v=>(l(),r("div",{key:v.session_id,class:H(["progress-bar",{"progress-bar-striped progress-bar-animated":a(v)}]),style:de({width:u.value,backgroundColor:o(v),cursor:"help"}),title:f(v)},null,14,_i))),128))]))}},hi=U(bi,[["__scopeId","data-v-a79cfeec"]]),yi={class:"flex-grow-1"},$i={key:0,class:"text-muted small ms-1"},wi={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(s){const t=s,u=ie(),i=V(),o=ee(),a=Z(),f=c(()=>i.currentSessionId===t.session.session_id),g=c(()=>i.deletingSessions.has(t.session.session_id)),n=c(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),v=c(()=>{const p=n.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[p]||"status-dot-grey"}),h=c(()=>{const p=n.value,C={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},b={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:C[p]||"#d3d3d3",borderColor:b[p]||"#6c757d"}});function $(){i.selectSession(t.session.session_id),u.push(`/session/${t.session.session_id}`)}function d(){a.showModal("edit-session",{session:t.session})}function _(p){p.dataTransfer.effectAllowed="move",p.dataTransfer.setData("application/session-id",t.session.session_id),p.dataTransfer.setData("application/project-id",t.projectId),p.dataTransfer.setData("text/plain",t.session.session_id),p.target.classList.add("dragging")}function E(p){p.target.classList.remove("dragging")}function T(p){p.preventDefault(),p.dataTransfer.dropEffect="move";const C=p.currentTarget.getBoundingClientRect(),b=C.top+C.height/2;p.clientY<b?(p.currentTarget.classList.add("drop-above"),p.currentTarget.classList.remove("drop-below")):(p.currentTarget.classList.add("drop-below"),p.currentTarget.classList.remove("drop-above"))}function m(p){p.preventDefault(),p.currentTarget.classList.remove("drop-above","drop-below");const C=p.dataTransfer.getData("application/session-id")||p.dataTransfer.getData("text/plain"),b=p.dataTransfer.getData("application/project-id");if(!C||C===t.session.session_id||b!==t.projectId)return;const x=p.currentTarget.getBoundingClientRect(),S=x.top+x.height/2,M=p.clientY<S,q=o.getProject(t.projectId);if(!q||!q.session_ids)return;const A=[...q.session_ids],k=A.indexOf(t.session.session_id),w=A.indexOf(C);if(k===-1||w===-1)return;const P=[...A],[j]=P.splice(w,1);let D=M?k:k+1;w<k&&D--,P.splice(D,0,j),o.reorderSessionsInProject(t.projectId,P)}return(p,C)=>(l(),r("div",{class:H(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:f.value,"session-deleting":g.value}]),style:{cursor:"pointer"},draggable:"true",onClick:$,onDragstart:_,onDragend:E,onDragover:T,onDrop:m},[e("div",{class:H(["status-dot me-2",v.value]),style:de(h.value)},null,6),e("div",yi,[e("span",null,y(s.session.name||s.session.session_id),1),s.session.is_minion&&s.session.role?(l(),r("span",$i,"("+y(s.session.role)+")",1)):L("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:le(d,["stop"])}," âœï¸ ")],34))}},Si=U(wi,[["__scopeId","data-v-07ecbf94"]]),ki=["value"],Ci={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,u=ie(),i=V(),o=I("");Q(()=>u.currentRoute.value,_=>{!o.value&&_.name==="spy"&&_.params.minionId&&_.params.legionId===t.project.project_id&&(o.value=_.params.minionId)},{immediate:!0});const a=c(()=>o.value?t.sessions.find(_=>_.session_id===o.value):null),f=c(()=>{const _=u.currentRoute.value;return _.name==="spy"&&_.params.legionId===t.project.project_id}),g=c(()=>{if(!a.value)return"";if(a.value.state==="paused"&&a.value.is_processing)return"status-blinking";const _=a.value.is_processing?"processing":a.value.state;return _==="starting"||_==="processing"?"status-blinking":""}),n=c(()=>{if(!a.value)return{};if(a.value.state==="paused"&&a.value.is_processing)return{backgroundColor:"#ffc107"};const _=a.value.is_processing?"processing":a.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[_]||"#d3d3d3"}});function v(_){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[_.state]||"â—‹"}function h(_){return _.is_minion&&_.role?`${_.name} (${_.role})`:_.name}function $(){o.value&&u.push(`/spy/${t.project.project_id}/${o.value}`)}function d(){o.value?u.push(`/spy/${t.project.project_id}/${o.value}`):u.push("/")}return Q(()=>i.currentSessionId,_=>{_&&t.sessions.some(E=>E.session_id===_)&&(o.value=_)}),(_,E)=>(l(),r("div",{class:H(["list-group-item list-group-item-action p-2",{active:f.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:de({cursor:o.value?"pointer":"default"}),onClick:$},[E[1]||(E[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ”"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),a.value?(l(),r("span",{key:0,class:H(["minion-state-indicator",g.value]),style:de(n.value)}," ðŸ‘¤ ",6)):L("",!0)],4),K(e("select",{"onUpdate:modelValue":E[0]||(E[0]=T=>o.value=T),class:"form-select form-select-sm",onChange:d},[E[2]||(E[2]=e("option",{value:""},"-- Select Minion --",-1)),(l(!0),r(G,null,Y(s.sessions,T=>(l(),r("option",{key:T.session_id,value:T.session_id},y(v(T))+" "+y(h(T)),9,ki))),128))],544),[[ue,o.value]])],2))}},xi=U(Ci,[["__scopeId","data-v-9632f72c"]]),ji=["value"],Mi={__name:"HordeSelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,u=ie(),i=I("");Q(()=>u.currentRoute.value,v=>{!i.value&&v.name==="horde"&&v.params.overseerId&&v.params.legionId===t.project.project_id&&(i.value=v.params.overseerId)},{immediate:!0});const o=c(()=>t.sessions.filter(v=>v.is_overseer===!0)),a=c(()=>{const v=u.currentRoute.value;return v.name==="horde"&&v.params.legionId===t.project.project_id});function f(v){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[v.state]||"â—‹"}function g(){i.value&&u.push(`/horde/${t.project.project_id}/${i.value}`)}function n(){i.value&&u.push(`/horde/${t.project.project_id}/${i.value}`)}return(v,h)=>(l(),r("div",{class:H(["list-group-item list-group-item-action p-2",{active:a.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:de({cursor:i.value?"pointer":"default"}),onClick:g},[...h[1]||(h[1]=[e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸŒ³"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],4),K(e("select",{"onUpdate:modelValue":h[0]||(h[0]=$=>i.value=$),class:"form-select form-select-sm",onChange:n},[h[2]||(h[2]=e("option",{value:""},"-- Select Overseer --",-1)),(l(!0),r(G,null,Y(o.value,$=>(l(),r("option",{key:$.session_id,value:$.session_id},y(f($))+" "+y($.name),9,ji))),128))],544),[[ue,i.value]])],2))}},Ti=U(Mi,[["__scopeId","data-v-ca33279d"]]),Ei=["data-project-id"],Pi=["id"],Ii=["data-bs-target","aria-expanded","aria-controls"],Li={class:"flex-grow-1 me-2 d-flex flex-column",style:{"min-width":"0"}},Di={class:"fw-semibold mb-1",style:{"flex-shrink":"1","min-width":"0"}},Oi={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},Ni=["title"],Ai={class:"position-absolute d-flex gap-1",style:{right:"0.5rem",top:"50%",transform:"translateY(-50%)","z-index":"10"}},qi=["title"],Ri=["id","aria-labelledby"],Ui={class:"accordion-body p-0"},Fi={class:"list-group list-group-flush"},Hi={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(s){const t=s,u=ie(),i=ee(),o=V(),a=Z(),f=I(t.project.is_expanded||!1),g=c(()=>i.formatPath(t.project.working_directory)),n=c(()=>{var b;return!((b=t.project)!=null&&b.session_ids)||t.project.session_ids.length===0?[]:t.project.session_ids.map(x=>o.getSession(x)).filter(x=>x!=null)}),v=c(()=>{const b=u.currentRoute.value;return b.name==="timeline"&&b.params.legionId===t.project.project_id});function h(){f.value||(i.toggleExpansion(t.project.project_id),f.value=!0)}function $(){var b;if(f.value){i.toggleExpansion(t.project.project_id),f.value=!1;const x=o.currentSessionId;x&&o.getSession(x)&&(b=t.project.session_ids)!=null&&b.includes(x)&&u.push("/"),i.currentProjectId===t.project.project_id&&u.push("/")}}function d(){a.showModal("edit-project",{project:t.project})}function _(){t.project.is_multi_agent?a.showModal("create-minion",{project:t.project}):a.showModal("create-session",{project:t.project})}function E(){u.push(`/timeline/${t.project.project_id}`)}function T(b){b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("application/project-id",t.project.project_id),b.dataTransfer.setData("text/plain",t.project.project_id),b.target.classList.add("dragging")}function m(b){b.target.classList.remove("dragging")}function p(b){b.preventDefault(),b.dataTransfer.dropEffect="move";const x=b.currentTarget.getBoundingClientRect(),S=x.top+x.height/2;b.clientY<S?(b.currentTarget.classList.add("drop-above"),b.currentTarget.classList.remove("drop-below")):(b.currentTarget.classList.add("drop-below"),b.currentTarget.classList.remove("drop-above"))}function C(b){b.preventDefault(),b.currentTarget.classList.remove("drop-above","drop-below");const x=b.dataTransfer.getData("application/project-id")||b.dataTransfer.getData("text/plain");if(!x||x===t.project.project_id)return;const S=b.currentTarget.getBoundingClientRect(),M=S.top+S.height/2,q=b.clientY<M,A=i.orderedProjects,k=A.findIndex(N=>N.project_id===t.project.project_id),w=A.findIndex(N=>N.project_id===x);if(k===-1||w===-1)return;const P=[...A],[j]=P.splice(w,1);let D=q?k:k+1;w<k&&D--,P.splice(D,0,j);const O=P.map(N=>N.project_id);i.reorderProjects(O)}return(b,x)=>(l(),r("div",{class:"accordion-item border rounded mb-2","data-project-id":s.project.project_id,draggable:"true",onDragstart:T,onDragend:m,onDragover:p,onDrop:C},[e("h2",{class:"accordion-header",id:`heading-${s.project.project_id}`,style:{position:"relative"}},[e("button",{class:H(["accordion-button bg-white p-2",{collapsed:!f.value}]),type:"button","data-bs-toggle":"collapse","data-bs-target":`#collapse-${s.project.project_id}`,"aria-expanded":f.value,"aria-controls":`collapse-${s.project.project_id}`},[e("div",Li,[e("div",Di,[s.project.is_multi_agent?(l(),r("span",Oi,"ðŸ›")):L("",!0),F(" "+y(s.project.name),1)]),e("small",{class:"text-muted font-monospace text-truncate",title:s.project.working_directory,style:{display:"block","min-width":"0"}},y(g.value),9,Ni)])],10,Ii),e("div",Ai,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:le(d,["stop","prevent"])}," âœï¸ "),e("button",{class:"btn btn-sm btn-outline-primary",title:s.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:le(_,["stop","prevent"])}," âž• ",8,qi)])],8,Pi),J(hi,{project:s.project,sessions:n.value},null,8,["project","sessions"]),e("div",{id:`collapse-${s.project.project_id}`,class:H(["accordion-collapse collapse",{show:f.value}]),"aria-labelledby":`heading-${s.project.project_id}`,onShown:h,onHidden:$},[e("div",Ui,[e("div",Fi,[s.project.is_multi_agent?(l(),r("div",{key:0,class:H(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:v.value}]),style:{cursor:"pointer"},onClick:E},[...x[0]||(x[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ“Š"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):L("",!0),s.project.is_multi_agent?(l(),r(G,{key:1},[J(xi,{project:s.project,sessions:n.value},null,8,["project","sessions"]),J(Ti,{project:s.project,sessions:n.value},null,8,["project","sessions"])],64)):(l(!0),r(G,{key:2},Y(n.value,S=>(l(),ae(Si,{key:S.session_id,session:S,"project-id":s.project.project_id},null,8,["session","project-id"]))),128))])])],42,Ri)],40,Ei))}},Wi=U(Hi,[["__scopeId","data-v-c4da500a"]]),Bi={class:"project-list"},Vi={key:0,class:"text-muted text-center py-3"},zi={__name:"ProjectList",setup(s){const t=ee(),u=c(()=>t.orderedProjects);return(i,o)=>(l(),r("div",Bi,[u.value.length===0?(l(),r("div",Vi,' No projects yet. Click "New" to create one. ')):L("",!0),(l(!0),r(G,null,Y(u.value,a=>(l(),ae(Wi,{key:a.project_id,project:a},null,8,["project"]))),128))]))}},Ji={class:"flex-grow-1 overflow-auto p-3"},Ki={id:"sessions-container"},Gi={__name:"Sidebar",setup(s){const t=Z(),u=c(()=>t.sidebarCollapsed),i=c(()=>t.isMobile),o=c(()=>{if(i.value)return{};const h=`${t.sidebarWidth}px`;return{width:h,minWidth:"200px",maxWidth:"30vw","--sidebar-width":h}});function a(){t.showModal("create-project")}const f=I(!1);function g(h){f.value=!0,document.addEventListener("mousemove",n),document.addEventListener("mouseup",v)}function n(h){f.value&&t.setSidebarWidth(h.clientX)}function v(){f.value=!1,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",v)}return(h,$)=>(l(),r("aside",{id:"sidebar",class:H(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:u.value,"mobile-open":!u.value&&i.value,"desktop-collapsed":u.value&&!i.value}]),style:de(o.value)},[e("div",Ji,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[$[0]||($[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:a}," ðŸ“ New ")]),e("div",Ki,[J(zi)])]),e("div",{class:"sidebar-resize-handle",onMousedown:g},null,32)],6))}},Yi=U(Gi,[["__scopeId","data-v-d792f0f0"]]),Qi={class:"modal-dialog modal-lg"},Zi={class:"modal-content"},Xi={class:"modal-body"},eu={class:"mb-3"},tu={class:"input-group"},su=["disabled"],ou={key:0,class:"text-center py-4"},nu={key:1,class:"alert alert-danger",role:"alert"},lu={key:2,class:"folder-list"},au=["onClick","onDblclick"],ru={class:"d-flex align-items-center flex-grow-1"},iu=["onClick"],uu={key:1,class:"text-center text-muted py-3"},du={class:"modal-footer"},cu=["disabled"],mu={__name:"FolderBrowserModal",setup(s){const t=Z(),u=I(""),i=I(""),o=I([]),a=I(!1),f=I(""),g=I(null);let n=null,v=null;const h=c(()=>{if(!u.value)return null;const b=u.value.split(/[\\/]/).filter(Boolean);return b.length<=1?null:(b.pop(),b.length>0?b.join("/"):"/")});function $(b){if(!b)return"";const x=b.split(/[\\/]/).filter(Boolean);return x.length<=2?b:".../"+x.slice(-2).join("/")}async function d(){a.value=!0,f.value="",o.value=[],i.value="";try{const b=u.value?{path:u.value}:{},x=await z.get("/api/filesystem/browse",{params:b});x.current_path&&(u.value=x.current_path),o.value=x.directories||[]}catch(b){console.error("Failed to load directory:",b),f.value=b.message||"Failed to load directory"}finally{a.value=!1}}function _(b){i.value=b.path}function E(b){u.value=b.path,i.value="",d()}function T(){h.value&&(u.value=h.value,i.value="",d())}function m(){const b=i.value||u.value;b&&v&&v(b),n&&n.hide()}function p(){d()}function C(){o.value=[],i.value="",f.value="",v=null,t.hideModal()}return Q(()=>t.currentModal,b=>{if((b==null?void 0:b.name)==="folder-browser"&&n){const x=b.data||{};u.value=x.currentPath||"",v=x.onSelect||null,n.show()}}),oe(()=>{g.value&&se(async()=>{const{default:b}=await import("./modal-_9qZhl31.js").then(x=>x.m);return{default:b}},__vite__mapDeps([0,1])).then(({default:b})=>{n=new b(g.value),g.value.addEventListener("shown.bs.modal",p),g.value.addEventListener("hidden.bs.modal",C)})}),ne(()=>{g.value&&(g.value.removeEventListener("shown.bs.modal",p),g.value.removeEventListener("hidden.bs.modal",C)),n&&n.dispose()}),(b,x)=>(l(),r("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:g},[e("div",Qi,[e("div",Zi,[x[7]||(x[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Xi,[e("div",eu,[x[2]||(x[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",tu,[K(e("input",{type:"text",class:"form-control","onUpdate:modelValue":x[0]||(x[0]=S=>u.value=S),onKeyup:ze(d,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[X,u.value]]),e("button",{class:"btn btn-outline-secondary",onClick:d,disabled:a.value},[...x[1]||(x[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),F(" Refresh ",-1)])],8,su)])]),a.value?(l(),r("div",ou,[...x[3]||(x[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):f.value?(l(),r("div",nu,y(f.value),1)):(l(),r("div",lu,[h.value?(l(),r("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:T,role:"button"},[...x[4]||(x[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):L("",!0),(l(!0),r(G,null,Y(o.value,S=>(l(),r("div",{key:S.path,class:H(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:S.path===i.value}]),onClick:M=>_(S),onDblclick:M=>E(S),role:"button"},[e("div",ru,[x[5]||(x[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,y(S.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:le(M=>E(S),["stop"])}," Open ",8,iu)],42,au))),128)),o.value.length===0?(l(),r("div",uu," No subdirectories found ")):L("",!0)]))]),e("div",du,[x[6]||(x[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:m,disabled:!i.value},' Select "'+y($(i.value||u.value))+'" ',9,cu)])])])],512))}},pu=U(mu,[["__scopeId","data-v-667c51a9"]]),vu={class:"modal-dialog"},fu={class:"modal-content"},gu={class:"modal-body"},_u={class:"mb-3"},bu={key:0,class:"invalid-feedback"},hu={class:"mb-3"},yu={class:"input-group"},$u={key:0,class:"invalid-feedback"},wu={class:"mb-3 form-check"},Su={class:"mb-3 form-check"},ku={class:"form-check-label",for:"createSession"},Cu={key:0,class:"mb-3 ms-4"},xu={for:"sessionName",class:"form-label"},ju={key:1,class:"alert alert-danger",role:"alert"},Mu={class:"modal-footer"},Tu=["disabled"],Eu={key:0,class:"spinner-border spinner-border-sm me-2"},Pu={__name:"ProjectCreateModal",setup(s){const t=ee(),u=V(),i=Z(),o=I({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),a=I({name:"",workingDirectory:""}),f=I(!1),g=I(""),n=I(null);let v=null;function h(){i.showModal("folder-browser",{currentPath:o.value.workingDirectory||"",onSelect:m=>{o.value.workingDirectory=m,a.value.workingDirectory=""}})}function $(){a.value={};let m=!0;return o.value.name.trim()||(a.value.name="Project name is required",m=!1),o.value.workingDirectory.trim()||(a.value.workingDirectory="Working directory is required",m=!1),m}async function d(){if($()){f.value=!0,g.value="";try{const m=await t.createProject(o.value.name,o.value.workingDirectory,o.value.isMultiAgent);o.value.createSession&&await u.createSession(m.project_id,{name:o.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),v&&v.hide(),_()}catch(m){console.error("Failed to create project:",m),g.value=m.message||"Failed to create project. Please try again."}finally{f.value=!1}}}function _(){o.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},a.value={},g.value=""}function E(){const m=document.getElementById("projectName");m&&m.focus()}function T(){_(),i.hideModal()}return Q(()=>i.currentModal,m=>{(m==null?void 0:m.name)==="create-project"&&v&&v.show()}),oe(()=>{n.value&&se(async()=>{const{default:m}=await import("./modal-_9qZhl31.js").then(p=>p.m);return{default:m}},__vite__mapDeps([0,1])).then(({default:m})=>{v=new m(n.value),n.value.addEventListener("shown.bs.modal",E),n.value.addEventListener("hidden.bs.modal",T)})}),ne(()=>{n.value&&(n.value.removeEventListener("shown.bs.modal",E),n.value.removeEventListener("hidden.bs.modal",T)),v&&v.dispose()}),(m,p)=>(l(),r("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:n},[e("div",vu,[e("div",fu,[p[11]||(p[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",gu,[e("form",{onSubmit:le(d,["prevent"])},[e("div",_u,[p[5]||(p[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),K(e("input",{type:"text",class:H(["form-control",{"is-invalid":a.value.name}]),id:"projectName","onUpdate:modelValue":p[0]||(p[0]=C=>o.value.name=C),placeholder:"My Project",required:""},null,2),[[X,o.value.name]]),a.value.name?(l(),r("div",bu,y(a.value.name),1)):L("",!0)]),e("div",hu,[p[6]||(p[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",yu,[K(e("input",{type:"text",class:H(["form-control",{"is-invalid":a.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":p[1]||(p[1]=C=>o.value.workingDirectory=C),placeholder:"/path/to/project",required:""},null,2),[[X,o.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:h}," Browse... "),a.value.workingDirectory?(l(),r("div",$u,y(a.value.workingDirectory),1)):L("",!0)]),p[7]||(p[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",wu,[K(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":p[2]||(p[2]=C=>o.value.isMultiAgent=C)},null,512),[[ke,o.value.isMultiAgent]]),p[8]||(p[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," ðŸ› Multi-Agent Project (Legion) ",-1)),p[9]||(p[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",Su,[K(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":p[3]||(p[3]=C=>o.value.createSession=C)},null,512),[[ke,o.value.createSession]]),e("label",ku," Create initial "+y(o.value.isMultiAgent?"minion":"session"),1)]),o.value.createSession?(l(),r("div",Cu,[e("label",xu," Initial "+y(o.value.isMultiAgent?"Minion":"Session")+" Name ",1),K(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":p[4]||(p[4]=C=>o.value.sessionName=C),placeholder:"main"},null,512),[[X,o.value.sessionName]])])):L("",!0),g.value?(l(),r("div",ju,y(g.value),1)):L("",!0)],32)]),e("div",Mu,[p[10]||(p[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:d,disabled:f.value},[f.value?(l(),r("span",Eu)):L("",!0),F(" "+y(f.value?"Creating...":"Create Project"),1)],8,Tu)])])])],512))}},Iu=U(Pu,[["__scopeId","data-v-adf50394"]]),Lu={class:"modal-dialog"},Du={class:"modal-content"},Ou={class:"modal-body"},Nu={class:"mb-3"},Au={key:0,class:"invalid-feedback"},qu={class:"mb-3"},Ru=["value"],Uu={key:0,class:"alert alert-danger",role:"alert"},Fu={class:"danger-zone"},Hu={class:"text-muted small"},Wu=["disabled"],Bu={key:0,class:"alert alert-warning mt-3",role:"alert"},Vu={class:"mb-2"},zu={class:"d-flex gap-2"},Ju=["disabled"],Ku={key:0,class:"spinner-border spinner-border-sm me-2"},Gu=["disabled"],Yu={class:"modal-footer"},Qu=["disabled"],Zu={key:0,class:"spinner-border spinner-border-sm me-2"},Xu={__name:"ProjectEditModal",setup(s){const t=ee(),u=Z(),i=I(null),o=I({name:""}),a=I({name:""}),f=I(!1),g=I(!1),n=I(""),v=I(!1),h=I(null);let $=null;const d=c(()=>{var b,x;return((x=(b=i.value)==null?void 0:b.session_ids)==null?void 0:x.length)||0});function _(){a.value={};let b=!0;return o.value.name.trim()||(a.value.name="Project name is required",b=!1),b}async function E(){if(!(!_()||!i.value)){f.value=!0,n.value="";try{await t.updateProject(i.value.project_id,{name:o.value.name}),$&&$.hide()}catch(b){console.error("Failed to update project:",b),n.value=b.message||"Failed to update project. Please try again."}finally{f.value=!1}}}async function T(){if(i.value){g.value=!0,n.value="";try{await t.deleteProject(i.value.project_id),$&&$.hide()}catch(b){console.error("Failed to delete project:",b),n.value=b.message||"Failed to delete project. Please try again."}finally{g.value=!1}}}function m(){o.value={name:""},a.value={},n.value="",v.value=!1}function p(){const b=document.getElementById("editProjectName");b&&(b.focus(),b.select())}function C(){m(),i.value=null,u.hideModal()}return Q(()=>u.currentModal,b=>{if((b==null?void 0:b.name)==="edit-project"&&$){const x=b.data||{};i.value=x.project,i.value&&(o.value.name=i.value.name),$.show()}}),oe(()=>{h.value&&se(async()=>{const{default:b}=await import("./modal-_9qZhl31.js").then(x=>x.m);return{default:b}},__vite__mapDeps([0,1])).then(({default:b})=>{$=new b(h.value),h.value.addEventListener("shown.bs.modal",p),h.value.addEventListener("hidden.bs.modal",C)})}),ne(()=>{h.value&&(h.value.removeEventListener("shown.bs.modal",p),h.value.removeEventListener("hidden.bs.modal",C)),$&&$.dispose()}),(b,x)=>{var S,M;return l(),r("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:h},[e("div",Lu,[e("div",Du,[x[11]||(x[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Ou,[e("form",{onSubmit:le(E,["prevent"])},[e("div",Nu,[x[3]||(x[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),K(e("input",{type:"text",class:H(["form-control",{"is-invalid":a.value.name}]),id:"editProjectName","onUpdate:modelValue":x[0]||(x[0]=q=>o.value.name=q),placeholder:"My Project",required:""},null,2),[[X,o.value.name]]),a.value.name?(l(),r("div",Au,y(a.value.name),1)):L("",!0)]),e("div",qu,[x[4]||(x[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:(S=i.value)==null?void 0:S.working_directory,disabled:"",readonly:""},null,8,Ru),x[5]||(x[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),n.value?(l(),r("div",Uu,y(n.value),1)):L("",!0)],32),x[9]||(x[9]=e("hr",null,null,-1)),e("div",Fu,[x[7]||(x[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",Hu," Deleting this project will also delete all "+y(d.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:x[1]||(x[1]=q=>v.value=!0),disabled:g.value},[...x[6]||(x[6]=[e("i",{class:"bi bi-trash"},null,-1),F(" Delete Project ",-1)])],8,Wu)]),v.value?(l(),r("div",Bu,[x[8]||(x[8]=e("strong",null,"Are you sure?",-1)),e("p",Vu,' This will permanently delete the project "'+y((M=i.value)==null?void 0:M.name)+'" and all '+y(d.value)+" session(s). ",1),e("div",zu,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:T,disabled:g.value},[g.value?(l(),r("span",Ku)):L("",!0),F(" "+y(g.value?"Deleting...":"Yes, Delete Permanently"),1)],8,Ju),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:x[2]||(x[2]=q=>v.value=!1),disabled:g.value}," Cancel ",8,Gu)])])):L("",!0)]),e("div",Yu,[x[10]||(x[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:E,disabled:f.value},[f.value?(l(),r("span",Zu)):L("",!0),F(" "+y(f.value?"Saving...":"Save Changes"),1)],8,Qu)])])])],512)}}},ed=U(Xu,[["__scopeId","data-v-6f299f35"]]),td={class:"modal-dialog modal-lg"},sd={class:"modal-content"},od={class:"modal-header"},nd={class:"modal-title",id:"createSessionModalLabel"},ld={key:0,class:"text-muted small"},ad={class:"modal-body"},rd={class:"mb-3"},id={key:0,class:"invalid-feedback"},ud={class:"mb-3"},dd={class:"mb-3"},cd={class:"mb-3"},md={class:"mb-3"},pd={class:"mb-3 form-check"},vd={key:0,class:"alert alert-danger",role:"alert"},fd={class:"modal-footer"},gd=["disabled"],_d={key:0,class:"spinner-border spinner-border-sm me-2"},bd={__name:"SessionCreateModal",setup(s){const t=ie();ee();const u=V(),i=Z(),o=I(null),a=I({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",tools:"",startImmediately:!0}),f=I({name:""}),g=I(!1),n=I(""),v=I(null);let h=null;function $(){f.value={};let m=!0;return a.value.name.trim()||(f.value.name="Session name is required",m=!1),m}async function d(){if(!(!$()||!o.value)){g.value=!0,n.value="";try{const m=a.value.tools.split(",").map(b=>b.trim()).filter(b=>b.length>0),p={name:a.value.name,permission_mode:a.value.permission_mode,model:a.value.model,system_prompt:a.value.system_prompt.trim()||null,tools:m},C=await u.createSession(o.value.project_id,p);a.value.startImmediately&&await u.startSession(C.session_id),t.push(`/session/${C.session_id}`),h&&h.hide(),_()}catch(m){console.error("Failed to create session:",m),n.value=m.message||"Failed to create session. Please try again."}finally{g.value=!1}}}function _(){a.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",tools:"",startImmediately:!0},f.value={},n.value=""}function E(){const m=document.getElementById("sessionName");m&&m.focus()}function T(){_(),o.value=null,i.hideModal()}return Q(()=>i.currentModal,m=>{if((m==null?void 0:m.name)==="create-session"&&h){const p=m.data||{};o.value=p.project,h.show()}}),oe(()=>{v.value&&se(async()=>{const{default:m}=await import("./modal-_9qZhl31.js").then(p=>p.m);return{default:m}},__vite__mapDeps([0,1])).then(({default:m})=>{h=new m(v.value),v.value.addEventListener("shown.bs.modal",E),v.value.addEventListener("hidden.bs.modal",T)})}),ne(()=>{v.value&&(v.value.removeEventListener("shown.bs.modal",E),v.value.removeEventListener("hidden.bs.modal",T)),h&&h.dispose()}),(m,p)=>(l(),r("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",td,[e("div",sd,[e("div",od,[e("h5",nd,[p[6]||(p[6]=F(" Create New Session ",-1)),o.value?(l(),r("span",ld,"in "+y(o.value.name),1)):L("",!0)]),p[7]||(p[7]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",ad,[e("form",{onSubmit:le(d,["prevent"])},[e("div",rd,[p[8]||(p[8]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),K(e("input",{type:"text",class:H(["form-control",{"is-invalid":f.value.name}]),id:"sessionName","onUpdate:modelValue":p[0]||(p[0]=C=>a.value.name=C),placeholder:"main",required:""},null,2),[[X,a.value.name]]),f.value.name?(l(),r("div",id,y(f.value.name),1)):L("",!0)]),e("div",ud,[p[10]||(p[10]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),K(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":p[1]||(p[1]=C=>a.value.permission_mode=C)},[...p[9]||(p[9]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"âš ï¸ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[ue,a.value.permission_mode]]),p[11]||(p[11]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",dd,[p[13]||(p[13]=e("label",{for:"model",class:"form-label"},"Model",-1)),K(e("select",{class:"form-select",id:"model","onUpdate:modelValue":p[2]||(p[2]=C=>a.value.model=C)},[...p[12]||(p[12]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[ue,a.value.model]])]),e("div",cd,[p[14]||(p[14]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),K(e("textarea",{class:"form-control",id:"systemPrompt","onUpdate:modelValue":p[3]||(p[3]=C=>a.value.system_prompt=C),rows:"3",placeholder:"Additional instructions to append to the system prompt..."},null,512),[[X,a.value.system_prompt]]),p[15]||(p[15]=e("div",{class:"form-text"}," These instructions will be appended to Claude Code's default system prompt ",-1))]),e("div",md,[p[16]||(p[16]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),K(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":p[4]||(p[4]=C=>a.value.tools=C),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[X,a.value.tools]]),p[17]||(p[17]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",pd,[K(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":p[5]||(p[5]=C=>a.value.startImmediately=C)},null,512),[[ke,a.value.startImmediately]]),p[18]||(p[18]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),n.value?(l(),r("div",vd,y(n.value),1)):L("",!0)],32)]),e("div",fd,[p[19]||(p[19]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:d,disabled:g.value},[g.value?(l(),r("span",_d)):L("",!0),F(" "+y(g.value?"Creating...":"Create Session"),1)],8,gd)])])])],512))}},hd=U(bd,[["__scopeId","data-v-75934d4f"]]),yd={class:"modal-dialog"},$d={class:"modal-content"},wd={class:"modal-body"},Sd={class:"mb-3"},kd={key:0,class:"invalid-feedback"},Cd={class:"mb-3"},xd=["value"],jd={class:"mb-3"},Md={class:"form-control-plaintext"},Td={class:"mb-3"},Ed=["disabled"],Pd={key:0,value:"bypassPermissions"},Id={class:"form-text"},Ld={key:0,class:"text-warning"},Dd={key:1},Od={key:0,class:"alert alert-danger",role:"alert"},Nd={class:"modal-footer"},Ad=["disabled"],qd={key:0,class:"spinner-border spinner-border-sm me-2"},Rd={__name:"SessionEditModal",setup(s){const t=V(),u=Z(),i=I(null),o=I({name:"",permission_mode:"default"}),a=I({name:""}),f=I(!1),g=I(""),n=I(null);let v=null;const h=c(()=>{var C,b;return((C=i.value)==null?void 0:C.state)==="active"||((b=i.value)==null?void 0:b.state)==="starting"}),$=c(()=>{var C;return((C=i.value)==null?void 0:C.initial_permission_mode)==="bypassPermissions"});function d(C){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[C]||"bg-secondary"}function _(){a.value={};let C=!0;return o.value.name.trim()||(a.value.name="Session name is required",C=!1),C}async function E(){if(!(!_()||!i.value)){f.value=!0,g.value="";try{await t.updateSessionName(i.value.session_id,o.value.name),o.value.permission_mode!==i.value.current_permission_mode&&await t.setPermissionMode(i.value.session_id,o.value.permission_mode),v&&v.hide()}catch(C){console.error("Failed to update session:",C),g.value=C.message||"Failed to update session. Please try again."}finally{f.value=!1}}}function T(){o.value={name:"",permission_mode:"default"},a.value={},g.value=""}function m(){const C=document.getElementById("editSessionName");C&&(C.focus(),C.select())}function p(){T(),i.value=null,u.hideModal()}return Q(()=>u.currentModal,C=>{if((C==null?void 0:C.name)==="edit-session"&&v){const b=C.data||{};i.value=b.session,i.value&&(o.value.name=i.value.name,o.value.permission_mode=i.value.current_permission_mode||"default"),v.show()}}),oe(()=>{n.value&&se(async()=>{const{default:C}=await import("./modal-_9qZhl31.js").then(b=>b.m);return{default:C}},__vite__mapDeps([0,1])).then(({default:C})=>{v=new C(n.value),n.value.addEventListener("shown.bs.modal",m),n.value.addEventListener("hidden.bs.modal",p)})}),ne(()=>{n.value&&(n.value.removeEventListener("shown.bs.modal",m),n.value.removeEventListener("hidden.bs.modal",p)),v&&v.dispose()}),(C,b)=>{var x,S,M;return l(),r("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:n},[e("div",yd,[e("div",$d,[b[11]||(b[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",wd,[e("form",{onSubmit:le(E,["prevent"])},[e("div",Sd,[b[2]||(b[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),K(e("input",{type:"text",class:H(["form-control",{"is-invalid":a.value.name}]),id:"editSessionName","onUpdate:modelValue":b[0]||(b[0]=q=>o.value.name=q),placeholder:"Session Name",required:""},null,2),[[X,o.value.name]]),a.value.name?(l(),r("div",kd,y(a.value.name),1)):L("",!0)]),e("div",Cd,[b[3]||(b[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:(x=i.value)==null?void 0:x.working_directory,disabled:"",readonly:""},null,8,xd),b[4]||(b[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",jd,[b[5]||(b[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",Md,[e("span",{class:H(["badge",d((S=i.value)==null?void 0:S.state)])},y((M=i.value)==null?void 0:M.state),3)])]),e("div",Td,[b[9]||(b[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),K(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":b[1]||(b[1]=q=>o.value.permission_mode=q),disabled:!h.value},[b[6]||(b[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),b[7]||(b[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),b[8]||(b[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),$.value?(l(),r("option",Pd,"âš ï¸ Bypass Permissions (No prompts)")):L("",!0)],8,Ed),[[ue,o.value.permission_mode]]),e("div",Id,[h.value?(l(),r("span",Dd," Controls which tool actions require permission prompts ")):(l(),r("span",Ld," âš ï¸ Session must be active to change permission mode. Start the session first. "))])]),g.value?(l(),r("div",Od,y(g.value),1)):L("",!0)],32)]),e("div",Nd,[b[10]||(b[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:E,disabled:f.value},[f.value?(l(),r("span",qd)):L("",!0),F(" "+y(f.value?"Saving...":"Save Changes"),1)],8,Ad)])])])],512)}}},Ud=U(Rd,[["__scopeId","data-v-ec2f9089"]]),Fd={class:"modal-dialog modal-dialog-centered"},Hd={class:"modal-content"},Wd={class:"modal-header"},Bd={class:"modal-title",id:"manageSessionModalLabel"},Vd={class:"modal-body"},zd={key:0,class:"text-center py-4"},Jd={class:"text-muted"},Kd={key:1},Gd={key:2},Yd={class:"text-muted"},Qd={key:3},Zd={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Xd={class:"d-grid gap-2"},ec=["disabled"],tc=["disabled"],sc=["disabled"],oc=["disabled"],nc={class:"modal-footer"},lc={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},ac={__name:"SessionManageModal",setup(s){const t=ie(),u=V(),i=Z(),o=me(),a=ce(),f=I(null),g=I(!1),n=I(""),v=I(""),h=I(null),$=I(null);let d=null;const _=c(()=>h.value==="reset"?"Reset Session":h.value==="delete"?"Delete Session":"Manage Session");function E(){h.value="reset"}function T(){h.value="delete"}function m(){h.value=null}async function p(){h.value==="reset"?await x():h.value==="delete"&&await S()}async function C(){var A;if(f.value){g.value=!0,n.value="Restarting session...";try{const k=f.value.session_id,w=await z.post(`/api/sessions/${k}/restart`);if(w.success)console.log("Session restarted successfully, reconnecting"),o.disconnectSession(),await u.selectSession(k),d&&d.hide();else{const P=w.error||w.detail||"Failed to restart session";console.error("Failed to restart session:",P),v.value=`Failed to restart session: ${P}`}}catch(k){console.error("Error restarting session:",k);const w=((A=k.data)==null?void 0:A.detail)||k.message||"Unknown error";v.value=`Error restarting session: ${w}`}finally{g.value=!1}}}async function b(){var A;if(f.value)try{d&&d.hide(),console.log("Ending session",f.value.session_id);const k=f.value.session_id;await z.post(`/api/sessions/${k}/terminate`),o.disconnectSession(),u.currentSessionId===k&&(u.currentSessionId=null),t.push("/")}catch(k){console.error("Error ending session:",k),o.disconnectSession(),u.currentSessionId===((A=f.value)==null?void 0:A.session_id)&&(u.currentSessionId=null),t.push("/")}}async function x(){var A;if(f.value){g.value=!0,n.value="Resetting session...";try{const k=f.value.session_id,w=await z.post(`/api/sessions/${k}/reset`);if(w.success)console.log("Session reset successfully, reconnecting"),o.disconnectSession(),await new Promise(P=>setTimeout(P,200)),await a.loadMessages(k),o.connectSession(k),d&&d.hide();else{const P=w.error||w.detail||"Failed to reset session";console.error("Failed to reset session:",P),v.value=`Failed to reset session: ${P}`,h.value=null}}catch(k){console.error("Error resetting session:",k);const w=((A=k.data)==null?void 0:A.detail)||k.message||"Unknown error";v.value=`Error resetting session: ${w}`,h.value=null}finally{g.value=!1}}}async function S(){var A;if(f.value){g.value=!0,n.value="Deleting session...";try{const k=f.value.session_id;await u.deleteSession(k),t.currentRoute.value.params.sessionId===k&&t.push("/"),d&&d.hide()}catch(k){console.error("Error deleting session:",k);const w=((A=k.data)==null?void 0:A.detail)||k.message||"Unknown error";v.value=`Error deleting session: ${w}`,h.value=null}finally{g.value=!1}}}function M(){h.value=null,g.value=!1,n.value="",v.value=""}function q(){M(),f.value=null,i.hideModal()}return Q(()=>i.currentModal,A=>{if((A==null?void 0:A.name)==="manage-session"&&d){const k=A.data||{};f.value=k.session,M(),d.show()}}),oe(()=>{$.value&&se(async()=>{const{default:A}=await import("./modal-_9qZhl31.js").then(k=>k.m);return{default:A}},__vite__mapDeps([0,1])).then(({default:A})=>{d=new A($.value),$.value.addEventListener("hidden.bs.modal",q)})}),ne(()=>{$.value&&$.value.removeEventListener("hidden.bs.modal",q),d&&d.dispose()}),(A,k)=>{var w;return l(),r("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:$},[e("div",Fd,[e("div",Hd,[e("div",Wd,[e("h5",Bd,y(h.value?_.value:"Manage Session"),1),k[1]||(k[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Vd,[g.value?(l(),r("div",zd,[k[2]||(k[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Jd,y(n.value),1)])):h.value==="reset"?(l(),r("div",Kd,[...k[3]||(k[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):h.value==="delete"?(l(),r("div",Gd,[k[6]||(k[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1)),e("p",Yd,[k[4]||(k[4]=F("This will permanently delete session ",-1)),e("strong",null,y((w=f.value)==null?void 0:w.name),1),k[5]||(k[5]=F(".",-1))]),k[7]||(k[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(l(),r("div",Qd,[v.value?(l(),r("div",Zd,[k[8]||(k[8]=e("strong",null,"Error:",-1)),F(" "+y(v.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:k[0]||(k[0]=P=>v.value="")})])):L("",!0),k[15]||(k[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",Xd,[e("button",{class:"btn btn-outline-primary text-start",onClick:C,disabled:g.value},[...k[9]||(k[9]=[e("strong",null,"ðŸ”„ Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,ec),e("button",{class:"btn btn-outline-secondary text-start",onClick:b,disabled:g.value},[...k[10]||(k[10]=[e("strong",null,"ðŸšª End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,tc),k[13]||(k[13]=e("hr",{class:"my-2"},null,-1)),k[14]||(k[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"âš ï¸ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:E,disabled:g.value},[...k[11]||(k[11]=[e("strong",null,"ðŸ—‘ï¸ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,sc),e("button",{class:"btn btn-outline-danger text-start",onClick:T,disabled:g.value},[...k[12]||(k[12]=[e("strong",null,"âŒ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,oc)]),k[16]||(k[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),F(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",nc,[h.value&&!g.value?(l(),r(G,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:m},"Cancel"),e("button",{type:"button",class:H(["btn",h.value==="delete"?"btn-danger":"btn-warning"]),onClick:p},y(h.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):g.value?L("",!0):(l(),r("button",lc,"Cancel"))])])])],512)}}},rc=U(ac,[["__scopeId","data-v-52b5acf6"]]),ic={class:"modal-dialog modal-dialog-centered modal-lg"},uc={class:"modal-content"},dc={class:"modal-body"},cc={key:0,class:"text-center text-muted py-4"},mc={key:1},pc={class:"mb-3"},vc={class:"font-monospace small"},fc={class:"mb-3"},gc={class:"font-monospace small"},_c={class:"mb-3"},bc={class:"mb-3"},hc={class:"mb-3"},yc={key:0},$c={class:"d-flex flex-wrap gap-1"},wc={key:1,class:"text-muted small"},Sc={key:0,class:"mb-3"},kc={class:"d-flex flex-wrap gap-1"},Cc={key:1,class:"mb-3"},xc={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},jc={class:"mb-3"},Mc={class:"text-muted"},Tc={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},Ec={__name:"SessionInfoModal",setup(s){const t=V(),u=ce(),i=Z(),o=I(null),a=I(!1),f=I(null);let g=null;const n=c(()=>{var T;if(!o.value)return null;const d=t.initData.get(o.value);if(d)return d;const E=(u.messagesBySession.get(o.value)||[]).find(m=>{var p,C;return m.type==="system"&&(m.subtype==="init"||((p=m.metadata)==null?void 0:p.subtype)==="init")&&((C=m.metadata)==null?void 0:C.init_data)});return((T=E==null?void 0:E.metadata)==null?void 0:T.init_data)||null});function v(d){return typeof d=="string"?d:typeof d=="object"&&d.type==="preset"?`Preset: ${d.preset}`:JSON.stringify(d,null,2)}function h(){o.value=null,a.value=!1}function $(){h(),i.hideModal()}return Q(()=>i.currentModal,d=>{if((d==null?void 0:d.name)==="session-info"&&g){const _=d.data||{};o.value=_.sessionId,a.value=!1,g.show()}}),oe(()=>{f.value&&se(async()=>{const{default:d}=await import("./modal-_9qZhl31.js").then(_=>_.m);return{default:d}},__vite__mapDeps([0,1])).then(({default:d})=>{g=new d(f.value),f.value.addEventListener("hidden.bs.modal",$)})}),ne(()=>{f.value&&f.value.removeEventListener("hidden.bs.modal",$),g&&g.dispose()}),(d,_)=>(l(),r("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:f},[e("div",ic,[e("div",uc,[_[9]||(_[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",dc,[n.value?(l(),r("div",mc,[e("div",pc,[_[1]||(_[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",vc,y(o.value),1)]),e("div",fc,[_[2]||(_[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",gc,y(n.value.cwd||"Not specified"),1)]),e("div",_c,[_[3]||(_[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,y(n.value.model||"Default"),1)]),e("div",bc,[_[4]||(_[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,y(n.value.permissionMode||"default"),1)]),e("div",hc,[_[5]||(_[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),n.value.tools&&n.value.tools.length>0?(l(),r("div",yc,[e("div",$c,[(l(!0),r(G,null,Y(n.value.tools,E=>(l(),r("span",{key:E,class:"badge bg-secondary"},y(E),1))),128))])])):(l(),r("div",wc,"All tools available"))]),n.value.commands&&n.value.commands.length>0?(l(),r("div",Sc,[_[6]||(_[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",kc,[(l(!0),r(G,null,Y(n.value.commands,E=>(l(),r("span",{key:E,class:"badge bg-info"},y(E),1))),128))])])):L("",!0),n.value.systemPrompt?(l(),r("div",Cc,[_[7]||(_[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",xc,y(v(n.value.systemPrompt)),1)])):L("",!0),e("div",jc,[e("h6",Mc,[_[8]||(_[8]=F(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:_[0]||(_[0]=E=>a.value=!a.value)},y(a.value?"Hide":"Show"),1)]),a.value?(l(),r("pre",Tc,y(JSON.stringify(n.value,null,2)),1)):L("",!0)])])):(l(),r("div",cc," No session configuration data available "))]),_[10]||(_[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},Pc=U(Ec,[["__scopeId","data-v-809e2099"]]),Ic={class:"modal-dialog modal-dialog-centered"},Lc={class:"modal-content"},Dc={class:"modal-body"},Oc={class:"mb-3"},Nc={class:"mb-3"},Ac={class:"mb-3"},qc={class:"mb-3"},Rc={key:0,class:"alert alert-danger"},Uc={class:"modal-footer"},Fc=["disabled"],Hc={key:0,class:"spinner-border spinner-border-sm me-2"},Wc={__name:"CreateMinionModal",setup(s){const t=ie(),u=ee(),i=V(),o=Z(),a=I(null);let f=null;const g=I(null),n=I({name:"",role:"",initialization_context:"",capabilities:[]}),v=I(""),h=I(""),$=I(!1),d=c(()=>v.value.trim()?v.value.split(",").map(m=>m.trim()).filter(m=>m.length>0):[]);function _(){n.value={name:"",role:"",initialization_context:"",capabilities:[]},v.value="",h.value="",$.value=!1}function E(){_(),o.hideModal()}async function T(){var m,p;if(!n.value.name.trim()){h.value="Minion name is required";return}if(n.value.name.includes(" ")){h.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(!g.value){h.value="Legion ID is missing";return}$.value=!0,h.value="";try{const C={name:n.value.name.trim(),role:n.value.role.trim(),initialization_context:n.value.initialization_context.trim(),capabilities:d.value},b=await z.post(`/api/legions/${g.value}/minions`,C);b.success&&b.minion_id?(await u.fetchProjects(),await i.fetchSessions(),f&&f.hide(),t.push(`/spy/${g.value}/${b.minion_id}`)):h.value="Failed to create minion"}catch(C){console.error("Failed to create minion:",C),h.value=((p=(m=C.response)==null?void 0:m.data)==null?void 0:p.detail)||"Failed to create minion"}finally{$.value=!1}}return Q(()=>o.currentModal,m=>{var p;if((m==null?void 0:m.name)==="create-minion"&&f){const C=m.data||{};g.value=((p=C.project)==null?void 0:p.project_id)||null,_(),f.show()}}),oe(()=>{a.value&&se(()=>import("./modal-_9qZhl31.js").then(m=>m.m),__vite__mapDeps([0,1])).then(m=>{const p=m.default;f=new p(a.value),a.value.addEventListener("hidden.bs.modal",E)})}),ne(()=>{a.value&&a.value.removeEventListener("hidden.bs.modal",E),f&&f.dispose()}),(m,p)=>(l(),r("div",{ref_key:"modalElement",ref:a,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",Ic,[e("div",Lc,[p[13]||(p[13]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Dc,[e("form",{onSubmit:le(T,["prevent"])},[e("div",Oc,[p[4]||(p[4]=e("label",{for:"minion-name",class:"form-label"},[F(" Name "),e("span",{class:"text-danger"},"*")],-1)),K(e("input",{id:"minion-name","onUpdate:modelValue":p[0]||(p[0]=C=>n.value.name=C),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[X,n.value.name]]),p[5]||(p[5]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",Nc,[p[6]||(p[6]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),K(e("input",{id:"minion-role","onUpdate:modelValue":p[1]||(p[1]=C=>n.value.role=C),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[X,n.value.role]]),p[7]||(p[7]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",Ac,[p[8]||(p[8]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),K(e("textarea",{id:"minion-context","onUpdate:modelValue":p[2]||(p[2]=C=>n.value.initialization_context=C),class:"form-control",rows:"4",placeholder:"Instructions and context for the minion..."},null,512),[[X,n.value.initialization_context]]),p[9]||(p[9]=e("div",{class:"form-text"},"Instructions and context to initialize the minion with",-1))]),e("div",qc,[p[10]||(p[10]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),K(e("input",{id:"minion-capabilities","onUpdate:modelValue":p[3]||(p[3]=C=>v.value=C),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[X,v.value]]),p[11]||(p[11]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),h.value?(l(),r("div",Rc,y(h.value),1)):L("",!0)],32)]),e("div",Uc,[p[12]||(p[12]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!n.value.name.trim()||$.value,onClick:T},[$.value?(l(),r("span",Hc)):L("",!0),F(" "+y($.value?"Creating...":"Create Minion"),1)],8,Fc)])])])],512))}},Bc=U(Wc,[["__scopeId","data-v-fd1df88d"]]),Vc={class:"container-fluid vh-100 d-flex flex-column p-0"},zc={class:"d-flex flex-grow-1 overflow-hidden position-relative"},Jc={class:"flex-grow-1 d-flex flex-column overflow-hidden"},Kc={__name:"App",setup(s){const t=Z(),u=me(),i=V(),o=ee(),a=ie(),f=c(()=>t.sidebarCollapsed),g=c(()=>t.isMobile);oe(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),u.connectUI(),await Promise.all([o.fetchProjects(),i.fetchSessions()]);const h=window.location.hash;if(h.startsWith("#/session/")){const $=h.replace("#/session/","");i.sessions.has($)&&await i.selectSession($)}else if(h.startsWith("#/timeline/")){const $=h.replace("#/timeline/","");a.push(`/timeline/${$}`)}window.addEventListener("popstate",n),window.addEventListener("resize",t.handleResize)}),ne(()=>{window.removeEventListener("popstate",n),window.removeEventListener("resize",t.handleResize),u.disconnectUI()});function n(){const h=window.location.hash;if(h.startsWith("#/session/")){const $=h.replace("#/session/","");i.sessions.has($)&&i.selectSession($)}}function v(){t.toggleSidebar()}return(h,$)=>{const d=Je("router-view");return l(),r("div",Vc,[J(vi),e("div",{id:"sidebar-backdrop",class:H({show:!f.value&&g.value}),onClick:v},null,2),e("div",zc,[J(Yi),e("main",Jc,[J(d)])]),J(pu),J(Iu),J(ed),J(hd),J(Ud),J(rc),J(Pc),J(Bc)])}}},je=Qe(Kc);je.use(Ze());je.use(di);je.mount("#app");
