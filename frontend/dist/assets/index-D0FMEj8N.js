const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as o,a as e,o as s,d as _e,r as L,b as d,t as p,n as me,e as H,f as G,u as ke,w as ee,g as Pe,h as D,F as Y,i as Z,j as de,k as Ue,l as Q,v as le,m as X,p as ne,q as Te,s as Se,x as re,y as ce,z as ge,A as qe,B as He,C as Be,D as pe,E as be,G as Ve,H as ze}from"./vue-vendor-BChC3Sgv.js";import{m as ye,p as Ee}from"./markdown-vendor-CQ3OZdP9.js";import{c as Ge}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))m(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&m(c)}).observe(document,{childList:!0,subtree:!0});function a(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function m(i){if(i.ep)return;i.ep=!0;const l=a(i);fetch(i.href,l)}})();const Je={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},Ke={__name:"NoSessionSelected",setup(n){return(t,a)=>(s(),o("div",Je,[...a[0]||(a[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},Ye="modulepreload",Qe=function(n){return"/"+n},Ie={},ie=function(t,a,m){let i=Promise.resolve();if(a&&a.length>0){let r=function(v){return Promise.all(v.map(u=>Promise.resolve(u).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),f=c?.nonce||c?.getAttribute("nonce");i=r(a.map(v=>{if(v=Qe(v),v in Ie)return;Ie[v]=!0;const u=v.endsWith(".css"),b=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${b}`))return;const _=document.createElement("link");if(_.rel=u?"stylesheet":Ye,u||(_.as="script"),_.crossOrigin="",_.href=v,f&&_.setAttribute("nonce",f),document.head.appendChild(_),u)return new Promise((w,T)=>{_.addEventListener("load",w),_.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${v}`)))})}))}function l(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return i.then(c=>{for(const f of c||[])f.status==="rejected"&&l(f.reason);return t().catch(l)})};class xe extends Error{constructor(t,a,m){super(t),this.name="APIError",this.status=a,this.data=m}}async function $e(n,t={}){try{const a=await fetch(n,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!a.ok){let i;try{i=await a.json()}catch{i={detail:a.statusText}}throw new xe(i.detail||`HTTP ${a.status}: ${a.statusText}`,a.status,i)}const m=a.headers.get("content-type");return m&&m.includes("application/json")?await a.json():await a.text()}catch(a){throw a instanceof xe?a:(console.error("API request failed:",a),new xe(`Network error: ${a.message}`,0,null))}}async function Ze(n,t={}){let a=n;if(t.params){const m=new URLSearchParams;for(const[f,r]of Object.entries(t.params))r!=null&&m.append(f,r);const i=m.toString();i&&(a=`${n}?${i}`);const{params:l,...c}=t;return $e(a,{...c,method:"GET"})}return $e(a,{...t,method:"GET"})}async function Xe(n,t,a={}){return $e(n,{...a,method:"POST",body:JSON.stringify(t)})}async function et(n,t,a={}){return $e(n,{...a,method:"PUT",body:JSON.stringify(t)})}async function tt(n,t={}){return $e(n,{...t,method:"DELETE"})}const J={get:Ze,post:Xe,put:et,delete:tt},K=_e("session",()=>{const n=L(new Map),t=L(null),a=L(new Map),m=L(new Map),i=L(new Set),l=L(!1);let c=null;const f=d(()=>n.value.get(t.value)),r=d(()=>Array.from(n.value.values()).sort((j,M)=>j.order-M.order)),v=j=>d(()=>r.value.filter(M=>M.project_id===j)),u=d({get:()=>a.value.get(t.value)||"",set:j=>{t.value&&a.value.set(t.value,j)}});async function b(){try{const j=await J.get("/api/sessions");return n.value.clear(),j.sessions.forEach(M=>{n.value.set(M.session_id,M)}),console.log(`Loaded ${n.value.size} sessions`),j.sessions}catch(j){throw console.error("Failed to fetch sessions:",j),j}}async function _(j,M){try{const k=(await J.post("/api/sessions",{project_id:j,...M})).session_id,C=(await J.get(`/api/sessions/${k}`)).session;return n.value.set(k,C),n.value=new Map(n.value),console.log(`Created session ${k}`),C}catch(P){throw console.error("Failed to create session:",P),P}}async function w(j){if(t.value===j&&!l.value)return;c&&(console.log(`Aborting pending selection to switch to ${j}`),c.abort(),c=null);const M=new AbortController;c=M,l.value=!0;try{if(t.value=j,M.signal.aborted){console.log(`Selection of ${j} aborted early`);return}let P=n.value.get(j);if(!P)try{const C=await J.get(`/api/sessions/${j}`);if(M.signal.aborted){console.log(`Selection of ${j} aborted after fetch`);return}P=C.session,n.value.set(j,P),n.value=new Map(n.value),console.log(`Fetched session ${j} for deeplink`)}catch(C){console.error(`Failed to fetch session ${j}:`,C);return}if(P&&(P.state==="created"||P.state==="terminated"))try{if(await N(j),M.signal.aborted){console.log(`Selection of ${j} aborted after start`);return}console.log(`Auto-started session ${j} (was in ${P.state} state)`);const C=6e4,E=200,O=5e3;let R=0,I=0;for(;R<C;){if(M.signal.aborted){console.log(`Selection of ${j} aborted during state wait`);return}const W=n.value.get(j);if(W&&W.state==="active"){console.log(`Session ${j} is now active after ${R}ms`);break}if(R-I>=O){const V=n.value.get(j)?.state||"unknown";console.log(`Waiting for session ${j} to become active (current: ${V}, ${R/1e3}s elapsed)`),I=R}await new Promise(V=>setTimeout(V,E)),R+=E}const A=n.value.get(j);A&&A.state!=="active"&&console.warn(`Session ${j} did not become active within ${C/1e3}s (state: ${A.state}), continuing anyway`)}catch(C){console.error(`Failed to auto-start session ${j}:`,C)}if(M.signal.aborted){console.log(`Selection of ${j} aborted before message load`);return}if(await(await ie(()=>Promise.resolve().then(()=>$t),void 0)).useMessageStore().loadMessages(j),M.signal.aborted){console.log(`Selection of ${j} aborted after message load`);return}await(await ie(()=>Promise.resolve().then(()=>Ft),void 0)).useWebSocketStore().connectSession(j),M.signal.aborted||console.log(`Selected session ${j}`)}finally{c===M&&(c=null),l.value=!1}}function T(j,M){const P=n.value.get(j);P?Object.assign(P,M):(n.value.set(j,M),console.log(`Added new session ${j} via WebSocket update`)),n.value=new Map(n.value)}async function $(j){i.value.add(j);try{await J.delete(`/api/sessions/${j}`),n.value.delete(j),a.value.delete(j),m.value.delete(j),n.value=new Map(n.value),t.value===j&&(t.value=null),console.log(`Deleted session ${j}`)}catch(M){throw console.error("Failed to delete session:",M),M}finally{i.value.delete(j)}}async function y(j,M){try{await J.put(`/api/sessions/${j}/name`,{name:M}),T(j,{name:M}),console.log(`Updated session ${j} name to "${M}"`)}catch(P){throw console.error("Failed to update session name:",P),P}}async function x(j,M){try{await J.post(`/api/sessions/${j}/permission-mode`,{mode:M}),T(j,{current_permission_mode:M});const P=m.value.get(j);P&&(P.permissionMode=M,m.value.set(j,P)),console.log(`Set permission mode for session ${j} to ${M}`)}catch(P){throw console.error("Failed to set permission mode:",P),P}}async function N(j){try{await J.post(`/api/sessions/${j}/start`),console.log(`Started session ${j}`)}catch(M){throw console.error("Failed to start session:",M),M}}async function S(j){try{await J.post(`/api/sessions/${j}/pause`),console.log(`Paused session ${j}`)}catch(M){throw console.error("Failed to pause session:",M),M}}async function g(j){try{await J.post(`/api/sessions/${j}/terminate`),console.log(`Terminated session ${j}`)}catch(M){throw console.error("Failed to terminate session:",M),M}}function q(j){return n.value.get(j)}function U(j,M){m.value.set(j,M),M.permissionMode&&T(j,{current_permission_mode:M.permissionMode})}return{sessions:n,currentSessionId:t,inputCache:a,initData:m,deletingSessions:i,currentSession:f,orderedSessions:r,sessionsInProject:v,currentInput:u,fetchSessions:b,createSession:_,selectSession:w,updateSession:T,deleteSession:$,updateSessionName:y,setPermissionMode:x,startSession:N,pauseSession:S,terminateSession:g,getSession:q,storeInitData:U}}),De=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:K},Symbol.toStringTag,{value:"Module"})),se=_e("ui",()=>{const n=L(window.innerWidth<768),t=L(300),a=L(window.innerWidth),m=d(()=>a.value<768),i=L(!0),l=L(null),c=L(null),f=d(()=>l.value?{name:l.value,data:c.value}:null),r=L(!1),v=L("Loading...");function u(){n.value=!n.value}function b(S){n.value=S}function _(S){t.value=Math.max(200,Math.min(S,window.innerWidth*.3))}function w(S){i.value=S}function T(S,g=null){l.value=null,c.value=null,setTimeout(()=>{l.value=S,c.value=g},0)}function $(){l.value=null,c.value=null}function y(S="Loading..."){r.value=!0,v.value=S}function x(){r.value=!1}function N(){const S=a.value;a.value=window.innerWidth,a.value<768&&S>=768?n.value=!0:a.value>=768&&S<768&&(n.value=!1)}return{sidebarCollapsed:n,sidebarWidth:t,isMobile:m,autoScrollEnabled:i,activeModal:l,modalData:c,currentModal:f,isLoading:r,loadingMessage:v,toggleSidebar:u,setSidebarCollapsed:b,setSidebarWidth:_,setAutoScroll:w,showModal:T,hideModal:$,showLoading:y,hideLoading:x,handleResize:N}}),ae=_e("project",()=>{const n=L(new Map),t=L(null),a=d(()=>n.value.get(t.value)),m=d(()=>Array.from(n.value.values()).sort(($,y)=>$.order-y.order)),i=$=>n.value.get($)?.is_multi_agent||!1;async function l(){try{const $=await J.get("/api/projects");return n.value.clear(),$.projects.forEach(y=>{n.value.set(y.project_id,y)}),console.log(`Loaded ${n.value.size} projects`),$.projects}catch($){throw console.error("Failed to fetch projects:",$),$}}async function c($,y,x=!1){try{const S=(await J.post("/api/projects",{name:$,working_directory:y,is_multi_agent:x})).project;return n.value.set(S.project_id,S),n.value=new Map(n.value),console.log(`Created project ${S.project_id}`),S}catch(N){throw console.error("Failed to create project:",N),N}}async function f($,y){try{await J.put(`/api/projects/${$}`,y),r($,y),console.log(`Updated project ${$}`,y)}catch(x){throw console.error("Failed to update project:",x),x}}function r($,y){const x=n.value.get($);x&&(Object.assign(x,y),n.value=new Map(n.value))}async function v($){try{await J.delete(`/api/projects/${$}`),n.value.delete($),n.value=new Map(n.value),t.value===$&&(t.value=null),console.log(`Deleted project ${$}`)}catch(y){throw console.error("Failed to delete project:",y),y}}async function u($){try{const y=await J.put(`/api/projects/${$}/toggle-expansion`),x=n.value.get($);return x&&(x.is_expanded=y.is_expanded,n.value=new Map(n.value)),y.is_expanded}catch(y){throw console.error("Failed to toggle expansion:",y),y}}async function b($){try{await J.put("/api/projects/reorder",{project_ids:$}),$.forEach((y,x)=>{const N=n.value.get(y);N&&(N.order=x)}),n.value=new Map(n.value),console.log("Reordered projects",$)}catch(y){throw console.error("Failed to reorder projects:",y),y}}async function _($,y){try{await J.put(`/api/projects/${$}/sessions/reorder`,{session_ids:y});const x=n.value.get($);x&&(x.session_ids=y,n.value=new Map(n.value)),console.log(`Reordered sessions in project ${$}`,y)}catch(x){throw console.error("Failed to reorder sessions:",x),x}}function w($){return n.value.get($)}function T($){if(!$)return"";const y=$.split(/[/\\]/).filter(x=>x);return y.length===0?"/":y.length===1?`/${y[0]}`:y.length===2?`/${y.join("/")}`:`.../${y.slice(-2).join("/")}`}return{projects:n,currentProjectId:t,currentProject:a,orderedProjects:m,isMultiAgent:i,fetchProjects:l,createProject:c,updateProject:f,updateProjectLocal:r,deleteProject:v,toggleExpansion:u,reorderProjects:b,reorderSessionsInProject:_,getProject:w,formatPath:T}}),B=(n,t)=>{const a=n.__vccOpts||n;for(const[m,i]of t)a[m]=i;return a},st={class:"session-header border-bottom p-3"},ot={class:"project-name"},nt=["title"],lt={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,a=K(),m=ae(),i=d(()=>a.sessions.get(t.sessionId)),l=d(()=>i.value?.name||t.sessionId),c=d(()=>{for(const r of m.projects.values())if(r.session_ids?.includes(t.sessionId))return r;return null}),f=d(()=>c.value?.name||"Unknown Project");return(r,v)=>(s(),o("div",st,[e("div",null,[e("div",ot,p(f.value),1),e("div",{class:"session-name",title:n.sessionId},p(l.value),9,nt)])]))}},at=B(lt,[["__scopeId","data-v-89e9c269"]]),it={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},rt=["title"],ct={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},dt={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,a=K(),m=d(()=>a.sessions.get(t.sessionId)),i=d(()=>m.value?m.value.state==="paused"&&m.value.is_processing?"pending-prompt":m.value.is_processing?"processing":m.value.state:"unknown"),l=d(()=>{const r=i.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[r]||"#d3d3d3"}),c=d(()=>{const r=i.value;return r==="starting"||r==="processing"||r==="pending-prompt"}),f=d(()=>{if(!m.value)return"No session selected";const r=i.value,v=r.charAt(0).toUpperCase()+r.slice(1).replace("-"," "),u=m.value.name||"Unnamed Session",b=m.value.is_minion&&m.value.role?` (${m.value.role})`:"";return`${u}${b}: ${v}`});return(r,v)=>(s(),o("div",it,[m.value?(s(),o("div",{key:0,class:H(["progress-bar",{"progress-bar-striped progress-bar-animated":c.value}]),style:me({width:"100%",backgroundColor:l.value}),title:f.value},null,14,rt)):(s(),o("div",ct))]))}},ut=B(dt,[["__scopeId","data-v-e8795bb7"]]),mt={class:"session-status-bar border-top p-2 bg-light"},pt={class:"d-flex justify-content-between align-items-center gap-2"},vt={class:"d-flex gap-2"},ft=["disabled"],gt={class:"mode-label"},_t=["disabled"],ht=["disabled"],bt={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,a=K(),m=se(),i=d(()=>a.sessions.get(t.sessionId)),l=d(()=>i.value?.current_permission_mode||"default"),c={default:"ðŸ”’",acceptEdits:"âœï¸",plan:"ðŸ“‹",bypassPermissions:"â˜¢ï¸"},f=d(()=>c[l.value]||"ðŸ”’"),r=d(()=>l.value),v=["default","acceptEdits","plan"],u=async()=>{if(!i.value)return;if(l.value==="bypassPermissions"){try{await a.setPermissionMode(t.sessionId,"default")}catch(x){console.error("Failed to cycle permission mode:",x)}return}const $=(v.indexOf(l.value)+1)%v.length,y=v[$];try{await a.setPermissionMode(t.sessionId,y)}catch(x){console.error("Failed to cycle permission mode:",x)}},b=()=>{m.showModal("session-info",{sessionId:t.sessionId})},_=()=>{m.showModal("manage-session",{session:i.value})},w=()=>{m.setAutoScroll(!m.autoScrollEnabled)};return(T,$)=>(s(),o("div",mt,[e("div",pt,[e("div",vt,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:u,disabled:!i.value},[G(p(f.value)+" ",1),e("span",gt,p(r.value),1)],8,ft),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:b,disabled:!i.value},[...$[0]||($[0]=[G(" â„¹ï¸ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,_t),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:_,disabled:!i.value},[...$[1]||($[1]=[G(" âš™ï¸ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,ht)]),e("div",null,[e("button",{class:H(["btn btn-sm",ke(m).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:w}," â¬‡ï¸ "+p(ke(m).autoScrollEnabled?"ON":"OFF"),3)])])]))}},yt=B(bt,[["__scopeId","data-v-fdcd3535"]]),ue=_e("message",()=>{const n=L(new Map),t=L(new Map),a=L(new Map),m=L(new Map),i=L(new Map),l=L(new Map),c=L(new Map),f=d(()=>{const C=K();return n.value.get(C.currentSessionId)||[]}),r=d(()=>{const C=K();return t.value.get(C.currentSessionId)||[]});async function v(C,E=null,O=0){try{const R=E||1e4,I=await J.get(`/api/sessions/${C}/messages?limit=${R}&offset=${O}`),A=I.messages||[],W=I.total_count||A.length,V=I.has_more||!1;if(console.log(`Loaded ${A.length} of ${W} messages for session ${C}`),n.value.set(C,A),A.length>0){const F=A[A.length-1];F.timestamp&&(c.value.set(C,F.timestamp),console.log(`Tracked last received timestamp for session ${C}: ${F.timestamp}`))}const z=new Set;A.forEach(F=>{F.type==="assistant"&&F.metadata?.tool_uses&&F.metadata.tool_uses.forEach(te=>{z.add(te.id)}),F.type==="user"&&F.metadata?.tool_results&&F.metadata.tool_results.forEach(te=>{z.delete(te.tool_use_id);const we=l.value.get(C);we&&we.delete(te.tool_use_id)}),F.type==="system"&&F.metadata?.subtype==="client_launched"&&(z.forEach(te=>{g(C,te,"Session was restarted")}),z.clear()),F.type==="system"&&F.metadata?.subtype==="interrupt"&&(z.forEach(te=>{g(C,te,"Session was interrupted")}),z.clear()),F.metadata?.has_tool_uses&&F.metadata.tool_uses&&F.metadata.tool_uses.forEach(te=>{T(C,te)}),F.metadata?.has_tool_results&&F.metadata.tool_results&&F.metadata.tool_results.forEach(te=>{x(C,te)}),(F.type==="permission_request"||F.metadata?.has_permission_requests)&&$(C,F),F.type==="system"&&(F.subtype==="init"||F.metadata?.subtype==="init")&&F.metadata?.init_data&&K().storeInitData(C,F.metadata.init_data)});const fe=K().sessions.get(C);return fe&&!["active","paused","starting"].includes(fe.state)&&(z.forEach(F=>{g(C,F,"Session was terminated")}),z.clear()),i.value.set(C,z),n.value=new Map(n.value),V&&console.warn(`Warning: Only loaded ${A.length} of ${W} messages. Some messages may be missing.`),{messages:A,totalCount:W,hasMore:V}}catch(R){throw console.error("Failed to load messages:",R),R}}function u(C,E){const O=i.value.get(C)||new Set;E.type==="assistant"&&E.metadata?.tool_uses&&E.metadata.tool_uses.forEach(R=>{O.add(R.id)}),E.type==="user"&&E.metadata?.tool_results&&E.metadata.tool_results.forEach(R=>{O.delete(R.tool_use_id);const I=l.value.get(C);I&&I.delete(R.tool_use_id)}),E.type==="system"&&E.metadata?.subtype==="client_launched"&&(O.forEach(R=>{g(C,R,"Session was restarted")}),O.clear()),E.type==="system"&&E.metadata?.subtype==="interrupt"&&(O.forEach(R=>{g(C,R,"Session was interrupted")}),O.clear()),i.value.set(C,O)}function b(C,E){n.value.has(C)||n.value.set(C,[]),n.value.get(C).push(E),E.timestamp&&c.value.set(C,E.timestamp),u(C,E),n.value=new Map(n.value)}function _(C,E){t.value.has(C)||t.value.set(C,[]),t.value.get(C).push(E),t.value=new Map(t.value)}function w(C,E,O){const R=t.value.get(C);if(R){const I=R.find(A=>A.id===E);I&&(Object.assign(I,O),t.value=new Map(t.value))}}function T(C,E){const O=S(E.name,E.input);a.value.set(O,E.id);const R={id:E.id,name:E.name,input:E.input,signature:O,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return _(C,R),console.log(`Created tool call ${R.id} for ${R.name}`),R}function $(C,E){console.log("handlePermissionRequest received:",E);const O=E.metadata?.tool_name||E.tool_name,R=E.metadata?.input_params||E.input_params,I=E.metadata?.request_id||E.request_id,A=E.metadata?.suggestions||E.suggestions||[];console.log("Extracted data:",{toolName:O,inputParams:R,requestId:I,suggestions:A});const W=S(O,R),V=a.value.get(W);V?(m.value.set(I,V),w(C,V,{status:"permission_required",permissionRequestId:I,suggestions:A}),console.log(`Permission required for tool ${V}`,{suggestions:A})):console.warn("No tool use ID found for permission request signature:",W,{toolName:O,inputParams:R,availableSignatures:Array.from(a.value.keys())})}function y(C,E){const O=m.value.get(E.request_id);if(O){const R={permissionDecision:E.decision,appliedUpdates:E.applied_updates||[]};E.decision==="allow"?R.status="executing":(R.status="completed",R.result={error:!0,message:E.reasoning||"Permission denied"},R.isExpanded=!1),w(C,O,R),console.log(`Permission ${E.decision} for tool ${O}`)}}function x(C,E){const O=E.tool_use_id;w(C,O,{status:E.is_error?"error":"completed",result:{error:E.is_error,content:E.content},isExpanded:!1}),console.log(`Tool ${O} ${E.is_error?"failed":"completed"}`)}function N(C,E){const O=t.value.get(C);if(O){const R=O.find(I=>I.id===E);R&&(R.isExpanded=!R.isExpanded,t.value=new Map(t.value))}}function S(C,E){if(!C)return"unknown:{}";if(!E||typeof E!="object")return`${C}:{}`;const O=JSON.stringify(E,Object.keys(E).sort());return`${C}:${O}`}function g(C,E,O){const R=l.value.get(C)||new Map;R.set(E,{reason:"denied",message:O}),l.value.set(C,R);const I=t.value.get(C);if(I){const A=I.find(W=>W.id===E);A&&A.isExpanded&&(A.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${E} as orphaned: ${O}`)}function q(C,E){return l.value.get(C)?.has(E)||!1}function U(C,E){return l.value.get(C)?.get(E)}function j(C,E){const O=i.value.get(C);O&&O.size>0&&(O.forEach(R=>g(C,R,E)),O.clear())}function M(C){n.value.delete(C),t.value.delete(C),n.value=new Map(n.value),t.value=new Map(t.value)}function P(C){return c.value.get(C)}async function k(C){const E=c.value.get(C);if(!E)return console.log(`No sync needed for session ${C} (no previous messages)`),{syncedCount:0,hasMore:!1};try{console.log(`Syncing messages for session ${C} since ${E}`);const O=await J.get(`/api/sessions/${C}/messages?limit=1000&offset=0`),R=O.messages||[],I=O.has_more||!1,A=new Date(E).getTime(),W=R.filter(F=>F.timestamp?new Date(F.timestamp).getTime()>A:!1);if(W.length===0)return console.log(`No missed messages for session ${C}`),{syncedCount:0,hasMore:!1};console.log(`Synced ${W.length} missed messages for session ${C}`);const V=n.value.get(C)||[],z=new Set(V.map(F=>F.id).filter(Boolean)),oe=W.filter(F=>!F.id||!z.has(F.id));console.log(`After deduplication: ${oe.length} unique new messages`);const fe=[...V,...oe].sort((F,te)=>{const we=new Date(F.timestamp||0).getTime(),We=new Date(te.timestamp||0).getTime();return we-We});if(n.value.set(C,fe),oe.forEach(F=>{u(C,F),F.metadata?.has_tool_uses&&F.metadata.tool_uses&&F.metadata.tool_uses.forEach(te=>{T(C,te)}),F.metadata?.has_tool_results&&F.metadata.tool_results&&F.metadata.tool_results.forEach(te=>{x(C,te)}),(F.type==="permission_request"||F.metadata?.has_permission_requests)&&$(C,F),F.type==="system"&&(F.subtype==="init"||F.metadata?.subtype==="init")&&F.metadata?.init_data&&K().storeInitData(C,F.metadata.init_data)}),fe.length>0){const F=fe[fe.length-1];F.timestamp&&c.value.set(C,F.timestamp)}return n.value=new Map(n.value),{syncedCount:oe.length,hasMore:I}}catch(O){return console.error(`Failed to sync messages for session ${C}:`,O),{syncedCount:0,hasMore:!1,error:O.message}}}const h=K();return ee(()=>Array.from(h.sessions.values()).map(E=>({id:E.session_id,state:E.state})),(C,E)=>{E&&C.forEach((O,R)=>{const I=E[R];if(!I||I.id!==O.id)return;const A=["active","paused","starting"].includes(I.state),W=!["active","paused","starting"].includes(O.state);A&&W&&j(O.id,"Session was terminated")})},{deep:!0}),{messagesBySession:n,toolCallsBySession:t,activeToolUses:Pe(i),orphanedToolUses:Pe(l),currentMessages:f,currentToolCalls:r,loadMessages:v,addMessage:b,addToolCall:_,updateToolCall:w,handleToolUse:T,handlePermissionRequest:$,handlePermissionResponse:y,handleToolResult:x,toggleToolExpansion:N,clearMessages:M,markToolUseOrphaned:g,isToolUseOrphaned:q,getOrphanedInfo:U,clearOrphanedToolUses:j,getLastReceivedTimestamp:P,syncMessages:k}}),$t=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:ue},Symbol.toStringTag,{value:"Module"}));function wt(n){if(!n)return new Date;if(typeof n=="string"){const t=new Date(n);return isNaN(t.getTime())?new Date:t}return typeof n=="number"?n<1e10?new Date(n*1e3):new Date(n):new Date}function Ce(n){return wt(n).toLocaleTimeString()}const kt={class:"message-row message-row-user"},St=["title"],Ct={class:"message-content-column"},xt=["innerHTML"],Mt={key:0,class:"tool-results mt-2"},jt={class:"tool-results-header text-muted small mb-2"},Tt={class:"d-flex align-items-start gap-2"},Et={class:"flex-grow-1"},Lt={class:"text-muted"},Pt={key:0,class:"text-danger small"},It={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n;ye.setOptions({breaks:!0,gfm:!0});const a=d(()=>Ce(t.message.timestamp)),m=d(()=>`user
${a.value}`),i=d(()=>{const r=t.message.content||"";let v=ye.parse(r);return v=v.replace(/\n</g,"<"),v=v.replace(/\n+$/,""),Ee.sanitize(v)}),l=d(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),c=d(()=>t.message.metadata?.tool_results||[]);function f(r,v){return r?r.length<=v?r:r.substring(0,v)+"...":""}return(r,v)=>(s(),o("div",kt,[e("div",{class:"message-speaker",title:m.value},[...v[0]||(v[0]=[e("span",{class:"speaker-label"},"user",-1)])],8,St),e("div",Ct,[e("div",{class:"message-text",innerHTML:i.value},null,8,xt),l.value?(s(),o("div",Mt,[e("div",jt,[v[1]||(v[1]=e("i",{class:"bi bi-tools"},null,-1)),G(" Tool Results ("+p(c.value.length)+") ",1)]),(s(!0),o(Y,null,Z(c.value,(u,b)=>(s(),o("div",{key:b,class:H(["tool-result-summary p-2 mb-2 rounded",u.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",Tt,[e("span",null,p(u.is_error?"âŒ":"âœ…"),1),e("div",Et,[e("small",Lt,"Tool: "+p(u.tool_use_id),1),u.is_error?(s(),o("div",Pt,p(f(u.content,200)),1)):D("",!0)])])],2))),128))])):D("",!0)])]))}},Dt=B(It,[["__scopeId","data-v-09875214"]]),Nt={class:"thinking-block"},Ot={class:"text-muted ms-auto"},At={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},Rt=["innerHTML"],Ut={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(n){const t=n,a=L(!1),m=d(()=>t.thinking?.length||0),i=d(()=>{const c=t.thinking||"",f=ye.parse(c);return Ee.sanitize(f)});function l(){a.value=!a.value}return(c,f)=>(s(),o("div",Nt,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:l},[e("i",{class:H(["bi",a.value?"bi-chevron-down":"bi-chevron-right"])},null,2),f[0]||(f[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),G(" Thinking ")],-1)),e("small",Ot,p(m.value)+" characters",1)]),a.value?(s(),o("div",At,[e("div",{class:"thinking-text",innerHTML:i.value},null,8,Rt)])):D("",!0)]))}},qt=B(Ut,[["__scopeId","data-v-619a8344"]]),ve=_e("websocket",()=>{const n=L(null),t=L(!1),a=L(0),m=10,i=L(null),l=L(!1),c=L(0),f=5,r=L(null);let v=null;const u=L(0),b=L(null),_=L(new Map),w=L(null),T=L(!1),$=L(0),y=5,x=L(null),N=d(()=>t.value&&(l.value||!r.value)?"connected":t.value?"partial":"disconnected");function S(I){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${I}`}function g(){if(n.value)return;const I=S("/ws/ui");console.log(`Connecting to UI WebSocket: ${I}`),n.value=new WebSocket(I),n.value.onopen=()=>{t.value=!0,a.value=0,console.log("UI WebSocket connected")},n.value.onmessage=A=>{const W=JSON.parse(A.data);h(W)},n.value.onclose=()=>{if(t.value=!1,n.value=null,console.log("UI WebSocket closed"),a.value<m){a.value++;const A=Math.min(2e3*a.value,3e4);console.log(`Reconnecting UI WebSocket in ${A}ms (attempt ${a.value})`),setTimeout(g,A)}},n.value.onerror=A=>{console.error("UI WebSocket error:",A)}}function q(){n.value&&(n.value.close(),n.value=null,t.value=!1)}async function U(I){u.value++;const A=u.value;if(console.log(`[Gen ${A}] Starting connection to session ${I}`),v&&(clearTimeout(v),v=null),await j(),u.value!==A){console.log(`[Gen ${A}] Connection cancelled (current generation: ${u.value})`);return}r.value=I,b.value=A;const W=S(`/ws/session/${I}`);console.log(`[Gen ${A}] Connecting to Session WebSocket: ${W}`),i.value=new WebSocket(W),i.value.onopen=async()=>{if(b.value!==A){console.log(`[Gen ${A}] Ignoring onopen (stale connection, current: ${b.value})`),i.value.close();return}l.value=!0,c.value=0,console.log(`[Gen ${A}] Session WebSocket connected for ${I}`);const V=_.value.get(I);if(_.value.set(I,!0),V){console.log(`[Gen ${A}] Reconnection detected, syncing missed messages...`);try{const oe=await ue().syncMessages(I);oe.syncedCount>0?console.log(`[Gen ${A}] âœ… Synced ${oe.syncedCount} missed messages`):oe.error?console.warn(`[Gen ${A}] âš ï¸ Message sync failed: ${oe.error}`):console.log(`[Gen ${A}] No missed messages to sync`),oe.hasMore&&console.warn(`[Gen ${A}] âš ï¸ More than 1000 missed messages, showing recent 1000 only`)}catch(z){console.error(`[Gen ${A}] Error during message sync:`,z)}}else console.log(`[Gen ${A}] Initial connection, no sync needed`)},i.value.onmessage=V=>{if(b.value!==A){console.log(`[Gen ${A}] Ignoring message (stale connection, current: ${b.value})`);return}const z=JSON.parse(V.data);C(z,I)},i.value.onclose=()=>{l.value=!1,i.value=null,console.log(`[Gen ${A}] Session WebSocket closed for ${I}`);const V=K();if(V.currentSessionId===I&&b.value===A&&c.value<f){c.value++;const z=Math.min(2e3*c.value,3e4);console.log(`[Gen ${A}] Reconnecting Session WebSocket in ${z}ms (attempt ${c.value})`),v=setTimeout(()=>{b.value===A&&V.currentSessionId===I?(v=null,U(I)):console.log(`[Gen ${A}] Skipping reconnect (generation or session changed)`)},z)}},i.value.onerror=V=>{console.error(`[Gen ${A}] Session WebSocket error:`,V)}}function j(){return new Promise(I=>{if(v&&(clearTimeout(v),v=null,console.log("Cancelled pending session reconnect timer")),i.value){const A=r.value,W=()=>{i.value=null,l.value=!1,r.value=null,b.value=null,c.value=0,A&&_.value.delete(A),I()};if(i.value.readyState===WebSocket.CLOSED)W();else{const V=setTimeout(()=>{console.warn("Session WebSocket close timeout - forcing cleanup"),W()},2e3);i.value.addEventListener("close",()=>{clearTimeout(V),W()},{once:!0}),i.value.close()}}else r.value=null,b.value=null,I()})}function M(I){i.value&&l.value?(i.value.send(JSON.stringify({type:"send_message",content:I})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function P(I,A,W=!1,V=null){if(i.value&&l.value){const z={type:"permission_response",request_id:I,decision:A,apply_suggestions:W,timestamp:new Date().toISOString()};V&&(z.clarification_message=V),i.value.send(JSON.stringify(z)),console.log(`Sent permission ${A} for request ${I}`,{applySuggestions:W,clarification:V})}}function k(){i.value&&l.value&&(i.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function h(I){const A=K(),W=ae();switch(I.type){case"sessions_list":I.sessions&&Array.isArray(I.sessions)&&I.sessions.forEach(V=>{A.updateSession(V.session_id,V)});break;case"state_change":I.data&&I.data.session_id&&I.data.session&&A.updateSession(I.data.session_id,I.data.session);break;case"project_updated":if(I.data&&I.data.project){const V=I.data.project;W.updateProjectLocal(V.project_id,V)}break;case"project_deleted":I.data&&I.data.project_id&&W.projects.delete(I.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":n.value?.readyState===WebSocket.OPEN&&n.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",I.type)}}function C(I,A){const W=K();if(W.currentSessionId!==A){console.warn(`Ignoring message for session ${A} (current: ${W.currentSessionId})`);return}const V=ue();switch(I.type){case"message":const z=I.data;if(!z||!z.type){console.warn("Received message event with invalid data:",I);break}if(z.type==="permission_request"){V.handlePermissionRequest(A,z);break}if(z.type==="permission_response"){V.handlePermissionResponse(A,z);break}z.metadata?.has_tool_uses&&z.metadata.tool_uses.forEach(oe=>{V.handleToolUse(A,oe)}),z.metadata?.has_tool_results&&z.metadata.tool_results.forEach(oe=>{V.handleToolResult(A,oe)}),z.type==="system"&&(z.subtype==="init"||z.metadata?.subtype==="init")&&z.metadata?.init_data&&W.storeInitData(A,z.metadata.init_data),V.addMessage(A,z);break;case"permission_request":V.handlePermissionRequest(A,I);break;case"permission_response":V.handlePermissionResponse(A,I);break;case"tool_result":V.handleToolResult(A,I);break;case"state_change":W.updateSession(A,I.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${A}`);break;case"ping":i.value?.readyState===WebSocket.OPEN&&i.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function E(I){O(),x.value=I;const A=S(`/ws/legion/${I}`);console.log(`Connecting to Legion WebSocket: ${A}`),w.value=new WebSocket(A),w.value.onopen=()=>{T.value=!0,$.value=0,console.log(`Legion WebSocket connected for ${I}`)},w.value.onmessage=W=>{const V=JSON.parse(W.data);R(V,I)},w.value.onclose=()=>{if(T.value=!1,w.value=null,console.log(`Legion WebSocket closed for ${I}`),x.value===I&&$.value<y){$.value++;const W=Math.min(2e3*$.value,3e4);setTimeout(()=>E(I),W)}},w.value.onerror=W=>{console.error("Legion WebSocket error:",W)}}function O(){w.value&&(w.value.close(),w.value=null,T.value=!1,x.value=null)}function R(I,A){ie(async()=>{const{useLegionStore:W}=await Promise.resolve().then(()=>Ka);return{useLegionStore:W}},void 0).then(({useLegionStore:W})=>{const V=W();switch(I.type){case"comm":I.comm&&(V.addComm(A,I.comm),console.log("Legion WebSocket: Received new comm",I.comm));break;case"minion_created":I.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",I.data),ie(async()=>{const{useSessionStore:z}=await Promise.resolve().then(()=>De);return{useSessionStore:z}},void 0).then(({useSessionStore:z})=>{z().loadSessions()}));break;case"minion_updated":I.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",I.data),ie(async()=>{const{useSessionStore:z}=await Promise.resolve().then(()=>De);return{useSessionStore:z}},void 0).then(({useSessionStore:z})=>{z().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${A}`);break;case"ping":w.value?.readyState===WebSocket.OPEN&&w.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",I.type)}})}return{uiConnected:t,sessionConnected:l,legionConnected:T,overallStatus:N,connectUI:g,disconnectUI:q,connectSession:U,disconnectSession:j,sendMessage:M,sendPermissionResponse:P,interruptSession:k,connectLegion:E,disconnectLegion:O}}),Ft=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:ve},Symbol.toStringTag,{value:"Module"})),Wt={class:"base-tool-handler"},Ht={class:"tool-section"},Bt={class:"tool-parameters"},Vt={class:"tool-code"},zt={key:0,class:"tool-section"},Gt={class:"tool-section-label"},Jt={class:"tool-code"},Kt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),m=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),i=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),l=d(()=>{if(!m.value)return"";const c=t.toolCall.result;return c.content!==void 0?typeof c.content=="string"?c.content:JSON.stringify(c.content,null,2):c.message?c.message:JSON.stringify(c,null,2)});return(c,f)=>(s(),o("div",Wt,[e("div",Ht,[f[0]||(f[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Bt,[e("pre",Vt,p(a.value),1)])]),m.value?(s(),o("div",zt,[e("div",Gt,p(i.value?"Error:":"Result:"),1),e("div",{class:H(["tool-result",{"tool-result-error":i.value}])},[e("pre",Jt,p(l.value),1)],2)])):D("",!0)]))}},Yt=B(Kt,[["__scopeId","data-v-1e69f57d"]]),Qt={class:"read-tool-handler"},Zt={class:"tool-section"},Xt={class:"read-file-info"},es={class:"file-path"},ts={key:0,class:"read-range"},ss={key:0,class:"tool-section"},os={key:0,class:"tool-result tool-result-error"},ns={class:"tool-code"},ls={key:1,class:"file-content-preview"},as={class:"content-header"},is={class:"line-count-badge"},rs={key:0,class:"preview-note"},cs={class:"tool-code content-display"},ds={key:0,class:"more-indicator"},Me=100,us={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.file_path||"Unknown"),m=d(()=>{const w=t.toolCall.input?.offset,T=t.toolCall.input?.limit;return w!==void 0||T!==void 0}),i=d(()=>{const w=t.toolCall.input?.offset;return w!==void 0?w+1:1}),l=d(()=>{const w=t.toolCall.input?.offset||0,T=t.toolCall.input?.limit;return T!==void 0?w+T:"âˆž"}),c=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),f=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),r=d(()=>{if(!c.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)}),v=d(()=>f.value||!r.value?[]:r.value.split(`
`)),u=d(()=>v.value.length),b=d(()=>u.value>Me),_=d(()=>f.value?"":v.value.slice(0,Me).join(`
`));return(w,T)=>(s(),o("div",Qt,[e("div",Zt,[e("div",Xt,[T[0]||(T[0]=e("span",{class:"file-icon"},"ðŸ“„",-1)),T[1]||(T[1]=e("strong",null,"Reading:",-1)),e("code",es,p(a.value),1),m.value?(s(),o("span",ts,"Lines "+p(i.value)+"-"+p(l.value),1)):D("",!0)])]),c.value?(s(),o("div",ss,[f.value?(s(),o("div",os,[e("pre",ns,p(r.value),1)])):(s(),o("div",ls,[e("div",as,[T[2]||(T[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",is,p(u.value)+" lines",1),b.value?(s(),o("span",rs,"(showing first "+p(Me)+")")):D("",!0)]),e("pre",cs,p(_.value),1),b.value?(s(),o("div",ds,"...")):D("",!0)]))])):D("",!0)]))}},ms=B(us,[["__scopeId","data-v-1f2b0569"]]),ps={class:"write-tool-handler"},vs={class:"tool-section"},fs={class:"write-file-info mb-2"},gs={class:"file-path"},_s={class:"write-content-preview"},hs={class:"content-header"},bs={class:"line-count-badge"},ys={key:0,class:"preview-note"},$s={class:"tool-code content-display"},ws={key:0,class:"more-indicator"},ks={key:0,class:"tool-section"},Ss={key:0,class:"tool-result tool-result-error"},Cs={class:"tool-code"},xs={key:1,class:"tool-result tool-result-success"},Ms={class:"success-message"},je=100,js={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.file_path||"Unknown"),m=d(()=>t.toolCall.input?.content||""),i=d(()=>m.value.split(`
`)),l=d(()=>i.value.length),c=d(()=>l.value>je),f=d(()=>i.value.slice(0,je).join(`
`)),r=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),u=d(()=>{if(!r.value)return"";const b=t.toolCall.result;return b.content!==void 0?typeof b.content=="string"?b.content:JSON.stringify(b.content,null,2):b.message?b.message:JSON.stringify(b,null,2)});return(b,_)=>(s(),o("div",ps,[e("div",vs,[e("div",fs,[_[0]||(_[0]=e("span",{class:"file-icon"},"ðŸ“",-1)),_[1]||(_[1]=e("strong",null,"Writing:",-1)),e("code",gs,p(a.value),1)]),e("div",_s,[e("div",hs,[_[2]||(_[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",bs,p(l.value)+" lines",1),c.value?(s(),o("span",ys,"(showing first "+p(je)+")")):D("",!0)]),e("pre",$s,p(f.value),1),c.value?(s(),o("div",ws,"...")):D("",!0)])]),r.value?(s(),o("div",ks,[v.value?(s(),o("div",Ss,[_[3]||(_[3]=e("strong",null,"Error:",-1)),e("pre",Cs,p(u.value),1)])):(s(),o("div",xs,[e("div",Ms,[_[4]||(_[4]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"File created successfully ("+p(l.value)+" lines written)",1)])]))])):D("",!0)]))}},Ts=B(js,[["__scopeId","data-v-ddc24a0f"]]),Es={class:"bash-tool-handler"},Ls={class:"tool-section"},Ps={class:"bash-header"},Is={class:"bash-header-content"},Ds={key:0,class:"bash-description"},Ns={key:1,class:"bash-flags"},Os={class:"bash-command-section"},As={class:"bash-command-content"},Rs={key:0,class:"tool-section"},Us={key:0,class:"bash-output"},qs={key:1,class:"bash-output-empty"},Fs={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.command||""),m=d(()=>t.toolCall.input?.description||""),i=d(()=>t.toolCall.input?.timeout),l=d(()=>t.toolCall.input?.run_in_background||!1),c=d(()=>i.value||l.value),f=d(()=>{const _=[];return i.value&&_.push(`timeout: ${i.value}ms`),l.value&&_.push("background"),_.join(", ")}),r=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),u=d(()=>v.value?"tool-result-error":"tool-result-success"),b=d(()=>{if(!r.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)});return(_,w)=>(s(),o("div",Es,[e("div",Ls,[e("div",Ps,[w[1]||(w[1]=e("span",{class:"bash-icon"},"ðŸ’»",-1)),e("div",Is,[m.value?(s(),o("div",Ds,[w[0]||(w[0]=e("strong",null,"Description:",-1)),G(" "+p(m.value),1)])):D("",!0),c.value?(s(),o("div",Ns,p(f.value),1)):D("",!0)])]),e("div",Os,[w[2]||(w[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",As,p(a.value),1)])]),r.value?(s(),o("div",Rs,[e("div",{class:H(["tool-result",u.value])},[w[3]||(w[3]=e("strong",null,"Output:",-1)),b.value?(s(),o("pre",Us,p(b.value),1)):(s(),o("div",qs,"No output"))],2)])):D("",!0)]))}},Ws=B(Fs,[["__scopeId","data-v-ab50fe73"]]),Hs={class:"todo-tool-handler"},Bs={class:"tool-section"},Vs={class:"todo-header"},zs={class:"todo-summary"},Gs={key:0,class:"todo-count todo-count-completed"},Js={key:1,class:"todo-count todo-count-in-progress"},Ks={key:2,class:"todo-count todo-count-pending"},Ys={class:"todo-checklist"},Qs={class:"todo-checkbox"},Zs={class:"todo-content"},Xs={key:0,class:"tool-section"},eo={key:0,class:"tool-result tool-result-error"},to={class:"tool-code"},so={key:1,class:"tool-result tool-result-success"},oo={class:"success-message"},no={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.todos||[]),m=d(()=>a.value.filter(u=>u.status==="completed").length),i=d(()=>a.value.filter(u=>u.status==="in_progress").length),l=d(()=>a.value.filter(u=>u.status==="pending").length);function c(u){return{pending:"â˜",in_progress:"â—",completed:"â˜‘"}[u]||"â˜"}const f=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),r=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),v=d(()=>{if(!f.value)return"";const u=t.toolCall.result;return u.content!==void 0?typeof u.content=="string"?u.content:JSON.stringify(u.content,null,2):u.message?u.message:JSON.stringify(u,null,2)});return(u,b)=>(s(),o("div",Hs,[e("div",Bs,[e("div",Vs,[b[0]||(b[0]=e("span",{class:"todo-icon"},"ðŸ“‹",-1)),b[1]||(b[1]=e("strong",null,"Task List:",-1)),e("div",zs,[m.value>0?(s(),o("span",Gs,p(m.value)+" completed ",1)):D("",!0),i.value>0?(s(),o("span",Js,p(i.value)+" in progress ",1)):D("",!0),l.value>0?(s(),o("span",Ks,p(l.value)+" pending ",1)):D("",!0)])]),e("div",Ys,[(s(!0),o(Y,null,Z(a.value,(_,w)=>(s(),o("div",{key:w,class:H(["todo-item",`todo-${_.status}`])},[e("span",Qs,p(c(_.status)),1),e("span",Zs,p(_.content),1)],2))),128))])]),f.value?(s(),o("div",Xs,[r.value?(s(),o("div",eo,[b[2]||(b[2]=e("strong",null,"Error:",-1)),e("pre",to,p(v.value),1)])):(s(),o("div",so,[e("div",oo,[b[3]||(b[3]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"Task list updated ("+p(a.value.length)+" tasks)",1)])]))])):D("",!0)]))}},lo=B(no,[["__scopeId","data-v-bbe55ee7"]]),ao={class:"edit-tool-handler"},io={class:"tool-section"},ro={class:"edit-file-info"},co={class:"file-path"},uo={key:0,class:"replace-all-badge"},mo={class:"edit-diff-container"},po={class:"diff-header"},vo={class:"diff-stats"},fo={class:"stat-removed"},go={class:"stat-added"},_o={class:"unified-diff"},ho={class:"diff-scroll-container"},bo={class:"diff-marker"},yo={class:"diff-content"},$o={key:0,class:"tool-section"},wo={key:0,class:"tool-result tool-result-error"},ko={class:"tool-code"},So={key:1,class:"tool-result tool-result-success"},Co={class:"success-message"},xo={key:0,class:"success-detail"},Mo={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.file_path||"Unknown"),m=d(()=>t.toolCall.input?.old_string||""),i=d(()=>t.toolCall.input?.new_string||""),l=d(()=>t.toolCall.input?.replace_all||!1),c=d(()=>{const w=Ge(a.value,m.value,i.value,"","",{context:3}).split(`
`),T=[];for(let $=4;$<w.length;$++){const y=w[$];y&&(y.startsWith("-")?T.push({type:"removed",content:y.substring(1)}):y.startsWith("+")?T.push({type:"added",content:y.substring(1)}):y.startsWith(" ")?T.push({type:"context",content:y.substring(1)}):y.startsWith("@@")&&T.push({type:"hunk",content:y}))}return T}),f=d(()=>c.value.filter(_=>_.type==="removed").length),r=d(()=>c.value.filter(_=>_.type==="added").length),v=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),u=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),b=d(()=>{if(!v.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)});return(_,w)=>(s(),o("div",ao,[e("div",io,[e("div",ro,[w[0]||(w[0]=e("span",{class:"file-icon"},"âœï¸",-1)),w[1]||(w[1]=e("strong",null,"Editing:",-1)),e("code",co,p(a.value),1),l.value?(s(),o("span",uo,"Replace All")):D("",!0)]),e("div",mo,[e("div",po,[w[2]||(w[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",vo,[e("span",fo,"-"+p(f.value),1),e("span",go,"+"+p(r.value),1)])]),e("div",_o,[e("div",ho,[(s(!0),o(Y,null,Z(c.value,(T,$)=>(s(),o("div",{key:$,class:H(["diff-line",{"diff-line-removed":T.type==="removed","diff-line-added":T.type==="added","diff-line-context":T.type==="context","diff-line-hunk":T.type==="hunk"}])},[e("span",bo,p(T.type==="removed"?"-":T.type==="added"?"+":T.type==="hunk"?"@":" "),1),e("span",yo,p(T.content),1)],2))),128))])])])]),v.value?(s(),o("div",$o,[u.value?(s(),o("div",wo,[w[3]||(w[3]=e("strong",null,"Error:",-1)),e("pre",ko,p(b.value),1)])):(s(),o("div",So,[e("div",Co,[w[4]||(w[4]=e("span",{class:"success-icon"},"âœ…",-1)),w[5]||(w[5]=e("strong",null,"File edited successfully",-1)),l.value?(s(),o("span",xo,"(all occurrences replaced)")):D("",!0)])]))])):D("",!0)]))}},jo=B(Mo,[["__scopeId","data-v-16b90adc"]]),To={class:"search-tool-handler"},Eo={class:"tool-section"},Lo={class:"search-info"},Po={class:"search-icon"},Io={class:"search-pattern"},Do={key:0,class:"search-path"},No={key:1,class:"search-filters"},Oo={key:0,class:"filter-badge"},Ao={key:1,class:"filter-badge"},Ro={key:2,class:"filter-badge"},Uo={key:0,class:"tool-section"},qo={key:0,class:"tool-result tool-result-error"},Fo={class:"tool-code"},Wo={key:1,class:"search-results"},Ho={class:"results-header"},Bo={class:"results-label"},Vo={class:"results-count-badge"},zo={class:"results-content"},Go={class:"tool-code"},Jo={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.name==="Grep");d(()=>t.toolCall.name==="Glob");const m=d(()=>t.toolCall.input?.pattern||"Unknown"),i=d(()=>t.toolCall.input?.path||null),l=d(()=>t.toolCall.input?.type||null),c=d(()=>t.toolCall.input?.glob||null),f=d(()=>t.toolCall.input?.["-i"]||!1),r=d(()=>l.value||c.value||f.value),v=d(()=>a.value?"ðŸ”":"ðŸ“"),u=d(()=>a.value?"Searching content":"Finding files"),b=d(()=>a.value?"Matches":"Files found"),_=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),w=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),T=d(()=>{if(!_.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)}),$=d(()=>!_.value||w.value||!T.value?0:T.value.split(`
`).filter(x=>x.trim()).length);return(y,x)=>(s(),o("div",To,[e("div",Eo,[e("div",Lo,[e("span",Po,p(v.value),1),e("strong",null,p(u.value)+":",1),e("code",Io,p(m.value),1),i.value?(s(),o("span",Do,"in "+p(i.value),1)):D("",!0),r.value?(s(),o("span",No,[l.value?(s(),o("span",Oo,"type: "+p(l.value),1)):D("",!0),c.value?(s(),o("span",Ao,"glob: "+p(c.value),1)):D("",!0),f.value?(s(),o("span",Ro,"case-insensitive")):D("",!0)])):D("",!0)])]),_.value?(s(),o("div",Uo,[w.value?(s(),o("div",qo,[x[0]||(x[0]=e("strong",null,"Error:",-1)),e("pre",Fo,p(T.value),1)])):(s(),o("div",Wo,[e("div",Ho,[e("span",Bo,p(b.value)+":",1),e("span",Vo,p($.value)+" "+p($.value===1?"match":"matches"),1)]),e("div",zo,[e("pre",Go,p(T.value),1)])]))])):D("",!0)]))}},Ne=B(Jo,[["__scopeId","data-v-0d272c39"]]),Ko={class:"web-tool-handler"},Yo={class:"tool-section"},Qo={class:"web-info"},Zo={class:"web-icon"},Xo=["href"],en={key:1,class:"web-query"},tn={key:0,class:"web-prompt-container"},sn={class:"prompt-content"},on={key:1,class:"web-domains"},nn={class:"domains-label"},ln={key:0,class:"tool-section"},an={key:0,class:"tool-result tool-result-error"},rn={class:"tool-code"},cn={key:1,class:"web-results"},dn={class:"results-header"},un={class:"results-label"},mn={class:"results-content"},pn={class:"tool-code"},vn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.name==="WebFetch");d(()=>t.toolCall.name==="WebSearch");const m=d(()=>t.toolCall.input?.url||null),i=d(()=>t.toolCall.input?.query||null),l=d(()=>t.toolCall.input?.prompt||null),c=d(()=>t.toolCall.input?.allowed_domains||[]),f=d(()=>t.toolCall.input?.blocked_domains||[]),r=d(()=>c.value.length>0?c.value:f.value.length>0?f.value:[]),v=d(()=>c.value.length>0?"Allowed domains":f.value.length>0?"Blocked domains":"Domains"),u=d(()=>a.value?"ðŸŒ":"ðŸ”Ž"),b=d(()=>a.value?"Fetching URL":"Searching web"),_=d(()=>a.value?"Fetched content":"Search results"),w=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),T=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),$=d(()=>{if(!w.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)});return(y,x)=>(s(),o("div",Ko,[e("div",Yo,[e("div",Qo,[e("span",Zo,p(u.value),1),e("strong",null,p(b.value)+":",1),m.value?(s(),o("a",{key:0,href:m.value,target:"_blank",class:"web-url"},p(m.value),9,Xo)):i.value?(s(),o("code",en,p(i.value),1)):D("",!0)]),l.value?(s(),o("div",tn,[x[0]||(x[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",sn,p(l.value),1)])):D("",!0),r.value.length>0?(s(),o("div",on,[e("span",nn,p(v.value)+":",1),(s(!0),o(Y,null,Z(r.value,N=>(s(),o("span",{key:N,class:"domain-badge"},p(N),1))),128))])):D("",!0)]),w.value?(s(),o("div",ln,[T.value?(s(),o("div",an,[x[1]||(x[1]=e("strong",null,"Error:",-1)),e("pre",rn,p($.value),1)])):(s(),o("div",cn,[e("div",dn,[e("span",un,p(_.value)+":",1)]),e("div",mn,[e("pre",pn,p($.value),1)])]))])):D("",!0)]))}},Oe=B(vn,[["__scopeId","data-v-62b55b55"]]),fn={class:"task-tool-handler"},gn={class:"tool-section"},_n={class:"task-header"},hn={key:0,class:"agent-type-badge"},bn={key:0,class:"task-description"},yn={class:"description-content"},$n={key:1,class:"task-prompt-container"},wn={class:"prompt-header"},kn={class:"prompt-length"},Sn={class:"prompt-code"},Cn={key:0,class:"tool-section"},xn={key:0,class:"tool-result tool-result-error"},Mn={class:"tool-code"},jn={key:1,class:"agent-output"},Tn={class:"output-header"},En={key:0,class:"output-count-badge"},Ln={class:"output-content"},Pn={class:"tool-code"},In={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.description||null),m=d(()=>t.toolCall.input?.prompt||null),i=d(()=>t.toolCall.input?.subagent_type||null),l=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),c=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),f=d(()=>{if(!l.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)}),r=d(()=>f.value?f.value.split(`
`).length:0);return(v,u)=>(s(),o("div",fn,[e("div",gn,[e("div",_n,[u[0]||(u[0]=e("span",{class:"task-icon"},"ðŸ¤–",-1)),u[1]||(u[1]=e("strong",null,"Agent Task:",-1)),i.value?(s(),o("span",hn,p(i.value),1)):D("",!0)]),a.value?(s(),o("div",bn,[u[2]||(u[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",yn,p(a.value),1)])):D("",!0),m.value?(s(),o("div",$n,[e("div",wn,[u[3]||(u[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",kn,p(m.value.length)+" characters",1)]),e("pre",Sn,p(m.value),1)])):D("",!0)]),l.value?(s(),o("div",Cn,[c.value?(s(),o("div",xn,[u[4]||(u[4]=e("strong",null,"Error:",-1)),e("pre",Mn,p(f.value),1)])):(s(),o("div",jn,[e("div",Tn,[u[5]||(u[5]=e("span",{class:"output-label"},"Agent Output:",-1)),r.value>0?(s(),o("span",En,p(r.value)+" lines",1)):D("",!0)]),e("div",Ln,[e("pre",Pn,p(f.value),1)])]))])):D("",!0)]))}},Dn=B(In,[["__scopeId","data-v-c520c244"]]),Nn={class:"notebook-edit-tool-handler"},On={class:"tool-section"},An={class:"notebook-info"},Rn={class:"file-path"},Un={class:"cell-info mt-2"},qn={class:"info-row"},Fn={class:"info-row"},Wn={key:0,class:"info-row"},Hn={class:"badge bg-info"},Bn={key:0,class:"source-preview mt-3"},Vn={class:"preview-header"},zn={class:"preview-stats"},Gn={class:"source-code"},Jn={key:0,class:"tool-section"},Kn={key:0},Yn={key:1,class:"text-danger"},Qn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.notebook_path||"Unknown"),m=d(()=>t.toolCall.input?.cell_id),i=d(()=>t.toolCall.input?.cell_type||"code"),l=d(()=>t.toolCall.input?.edit_mode||"replace"),c=d(()=>t.toolCall.input?.new_source||""),f=d(()=>c.value.split(`
`).length),r=d(()=>i.value==="code"?"bg-primary":"bg-secondary"),v=d(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),u=d(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const b=l.value;return b==="insert"?"Cell inserted successfully":b==="delete"?"Cell deleted successfully":"Cell updated successfully"});return(b,_)=>(s(),o("div",Nn,[e("div",On,[e("div",An,[_[0]||(_[0]=e("span",{class:"notebook-icon"},"ðŸ““",-1)),_[1]||(_[1]=e("strong",null,"Notebook:",-1)),e("code",Rn,p(a.value),1)]),e("div",Un,[e("div",qn,[_[2]||(_[2]=e("strong",null,"Cell ID:",-1)),e("code",null,p(m.value||"N/A"),1)]),e("div",Fn,[_[3]||(_[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:H(["badge",r.value])},p(i.value),3)]),l.value?(s(),o("div",Wn,[_[4]||(_[4]=e("strong",null,"Edit Mode:",-1)),e("span",Hn,p(l.value),1)])):D("",!0)]),c.value?(s(),o("div",Bn,[e("div",Vn,[_[5]||(_[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",zn,p(f.value)+" lines",1)]),e("pre",Gn,[e("code",null,p(c.value),1)])])):D("",!0)]),n.toolCall.result?(s(),o("div",Jn,[_[8]||(_[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:H(["tool-result",v.value])},[n.toolCall.result.success!==!1?(s(),o("div",Kn,[_[6]||(_[6]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+p(u.value),1)])):(s(),o("div",Yn,[_[7]||(_[7]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+p(n.toolCall.result.error||"Operation failed"),1)]))],2)])):D("",!0)]))}},Zn=B(Qn,[["__scopeId","data-v-bf9ef8f9"]]),Xn={class:"shell-tool-handler"},el={class:"tool-section"},tl={class:"shell-info"},sl={class:"shell-icon"},ol={key:0,class:"shell-id"},nl={key:0,class:"filter-info mt-2"},ll={class:"filter-pattern"},al={key:0,class:"tool-section"},il={class:"result-header mb-2"},rl={key:0,class:"shell-output"},cl={key:0},dl={key:1,class:"text-danger"},ul={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.name==="BashOutput"?"ðŸ“¤":t.toolCall.name==="KillShell"?"ðŸ›‘":"ðŸš"),m=d(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),i=d(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),l=d(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),c=d(()=>t.toolCall.input?.filter),f=d(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),r=d(()=>t.toolCall.result?.status),v=d(()=>{const _=r.value;return _==="running"?"bg-success":_==="completed"?"bg-secondary":_==="killed"||_==="terminated"?"bg-danger":"bg-info"}),u=d(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),b=d(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return(_,w)=>(s(),o("div",Xn,[e("div",el,[e("div",tl,[e("span",sl,p(a.value),1),e("strong",null,p(m.value)+":",1),l.value?(s(),o("code",ol,"Shell "+p(l.value),1)):D("",!0)]),n.toolCall.name==="BashOutput"&&c.value?(s(),o("div",nl,[w[0]||(w[0]=e("strong",null,"Filter:",-1)),e("code",ll,p(c.value),1)])):D("",!0)]),n.toolCall.result?(s(),o("div",al,[e("div",il,[e("strong",null,p(i.value)+":",1),r.value?(s(),o("span",{key:0,class:H(["badge",v.value])},p(r.value),3)):D("",!0)]),f.value?(s(),o("div",rl,[e("pre",null,[e("code",null,p(f.value),1)])])):(s(),o("div",{key:1,class:H(["tool-result",u.value])},[n.toolCall.result.success!==!1?(s(),o("div",cl,[w[1]||(w[1]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+p(b.value),1)])):(s(),o("div",dl,[w[2]||(w[2]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+p(n.toolCall.result.error||"Operation failed"),1)]))],2))])):D("",!0)]))}},Ae=B(ul,[["__scopeId","data-v-1a461f4c"]]),ml={class:"skill-tool-handler"},pl={key:0,class:"tool-section"},vl={class:"d-flex align-items-center gap-2"},fl={class:"text-muted small"},gl={key:0,class:"skill-content-body"},_l={class:"skill-content-text"},hl={key:1,class:"tool-section mt-3"},bl={class:"tool-result tool-result-error"},yl={class:"tool-code"},$l={__name:"SkillToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=ue(),m=K(),i=L(!1);function l(){i.value=!i.value}d(()=>t.toolCall.input?.command||"Unknown Skill"),d(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),d(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}});const c=d(()=>{const _=m.currentSessionId;if(!_)return{running:null,content:null};const w=a.messagesBySession.get(_)||[],T=w.findIndex(x=>x.type==="user"&&x.metadata?.has_tool_results&&x.metadata?.tool_results?.some(N=>N.tool_use_id===t.toolCall.id));if(T===-1)return{running:null,content:null};let $=null,y=null;for(let x=T+1;x<Math.min(T+3,w.length);x++){const N=w[x];if(N.type!=="user")continue;const S=N.content||"";S.includes("<command-message>")&&S.includes("skill is running")?$=N:S.startsWith("Base directory for this skill:")&&(y=N)}return{running:$,content:y}});d(()=>{const _=c.value.content;if(!_)return null;const T=(_.content||"").match(/Base directory(?:\s+for\s+this\s+skill)?:\s*(.+?)(?:\n|$)/i);return T&&T[1]?T[1].trim():null});const f=d(()=>{const _=c.value.content;if(!_)return"";const w=_.content||"",T=/Base directory(?:\s+for\s+this\s+skill)?:.*?\n/i;return w.replace(T,"").trim()}),r=d(()=>f.value.length>0),v=d(()=>f.value?f.value.split(`
`).length:0),u=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),b=d(()=>{if(!u.value)return"";const _=t.toolCall.result;return _?.message?_.message:_?.error?_.error:"An error occurred"});return(_,w)=>(s(),o("div",ml,[r.value?(s(),o("div",pl,[e("div",{class:"skill-content-header",onClick:l},[e("div",vl,[e("i",{class:H(["bi",i.value?"bi-chevron-down":"bi-chevron-right"])},null,2),w[0]||(w[0]=e("strong",null,"Skill Content",-1)),e("span",fl,"("+p(v.value)+" lines)",1)])]),i.value?(s(),o("div",gl,[e("pre",_l,p(f.value),1)])):D("",!0)])):D("",!0),u.value?(s(),o("div",hl,[w[1]||(w[1]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",bl,[e("pre",yl,p(b.value),1)])])):D("",!0)]))}},wl=B($l,[["__scopeId","data-v-ba9a91da"]]),kl={class:"slashcommand-tool-handler"},Sl={key:0,class:"tool-section"},Cl={class:"d-flex align-items-center gap-2"},xl={class:"text-muted small"},Ml={key:0,class:"command-content-body"},jl={class:"command-content-text"},Tl={key:1,class:"tool-section mt-3"},El={class:"tool-result tool-result-error"},Ll={class:"tool-code"},Pl={__name:"SlashCommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=ue(),m=K(),i=L(!1);function l(){i.value=!i.value}d(()=>t.toolCall.input?.command||"Unknown Command"),d(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),d(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}});const c=d(()=>{const _=m.currentSessionId;if(!_)return{running:null,content:null};const w=a.messagesBySession.get(_)||[],T=w.findIndex(x=>x.type==="user"&&x.metadata?.has_tool_results&&x.metadata?.tool_results?.some(N=>N.tool_use_id===t.toolCall.id));if(T===-1)return{running:null,content:null};let $=null,y=null;for(let x=T+1;x<Math.min(T+3,w.length);x++){const N=w[x];if(N.type!=="user")continue;const S=N.content||"";S.includes("<command-message>")&&S.includes("<command-name>")&&S.includes("<command-args>")?$=N:S.includes("ARGUMENTS:")&&(y=N)}return{running:$,content:y}});d(()=>{const _=c.value.running;if(!_)return null;const T=(_.content||"").match(/<command-args>(.+?)<\/command-args>/s);return T&&T[1]?T[1].trim():null});const f=d(()=>{const _=c.value.content;if(!_)return"";const w=_.content||"",T=/\nARGUMENTS:.*$/s;return w.replace(T,"").replace(/<command-message>.*?<\/command-message>/s,"").replace(/<command-name>.*?<\/command-name>/s,"").replace(/<command-args>.*?<\/command-args>/s,"").trim()}),r=d(()=>f.value.length>0),v=d(()=>f.value?f.value.split(`
`).length:0),u=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),b=d(()=>{if(!u.value)return"";const _=t.toolCall.result;return _?.message?_.message:_?.error?_.error:"An error occurred"});return(_,w)=>(s(),o("div",kl,[r.value?(s(),o("div",Sl,[e("div",{class:"command-content-header",onClick:l},[e("div",Cl,[e("i",{class:H(["bi",i.value?"bi-chevron-down":"bi-chevron-right"])},null,2),w[0]||(w[0]=e("strong",null,"Command Content",-1)),e("span",xl,"("+p(v.value)+" lines)",1)])]),i.value?(s(),o("div",Ml,[e("pre",jl,p(f.value),1)])):D("",!0)])):D("",!0),u.value?(s(),o("div",Tl,[w[1]||(w[1]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",El,[e("pre",Ll,p(b.value),1)])])):D("",!0)]))}},Il=B(Pl,[["__scopeId","data-v-17d3444e"]]),Dl={class:"exit-plan-mode-tool-handler"},Nl={class:"tool-section"},Ol={key:0,class:"plan-content mt-2"},Al={class:"plan-text"},Rl={key:0,class:"tool-section"},Ul={key:0},ql={key:1,class:"text-danger"},Fl={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.plan),m=d(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(i,l)=>(s(),o("div",Dl,[e("div",Nl,[l[1]||(l[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"ðŸ“‹"),e("strong",null,"Exiting Plan Mode")],-1)),a.value?(s(),o("div",Ol,[l[0]||(l[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",Al,p(a.value),1)])):D("",!0)]),n.toolCall.result?(s(),o("div",Rl,[l[4]||(l[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:H(["tool-result",m.value])},[n.toolCall.result.success!==!1?(s(),o("div",Ul,[...l[2]||(l[2]=[e("i",{class:"bi bi-check-circle"},null,-1),G(" Permission mode reverted to default ",-1)])])):(s(),o("div",ql,[l[3]||(l[3]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+p(n.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):D("",!0)]))}},Wl=B(Fl,[["__scopeId","data-v-bd35183e"]]),Hl={class:"d-flex align-items-center gap-2 flex-grow-1 min-width-0"},Bl={class:"tool-status-icon"},Vl=["title"],zl={class:"d-flex align-items-center gap-2"},Gl={class:"text-muted"},Jl={key:0,class:"card-body"},Kl={key:0,class:"alert alert-warning mb-3"},Yl={class:"d-flex align-items-center"},Ql={class:"mb-0 small"},Zl={key:1,class:"permission-prompt mt-3"},Xl={class:"alert alert-warning mb-3"},ea={class:"mb-0"},ta={class:"tool-name"},sa={key:0,class:"suggestions-section mb-3"},oa={class:"alert alert-info mb-0"},na={class:"suggestion-details p-2 bg-white rounded"},la={class:"permission-buttons d-flex gap-2 mb-3"},aa=["disabled"],ia=["disabled"],ra=["disabled"],ca={class:"guidance-section mt-3"},da=["disabled"],ua=["disabled"],ma={key:2,class:"mt-3"},pa={class:"alert alert-warning mb-0"},va={class:"d-flex align-items-center"},fa={class:"mb-0 small"},ga={key:3,class:"tool-section"},_a={class:"alert alert-danger mb-0"},ha={key:0},ba={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=ue(),m=K(),i=ve(),l=L(!1),c=L(null),f=L(""),r=d(()=>a.isToolUseOrphaned(m.currentSessionId,t.toolCall.id)),v=d(()=>a.getOrphanedInfo(m.currentSessionId,t.toolCall.id)),u={Read:ms,Write:Ts,Bash:Ws,TodoWrite:lo,Edit:jo,Grep:Ne,Glob:Ne,WebFetch:Oe,WebSearch:Oe,Task:Dn,NotebookEdit:Zn,BashOutput:Ae,KillShell:Ae,SlashCommand:Il,Skill:wl,ExitPlanMode:Wl},b=d(()=>{const k=t.toolCall.name;return u[k]?u[k]:Yt}),_=d(()=>{const k=[];switch(t.toolCall.status){case"pending":k.push("border-secondary");break;case"permission_required":k.push("border-warning");break;case"executing":k.push("border-primary");break;case"completed":$.value||t.toolCall.permissionDecision==="deny"?k.push("border-danger"):k.push("border-success");break;case"error":k.push("border-danger");break}return k.join(" ")}),w=d(()=>{switch(t.toolCall.status){case"pending":return"ðŸ”„";case"permission_required":return"â“";case"executing":return"âš¡";case"completed":return t.toolCall.permissionDecision==="deny"?"âŒ":$.value?"ðŸ’¥":"âœ…";case"error":return"ðŸ’¥";default:return"ðŸ”§"}}),T=d(()=>Ce(t.toolCall.timestamp)),$=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),y=d(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function x(k){if(!k)return"";const h=k.replace(/\\/g,"/").split("/");return h[h.length-1]}function N(k,h=200){return k?k.length<=h?k:k.substring(0,h)+"...":""}function S(k){if(!k)return null;if(k.content){const h=k.content.match(/exit code (\d+)/i);if(h)return parseInt(h[1])}return k.error?1:0}function g(k,h){const C=k?k.split(`
`).length:0;return{added:h?h.split(`
`).length:0,removed:C}}const q=d(()=>{const k=t.toolCall.name,h=t.toolCall.input||{},C=t.toolCall.result,E=t.toolCall.status;switch(k){case"Bash":case"Shell":case"Command":{const O=N(h.command,200);if(E==="completed"&&C){const R=S(C);return`Bash: ${O} (exit ${R})`}return`Bash: ${O}`}case"SlashCommand":{const O=N(h.command,200);return E==="completed"&&C?`SlashCommand: ${O}`:`SlashCommand: ${O}`}case"Edit":{const O=x(h.file_path);if(E==="completed"&&C&&!C.error){const{added:R,removed:I}=g(h.old_string,h.new_string);return R===I?`Edit: ${O} (${R} lines changed)`:`Edit: ${O} (${R} lines added, ${I} removed)`}return`Edit: ${O}`}case"Read":{const O=x(h.file_path);if(h.offset!==void 0||h.limit!==void 0){const I=(h.offset||0)+1,A=h.limit?(h.offset||0)+h.limit:"âˆž";return`Read: ${O} (lines ${I}-${A})`}return`Read: ${O} (full file)`}case"Write":{const O=x(h.file_path);if(E==="completed"&&C&&!C.error&&h.content){const R=h.content.split(`
`).length;return`Write: ${O} (${R} lines written)`}return`Write: ${O}`}case"Skill":{const O=h.command||"Unknown";return E==="completed"&&C?C.error?`Skill: ${O} (error)`:`Skill: ${O} (completed)`:`Skill: ${O}`}case"Task":{const O=h.subagent_type||"general",R=h.description||"Task";return E==="completed"&&C?C.error?`Task: (${O}) ${R} (error)`:`Task: (${O}) ${R} (completed)`:`Task: (${O}) ${R}`}case"TodoWrite":{if(h.todos&&Array.isArray(h.todos)){const O=h.todos.filter(A=>A.status==="completed").length,R=h.todos.length,I=h.todos.find(A=>A.status==="in_progress");return I?`Todo: Working on "${I.content}"`:`Todo: ${O}/${R} Tasks Completed`}return"Todo: Updated"}case"Grep":case"Glob":{const O=h.pattern||"",R=k==="Grep"?"Grep":"Glob";if(E==="completed"&&C&&!C.error){let I=0;return C.content&&(I=C.content.split(`
`).filter(W=>W.trim()).length),`${R}: "${O}" (${I} results)`}return`${R}: "${O}"`}case"WebFetch":case"WebSearch":{const O=h.url||h.query||"";let R="";try{O&&(R=new URL(O.startsWith("http")?O:`https://${O}`).hostname)}catch{R=O.length>50?O.substring(0,50)+"...":O}return E==="completed"&&C?C.error?`Web: ${R} (error)`:`Web: ${R} (success)`:`Web: ${R||O}`}case"NotebookEdit":{const O=x(h.notebook_path),R=h.cell_number!==void 0?h.cell_number:"?",I=h.edit_mode||"replace";return`NotebookEdit: ${O} cell #${R} (${I})`}case"ExitPlanMode":return"ExitPlanMode: Plan submitted";case"BashOutput":return`BashOutput: Read output from ${h.bash_id||"unknown"}`;case"KillShell":return`KillShell: Terminate ${h.shell_id||"unknown"}`;default:return`${k}: executed`}}),U=d(()=>{const k=t.toolCall.name,h=t.toolCall.input||{};return["Bash","Shell","Command","SlashCommand"].includes(k)?h.command||k:["Edit","Read","Write","NotebookEdit"].includes(k)&&(h.file_path||h.notebook_path)||k});function j(){const k=m.currentSessionId;k&&a.toggleToolExpansion(k,t.toolCall.id)}function M(k){return k.type==="setMode"?`Set permission mode to "${k.mode}"`:k.type==="allow"?`Allow tool: ${k.tool}`:JSON.stringify(k)}async function P(k,h,C=null){if(!l.value){l.value=!0,k==="allow"?c.value=h?"approve-apply":"approve":C?c.value="deny-guidance":c.value="deny";try{const E=m.currentSessionId;if(E){const O=h&&t.toolCall.suggestions?t.toolCall.suggestions:[];a.handlePermissionResponse(E,{request_id:t.toolCall.permissionRequestId,decision:k,reasoning:k==="allow"?"User allowed permission":"User denied permission",applied_updates:O})}await i.sendPermissionResponse(t.toolCall.permissionRequestId,k,h,C)}catch(E){console.error("Failed to send permission response:",E)}finally{l.value=!1,c.value=null}}}return(k,h)=>(s(),o("div",{class:H(["tool-call-card card",_.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:j},[e("div",Hl,[e("span",Bl,p(w.value),1),e("strong",{class:"tool-name",title:U.value},p(q.value),9,Vl)]),e("div",zl,[e("small",Gl,p(T.value),1),e("i",{class:H(["bi",n.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),n.toolCall.isExpanded?(s(),o("div",Jl,[r.value?(s(),o("div",Kl,[e("div",Yl,[h[6]||(h[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[h[5]||(h[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",Ql,p(v.value?.message||"Session was terminated"),1)])])])):D("",!0),(s(),de(Ue(b.value),{toolCall:n.toolCall},null,8,["toolCall"])),n.toolCall.status==="permission_required"&&!r.value?(s(),o("div",Zl,[e("div",Xl,[h[9]||(h[9]=e("p",{class:"mb-2"},[e("strong",null,"ðŸ” Permission Required")],-1)),e("p",ea,[h[7]||(h[7]=G("Claude wants to use the ",-1)),e("code",ta,p(n.toolCall.name),1),h[8]||(h[8]=G(" tool.",-1))])]),y.value?(s(),o("div",sa,[e("div",oa,[h[10]||(h[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),G(" Suggested Permission Update ")],-1)),h[11]||(h[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",na,[(s(!0),o(Y,null,Z(n.toolCall.suggestions,(C,E)=>(s(),o("div",{key:E,class:"suggestion-item"},[e("code",null,p(M(C)),1)]))),128))]),h[12]||(h[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):D("",!0),e("div",la,[y.value?(s(),o("button",{key:0,class:"btn btn-success",onClick:h[0]||(h[0]=C=>P("allow",!0)),disabled:l.value},[h[13]||(h[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+p(l.value&&c.value==="approve-apply"?"â³ Submitting...":"âœ… Approve & Apply"),1)],8,aa)):D("",!0),e("button",{class:H(["btn",y.value?"btn-outline-success":"btn-success"]),onClick:h[1]||(h[1]=C=>P("allow",!1)),disabled:l.value},[h[14]||(h[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+p(l.value&&c.value==="approve"?"â³ Submitting...":y.value?"âœ… Approve Only":"âœ… Approve"),1)],10,ia),e("button",{class:"btn btn-danger",onClick:h[2]||(h[2]=C=>P("deny",!1)),disabled:l.value},[h[15]||(h[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),G(" "+p(l.value&&c.value==="deny"?"â³ Submitting...":"âŒ Deny"),1)],8,ra)]),e("div",ca,[h[17]||(h[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),G(" Provide Guidance (Optional) ")],-1)),h[18]||(h[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),Q(e("textarea",{"onUpdate:modelValue":h[3]||(h[3]=C=>f.value=C),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:l.value},null,8,da),[[le,f.value]]),f.value.trim()?(s(),o("button",{key:0,class:"btn btn-warning btn-sm",onClick:h[4]||(h[4]=C=>P("deny",!1,f.value)),disabled:l.value},[h[16]||(h[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),G(" "+p(l.value&&c.value==="deny-guidance"?"â³ Submitting...":"ðŸ’¡ Provide Guidance & Continue"),1)],8,ua)):D("",!0)])])):D("",!0),n.toolCall.status==="permission_required"&&r.value?(s(),o("div",ma,[e("div",pa,[e("div",va,[h[20]||(h[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[h[19]||(h[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",fa,p(v.value?.message||"Session was terminated before permission could be granted"),1)])])])])):D("",!0),n.toolCall.permissionDecision==="deny"?(s(),o("div",ga,[e("div",_a,[h[21]||(h[21]=e("i",{class:"bi bi-x-circle"},null,-1)),h[22]||(h[22]=G(" Permission denied ",-1)),n.toolCall.result?.message?(s(),o("span",ha," - "+p(n.toolCall.result.message),1)):D("",!0)])])):D("",!0)])):D("",!0)],2))}},ya=B(ba,[["__scopeId","data-v-65c848bf"]]),$a={class:"message-row message-row-assistant"},wa=["title"],ka={class:"message-content-column"},Sa={key:0,class:"thinking-block mb-2"},Ca=["innerHTML"],xa={key:2,class:"tool-calls"},Ma={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n,a=ue(),m=K();ye.setOptions({breaks:!0,gfm:!0});const i=d(()=>Ce(t.message.timestamp)),l=d(()=>t.message.metadata?.model||null),c=d(()=>{const T=i.value;return`assistant${l.value?`
Model: ${l.value}`:""}
${T}`}),f=d(()=>{const T=t.message.content||"";return T.trim().length>0&&T!=="Assistant response"}),r=d(()=>{const T=t.message.content||"";let $=ye.parse(T);return $=$.replace(/\n</g,"<"),$=$.replace(/\n+$/,""),Ee.sanitize($)}),v=d(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),u=d(()=>t.message.metadata?.thinking_content||""),b=d(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),_=d(()=>t.message.metadata?.tool_uses||[]),w=d(()=>{const T=m.currentSessionId;if(!T)return[];const $=a.toolCallsBySession.get(T)||[];return _.value.map(y=>{const x=$.find(N=>N.id===y.id);return x||{id:y.id,name:y.name,input:y.input,status:"pending",result:null,timestamp:y.timestamp||t.message.timestamp,isExpanded:!0}})});return(T,$)=>(s(),o("div",$a,[e("div",{class:"message-speaker",title:c.value},[...$[0]||($[0]=[e("span",{class:"speaker-label"},"assistant",-1)])],8,wa),e("div",ka,[v.value?(s(),o("div",Sa,[X(qt,{thinking:u.value},null,8,["thinking"])])):D("",!0),f.value?(s(),o("div",{key:1,class:"message-text",innerHTML:r.value},null,8,Ca)):D("",!0),b.value?(s(),o("div",xa,[(s(!0),o(Y,null,Z(w.value,y=>(s(),de(ya,{key:y.id,toolCall:y},null,8,["toolCall"]))),128))])):D("",!0)])]))}},ja=B(Ma,[["__scopeId","data-v-726a72a7"]]),Ta={class:"message-row message-row-system"},Ea=["title"],La={class:"message-content-column"},Pa={class:"system-text"},Ia={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>Ce(t.message.timestamp)),m=d(()=>`system
${a.value}`);return(i,l)=>(s(),o("div",Ta,[e("div",{class:"message-speaker",title:m.value},[...l[0]||(l[0]=[e("span",{class:"speaker-label"},"system",-1)])],8,Ea),e("div",La,[e("span",Pa,p(n.message.content),1)])]))}},Re=B(Ia,[["__scopeId","data-v-4999cd2b"]]),Da={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>{switch(t.message.type){case"user":return Dt;case"assistant":return ja;case"system":return Re;default:return Re}});return(m,i)=>(s(),de(Ue(a.value),{message:n.message},null,8,["message"]))}},Na=B(Da,[["__scopeId","data-v-f283c218"]]),Oa={key:0,class:"text-muted text-center py-5"},Aa={__name:"MessageList",setup(n){const t=ue(),a=se(),m=L(null),i=d(()=>t.currentMessages.filter(r=>c(r)));d(()=>t.currentToolCalls);async function l(){a.autoScrollEnabled&&(await Te(),m.value&&(m.value.scrollTop=m.value.scrollHeight))}ee(()=>t.currentMessages.length,l),ee(()=>t.currentToolCalls.length,l),ee(()=>t.currentToolCalls.map(r=>`${r.id}-${r.status}`).join(","),l),ne(()=>{setTimeout(()=>{l()},100)});function c(r){const v=r.subtype||r.metadata?.subtype;if(r.type==="system"&&v==="init"||r.type==="result"||r.type==="permission_request"||r.type==="permission_response")return!1;if(r.type==="user"&&r.metadata?.has_tool_results){const u=r.content||"";if(u.match(/^Tool results?: \d+ results?$/i)||u.trim()==="")return!1}if(r.type==="user"){const u=r.content||"";if(u.includes("<command-message>")&&u.includes("skill is running")||u.startsWith("Base directory for this skill:"))return!1}if(r.type==="user"){const u=r.content||"";if(u.includes("<command-message>")&&u.includes("<command-name>")&&u.includes("<command-args>")||u.includes("ARGUMENTS:")&&(u.includes("<command-name>")||u.match(/\nARGUMENTS:/)))return!1}return!0}function f(r){return{type:r.type||"unknown",content:r.content||"",timestamp:r.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...r.metadata}}}return(r,v)=>(s(),o("div",{class:"messages-area flex-grow-1 overflow-auto",ref_key:"messagesArea",ref:m},[i.value.length===0?(s(),o("div",Oa," No messages yet. Start a conversation! ")):D("",!0),(s(!0),o(Y,null,Z(i.value,(u,b)=>(s(),de(Na,{key:`msg-${u.timestamp}-${b}`,message:f(u)},null,8,["message"]))),128))],512))}},Ra=B(Aa,[["__scopeId","data-v-f94a8763"]]),Ua={class:"border-top bg-light"},qa={class:"d-flex gap-2 align-items-end px-2 py-1"},Fa=["placeholder","disabled","onKeydown"],Wa=["disabled"],Ha={__name:"InputArea",setup(n){const t=K(),a=ve(),m=L(null),i=d({get:()=>t.currentInput,set:_=>{t.currentInput=_}}),l=d(()=>t.currentSession?.is_processing||!1),c=d(()=>a.sessionConnected),f=d(()=>t.currentSession?.state==="starting"),r=d(()=>f.value?"Session is starting...":c.value?"Type your message to Claude Code...":"Waiting for connection...");function v(){const _=m.value;if(!_)return;_.style.height="auto";const w=Math.min(_.scrollHeight,parseInt(getComputedStyle(_).maxHeight));_.style.height=w+"px"}function u(){i.value.trim()&&(a.sendMessage(i.value),i.value="",m.value&&(m.value.style.height="auto"))}function b(){a.interruptSession()}return(_,w)=>(s(),o("div",Ua,[e("div",qa,[Q(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:m,"onUpdate:modelValue":w[0]||(w[0]=T=>i.value=T),class:"form-control",placeholder:r.value,disabled:f.value||!c.value,rows:"1",onInput:v,onKeydown:Se(re(u,["exact","prevent"]),["enter"])},null,40,Fa),[[le,i.value]]),l.value?(s(),o("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:b}," Stop ")):(s(),o("button",{key:1,class:"btn btn-primary",disabled:!i.value.trim()||!c.value||f.value,onClick:u}," Send ",8,Wa))])]))}},Ba=B(Ha,[["__scopeId","data-v-a72bf16a"]]),Va={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},za={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},Ga={class:"text-secondary"},Ja={class:"d-flex flex-column flex-grow-1 overflow-hidden"},Fe={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,a=K(),m=se(),i=d(()=>a.currentSession),l=d(()=>m.isLoading),c=d(()=>m.loadingMessage);return ne(async()=>{if(t.sessionId!==a.currentSessionId){m.showLoading("Loading session...");try{await a.selectSession(t.sessionId)}finally{m.hideLoading()}}}),ee(()=>t.sessionId,async(f,r)=>{if(f!==r&&f!==a.currentSessionId){m.showLoading("Loading session...");try{await a.selectSession(f)}finally{m.hideLoading()}}}),ce(()=>{}),(f,r)=>(s(),o("div",Va,[l.value?(s(),o("div",za,[r[0]||(r[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Ga,p(c.value),1)])):D("",!0),i.value?(s(),de(at,{key:1,"session-id":t.sessionId},null,8,["session-id"])):D("",!0),e("div",Ja,[X(Ra)]),X(Ba),i.value?(s(),de(ut,{key:2,"session-id":t.sessionId},null,8,["session-id"])):D("",!0),i.value?(s(),de(yt,{key:3,"session-id":t.sessionId},null,8,["session-id"])):D("",!0)]))}},he=_e("legion",()=>{const n=L(new Map),t=L(new Map),a=L(new Map),m=L(new Map),i=L(new Map),l=L(new Map),c=L(null),f=d(()=>n.value.get(c.value)||[]),r=d(()=>t.value.get(c.value)||[]),v=d(()=>a.value.get(c.value)||[]),u=d(()=>m.value.get(c.value)||[]);function b(M){c.value=M}async function _(M,P=100,k=0){try{const h=await J.get(`/api/legions/${M}/timeline?limit=${P}&offset=${k}`),C=h.comms||[],E=h.total_count||C.length,O=h.has_more||!1;return C.sort((R,I)=>new Date(R.timestamp)-new Date(I.timestamp)),console.log(`Loaded ${C.length} of ${E} comms for legion ${M}`),n.value.set(M,C),n.value=new Map(n.value),{comms:C,totalCount:E,hasMore:O}}catch(h){throw console.error("Failed to load timeline:",h),h}}function w(M,P){n.value.has(M)||n.value.set(M,[]),n.value.get(M).push(P),n.value=new Map(n.value)}async function T(M,P){try{const h=(await J.post(`/api/legions/${M}/comms`,P)).comm;return console.log(`Sent comm ${h.comm_id} to legion ${M}`),h}catch(k){throw console.error("Failed to send comm:",k),k}}async function $(M){return console.log(`Minions for legion ${M} are already available in session store`),[]}async function y(M,P){try{const h=(await J.post(`/api/legions/${M}/minions`,P)).minion;return await $(M),console.log(`Created minion ${h.minion_id} in legion ${M}`),h}catch(k){throw console.error("Failed to create minion:",k),k}}async function x(M){try{const k=(await J.get(`/api/legions/${M}/hordes`)).hordes||[];return console.log(`Loaded ${k.length} hordes for legion ${M}`),a.value.set(M,k),a.value=new Map(a.value),k}catch(P){throw console.error("Failed to load hordes:",P),P}}async function N(M){try{const k=(await J.get(`/api/legions/${M}/channels`)).channels||[];return console.log(`Loaded ${k.length} channels for legion ${M}`),m.value.set(M,k),m.value=new Map(m.value),k}catch(P){throw console.error("Failed to load channels:",P),P}}async function S(M){try{const P=await J.get(`/api/channels/${M}`),k=P.channel||P;return console.log(`Loaded details for channel ${M}`),i.value.set(M,k),i.value=new Map(i.value),k}catch(P){throw console.error("Failed to load channel details:",P),P}}async function g(M,P=1e3){try{const h=(await J.get(`/api/channels/${M}/comms?limit=${P}`)).comms||[];return console.log(`Loaded ${h.length} comms for channel ${M}`),h.sort((C,E)=>new Date(C.timestamp)-new Date(E.timestamp)),l.value.set(M,h),l.value=new Map(l.value),h}catch(k){throw console.error("Failed to load channel comms:",k),k}}async function q(M,P){try{await J.post(`/api/channels/${M}/members`,{action:"add",self_id:"00000000-0000-0000-0000-000000000000",member_id:P}),console.log(`Added minion ${P} to channel ${M}`),await S(M)}catch(k){throw console.error("Failed to add member to channel:",k),k}}async function U(M,P){try{await J.post(`/api/channels/${M}/members`,{action:"remove",self_id:"00000000-0000-0000-0000-000000000000",member_id:P}),console.log(`Removed minion ${P} from channel ${M}`),await S(M)}catch(k){throw console.error("Failed to remove member from channel:",k),k}}function j(M){n.value.delete(M),t.value.delete(M),a.value.delete(M),m.value.delete(M),n.value=new Map(n.value),t.value=new Map(t.value),a.value=new Map(a.value),m.value=new Map(m.value)}return{commsByLegion:n,minionsByLegion:t,hordesByLegion:a,channelsByLegion:m,channelDetailsByChannel:i,channelCommsByChannel:l,currentLegionId:c,currentComms:f,currentMinions:r,currentHordes:v,currentChannels:u,setCurrentLegion:b,loadTimeline:_,addComm:w,sendComm:T,loadMinions:$,createMinion:y,loadHordes:x,loadChannels:N,loadChannelDetails:S,loadChannelComms:g,addMemberToChannel:q,removeMemberFromChannel:U,clearLegionData:j}}),Ka=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:he},Symbol.toStringTag,{value:"Module"})),Ya={class:"timeline-header border-bottom p-3"},Qa={class:"project-name"},Za=["title"],Xa={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=ae(),m=d(()=>a.projects.get(t.legionId)),i=d(()=>m.value?.name||"Legion");return(l,c)=>(s(),o("div",Ya,[e("div",null,[e("div",Qa,p(i.value),1),e("div",{class:"view-name",title:n.legionId},"Timeline",8,Za)])]))}},ei=B(Xa,[["__scopeId","data-v-44f386f5"]]),ti={class:"timeline-status-bar border-top p-2 bg-light"},si={class:"d-flex justify-content-end"},oi={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(n){const t=se();function a(){t.setAutoScroll(!t.autoScrollEnabled)}return(m,i)=>(s(),o("div",ti,[e("div",si,[e("button",{class:H(["btn btn-sm",ke(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:a}," â¬‡ï¸ "+p(ke(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},ni=B(oi,[["__scopeId","data-v-891c73db"]]),li={class:"comm-composer border-top p-3"},ai={class:"d-flex gap-2 mb-2"},ii={class:"flex-grow-1"},ri=["disabled"],ci={label:"Minions"},di=["value"],ui={key:0,label:"Channels"},mi=["value"],pi={style:{"min-width":"150px"}},vi=["disabled"],fi={class:"d-flex gap-2 align-items-end position-relative"},gi={class:"flex-grow-1 position-relative"},_i=["disabled"],hi=["onClick","onMouseenter"],bi=["disabled"],yi={key:0},$i={key:1},wi={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=he(),m=K(),i=ae(),l=L(""),c=L("task"),f=L(""),r=L(!1),v=L(!1),u=L([]),b=L(0),_=L(-1),w=L(null),T=L(null),$=d(()=>{const k=i.projects.get(t.legionId);return!k||!k.session_ids?[]:k.session_ids.map(h=>m.sessions.get(h)).filter(h=>h&&h.is_minion)}),y=d(()=>a.currentChannels||[]),x=d(()=>l.value&&f.value.trim().length>0);function N(k){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[k.state]||"â—‹"}function S(k){return k.is_minion&&k.role?`${k.name} (${k.role})`:k.name}function g(){const k=w.value;if(!k)return;k.style.height="auto";const h=Math.min(k.scrollHeight,parseInt(getComputedStyle(k).maxHeight));k.style.height=h+"px"}function q(){const k=w.value;if(!k)return;g();const h=f.value,C=k.selectionStart,E=h.substring(0,C),O=E.lastIndexOf("#");if(O===-1){v.value=!1;return}const R=E.substring(O+1).toLowerCase();if(R.includes(" ")){v.value=!1;return}const I=$.value.filter(A=>A.name.toLowerCase().includes(R)).map(A=>({type:"minion",name:A.name,role:A.role,id:A.session_id,state:A.state}));if(I.length===0){v.value=!1;return}u.value=I,b.value=0,_.value=O,v.value=!0}function U(){if(!T.value)return;const k=T.value,h=k.children[b.value];if(!h)return;const C=h.offsetTop,E=h.offsetHeight,O=k.scrollTop,R=k.clientHeight;C<O?k.scrollTop=C:C+E>O+R&&(k.scrollTop=C+E-R)}function j(k){if(!v.value){k.key==="Enter"&&!k.shiftKey&&x.value&&(k.preventDefault(),P());return}if(k.key==="ArrowDown")k.preventDefault(),b.value=(b.value+1)%u.value.length,U();else if(k.key==="ArrowUp")k.preventDefault(),b.value=b.value===0?u.value.length-1:b.value-1,U();else if(k.key==="Enter"){k.preventDefault();const h=u.value[b.value];h&&M(h)}else k.key==="Escape"&&(v.value=!1)}function M(k){const h=w.value;if(!h)return;const C=f.value,E=h.selectionStart,O=C.substring(0,_.value)+"#"+k.name+" "+C.substring(E);f.value=O;const R=_.value+k.name.length+2;setTimeout(()=>{h.setSelectionRange(R,R),h.focus()},0),v.value=!1}async function P(){if(!(!x.value||r.value)){r.value=!0;try{const[k,h]=l.value.split(":"),C={comm_type:c.value,content:f.value.trim()};k==="minion"?C.to_minion_id=h:k==="channel"&&(C.to_channel_id=h),await a.sendComm(t.legionId,C),f.value="",g()}catch(k){console.error("Failed to send comm:",k),alert(`Failed to send comm: ${k.message}`)}finally{r.value=!1}}}return ee(v,k=>{if(k){const h=C=>{C.target.closest(".comm-composer")||(v.value=!1,document.removeEventListener("click",h))};setTimeout(()=>document.addEventListener("click",h),0)}}),(k,h)=>(s(),o("div",li,[e("div",ai,[e("div",ii,[Q(e("select",{"onUpdate:modelValue":h[0]||(h[0]=C=>l.value=C),class:"form-select form-select-sm",disabled:r.value},[h[3]||(h[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",ci,[(s(!0),o(Y,null,Z($.value,C=>(s(),o("option",{key:C.session_id,value:`minion:${C.session_id}`},p(N(C))+" "+p(S(C)),9,di))),128))]),y.value.length>0?(s(),o("optgroup",ui,[(s(!0),o(Y,null,Z(y.value,C=>(s(),o("option",{key:C.channel_id,value:`channel:${C.channel_id}`}," #ï¸âƒ£ "+p(C.name),9,mi))),128))])):D("",!0)],8,ri),[[ge,l.value]])]),e("div",pi,[Q(e("select",{"onUpdate:modelValue":h[1]||(h[1]=C=>c.value=C),class:"form-select form-select-sm",disabled:r.value},[...h[4]||(h[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,vi),[[ge,c.value]])])]),e("div",fi,[e("div",gi,[Q(e("textarea",{ref_key:"contentTextarea",ref:w,"onUpdate:modelValue":h[2]||(h[2]=C=>f.value=C),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:r.value,onInput:q,onKeydown:j},null,40,_i),[[le,f.value]]),v.value?(s(),o("div",{key:0,ref_key:"autocompleteDropdown",ref:T,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(s(!0),o(Y,null,Z(u.value,(C,E)=>(s(),o("div",{key:C.id,class:H(["autocomplete-item px-2 py-1",{"bg-light":E===b.value}]),onClick:O=>M(C),onMouseenter:O=>b.value=E},p(C.type==="minion"?N(C):"#ï¸âƒ£")+" "+p(C.name)+p(C.role?` (${C.role})`:""),43,hi))),128))],512)):D("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!x.value||r.value,onClick:P},[r.value?(s(),o("span",yi,[...h[5]||(h[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),G(" Sending... ",-1)])])):(s(),o("span",$i,"Send"))],8,bi)])])]))}},ki=B(wi,[["__scopeId","data-v-ffa54193"]]),Si={class:"timeline-view d-flex flex-column h-100"},Ci={key:0,class:"text-center text-muted"},xi={key:1,class:"text-center text-danger"},Mi={key:2,class:"text-center text-muted"},ji={key:3,class:"comm-list"},Ti={class:"col-auto message-speaker text-end pe-3"},Ei={class:"text-muted"},Li={class:"col message-content-column"},Pi={class:"comm-card card"},Ii={class:"card-body p-2"},Di={class:"d-flex justify-content-between align-items-start mb-1"},Ni={class:"ms-2"},Oi={class:"comm-content"},Ai={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=he(),m=ae(),i=K(),l=ve(),c=se(),f=L(!0),r=L(null),v=L(null),u=d(()=>m.projects.get(t.legionId));d(()=>u.value?.name||"Legion");const b=d(()=>a.currentComms);d(()=>a.currentMinions);function _(g){return g.from_user?"You":g.from_minion_id&&i.sessions.get(g.from_minion_id)?.name||"Unknown"}function w(g){return g.to_user?"You":g.to_minion_id?i.sessions.get(g.to_minion_id)?.name||"Unknown":g.to_channel_id?g.to_channel_name?`#${g.to_channel_name}`:g.to_channel_id:"All"}function T(g){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[g]||"bg-secondary"}function $(g){return new Date(g).toLocaleTimeString()}async function y(){c.autoScrollEnabled&&(await Te(),v.value&&(v.value.scrollTop=v.value.scrollHeight))}async function x(){f.value=!0,r.value=null;try{a.setCurrentLegion(t.legionId),await Promise.all([a.loadTimeline(t.legionId),a.loadMinions(t.legionId)]),await Te(),await y(),setTimeout(()=>{y()},100)}catch(g){console.error("Failed to load timeline:",g),g.response?r.value=`${g.message} (${g.response.status})`:r.value=g.message||"Unknown error"}finally{f.value=!1}}function N(){l.connectLegion(t.legionId)}function S(){l.disconnectLegion()}return ee(()=>b.value.length,()=>{y()}),ne(()=>{x(),N(),setTimeout(()=>{y()},100)}),ce(()=>{S()}),(g,q)=>(s(),o("div",Si,[X(ei,{"legion-id":n.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:v,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[f.value?(s(),o("div",Ci,[...q[0]||(q[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),G(" Loading timeline... ",-1)])])):r.value?(s(),o("div",xi," Failed to load timeline: "+p(r.value),1)):b.value.length===0?(s(),o("div",Mi," No messages yet. Minions will appear here once they start communicating. ")):(s(),o("div",ji,[(s(!0),o(Y,null,Z(b.value,U=>(s(),o("div",{key:U.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",Ti,[e("small",Ei,p($(U.timestamp)),1)]),e("div",Li,[e("div",Pi,[e("div",Ii,[e("div",Di,[e("div",null,[e("span",{class:H(["badge",T(U.comm_type)])},p(U.comm_type),3),e("strong",Ni,p(_(U)),1),q[1]||(q[1]=e("span",{class:"text-muted mx-1"},"â†’",-1)),e("strong",{class:H({"recipient-channel":U.to_channel_id})},p(w(U)),3)])]),e("div",Oi,p(U.content),1)])])])]))),128))]))],512),X(ki,{"legion-id":n.legionId},null,8,["legion-id"]),X(ni,{"legion-id":n.legionId},null,8,["legion-id"])]))}},Ri=B(Ai,[["__scopeId","data-v-dbad4e39"]]),Ui={class:"spy-view d-flex flex-column overflow-hidden"},qi={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(n){return(t,a)=>(s(),o("div",Ui,[X(Fe,{"session-id":n.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},Fi=B(qi,[["__scopeId","data-v-43a24eaf"]]),Wi={class:"horde-header border-bottom p-3"},Hi={class:"project-name"},Bi={__name:"HordeHeader",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=ae(),m=d(()=>a.projects.get(t.legionId)),i=d(()=>m.value?.name||"Legion");return(l,c)=>(s(),o("div",Wi,[e("div",null,[e("div",Hi,p(i.value),1),c[0]||(c[0]=e("div",{class:"view-name"},"Minion Hierarchy",-1))])]))}},Vi=B(Bi,[["__scopeId","data-v-0c86e2b5"]]),zi={class:"horde-status-bar border-top p-2 bg-light"},Gi={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0}},setup(n){return(t,a)=>(s(),o("div",zi,[...a[0]||(a[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},Ji=B(Gi,[["__scopeId","data-v-f0e64ab0"]]),Ki={class:"minion-card border-start border-2 mb-2"},Yi={class:"node-row"},Qi={class:"node-left"},Zi={key:0,class:"me-2"},Xi={key:1,class:"badge bg-secondary ms-2"},er={class:"node-right"},tr={key:0,class:"last-comm-preview"},sr={class:"comm-direction"},or=["title"],nr={key:1,class:"text-muted fst-italic small"},lr={key:0,class:"minion-children"},ar={key:1,class:"text-danger small ms-4"},ir={__name:"MinionTreeNode",props:{minionData:{type:Object,required:!0},level:{type:Number,default:0}},setup(n){const t=n,a=d(()=>t.level*24),m=d(()=>t.minionData&&t.minionData.children&&t.minionData.children.length>0),i=d(()=>t.minionData&&t.minionData.is_overseer&&m.value),l=d(()=>t.minionData?t.minionData.state==="paused"&&t.minionData.is_processing?"pending-prompt":t.minionData.is_processing?"processing":t.minionData.state||"created":"created"),c=d(()=>{const u=l.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[u]||"status-dot-grey"}),f=d(()=>{const u=l.value;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[u]||"#d3d3d3"}});function r(u){return u.to_user?"User":u.to_minion_name?u.to_minion_name:u.to_channel_name?`#${u.to_channel_name}`:"unknown"}function v(u){const b=u.summary||u.content||"";return b.length>150?b.substring(0,150)+"...":b}return(u,b)=>{const _=qe("MinionTreeNode",!0);return n.minionData?(s(),o("div",{key:0,class:"minion-tree-node",style:me({marginLeft:`${a.value}px`})},[e("div",Ki,[e("div",Yi,[e("div",Qi,[e("div",{class:H(["status-dot me-2",c.value]),style:me(f.value)},null,6),i.value?(s(),o("span",Zi,"ðŸ‘‘")):D("",!0),e("strong",null,p(n.minionData.name),1),i.value?(s(),o("span",Xi,p(n.minionData.children.length)+" "+p(n.minionData.children.length===1?"child":"children"),1)):D("",!0)]),e("div",er,[n.minionData.last_comm?(s(),o("div",tr,[e("span",sr,[b[0]||(b[0]=G(" â†’ ",-1)),e("strong",null,p(r(n.minionData.last_comm)),1),b[1]||(b[1]=G(": ",-1))]),e("span",{class:"comm-content",title:n.minionData.last_comm.content||""},p(v(n.minionData.last_comm)),9,or)])):(s(),o("div",nr," No communications yet "))])])]),m.value?(s(),o("div",lr,[(s(!0),o(Y,null,Z(n.minionData.children,w=>(s(),de(_,{key:w.id,"minion-data":w,level:n.level+1},null,8,["minion-data","level"]))),128))])):D("",!0)],4)):(s(),o("div",ar," âš  Minion data is missing "))}}},rr=B(ir,[["__scopeId","data-v-1cd9863f"]]),cr={class:"horde-view d-flex flex-column h-100"},dr={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},ur={key:0,class:"text-center py-5"},mr={key:1,class:"alert alert-danger"},pr={class:"mb-0"},vr={key:2,class:"horde-tree"},fr={class:"user-root-node mb-3 border rounded bg-white"},gr={class:"node-row"},_r={class:"node-left"},hr={key:0,class:"badge bg-primary ms-2"},br={class:"node-right"},yr={key:0,class:"last-comm-preview"},$r={class:"comm-direction"},wr=["title"],kr={key:1,class:"text-muted fst-italic"},Sr={key:0,class:"alert alert-info ms-4"},Cr={key:1,class:"root-minions ms-4"},xr={__name:"HordeView",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=ae(),m=K(),i=ve(),l=he(),c=L(null),f=L(!1),r=L(null);d(()=>a.projects.get(t.legionId));const v=d(()=>c.value&&c.value.children&&c.value.children.length>0);async function u(){f.value=!0,r.value=null;try{const $=await J.get(`/api/legions/${t.legionId}/hordes`);c.value=$,console.log("Loaded hierarchy:",$)}catch($){console.error("Failed to load hierarchy:",$),r.value=$.message||"Unknown error"}finally{f.value=!1}}ne(()=>{u()}),ee(()=>t.legionId,()=>{u()});function b($){return $.to_user?"User":$.to_minion_name?$.to_minion_name:$.to_channel_name?`#${$.to_channel_name}`:"unknown"}function _($){const y=$.summary||$.content||"";return y.length>150?y.substring(0,150)+"...":y}function w($,y){if($.id===y)return $;if($.children)for(const x of $.children){const N=w(x,y);if(N)return N}return null}function T($){if(c.value){if($.from_minion_id){const y=w(c.value,$.from_minion_id);y&&y.type==="minion"&&(y.last_comm=$,console.log(`Updated minion ${y.name} last_comm`))}$.from_user&&c.value.type==="user"&&(c.value.last_comm=$,console.log("Updated user last_comm"))}}return ne(()=>{u(),l.setCurrentLegion(t.legionId),i.connectLegion(t.legionId),ee(()=>m.sessions,$=>{if(c.value){for(const[y,x]of $)if(x.is_minion&&x.project_id===t.legionId){const N=w(c.value,y);N&&N.type==="minion"&&(N.state!==x.state&&(N.state=x.state,console.log(`Updated minion ${N.name} state to ${x.state}`)),N.is_processing!==x.is_processing&&(N.is_processing=x.is_processing,console.log(`Updated minion ${N.name} is_processing to ${x.is_processing}`)))}}},{deep:!0}),ee(()=>l.commsByLegion.get(t.legionId),$=>{if($&&$.length>0){const y=$[$.length-1];T(y)}},{deep:!0}),ee(()=>m.sessions.size,($,y)=>{$>y&&Array.from(m.sessions.values()).some(S=>S.is_minion&&S.project_id===t.legionId&&!w(c.value,S.session_id))&&(console.log("New minion detected, reloading hierarchy"),u())})}),ce(()=>{console.log("HordeView unmounted")}),($,y)=>(s(),o("div",cr,[X(Vi,{"legion-id":n.legionId},null,8,["legion-id"]),e("div",dr,[f.value?(s(),o("div",ur,[...y[0]||(y[0]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"text-muted mt-2"},"Loading hierarchy...",-1)])])):r.value?(s(),o("div",mr,[y[1]||(y[1]=e("strong",null,"Failed to load hierarchy",-1)),e("p",pr,p(r.value),1)])):c.value?(s(),o("div",vr,[e("div",fr,[e("div",gr,[e("div",_r,[y[2]||(y[2]=e("span",{class:"me-2",style:{"font-size":"1.2rem"}},"ðŸ‘¤",-1)),e("strong",null,p(c.value.name),1),v.value?(s(),o("span",hr,p(c.value.children.length)+" "+p(c.value.children.length===1?"minion":"minions"),1)):D("",!0)]),e("div",br,[c.value.last_comm?(s(),o("div",yr,[e("span",$r,[y[3]||(y[3]=G(" â†’ ",-1)),e("strong",null,p(b(c.value.last_comm)),1),y[4]||(y[4]=G(": ",-1))]),e("span",{class:"comm-content",title:c.value.last_comm.content||""},p(_(c.value.last_comm)),9,wr)])):(s(),o("div",kr," No communications yet "))])])]),v.value?(s(),o("div",Cr,[(s(!0),o(Y,null,Z(c.value.children,x=>(s(),de(rr,{key:x.id,"minion-data":x,level:1},null,8,["minion-data"]))),128))])):(s(),o("div",Sr,[...y[5]||(y[5]=[e("p",{class:"mb-2"},"No minions yet",-1),e("small",{class:"text-muted"},"Create a minion to get started",-1)])]))])):D("",!0)]),X(Ji,{"legion-id":n.legionId},null,8,["legion-id"])]))}},Mr=B(xr,[["__scopeId","data-v-af6338a3"]]),jr={class:"channel-view d-flex flex-column h-100"},Tr={class:"channel-header border-bottom p-3"},Er={class:"d-flex align-items-center justify-content-between"},Lr={class:"mb-0"},Pr={class:"text-muted"},Ir={class:"badge bg-secondary"},Dr={class:"channel-content flex-grow-1 overflow-auto"},Nr={key:0,class:"text-center text-muted py-4"},Or={key:1,class:"text-center text-danger py-4"},Ar={key:2,class:"text-center text-muted py-4"},Rr={key:3,class:"p-3"},Ur={class:"overview-section mb-4"},qr={class:"row g-3"},Fr={class:"col-md-6"},Wr={class:"font-monospace small text-muted"},Hr={class:"col-md-6"},Br={class:"text-muted"},Vr={class:"col-12"},zr={class:"text-muted"},Gr={class:"col-12"},Jr={class:"text-muted"},Kr={class:"members-section mb-4"},Yr={class:"text-muted border-bottom pb-2 d-flex align-items-center justify-content-between"},Qr={key:0,class:"mb-3"},Zr=["value"],Xr={key:1,class:"text-center text-muted py-3"},ec={key:2,class:"list-group"},tc={class:"d-flex align-items-center gap-2"},sc=["title"],oc={class:"fw-semibold"},nc={class:"text-muted"},lc=["onClick"],ac={class:"comms-section"},ic={class:"text-muted border-bottom pb-2"},rc={key:0,class:"text-center text-muted py-4"},cc={key:1,class:"text-center text-muted py-3"},dc={key:2,class:"comm-list"},uc={class:"card-body p-2"},mc={class:"d-flex justify-content-between align-items-start mb-1"},pc={class:"ms-2"},vc={class:"text-muted ms-2"},fc={key:0,class:"text-muted small mb-1"},gc={class:"comm-content"},_c={__name:"ChannelView",props:{legionId:{type:String,required:!0},channelId:{type:String,required:!0}},setup(n){const t=n,a=he(),m=ae(),i=K(),l=L(!0),c=L(null),f=L(!1),r=L(!1),v=L(""),u=d(()=>m.projects.get(t.legionId)),b=d(()=>a.channelDetailsByChannel.get(t.channelId)),_=d(()=>a.channelCommsByChannel.get(t.channelId)||[]),w=d(()=>b.value?.member_minion_ids?.length||0),T=d(()=>_.value.length),$=d(()=>b.value?.member_minion_ids?b.value.member_minion_ids.map(P=>i.sessions.get(P)).filter(Boolean):[]),y=d(()=>{if(!b.value)return[];const P=new Set(b.value.member_minion_ids||[]);return Array.from(i.sessions.values()).filter(h=>h.is_minion).filter(h=>!P.has(h.session_id))});function x(P){if(P.state==="paused"&&P.is_processing)return"status-blinking";const k=P.is_processing?"processing":P.state;return k==="starting"||k==="processing"?"status-blinking":""}function N(P){if(P.state==="paused"&&P.is_processing)return{backgroundColor:"#ffc107"};const k=P.is_processing?"processing":P.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[k]||"#d3d3d3"}}function S(P){return P.from_user?"You":P.from_minion_name?P.from_minion_name:P.from_minion_id&&i.sessions.get(P.from_minion_id)?.name||"Unknown"}function g(P){return{task:"bg-primary",question:"bg-info",report:"bg-success",info:"bg-secondary",halt:"bg-danger",pivot:"bg-warning"}[P?.toLowerCase()]||"bg-secondary"}function q(P){return P?new Date(P).toLocaleString():"N/A"}function U(P){return P?new Date(P).toLocaleString():"N/A"}async function j(){if(!(!v.value||!t.channelId))try{await a.addMemberToChannel(t.channelId,v.value),v.value="",r.value=!1}catch(P){console.error("Failed to add member:",P),alert("Failed to add member to channel")}}async function M(P){if(confirm("Remove this minion from the channel?"))try{await a.removeMemberFromChannel(t.channelId,P)}catch(h){console.error("Failed to remove member:",h),alert("Failed to remove member from channel")}}return ne(async()=>{l.value=!0;try{await a.loadChannelDetails(t.channelId),f.value=!0,await a.loadChannelComms(t.channelId,1e3),f.value=!1}catch(P){console.error("Failed to load channel:",P),c.value=P.message||"Unknown error"}finally{l.value=!1}}),ee(()=>t.channelId,async P=>{if(P){l.value=!0,c.value=null;try{await a.loadChannelDetails(P),f.value=!0,await a.loadChannelComms(P,1e3),f.value=!1}catch(k){console.error("Failed to load channel:",k),c.value=k.message||"Unknown error"}finally{l.value=!1}}}),(P,k)=>(s(),o("div",jr,[e("div",Tr,[e("div",Er,[e("div",null,[e("h5",Lr," ðŸ’¬ "+p(b.value?.name||"Channel"),1),e("small",Pr,p(u.value?.name||"Legion"),1)]),e("span",Ir,p(w.value)+" members",1)])]),e("div",Dr,[l.value?(s(),o("div",Nr,[...k[2]||(k[2]=[e("div",{class:"spinner-border spinner-border-sm",role:"status"},null,-1),e("div",{class:"mt-2"},"Loading channel...",-1)])])):c.value?(s(),o("div",Or," Failed to load channel: "+p(c.value),1)):b.value?(s(),o("div",Rr,[e("div",Ur,[k[7]||(k[7]=e("h6",{class:"text-muted border-bottom pb-2"},"Overview",-1)),e("div",qr,[e("div",Fr,[k[3]||(k[3]=e("strong",null,"Channel ID:",-1)),e("div",Wr,p(b.value.channel_id),1)]),e("div",Hr,[k[4]||(k[4]=e("strong",null,"Created:",-1)),e("div",Br,p(q(b.value.created_at)),1)]),e("div",Vr,[k[5]||(k[5]=e("strong",null,"Purpose:",-1)),e("div",zr,p(b.value.purpose||"No purpose specified"),1)]),e("div",Gr,[k[6]||(k[6]=e("strong",null,"Description:",-1)),e("div",Jr,p(b.value.description||"No description provided"),1)])])]),e("div",Kr,[e("h6",Yr,[e("span",null,"Members ("+p(w.value)+")",1),e("button",{class:"btn btn-sm btn-primary",onClick:k[0]||(k[0]=h=>r.value=!r.value)}," âž• Add Member ")]),r.value?(s(),o("div",Qr,[Q(e("select",{"onUpdate:modelValue":k[1]||(k[1]=h=>v.value=h),class:"form-select form-select-sm",onChange:j},[k[8]||(k[8]=e("option",{value:""},"-- Select Minion to Add --",-1)),(s(!0),o(Y,null,Z(y.value,h=>(s(),o("option",{key:h.session_id,value:h.session_id},p(h.name)+" ("+p(h.role||"No role")+") ",9,Zr))),128))],544),[[ge,v.value]])])):D("",!0),$.value.length===0?(s(),o("div",Xr," No members in this channel yet ")):(s(),o("div",ec,[(s(!0),o(Y,null,Z($.value,h=>(s(),o("div",{key:h.session_id,class:"list-group-item d-flex align-items-center justify-content-between"},[e("div",tc,[e("span",{class:H(["status-dot",x(h)]),style:me(N(h)),title:h.state},null,14,sc),e("div",null,[e("div",oc,p(h.name),1),e("small",nc,p(h.role||"No role"),1)])]),e("button",{class:"btn btn-sm btn-outline-danger",onClick:C=>M(h.session_id),title:"Remove member from channel"}," Remove ",8,lc)]))),128))]))]),e("div",ac,[e("h6",ic,"Communications ("+p(T.value)+")",1),f.value?(s(),o("div",rc,[...k[9]||(k[9]=[e("div",{class:"spinner-border spinner-border-sm",role:"status"},null,-1),e("div",{class:"mt-2"},"Loading comms...",-1)])])):_.value.length===0?(s(),o("div",cc," No communications in this channel yet ")):(s(),o("div",dc,[(s(!0),o(Y,null,Z(_.value,h=>(s(),o("div",{key:h.comm_id,class:"comm-item card mb-2"},[e("div",uc,[e("div",mc,[e("div",null,[e("span",{class:H(["badge",g(h.comm_type)])},p(h.comm_type),3),e("strong",pc,p(S(h)),1),e("small",vc,p(U(h.timestamp)),1)])]),h.summary?(s(),o("div",fc,[k[10]||(k[10]=e("strong",null,"Summary:",-1)),G(" "+p(h.summary),1)])):D("",!0),e("div",gc,p(h.content),1)])]))),128))]))])])):(s(),o("div",Ar," Channel not found "))])]))}},hc=B(_c,[["__scopeId","data-v-e09adf09"]]),bc=[{path:"/",name:"home",component:Ke},{path:"/session/:sessionId",name:"session",component:Fe,props:!0},{path:"/timeline/:legionId",name:"timeline",component:Ri,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:Fi,props:!0},{path:"/horde/:legionId",name:"horde",component:Mr,props:!0},{path:"/channel/:legionId/:channelId",name:"channel",component:hc,props:!0}],yc=He({history:Be(),routes:bc}),$c={__name:"ConnectionIndicator",setup(n){const t=ve(),a=d(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),m=d(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(i,l)=>(s(),o("span",{id:"connection-indicator",class:H(["badge",a.value])},p(m.value),3))}},wc={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},kc={class:"d-flex align-items-center gap-2"},Sc={__name:"AppHeader",setup(n){const t=se();function a(){t.toggleSidebar()}return(m,i)=>(s(),o("header",wc,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:a},[...i[0]||(i[0]=[e("span",null,"â˜°",-1)])]),i[1]||(i[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",kc,[X($c)])]))}},Cc={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},xc={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},Mc=["title"],jc={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,a=d(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function m(f){return f.state==="paused"&&f.is_processing?"pending-prompt":f.is_processing?"processing":f.state}function i(f){const r=m(f);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[r]||"#d3d3d3"}function l(f){const r=m(f);return r==="starting"||r==="processing"||r==="pending-prompt"}function c(f){const r=m(f),v=r.charAt(0).toUpperCase()+r.slice(1),u=f.name||"Unnamed Session",b=f.is_minion&&f.role?` (${f.role})`:"";return`${u}${b}: ${v}`}return(f,r)=>(s(),o("div",Cc,[!n.sessions||n.sessions.length===0?(s(),o("div",xc)):(s(!0),o(Y,{key:1},Z(n.sessions,v=>(s(),o("div",{key:v.session_id,class:H(["progress-bar",{"progress-bar-striped progress-bar-animated":l(v)}]),style:me({width:a.value,backgroundColor:i(v),cursor:"help"}),title:c(v)},null,14,Mc))),128))]))}},Tc=B(jc,[["__scopeId","data-v-a79cfeec"]]),Ec={class:"flex-grow-1"},Lc={key:0,class:"text-muted small ms-1"},Pc={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(n){const t=n,a=pe(),m=K(),i=ae(),l=se(),c=d(()=>m.currentSessionId===t.session.session_id),f=d(()=>m.deletingSessions.has(t.session.session_id)),r=d(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),v=d(()=>{const x=r.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[x]||"status-dot-grey"}),u=d(()=>{const x=r.value,N={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},S={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:N[x]||"#d3d3d3",borderColor:S[x]||"#6c757d"}});function b(){m.selectSession(t.session.session_id),a.push(`/session/${t.session.session_id}`)}function _(){l.showModal("edit-session",{session:t.session})}function w(x){x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("application/session-id",t.session.session_id),x.dataTransfer.setData("application/project-id",t.projectId),x.dataTransfer.setData("text/plain",t.session.session_id),x.target.classList.add("dragging")}function T(x){x.target.classList.remove("dragging")}function $(x){x.preventDefault(),x.dataTransfer.dropEffect="move";const N=x.currentTarget.getBoundingClientRect(),S=N.top+N.height/2;x.clientY<S?(x.currentTarget.classList.add("drop-above"),x.currentTarget.classList.remove("drop-below")):(x.currentTarget.classList.add("drop-below"),x.currentTarget.classList.remove("drop-above"))}function y(x){x.preventDefault(),x.currentTarget.classList.remove("drop-above","drop-below");const N=x.dataTransfer.getData("application/session-id")||x.dataTransfer.getData("text/plain"),S=x.dataTransfer.getData("application/project-id");if(!N||N===t.session.session_id||S!==t.projectId)return;const g=x.currentTarget.getBoundingClientRect(),q=g.top+g.height/2,U=x.clientY<q,j=i.getProject(t.projectId);if(!j||!j.session_ids)return;const M=[...j.session_ids],P=M.indexOf(t.session.session_id),k=M.indexOf(N);if(P===-1||k===-1)return;const h=[...M],[C]=h.splice(k,1);let E=U?P:P+1;k<P&&E--,h.splice(E,0,C),i.reorderSessionsInProject(t.projectId,h)}return(x,N)=>(s(),o("div",{class:H(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:c.value,"session-deleting":f.value}]),style:{cursor:"pointer"},draggable:"true",onClick:b,onDragstart:w,onDragend:T,onDragover:$,onDrop:y},[e("div",{class:H(["status-dot me-2",v.value]),style:me(u.value)},null,6),e("div",Ec,[e("span",null,p(n.session.name||n.session.session_id),1),n.session.is_minion&&n.session.role?(s(),o("span",Lc,"("+p(n.session.role)+")",1)):D("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:re(_,["stop"])}," âœï¸ ")],34))}},Ic=B(Pc,[["__scopeId","data-v-07ecbf94"]]),Dc={class:"d-flex align-items-center gap-2"},Nc=["value"],Oc={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,a=pe(),m=K(),i=se(),l=L("");ee(()=>a.currentRoute.value,$=>{!l.value&&$.name==="spy"&&$.params.minionId&&$.params.legionId===t.project.project_id&&(l.value=$.params.minionId)},{immediate:!0});const c=d(()=>l.value?t.sessions.find($=>$.session_id===l.value):null),f=d(()=>{const $=a.currentRoute.value;return $.name==="spy"&&$.params.legionId===t.project.project_id}),r=d(()=>{if(!c.value)return"";if(c.value.state==="paused"&&c.value.is_processing)return"status-blinking";const $=c.value.is_processing?"processing":c.value.state;return $==="starting"||$==="processing"?"status-blinking":""}),v=d(()=>{if(!c.value)return{};if(c.value.state==="paused"&&c.value.is_processing)return{backgroundColor:"#ffc107"};const $=c.value.is_processing?"processing":c.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[$]||"#d3d3d3"}});function u($){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[$.state]||"â—‹"}function b($){return $.is_minion&&$.role?`${$.name} (${$.role})`:$.name}function _(){l.value&&a.push(`/spy/${t.project.project_id}/${l.value}`)}function w(){l.value?a.push(`/spy/${t.project.project_id}/${l.value}`):a.push("/")}function T(){c.value&&i.showModal("minion-view",{session:c.value})}return ee(()=>m.currentSessionId,$=>{if($)t.sessions.some(y=>y.session_id===$)&&(l.value=$);else{l.value="";const y=a.currentRoute.value;y.name==="spy"&&y.params.legionId===t.project.project_id&&a.push("/")}}),($,y)=>(s(),o("div",{class:H(["list-group-item list-group-item-action p-2",{active:f.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:me({cursor:l.value?"pointer":"default"}),onClick:_},[y[1]||(y[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ”"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),e("div",Dc,[c.value?(s(),o("button",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:re(T,["stop"]),title:"View minion details"}," ðŸ‘ï¸ ")):D("",!0),c.value?(s(),o("span",{key:1,class:H(["minion-state-indicator",r.value]),style:me(v.value)}," ðŸ‘¤ ",6)):D("",!0)])],4),Q(e("select",{"onUpdate:modelValue":y[0]||(y[0]=x=>l.value=x),class:"form-select form-select-sm",onChange:w},[y[2]||(y[2]=e("option",{value:""},"-- Select Minion --",-1)),(s(!0),o(Y,null,Z(n.sessions,x=>(s(),o("option",{key:x.session_id,value:x.session_id},p(u(x))+" "+p(b(x)),9,Nc))),128))],544),[[ge,l.value]])],2))}},Ac=B(Oc,[["__scopeId","data-v-579589fb"]]),Rc={class:"accordion mt-2",id:"channelsAccordion"},Uc={class:"accordion-item"},qc={class:"accordion-header"},Fc={class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#channelsCollapsePanel","aria-expanded":"false","aria-controls":"channelsCollapsePanel"},Wc={class:"text-muted ms-2"},Hc={id:"channelsCollapsePanel",class:"accordion-collapse collapse","data-bs-parent":"#channelsAccordion"},Bc={class:"accordion-body p-0"},Vc={key:0,class:"text-muted text-center py-3",style:{"font-size":"0.875rem"}},zc={key:1,class:"list-group list-group-flush"},Gc=["onClick"],Jc={class:"d-flex align-items-center justify-content-between"},Kc={class:"d-flex align-items-center"},Yc={class:"channel-name"},Qc={class:"badge bg-secondary member-count"},Zc={__name:"ChannelList",props:{project:{type:Object,required:!0}},setup(n){const t=n,a=pe(),m=he(),i=d(()=>m.channelsByLegion.get(t.project.project_id)||[]),l=d(()=>i.value.length);function c(f){a.push(`/channel/${t.project.project_id}/${f}`)}return ne(async()=>{if(t.project.is_multi_agent)try{await m.loadChannels(t.project.project_id)}catch(f){console.error("Failed to load channels:",f)}}),(f,r)=>(s(),o("div",Rc,[e("div",Uc,[e("h2",qc,[e("button",Fc,[r[0]||(r[0]=e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ’¬",-1)),r[1]||(r[1]=e("span",{class:"fw-semibold"},"Channels",-1)),e("small",Wc,"("+p(l.value)+")",1)])]),e("div",Hc,[e("div",Bc,[i.value.length===0?(s(),o("div",Vc," No channels yet ")):(s(),o("div",zc,[(s(!0),o(Y,null,Z(i.value,v=>(s(),o("div",{key:v.channel_id,class:"list-group-item list-group-item-action channel-item",onClick:u=>c(v.channel_id)},[e("div",Jc,[e("div",Kc,[r[2]||(r[2]=e("span",{style:{"font-size":"0.875rem","margin-right":"0.5rem"}},"ðŸ’¬",-1)),e("span",Yc,p(v.name),1)]),e("span",Qc,p(v.member_count||0),1)])],8,Gc))),128))]))])])])]))}},Xc=B(Zc,[["__scopeId","data-v-afd27b61"]]),ed=["data-project-id"],td=["id"],sd=["aria-expanded","aria-controls","onKeydown"],od={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},nd={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},ld={class:"fw-semibold",style:{"flex-shrink":"0"}},ad={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},id={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},rd=["title"],cd=["title"],dd=["id","aria-labelledby"],ud={class:"accordion-body p-0"},md={class:"list-group list-group-flush"},pd={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(n){const t=n,a=pe(),m=ae(),i=K(),l=se(),c=L(t.project.is_expanded||!1),f=d(()=>m.formatPath(t.project.working_directory)),r=d(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(U=>i.getSession(U)).filter(U=>U!=null)),v=d(()=>{const U=a.currentRoute.value;return U.name==="timeline"&&U.params.legionId===t.project.project_id}),u=d(()=>{const U=a.currentRoute.value;return U.name==="horde"&&U.params.legionId===t.project.project_id});function b(U){const j=window.bootstrap;if(!j)return;const M=document.getElementById(`collapse-${t.project.project_id}`);if(!M)return;j.Collapse.getOrCreateInstance(M).toggle()}function _(){c.value||(m.toggleExpansion(t.project.project_id),c.value=!0)}function w(){if(c.value){m.toggleExpansion(t.project.project_id),c.value=!1;const U=i.currentSessionId;U&&i.getSession(U)&&t.project.session_ids?.includes(U)&&a.push("/"),m.currentProjectId===t.project.project_id&&a.push("/")}}function T(){l.showModal("edit-project",{project:t.project})}function $(){t.project.is_multi_agent?l.showModal("create-minion",{project:t.project}):l.showModal("create-session",{project:t.project})}function y(){a.push(`/timeline/${t.project.project_id}`)}function x(){a.push(`/horde/${t.project.project_id}`)}function N(U){U.dataTransfer.effectAllowed="move",U.dataTransfer.setData("application/project-id",t.project.project_id),U.dataTransfer.setData("text/plain",t.project.project_id),U.target.classList.add("dragging")}function S(U){U.target.classList.remove("dragging")}function g(U){U.preventDefault(),U.dataTransfer.dropEffect="move";const j=U.currentTarget.getBoundingClientRect(),M=j.top+j.height/2;U.clientY<M?(U.currentTarget.classList.add("drop-above"),U.currentTarget.classList.remove("drop-below")):(U.currentTarget.classList.add("drop-below"),U.currentTarget.classList.remove("drop-above"))}function q(U){U.preventDefault(),U.currentTarget.classList.remove("drop-above","drop-below");const j=U.dataTransfer.getData("application/project-id")||U.dataTransfer.getData("text/plain");if(!j||j===t.project.project_id)return;const M=U.currentTarget.getBoundingClientRect(),P=M.top+M.height/2,k=U.clientY<P,h=m.orderedProjects,C=h.findIndex(W=>W.project_id===t.project.project_id),E=h.findIndex(W=>W.project_id===j);if(C===-1||E===-1)return;const O=[...h],[R]=O.splice(E,1);let I=k?C:C+1;E<C&&I--,O.splice(I,0,R);const A=O.map(W=>W.project_id);m.reorderProjects(A)}return(U,j)=>(s(),o("div",{class:"accordion-item border rounded mb-2","data-project-id":n.project.project_id,draggable:"true",onDragstart:N,onDragend:S,onDragover:g,onDrop:q},[e("h2",{class:"accordion-header",id:`heading-${n.project.project_id}`},[e("div",{class:H(["accordion-button bg-white p-2",{collapsed:!c.value}]),role:"button",tabindex:"0","aria-expanded":c.value,"aria-controls":`collapse-${n.project.project_id}`,onClick:b,onKeydown:[Se(re(b,["prevent"]),["enter"]),Se(re(b,["prevent"]),["space"])]},[e("div",od,[e("div",nd,[e("div",ld,[n.project.is_multi_agent?(s(),o("span",ad,"ðŸ›")):D("",!0),G(" "+p(n.project.name),1)]),e("div",id,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:re(T,["stop"])}," âœï¸ "),e("button",{class:"btn btn-sm btn-outline-primary",title:n.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:re($,["stop"])}," âž• ",8,rd)])]),e("small",{class:"text-muted font-monospace",title:n.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},p(f.value),9,cd)])],42,sd)],8,td),X(Tc,{project:n.project,sessions:r.value},null,8,["project","sessions"]),e("div",{id:`collapse-${n.project.project_id}`,class:H(["accordion-collapse collapse",{show:c.value}]),"aria-labelledby":`heading-${n.project.project_id}`,onShown:_,onHidden:w},[e("div",ud,[e("div",md,[n.project.is_multi_agent?(s(),o("div",{key:0,class:H(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:v.value}]),style:{cursor:"pointer"},onClick:y},[...j[0]||(j[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ“Š"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):D("",!0),n.project.is_multi_agent?(s(),o(Y,{key:1},[e("div",{class:H(["list-group-item list-group-item-action horde-item d-flex align-items-center p-2",{active:u.value}]),style:{cursor:"pointer"},onClick:x},[...j[1]||(j[1]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸŒ³"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],2),X(Ac,{project:n.project,sessions:r.value},null,8,["project","sessions"]),X(Xc,{project:n.project},null,8,["project"])],64)):(s(!0),o(Y,{key:2},Z(r.value,M=>(s(),de(Ic,{key:M.session_id,session:M,"project-id":n.project.project_id},null,8,["session","project-id"]))),128))])])],42,dd)],40,ed))}},vd=B(pd,[["__scopeId","data-v-04f4e534"]]),fd={class:"project-list"},gd={key:0,class:"text-muted text-center py-3"},_d={__name:"ProjectList",setup(n){const t=ae(),a=d(()=>t.orderedProjects);return(m,i)=>(s(),o("div",fd,[a.value.length===0?(s(),o("div",gd,' No projects yet. Click "New" to create one. ')):D("",!0),(s(!0),o(Y,null,Z(a.value,l=>(s(),de(vd,{key:l.project_id,project:l},null,8,["project"]))),128))]))}},hd={class:"flex-grow-1 overflow-auto p-3"},bd={id:"sessions-container"},yd={__name:"Sidebar",setup(n){const t=se(),a=d(()=>t.sidebarCollapsed),m=d(()=>t.isMobile),i=d(()=>{if(m.value)return{};const u=`${t.sidebarWidth}px`;return{width:u,minWidth:"200px",maxWidth:"30vw","--sidebar-width":u}});function l(){t.showModal("create-project")}const c=L(!1);function f(u){c.value=!0,document.addEventListener("mousemove",r),document.addEventListener("mouseup",v)}function r(u){c.value&&t.setSidebarWidth(u.clientX)}function v(){c.value=!1,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",v)}return(u,b)=>(s(),o("aside",{id:"sidebar",class:H(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:a.value,"mobile-open":!a.value&&m.value,"desktop-collapsed":a.value&&!m.value}]),style:me(i.value)},[e("div",hd,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[b[0]||(b[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:l}," ðŸ“ New ")]),e("div",bd,[X(_d)])]),e("div",{class:"sidebar-resize-handle",onMousedown:f},null,32)],6))}},$d=B(yd,[["__scopeId","data-v-d792f0f0"]]),wd={class:"modal-dialog modal-lg"},kd={class:"modal-content"},Sd={class:"modal-body"},Cd={class:"mb-3"},xd={class:"input-group"},Md=["disabled"],jd={key:0,class:"text-center py-4"},Td={key:1,class:"alert alert-danger",role:"alert"},Ed={key:2,class:"folder-list"},Ld=["onClick","onDblclick"],Pd={class:"d-flex align-items-center flex-grow-1"},Id=["onClick"],Dd={key:1,class:"text-center text-muted py-3"},Nd={class:"modal-footer"},Od=["disabled"],Ad={__name:"FolderBrowserModal",setup(n){const t=se(),a=L(""),m=L(""),i=L([]),l=L(!1),c=L(""),f=L(null);let r=null,v=null;const u=d(()=>{if(!a.value)return null;const S=a.value.split(/[\\/]/).filter(Boolean);return S.length<=1?null:(S.pop(),S.length>0?S.join("/"):"/")});function b(S){if(!S)return"";const g=S.split(/[\\/]/).filter(Boolean);return g.length<=2?S:".../"+g.slice(-2).join("/")}async function _(){l.value=!0,c.value="",i.value=[],m.value="";try{const S=a.value?{path:a.value}:{},g=await J.get("/api/filesystem/browse",{params:S});g.current_path&&(a.value=g.current_path),i.value=g.directories||[]}catch(S){console.error("Failed to load directory:",S),c.value=S.message||"Failed to load directory"}finally{l.value=!1}}function w(S){m.value=S.path}function T(S){a.value=S.path,m.value="",_()}function $(){u.value&&(a.value=u.value,m.value="",_())}function y(){const S=m.value||a.value;S&&v&&v(S),r&&r.hide()}function x(){_()}function N(){i.value=[],m.value="",c.value="",v=null,t.hideModal()}return ee(()=>t.currentModal,S=>{if(S?.name==="folder-browser"&&r){const g=S.data||{};a.value=g.currentPath||"",v=g.onSelect||null,r.show()}}),ne(()=>{f.value&&ie(async()=>{const{default:S}=await import("./modal-B4rHLo2F.js").then(g=>g.m);return{default:S}},__vite__mapDeps([0,1])).then(({default:S})=>{r=new S(f.value),f.value.addEventListener("shown.bs.modal",x),f.value.addEventListener("hidden.bs.modal",N)})}),ce(()=>{f.value&&(f.value.removeEventListener("shown.bs.modal",x),f.value.removeEventListener("hidden.bs.modal",N)),r&&r.dispose()}),(S,g)=>(s(),o("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:f},[e("div",wd,[e("div",kd,[g[7]||(g[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Sd,[e("div",Cd,[g[2]||(g[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",xd,[Q(e("input",{type:"text",class:"form-control","onUpdate:modelValue":g[0]||(g[0]=q=>a.value=q),onKeyup:Se(_,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[le,a.value]]),e("button",{class:"btn btn-outline-secondary",onClick:_,disabled:l.value},[...g[1]||(g[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),G(" Refresh ",-1)])],8,Md)])]),l.value?(s(),o("div",jd,[...g[3]||(g[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):c.value?(s(),o("div",Td,p(c.value),1)):(s(),o("div",Ed,[u.value?(s(),o("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:$,role:"button"},[...g[4]||(g[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):D("",!0),(s(!0),o(Y,null,Z(i.value,q=>(s(),o("div",{key:q.path,class:H(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:q.path===m.value}]),onClick:U=>w(q),onDblclick:U=>T(q),role:"button"},[e("div",Pd,[g[5]||(g[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,p(q.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:re(U=>T(q),["stop"])}," Open ",8,Id)],42,Ld))),128)),i.value.length===0?(s(),o("div",Dd," No subdirectories found ")):D("",!0)]))]),e("div",Nd,[g[6]||(g[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:y,disabled:!m.value},' Select "'+p(b(m.value||a.value))+'" ',9,Od)])])])],512))}},Rd=B(Ad,[["__scopeId","data-v-667c51a9"]]),Ud={class:"modal-dialog"},qd={class:"modal-content"},Fd={class:"modal-body"},Wd={class:"mb-3"},Hd={key:0,class:"invalid-feedback"},Bd={class:"mb-3"},Vd={class:"input-group"},zd={key:0,class:"invalid-feedback"},Gd={class:"mb-3 form-check"},Jd={class:"mb-3 form-check"},Kd={class:"form-check-label",for:"createSession"},Yd={key:0,class:"mb-3 ms-4"},Qd={for:"sessionName",class:"form-label"},Zd={key:1,class:"alert alert-danger",role:"alert"},Xd={class:"modal-footer"},eu=["disabled"],tu={key:0,class:"spinner-border spinner-border-sm me-2"},su={__name:"ProjectCreateModal",setup(n){const t=ae(),a=K(),m=se(),i=L({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),l=L({name:"",workingDirectory:""}),c=L(!1),f=L(""),r=L(null);let v=null;function u(){m.showModal("folder-browser",{currentPath:i.value.workingDirectory||"",onSelect:y=>{i.value.workingDirectory=y,l.value.workingDirectory=""}})}function b(){l.value={};let y=!0;return i.value.name.trim()||(l.value.name="Project name is required",y=!1),i.value.workingDirectory.trim()||(l.value.workingDirectory="Working directory is required",y=!1),y}async function _(){if(b()){c.value=!0,f.value="";try{const y=await t.createProject(i.value.name,i.value.workingDirectory,i.value.isMultiAgent);i.value.createSession&&await a.createSession(y.project_id,{name:i.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),v&&v.hide(),w()}catch(y){console.error("Failed to create project:",y),f.value=y.message||"Failed to create project. Please try again."}finally{c.value=!1}}}function w(){i.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},l.value={},f.value=""}function T(){const y=document.getElementById("projectName");y&&y.focus()}function $(){w(),m.hideModal()}return ee(()=>m.currentModal,y=>{y?.name==="create-project"&&v&&v.show()}),ne(()=>{r.value&&ie(async()=>{const{default:y}=await import("./modal-B4rHLo2F.js").then(x=>x.m);return{default:y}},__vite__mapDeps([0,1])).then(({default:y})=>{v=new y(r.value),r.value.addEventListener("shown.bs.modal",T),r.value.addEventListener("hidden.bs.modal",$)})}),ce(()=>{r.value&&(r.value.removeEventListener("shown.bs.modal",T),r.value.removeEventListener("hidden.bs.modal",$)),v&&v.dispose()}),(y,x)=>(s(),o("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:r},[e("div",Ud,[e("div",qd,[x[11]||(x[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Fd,[e("form",{onSubmit:re(_,["prevent"])},[e("div",Wd,[x[5]||(x[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":l.value.name}]),id:"projectName","onUpdate:modelValue":x[0]||(x[0]=N=>i.value.name=N),placeholder:"My Project",required:""},null,2),[[le,i.value.name]]),l.value.name?(s(),o("div",Hd,p(l.value.name),1)):D("",!0)]),e("div",Bd,[x[6]||(x[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",Vd,[Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":l.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":x[1]||(x[1]=N=>i.value.workingDirectory=N),placeholder:"/path/to/project",required:""},null,2),[[le,i.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:u}," Browse... "),l.value.workingDirectory?(s(),o("div",zd,p(l.value.workingDirectory),1)):D("",!0)]),x[7]||(x[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",Gd,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":x[2]||(x[2]=N=>i.value.isMultiAgent=N)},null,512),[[be,i.value.isMultiAgent]]),x[8]||(x[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," ðŸ› Multi-Agent Project (Legion) ",-1)),x[9]||(x[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",Jd,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":x[3]||(x[3]=N=>i.value.createSession=N)},null,512),[[be,i.value.createSession]]),e("label",Kd," Create initial "+p(i.value.isMultiAgent?"minion":"session"),1)]),i.value.createSession?(s(),o("div",Yd,[e("label",Qd," Initial "+p(i.value.isMultiAgent?"Minion":"Session")+" Name ",1),Q(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":x[4]||(x[4]=N=>i.value.sessionName=N),placeholder:"main"},null,512),[[le,i.value.sessionName]])])):D("",!0),f.value?(s(),o("div",Zd,p(f.value),1)):D("",!0)],32)]),e("div",Xd,[x[10]||(x[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:_,disabled:c.value},[c.value?(s(),o("span",tu)):D("",!0),G(" "+p(c.value?"Creating...":"Create Project"),1)],8,eu)])])])],512))}},ou=B(su,[["__scopeId","data-v-adf50394"]]),nu={class:"modal-dialog"},lu={class:"modal-content"},au={class:"modal-body"},iu={class:"mb-3"},ru={key:0,class:"invalid-feedback"},cu={class:"mb-3"},du=["value"],uu={key:0,class:"alert alert-danger",role:"alert"},mu={class:"danger-zone"},pu={class:"text-muted small"},vu=["disabled"],fu={key:0,class:"alert alert-warning mt-3",role:"alert"},gu={class:"mb-2"},_u={class:"d-flex gap-2"},hu=["disabled"],bu={key:0,class:"spinner-border spinner-border-sm me-2"},yu=["disabled"],$u={class:"modal-footer"},wu=["disabled"],ku={key:0,class:"spinner-border spinner-border-sm me-2"},Su={__name:"ProjectEditModal",setup(n){const t=ae(),a=se(),m=L(null),i=L({name:""}),l=L({name:""}),c=L(!1),f=L(!1),r=L(""),v=L(!1),u=L(null);let b=null;const _=d(()=>m.value?.session_ids?.length||0);function w(){l.value={};let S=!0;return i.value.name.trim()||(l.value.name="Project name is required",S=!1),S}async function T(){if(!(!w()||!m.value)){c.value=!0,r.value="";try{await t.updateProject(m.value.project_id,{name:i.value.name}),b&&b.hide()}catch(S){console.error("Failed to update project:",S),r.value=S.message||"Failed to update project. Please try again."}finally{c.value=!1}}}async function $(){if(m.value){f.value=!0,r.value="";try{await t.deleteProject(m.value.project_id),b&&b.hide()}catch(S){console.error("Failed to delete project:",S),r.value=S.message||"Failed to delete project. Please try again."}finally{f.value=!1}}}function y(){i.value={name:""},l.value={},r.value="",v.value=!1}function x(){const S=document.getElementById("editProjectName");S&&(S.focus(),S.select())}function N(){y(),m.value=null,a.hideModal()}return ee(()=>a.currentModal,S=>{if(S?.name==="edit-project"&&b){const g=S.data||{};m.value=g.project,m.value&&(i.value.name=m.value.name),b.show()}}),ne(()=>{u.value&&ie(async()=>{const{default:S}=await import("./modal-B4rHLo2F.js").then(g=>g.m);return{default:S}},__vite__mapDeps([0,1])).then(({default:S})=>{b=new S(u.value),u.value.addEventListener("shown.bs.modal",x),u.value.addEventListener("hidden.bs.modal",N)})}),ce(()=>{u.value&&(u.value.removeEventListener("shown.bs.modal",x),u.value.removeEventListener("hidden.bs.modal",N)),b&&b.dispose()}),(S,g)=>(s(),o("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:u},[e("div",nu,[e("div",lu,[g[11]||(g[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",au,[e("form",{onSubmit:re(T,["prevent"])},[e("div",iu,[g[3]||(g[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":l.value.name}]),id:"editProjectName","onUpdate:modelValue":g[0]||(g[0]=q=>i.value.name=q),placeholder:"My Project",required:""},null,2),[[le,i.value.name]]),l.value.name?(s(),o("div",ru,p(l.value.name),1)):D("",!0)]),e("div",cu,[g[4]||(g[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:m.value?.working_directory,disabled:"",readonly:""},null,8,du),g[5]||(g[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),r.value?(s(),o("div",uu,p(r.value),1)):D("",!0)],32),g[9]||(g[9]=e("hr",null,null,-1)),e("div",mu,[g[7]||(g[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",pu," Deleting this project will also delete all "+p(_.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:g[1]||(g[1]=q=>v.value=!0),disabled:f.value},[...g[6]||(g[6]=[e("i",{class:"bi bi-trash"},null,-1),G(" Delete Project ",-1)])],8,vu)]),v.value?(s(),o("div",fu,[g[8]||(g[8]=e("strong",null,"Are you sure?",-1)),e("p",gu,' This will permanently delete the project "'+p(m.value?.name)+'" and all '+p(_.value)+" session(s). ",1),e("div",_u,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:$,disabled:f.value},[f.value?(s(),o("span",bu)):D("",!0),G(" "+p(f.value?"Deleting...":"Yes, Delete Permanently"),1)],8,hu),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:g[2]||(g[2]=q=>v.value=!1),disabled:f.value}," Cancel ",8,yu)])])):D("",!0)]),e("div",$u,[g[10]||(g[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:T,disabled:c.value},[c.value?(s(),o("span",ku)):D("",!0),G(" "+p(c.value?"Saving...":"Save Changes"),1)],8,wu)])])])],512))}},Cu=B(Su,[["__scopeId","data-v-6f299f35"]]),xu={class:"modal-dialog modal-lg"},Mu={class:"modal-content"},ju={class:"modal-header"},Tu={class:"modal-title",id:"createSessionModalLabel"},Eu={key:0,class:"text-muted small"},Lu={class:"modal-body"},Pu={class:"mb-3"},Iu={key:0,class:"invalid-feedback"},Du={class:"mb-3"},Nu={class:"mb-3"},Ou={class:"mb-3"},Au={class:"form-text d-flex justify-content-between"},Ru={key:0,class:"invalid-feedback"},Uu={class:"mb-3 form-check"},qu={key:0,class:"form-text text-warning"},Fu={class:"mb-3"},Wu={class:"mb-3 form-check"},Hu={key:0,class:"alert alert-danger",role:"alert"},Bu={class:"modal-footer"},Vu=["disabled"],zu={key:0,class:"spinner-border spinner-border-sm me-2"},Gu={__name:"SessionCreateModal",setup(n){const t=pe();ae();const a=K(),m=se(),i=L(null),l=L({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0}),c=L({name:""}),f=L(!1),r=L(""),v=L(null);let u=null;const b=d(()=>l.value.system_prompt.length),_=d(()=>b.value>6e3),w=d(()=>b.value>5500&&b.value<=6e3);function T(){c.value={};let S=!0;return l.value.name.trim()||(c.value.name="Session name is required",S=!1),_.value&&(S=!1),S}async function $(){if(!(!T()||!i.value)){f.value=!0,r.value="";try{const S=l.value.tools.split(",").map(U=>U.trim()).filter(U=>U.length>0),g={name:l.value.name,permission_mode:l.value.permission_mode,model:l.value.model,system_prompt:l.value.system_prompt.trim()||null,override_system_prompt:l.value.override_system_prompt,tools:S},q=await a.createSession(i.value.project_id,g);l.value.startImmediately&&await a.startSession(q.session_id),t.push(`/session/${q.session_id}`),u&&u.hide(),y()}catch(S){console.error("Failed to create session:",S),r.value=S.message||"Failed to create session. Please try again."}finally{f.value=!1}}}function y(){l.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0},c.value={},r.value=""}function x(){const S=document.getElementById("sessionName");S&&S.focus()}function N(){y(),i.value=null,m.hideModal()}return ee(()=>m.currentModal,S=>{if(S?.name==="create-session"&&u){const g=S.data||{};i.value=g.project,u.show()}}),ne(()=>{v.value&&ie(async()=>{const{default:S}=await import("./modal-B4rHLo2F.js").then(g=>g.m);return{default:S}},__vite__mapDeps([0,1])).then(({default:S})=>{u=new S(v.value),v.value.addEventListener("shown.bs.modal",x),v.value.addEventListener("hidden.bs.modal",N)})}),ce(()=>{v.value&&(v.value.removeEventListener("shown.bs.modal",x),v.value.removeEventListener("hidden.bs.modal",N)),u&&u.dispose()}),(S,g)=>(s(),o("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",xu,[e("div",Mu,[e("div",ju,[e("h5",Tu,[g[7]||(g[7]=G(" Create New Session ",-1)),i.value?(s(),o("span",Eu,"in "+p(i.value.name),1)):D("",!0)]),g[8]||(g[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Lu,[e("form",{onSubmit:re($,["prevent"])},[e("div",Pu,[g[9]||(g[9]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":c.value.name}]),id:"sessionName","onUpdate:modelValue":g[0]||(g[0]=q=>l.value.name=q),placeholder:"main",required:""},null,2),[[le,l.value.name]]),c.value.name?(s(),o("div",Iu,p(c.value.name),1)):D("",!0)]),e("div",Du,[g[11]||(g[11]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Q(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":g[1]||(g[1]=q=>l.value.permission_mode=q)},[...g[10]||(g[10]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"âš ï¸ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[ge,l.value.permission_mode]]),g[12]||(g[12]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",Nu,[g[14]||(g[14]=e("label",{for:"model",class:"form-label"},"Model",-1)),Q(e("select",{class:"form-select",id:"model","onUpdate:modelValue":g[2]||(g[2]=q=>l.value.model=q)},[...g[13]||(g[13]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[ge,l.value.model]])]),e("div",Ou,[g[15]||(g[15]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),Q(e("textarea",{class:H(["form-control",{"is-invalid":_.value}]),id:"systemPrompt","onUpdate:modelValue":g[3]||(g[3]=q=>l.value.system_prompt=q),rows:"3",maxlength:6e3,placeholder:"Additional instructions to append to the system prompt..."},null,2),[[le,l.value.system_prompt]]),e("div",Au,[e("span",null,p(l.value.override_system_prompt?"These instructions will replace Claude Code's default system prompt":"These instructions will be appended to Claude Code's default system prompt"),1),e("span",{class:H({"text-danger":_.value,"text-warning":w.value})},p(b.value)+" / 6000 chars ",3)]),_.value?(s(),o("div",Ru," System prompt exceeds 6000 character limit (Windows command-line constraint) ")):D("",!0)]),e("div",Uu,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":g[4]||(g[4]=q=>l.value.override_system_prompt=q)},null,512),[[be,l.value.override_system_prompt]]),g[17]||(g[17]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom prompt only) ",-1)),l.value.override_system_prompt?(s(),o("div",qu,[...g[16]||(g[16]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom instructions will be used (no Claude Code preset).",-1)])])):D("",!0)]),e("div",Fu,[g[18]||(g[18]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),Q(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":g[5]||(g[5]=q=>l.value.tools=q),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[le,l.value.tools]]),g[19]||(g[19]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",Wu,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":g[6]||(g[6]=q=>l.value.startImmediately=q)},null,512),[[be,l.value.startImmediately]]),g[20]||(g[20]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),r.value?(s(),o("div",Hu,p(r.value),1)):D("",!0)],32)]),e("div",Bu,[g[21]||(g[21]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:$,disabled:f.value},[f.value?(s(),o("span",zu)):D("",!0),G(" "+p(f.value?"Creating...":"Create Session"),1)],8,Vu)])])])],512))}},Ju=B(Gu,[["__scopeId","data-v-5aef47e0"]]),Ku={class:"modal-dialog"},Yu={class:"modal-content"},Qu={class:"modal-body"},Zu={class:"mb-3"},Xu={key:0,class:"invalid-feedback"},em={class:"mb-3"},tm=["value"],sm={class:"mb-3"},om={class:"form-control-plaintext"},nm={class:"mb-3"},lm=["disabled"],am={key:0,value:"bypassPermissions"},im={class:"form-text"},rm={key:0,class:"text-warning"},cm={key:1},dm={key:0,class:"mb-3"},um={class:"card"},mm={class:"card-body"},pm={key:0,class:"mb-2"},vm={key:1,class:"mb-2"},fm={key:2,class:"mt-2"},gm={class:"form-control",style:{height:"auto","min-height":"60px","white-space":"pre-wrap"},readonly:""},_m={key:1,class:"alert alert-danger",role:"alert"},hm={class:"modal-footer"},bm=["disabled"],ym={key:0,class:"spinner-border spinner-border-sm me-2"},$m={__name:"SessionEditModal",setup(n){const t=K(),a=se(),m=L(null),i=L({name:"",permission_mode:"default"}),l=L({name:""}),c=L(!1),f=L(""),r=L(null);let v=null;const u=d(()=>m.value?.state==="active"||m.value?.state==="starting"),b=d(()=>m.value?.initial_permission_mode==="bypassPermissions");function _(N){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[N]||"bg-secondary"}function w(){l.value={};let N=!0;return i.value.name.trim()||(l.value.name="Session name is required",N=!1),N}async function T(){if(!(!w()||!m.value)){c.value=!0,f.value="";try{await t.updateSessionName(m.value.session_id,i.value.name),i.value.permission_mode!==m.value.current_permission_mode&&await t.setPermissionMode(m.value.session_id,i.value.permission_mode),v&&v.hide()}catch(N){console.error("Failed to update session:",N),f.value=N.message||"Failed to update session. Please try again."}finally{c.value=!1}}}function $(){i.value={name:"",permission_mode:"default"},l.value={},f.value=""}function y(){const N=document.getElementById("editSessionName");N&&(N.focus(),N.select())}function x(){$(),m.value=null,a.hideModal()}return ee(()=>a.currentModal,N=>{if(N?.name==="edit-session"&&v){const S=N.data||{};m.value=S.session,m.value&&(i.value.name=m.value.name,i.value.permission_mode=m.value.current_permission_mode||"default"),v.show()}}),ne(()=>{r.value&&ie(async()=>{const{default:N}=await import("./modal-B4rHLo2F.js").then(S=>S.m);return{default:N}},__vite__mapDeps([0,1])).then(({default:N})=>{v=new N(r.value),r.value.addEventListener("shown.bs.modal",y),r.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{r.value&&(r.value.removeEventListener("shown.bs.modal",y),r.value.removeEventListener("hidden.bs.modal",x)),v&&v.dispose()}),(N,S)=>(s(),o("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:r},[e("div",Ku,[e("div",Yu,[S[15]||(S[15]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Qu,[e("form",{onSubmit:re(T,["prevent"])},[e("div",Zu,[S[2]||(S[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":l.value.name}]),id:"editSessionName","onUpdate:modelValue":S[0]||(S[0]=g=>i.value.name=g),placeholder:"Session Name",required:""},null,2),[[le,i.value.name]]),l.value.name?(s(),o("div",Xu,p(l.value.name),1)):D("",!0)]),e("div",em,[S[3]||(S[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:m.value?.working_directory,disabled:"",readonly:""},null,8,tm),S[4]||(S[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",sm,[S[5]||(S[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",om,[e("span",{class:H(["badge",_(m.value?.state)])},p(m.value?.state),3)])]),e("div",nm,[S[9]||(S[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Q(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":S[1]||(S[1]=g=>i.value.permission_mode=g),disabled:!u.value},[S[6]||(S[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),S[7]||(S[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),S[8]||(S[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),b.value?(s(),o("option",am,"âš ï¸ Bypass Permissions (No prompts)")):D("",!0)],8,lm),[[ge,i.value.permission_mode]]),e("div",im,[u.value?(s(),o("span",cm," Controls which tool actions require permission prompts ")):(s(),o("span",rm," âš ï¸ Session must be active to change permission mode. Start the session first. "))])]),m.value?.system_prompt||m.value?.override_system_prompt?(s(),o("div",dm,[S[13]||(S[13]=e("label",{class:"form-label"},"System Prompt Configuration",-1)),e("div",um,[e("div",mm,[m.value?.override_system_prompt?(s(),o("div",pm,[...S[10]||(S[10]=[e("span",{class:"badge bg-warning text-dark"},"Override Mode",-1),e("div",{class:"form-text text-warning mt-1"}," Using custom prompt only (no Claude Code preset) ",-1)])])):(s(),o("div",vm,[...S[11]||(S[11]=[e("span",{class:"badge bg-info"},"Append Mode",-1),e("div",{class:"form-text mt-1"}," Custom instructions appended to Claude Code preset ",-1)])])),m.value?.system_prompt?(s(),o("div",fm,[S[12]||(S[12]=e("strong",{class:"small"},"Custom Instructions:",-1)),e("div",gm,p(m.value.system_prompt),1)])):D("",!0)])])])):D("",!0),f.value?(s(),o("div",_m,p(f.value),1)):D("",!0)],32)]),e("div",hm,[S[14]||(S[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:T,disabled:c.value},[c.value?(s(),o("span",ym)):D("",!0),G(" "+p(c.value?"Saving...":"Save Changes"),1)],8,bm)])])])],512))}},wm=B($m,[["__scopeId","data-v-c99ca17f"]]),km={class:"modal-dialog modal-dialog-centered"},Sm={class:"modal-content"},Cm={class:"modal-header"},xm={class:"modal-title",id:"manageSessionModalLabel"},Mm={class:"modal-body"},jm={key:0,class:"text-center py-4"},Tm={class:"text-muted"},Em={key:1},Lm={key:2},Pm={class:"text-muted"},Im={key:3},Dm={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Nm={class:"d-grid gap-2"},Om=["disabled"],Am=["disabled"],Rm=["disabled"],Um=["disabled"],qm={class:"modal-footer"},Fm={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Wm={__name:"SessionManageModal",setup(n){const t=pe(),a=K(),m=se(),i=ve();ue();const l=L(null),c=L(!1),f=L(""),r=L(""),v=L(null),u=L(null);let b=null;const _=d(()=>v.value==="reset"?"Reset Session":v.value==="delete"?"Delete Session":"Manage Session");function w(){v.value="reset"}function T(){v.value="delete"}function $(){v.value=null}async function y(){v.value==="reset"?await S():v.value==="delete"&&await g()}async function x(){if(l.value){c.value=!0,f.value="Restarting session...";try{const j=l.value.session_id,M=await J.post(`/api/sessions/${j}/restart`);if(M.success)console.log("Session restarted successfully, reconnecting"),await i.disconnectSession(),a.currentSessionId=null,await a.selectSession(j),b&&b.hide();else{const P=M.error||M.detail||"Failed to restart session";console.error("Failed to restart session:",P),r.value=`Failed to restart session: ${P}`}}catch(j){console.error("Error restarting session:",j);const M=j.data?.detail||j.message||"Unknown error";r.value=`Error restarting session: ${M}`}finally{c.value=!1}}}async function N(){if(l.value)try{b&&b.hide(),console.log("Ending session",l.value.session_id);const j=l.value.session_id;await J.post(`/api/sessions/${j}/terminate`),await i.disconnectSession(),a.currentSessionId===j&&(a.currentSessionId=null),t.push("/")}catch(j){console.error("Error ending session:",j),await i.disconnectSession(),a.currentSessionId===l.value?.session_id&&(a.currentSessionId=null),t.push("/")}}async function S(){if(l.value){c.value=!0,f.value="Resetting session...";try{const j=l.value.session_id,M=await J.post(`/api/sessions/${j}/reset`);if(M.success)console.log("Session reset successfully, reconnecting"),await i.disconnectSession(),a.currentSessionId=null,await a.selectSession(j),b&&b.hide();else{const P=M.error||M.detail||"Failed to reset session";console.error("Failed to reset session:",P),r.value=`Failed to reset session: ${P}`,v.value=null}}catch(j){console.error("Error resetting session:",j);const M=j.data?.detail||j.message||"Unknown error";r.value=`Error resetting session: ${M}`,v.value=null}finally{c.value=!1}}}async function g(){if(l.value){c.value=!0,f.value="Deleting session...";try{const j=l.value.session_id;await a.deleteSession(j),t.currentRoute.value.params.sessionId===j&&t.push("/"),b&&b.hide()}catch(j){console.error("Error deleting session:",j);const M=j.data?.detail||j.message||"Unknown error";r.value=`Error deleting session: ${M}`,v.value=null}finally{c.value=!1}}}function q(){v.value=null,c.value=!1,f.value="",r.value=""}function U(){q(),l.value=null,m.hideModal()}return ee(()=>m.currentModal,j=>{if(j?.name==="manage-session"&&b){const M=j.data||{};l.value=M.session,q(),b.show()}}),ne(()=>{u.value&&ie(async()=>{const{default:j}=await import("./modal-B4rHLo2F.js").then(M=>M.m);return{default:j}},__vite__mapDeps([0,1])).then(({default:j})=>{b=new j(u.value),u.value.addEventListener("hidden.bs.modal",U)})}),ce(()=>{u.value&&u.value.removeEventListener("hidden.bs.modal",U),b&&b.dispose()}),(j,M)=>(s(),o("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:u},[e("div",km,[e("div",Sm,[e("div",Cm,[e("h5",xm,p(v.value?_.value:"Manage Session"),1),M[1]||(M[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Mm,[c.value?(s(),o("div",jm,[M[2]||(M[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Tm,p(f.value),1)])):v.value==="reset"?(s(),o("div",Em,[...M[3]||(M[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):v.value==="delete"?(s(),o("div",Lm,[M[6]||(M[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1)),e("p",Pm,[M[4]||(M[4]=G("This will permanently delete session ",-1)),e("strong",null,p(l.value?.name),1),M[5]||(M[5]=G(".",-1))]),M[7]||(M[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(s(),o("div",Im,[r.value?(s(),o("div",Dm,[M[8]||(M[8]=e("strong",null,"Error:",-1)),G(" "+p(r.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:M[0]||(M[0]=P=>r.value="")})])):D("",!0),M[15]||(M[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",Nm,[e("button",{class:"btn btn-outline-primary text-start",onClick:x,disabled:c.value},[...M[9]||(M[9]=[e("strong",null,"ðŸ”„ Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,Om),e("button",{class:"btn btn-outline-secondary text-start",onClick:N,disabled:c.value},[...M[10]||(M[10]=[e("strong",null,"ðŸšª End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,Am),M[13]||(M[13]=e("hr",{class:"my-2"},null,-1)),M[14]||(M[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"âš ï¸ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:w,disabled:c.value},[...M[11]||(M[11]=[e("strong",null,"ðŸ—‘ï¸ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,Rm),e("button",{class:"btn btn-outline-danger text-start",onClick:T,disabled:c.value},[...M[12]||(M[12]=[e("strong",null,"âŒ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,Um)]),M[16]||(M[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),G(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",qm,[v.value&&!c.value?(s(),o(Y,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:$},"Cancel"),e("button",{type:"button",class:H(["btn",v.value==="delete"?"btn-danger":"btn-warning"]),onClick:y},p(v.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):c.value?D("",!0):(s(),o("button",Fm,"Cancel"))])])])],512))}},Hm=B(Wm,[["__scopeId","data-v-de7ff18c"]]),Bm={class:"modal-dialog modal-dialog-centered modal-lg"},Vm={class:"modal-content"},zm={class:"modal-body"},Gm={key:0,class:"text-center text-muted py-4"},Jm={key:1},Km={class:"mb-3"},Ym={class:"font-monospace small"},Qm={class:"mb-3"},Zm={class:"font-monospace small"},Xm={class:"mb-3"},ep={class:"mb-3"},tp={class:"mb-3"},sp={key:0},op={class:"d-flex flex-wrap gap-1"},np={key:1,class:"text-muted small"},lp={key:0,class:"mb-3"},ap={class:"d-flex flex-wrap gap-1"},ip={key:1,class:"mb-3"},rp={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},cp={class:"mb-3"},dp={class:"text-muted"},up={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},mp={__name:"SessionInfoModal",setup(n){const t=K(),a=ue(),m=se(),i=L(null),l=L(!1),c=L(null);let f=null;const r=d(()=>{if(!i.value)return null;const _=t.initData.get(i.value);return _||(a.messagesBySession.get(i.value)||[]).find($=>$.type==="system"&&($.subtype==="init"||$.metadata?.subtype==="init")&&$.metadata?.init_data)?.metadata?.init_data||null});function v(_){return typeof _=="string"?_:typeof _=="object"&&_.type==="preset"?`Preset: ${_.preset}`:JSON.stringify(_,null,2)}function u(){i.value=null,l.value=!1}function b(){u(),m.hideModal()}return ee(()=>m.currentModal,_=>{if(_?.name==="session-info"&&f){const w=_.data||{};i.value=w.sessionId,l.value=!1,f.show()}}),ne(()=>{c.value&&ie(async()=>{const{default:_}=await import("./modal-B4rHLo2F.js").then(w=>w.m);return{default:_}},__vite__mapDeps([0,1])).then(({default:_})=>{f=new _(c.value),c.value.addEventListener("hidden.bs.modal",b)})}),ce(()=>{c.value&&c.value.removeEventListener("hidden.bs.modal",b),f&&f.dispose()}),(_,w)=>(s(),o("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:c},[e("div",Bm,[e("div",Vm,[w[9]||(w[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",zm,[r.value?(s(),o("div",Jm,[e("div",Km,[w[1]||(w[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Ym,p(i.value),1)]),e("div",Qm,[w[2]||(w[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",Zm,p(r.value.cwd||"Not specified"),1)]),e("div",Xm,[w[3]||(w[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,p(r.value.model||"Default"),1)]),e("div",ep,[w[4]||(w[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,p(r.value.permissionMode||"default"),1)]),e("div",tp,[w[5]||(w[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),r.value.tools&&r.value.tools.length>0?(s(),o("div",sp,[e("div",op,[(s(!0),o(Y,null,Z(r.value.tools,T=>(s(),o("span",{key:T,class:"badge bg-secondary"},p(T),1))),128))])])):(s(),o("div",np,"All tools available"))]),r.value.commands&&r.value.commands.length>0?(s(),o("div",lp,[w[6]||(w[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",ap,[(s(!0),o(Y,null,Z(r.value.commands,T=>(s(),o("span",{key:T,class:"badge bg-info"},p(T),1))),128))])])):D("",!0),r.value.systemPrompt?(s(),o("div",ip,[w[7]||(w[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",rp,p(v(r.value.systemPrompt)),1)])):D("",!0),e("div",cp,[e("h6",dp,[w[8]||(w[8]=G(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:w[0]||(w[0]=T=>l.value=!l.value)},p(l.value?"Hide":"Show"),1)]),l.value?(s(),o("pre",up,p(JSON.stringify(r.value,null,2)),1)):D("",!0)])])):(s(),o("div",Gm," No session configuration data available "))]),w[10]||(w[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},pp=B(mp,[["__scopeId","data-v-809e2099"]]),vp={class:"modal-dialog modal-dialog-centered"},fp={class:"modal-content"},gp={class:"modal-body"},_p={class:"mb-3"},hp={class:"mb-3"},bp={class:"mb-3"},yp={class:"form-text d-flex justify-content-between"},$p={key:0,class:"invalid-feedback"},wp={class:"mb-3 form-check"},kp={key:0,class:"form-text text-warning"},Sp={class:"mb-3"},Cp={key:0,class:"alert alert-danger"},xp={class:"modal-footer"},Mp=["disabled"],jp={key:0,class:"spinner-border spinner-border-sm me-2"},Tp={__name:"CreateMinionModal",setup(n){const t=pe(),a=ae(),m=K(),i=se(),l=L(null);let c=null;const f=L(null),r=L({name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]}),v=L(""),u=L(""),b=L(!1),_=d(()=>v.value.trim()?v.value.split(",").map(S=>S.trim()).filter(S=>S.length>0):[]),w=d(()=>r.value.initialization_context.length),T=d(()=>w.value>2e3),$=d(()=>w.value>1800&&w.value<=2e3);function y(){r.value={name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]},v.value="",u.value="",b.value=!1}function x(){y(),i.hideModal()}async function N(){if(!r.value.name.trim()){u.value="Minion name is required";return}if(r.value.name.includes(" ")){u.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(T.value){u.value="Initialization context exceeds 2000 character limit";return}if(!f.value){u.value="Legion ID is missing";return}b.value=!0,u.value="";try{const S={name:r.value.name.trim(),role:r.value.role.trim(),initialization_context:r.value.initialization_context.trim(),override_system_prompt:r.value.override_system_prompt,capabilities:_.value},g=await J.post(`/api/legions/${f.value}/minions`,S);g.success&&g.minion_id?(await a.fetchProjects(),await m.fetchSessions(),c&&c.hide(),t.push(`/spy/${f.value}/${g.minion_id}`)):u.value="Failed to create minion"}catch(S){console.error("Failed to create minion:",S),u.value=S.response?.data?.detail||"Failed to create minion"}finally{b.value=!1}}return ee(()=>i.currentModal,S=>{if(S?.name==="create-minion"&&c){const g=S.data||{};f.value=g.project?.project_id||null,y(),c.show()}}),ne(()=>{l.value&&ie(()=>import("./modal-B4rHLo2F.js").then(S=>S.m),__vite__mapDeps([0,1])).then(S=>{const g=S.default;c=new g(l.value),l.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{l.value&&l.value.removeEventListener("hidden.bs.modal",x),c&&c.dispose()}),(S,g)=>(s(),o("div",{ref_key:"modalElement",ref:l,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",vp,[e("div",fp,[g[15]||(g[15]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",gp,[e("form",{onSubmit:re(N,["prevent"])},[e("div",_p,[g[5]||(g[5]=e("label",{for:"minion-name",class:"form-label"},[G(" Name "),e("span",{class:"text-danger"},"*")],-1)),Q(e("input",{id:"minion-name","onUpdate:modelValue":g[0]||(g[0]=q=>r.value.name=q),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[le,r.value.name]]),g[6]||(g[6]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",hp,[g[7]||(g[7]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),Q(e("input",{id:"minion-role","onUpdate:modelValue":g[1]||(g[1]=q=>r.value.role=q),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[le,r.value.role]]),g[8]||(g[8]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",bp,[g[9]||(g[9]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),Q(e("textarea",{id:"minion-context","onUpdate:modelValue":g[2]||(g[2]=q=>r.value.initialization_context=q),class:H(["form-control",{"is-invalid":T.value}]),rows:"4",maxlength:2e3,placeholder:"Instructions and context for the minion..."},null,2),[[le,r.value.initialization_context]]),e("div",yp,[e("span",null,p(r.value.override_system_prompt?"This context will replace Claude Code's preset and legion guide":"This context will be appended to legion guide and Claude Code's preset"),1),e("span",{class:H({"text-danger":T.value,"text-warning":$.value})},p(w.value)+" / 2000 chars ",3)]),T.value?(s(),o("div",$p," Initialization context exceeds 2000 character limit (Windows command-line constraint) ")):D("",!0)]),e("div",wp,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":g[3]||(g[3]=q=>r.value.override_system_prompt=q)},null,512),[[be,r.value.override_system_prompt]]),g[11]||(g[11]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom context only) ",-1)),r.value.override_system_prompt?(s(),o("div",kp,[...g[10]||(g[10]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom context will be used (no legion guide or Claude Code preset).",-1)])])):D("",!0)]),e("div",Sp,[g[12]||(g[12]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),Q(e("input",{id:"minion-capabilities","onUpdate:modelValue":g[4]||(g[4]=q=>v.value=q),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[le,v.value]]),g[13]||(g[13]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),u.value?(s(),o("div",Cp,p(u.value),1)):D("",!0)],32)]),e("div",xp,[g[14]||(g[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!r.value.name.trim()||b.value,onClick:N},[b.value?(s(),o("span",jp)):D("",!0),G(" "+p(b.value?"Creating...":"Create Minion"),1)],8,Mp)])])])],512))}},Ep=B(Tp,[["__scopeId","data-v-d7434e2a"]]),Lp={class:"modal-dialog modal-dialog-centered modal-lg"},Pp={class:"modal-content"},Ip={class:"modal-body"},Dp={key:0,class:"text-center text-muted py-4"},Np={key:1},Op={class:"mb-3"},Ap={class:"mb-3"},Rp={class:"font-monospace small"},Up={class:"mb-3"},qp={class:"mb-3"},Fp={class:"mb-3"},Wp={key:0},Hp={class:"d-flex flex-wrap gap-1"},Bp={key:1,class:"text-muted small"},Vp={class:"mb-3"},zp={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto","white-space":"pre-wrap"}},Gp={key:1,class:"text-muted small"},Jp={class:"mb-3"},Kp={key:0,class:"badge bg-info"},Yp={key:1,class:"badge bg-secondary"},Qp={class:"mb-3"},Zp={key:0,class:"font-monospace small"},Xp={key:1,class:"text-muted small"},ev={key:0,class:"mb-3"},tv={key:0},sv={class:"list-unstyled mb-0"},ov={key:1,class:"text-muted small"},nv={class:"mb-3"},lv={key:0,class:"font-monospace small"},av={key:1,class:"text-muted small"},iv={class:"mb-3"},rv={key:0},cv={class:"d-flex flex-wrap gap-1"},dv={key:1,class:"text-muted small"},uv={class:"mb-3"},mv={class:"small"},pv={class:"mb-3"},vv={class:"small"},fv={__name:"MinionViewModal",setup(n){const t=se(),a=L(null),m=L(null);let i=null;function l(v){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[v]||"bg-secondary"}function c(v){if(!v)return"N/A";try{const u=new Date(v);return isNaN(u.getTime())?"Invalid date":u.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(u){return console.error("Error formatting timestamp:",u),"Invalid date"}}function f(){a.value=null}function r(){f(),t.hideModal()}return ee(()=>t.currentModal,v=>{if(v?.name==="minion-view"&&i){const u=v.data||{};a.value=u.session,i.show()}}),ne(()=>{m.value&&ie(async()=>{const{default:v}=await import("./modal-B4rHLo2F.js").then(u=>u.m);return{default:v}},__vite__mapDeps([0,1])).then(({default:v})=>{i=new v(m.value),m.value.addEventListener("hidden.bs.modal",r)})}),ce(()=>{m.value&&m.value.removeEventListener("hidden.bs.modal",r),i&&i.dispose()}),(v,u)=>(s(),o("div",{class:"modal fade",id:"minionViewModal",tabindex:"-1","aria-labelledby":"minionViewModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:m},[e("div",Lp,[e("div",Pp,[u[13]||(u[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"minionViewModalLabel"},"Minion Details"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Ip,[a.value?(s(),o("div",Np,[e("div",Op,[u[0]||(u[0]=e("h6",{class:"text-muted"},"Name",-1)),e("div",null,p(a.value.name||"Unnamed Minion"),1)]),e("div",Ap,[u[1]||(u[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Rp,p(a.value.session_id),1)]),e("div",Up,[u[2]||(u[2]=e("h6",{class:"text-muted"},"Role",-1)),e("div",null,p(a.value.role||"Not specified"),1)]),e("div",qp,[u[3]||(u[3]=e("h6",{class:"text-muted"},"Current State",-1)),e("div",null,[e("span",{class:H(["badge",l(a.value.state)])},p(a.value.state),3)])]),e("div",Fp,[u[4]||(u[4]=e("h6",{class:"text-muted"},"Capabilities",-1)),a.value.capabilities&&a.value.capabilities.length>0?(s(),o("div",Wp,[e("div",Hp,[(s(!0),o(Y,null,Z(a.value.capabilities,b=>(s(),o("span",{key:b,class:"badge bg-secondary"},p(b),1))),128))])])):(s(),o("div",Bp,"None"))]),e("div",Vp,[u[5]||(u[5]=e("h6",{class:"text-muted"},"Initialization Context",-1)),a.value.initialization_context?(s(),o("div",zp,p(a.value.initialization_context),1)):(s(),o("div",Gp,"Not specified"))]),e("div",Jp,[u[6]||(u[6]=e("h6",{class:"text-muted"},"Overseer",-1)),e("div",null,[a.value.is_overseer?(s(),o("span",Kp,"Yes")):(s(),o("span",Yp,"No"))])]),e("div",Qp,[u[7]||(u[7]=e("h6",{class:"text-muted"},"Parent Overseer",-1)),a.value.parent_overseer_id?(s(),o("div",Zp,p(a.value.parent_overseer_id),1)):(s(),o("div",Xp,p(a.value.is_minion?"Root overseer (user-created)":"N/A"),1))]),a.value.is_overseer?(s(),o("div",ev,[u[8]||(u[8]=e("h6",{class:"text-muted"},"Child Minions",-1)),a.value.child_minion_ids&&a.value.child_minion_ids.length>0?(s(),o("div",tv,[e("ul",sv,[(s(!0),o(Y,null,Z(a.value.child_minion_ids,b=>(s(),o("li",{key:b,class:"font-monospace small"},p(b),1))),128))])])):(s(),o("div",ov,"No children"))])):D("",!0),e("div",nv,[u[9]||(u[9]=e("h6",{class:"text-muted"},"Horde Membership",-1)),a.value.horde_id?(s(),o("div",lv,p(a.value.horde_id),1)):(s(),o("div",av,"Not in a horde"))]),e("div",iv,[u[10]||(u[10]=e("h6",{class:"text-muted"},"Channel Memberships",-1)),a.value.channel_ids&&a.value.channel_ids.length>0?(s(),o("div",rv,[e("div",cv,[(s(!0),o(Y,null,Z(a.value.channel_ids,b=>(s(),o("span",{key:b,class:"badge bg-info"},p(b),1))),128))])])):(s(),o("div",dv,"No channels"))]),e("div",uv,[u[11]||(u[11]=e("h6",{class:"text-muted"},"Created",-1)),e("div",mv,p(c(a.value.created_at)),1)]),e("div",pv,[u[12]||(u[12]=e("h6",{class:"text-muted"},"Last Active",-1)),e("div",vv,p(c(a.value.updated_at)),1)])])):(s(),o("div",Dp," No minion data available "))]),u[14]||(u[14]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},gv=B(fv,[["__scopeId","data-v-c44eaee2"]]),_v={class:"container-fluid vh-100 d-flex flex-column p-0"},hv={class:"d-flex flex-grow-1 overflow-hidden position-relative"},bv={class:"flex-grow-1 d-flex flex-column overflow-hidden"},yv={__name:"App",setup(n){const t=se(),a=ve(),m=K(),i=ae(),l=pe(),c=d(()=>t.sidebarCollapsed),f=d(()=>t.isMobile);ne(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),a.connectUI(),await Promise.all([i.fetchProjects(),m.fetchSessions()]);const u=window.location.hash;if(u.startsWith("#/session/")){const b=u.replace("#/session/","");m.sessions.has(b)&&await m.selectSession(b)}else if(u.startsWith("#/timeline/")){const b=u.replace("#/timeline/","");l.push(`/timeline/${b}`)}window.addEventListener("popstate",r),window.addEventListener("resize",t.handleResize)}),ce(()=>{window.removeEventListener("popstate",r),window.removeEventListener("resize",t.handleResize),a.disconnectUI()});function r(){const u=window.location.hash;if(u.startsWith("#/session/")){const b=u.replace("#/session/","");m.sessions.has(b)&&m.selectSession(b)}}function v(){t.toggleSidebar()}return(u,b)=>{const _=qe("router-view");return s(),o("div",_v,[X(Sc),e("div",{id:"sidebar-backdrop",class:H({show:!c.value&&f.value}),onClick:v},null,2),e("div",hv,[X($d),e("main",bv,[X(_)])]),X(Rd),X(ou),X(Cu),X(Ju),X(wm),X(Hm),X(pp),X(Ep),X(gv)])}}},Le=Ve(yv);Le.use(ze());Le.use(yc);Le.mount("#app");
