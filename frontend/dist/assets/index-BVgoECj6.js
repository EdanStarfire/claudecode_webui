const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as a,a as e,o as l,d as ve,r as I,b as u,t as f,n as ue,e as U,f as H,u as be,w as X,g as Me,h as P,F as Q,i as Z,j as re,k as Oe,l as K,v as te,m as Y,p as le,q as Se,s as Ne,x as ie,y as ae,z as me,A as Ae,B as Re,C as Ue,D as ce,E as fe,G as We,H as He}from"./vue-vendor-BChC3Sgv.js";import{m as ge,p as ke}from"./markdown-vendor-CQ3OZdP9.js";import{c as Fe}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const p of n.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function c(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=c(o);fetch(o.href,n)}})();const Be={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},Ve={__name:"NoSessionSelected",setup(s){return(t,c)=>(l(),a("div",Be,[...c[0]||(c[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},ze="modulepreload",Je=function(s){return"/"+s},Te={},ne=function(t,c,r){let o=Promise.resolve();if(c&&c.length>0){let i=function(v){return Promise.all(v.map(b=>Promise.resolve(b).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),g=p?.nonce||p?.getAttribute("nonce");o=i(c.map(v=>{if(v=Je(v),v in Te)return;Te[v]=!0;const b=v.endsWith(".css"),y=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${y}`))return;const _=document.createElement("link");if(_.rel=b?"stylesheet":ze,b||(_.as="script"),_.crossOrigin="",_.href=v,g&&_.setAttribute("nonce",g),document.head.appendChild(_),b)return new Promise((h,x)=>{_.addEventListener("load",h),_.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${v}`)))})}))}function n(p){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=p,window.dispatchEvent(g),!g.defaultPrevented)throw p}return o.then(p=>{for(const g of p||[])g.status==="rejected"&&n(g.reason);return t().catch(n)})};class ye extends Error{constructor(t,c,r){super(t),this.name="APIError",this.status=c,this.data=r}}async function _e(s,t={}){try{const c=await fetch(s,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!c.ok){let o;try{o=await c.json()}catch{o={detail:c.statusText}}throw new ye(o.detail||`HTTP ${c.status}: ${c.statusText}`,c.status,o)}const r=c.headers.get("content-type");return r&&r.includes("application/json")?await c.json():await c.text()}catch(c){throw c instanceof ye?c:(console.error("API request failed:",c),new ye(`Network error: ${c.message}`,0,null))}}async function Ge(s,t={}){let c=s;if(t.params){const r=new URLSearchParams;for(const[g,i]of Object.entries(t.params))i!=null&&r.append(g,i);const o=r.toString();o&&(c=`${s}?${o}`);const{params:n,...p}=t;return _e(c,{...p,method:"GET"})}return _e(c,{...t,method:"GET"})}async function Ke(s,t,c={}){return _e(s,{...c,method:"POST",body:JSON.stringify(t)})}async function Ye(s,t,c={}){return _e(s,{...c,method:"PUT",body:JSON.stringify(t)})}async function Qe(s,t={}){return _e(s,{...t,method:"DELETE"})}const G={get:Ge,post:Ke,put:Ye,delete:Qe},J=ve("session",()=>{const s=I(new Map),t=I(null),c=I(new Map),r=I(new Map),o=I(new Set),n=I(!1);let p=null;const g=u(()=>s.value.get(t.value)),i=u(()=>Array.from(s.value.values()).sort((S,j)=>S.order-j.order)),v=S=>u(()=>i.value.filter(j=>j.project_id===S)),b=u({get:()=>c.value.get(t.value)||"",set:S=>{t.value&&c.value.set(t.value,S)}});async function y(){try{const S=await G.get("/api/sessions");return s.value.clear(),S.sessions.forEach(j=>{s.value.set(j.session_id,j)}),console.log(`Loaded ${s.value.size} sessions`),S.sessions}catch(S){throw console.error("Failed to fetch sessions:",S),S}}async function _(S,j){try{const k=(await G.post("/api/sessions",{project_id:S,...j})).session_id,L=(await G.get(`/api/sessions/${k}`)).session;return s.value.set(k,L),s.value=new Map(s.value),console.log(`Created session ${k}`),L}catch(E){throw console.error("Failed to create session:",E),E}}async function h(S){if(t.value===S&&!n.value)return;p&&(console.log(`Aborting pending selection to switch to ${S}`),p.abort(),p=null);const j=new AbortController;p=j,n.value=!0;try{if(t.value=S,j.signal.aborted){console.log(`Selection of ${S} aborted early`);return}let E=s.value.get(S);if(!E)try{const L=await G.get(`/api/sessions/${S}`);if(j.signal.aborted){console.log(`Selection of ${S} aborted after fetch`);return}E=L.session,s.value.set(S,E),s.value=new Map(s.value),console.log(`Fetched session ${S} for deeplink`)}catch(L){console.error(`Failed to fetch session ${S}:`,L);return}if(E&&(E.state==="created"||E.state==="terminated"))try{if(await C(S),j.signal.aborted){console.log(`Selection of ${S} aborted after start`);return}console.log(`Auto-started session ${S} (was in ${E.state} state)`);const L=6e4,W=200,B=5e3;let D=0,A=0;for(;D<L;){if(j.signal.aborted){console.log(`Selection of ${S} aborted during state wait`);return}const V=s.value.get(S);if(V&&V.state==="active"){console.log(`Session ${S} is now active after ${D}ms`);break}if(D-A>=B){const F=s.value.get(S)?.state||"unknown";console.log(`Waiting for session ${S} to become active (current: ${F}, ${D/1e3}s elapsed)`),A=D}await new Promise(F=>setTimeout(F,W)),D+=W}const q=s.value.get(S);q&&q.state!=="active"&&console.warn(`Session ${S} did not become active within ${L/1e3}s (state: ${q.state}), continuing anyway`)}catch(L){console.error(`Failed to auto-start session ${S}:`,L)}if(j.signal.aborted){console.log(`Selection of ${S} aborted before message load`);return}if(await(await ne(()=>Promise.resolve().then(()=>_t),void 0)).useMessageStore().loadMessages(S),j.signal.aborted){console.log(`Selection of ${S} aborted after message load`);return}await(await ne(()=>Promise.resolve().then(()=>qt),void 0)).useWebSocketStore().connectSession(S),j.signal.aborted||console.log(`Selected session ${S}`)}finally{p===j&&(p=null),n.value=!1}}function x(S,j){const E=s.value.get(S);E&&(Object.assign(E,j),s.value=new Map(s.value))}async function T(S){o.value.add(S);try{await G.delete(`/api/sessions/${S}`),s.value.delete(S),c.value.delete(S),r.value.delete(S),s.value=new Map(s.value),t.value===S&&(t.value=null),console.log(`Deleted session ${S}`)}catch(j){throw console.error("Failed to delete session:",j),j}finally{o.value.delete(S)}}async function w(S,j){try{await G.put(`/api/sessions/${S}/name`,{name:j}),x(S,{name:j}),console.log(`Updated session ${S} name to "${j}"`)}catch(E){throw console.error("Failed to update session name:",E),E}}async function $(S,j){try{await G.post(`/api/sessions/${S}/permission-mode`,{mode:j}),x(S,{current_permission_mode:j});const E=r.value.get(S);E&&(E.permissionMode=j,r.value.set(S,E)),console.log(`Set permission mode for session ${S} to ${j}`)}catch(E){throw console.error("Failed to set permission mode:",E),E}}async function C(S){try{await G.post(`/api/sessions/${S}/start`),console.log(`Started session ${S}`)}catch(j){throw console.error("Failed to start session:",j),j}}async function m(S){try{await G.post(`/api/sessions/${S}/pause`),console.log(`Paused session ${S}`)}catch(j){throw console.error("Failed to pause session:",j),j}}async function d(S){try{await G.post(`/api/sessions/${S}/terminate`),console.log(`Terminated session ${S}`)}catch(j){throw console.error("Failed to terminate session:",j),j}}function M(S){return s.value.get(S)}function N(S,j){r.value.set(S,j),j.permissionMode&&x(S,{current_permission_mode:j.permissionMode})}return{sessions:s,currentSessionId:t,inputCache:c,initData:r,deletingSessions:o,currentSession:g,orderedSessions:i,sessionsInProject:v,currentInput:b,fetchSessions:y,createSession:_,selectSession:h,updateSession:x,deleteSession:T,updateSessionName:w,setPermissionMode:$,startSession:C,pauseSession:m,terminateSession:d,getSession:M,storeInitData:N}}),Ee=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:J},Symbol.toStringTag,{value:"Module"})),ee=ve("ui",()=>{const s=I(window.innerWidth<768),t=I(300),c=I(window.innerWidth),r=u(()=>c.value<768),o=I(!0),n=I(null),p=I(null),g=u(()=>n.value?{name:n.value,data:p.value}:null),i=I(!1),v=I("Loading...");function b(){s.value=!s.value}function y(m){s.value=m}function _(m){t.value=Math.max(200,Math.min(m,window.innerWidth*.3))}function h(m){o.value=m}function x(m,d=null){n.value=null,p.value=null,setTimeout(()=>{n.value=m,p.value=d},0)}function T(){n.value=null,p.value=null}function w(m="Loading..."){i.value=!0,v.value=m}function $(){i.value=!1}function C(){const m=c.value;c.value=window.innerWidth,c.value<768&&m>=768?s.value=!0:c.value>=768&&m<768&&(s.value=!1)}return{sidebarCollapsed:s,sidebarWidth:t,isMobile:r,autoScrollEnabled:o,activeModal:n,modalData:p,currentModal:g,isLoading:i,loadingMessage:v,toggleSidebar:b,setSidebarCollapsed:y,setSidebarWidth:_,setAutoScroll:h,showModal:x,hideModal:T,showLoading:w,hideLoading:$,handleResize:C}}),se=ve("project",()=>{const s=I(new Map),t=I(null),c=u(()=>s.value.get(t.value)),r=u(()=>Array.from(s.value.values()).sort((T,w)=>T.order-w.order)),o=T=>s.value.get(T)?.is_multi_agent||!1;async function n(){try{const T=await G.get("/api/projects");return s.value.clear(),T.projects.forEach(w=>{s.value.set(w.project_id,w)}),console.log(`Loaded ${s.value.size} projects`),T.projects}catch(T){throw console.error("Failed to fetch projects:",T),T}}async function p(T,w,$=!1){try{const m=(await G.post("/api/projects",{name:T,working_directory:w,is_multi_agent:$})).project;return s.value.set(m.project_id,m),s.value=new Map(s.value),console.log(`Created project ${m.project_id}`),m}catch(C){throw console.error("Failed to create project:",C),C}}async function g(T,w){try{await G.put(`/api/projects/${T}`,w),i(T,w),console.log(`Updated project ${T}`,w)}catch($){throw console.error("Failed to update project:",$),$}}function i(T,w){const $=s.value.get(T);$&&(Object.assign($,w),s.value=new Map(s.value))}async function v(T){try{await G.delete(`/api/projects/${T}`),s.value.delete(T),s.value=new Map(s.value),t.value===T&&(t.value=null),console.log(`Deleted project ${T}`)}catch(w){throw console.error("Failed to delete project:",w),w}}async function b(T){try{const w=await G.put(`/api/projects/${T}/toggle-expansion`),$=s.value.get(T);return $&&($.is_expanded=w.is_expanded,s.value=new Map(s.value)),w.is_expanded}catch(w){throw console.error("Failed to toggle expansion:",w),w}}async function y(T){try{await G.put("/api/projects/reorder",{project_ids:T}),T.forEach((w,$)=>{const C=s.value.get(w);C&&(C.order=$)}),s.value=new Map(s.value),console.log("Reordered projects",T)}catch(w){throw console.error("Failed to reorder projects:",w),w}}async function _(T,w){try{await G.put(`/api/projects/${T}/sessions/reorder`,{session_ids:w});const $=s.value.get(T);$&&($.session_ids=w,s.value=new Map(s.value)),console.log(`Reordered sessions in project ${T}`,w)}catch($){throw console.error("Failed to reorder sessions:",$),$}}function h(T){return s.value.get(T)}function x(T){if(!T)return"";const w=T.split(/[/\\]/).filter($=>$);return w.length===0?"/":w.length===1?`/${w[0]}`:w.length===2?`/${w.join("/")}`:`.../${w.slice(-2).join("/")}`}return{projects:s,currentProjectId:t,currentProject:c,orderedProjects:r,isMultiAgent:o,fetchProjects:n,createProject:p,updateProject:g,updateProjectLocal:i,deleteProject:v,toggleExpansion:b,reorderProjects:y,reorderSessionsInProject:_,getProject:h,formatPath:x}}),R=(s,t)=>{const c=s.__vccOpts||s;for(const[r,o]of t)c[r]=o;return c},Ze={class:"session-header border-bottom p-3"},Xe={class:"project-name"},et=["title"],tt={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,c=J(),r=se(),o=u(()=>c.sessions.get(t.sessionId)),n=u(()=>o.value?.name||t.sessionId),p=u(()=>{for(const i of r.projects.values())if(i.session_ids?.includes(t.sessionId))return i;return null}),g=u(()=>p.value?.name||"Unknown Project");return(i,v)=>(l(),a("div",Ze,[e("div",null,[e("div",Xe,f(g.value),1),e("div",{class:"session-name",title:s.sessionId},f(n.value),9,et)])]))}},st=R(tt,[["__scopeId","data-v-89e9c269"]]),ot={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},nt=["title"],lt={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},at={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,c=J(),r=u(()=>c.sessions.get(t.sessionId)),o=u(()=>r.value?r.value.state==="paused"&&r.value.is_processing?"pending-prompt":r.value.is_processing?"processing":r.value.state:"unknown"),n=u(()=>{const i=o.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[i]||"#d3d3d3"}),p=u(()=>{const i=o.value;return i==="starting"||i==="processing"||i==="pending-prompt"}),g=u(()=>{if(!r.value)return"No session selected";const i=o.value,v=i.charAt(0).toUpperCase()+i.slice(1).replace("-"," "),b=r.value.name||"Unnamed Session",y=r.value.is_minion&&r.value.role?` (${r.value.role})`:"";return`${b}${y}: ${v}`});return(i,v)=>(l(),a("div",ot,[r.value?(l(),a("div",{key:0,class:U(["progress-bar",{"progress-bar-striped progress-bar-animated":p.value}]),style:ue({width:"100%",backgroundColor:n.value}),title:g.value},null,14,nt)):(l(),a("div",lt))]))}},rt=R(at,[["__scopeId","data-v-e8795bb7"]]),it={class:"session-status-bar border-top p-2 bg-light"},ut={class:"d-flex justify-content-between align-items-center gap-2"},ct={class:"d-flex gap-2"},dt=["disabled"],mt={class:"mode-label"},pt=["disabled"],vt=["disabled"],ft={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,c=J(),r=ee(),o=u(()=>c.sessions.get(t.sessionId)),n=u(()=>o.value?.current_permission_mode||"default"),p={default:"ðŸ”’",acceptEdits:"âœï¸",plan:"ðŸ“‹",bypassPermissions:"â˜¢ï¸"},g=u(()=>p[n.value]||"ðŸ”’"),i=u(()=>n.value),v=["default","acceptEdits","plan"],b=async()=>{if(!o.value)return;if(n.value==="bypassPermissions"){try{await c.setPermissionMode(t.sessionId,"default")}catch($){console.error("Failed to cycle permission mode:",$)}return}const T=(v.indexOf(n.value)+1)%v.length,w=v[T];try{await c.setPermissionMode(t.sessionId,w)}catch($){console.error("Failed to cycle permission mode:",$)}},y=()=>{r.showModal("session-info",{sessionId:t.sessionId})},_=()=>{r.showModal("manage-session",{session:o.value})},h=()=>{r.setAutoScroll(!r.autoScrollEnabled)};return(x,T)=>(l(),a("div",it,[e("div",ut,[e("div",ct,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:b,disabled:!o.value},[H(f(g.value)+" ",1),e("span",mt,f(i.value),1)],8,dt),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:y,disabled:!o.value},[...T[0]||(T[0]=[H(" â„¹ï¸ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,pt),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:_,disabled:!o.value},[...T[1]||(T[1]=[H(" âš™ï¸ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,vt)]),e("div",null,[e("button",{class:U(["btn btn-sm",be(r).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:h}," â¬‡ï¸ "+f(be(r).autoScrollEnabled?"ON":"OFF"),3)])])]))}},gt=R(ft,[["__scopeId","data-v-fdcd3535"]]),de=ve("message",()=>{const s=I(new Map),t=I(new Map),c=I(new Map),r=I(new Map),o=I(new Map),n=I(new Map),p=u(()=>{const E=J();return s.value.get(E.currentSessionId)||[]}),g=u(()=>{const E=J();return t.value.get(E.currentSessionId)||[]});async function i(E,k=null,O=0){try{const L=k||1e4,W=await G.get(`/api/sessions/${E}/messages?limit=${L}&offset=${O}`),B=W.messages||[],D=W.total_count||B.length,A=W.has_more||!1;console.log(`Loaded ${B.length} of ${D} messages for session ${E}`),s.value.set(E,B);const q=new Set;B.forEach(z=>{z.type==="assistant"&&z.metadata?.tool_uses&&z.metadata.tool_uses.forEach(oe=>{q.add(oe.id)}),z.type==="user"&&z.metadata?.tool_results&&z.metadata.tool_results.forEach(oe=>{q.delete(oe.tool_use_id);const je=n.value.get(E);je&&je.delete(oe.tool_use_id)}),z.type==="system"&&z.metadata?.subtype==="client_launched"&&(q.forEach(oe=>{m(E,oe,"Session was restarted")}),q.clear()),z.type==="system"&&z.metadata?.subtype==="interrupt"&&(q.forEach(oe=>{m(E,oe,"Session was interrupted")}),q.clear()),z.metadata?.has_tool_uses&&z.metadata.tool_uses&&z.metadata.tool_uses.forEach(oe=>{h(E,oe)}),z.metadata?.has_tool_results&&z.metadata.tool_results&&z.metadata.tool_results.forEach(oe=>{w(E,oe)}),(z.type==="permission_request"||z.metadata?.has_permission_requests)&&x(E,z),z.type==="system"&&(z.subtype==="init"||z.metadata?.subtype==="init")&&z.metadata?.init_data&&J().storeInitData(E,z.metadata.init_data)});const F=J().sessions.get(E);return F&&!["active","paused","starting"].includes(F.state)&&(q.forEach(z=>{m(E,z,"Session was terminated")}),q.clear()),o.value.set(E,q),s.value=new Map(s.value),A&&console.warn(`Warning: Only loaded ${B.length} of ${D} messages. Some messages may be missing.`),{messages:B,totalCount:D,hasMore:A}}catch(L){throw console.error("Failed to load messages:",L),L}}function v(E,k){const O=o.value.get(E)||new Set;k.type==="assistant"&&k.metadata?.tool_uses&&k.metadata.tool_uses.forEach(L=>{O.add(L.id)}),k.type==="user"&&k.metadata?.tool_results&&k.metadata.tool_results.forEach(L=>{O.delete(L.tool_use_id);const W=n.value.get(E);W&&W.delete(L.tool_use_id)}),k.type==="system"&&k.metadata?.subtype==="client_launched"&&(O.forEach(L=>{m(E,L,"Session was restarted")}),O.clear()),k.type==="system"&&k.metadata?.subtype==="interrupt"&&(O.forEach(L=>{m(E,L,"Session was interrupted")}),O.clear()),o.value.set(E,O)}function b(E,k){s.value.has(E)||s.value.set(E,[]),s.value.get(E).push(k),v(E,k),s.value=new Map(s.value)}function y(E,k){t.value.has(E)||t.value.set(E,[]),t.value.get(E).push(k),t.value=new Map(t.value)}function _(E,k,O){const L=t.value.get(E);if(L){const W=L.find(B=>B.id===k);W&&(Object.assign(W,O),t.value=new Map(t.value))}}function h(E,k){const O=C(k.name,k.input);c.value.set(O,k.id);const L={id:k.id,name:k.name,input:k.input,signature:O,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return y(E,L),console.log(`Created tool call ${L.id} for ${L.name}`),L}function x(E,k){console.log("handlePermissionRequest received:",k);const O=k.metadata?.tool_name||k.tool_name,L=k.metadata?.input_params||k.input_params,W=k.metadata?.request_id||k.request_id,B=k.metadata?.suggestions||k.suggestions||[];console.log("Extracted data:",{toolName:O,inputParams:L,requestId:W,suggestions:B});const D=C(O,L),A=c.value.get(D);A?(r.value.set(W,A),_(E,A,{status:"permission_required",permissionRequestId:W,suggestions:B}),console.log(`Permission required for tool ${A}`,{suggestions:B})):console.warn("No tool use ID found for permission request signature:",D,{toolName:O,inputParams:L,availableSignatures:Array.from(c.value.keys())})}function T(E,k){const O=r.value.get(k.request_id);if(O){const L={permissionDecision:k.decision,appliedUpdates:k.applied_updates||[]};k.decision==="allow"?L.status="executing":(L.status="completed",L.result={error:!0,message:k.reasoning||"Permission denied"},L.isExpanded=!1),_(E,O,L),console.log(`Permission ${k.decision} for tool ${O}`)}}function w(E,k){const O=k.tool_use_id;_(E,O,{status:k.is_error?"error":"completed",result:{error:k.is_error,content:k.content},isExpanded:!1}),console.log(`Tool ${O} ${k.is_error?"failed":"completed"}`)}function $(E,k){const O=t.value.get(E);if(O){const L=O.find(W=>W.id===k);L&&(L.isExpanded=!L.isExpanded,t.value=new Map(t.value))}}function C(E,k){if(!E)return"unknown:{}";if(!k||typeof k!="object")return`${E}:{}`;const O=JSON.stringify(k,Object.keys(k).sort());return`${E}:${O}`}function m(E,k,O){const L=n.value.get(E)||new Map;L.set(k,{reason:"denied",message:O}),n.value.set(E,L);const W=t.value.get(E);if(W){const B=W.find(D=>D.id===k);B&&B.isExpanded&&(B.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${k} as orphaned: ${O}`)}function d(E,k){return n.value.get(E)?.has(k)||!1}function M(E,k){return n.value.get(E)?.get(k)}function N(E,k){const O=o.value.get(E);O&&O.size>0&&(O.forEach(L=>m(E,L,k)),O.clear())}function S(E){s.value.delete(E),t.value.delete(E),s.value=new Map(s.value),t.value=new Map(t.value)}const j=J();return X(()=>Array.from(j.sessions.values()).map(k=>({id:k.session_id,state:k.state})),(E,k)=>{k&&E.forEach((O,L)=>{const W=k[L];if(!W||W.id!==O.id)return;const B=["active","paused","starting"].includes(W.state),D=!["active","paused","starting"].includes(O.state);B&&D&&N(O.id,"Session was terminated")})},{deep:!0}),{messagesBySession:s,toolCallsBySession:t,activeToolUses:Me(o),orphanedToolUses:Me(n),currentMessages:p,currentToolCalls:g,loadMessages:i,addMessage:b,addToolCall:y,updateToolCall:_,handleToolUse:h,handlePermissionRequest:x,handlePermissionResponse:T,handleToolResult:w,toggleToolExpansion:$,clearMessages:S,markToolUseOrphaned:m,isToolUseOrphaned:d,getOrphanedInfo:M,clearOrphanedToolUses:N}}),_t=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:de},Symbol.toStringTag,{value:"Module"}));function bt(s){if(!s)return new Date;if(typeof s=="string"){const t=new Date(s);return isNaN(t.getTime())?new Date:t}return typeof s=="number"?s<1e10?new Date(s*1e3):new Date(s):new Date}function he(s){return bt(s).toLocaleTimeString()}const ht={class:"card user-message bg-light border-start border-primary border-3"},yt={class:"card-body"},$t={class:"d-flex justify-content-between align-items-center mb-2"},wt={class:"text-muted"},St=["innerHTML"],kt={key:0,class:"tool-results mt-3"},Ct={class:"tool-results-header text-muted small mb-2"},xt={class:"d-flex align-items-start gap-2"},jt={class:"flex-grow-1"},Mt={class:"text-muted"},Tt={key:0,class:"text-danger small"},Et={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s;ge.setOptions({breaks:!0,gfm:!0});const c=u(()=>he(t.message.timestamp)),r=u(()=>{const g=t.message.content||"",i=ge.parse(g);return ke.sanitize(i)}),o=u(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),n=u(()=>t.message.metadata?.tool_results||[]);function p(g,i){return g?g.length<=i?g:g.substring(0,i)+"...":""}return(g,i)=>(l(),a("div",ht,[e("div",yt,[e("div",$t,[i[0]||(i[0]=e("div",{class:"d-flex align-items-center gap-2"},[e("span",{class:"message-icon"},"ðŸ‘¤"),e("strong",{class:"message-role"},"User")],-1)),e("small",wt,f(c.value),1)]),e("div",{class:"message-content",innerHTML:r.value},null,8,St),o.value?(l(),a("div",kt,[e("div",Ct,[i[1]||(i[1]=e("i",{class:"bi bi-tools"},null,-1)),H(" Tool Results ("+f(n.value.length)+") ",1)]),(l(!0),a(Q,null,Z(n.value,(v,b)=>(l(),a("div",{key:b,class:U(["tool-result-summary p-2 mb-2 rounded",v.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",xt,[e("span",null,f(v.is_error?"âŒ":"âœ…"),1),e("div",jt,[e("small",Mt,"Tool: "+f(v.tool_use_id),1),v.is_error?(l(),a("div",Tt,f(p(v.content,200)),1)):P("",!0)])])],2))),128))])):P("",!0)])]))}},Pt=R(Et,[["__scopeId","data-v-532549d1"]]),It={class:"thinking-block"},Lt={class:"text-muted ms-auto"},Dt={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},Ot=["innerHTML"],Nt={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(s){const t=s,c=I(!1),r=u(()=>t.thinking?.length||0),o=u(()=>{const p=t.thinking||"",g=ge.parse(p);return ke.sanitize(g)});function n(){c.value=!c.value}return(p,g)=>(l(),a("div",It,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:n},[e("i",{class:U(["bi",c.value?"bi-chevron-down":"bi-chevron-right"])},null,2),g[0]||(g[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),H(" Thinking ")],-1)),e("small",Lt,f(r.value)+" characters",1)]),c.value?(l(),a("div",Dt,[e("div",{class:"thinking-text",innerHTML:o.value},null,8,Ot)])):P("",!0)]))}},At=R(Nt,[["__scopeId","data-v-619a8344"]]),pe=ve("websocket",()=>{const s=I(null),t=I(!1),c=I(0),r=10,o=I(null),n=I(!1),p=I(0),g=5,i=I(null);let v=null;const b=I(0),y=I(null),_=I(null),h=I(!1),x=I(0),T=5,w=I(null),$=u(()=>t.value&&(n.value||!i.value)?"connected":t.value?"partial":"disconnected");function C(D){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${D}`}function m(){if(s.value)return;const D=C("/ws/ui");console.log(`Connecting to UI WebSocket: ${D}`),s.value=new WebSocket(D),s.value.onopen=()=>{t.value=!0,c.value=0,console.log("UI WebSocket connected")},s.value.onmessage=A=>{const q=JSON.parse(A.data);k(q)},s.value.onclose=()=>{if(t.value=!1,s.value=null,console.log("UI WebSocket closed"),c.value<r){c.value++;const A=Math.min(2e3*c.value,3e4);console.log(`Reconnecting UI WebSocket in ${A}ms (attempt ${c.value})`),setTimeout(m,A)}},s.value.onerror=A=>{console.error("UI WebSocket error:",A)}}function d(){s.value&&(s.value.close(),s.value=null,t.value=!1)}async function M(D){b.value++;const A=b.value;if(console.log(`[Gen ${A}] Starting connection to session ${D}`),v&&(clearTimeout(v),v=null),await N(),b.value!==A){console.log(`[Gen ${A}] Connection cancelled (current generation: ${b.value})`);return}i.value=D,y.value=A;const q=C(`/ws/session/${D}`);console.log(`[Gen ${A}] Connecting to Session WebSocket: ${q}`),o.value=new WebSocket(q),o.value.onopen=()=>{if(y.value!==A){console.log(`[Gen ${A}] Ignoring onopen (stale connection, current: ${y.value})`),o.value.close();return}n.value=!0,p.value=0,console.log(`[Gen ${A}] Session WebSocket connected for ${D}`)},o.value.onmessage=V=>{if(y.value!==A){console.log(`[Gen ${A}] Ignoring message (stale connection, current: ${y.value})`);return}const F=JSON.parse(V.data);O(F,D)},o.value.onclose=()=>{n.value=!1,o.value=null,console.log(`[Gen ${A}] Session WebSocket closed for ${D}`);const V=J();if(V.currentSessionId===D&&y.value===A&&p.value<g){p.value++;const F=Math.min(2e3*p.value,3e4);console.log(`[Gen ${A}] Reconnecting Session WebSocket in ${F}ms (attempt ${p.value})`),v=setTimeout(()=>{y.value===A&&V.currentSessionId===D?(v=null,M(D)):console.log(`[Gen ${A}] Skipping reconnect (generation or session changed)`)},F)}},o.value.onerror=V=>{console.error(`[Gen ${A}] Session WebSocket error:`,V)}}function N(){return new Promise(D=>{if(v&&(clearTimeout(v),v=null,console.log("Cancelled pending session reconnect timer")),o.value){const A=()=>{o.value=null,n.value=!1,i.value=null,y.value=null,p.value=0,D()};if(o.value.readyState===WebSocket.CLOSED)A();else{const q=setTimeout(()=>{console.warn("Session WebSocket close timeout - forcing cleanup"),A()},2e3);o.value.addEventListener("close",()=>{clearTimeout(q),A()},{once:!0}),o.value.close()}}else i.value=null,y.value=null,D()})}function S(D){o.value&&n.value?(o.value.send(JSON.stringify({type:"send_message",content:D})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function j(D,A,q=!1,V=null){if(o.value&&n.value){const F={type:"permission_response",request_id:D,decision:A,apply_suggestions:q,timestamp:new Date().toISOString()};V&&(F.clarification_message=V),o.value.send(JSON.stringify(F)),console.log(`Sent permission ${A} for request ${D}`,{applySuggestions:q,clarification:V})}}function E(){o.value&&n.value&&(o.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function k(D){const A=J(),q=se();switch(D.type){case"sessions_list":D.sessions&&Array.isArray(D.sessions)&&D.sessions.forEach(V=>{A.updateSession(V.session_id,V)});break;case"state_change":D.data&&D.data.session_id&&D.data.session&&A.updateSession(D.data.session_id,D.data.session);break;case"project_updated":if(D.data&&D.data.project){const V=D.data.project;q.updateProjectLocal(V.project_id,V)}break;case"project_deleted":D.data&&D.data.project_id&&q.projects.delete(D.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":s.value?.readyState===WebSocket.OPEN&&s.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",D.type)}}function O(D,A){const q=J();if(q.currentSessionId!==A){console.warn(`Ignoring message for session ${A} (current: ${q.currentSessionId})`);return}const V=de();switch(D.type){case"message":const F=D.data;if(!F||!F.type){console.warn("Received message event with invalid data:",D);break}if(F.type==="permission_request"){V.handlePermissionRequest(A,F);break}if(F.type==="permission_response"){V.handlePermissionResponse(A,F);break}F.metadata?.has_tool_uses&&F.metadata.tool_uses.forEach(z=>{V.handleToolUse(A,z)}),F.metadata?.has_tool_results&&F.metadata.tool_results.forEach(z=>{V.handleToolResult(A,z)}),F.type==="system"&&(F.subtype==="init"||F.metadata?.subtype==="init")&&F.metadata?.init_data&&q.storeInitData(A,F.metadata.init_data),V.addMessage(A,F);break;case"permission_request":V.handlePermissionRequest(A,D);break;case"permission_response":V.handlePermissionResponse(A,D);break;case"tool_result":V.handleToolResult(A,D);break;case"state_change":q.updateSession(A,D.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${A}`);break;case"ping":o.value?.readyState===WebSocket.OPEN&&o.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function L(D){W(),w.value=D;const A=C(`/ws/legion/${D}`);console.log(`Connecting to Legion WebSocket: ${A}`),_.value=new WebSocket(A),_.value.onopen=()=>{h.value=!0,x.value=0,console.log(`Legion WebSocket connected for ${D}`)},_.value.onmessage=q=>{const V=JSON.parse(q.data);B(V,D)},_.value.onclose=()=>{if(h.value=!1,_.value=null,console.log(`Legion WebSocket closed for ${D}`),w.value===D&&x.value<T){x.value++;const q=Math.min(2e3*x.value,3e4);setTimeout(()=>L(D),q)}},_.value.onerror=q=>{console.error("Legion WebSocket error:",q)}}function W(){_.value&&(_.value.close(),_.value=null,h.value=!1,w.value=null)}function B(D,A){ne(async()=>{const{useLegionStore:q}=await Promise.resolve().then(()=>nr);return{useLegionStore:q}},void 0).then(({useLegionStore:q})=>{const V=q();switch(D.type){case"comm":D.comm&&(V.addComm(A,D.comm),console.log("Legion WebSocket: Received new comm",D.comm));break;case"minion_created":D.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",D.data),ne(async()=>{const{useSessionStore:F}=await Promise.resolve().then(()=>Ee);return{useSessionStore:F}},void 0).then(({useSessionStore:F})=>{F().loadSessions()}));break;case"minion_updated":D.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",D.data),ne(async()=>{const{useSessionStore:F}=await Promise.resolve().then(()=>Ee);return{useSessionStore:F}},void 0).then(({useSessionStore:F})=>{F().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${A}`);break;case"ping":_.value?.readyState===WebSocket.OPEN&&_.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",D.type)}})}return{uiConnected:t,sessionConnected:n,legionConnected:h,overallStatus:$,connectUI:m,disconnectUI:d,connectSession:M,disconnectSession:N,sendMessage:S,sendPermissionResponse:j,interruptSession:E,connectLegion:L,disconnectLegion:W}}),qt=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:pe},Symbol.toStringTag,{value:"Module"})),Rt={class:"base-tool-handler"},Ut={class:"tool-section mb-3"},Wt={class:"tool-parameters"},Ht={class:"tool-code"},Ft={key:0,class:"tool-section"},Bt={class:"tool-section-label"},Vt={class:"tool-code"},zt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),r=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),o=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),n=u(()=>{if(!r.value)return"";const p=t.toolCall.result;return p.content!==void 0?typeof p.content=="string"?p.content:JSON.stringify(p.content,null,2):p.message?p.message:JSON.stringify(p,null,2)});return(p,g)=>(l(),a("div",Rt,[e("div",Ut,[g[0]||(g[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Wt,[e("pre",Ht,f(c.value),1)])]),r.value?(l(),a("div",Ft,[e("div",Bt,f(o.value?"Error:":"Result:"),1),e("div",{class:U(["tool-result",{"tool-result-error":o.value}])},[e("pre",Vt,f(n.value),1)],2)])):P("",!0)]))}},Jt=R(zt,[["__scopeId","data-v-06a1b6c0"]]),Gt={class:"read-tool-handler"},Kt={class:"tool-section mb-3"},Yt={class:"read-file-info"},Qt={class:"file-path"},Zt={key:0,class:"read-range"},Xt={key:0,class:"tool-section"},es={key:0,class:"tool-result tool-result-error"},ts={class:"tool-code"},ss={key:1,class:"file-content-preview"},os={class:"content-header"},ns={class:"line-count-badge"},ls={key:0,class:"preview-note"},as={class:"tool-code content-display"},rs={key:0,class:"more-indicator"},$e=100,is={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.input?.file_path||"Unknown"),r=u(()=>{const h=t.toolCall.input?.offset,x=t.toolCall.input?.limit;return h!==void 0||x!==void 0}),o=u(()=>{const h=t.toolCall.input?.offset;return h!==void 0?h+1:1}),n=u(()=>{const h=t.toolCall.input?.offset||0,x=t.toolCall.input?.limit;return x!==void 0?h+x:"âˆž"}),p=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),g=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),i=u(()=>{if(!p.value)return"";const h=t.toolCall.result;return h.content!==void 0?typeof h.content=="string"?h.content:JSON.stringify(h.content,null,2):h.message?h.message:JSON.stringify(h,null,2)}),v=u(()=>g.value||!i.value?[]:i.value.split(`
`)),b=u(()=>v.value.length),y=u(()=>b.value>$e),_=u(()=>g.value?"":v.value.slice(0,$e).join(`
`));return(h,x)=>(l(),a("div",Gt,[e("div",Kt,[e("div",Yt,[x[0]||(x[0]=e("span",{class:"file-icon"},"ðŸ“„",-1)),x[1]||(x[1]=e("strong",null,"Reading:",-1)),e("code",Qt,f(c.value),1),r.value?(l(),a("span",Zt,"Lines "+f(o.value)+"-"+f(n.value),1)):P("",!0)])]),p.value?(l(),a("div",Xt,[g.value?(l(),a("div",es,[e("pre",ts,f(i.value),1)])):(l(),a("div",ss,[e("div",os,[x[2]||(x[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",ns,f(b.value)+" lines",1),y.value?(l(),a("span",ls,"(showing first "+f($e)+")")):P("",!0)]),e("pre",as,f(_.value),1),y.value?(l(),a("div",rs,"...")):P("",!0)]))])):P("",!0)]))}},us=R(is,[["__scopeId","data-v-0382f812"]]),cs={class:"write-tool-handler"},ds={class:"tool-section mb-3"},ms={class:"write-file-info mb-2"},ps={class:"file-path"},vs={class:"write-content-preview"},fs={class:"content-header"},gs={class:"line-count-badge"},_s={key:0,class:"preview-note"},bs={class:"tool-code content-display"},hs={key:0,class:"more-indicator"},ys={key:0,class:"tool-section"},$s={key:0,class:"tool-result tool-result-error"},ws={class:"tool-code"},Ss={key:1,class:"tool-result tool-result-success"},ks={class:"success-message"},we=100,Cs={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.input?.file_path||"Unknown"),r=u(()=>t.toolCall.input?.content||""),o=u(()=>r.value.split(`
`)),n=u(()=>o.value.length),p=u(()=>n.value>we),g=u(()=>o.value.slice(0,we).join(`
`)),i=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),b=u(()=>{if(!i.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)});return(y,_)=>(l(),a("div",cs,[e("div",ds,[e("div",ms,[_[0]||(_[0]=e("span",{class:"file-icon"},"ðŸ“",-1)),_[1]||(_[1]=e("strong",null,"Writing:",-1)),e("code",ps,f(c.value),1)]),e("div",vs,[e("div",fs,[_[2]||(_[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",gs,f(n.value)+" lines",1),p.value?(l(),a("span",_s,"(showing first "+f(we)+")")):P("",!0)]),e("pre",bs,f(g.value),1),p.value?(l(),a("div",hs,"...")):P("",!0)])]),i.value?(l(),a("div",ys,[v.value?(l(),a("div",$s,[_[3]||(_[3]=e("strong",null,"Error:",-1)),e("pre",ws,f(b.value),1)])):(l(),a("div",Ss,[e("div",ks,[_[4]||(_[4]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"File created successfully ("+f(n.value)+" lines written)",1)])]))])):P("",!0)]))}},xs=R(Cs,[["__scopeId","data-v-d09b89ef"]]),js={class:"bash-tool-handler"},Ms={class:"tool-section mb-3"},Ts={class:"bash-header"},Es={class:"bash-header-content"},Ps={key:0,class:"bash-description"},Is={key:1,class:"bash-flags"},Ls={class:"bash-command-section"},Ds={class:"bash-command-content"},Os={key:0,class:"tool-section"},Ns={key:0,class:"bash-output"},As={key:1,class:"bash-output-empty"},qs={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.input?.command||""),r=u(()=>t.toolCall.input?.description||""),o=u(()=>t.toolCall.input?.timeout),n=u(()=>t.toolCall.input?.run_in_background||!1),p=u(()=>o.value||n.value),g=u(()=>{const _=[];return o.value&&_.push(`timeout: ${o.value}ms`),n.value&&_.push("background"),_.join(", ")}),i=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),b=u(()=>v.value?"tool-result-error":"tool-result-success"),y=u(()=>{if(!i.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)});return(_,h)=>(l(),a("div",js,[e("div",Ms,[e("div",Ts,[h[1]||(h[1]=e("span",{class:"bash-icon"},"ðŸ’»",-1)),e("div",Es,[r.value?(l(),a("div",Ps,[h[0]||(h[0]=e("strong",null,"Description:",-1)),H(" "+f(r.value),1)])):P("",!0),p.value?(l(),a("div",Is,f(g.value),1)):P("",!0)])]),e("div",Ls,[h[2]||(h[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",Ds,f(c.value),1)])]),i.value?(l(),a("div",Os,[e("div",{class:U(["tool-result",b.value])},[h[3]||(h[3]=e("strong",null,"Output:",-1)),y.value?(l(),a("pre",Ns,f(y.value),1)):(l(),a("div",As,"No output"))],2)])):P("",!0)]))}},Rs=R(qs,[["__scopeId","data-v-dc93bb16"]]),Us={class:"todo-tool-handler"},Ws={class:"tool-section mb-3"},Hs={class:"todo-header"},Fs={class:"todo-summary"},Bs={key:0,class:"todo-count todo-count-completed"},Vs={key:1,class:"todo-count todo-count-in-progress"},zs={key:2,class:"todo-count todo-count-pending"},Js={class:"todo-checklist"},Gs={class:"todo-checkbox"},Ks={class:"todo-content"},Ys={key:0,class:"tool-section"},Qs={key:0,class:"tool-result tool-result-error"},Zs={class:"tool-code"},Xs={key:1,class:"tool-result tool-result-success"},eo={class:"success-message"},to={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.input?.todos||[]),r=u(()=>c.value.filter(b=>b.status==="completed").length),o=u(()=>c.value.filter(b=>b.status==="in_progress").length),n=u(()=>c.value.filter(b=>b.status==="pending").length);function p(b){return{pending:"â˜",in_progress:"â—",completed:"â˜‘"}[b]||"â˜"}const g=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),i=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),v=u(()=>{if(!g.value)return"";const b=t.toolCall.result;return b.content!==void 0?typeof b.content=="string"?b.content:JSON.stringify(b.content,null,2):b.message?b.message:JSON.stringify(b,null,2)});return(b,y)=>(l(),a("div",Us,[e("div",Ws,[e("div",Hs,[y[0]||(y[0]=e("span",{class:"todo-icon"},"ðŸ“‹",-1)),y[1]||(y[1]=e("strong",null,"Task List:",-1)),e("div",Fs,[r.value>0?(l(),a("span",Bs,f(r.value)+" completed ",1)):P("",!0),o.value>0?(l(),a("span",Vs,f(o.value)+" in progress ",1)):P("",!0),n.value>0?(l(),a("span",zs,f(n.value)+" pending ",1)):P("",!0)])]),e("div",Js,[(l(!0),a(Q,null,Z(c.value,(_,h)=>(l(),a("div",{key:h,class:U(["todo-item",`todo-${_.status}`])},[e("span",Gs,f(p(_.status)),1),e("span",Ks,f(_.content),1)],2))),128))])]),g.value?(l(),a("div",Ys,[i.value?(l(),a("div",Qs,[y[2]||(y[2]=e("strong",null,"Error:",-1)),e("pre",Zs,f(v.value),1)])):(l(),a("div",Xs,[e("div",eo,[y[3]||(y[3]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"Task list updated ("+f(c.value.length)+" tasks)",1)])]))])):P("",!0)]))}},so=R(to,[["__scopeId","data-v-0984bcf9"]]),oo={class:"edit-tool-handler"},no={class:"tool-section mb-3"},lo={class:"edit-file-info"},ao={class:"file-path"},ro={key:0,class:"replace-all-badge"},io={class:"edit-diff-container"},uo={class:"diff-header"},co={class:"diff-stats"},mo={class:"stat-removed"},po={class:"stat-added"},vo={class:"unified-diff"},fo={class:"diff-scroll-container"},go={class:"diff-marker"},_o={class:"diff-content"},bo={key:0,class:"tool-section"},ho={key:0,class:"tool-result tool-result-error"},yo={class:"tool-code"},$o={key:1,class:"tool-result tool-result-success"},wo={class:"success-message"},So={key:0,class:"success-detail"},ko={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.input?.file_path||"Unknown"),r=u(()=>t.toolCall.input?.old_string||""),o=u(()=>t.toolCall.input?.new_string||""),n=u(()=>t.toolCall.input?.replace_all||!1),p=u(()=>{const h=Fe(c.value,r.value,o.value,"","",{context:3}).split(`
`),x=[];for(let T=4;T<h.length;T++){const w=h[T];w&&(w.startsWith("-")?x.push({type:"removed",content:w.substring(1)}):w.startsWith("+")?x.push({type:"added",content:w.substring(1)}):w.startsWith(" ")?x.push({type:"context",content:w.substring(1)}):w.startsWith("@@")&&x.push({type:"hunk",content:w}))}return x}),g=u(()=>p.value.filter(_=>_.type==="removed").length),i=u(()=>p.value.filter(_=>_.type==="added").length),v=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),b=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),y=u(()=>{if(!v.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)});return(_,h)=>(l(),a("div",oo,[e("div",no,[e("div",lo,[h[0]||(h[0]=e("span",{class:"file-icon"},"âœï¸",-1)),h[1]||(h[1]=e("strong",null,"Editing:",-1)),e("code",ao,f(c.value),1),n.value?(l(),a("span",ro,"Replace All")):P("",!0)]),e("div",io,[e("div",uo,[h[2]||(h[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",co,[e("span",mo,"-"+f(g.value),1),e("span",po,"+"+f(i.value),1)])]),e("div",vo,[e("div",fo,[(l(!0),a(Q,null,Z(p.value,(x,T)=>(l(),a("div",{key:T,class:U(["diff-line",{"diff-line-removed":x.type==="removed","diff-line-added":x.type==="added","diff-line-context":x.type==="context","diff-line-hunk":x.type==="hunk"}])},[e("span",go,f(x.type==="removed"?"-":x.type==="added"?"+":x.type==="hunk"?"@":" "),1),e("span",_o,f(x.content),1)],2))),128))])])])]),v.value?(l(),a("div",bo,[b.value?(l(),a("div",ho,[h[3]||(h[3]=e("strong",null,"Error:",-1)),e("pre",yo,f(y.value),1)])):(l(),a("div",$o,[e("div",wo,[h[4]||(h[4]=e("span",{class:"success-icon"},"âœ…",-1)),h[5]||(h[5]=e("strong",null,"File edited successfully",-1)),n.value?(l(),a("span",So,"(all occurrences replaced)")):P("",!0)])]))])):P("",!0)]))}},Co=R(ko,[["__scopeId","data-v-b06adbf2"]]),xo={class:"search-tool-handler"},jo={class:"tool-section mb-3"},Mo={class:"search-info"},To={class:"search-icon"},Eo={class:"search-pattern"},Po={key:0,class:"search-path"},Io={key:1,class:"search-filters"},Lo={key:0,class:"filter-badge"},Do={key:1,class:"filter-badge"},Oo={key:2,class:"filter-badge"},No={key:0,class:"tool-section"},Ao={key:0,class:"tool-result tool-result-error"},qo={class:"tool-code"},Ro={key:1,class:"search-results"},Uo={class:"results-header"},Wo={class:"results-label"},Ho={class:"results-count-badge"},Fo={class:"results-content"},Bo={class:"tool-code"},Vo={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.name==="Grep");u(()=>t.toolCall.name==="Glob");const r=u(()=>t.toolCall.input?.pattern||"Unknown"),o=u(()=>t.toolCall.input?.path||null),n=u(()=>t.toolCall.input?.type||null),p=u(()=>t.toolCall.input?.glob||null),g=u(()=>t.toolCall.input?.["-i"]||!1),i=u(()=>n.value||p.value||g.value),v=u(()=>c.value?"ðŸ”":"ðŸ“"),b=u(()=>c.value?"Searching content":"Finding files"),y=u(()=>c.value?"Matches":"Files found"),_=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),h=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),x=u(()=>{if(!_.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)}),T=u(()=>!_.value||h.value||!x.value?0:x.value.split(`
`).filter($=>$.trim()).length);return(w,$)=>(l(),a("div",xo,[e("div",jo,[e("div",Mo,[e("span",To,f(v.value),1),e("strong",null,f(b.value)+":",1),e("code",Eo,f(r.value),1),o.value?(l(),a("span",Po,"in "+f(o.value),1)):P("",!0),i.value?(l(),a("span",Io,[n.value?(l(),a("span",Lo,"type: "+f(n.value),1)):P("",!0),p.value?(l(),a("span",Do,"glob: "+f(p.value),1)):P("",!0),g.value?(l(),a("span",Oo,"case-insensitive")):P("",!0)])):P("",!0)])]),_.value?(l(),a("div",No,[h.value?(l(),a("div",Ao,[$[0]||($[0]=e("strong",null,"Error:",-1)),e("pre",qo,f(x.value),1)])):(l(),a("div",Ro,[e("div",Uo,[e("span",Wo,f(y.value)+":",1),e("span",Ho,f(T.value)+" "+f(T.value===1?"match":"matches"),1)]),e("div",Fo,[e("pre",Bo,f(x.value),1)])]))])):P("",!0)]))}},Pe=R(Vo,[["__scopeId","data-v-dc01ae0d"]]),zo={class:"web-tool-handler"},Jo={class:"tool-section mb-3"},Go={class:"web-info"},Ko={class:"web-icon"},Yo=["href"],Qo={key:1,class:"web-query"},Zo={key:0,class:"web-prompt-container"},Xo={class:"prompt-content"},en={key:1,class:"web-domains"},tn={class:"domains-label"},sn={key:0,class:"tool-section"},on={key:0,class:"tool-result tool-result-error"},nn={class:"tool-code"},ln={key:1,class:"web-results"},an={class:"results-header"},rn={class:"results-label"},un={class:"results-content"},cn={class:"tool-code"},dn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.name==="WebFetch");u(()=>t.toolCall.name==="WebSearch");const r=u(()=>t.toolCall.input?.url||null),o=u(()=>t.toolCall.input?.query||null),n=u(()=>t.toolCall.input?.prompt||null),p=u(()=>t.toolCall.input?.allowed_domains||[]),g=u(()=>t.toolCall.input?.blocked_domains||[]),i=u(()=>p.value.length>0?p.value:g.value.length>0?g.value:[]),v=u(()=>p.value.length>0?"Allowed domains":g.value.length>0?"Blocked domains":"Domains"),b=u(()=>c.value?"ðŸŒ":"ðŸ”Ž"),y=u(()=>c.value?"Fetching URL":"Searching web"),_=u(()=>c.value?"Fetched content":"Search results"),h=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),x=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),T=u(()=>{if(!h.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)});return(w,$)=>(l(),a("div",zo,[e("div",Jo,[e("div",Go,[e("span",Ko,f(b.value),1),e("strong",null,f(y.value)+":",1),r.value?(l(),a("a",{key:0,href:r.value,target:"_blank",class:"web-url"},f(r.value),9,Yo)):o.value?(l(),a("code",Qo,f(o.value),1)):P("",!0)]),n.value?(l(),a("div",Zo,[$[0]||($[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",Xo,f(n.value),1)])):P("",!0),i.value.length>0?(l(),a("div",en,[e("span",tn,f(v.value)+":",1),(l(!0),a(Q,null,Z(i.value,C=>(l(),a("span",{key:C,class:"domain-badge"},f(C),1))),128))])):P("",!0)]),h.value?(l(),a("div",sn,[x.value?(l(),a("div",on,[$[1]||($[1]=e("strong",null,"Error:",-1)),e("pre",nn,f(T.value),1)])):(l(),a("div",ln,[e("div",an,[e("span",rn,f(_.value)+":",1)]),e("div",un,[e("pre",cn,f(T.value),1)])]))])):P("",!0)]))}},Ie=R(dn,[["__scopeId","data-v-49e16a90"]]),mn={class:"task-tool-handler"},pn={class:"tool-section mb-3"},vn={class:"task-header"},fn={key:0,class:"agent-type-badge"},gn={key:0,class:"task-description"},_n={class:"description-content"},bn={key:1,class:"task-prompt-container"},hn={class:"prompt-header"},yn={class:"prompt-length"},$n={class:"prompt-code"},wn={key:0,class:"tool-section"},Sn={key:0,class:"tool-result tool-result-error"},kn={class:"tool-code"},Cn={key:1,class:"agent-output"},xn={class:"output-header"},jn={key:0,class:"output-count-badge"},Mn={class:"output-content"},Tn={class:"tool-code"},En={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.input?.description||null),r=u(()=>t.toolCall.input?.prompt||null),o=u(()=>t.toolCall.input?.subagent_type||null),n=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),p=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),g=u(()=>{if(!n.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)}),i=u(()=>g.value?g.value.split(`
`).length:0);return(v,b)=>(l(),a("div",mn,[e("div",pn,[e("div",vn,[b[0]||(b[0]=e("span",{class:"task-icon"},"ðŸ¤–",-1)),b[1]||(b[1]=e("strong",null,"Agent Task:",-1)),o.value?(l(),a("span",fn,f(o.value),1)):P("",!0)]),c.value?(l(),a("div",gn,[b[2]||(b[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",_n,f(c.value),1)])):P("",!0),r.value?(l(),a("div",bn,[e("div",hn,[b[3]||(b[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",yn,f(r.value.length)+" characters",1)]),e("pre",$n,f(r.value),1)])):P("",!0)]),n.value?(l(),a("div",wn,[p.value?(l(),a("div",Sn,[b[4]||(b[4]=e("strong",null,"Error:",-1)),e("pre",kn,f(g.value),1)])):(l(),a("div",Cn,[e("div",xn,[b[5]||(b[5]=e("span",{class:"output-label"},"Agent Output:",-1)),i.value>0?(l(),a("span",jn,f(i.value)+" lines",1)):P("",!0)]),e("div",Mn,[e("pre",Tn,f(g.value),1)])]))])):P("",!0)]))}},Pn=R(En,[["__scopeId","data-v-513043f9"]]),In={class:"notebook-edit-tool-handler"},Ln={class:"tool-section mb-3"},Dn={class:"notebook-info"},On={class:"file-path"},Nn={class:"cell-info mt-2"},An={class:"info-row"},qn={class:"info-row"},Rn={key:0,class:"info-row"},Un={class:"badge bg-info"},Wn={key:0,class:"source-preview mt-3"},Hn={class:"preview-header"},Fn={class:"preview-stats"},Bn={class:"source-code"},Vn={key:0,class:"tool-section"},zn={key:0},Jn={key:1,class:"text-danger"},Gn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.input?.notebook_path||"Unknown"),r=u(()=>t.toolCall.input?.cell_id),o=u(()=>t.toolCall.input?.cell_type||"code"),n=u(()=>t.toolCall.input?.edit_mode||"replace"),p=u(()=>t.toolCall.input?.new_source||""),g=u(()=>p.value.split(`
`).length),i=u(()=>o.value==="code"?"bg-primary":"bg-secondary"),v=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),b=u(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const y=n.value;return y==="insert"?"Cell inserted successfully":y==="delete"?"Cell deleted successfully":"Cell updated successfully"});return(y,_)=>(l(),a("div",In,[e("div",Ln,[e("div",Dn,[_[0]||(_[0]=e("span",{class:"notebook-icon"},"ðŸ““",-1)),_[1]||(_[1]=e("strong",null,"Notebook:",-1)),e("code",On,f(c.value),1)]),e("div",Nn,[e("div",An,[_[2]||(_[2]=e("strong",null,"Cell ID:",-1)),e("code",null,f(r.value||"N/A"),1)]),e("div",qn,[_[3]||(_[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:U(["badge",i.value])},f(o.value),3)]),n.value?(l(),a("div",Rn,[_[4]||(_[4]=e("strong",null,"Edit Mode:",-1)),e("span",Un,f(n.value),1)])):P("",!0)]),p.value?(l(),a("div",Wn,[e("div",Hn,[_[5]||(_[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",Fn,f(g.value)+" lines",1)]),e("pre",Bn,[e("code",null,f(p.value),1)])])):P("",!0)]),s.toolCall.result?(l(),a("div",Vn,[_[8]||(_[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:U(["tool-result",v.value])},[s.toolCall.result.success!==!1?(l(),a("div",zn,[_[6]||(_[6]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+f(b.value),1)])):(l(),a("div",Jn,[_[7]||(_[7]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Operation failed"),1)]))],2)])):P("",!0)]))}},Kn=R(Gn,[["__scopeId","data-v-3261abc1"]]),Yn={class:"shell-tool-handler"},Qn={class:"tool-section mb-3"},Zn={class:"shell-info"},Xn={class:"shell-icon"},el={key:0,class:"shell-id"},tl={key:0,class:"filter-info mt-2"},sl={class:"filter-pattern"},ol={key:0,class:"tool-section"},nl={class:"result-header mb-2"},ll={key:0,class:"shell-output"},al={key:0},rl={key:1,class:"text-danger"},il={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.name==="BashOutput"?"ðŸ“¤":t.toolCall.name==="KillShell"?"ðŸ›‘":"ðŸš"),r=u(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),o=u(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),n=u(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),p=u(()=>t.toolCall.input?.filter),g=u(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),i=u(()=>t.toolCall.result?.status),v=u(()=>{const _=i.value;return _==="running"?"bg-success":_==="completed"?"bg-secondary":_==="killed"||_==="terminated"?"bg-danger":"bg-info"}),b=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),y=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return(_,h)=>(l(),a("div",Yn,[e("div",Qn,[e("div",Zn,[e("span",Xn,f(c.value),1),e("strong",null,f(r.value)+":",1),n.value?(l(),a("code",el,"Shell "+f(n.value),1)):P("",!0)]),s.toolCall.name==="BashOutput"&&p.value?(l(),a("div",tl,[h[0]||(h[0]=e("strong",null,"Filter:",-1)),e("code",sl,f(p.value),1)])):P("",!0)]),s.toolCall.result?(l(),a("div",ol,[e("div",nl,[e("strong",null,f(o.value)+":",1),i.value?(l(),a("span",{key:0,class:U(["badge",v.value])},f(i.value),3)):P("",!0)]),g.value?(l(),a("div",ll,[e("pre",null,[e("code",null,f(g.value),1)])])):(l(),a("div",{key:1,class:U(["tool-result",b.value])},[s.toolCall.result.success!==!1?(l(),a("div",al,[h[1]||(h[1]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+f(y.value),1)])):(l(),a("div",rl,[h[2]||(h[2]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Operation failed"),1)]))],2))])):P("",!0)]))}},Le=R(il,[["__scopeId","data-v-fc9da4c0"]]),ul={class:"command-tool-handler"},cl={class:"tool-section mb-3"},dl={class:"command-info"},ml={class:"command-icon"},pl={class:"command-code"},vl={key:0,class:"prompt-info mt-2"},fl={class:"prompt-content"},gl={key:0,class:"tool-section"},_l={key:0},bl={key:1,class:"text-danger"},hl={__name:"CommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.name==="SlashCommand"?"/":t.toolCall.name==="Skill"?"âš¡":"ðŸ”§"),r=u(()=>t.toolCall.name==="SlashCommand"?"Slash Command":t.toolCall.name==="Skill"?"Skill":"Command"),o=u(()=>t.toolCall.input?.command||"Unknown"),n=u(()=>t.toolCall.result?.prompt||t.toolCall.result?.description),p=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),g=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="SlashCommand"?"Slash command executed successfully":t.toolCall.name==="Skill"?"Skill executed successfully":"Command completed");return(i,v)=>(l(),a("div",ul,[e("div",cl,[e("div",dl,[e("span",ml,f(c.value),1),e("strong",null,f(r.value)+":",1),e("code",pl,f(o.value),1)]),n.value?(l(),a("div",vl,[v[0]||(v[0]=e("div",{class:"prompt-header"},[e("strong",null,"Expanded Prompt:")],-1)),e("div",fl,f(n.value),1)])):P("",!0)]),s.toolCall.result?(l(),a("div",gl,[v[3]||(v[3]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:U(["tool-result",p.value])},[s.toolCall.result.success!==!1?(l(),a("div",_l,[v[1]||(v[1]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+f(g.value),1)])):(l(),a("div",bl,[v[2]||(v[2]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Command execution failed"),1)]))],2)])):P("",!0)]))}},yl=R(hl,[["__scopeId","data-v-57a8f93b"]]),$l={class:"skill-tool-handler"},wl={class:"tool-section mb-3"},Sl={class:"skill-info"},kl={class:"skill-name"},Cl={key:0,class:"tool-section mb-3"},xl={class:"base-directory-info"},jl={class:"directory-path"},Ml={key:1,class:"tool-section"},Tl={class:"d-flex align-items-center gap-2"},El={class:"text-muted small"},Pl={key:0,class:"skill-content-body"},Il={class:"skill-content-text"},Ll={key:2,class:"tool-section mt-3"},Dl={class:"tool-result tool-result-error"},Ol={class:"tool-code"},Nl={__name:"SkillToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=de(),r=J(),o=I(!1);function n(){o.value=!o.value}const p=u(()=>t.toolCall.input?.command||"Unknown Skill"),g=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),i=u(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}}),v=u(()=>{const w=r.currentSessionId;if(!w)return{running:null,content:null};const $=c.messagesBySession.get(w)||[],C=$.findIndex(M=>M.type==="user"&&M.metadata?.has_tool_results&&M.metadata?.tool_results?.some(N=>N.tool_use_id===t.toolCall.id));if(C===-1)return{running:null,content:null};let m=null,d=null;for(let M=C+1;M<Math.min(C+3,$.length);M++){const N=$[M];if(N.type!=="user")continue;const S=N.content||"";S.includes("<command-message>")&&S.includes("skill is running")?m=N:S.startsWith("Base directory for this skill:")&&(d=N)}return{running:m,content:d}}),b=u(()=>{const w=v.value.content;if(!w)return null;const C=(w.content||"").match(/Base directory(?:\s+for\s+this\s+skill)?:\s*(.+?)(?:\n|$)/i);return C&&C[1]?C[1].trim():null}),y=u(()=>{const w=v.value.content;if(!w)return"";const $=w.content||"",C=/Base directory(?:\s+for\s+this\s+skill)?:.*?\n/i;return $.replace(C,"").trim()}),_=u(()=>y.value.length>0),h=u(()=>y.value?y.value.split(`
`).length:0),x=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),T=u(()=>{if(!x.value)return"";const w=t.toolCall.result;return w?.message?w.message:w?.error?w.error:"An error occurred"});return(w,$)=>(l(),a("div",$l,[e("div",wl,[e("div",Sl,[$[0]||($[0]=e("span",{class:"skill-icon"},"ðŸ“‹",-1)),$[1]||($[1]=e("strong",null,"Skill:",-1)),e("code",kl,f(p.value),1),e("span",{class:U(["skill-status-badge",i.value])},f(g.value),3)])]),b.value?(l(),a("div",Cl,[e("div",xl,[$[2]||($[2]=e("span",{class:"directory-icon"},"ðŸ“",-1)),$[3]||($[3]=e("strong",null,"Base directory:",-1)),e("code",jl,f(b.value),1)])])):P("",!0),_.value?(l(),a("div",Ml,[e("div",{class:"skill-content-header",onClick:n},[e("div",Tl,[e("i",{class:U(["bi",o.value?"bi-chevron-down":"bi-chevron-right"])},null,2),$[4]||($[4]=e("strong",null,"Skill Content",-1)),e("span",El,"("+f(h.value)+" lines)",1)])]),o.value?(l(),a("div",Pl,[e("pre",Il,f(y.value),1)])):P("",!0)])):P("",!0),x.value?(l(),a("div",Ll,[$[5]||($[5]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),H(" Error: ")],-1)),e("div",Dl,[e("pre",Ol,f(T.value),1)])])):P("",!0)]))}},Al=R(Nl,[["__scopeId","data-v-a9fab5d1"]]),ql={class:"exit-plan-mode-tool-handler"},Rl={class:"tool-section mb-3"},Ul={key:0,class:"plan-content mt-2"},Wl={class:"plan-text"},Hl={key:0,class:"tool-section"},Fl={key:0},Bl={key:1,class:"text-danger"},Vl={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>t.toolCall.input?.plan),r=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(o,n)=>(l(),a("div",ql,[e("div",Rl,[n[1]||(n[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"ðŸ“‹"),e("strong",null,"Exiting Plan Mode")],-1)),c.value?(l(),a("div",Ul,[n[0]||(n[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",Wl,f(c.value),1)])):P("",!0)]),s.toolCall.result?(l(),a("div",Hl,[n[4]||(n[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:U(["tool-result",r.value])},[s.toolCall.result.success!==!1?(l(),a("div",Fl,[...n[2]||(n[2]=[e("i",{class:"bi bi-check-circle"},null,-1),H(" Permission mode reverted to default ",-1)])])):(l(),a("div",Bl,[n[3]||(n[3]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):P("",!0)]))}},zl=R(Vl,[["__scopeId","data-v-f1d32203"]]),Jl={class:"d-flex align-items-center gap-2 flex-grow-1"},Gl={class:"tool-status-icon"},Kl={class:"tool-name"},Yl={class:"text-muted small"},Ql={class:"d-flex align-items-center gap-2"},Zl={class:"text-muted"},Xl={key:0,class:"card-body"},ea={key:0,class:"alert alert-warning mb-3"},ta={class:"d-flex align-items-center"},sa={class:"mb-0 small"},oa={key:1,class:"permission-prompt mt-3"},na={class:"alert alert-warning mb-3"},la={class:"mb-0"},aa={class:"tool-name"},ra={key:0,class:"suggestions-section mb-3"},ia={class:"alert alert-info mb-0"},ua={class:"suggestion-details p-2 bg-white rounded"},ca={class:"permission-buttons d-flex gap-2 mb-3"},da=["disabled"],ma=["disabled"],pa=["disabled"],va={class:"guidance-section mt-3"},fa=["disabled"],ga=["disabled"],_a={key:2,class:"mt-3"},ba={class:"alert alert-warning mb-0"},ha={class:"d-flex align-items-center"},ya={class:"mb-0 small"},$a={key:3,class:"tool-section mt-3"},wa={class:"alert alert-danger mb-0"},Sa={key:0},ka={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,c=de(),r=J(),o=pe(),n=I(!1),p=I(null),g=I(""),i=u(()=>c.isToolUseOrphaned(r.currentSessionId,t.toolCall.id)),v=u(()=>c.getOrphanedInfo(r.currentSessionId,t.toolCall.id)),b={Read:us,Write:xs,Bash:Rs,TodoWrite:so,Edit:Co,Grep:Pe,Glob:Pe,WebFetch:Ie,WebSearch:Ie,Task:Pn,NotebookEdit:Kn,BashOutput:Le,KillShell:Le,SlashCommand:yl,Skill:Al,ExitPlanMode:zl},y=u(()=>{const M=t.toolCall.name;return b[M]?b[M]:Jt}),_=u(()=>{const M=[];switch(t.toolCall.status){case"pending":M.push("border-secondary");break;case"permission_required":M.push("border-warning");break;case"executing":M.push("border-primary");break;case"completed":w.value||t.toolCall.permissionDecision==="deny"?M.push("border-danger"):M.push("border-success");break;case"error":M.push("border-danger");break}return M.join(" ")}),h=u(()=>{switch(t.toolCall.status){case"pending":return"ðŸ”„";case"permission_required":return"â“";case"executing":return"âš¡";case"completed":return t.toolCall.permissionDecision==="deny"?"âŒ":w.value?"ðŸ’¥":"âœ…";case"error":return"ðŸ’¥";default:return"ðŸ”§"}}),x=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Executing...";case"completed":return t.toolCall.permissionDecision==="deny"?"Denied":w.value?"Error":"Completed";case"error":return"Error";default:return"Unknown"}}),T=u(()=>he(t.toolCall.timestamp)),w=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),$=u(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function C(){const M=r.currentSessionId;M&&c.toggleToolExpansion(M,t.toolCall.id)}function m(M){return M.type==="setMode"?`Set permission mode to "${M.mode}"`:M.type==="allow"?`Allow tool: ${M.tool}`:JSON.stringify(M)}async function d(M,N,S=null){if(!n.value){n.value=!0,M==="allow"?p.value=N?"approve-apply":"approve":S?p.value="deny-guidance":p.value="deny";try{const j=r.currentSessionId;if(j){const E=N&&t.toolCall.suggestions?t.toolCall.suggestions:[];c.handlePermissionResponse(j,{request_id:t.toolCall.permissionRequestId,decision:M,reasoning:M==="allow"?"User allowed permission":"User denied permission",applied_updates:E})}await o.sendPermissionResponse(t.toolCall.permissionRequestId,M,N,S)}catch(j){console.error("Failed to send permission response:",j)}finally{n.value=!1,p.value=null}}}return(M,N)=>(l(),a("div",{class:U(["tool-call-card card mb-3",_.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:C},[e("div",Jl,[e("span",Gl,f(h.value),1),e("strong",Kl,f(s.toolCall.name),1),e("span",Yl,f(x.value),1)]),e("div",Ql,[e("small",Zl,f(T.value),1),e("i",{class:U(["bi",s.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),s.toolCall.isExpanded?(l(),a("div",Xl,[i.value?(l(),a("div",ea,[e("div",ta,[N[6]||(N[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[N[5]||(N[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",sa,f(v.value?.message||"Session was terminated"),1)])])])):P("",!0),(l(),re(Oe(y.value),{toolCall:s.toolCall},null,8,["toolCall"])),s.toolCall.status==="permission_required"&&!i.value?(l(),a("div",oa,[e("div",na,[N[9]||(N[9]=e("p",{class:"mb-2"},[e("strong",null,"ðŸ” Permission Required")],-1)),e("p",la,[N[7]||(N[7]=H("Claude wants to use the ",-1)),e("code",aa,f(s.toolCall.name),1),N[8]||(N[8]=H(" tool.",-1))])]),$.value?(l(),a("div",ra,[e("div",ia,[N[10]||(N[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),H(" Suggested Permission Update ")],-1)),N[11]||(N[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",ua,[(l(!0),a(Q,null,Z(s.toolCall.suggestions,(S,j)=>(l(),a("div",{key:j,class:"suggestion-item"},[e("code",null,f(m(S)),1)]))),128))]),N[12]||(N[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):P("",!0),e("div",ca,[$.value?(l(),a("button",{key:0,class:"btn btn-success",onClick:N[0]||(N[0]=S=>d("allow",!0)),disabled:n.value},[N[13]||(N[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),H(" "+f(n.value&&p.value==="approve-apply"?"â³ Submitting...":"âœ… Approve & Apply"),1)],8,da)):P("",!0),e("button",{class:U(["btn",$.value?"btn-outline-success":"btn-success"]),onClick:N[1]||(N[1]=S=>d("allow",!1)),disabled:n.value},[N[14]||(N[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),H(" "+f(n.value&&p.value==="approve"?"â³ Submitting...":$.value?"âœ… Approve Only":"âœ… Approve"),1)],10,ma),e("button",{class:"btn btn-danger",onClick:N[2]||(N[2]=S=>d("deny",!1)),disabled:n.value},[N[15]||(N[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),H(" "+f(n.value&&p.value==="deny"?"â³ Submitting...":"âŒ Deny"),1)],8,pa)]),e("div",va,[N[17]||(N[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),H(" Provide Guidance (Optional) ")],-1)),N[18]||(N[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),K(e("textarea",{"onUpdate:modelValue":N[3]||(N[3]=S=>g.value=S),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:n.value},null,8,fa),[[te,g.value]]),g.value.trim()?(l(),a("button",{key:0,class:"btn btn-warning btn-sm",onClick:N[4]||(N[4]=S=>d("deny",!1,g.value)),disabled:n.value},[N[16]||(N[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),H(" "+f(n.value&&p.value==="deny-guidance"?"â³ Submitting...":"ðŸ’¡ Provide Guidance & Continue"),1)],8,ga)):P("",!0)])])):P("",!0),s.toolCall.status==="permission_required"&&i.value?(l(),a("div",_a,[e("div",ba,[e("div",ha,[N[20]||(N[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[N[19]||(N[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",ya,f(v.value?.message||"Session was terminated before permission could be granted"),1)])])])])):P("",!0),s.toolCall.permissionDecision==="deny"?(l(),a("div",$a,[e("div",wa,[N[21]||(N[21]=e("i",{class:"bi bi-x-circle"},null,-1)),N[22]||(N[22]=H(" Permission denied ",-1)),s.toolCall.result?.message?(l(),a("span",Sa," - "+f(s.toolCall.result.message),1)):P("",!0)])])):P("",!0)])):P("",!0)],2))}},Ca=R(ka,[["__scopeId","data-v-86cff5e4"]]),xa={class:"card assistant-message bg-white border-start border-success border-3"},ja={class:"card-body"},Ma={class:"d-flex justify-content-between align-items-center mb-2"},Ta={class:"d-flex align-items-center gap-2"},Ea={key:0,class:"text-muted"},Pa={class:"text-muted"},Ia={key:0,class:"thinking-block mb-3"},La=["innerHTML"],Da={key:2,class:"tool-calls mt-3"},Oa={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,c=de(),r=J();ge.setOptions({breaks:!0,gfm:!0});const o=u(()=>he(t.message.timestamp)),n=u(()=>t.message.metadata?.model||null),p=u(()=>{const h=t.message.content||"";return h.trim().length>0&&h!=="Assistant response"}),g=u(()=>{const h=t.message.content||"",x=ge.parse(h);return ke.sanitize(x)}),i=u(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),v=u(()=>t.message.metadata?.thinking_content||""),b=u(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),y=u(()=>t.message.metadata?.tool_uses||[]),_=u(()=>{const h=r.currentSessionId;if(!h)return[];const x=c.toolCallsBySession.get(h)||[];return y.value.map(T=>{const w=x.find($=>$.id===T.id);return w||{id:T.id,name:T.name,input:T.input,status:"pending",result:null,timestamp:T.timestamp||t.message.timestamp,isExpanded:!0}})});return(h,x)=>(l(),a("div",xa,[e("div",ja,[e("div",Ma,[e("div",Ta,[x[0]||(x[0]=e("span",{class:"message-icon"},"ðŸ¤–",-1)),x[1]||(x[1]=e("strong",{class:"message-role"},"Assistant",-1)),n.value?(l(),a("small",Ea,f(n.value),1)):P("",!0)]),e("small",Pa,f(o.value),1)]),i.value?(l(),a("div",Ia,[Y(At,{thinking:v.value},null,8,["thinking"])])):P("",!0),p.value?(l(),a("div",{key:1,class:"message-content",innerHTML:g.value},null,8,La)):P("",!0),b.value?(l(),a("div",Da,[(l(!0),a(Q,null,Z(_.value,T=>(l(),re(Ca,{key:T.id,toolCall:T},null,8,["toolCall"]))),128))])):P("",!0)])]))}},Na=R(Oa,[["__scopeId","data-v-25a87a40"]]),Aa={class:"card system-message bg-info bg-opacity-10 border-info"},qa={class:"card-body py-2 px-3"},Ra={class:"d-flex align-items-center gap-2"},Ua={class:"text-muted flex-grow-1"},Wa={class:"text-muted"},Ha={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>he(t.message.timestamp));return(r,o)=>(l(),a("div",Aa,[e("div",qa,[e("div",Ra,[o[0]||(o[0]=e("i",{class:"bi bi-info-circle text-info"},null,-1)),e("small",Ua,f(s.message.content),1),e("small",Wa,f(c.value),1)])])]))}},De=R(Ha,[["__scopeId","data-v-bba7a395"]]),Fa={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(s){const t=s,c=u(()=>{switch(t.message.type){case"user":return Pt;case"assistant":return Na;case"system":return De;default:return De}});return(r,o)=>(l(),a("div",{class:U(["message-item mb-3",`message-${s.message.type}`])},[(l(),re(Oe(c.value),{message:s.message},null,8,["message"]))],2))}},Ba=R(Fa,[["__scopeId","data-v-fbd275ac"]]),Va={key:0,class:"text-muted text-center py-5"},za={__name:"MessageList",setup(s){const t=de(),c=ee(),r=I(null),o=u(()=>t.currentMessages.filter(i=>p(i)));u(()=>t.currentToolCalls);async function n(){c.autoScrollEnabled&&(await Se(),r.value&&(r.value.scrollTop=r.value.scrollHeight))}X(()=>t.currentMessages.length,n),X(()=>t.currentToolCalls.length,n),X(()=>t.currentToolCalls.map(i=>`${i.id}-${i.status}`).join(","),n),le(()=>{setTimeout(()=>{n()},100)});function p(i){const v=i.subtype||i.metadata?.subtype;if(i.type==="system"&&v==="init"||i.type==="result"||i.type==="permission_request"||i.type==="permission_response")return!1;if(i.type==="user"&&i.metadata?.has_tool_results){const b=i.content||"";if(b.match(/^Tool results?: \d+ results?$/i)||b.trim()==="")return!1}if(i.type==="user"){const b=i.content||"";if(b.includes("<command-message>")&&b.includes("skill is running")||b.startsWith("Base directory for this skill:"))return!1}return!0}function g(i){return{type:i.type||"unknown",content:i.content||"",timestamp:i.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...i.metadata}}}return(i,v)=>(l(),a("div",{class:"messages-area flex-grow-1 overflow-auto p-3",ref_key:"messagesArea",ref:r},[o.value.length===0?(l(),a("div",Va," No messages yet. Start a conversation! ")):P("",!0),(l(!0),a(Q,null,Z(o.value,(b,y)=>(l(),re(Ba,{key:`msg-${b.timestamp}-${y}`,message:g(b)},null,8,["message"]))),128))],512))}},Ja=R(za,[["__scopeId","data-v-29981b84"]]),Ga={class:"border-top bg-light"},Ka={class:"d-flex gap-2 align-items-end px-2 py-1"},Ya=["placeholder","disabled","onKeydown"],Qa=["disabled"],Za={__name:"InputArea",setup(s){const t=J(),c=pe(),r=I(null),o=u({get:()=>t.currentInput,set:_=>{t.currentInput=_}}),n=u(()=>t.currentSession?.is_processing||!1),p=u(()=>c.sessionConnected),g=u(()=>t.currentSession?.state==="starting"),i=u(()=>g.value?"Session is starting...":p.value?"Type your message to Claude Code...":"Waiting for connection...");function v(){const _=r.value;if(!_)return;_.style.height="auto";const h=Math.min(_.scrollHeight,parseInt(getComputedStyle(_).maxHeight));_.style.height=h+"px"}function b(){o.value.trim()&&(c.sendMessage(o.value),o.value="",r.value&&(r.value.style.height="auto"))}function y(){c.interruptSession()}return(_,h)=>(l(),a("div",Ga,[e("div",Ka,[K(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:r,"onUpdate:modelValue":h[0]||(h[0]=x=>o.value=x),class:"form-control",placeholder:i.value,disabled:g.value||!p.value,rows:"1",onInput:v,onKeydown:Ne(ie(b,["exact","prevent"]),["enter"])},null,40,Ya),[[te,o.value]]),n.value?(l(),a("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:y}," Stop ")):(l(),a("button",{key:1,class:"btn btn-primary",disabled:!o.value.trim()||!p.value||g.value,onClick:b}," Send ",8,Qa))])]))}},Xa=R(Za,[["__scopeId","data-v-a72bf16a"]]),er={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},tr={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},sr={class:"text-secondary"},or={class:"d-flex flex-column flex-grow-1 overflow-hidden"},qe={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,c=J(),r=ee(),o=u(()=>c.currentSession),n=u(()=>r.isLoading),p=u(()=>r.loadingMessage);return le(async()=>{if(t.sessionId!==c.currentSessionId){r.showLoading("Loading session...");try{await c.selectSession(t.sessionId)}finally{r.hideLoading()}}}),X(()=>t.sessionId,async(g,i)=>{if(g!==i&&g!==c.currentSessionId){r.showLoading("Loading session...");try{await c.selectSession(g)}finally{r.hideLoading()}}}),ae(()=>{}),(g,i)=>(l(),a("div",er,[n.value?(l(),a("div",tr,[i[0]||(i[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",sr,f(p.value),1)])):P("",!0),o.value?(l(),re(st,{key:1,"session-id":t.sessionId},null,8,["session-id"])):P("",!0),e("div",or,[Y(Ja)]),Y(Xa),o.value?(l(),re(rt,{key:2,"session-id":t.sessionId},null,8,["session-id"])):P("",!0),o.value?(l(),re(gt,{key:3,"session-id":t.sessionId},null,8,["session-id"])):P("",!0)]))}},Ce=ve("legion",()=>{const s=I(new Map),t=I(new Map),c=I(new Map),r=I(new Map),o=I(null),n=u(()=>s.value.get(o.value)||[]),p=u(()=>t.value.get(o.value)||[]),g=u(()=>c.value.get(o.value)||[]),i=u(()=>r.value.get(o.value)||[]);function v(C){o.value=C}async function b(C,m=100,d=0){try{const M=await G.get(`/api/legions/${C}/timeline?limit=${m}&offset=${d}`),N=M.comms||[],S=M.total_count||N.length,j=M.has_more||!1;return N.sort((E,k)=>new Date(E.timestamp)-new Date(k.timestamp)),console.log(`Loaded ${N.length} of ${S} comms for legion ${C}`),s.value.set(C,N),s.value=new Map(s.value),{comms:N,totalCount:S,hasMore:j}}catch(M){throw console.error("Failed to load timeline:",M),M}}function y(C,m){s.value.has(C)||s.value.set(C,[]),s.value.get(C).push(m),s.value=new Map(s.value)}async function _(C,m){try{const M=(await G.post(`/api/legions/${C}/comms`,m)).comm;return console.log(`Sent comm ${M.comm_id} to legion ${C}`),M}catch(d){throw console.error("Failed to send comm:",d),d}}async function h(C){return console.log(`Minions for legion ${C} are already available in session store`),[]}async function x(C,m){try{const M=(await G.post(`/api/legions/${C}/minions`,m)).minion;return await h(C),console.log(`Created minion ${M.minion_id} in legion ${C}`),M}catch(d){throw console.error("Failed to create minion:",d),d}}async function T(C){try{const d=(await G.get(`/api/legions/${C}/hordes`)).hordes||[];return console.log(`Loaded ${d.length} hordes for legion ${C}`),c.value.set(C,d),c.value=new Map(c.value),d}catch(m){throw console.error("Failed to load hordes:",m),m}}async function w(C){try{const d=(await G.get(`/api/legions/${C}/channels`)).channels||[];return console.log(`Loaded ${d.length} channels for legion ${C}`),r.value.set(C,d),r.value=new Map(r.value),d}catch(m){throw console.error("Failed to load channels:",m),m}}function $(C){s.value.delete(C),t.value.delete(C),c.value.delete(C),r.value.delete(C),s.value=new Map(s.value),t.value=new Map(t.value),c.value=new Map(c.value),r.value=new Map(r.value)}return{commsByLegion:s,minionsByLegion:t,hordesByLegion:c,channelsByLegion:r,currentLegionId:o,currentComms:n,currentMinions:p,currentHordes:g,currentChannels:i,setCurrentLegion:v,loadTimeline:b,addComm:y,sendComm:_,loadMinions:h,createMinion:x,loadHordes:T,loadChannels:w,clearLegionData:$}}),nr=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:Ce},Symbol.toStringTag,{value:"Module"})),lr={class:"timeline-header border-bottom p-3"},ar={class:"project-name"},rr=["title"],ir={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(s){const t=s,c=se(),r=u(()=>c.projects.get(t.legionId)),o=u(()=>r.value?.name||"Legion");return(n,p)=>(l(),a("div",lr,[e("div",null,[e("div",ar,f(o.value),1),e("div",{class:"view-name",title:s.legionId},"Timeline",8,rr)])]))}},ur=R(ir,[["__scopeId","data-v-44f386f5"]]),cr={class:"timeline-status-bar border-top p-2 bg-light"},dr={class:"d-flex justify-content-end"},mr={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(s){const t=ee();function c(){t.setAutoScroll(!t.autoScrollEnabled)}return(r,o)=>(l(),a("div",cr,[e("div",dr,[e("button",{class:U(["btn btn-sm",be(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:c}," â¬‡ï¸ "+f(be(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},pr=R(mr,[["__scopeId","data-v-891c73db"]]),vr={class:"comm-composer border-top p-3"},fr={class:"d-flex gap-2 mb-2"},gr={class:"flex-grow-1"},_r=["disabled"],br={label:"Minions"},hr=["value"],yr={key:0,label:"Channels"},$r=["value"],wr={style:{"min-width":"150px"}},Sr=["disabled"],kr={class:"d-flex gap-2 align-items-end position-relative"},Cr={class:"flex-grow-1 position-relative"},xr=["disabled"],jr=["onClick","onMouseenter"],Mr=["disabled"],Tr={key:0},Er={key:1},Pr={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(s){const t=s,c=Ce(),r=J(),o=se(),n=I(""),p=I("task"),g=I(""),i=I(!1),v=I(!1),b=I([]),y=I(0),_=I(-1),h=I(null),x=I(null),T=u(()=>{const k=o.projects.get(t.legionId);return!k||!k.session_ids?[]:k.session_ids.map(O=>r.sessions.get(O)).filter(O=>O&&O.is_minion)}),w=u(()=>c.currentChannels||[]),$=u(()=>n.value&&g.value.trim().length>0);function C(k){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[k.state]||"â—‹"}function m(k){return k.is_minion&&k.role?`${k.name} (${k.role})`:k.name}function d(){const k=h.value;if(!k)return;k.style.height="auto";const O=Math.min(k.scrollHeight,parseInt(getComputedStyle(k).maxHeight));k.style.height=O+"px"}function M(){const k=h.value;if(!k)return;d();const O=g.value,L=k.selectionStart,W=O.substring(0,L),B=W.lastIndexOf("#");if(B===-1){v.value=!1;return}const D=W.substring(B+1).toLowerCase();if(D.includes(" ")){v.value=!1;return}const A=T.value.filter(q=>q.name.toLowerCase().includes(D)).map(q=>({type:"minion",name:q.name,role:q.role,id:q.session_id,state:q.state}));if(A.length===0){v.value=!1;return}b.value=A,y.value=0,_.value=B,v.value=!0}function N(){if(!x.value)return;const k=x.value,O=k.children[y.value];if(!O)return;const L=O.offsetTop,W=O.offsetHeight,B=k.scrollTop,D=k.clientHeight;L<B?k.scrollTop=L:L+W>B+D&&(k.scrollTop=L+W-D)}function S(k){if(!v.value){k.key==="Enter"&&!k.shiftKey&&$.value&&(k.preventDefault(),E());return}if(k.key==="ArrowDown")k.preventDefault(),y.value=(y.value+1)%b.value.length,N();else if(k.key==="ArrowUp")k.preventDefault(),y.value=y.value===0?b.value.length-1:y.value-1,N();else if(k.key==="Enter"){k.preventDefault();const O=b.value[y.value];O&&j(O)}else k.key==="Escape"&&(v.value=!1)}function j(k){const O=h.value;if(!O)return;const L=g.value,W=O.selectionStart,B=L.substring(0,_.value)+"#"+k.name+" "+L.substring(W);g.value=B;const D=_.value+k.name.length+2;setTimeout(()=>{O.setSelectionRange(D,D),O.focus()},0),v.value=!1}async function E(){if(!(!$.value||i.value)){i.value=!0;try{const[k,O]=n.value.split(":"),L={comm_type:p.value,content:g.value.trim()};k==="minion"?L.to_minion_id=O:k==="channel"&&(L.to_channel_id=O),await c.sendComm(t.legionId,L),g.value="",d()}catch(k){console.error("Failed to send comm:",k),alert(`Failed to send comm: ${k.message}`)}finally{i.value=!1}}}return X(v,k=>{if(k){const O=L=>{L.target.closest(".comm-composer")||(v.value=!1,document.removeEventListener("click",O))};setTimeout(()=>document.addEventListener("click",O),0)}}),(k,O)=>(l(),a("div",vr,[e("div",fr,[e("div",gr,[K(e("select",{"onUpdate:modelValue":O[0]||(O[0]=L=>n.value=L),class:"form-select form-select-sm",disabled:i.value},[O[3]||(O[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",br,[(l(!0),a(Q,null,Z(T.value,L=>(l(),a("option",{key:L.session_id,value:`minion:${L.session_id}`},f(C(L))+" "+f(m(L)),9,hr))),128))]),w.value.length>0?(l(),a("optgroup",yr,[(l(!0),a(Q,null,Z(w.value,L=>(l(),a("option",{key:L.channel_id,value:`channel:${L.channel_id}`}," #ï¸âƒ£ "+f(L.name),9,$r))),128))])):P("",!0)],8,_r),[[me,n.value]])]),e("div",wr,[K(e("select",{"onUpdate:modelValue":O[1]||(O[1]=L=>p.value=L),class:"form-select form-select-sm",disabled:i.value},[...O[4]||(O[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,Sr),[[me,p.value]])])]),e("div",kr,[e("div",Cr,[K(e("textarea",{ref_key:"contentTextarea",ref:h,"onUpdate:modelValue":O[2]||(O[2]=L=>g.value=L),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:i.value,onInput:M,onKeydown:S},null,40,xr),[[te,g.value]]),v.value?(l(),a("div",{key:0,ref_key:"autocompleteDropdown",ref:x,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(l(!0),a(Q,null,Z(b.value,(L,W)=>(l(),a("div",{key:L.id,class:U(["autocomplete-item px-2 py-1",{"bg-light":W===y.value}]),onClick:B=>j(L),onMouseenter:B=>y.value=W},f(L.type==="minion"?C(L):"#ï¸âƒ£")+" "+f(L.name)+f(L.role?` (${L.role})`:""),43,jr))),128))],512)):P("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!$.value||i.value,onClick:E},[i.value?(l(),a("span",Tr,[...O[5]||(O[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),H(" Sending... ",-1)])])):(l(),a("span",Er,"Send"))],8,Mr)])])]))}},Ir=R(Pr,[["__scopeId","data-v-ffa54193"]]),Lr={class:"timeline-view d-flex flex-column h-100"},Dr={key:0,class:"text-center text-muted"},Or={key:1,class:"text-center text-danger"},Nr={key:2,class:"text-center text-muted"},Ar={key:3,class:"comm-list"},qr={class:"col-auto message-speaker text-end pe-3"},Rr={class:"text-muted"},Ur={class:"col message-content-column"},Wr={class:"comm-card card"},Hr={class:"card-body p-2"},Fr={class:"d-flex justify-content-between align-items-start mb-1"},Br={class:"ms-2"},Vr={class:"comm-content"},zr={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(s){const t=s,c=Ce(),r=se(),o=J(),n=pe(),p=ee(),g=I(!0),i=I(null),v=I(null),b=u(()=>r.projects.get(t.legionId));u(()=>b.value?.name||"Legion");const y=u(()=>c.currentComms);u(()=>c.currentMinions);function _(d){return d.from_user?"You":d.from_minion_id&&o.sessions.get(d.from_minion_id)?.name||"Unknown"}function h(d){return d.to_user?"You":d.to_minion_id?o.sessions.get(d.to_minion_id)?.name||"Unknown":d.to_channel_id?`#${d.to_channel_id}`:"All"}function x(d){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[d]||"bg-secondary"}function T(d){return new Date(d).toLocaleTimeString()}async function w(){p.autoScrollEnabled&&(await Se(),v.value&&(v.value.scrollTop=v.value.scrollHeight))}async function $(){g.value=!0,i.value=null;try{c.setCurrentLegion(t.legionId),await Promise.all([c.loadTimeline(t.legionId),c.loadMinions(t.legionId)]),await Se(),await w(),setTimeout(()=>{w()},100)}catch(d){console.error("Failed to load timeline:",d),d.response?i.value=`${d.message} (${d.response.status})`:i.value=d.message||"Unknown error"}finally{g.value=!1}}function C(){n.connectLegion(t.legionId)}function m(){n.disconnectLegion()}return X(()=>y.value.length,()=>{w()}),le(()=>{$(),C(),setTimeout(()=>{w()},100)}),ae(()=>{m()}),(d,M)=>(l(),a("div",Lr,[Y(ur,{"legion-id":s.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:v,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[g.value?(l(),a("div",Dr,[...M[0]||(M[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),H(" Loading timeline... ",-1)])])):i.value?(l(),a("div",Or," Failed to load timeline: "+f(i.value),1)):y.value.length===0?(l(),a("div",Nr," No messages yet. Minions will appear here once they start communicating. ")):(l(),a("div",Ar,[(l(!0),a(Q,null,Z(y.value,N=>(l(),a("div",{key:N.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",qr,[e("small",Rr,f(T(N.timestamp)),1)]),e("div",Ur,[e("div",Wr,[e("div",Hr,[e("div",Fr,[e("div",null,[e("span",{class:U(["badge",x(N.comm_type)])},f(N.comm_type),3),e("strong",Br,f(_(N)),1),M[1]||(M[1]=e("span",{class:"text-muted mx-1"},"â†’",-1)),e("strong",null,f(h(N)),1)])]),e("div",Vr,f(N.content),1)])])])]))),128))]))],512),Y(Ir,{"legion-id":s.legionId},null,8,["legion-id"]),Y(pr,{"legion-id":s.legionId},null,8,["legion-id"])]))}},Jr=R(zr,[["__scopeId","data-v-d4c7422e"]]),Gr={class:"spy-view d-flex flex-column overflow-hidden"},Kr={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(s){return(t,c)=>(l(),a("div",Gr,[Y(qe,{"session-id":s.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},Yr=R(Kr,[["__scopeId","data-v-43a24eaf"]]),Qr={class:"horde-header border-bottom p-3"},Zr={class:"project-name"},Xr=["title"],ei={__name:"HordeHeader",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,c=se(),r=J(),o=u(()=>c.projects.get(t.legionId)),n=u(()=>o.value?.name||"Legion"),p=u(()=>r.sessions.get(t.overseerId)),g=u(()=>p.value?.name||"Overseer");return(i,v)=>(l(),a("div",Qr,[e("div",null,[e("div",Zr,f(n.value),1),e("div",{class:"view-name",title:s.overseerId},f(g.value)+"'s Horde",9,Xr)])]))}},ti=R(ei,[["__scopeId","data-v-775da47d"]]),si={class:"horde-status-bar border-top p-2 bg-light"},oi={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){return(t,c)=>(l(),a("div",si,[...c[0]||(c[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},ni=R(oi,[["__scopeId","data-v-7f3c847f"]]),li={class:"minion-card p-2 border-start border-2 mb-2"},ai={class:"d-flex align-items-center"},ri={class:"me-2"},ii={key:0,class:"me-2"},ui={key:1,class:"text-muted ms-2"},ci={key:2,class:"badge bg-secondary ms-2"},di={class:"text-muted small ms-4"},mi={key:0,class:"minion-children"},pi={key:1,class:"text-danger small ms-4"},vi={__name:"MinionTreeNode",props:{minionId:{type:String,required:!0},level:{type:Number,default:0}},setup(s){const t=s,c=J(),r=u(()=>c.sessions.get(t.minionId)),o=u(()=>t.level*24),n=u(()=>{const v=r.value&&r.value.child_minion_ids&&r.value.child_minion_ids.length>0;return r.value&&r.value.child_minion_ids&&r.value.child_minion_ids.length>0&&console.log(`Minion ${r.value.name} has ${r.value.child_minion_ids.length} children:`,r.value.child_minion_ids),v}),p=u(()=>r.value&&r.value.is_overseer&&n.value),g={created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "},i=u(()=>g[r.value?.state]||"â—‹");return(v,b)=>{const y=Ae("MinionTreeNode",!0);return r.value?(l(),a("div",{key:0,class:"minion-tree-node",style:ue({marginLeft:`${o.value}px`})},[e("div",li,[e("div",ai,[e("span",ri,f(i.value),1),p.value?(l(),a("span",ii,"ðŸ‘‘")):P("",!0),e("strong",null,f(r.value.name),1),r.value.role?(l(),a("span",ui,f(r.value.role),1)):P("",!0),p.value?(l(),a("span",ci,f(r.value.child_minion_ids.length)+" "+f(r.value.child_minion_ids.length===1?"child":"children"),1)):P("",!0)]),e("div",di," Level "+f(r.value.overseer_level||0)+" â€¢ "+f(r.value.state),1)]),n.value?(l(),a("div",mi,[(l(!0),a(Q,null,Z(r.value.child_minion_ids,_=>(l(),re(y,{key:_,"minion-id":_,level:s.level+1},null,8,["minion-id","level"]))),128))])):P("",!0)],4)):t.minionId?(l(),a("div",pi," âš  Minion data not found for ID: "+f(t.minionId),1)):P("",!0)}}},fi=R(vi,[["__scopeId","data-v-120682eb"]]),gi={class:"horde-view d-flex flex-column h-100"},_i={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},bi={key:0,class:"alert alert-danger"},hi={key:1,class:"horde-tree"},yi={__name:"HordeView",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,c=J(),r=se(),o=u(()=>r.projects.get(t.legionId));u(()=>o.value?.name||"Legion");const n=u(()=>c.sessions.get(t.overseerId));return(p,g)=>(l(),a("div",gi,[Y(ti,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"]),e("div",_i,[n.value?(l(),a("div",hi,[Y(fi,{"minion-id":s.overseerId,level:0},null,8,["minion-id"])])):(l(),a("div",bi," Overseer not found "))]),Y(ni,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"])]))}},$i=R(yi,[["__scopeId","data-v-b928719b"]]),wi=[{path:"/",name:"home",component:Ve},{path:"/session/:sessionId",name:"session",component:qe,props:!0},{path:"/timeline/:legionId",name:"timeline",component:Jr,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:Yr,props:!0},{path:"/horde/:legionId/:overseerId",name:"horde",component:$i,props:!0}],Si=Re({history:Ue(),routes:wi}),ki={__name:"ConnectionIndicator",setup(s){const t=pe(),c=u(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),r=u(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(o,n)=>(l(),a("span",{id:"connection-indicator",class:U(["badge",c.value])},f(r.value),3))}},Ci={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},xi={class:"d-flex align-items-center gap-2"},ji={__name:"AppHeader",setup(s){const t=ee();function c(){t.toggleSidebar()}return(r,o)=>(l(),a("header",Ci,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:c},[...o[0]||(o[0]=[e("span",null,"â˜°",-1)])]),o[1]||(o[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",xi,[Y(ki)])]))}},Mi={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},Ti={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},Ei=["title"],Pi={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,c=u(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function r(g){return g.state==="paused"&&g.is_processing?"pending-prompt":g.is_processing?"processing":g.state}function o(g){const i=r(g);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[i]||"#d3d3d3"}function n(g){const i=r(g);return i==="starting"||i==="processing"||i==="pending-prompt"}function p(g){const i=r(g),v=i.charAt(0).toUpperCase()+i.slice(1),b=g.name||"Unnamed Session",y=g.is_minion&&g.role?` (${g.role})`:"";return`${b}${y}: ${v}`}return(g,i)=>(l(),a("div",Mi,[!s.sessions||s.sessions.length===0?(l(),a("div",Ti)):(l(!0),a(Q,{key:1},Z(s.sessions,v=>(l(),a("div",{key:v.session_id,class:U(["progress-bar",{"progress-bar-striped progress-bar-animated":n(v)}]),style:ue({width:c.value,backgroundColor:o(v),cursor:"help"}),title:p(v)},null,14,Ei))),128))]))}},Ii=R(Pi,[["__scopeId","data-v-a79cfeec"]]),Li={class:"flex-grow-1"},Di={key:0,class:"text-muted small ms-1"},Oi={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(s){const t=s,c=ce(),r=J(),o=se(),n=ee(),p=u(()=>r.currentSessionId===t.session.session_id),g=u(()=>r.deletingSessions.has(t.session.session_id)),i=u(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),v=u(()=>{const $=i.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[$]||"status-dot-grey"}),b=u(()=>{const $=i.value,C={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},m={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:C[$]||"#d3d3d3",borderColor:m[$]||"#6c757d"}});function y(){r.selectSession(t.session.session_id),c.push(`/session/${t.session.session_id}`)}function _(){n.showModal("edit-session",{session:t.session})}function h($){$.dataTransfer.effectAllowed="move",$.dataTransfer.setData("application/session-id",t.session.session_id),$.dataTransfer.setData("application/project-id",t.projectId),$.dataTransfer.setData("text/plain",t.session.session_id),$.target.classList.add("dragging")}function x($){$.target.classList.remove("dragging")}function T($){$.preventDefault(),$.dataTransfer.dropEffect="move";const C=$.currentTarget.getBoundingClientRect(),m=C.top+C.height/2;$.clientY<m?($.currentTarget.classList.add("drop-above"),$.currentTarget.classList.remove("drop-below")):($.currentTarget.classList.add("drop-below"),$.currentTarget.classList.remove("drop-above"))}function w($){$.preventDefault(),$.currentTarget.classList.remove("drop-above","drop-below");const C=$.dataTransfer.getData("application/session-id")||$.dataTransfer.getData("text/plain"),m=$.dataTransfer.getData("application/project-id");if(!C||C===t.session.session_id||m!==t.projectId)return;const d=$.currentTarget.getBoundingClientRect(),M=d.top+d.height/2,N=$.clientY<M,S=o.getProject(t.projectId);if(!S||!S.session_ids)return;const j=[...S.session_ids],E=j.indexOf(t.session.session_id),k=j.indexOf(C);if(E===-1||k===-1)return;const O=[...j],[L]=O.splice(k,1);let W=N?E:E+1;k<E&&W--,O.splice(W,0,L),o.reorderSessionsInProject(t.projectId,O)}return($,C)=>(l(),a("div",{class:U(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:p.value,"session-deleting":g.value}]),style:{cursor:"pointer"},draggable:"true",onClick:y,onDragstart:h,onDragend:x,onDragover:T,onDrop:w},[e("div",{class:U(["status-dot me-2",v.value]),style:ue(b.value)},null,6),e("div",Li,[e("span",null,f(s.session.name||s.session.session_id),1),s.session.is_minion&&s.session.role?(l(),a("span",Di,"("+f(s.session.role)+")",1)):P("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:ie(_,["stop"])}," âœï¸ ")],34))}},Ni=R(Oi,[["__scopeId","data-v-07ecbf94"]]),Ai=["value"],qi={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,c=ce(),r=J(),o=I("");X(()=>c.currentRoute.value,h=>{!o.value&&h.name==="spy"&&h.params.minionId&&h.params.legionId===t.project.project_id&&(o.value=h.params.minionId)},{immediate:!0});const n=u(()=>o.value?t.sessions.find(h=>h.session_id===o.value):null),p=u(()=>{const h=c.currentRoute.value;return h.name==="spy"&&h.params.legionId===t.project.project_id}),g=u(()=>{if(!n.value)return"";if(n.value.state==="paused"&&n.value.is_processing)return"status-blinking";const h=n.value.is_processing?"processing":n.value.state;return h==="starting"||h==="processing"?"status-blinking":""}),i=u(()=>{if(!n.value)return{};if(n.value.state==="paused"&&n.value.is_processing)return{backgroundColor:"#ffc107"};const h=n.value.is_processing?"processing":n.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[h]||"#d3d3d3"}});function v(h){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[h.state]||"â—‹"}function b(h){return h.is_minion&&h.role?`${h.name} (${h.role})`:h.name}function y(){o.value&&c.push(`/spy/${t.project.project_id}/${o.value}`)}function _(){o.value?c.push(`/spy/${t.project.project_id}/${o.value}`):c.push("/")}return X(()=>r.currentSessionId,h=>{if(h)t.sessions.some(x=>x.session_id===h)&&(o.value=h);else{o.value="";const x=c.currentRoute.value;x.name==="spy"&&x.params.legionId===t.project.project_id&&c.push("/")}}),(h,x)=>(l(),a("div",{class:U(["list-group-item list-group-item-action p-2",{active:p.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:ue({cursor:o.value?"pointer":"default"}),onClick:y},[x[1]||(x[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ”"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),n.value?(l(),a("span",{key:0,class:U(["minion-state-indicator",g.value]),style:ue(i.value)}," ðŸ‘¤ ",6)):P("",!0)],4),K(e("select",{"onUpdate:modelValue":x[0]||(x[0]=T=>o.value=T),class:"form-select form-select-sm",onChange:_},[x[2]||(x[2]=e("option",{value:""},"-- Select Minion --",-1)),(l(!0),a(Q,null,Z(s.sessions,T=>(l(),a("option",{key:T.session_id,value:T.session_id},f(v(T))+" "+f(b(T)),9,Ai))),128))],544),[[me,o.value]])],2))}},Ri=R(qi,[["__scopeId","data-v-eda3ced5"]]),Ui=["value"],Wi={__name:"HordeSelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,c=ce(),r=I("");X(()=>c.currentRoute.value,v=>{!r.value&&v.name==="horde"&&v.params.overseerId&&v.params.legionId===t.project.project_id&&(r.value=v.params.overseerId)},{immediate:!0});const o=u(()=>t.sessions.filter(v=>v.is_overseer===!0)),n=u(()=>{const v=c.currentRoute.value;return v.name==="horde"&&v.params.legionId===t.project.project_id});function p(v){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[v.state]||"â—‹"}function g(){r.value&&c.push(`/horde/${t.project.project_id}/${r.value}`)}function i(){r.value&&c.push(`/horde/${t.project.project_id}/${r.value}`)}return(v,b)=>(l(),a("div",{class:U(["list-group-item list-group-item-action p-2",{active:n.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:ue({cursor:r.value?"pointer":"default"}),onClick:g},[...b[1]||(b[1]=[e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸŒ³"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],4),K(e("select",{"onUpdate:modelValue":b[0]||(b[0]=y=>r.value=y),class:"form-select form-select-sm",onChange:i},[b[2]||(b[2]=e("option",{value:""},"-- Select Overseer --",-1)),(l(!0),a(Q,null,Z(o.value,y=>(l(),a("option",{key:y.session_id,value:y.session_id},f(p(y))+" "+f(y.name),9,Ui))),128))],544),[[me,r.value]])],2))}},Hi=R(Wi,[["__scopeId","data-v-ca33279d"]]),Fi=["data-project-id"],Bi=["id"],Vi=["data-bs-target","aria-expanded","aria-controls"],zi={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},Ji={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},Gi={class:"fw-semibold",style:{"flex-shrink":"0"}},Ki={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},Yi={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},Qi=["title"],Zi=["title"],Xi=["id","aria-labelledby"],eu={class:"accordion-body p-0"},tu={class:"list-group list-group-flush"},su={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(s){const t=s,c=ce(),r=se(),o=J(),n=ee(),p=I(t.project.is_expanded||!1),g=u(()=>r.formatPath(t.project.working_directory)),i=u(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(m=>o.getSession(m)).filter(m=>m!=null)),v=u(()=>{const m=c.currentRoute.value;return m.name==="timeline"&&m.params.legionId===t.project.project_id});function b(){p.value||(r.toggleExpansion(t.project.project_id),p.value=!0)}function y(){if(p.value){r.toggleExpansion(t.project.project_id),p.value=!1;const m=o.currentSessionId;m&&o.getSession(m)&&t.project.session_ids?.includes(m)&&c.push("/"),r.currentProjectId===t.project.project_id&&c.push("/")}}function _(){n.showModal("edit-project",{project:t.project})}function h(){t.project.is_multi_agent?n.showModal("create-minion",{project:t.project}):n.showModal("create-session",{project:t.project})}function x(){c.push(`/timeline/${t.project.project_id}`)}function T(m){m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("application/project-id",t.project.project_id),m.dataTransfer.setData("text/plain",t.project.project_id),m.target.classList.add("dragging")}function w(m){m.target.classList.remove("dragging")}function $(m){m.preventDefault(),m.dataTransfer.dropEffect="move";const d=m.currentTarget.getBoundingClientRect(),M=d.top+d.height/2;m.clientY<M?(m.currentTarget.classList.add("drop-above"),m.currentTarget.classList.remove("drop-below")):(m.currentTarget.classList.add("drop-below"),m.currentTarget.classList.remove("drop-above"))}function C(m){m.preventDefault(),m.currentTarget.classList.remove("drop-above","drop-below");const d=m.dataTransfer.getData("application/project-id")||m.dataTransfer.getData("text/plain");if(!d||d===t.project.project_id)return;const M=m.currentTarget.getBoundingClientRect(),N=M.top+M.height/2,S=m.clientY<N,j=r.orderedProjects,E=j.findIndex(D=>D.project_id===t.project.project_id),k=j.findIndex(D=>D.project_id===d);if(E===-1||k===-1)return;const O=[...j],[L]=O.splice(k,1);let W=S?E:E+1;k<E&&W--,O.splice(W,0,L);const B=O.map(D=>D.project_id);r.reorderProjects(B)}return(m,d)=>(l(),a("div",{class:"accordion-item border rounded mb-2","data-project-id":s.project.project_id,draggable:"true",onDragstart:T,onDragend:w,onDragover:$,onDrop:C},[e("h2",{class:"accordion-header",id:`heading-${s.project.project_id}`},[e("button",{class:U(["accordion-button bg-white p-2",{collapsed:!p.value}]),type:"button","data-bs-toggle":"collapse","data-bs-target":`#collapse-${s.project.project_id}`,"aria-expanded":p.value,"aria-controls":`collapse-${s.project.project_id}`},[e("div",zi,[e("div",Ji,[e("div",Gi,[s.project.is_multi_agent?(l(),a("span",Ki,"ðŸ›")):P("",!0),H(" "+f(s.project.name),1)]),e("div",Yi,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:ie(_,["stop","prevent"])}," âœï¸ "),e("button",{class:"btn btn-sm btn-outline-primary",title:s.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:ie(h,["stop","prevent"])}," âž• ",8,Qi)])]),e("small",{class:"text-muted font-monospace",title:s.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},f(g.value),9,Zi)])],10,Vi)],8,Bi),Y(Ii,{project:s.project,sessions:i.value},null,8,["project","sessions"]),e("div",{id:`collapse-${s.project.project_id}`,class:U(["accordion-collapse collapse",{show:p.value}]),"aria-labelledby":`heading-${s.project.project_id}`,onShown:b,onHidden:y},[e("div",eu,[e("div",tu,[s.project.is_multi_agent?(l(),a("div",{key:0,class:U(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:v.value}]),style:{cursor:"pointer"},onClick:x},[...d[0]||(d[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ“Š"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):P("",!0),s.project.is_multi_agent?(l(),a(Q,{key:1},[Y(Ri,{project:s.project,sessions:i.value},null,8,["project","sessions"]),Y(Hi,{project:s.project,sessions:i.value},null,8,["project","sessions"])],64)):(l(!0),a(Q,{key:2},Z(i.value,M=>(l(),re(Ni,{key:M.session_id,session:M,"project-id":s.project.project_id},null,8,["session","project-id"]))),128))])])],42,Xi)],40,Fi))}},ou=R(su,[["__scopeId","data-v-4cc3dd53"]]),nu={class:"project-list"},lu={key:0,class:"text-muted text-center py-3"},au={__name:"ProjectList",setup(s){const t=se(),c=u(()=>t.orderedProjects);return(r,o)=>(l(),a("div",nu,[c.value.length===0?(l(),a("div",lu,' No projects yet. Click "New" to create one. ')):P("",!0),(l(!0),a(Q,null,Z(c.value,n=>(l(),re(ou,{key:n.project_id,project:n},null,8,["project"]))),128))]))}},ru={class:"flex-grow-1 overflow-auto p-3"},iu={id:"sessions-container"},uu={__name:"Sidebar",setup(s){const t=ee(),c=u(()=>t.sidebarCollapsed),r=u(()=>t.isMobile),o=u(()=>{if(r.value)return{};const b=`${t.sidebarWidth}px`;return{width:b,minWidth:"200px",maxWidth:"30vw","--sidebar-width":b}});function n(){t.showModal("create-project")}const p=I(!1);function g(b){p.value=!0,document.addEventListener("mousemove",i),document.addEventListener("mouseup",v)}function i(b){p.value&&t.setSidebarWidth(b.clientX)}function v(){p.value=!1,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",v)}return(b,y)=>(l(),a("aside",{id:"sidebar",class:U(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:c.value,"mobile-open":!c.value&&r.value,"desktop-collapsed":c.value&&!r.value}]),style:ue(o.value)},[e("div",ru,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[y[0]||(y[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:n}," ðŸ“ New ")]),e("div",iu,[Y(au)])]),e("div",{class:"sidebar-resize-handle",onMousedown:g},null,32)],6))}},cu=R(uu,[["__scopeId","data-v-d792f0f0"]]),du={class:"modal-dialog modal-lg"},mu={class:"modal-content"},pu={class:"modal-body"},vu={class:"mb-3"},fu={class:"input-group"},gu=["disabled"],_u={key:0,class:"text-center py-4"},bu={key:1,class:"alert alert-danger",role:"alert"},hu={key:2,class:"folder-list"},yu=["onClick","onDblclick"],$u={class:"d-flex align-items-center flex-grow-1"},wu=["onClick"],Su={key:1,class:"text-center text-muted py-3"},ku={class:"modal-footer"},Cu=["disabled"],xu={__name:"FolderBrowserModal",setup(s){const t=ee(),c=I(""),r=I(""),o=I([]),n=I(!1),p=I(""),g=I(null);let i=null,v=null;const b=u(()=>{if(!c.value)return null;const m=c.value.split(/[\\/]/).filter(Boolean);return m.length<=1?null:(m.pop(),m.length>0?m.join("/"):"/")});function y(m){if(!m)return"";const d=m.split(/[\\/]/).filter(Boolean);return d.length<=2?m:".../"+d.slice(-2).join("/")}async function _(){n.value=!0,p.value="",o.value=[],r.value="";try{const m=c.value?{path:c.value}:{},d=await G.get("/api/filesystem/browse",{params:m});d.current_path&&(c.value=d.current_path),o.value=d.directories||[]}catch(m){console.error("Failed to load directory:",m),p.value=m.message||"Failed to load directory"}finally{n.value=!1}}function h(m){r.value=m.path}function x(m){c.value=m.path,r.value="",_()}function T(){b.value&&(c.value=b.value,r.value="",_())}function w(){const m=r.value||c.value;m&&v&&v(m),i&&i.hide()}function $(){_()}function C(){o.value=[],r.value="",p.value="",v=null,t.hideModal()}return X(()=>t.currentModal,m=>{if(m?.name==="folder-browser"&&i){const d=m.data||{};c.value=d.currentPath||"",v=d.onSelect||null,i.show()}}),le(()=>{g.value&&ne(async()=>{const{default:m}=await import("./modal-B4rHLo2F.js").then(d=>d.m);return{default:m}},__vite__mapDeps([0,1])).then(({default:m})=>{i=new m(g.value),g.value.addEventListener("shown.bs.modal",$),g.value.addEventListener("hidden.bs.modal",C)})}),ae(()=>{g.value&&(g.value.removeEventListener("shown.bs.modal",$),g.value.removeEventListener("hidden.bs.modal",C)),i&&i.dispose()}),(m,d)=>(l(),a("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:g},[e("div",du,[e("div",mu,[d[7]||(d[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",pu,[e("div",vu,[d[2]||(d[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",fu,[K(e("input",{type:"text",class:"form-control","onUpdate:modelValue":d[0]||(d[0]=M=>c.value=M),onKeyup:Ne(_,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[te,c.value]]),e("button",{class:"btn btn-outline-secondary",onClick:_,disabled:n.value},[...d[1]||(d[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),H(" Refresh ",-1)])],8,gu)])]),n.value?(l(),a("div",_u,[...d[3]||(d[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):p.value?(l(),a("div",bu,f(p.value),1)):(l(),a("div",hu,[b.value?(l(),a("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:T,role:"button"},[...d[4]||(d[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):P("",!0),(l(!0),a(Q,null,Z(o.value,M=>(l(),a("div",{key:M.path,class:U(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:M.path===r.value}]),onClick:N=>h(M),onDblclick:N=>x(M),role:"button"},[e("div",$u,[d[5]||(d[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,f(M.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:ie(N=>x(M),["stop"])}," Open ",8,wu)],42,yu))),128)),o.value.length===0?(l(),a("div",Su," No subdirectories found ")):P("",!0)]))]),e("div",ku,[d[6]||(d[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:w,disabled:!r.value},' Select "'+f(y(r.value||c.value))+'" ',9,Cu)])])])],512))}},ju=R(xu,[["__scopeId","data-v-667c51a9"]]),Mu={class:"modal-dialog"},Tu={class:"modal-content"},Eu={class:"modal-body"},Pu={class:"mb-3"},Iu={key:0,class:"invalid-feedback"},Lu={class:"mb-3"},Du={class:"input-group"},Ou={key:0,class:"invalid-feedback"},Nu={class:"mb-3 form-check"},Au={class:"mb-3 form-check"},qu={class:"form-check-label",for:"createSession"},Ru={key:0,class:"mb-3 ms-4"},Uu={for:"sessionName",class:"form-label"},Wu={key:1,class:"alert alert-danger",role:"alert"},Hu={class:"modal-footer"},Fu=["disabled"],Bu={key:0,class:"spinner-border spinner-border-sm me-2"},Vu={__name:"ProjectCreateModal",setup(s){const t=se(),c=J(),r=ee(),o=I({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),n=I({name:"",workingDirectory:""}),p=I(!1),g=I(""),i=I(null);let v=null;function b(){r.showModal("folder-browser",{currentPath:o.value.workingDirectory||"",onSelect:w=>{o.value.workingDirectory=w,n.value.workingDirectory=""}})}function y(){n.value={};let w=!0;return o.value.name.trim()||(n.value.name="Project name is required",w=!1),o.value.workingDirectory.trim()||(n.value.workingDirectory="Working directory is required",w=!1),w}async function _(){if(y()){p.value=!0,g.value="";try{const w=await t.createProject(o.value.name,o.value.workingDirectory,o.value.isMultiAgent);o.value.createSession&&await c.createSession(w.project_id,{name:o.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),v&&v.hide(),h()}catch(w){console.error("Failed to create project:",w),g.value=w.message||"Failed to create project. Please try again."}finally{p.value=!1}}}function h(){o.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},n.value={},g.value=""}function x(){const w=document.getElementById("projectName");w&&w.focus()}function T(){h(),r.hideModal()}return X(()=>r.currentModal,w=>{w?.name==="create-project"&&v&&v.show()}),le(()=>{i.value&&ne(async()=>{const{default:w}=await import("./modal-B4rHLo2F.js").then($=>$.m);return{default:w}},__vite__mapDeps([0,1])).then(({default:w})=>{v=new w(i.value),i.value.addEventListener("shown.bs.modal",x),i.value.addEventListener("hidden.bs.modal",T)})}),ae(()=>{i.value&&(i.value.removeEventListener("shown.bs.modal",x),i.value.removeEventListener("hidden.bs.modal",T)),v&&v.dispose()}),(w,$)=>(l(),a("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",Mu,[e("div",Tu,[$[11]||($[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Eu,[e("form",{onSubmit:ie(_,["prevent"])},[e("div",Pu,[$[5]||($[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),K(e("input",{type:"text",class:U(["form-control",{"is-invalid":n.value.name}]),id:"projectName","onUpdate:modelValue":$[0]||($[0]=C=>o.value.name=C),placeholder:"My Project",required:""},null,2),[[te,o.value.name]]),n.value.name?(l(),a("div",Iu,f(n.value.name),1)):P("",!0)]),e("div",Lu,[$[6]||($[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",Du,[K(e("input",{type:"text",class:U(["form-control",{"is-invalid":n.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":$[1]||($[1]=C=>o.value.workingDirectory=C),placeholder:"/path/to/project",required:""},null,2),[[te,o.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:b}," Browse... "),n.value.workingDirectory?(l(),a("div",Ou,f(n.value.workingDirectory),1)):P("",!0)]),$[7]||($[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",Nu,[K(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":$[2]||($[2]=C=>o.value.isMultiAgent=C)},null,512),[[fe,o.value.isMultiAgent]]),$[8]||($[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," ðŸ› Multi-Agent Project (Legion) ",-1)),$[9]||($[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",Au,[K(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":$[3]||($[3]=C=>o.value.createSession=C)},null,512),[[fe,o.value.createSession]]),e("label",qu," Create initial "+f(o.value.isMultiAgent?"minion":"session"),1)]),o.value.createSession?(l(),a("div",Ru,[e("label",Uu," Initial "+f(o.value.isMultiAgent?"Minion":"Session")+" Name ",1),K(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":$[4]||($[4]=C=>o.value.sessionName=C),placeholder:"main"},null,512),[[te,o.value.sessionName]])])):P("",!0),g.value?(l(),a("div",Wu,f(g.value),1)):P("",!0)],32)]),e("div",Hu,[$[10]||($[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:_,disabled:p.value},[p.value?(l(),a("span",Bu)):P("",!0),H(" "+f(p.value?"Creating...":"Create Project"),1)],8,Fu)])])])],512))}},zu=R(Vu,[["__scopeId","data-v-adf50394"]]),Ju={class:"modal-dialog"},Gu={class:"modal-content"},Ku={class:"modal-body"},Yu={class:"mb-3"},Qu={key:0,class:"invalid-feedback"},Zu={class:"mb-3"},Xu=["value"],ec={key:0,class:"alert alert-danger",role:"alert"},tc={class:"danger-zone"},sc={class:"text-muted small"},oc=["disabled"],nc={key:0,class:"alert alert-warning mt-3",role:"alert"},lc={class:"mb-2"},ac={class:"d-flex gap-2"},rc=["disabled"],ic={key:0,class:"spinner-border spinner-border-sm me-2"},uc=["disabled"],cc={class:"modal-footer"},dc=["disabled"],mc={key:0,class:"spinner-border spinner-border-sm me-2"},pc={__name:"ProjectEditModal",setup(s){const t=se(),c=ee(),r=I(null),o=I({name:""}),n=I({name:""}),p=I(!1),g=I(!1),i=I(""),v=I(!1),b=I(null);let y=null;const _=u(()=>r.value?.session_ids?.length||0);function h(){n.value={};let m=!0;return o.value.name.trim()||(n.value.name="Project name is required",m=!1),m}async function x(){if(!(!h()||!r.value)){p.value=!0,i.value="";try{await t.updateProject(r.value.project_id,{name:o.value.name}),y&&y.hide()}catch(m){console.error("Failed to update project:",m),i.value=m.message||"Failed to update project. Please try again."}finally{p.value=!1}}}async function T(){if(r.value){g.value=!0,i.value="";try{await t.deleteProject(r.value.project_id),y&&y.hide()}catch(m){console.error("Failed to delete project:",m),i.value=m.message||"Failed to delete project. Please try again."}finally{g.value=!1}}}function w(){o.value={name:""},n.value={},i.value="",v.value=!1}function $(){const m=document.getElementById("editProjectName");m&&(m.focus(),m.select())}function C(){w(),r.value=null,c.hideModal()}return X(()=>c.currentModal,m=>{if(m?.name==="edit-project"&&y){const d=m.data||{};r.value=d.project,r.value&&(o.value.name=r.value.name),y.show()}}),le(()=>{b.value&&ne(async()=>{const{default:m}=await import("./modal-B4rHLo2F.js").then(d=>d.m);return{default:m}},__vite__mapDeps([0,1])).then(({default:m})=>{y=new m(b.value),b.value.addEventListener("shown.bs.modal",$),b.value.addEventListener("hidden.bs.modal",C)})}),ae(()=>{b.value&&(b.value.removeEventListener("shown.bs.modal",$),b.value.removeEventListener("hidden.bs.modal",C)),y&&y.dispose()}),(m,d)=>(l(),a("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:b},[e("div",Ju,[e("div",Gu,[d[11]||(d[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Ku,[e("form",{onSubmit:ie(x,["prevent"])},[e("div",Yu,[d[3]||(d[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),K(e("input",{type:"text",class:U(["form-control",{"is-invalid":n.value.name}]),id:"editProjectName","onUpdate:modelValue":d[0]||(d[0]=M=>o.value.name=M),placeholder:"My Project",required:""},null,2),[[te,o.value.name]]),n.value.name?(l(),a("div",Qu,f(n.value.name),1)):P("",!0)]),e("div",Zu,[d[4]||(d[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:r.value?.working_directory,disabled:"",readonly:""},null,8,Xu),d[5]||(d[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),i.value?(l(),a("div",ec,f(i.value),1)):P("",!0)],32),d[9]||(d[9]=e("hr",null,null,-1)),e("div",tc,[d[7]||(d[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",sc," Deleting this project will also delete all "+f(_.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:d[1]||(d[1]=M=>v.value=!0),disabled:g.value},[...d[6]||(d[6]=[e("i",{class:"bi bi-trash"},null,-1),H(" Delete Project ",-1)])],8,oc)]),v.value?(l(),a("div",nc,[d[8]||(d[8]=e("strong",null,"Are you sure?",-1)),e("p",lc,' This will permanently delete the project "'+f(r.value?.name)+'" and all '+f(_.value)+" session(s). ",1),e("div",ac,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:T,disabled:g.value},[g.value?(l(),a("span",ic)):P("",!0),H(" "+f(g.value?"Deleting...":"Yes, Delete Permanently"),1)],8,rc),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:d[2]||(d[2]=M=>v.value=!1),disabled:g.value}," Cancel ",8,uc)])])):P("",!0)]),e("div",cc,[d[10]||(d[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:x,disabled:p.value},[p.value?(l(),a("span",mc)):P("",!0),H(" "+f(p.value?"Saving...":"Save Changes"),1)],8,dc)])])])],512))}},vc=R(pc,[["__scopeId","data-v-6f299f35"]]),fc={class:"modal-dialog modal-lg"},gc={class:"modal-content"},_c={class:"modal-header"},bc={class:"modal-title",id:"createSessionModalLabel"},hc={key:0,class:"text-muted small"},yc={class:"modal-body"},$c={class:"mb-3"},wc={key:0,class:"invalid-feedback"},Sc={class:"mb-3"},kc={class:"mb-3"},Cc={class:"mb-3"},xc={class:"form-text d-flex justify-content-between"},jc={key:0,class:"invalid-feedback"},Mc={class:"mb-3 form-check"},Tc={key:0,class:"form-text text-warning"},Ec={class:"mb-3"},Pc={class:"mb-3 form-check"},Ic={key:0,class:"alert alert-danger",role:"alert"},Lc={class:"modal-footer"},Dc=["disabled"],Oc={key:0,class:"spinner-border spinner-border-sm me-2"},Nc={__name:"SessionCreateModal",setup(s){const t=ce();se();const c=J(),r=ee(),o=I(null),n=I({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0}),p=I({name:""}),g=I(!1),i=I(""),v=I(null);let b=null;const y=u(()=>n.value.system_prompt.length),_=u(()=>y.value>6e3),h=u(()=>y.value>5500&&y.value<=6e3);function x(){p.value={};let m=!0;return n.value.name.trim()||(p.value.name="Session name is required",m=!1),_.value&&(m=!1),m}async function T(){if(!(!x()||!o.value)){g.value=!0,i.value="";try{const m=n.value.tools.split(",").map(N=>N.trim()).filter(N=>N.length>0),d={name:n.value.name,permission_mode:n.value.permission_mode,model:n.value.model,system_prompt:n.value.system_prompt.trim()||null,override_system_prompt:n.value.override_system_prompt,tools:m},M=await c.createSession(o.value.project_id,d);n.value.startImmediately&&await c.startSession(M.session_id),t.push(`/session/${M.session_id}`),b&&b.hide(),w()}catch(m){console.error("Failed to create session:",m),i.value=m.message||"Failed to create session. Please try again."}finally{g.value=!1}}}function w(){n.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0},p.value={},i.value=""}function $(){const m=document.getElementById("sessionName");m&&m.focus()}function C(){w(),o.value=null,r.hideModal()}return X(()=>r.currentModal,m=>{if(m?.name==="create-session"&&b){const d=m.data||{};o.value=d.project,b.show()}}),le(()=>{v.value&&ne(async()=>{const{default:m}=await import("./modal-B4rHLo2F.js").then(d=>d.m);return{default:m}},__vite__mapDeps([0,1])).then(({default:m})=>{b=new m(v.value),v.value.addEventListener("shown.bs.modal",$),v.value.addEventListener("hidden.bs.modal",C)})}),ae(()=>{v.value&&(v.value.removeEventListener("shown.bs.modal",$),v.value.removeEventListener("hidden.bs.modal",C)),b&&b.dispose()}),(m,d)=>(l(),a("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",fc,[e("div",gc,[e("div",_c,[e("h5",bc,[d[7]||(d[7]=H(" Create New Session ",-1)),o.value?(l(),a("span",hc,"in "+f(o.value.name),1)):P("",!0)]),d[8]||(d[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",yc,[e("form",{onSubmit:ie(T,["prevent"])},[e("div",$c,[d[9]||(d[9]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),K(e("input",{type:"text",class:U(["form-control",{"is-invalid":p.value.name}]),id:"sessionName","onUpdate:modelValue":d[0]||(d[0]=M=>n.value.name=M),placeholder:"main",required:""},null,2),[[te,n.value.name]]),p.value.name?(l(),a("div",wc,f(p.value.name),1)):P("",!0)]),e("div",Sc,[d[11]||(d[11]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),K(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":d[1]||(d[1]=M=>n.value.permission_mode=M)},[...d[10]||(d[10]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"âš ï¸ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[me,n.value.permission_mode]]),d[12]||(d[12]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",kc,[d[14]||(d[14]=e("label",{for:"model",class:"form-label"},"Model",-1)),K(e("select",{class:"form-select",id:"model","onUpdate:modelValue":d[2]||(d[2]=M=>n.value.model=M)},[...d[13]||(d[13]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[me,n.value.model]])]),e("div",Cc,[d[15]||(d[15]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),K(e("textarea",{class:U(["form-control",{"is-invalid":_.value}]),id:"systemPrompt","onUpdate:modelValue":d[3]||(d[3]=M=>n.value.system_prompt=M),rows:"3",maxlength:6e3,placeholder:"Additional instructions to append to the system prompt..."},null,2),[[te,n.value.system_prompt]]),e("div",xc,[e("span",null,f(n.value.override_system_prompt?"These instructions will replace Claude Code's default system prompt":"These instructions will be appended to Claude Code's default system prompt"),1),e("span",{class:U({"text-danger":_.value,"text-warning":h.value})},f(y.value)+" / 6000 chars ",3)]),_.value?(l(),a("div",jc," System prompt exceeds 6000 character limit (Windows command-line constraint) ")):P("",!0)]),e("div",Mc,[K(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":d[4]||(d[4]=M=>n.value.override_system_prompt=M)},null,512),[[fe,n.value.override_system_prompt]]),d[17]||(d[17]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom prompt only) ",-1)),n.value.override_system_prompt?(l(),a("div",Tc,[...d[16]||(d[16]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom instructions will be used (no Claude Code preset).",-1)])])):P("",!0)]),e("div",Ec,[d[18]||(d[18]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),K(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":d[5]||(d[5]=M=>n.value.tools=M),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[te,n.value.tools]]),d[19]||(d[19]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",Pc,[K(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":d[6]||(d[6]=M=>n.value.startImmediately=M)},null,512),[[fe,n.value.startImmediately]]),d[20]||(d[20]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),i.value?(l(),a("div",Ic,f(i.value),1)):P("",!0)],32)]),e("div",Lc,[d[21]||(d[21]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:T,disabled:g.value},[g.value?(l(),a("span",Oc)):P("",!0),H(" "+f(g.value?"Creating...":"Create Session"),1)],8,Dc)])])])],512))}},Ac=R(Nc,[["__scopeId","data-v-5aef47e0"]]),qc={class:"modal-dialog"},Rc={class:"modal-content"},Uc={class:"modal-body"},Wc={class:"mb-3"},Hc={key:0,class:"invalid-feedback"},Fc={class:"mb-3"},Bc=["value"],Vc={class:"mb-3"},zc={class:"form-control-plaintext"},Jc={class:"mb-3"},Gc=["disabled"],Kc={key:0,value:"bypassPermissions"},Yc={class:"form-text"},Qc={key:0,class:"text-warning"},Zc={key:1},Xc={key:0,class:"mb-3"},ed={class:"card"},td={class:"card-body"},sd={key:0,class:"mb-2"},od={key:1,class:"mb-2"},nd={key:2,class:"mt-2"},ld={class:"form-control",style:{height:"auto","min-height":"60px","white-space":"pre-wrap"},readonly:""},ad={key:1,class:"alert alert-danger",role:"alert"},rd={class:"modal-footer"},id=["disabled"],ud={key:0,class:"spinner-border spinner-border-sm me-2"},cd={__name:"SessionEditModal",setup(s){const t=J(),c=ee(),r=I(null),o=I({name:"",permission_mode:"default"}),n=I({name:""}),p=I(!1),g=I(""),i=I(null);let v=null;const b=u(()=>r.value?.state==="active"||r.value?.state==="starting"),y=u(()=>r.value?.initial_permission_mode==="bypassPermissions");function _(C){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[C]||"bg-secondary"}function h(){n.value={};let C=!0;return o.value.name.trim()||(n.value.name="Session name is required",C=!1),C}async function x(){if(!(!h()||!r.value)){p.value=!0,g.value="";try{await t.updateSessionName(r.value.session_id,o.value.name),o.value.permission_mode!==r.value.current_permission_mode&&await t.setPermissionMode(r.value.session_id,o.value.permission_mode),v&&v.hide()}catch(C){console.error("Failed to update session:",C),g.value=C.message||"Failed to update session. Please try again."}finally{p.value=!1}}}function T(){o.value={name:"",permission_mode:"default"},n.value={},g.value=""}function w(){const C=document.getElementById("editSessionName");C&&(C.focus(),C.select())}function $(){T(),r.value=null,c.hideModal()}return X(()=>c.currentModal,C=>{if(C?.name==="edit-session"&&v){const m=C.data||{};r.value=m.session,r.value&&(o.value.name=r.value.name,o.value.permission_mode=r.value.current_permission_mode||"default"),v.show()}}),le(()=>{i.value&&ne(async()=>{const{default:C}=await import("./modal-B4rHLo2F.js").then(m=>m.m);return{default:C}},__vite__mapDeps([0,1])).then(({default:C})=>{v=new C(i.value),i.value.addEventListener("shown.bs.modal",w),i.value.addEventListener("hidden.bs.modal",$)})}),ae(()=>{i.value&&(i.value.removeEventListener("shown.bs.modal",w),i.value.removeEventListener("hidden.bs.modal",$)),v&&v.dispose()}),(C,m)=>(l(),a("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",qc,[e("div",Rc,[m[15]||(m[15]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Uc,[e("form",{onSubmit:ie(x,["prevent"])},[e("div",Wc,[m[2]||(m[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),K(e("input",{type:"text",class:U(["form-control",{"is-invalid":n.value.name}]),id:"editSessionName","onUpdate:modelValue":m[0]||(m[0]=d=>o.value.name=d),placeholder:"Session Name",required:""},null,2),[[te,o.value.name]]),n.value.name?(l(),a("div",Hc,f(n.value.name),1)):P("",!0)]),e("div",Fc,[m[3]||(m[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:r.value?.working_directory,disabled:"",readonly:""},null,8,Bc),m[4]||(m[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",Vc,[m[5]||(m[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",zc,[e("span",{class:U(["badge",_(r.value?.state)])},f(r.value?.state),3)])]),e("div",Jc,[m[9]||(m[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),K(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":m[1]||(m[1]=d=>o.value.permission_mode=d),disabled:!b.value},[m[6]||(m[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),m[7]||(m[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),m[8]||(m[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),y.value?(l(),a("option",Kc,"âš ï¸ Bypass Permissions (No prompts)")):P("",!0)],8,Gc),[[me,o.value.permission_mode]]),e("div",Yc,[b.value?(l(),a("span",Zc," Controls which tool actions require permission prompts ")):(l(),a("span",Qc," âš ï¸ Session must be active to change permission mode. Start the session first. "))])]),r.value?.system_prompt||r.value?.override_system_prompt?(l(),a("div",Xc,[m[13]||(m[13]=e("label",{class:"form-label"},"System Prompt Configuration",-1)),e("div",ed,[e("div",td,[r.value?.override_system_prompt?(l(),a("div",sd,[...m[10]||(m[10]=[e("span",{class:"badge bg-warning text-dark"},"Override Mode",-1),e("div",{class:"form-text text-warning mt-1"}," Using custom prompt only (no Claude Code preset) ",-1)])])):(l(),a("div",od,[...m[11]||(m[11]=[e("span",{class:"badge bg-info"},"Append Mode",-1),e("div",{class:"form-text mt-1"}," Custom instructions appended to Claude Code preset ",-1)])])),r.value?.system_prompt?(l(),a("div",nd,[m[12]||(m[12]=e("strong",{class:"small"},"Custom Instructions:",-1)),e("div",ld,f(r.value.system_prompt),1)])):P("",!0)])])])):P("",!0),g.value?(l(),a("div",ad,f(g.value),1)):P("",!0)],32)]),e("div",rd,[m[14]||(m[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:x,disabled:p.value},[p.value?(l(),a("span",ud)):P("",!0),H(" "+f(p.value?"Saving...":"Save Changes"),1)],8,id)])])])],512))}},dd=R(cd,[["__scopeId","data-v-c99ca17f"]]),md={class:"modal-dialog modal-dialog-centered"},pd={class:"modal-content"},vd={class:"modal-header"},fd={class:"modal-title",id:"manageSessionModalLabel"},gd={class:"modal-body"},_d={key:0,class:"text-center py-4"},bd={class:"text-muted"},hd={key:1},yd={key:2},$d={class:"text-muted"},wd={key:3},Sd={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},kd={class:"d-grid gap-2"},Cd=["disabled"],xd=["disabled"],jd=["disabled"],Md=["disabled"],Td={class:"modal-footer"},Ed={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Pd={__name:"SessionManageModal",setup(s){const t=ce(),c=J(),r=ee(),o=pe();de();const n=I(null),p=I(!1),g=I(""),i=I(""),v=I(null),b=I(null);let y=null;const _=u(()=>v.value==="reset"?"Reset Session":v.value==="delete"?"Delete Session":"Manage Session");function h(){v.value="reset"}function x(){v.value="delete"}function T(){v.value=null}async function w(){v.value==="reset"?await m():v.value==="delete"&&await d()}async function $(){if(n.value){p.value=!0,g.value="Restarting session...";try{const S=n.value.session_id,j=await G.post(`/api/sessions/${S}/restart`);if(j.success)console.log("Session restarted successfully, reconnecting"),await o.disconnectSession(),c.currentSessionId=null,await c.selectSession(S),y&&y.hide();else{const E=j.error||j.detail||"Failed to restart session";console.error("Failed to restart session:",E),i.value=`Failed to restart session: ${E}`}}catch(S){console.error("Error restarting session:",S);const j=S.data?.detail||S.message||"Unknown error";i.value=`Error restarting session: ${j}`}finally{p.value=!1}}}async function C(){if(n.value)try{y&&y.hide(),console.log("Ending session",n.value.session_id);const S=n.value.session_id;await G.post(`/api/sessions/${S}/terminate`),await o.disconnectSession(),c.currentSessionId===S&&(c.currentSessionId=null),t.push("/")}catch(S){console.error("Error ending session:",S),await o.disconnectSession(),c.currentSessionId===n.value?.session_id&&(c.currentSessionId=null),t.push("/")}}async function m(){if(n.value){p.value=!0,g.value="Resetting session...";try{const S=n.value.session_id,j=await G.post(`/api/sessions/${S}/reset`);if(j.success)console.log("Session reset successfully, reconnecting"),await o.disconnectSession(),c.currentSessionId=null,await c.selectSession(S),y&&y.hide();else{const E=j.error||j.detail||"Failed to reset session";console.error("Failed to reset session:",E),i.value=`Failed to reset session: ${E}`,v.value=null}}catch(S){console.error("Error resetting session:",S);const j=S.data?.detail||S.message||"Unknown error";i.value=`Error resetting session: ${j}`,v.value=null}finally{p.value=!1}}}async function d(){if(n.value){p.value=!0,g.value="Deleting session...";try{const S=n.value.session_id;await c.deleteSession(S),t.currentRoute.value.params.sessionId===S&&t.push("/"),y&&y.hide()}catch(S){console.error("Error deleting session:",S);const j=S.data?.detail||S.message||"Unknown error";i.value=`Error deleting session: ${j}`,v.value=null}finally{p.value=!1}}}function M(){v.value=null,p.value=!1,g.value="",i.value=""}function N(){M(),n.value=null,r.hideModal()}return X(()=>r.currentModal,S=>{if(S?.name==="manage-session"&&y){const j=S.data||{};n.value=j.session,M(),y.show()}}),le(()=>{b.value&&ne(async()=>{const{default:S}=await import("./modal-B4rHLo2F.js").then(j=>j.m);return{default:S}},__vite__mapDeps([0,1])).then(({default:S})=>{y=new S(b.value),b.value.addEventListener("hidden.bs.modal",N)})}),ae(()=>{b.value&&b.value.removeEventListener("hidden.bs.modal",N),y&&y.dispose()}),(S,j)=>(l(),a("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:b},[e("div",md,[e("div",pd,[e("div",vd,[e("h5",fd,f(v.value?_.value:"Manage Session"),1),j[1]||(j[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",gd,[p.value?(l(),a("div",_d,[j[2]||(j[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",bd,f(g.value),1)])):v.value==="reset"?(l(),a("div",hd,[...j[3]||(j[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):v.value==="delete"?(l(),a("div",yd,[j[6]||(j[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1)),e("p",$d,[j[4]||(j[4]=H("This will permanently delete session ",-1)),e("strong",null,f(n.value?.name),1),j[5]||(j[5]=H(".",-1))]),j[7]||(j[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(l(),a("div",wd,[i.value?(l(),a("div",Sd,[j[8]||(j[8]=e("strong",null,"Error:",-1)),H(" "+f(i.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:j[0]||(j[0]=E=>i.value="")})])):P("",!0),j[15]||(j[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",kd,[e("button",{class:"btn btn-outline-primary text-start",onClick:$,disabled:p.value},[...j[9]||(j[9]=[e("strong",null,"ðŸ”„ Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,Cd),e("button",{class:"btn btn-outline-secondary text-start",onClick:C,disabled:p.value},[...j[10]||(j[10]=[e("strong",null,"ðŸšª End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,xd),j[13]||(j[13]=e("hr",{class:"my-2"},null,-1)),j[14]||(j[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"âš ï¸ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:h,disabled:p.value},[...j[11]||(j[11]=[e("strong",null,"ðŸ—‘ï¸ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,jd),e("button",{class:"btn btn-outline-danger text-start",onClick:x,disabled:p.value},[...j[12]||(j[12]=[e("strong",null,"âŒ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,Md)]),j[16]||(j[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),H(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",Td,[v.value&&!p.value?(l(),a(Q,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:T},"Cancel"),e("button",{type:"button",class:U(["btn",v.value==="delete"?"btn-danger":"btn-warning"]),onClick:w},f(v.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):p.value?P("",!0):(l(),a("button",Ed,"Cancel"))])])])],512))}},Id=R(Pd,[["__scopeId","data-v-de7ff18c"]]),Ld={class:"modal-dialog modal-dialog-centered modal-lg"},Dd={class:"modal-content"},Od={class:"modal-body"},Nd={key:0,class:"text-center text-muted py-4"},Ad={key:1},qd={class:"mb-3"},Rd={class:"font-monospace small"},Ud={class:"mb-3"},Wd={class:"font-monospace small"},Hd={class:"mb-3"},Fd={class:"mb-3"},Bd={class:"mb-3"},Vd={key:0},zd={class:"d-flex flex-wrap gap-1"},Jd={key:1,class:"text-muted small"},Gd={key:0,class:"mb-3"},Kd={class:"d-flex flex-wrap gap-1"},Yd={key:1,class:"mb-3"},Qd={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},Zd={class:"mb-3"},Xd={class:"text-muted"},em={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},tm={__name:"SessionInfoModal",setup(s){const t=J(),c=de(),r=ee(),o=I(null),n=I(!1),p=I(null);let g=null;const i=u(()=>{if(!o.value)return null;const _=t.initData.get(o.value);return _||(c.messagesBySession.get(o.value)||[]).find(T=>T.type==="system"&&(T.subtype==="init"||T.metadata?.subtype==="init")&&T.metadata?.init_data)?.metadata?.init_data||null});function v(_){return typeof _=="string"?_:typeof _=="object"&&_.type==="preset"?`Preset: ${_.preset}`:JSON.stringify(_,null,2)}function b(){o.value=null,n.value=!1}function y(){b(),r.hideModal()}return X(()=>r.currentModal,_=>{if(_?.name==="session-info"&&g){const h=_.data||{};o.value=h.sessionId,n.value=!1,g.show()}}),le(()=>{p.value&&ne(async()=>{const{default:_}=await import("./modal-B4rHLo2F.js").then(h=>h.m);return{default:_}},__vite__mapDeps([0,1])).then(({default:_})=>{g=new _(p.value),p.value.addEventListener("hidden.bs.modal",y)})}),ae(()=>{p.value&&p.value.removeEventListener("hidden.bs.modal",y),g&&g.dispose()}),(_,h)=>(l(),a("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:p},[e("div",Ld,[e("div",Dd,[h[9]||(h[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Od,[i.value?(l(),a("div",Ad,[e("div",qd,[h[1]||(h[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Rd,f(o.value),1)]),e("div",Ud,[h[2]||(h[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",Wd,f(i.value.cwd||"Not specified"),1)]),e("div",Hd,[h[3]||(h[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,f(i.value.model||"Default"),1)]),e("div",Fd,[h[4]||(h[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,f(i.value.permissionMode||"default"),1)]),e("div",Bd,[h[5]||(h[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),i.value.tools&&i.value.tools.length>0?(l(),a("div",Vd,[e("div",zd,[(l(!0),a(Q,null,Z(i.value.tools,x=>(l(),a("span",{key:x,class:"badge bg-secondary"},f(x),1))),128))])])):(l(),a("div",Jd,"All tools available"))]),i.value.commands&&i.value.commands.length>0?(l(),a("div",Gd,[h[6]||(h[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",Kd,[(l(!0),a(Q,null,Z(i.value.commands,x=>(l(),a("span",{key:x,class:"badge bg-info"},f(x),1))),128))])])):P("",!0),i.value.systemPrompt?(l(),a("div",Yd,[h[7]||(h[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",Qd,f(v(i.value.systemPrompt)),1)])):P("",!0),e("div",Zd,[e("h6",Xd,[h[8]||(h[8]=H(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:h[0]||(h[0]=x=>n.value=!n.value)},f(n.value?"Hide":"Show"),1)]),n.value?(l(),a("pre",em,f(JSON.stringify(i.value,null,2)),1)):P("",!0)])])):(l(),a("div",Nd," No session configuration data available "))]),h[10]||(h[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},sm=R(tm,[["__scopeId","data-v-809e2099"]]),om={class:"modal-dialog modal-dialog-centered"},nm={class:"modal-content"},lm={class:"modal-body"},am={class:"mb-3"},rm={class:"mb-3"},im={class:"mb-3"},um={class:"form-text d-flex justify-content-between"},cm={key:0,class:"invalid-feedback"},dm={class:"mb-3 form-check"},mm={key:0,class:"form-text text-warning"},pm={class:"mb-3"},vm={key:0,class:"alert alert-danger"},fm={class:"modal-footer"},gm=["disabled"],_m={key:0,class:"spinner-border spinner-border-sm me-2"},bm={__name:"CreateMinionModal",setup(s){const t=ce(),c=se(),r=J(),o=ee(),n=I(null);let p=null;const g=I(null),i=I({name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]}),v=I(""),b=I(""),y=I(!1),_=u(()=>v.value.trim()?v.value.split(",").map(m=>m.trim()).filter(m=>m.length>0):[]),h=u(()=>i.value.initialization_context.length),x=u(()=>h.value>2e3),T=u(()=>h.value>1800&&h.value<=2e3);function w(){i.value={name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]},v.value="",b.value="",y.value=!1}function $(){w(),o.hideModal()}async function C(){if(!i.value.name.trim()){b.value="Minion name is required";return}if(i.value.name.includes(" ")){b.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(x.value){b.value="Initialization context exceeds 2000 character limit";return}if(!g.value){b.value="Legion ID is missing";return}y.value=!0,b.value="";try{const m={name:i.value.name.trim(),role:i.value.role.trim(),initialization_context:i.value.initialization_context.trim(),override_system_prompt:i.value.override_system_prompt,capabilities:_.value},d=await G.post(`/api/legions/${g.value}/minions`,m);d.success&&d.minion_id?(await c.fetchProjects(),await r.fetchSessions(),p&&p.hide(),t.push(`/spy/${g.value}/${d.minion_id}`)):b.value="Failed to create minion"}catch(m){console.error("Failed to create minion:",m),b.value=m.response?.data?.detail||"Failed to create minion"}finally{y.value=!1}}return X(()=>o.currentModal,m=>{if(m?.name==="create-minion"&&p){const d=m.data||{};g.value=d.project?.project_id||null,w(),p.show()}}),le(()=>{n.value&&ne(()=>import("./modal-B4rHLo2F.js").then(m=>m.m),__vite__mapDeps([0,1])).then(m=>{const d=m.default;p=new d(n.value),n.value.addEventListener("hidden.bs.modal",$)})}),ae(()=>{n.value&&n.value.removeEventListener("hidden.bs.modal",$),p&&p.dispose()}),(m,d)=>(l(),a("div",{ref_key:"modalElement",ref:n,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",om,[e("div",nm,[d[15]||(d[15]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",lm,[e("form",{onSubmit:ie(C,["prevent"])},[e("div",am,[d[5]||(d[5]=e("label",{for:"minion-name",class:"form-label"},[H(" Name "),e("span",{class:"text-danger"},"*")],-1)),K(e("input",{id:"minion-name","onUpdate:modelValue":d[0]||(d[0]=M=>i.value.name=M),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[te,i.value.name]]),d[6]||(d[6]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",rm,[d[7]||(d[7]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),K(e("input",{id:"minion-role","onUpdate:modelValue":d[1]||(d[1]=M=>i.value.role=M),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[te,i.value.role]]),d[8]||(d[8]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",im,[d[9]||(d[9]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),K(e("textarea",{id:"minion-context","onUpdate:modelValue":d[2]||(d[2]=M=>i.value.initialization_context=M),class:U(["form-control",{"is-invalid":x.value}]),rows:"4",maxlength:2e3,placeholder:"Instructions and context for the minion..."},null,2),[[te,i.value.initialization_context]]),e("div",um,[e("span",null,f(i.value.override_system_prompt?"This context will replace Claude Code's preset and legion guide":"This context will be appended to legion guide and Claude Code's preset"),1),e("span",{class:U({"text-danger":x.value,"text-warning":T.value})},f(h.value)+" / 2000 chars ",3)]),x.value?(l(),a("div",cm," Initialization context exceeds 2000 character limit (Windows command-line constraint) ")):P("",!0)]),e("div",dm,[K(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":d[3]||(d[3]=M=>i.value.override_system_prompt=M)},null,512),[[fe,i.value.override_system_prompt]]),d[11]||(d[11]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom context only) ",-1)),i.value.override_system_prompt?(l(),a("div",mm,[...d[10]||(d[10]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom context will be used (no legion guide or Claude Code preset).",-1)])])):P("",!0)]),e("div",pm,[d[12]||(d[12]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),K(e("input",{id:"minion-capabilities","onUpdate:modelValue":d[4]||(d[4]=M=>v.value=M),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[te,v.value]]),d[13]||(d[13]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),b.value?(l(),a("div",vm,f(b.value),1)):P("",!0)],32)]),e("div",fm,[d[14]||(d[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!i.value.name.trim()||y.value,onClick:C},[y.value?(l(),a("span",_m)):P("",!0),H(" "+f(y.value?"Creating...":"Create Minion"),1)],8,gm)])])])],512))}},hm=R(bm,[["__scopeId","data-v-d7434e2a"]]),ym={class:"container-fluid vh-100 d-flex flex-column p-0"},$m={class:"d-flex flex-grow-1 overflow-hidden position-relative"},wm={class:"flex-grow-1 d-flex flex-column overflow-hidden"},Sm={__name:"App",setup(s){const t=ee(),c=pe(),r=J(),o=se(),n=ce(),p=u(()=>t.sidebarCollapsed),g=u(()=>t.isMobile);le(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),c.connectUI(),await Promise.all([o.fetchProjects(),r.fetchSessions()]);const b=window.location.hash;if(b.startsWith("#/session/")){const y=b.replace("#/session/","");r.sessions.has(y)&&await r.selectSession(y)}else if(b.startsWith("#/timeline/")){const y=b.replace("#/timeline/","");n.push(`/timeline/${y}`)}window.addEventListener("popstate",i),window.addEventListener("resize",t.handleResize)}),ae(()=>{window.removeEventListener("popstate",i),window.removeEventListener("resize",t.handleResize),c.disconnectUI()});function i(){const b=window.location.hash;if(b.startsWith("#/session/")){const y=b.replace("#/session/","");r.sessions.has(y)&&r.selectSession(y)}}function v(){t.toggleSidebar()}return(b,y)=>{const _=Ae("router-view");return l(),a("div",ym,[Y(ji),e("div",{id:"sidebar-backdrop",class:U({show:!p.value&&g.value}),onClick:v},null,2),e("div",$m,[Y(cu),e("main",wm,[Y(_)])]),Y(ju),Y(zu),Y(vc),Y(Ac),Y(dd),Y(Id),Y(sm),Y(hm)])}}},xe=We(Sm);xe.use(He());xe.use(Si);xe.mount("#app");
