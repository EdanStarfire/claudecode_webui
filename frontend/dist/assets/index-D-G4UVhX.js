const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as n,a as e,o as s,d as _e,r as I,b as c,t as g,n as me,e as z,f as G,u as we,w as ee,g as Pe,h as D,F as Z,i as X,j as de,k as Ue,l as Y,v as ne,m as Q,p as le,q as Te,s as Se,x as ie,y as ce,z as ge,A as qe,B as Fe,C as Be,D as fe,E as he,G as Ve,H as ze}from"./vue-vendor-BChC3Sgv.js";import{m as be,p as Ee}from"./markdown-vendor-CQ3OZdP9.js";import{c as Ge}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))m(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&m(d)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function m(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();const Je={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},Ke={__name:"NoSessionSelected",setup(o){return(t,a)=>(s(),n("div",Je,[...a[0]||(a[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},Ye="modulepreload",Qe=function(o){return"/"+o},Ie={},re=function(t,a,m){let r=Promise.resolve();if(a&&a.length>0){let i=function(v){return Promise.all(v.map(u=>Promise.resolve(u).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),_=d?.nonce||d?.getAttribute("nonce");r=i(a.map(v=>{if(v=Qe(v),v in Ie)return;Ie[v]=!0;const u=v.endsWith(".css"),w=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${w}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":Ye,u||(f.as="script"),f.crossOrigin="",f.href=v,_&&f.setAttribute("nonce",_),document.head.appendChild(f),u)return new Promise(($,j)=>{f.addEventListener("load",$),f.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${v}`)))})}))}function l(d){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=d,window.dispatchEvent(_),!_.defaultPrevented)throw d}return r.then(d=>{for(const _ of d||[])_.status==="rejected"&&l(_.reason);return t().catch(l)})};class xe extends Error{constructor(t,a,m){super(t),this.name="APIError",this.status=a,this.data=m}}async function ye(o,t={}){try{const a=await fetch(o,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!a.ok){let r;try{r=await a.json()}catch{r={detail:a.statusText}}throw new xe(r.detail||`HTTP ${a.status}: ${a.statusText}`,a.status,r)}const m=a.headers.get("content-type");return m&&m.includes("application/json")?await a.json():await a.text()}catch(a){throw a instanceof xe?a:(console.error("API request failed:",a),new xe(`Network error: ${a.message}`,0,null))}}async function Ze(o,t={}){let a=o;if(t.params){const m=new URLSearchParams;for(const[_,i]of Object.entries(t.params))i!=null&&m.append(_,i);const r=m.toString();r&&(a=`${o}?${r}`);const{params:l,...d}=t;return ye(a,{...d,method:"GET"})}return ye(a,{...t,method:"GET"})}async function Xe(o,t,a={}){return ye(o,{...a,method:"POST",body:JSON.stringify(t)})}async function et(o,t,a={}){return ye(o,{...a,method:"PUT",body:JSON.stringify(t)})}async function tt(o,t={}){return ye(o,{...t,method:"DELETE"})}const K={get:Ze,post:Xe,put:et,delete:tt},J=_e("session",()=>{const o=I(new Map),t=I(null),a=I(new Map),m=I(new Map),r=I(new Set),l=I(!1);let d=null;const _=c(()=>o.value.get(t.value)),i=c(()=>Array.from(o.value.values()).sort((M,T)=>M.order-T.order)),v=M=>c(()=>i.value.filter(T=>T.project_id===M)),u=c({get:()=>a.value.get(t.value)||"",set:M=>{t.value&&a.value.set(t.value,M)}});async function w(){try{const M=await K.get("/api/sessions");return o.value.clear(),M.sessions.forEach(T=>{o.value.set(T.session_id,T)}),console.log(`Loaded ${o.value.size} sessions`),M.sessions}catch(M){throw console.error("Failed to fetch sessions:",M),M}}async function f(M,T){try{const E=(await K.post("/api/sessions",{project_id:M,...T})).session_id,k=(await K.get(`/api/sessions/${E}`)).session;return o.value.set(E,k),o.value=new Map(o.value),console.log(`Created session ${E}`),k}catch(H){throw console.error("Failed to create session:",H),H}}async function $(M){if(t.value===M&&!l.value)return;d&&(console.log(`Aborting pending selection to switch to ${M}`),d.abort(),d=null);const T=new AbortController;d=T,l.value=!0;try{if(t.value=M,T.signal.aborted){console.log(`Selection of ${M} aborted early`);return}let H=o.value.get(M);if(!H)try{const k=await K.get(`/api/sessions/${M}`);if(T.signal.aborted){console.log(`Selection of ${M} aborted after fetch`);return}H=k.session,o.value.set(M,H),o.value=new Map(o.value),console.log(`Fetched session ${M} for deeplink`)}catch(k){console.error(`Failed to fetch session ${M}:`,k);return}if(H&&(H.state==="created"||H.state==="terminated"))try{if(await x(M),T.signal.aborted){console.log(`Selection of ${M} aborted after start`);return}console.log(`Auto-started session ${M} (was in ${H.state} state)`);const k=6e4,L=200,O=5e3;let A=0,P=0;for(;A<k;){if(T.signal.aborted){console.log(`Selection of ${M} aborted during state wait`);return}const W=o.value.get(M);if(W&&W.state==="active"){console.log(`Session ${M} is now active after ${A}ms`);break}if(A-P>=O){const F=o.value.get(M)?.state||"unknown";console.log(`Waiting for session ${M} to become active (current: ${F}, ${A/1e3}s elapsed)`),P=A}await new Promise(F=>setTimeout(F,L)),A+=L}const N=o.value.get(M);N&&N.state!=="active"&&console.warn(`Session ${M} did not become active within ${k/1e3}s (state: ${N.state}), continuing anyway`)}catch(k){console.error(`Failed to auto-start session ${M}:`,k)}if(T.signal.aborted){console.log(`Selection of ${M} aborted before message load`);return}if(await(await re(()=>Promise.resolve().then(()=>$t),void 0)).useMessageStore().loadMessages(M),T.signal.aborted){console.log(`Selection of ${M} aborted after message load`);return}await(await re(()=>Promise.resolve().then(()=>Wt),void 0)).useWebSocketStore().connectSession(M),T.signal.aborted||console.log(`Selected session ${M}`)}finally{d===T&&(d=null),l.value=!1}}function j(M,T){const H=o.value.get(M);H?Object.assign(H,T):(o.value.set(M,T),console.log(`Added new session ${M} via WebSocket update`)),o.value=new Map(o.value)}async function y(M){r.value.add(M);try{await K.delete(`/api/sessions/${M}`),o.value.delete(M),a.value.delete(M),m.value.delete(M),o.value=new Map(o.value),t.value===M&&(t.value=null),console.log(`Deleted session ${M}`)}catch(T){throw console.error("Failed to delete session:",T),T}finally{r.value.delete(M)}}async function b(M,T){try{await K.put(`/api/sessions/${M}/name`,{name:T}),j(M,{name:T}),console.log(`Updated session ${M} name to "${T}"`)}catch(H){throw console.error("Failed to update session name:",H),H}}async function S(M,T){try{await K.post(`/api/sessions/${M}/permission-mode`,{mode:T}),j(M,{current_permission_mode:T});const H=m.value.get(M);H&&(H.permissionMode=T,m.value.set(M,H)),console.log(`Set permission mode for session ${M} to ${T}`)}catch(H){throw console.error("Failed to set permission mode:",H),H}}async function x(M){try{await K.post(`/api/sessions/${M}/start`),console.log(`Started session ${M}`)}catch(T){throw console.error("Failed to start session:",T),T}}async function h(M){try{await K.post(`/api/sessions/${M}/pause`),console.log(`Paused session ${M}`)}catch(T){throw console.error("Failed to pause session:",T),T}}async function p(M){try{await K.post(`/api/sessions/${M}/terminate`),console.log(`Terminated session ${M}`)}catch(T){throw console.error("Failed to terminate session:",T),T}}function R(M){return o.value.get(M)}function U(M,T){m.value.set(M,T),T.permissionMode&&j(M,{current_permission_mode:T.permissionMode})}return{sessions:o,currentSessionId:t,inputCache:a,initData:m,deletingSessions:r,currentSession:_,orderedSessions:i,sessionsInProject:v,currentInput:u,fetchSessions:w,createSession:f,selectSession:$,updateSession:j,deleteSession:y,updateSessionName:b,setPermissionMode:S,startSession:x,pauseSession:h,terminateSession:p,getSession:R,storeInitData:U}}),De=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:J},Symbol.toStringTag,{value:"Module"})),se=_e("ui",()=>{const o=I(window.innerWidth<768),t=I(300),a=I(window.innerWidth),m=c(()=>a.value<768),r=I(!0),l=I(null),d=I(null),_=c(()=>l.value?{name:l.value,data:d.value}:null),i=I(!1),v=I("Loading...");function u(){o.value=!o.value}function w(h){o.value=h}function f(h){t.value=Math.max(200,Math.min(h,window.innerWidth*.3))}function $(h){r.value=h}function j(h,p=null){l.value=null,d.value=null,setTimeout(()=>{l.value=h,d.value=p},0)}function y(){l.value=null,d.value=null}function b(h="Loading..."){i.value=!0,v.value=h}function S(){i.value=!1}function x(){const h=a.value;a.value=window.innerWidth,a.value<768&&h>=768?o.value=!0:a.value>=768&&h<768&&(o.value=!1)}return{sidebarCollapsed:o,sidebarWidth:t,isMobile:m,autoScrollEnabled:r,activeModal:l,modalData:d,currentModal:_,isLoading:i,loadingMessage:v,toggleSidebar:u,setSidebarCollapsed:w,setSidebarWidth:f,setAutoScroll:$,showModal:j,hideModal:y,showLoading:b,hideLoading:S,handleResize:x}}),ae=_e("project",()=>{const o=I(new Map),t=I(null),a=c(()=>o.value.get(t.value)),m=c(()=>Array.from(o.value.values()).sort((y,b)=>y.order-b.order)),r=y=>o.value.get(y)?.is_multi_agent||!1;async function l(){try{const y=await K.get("/api/projects");return o.value.clear(),y.projects.forEach(b=>{o.value.set(b.project_id,b)}),console.log(`Loaded ${o.value.size} projects`),y.projects}catch(y){throw console.error("Failed to fetch projects:",y),y}}async function d(y,b,S=!1){try{const h=(await K.post("/api/projects",{name:y,working_directory:b,is_multi_agent:S})).project;return o.value.set(h.project_id,h),o.value=new Map(o.value),console.log(`Created project ${h.project_id}`),h}catch(x){throw console.error("Failed to create project:",x),x}}async function _(y,b){try{await K.put(`/api/projects/${y}`,b),i(y,b),console.log(`Updated project ${y}`,b)}catch(S){throw console.error("Failed to update project:",S),S}}function i(y,b){const S=o.value.get(y);S&&(Object.assign(S,b),o.value=new Map(o.value))}async function v(y){try{await K.delete(`/api/projects/${y}`),o.value.delete(y),o.value=new Map(o.value),t.value===y&&(t.value=null),console.log(`Deleted project ${y}`)}catch(b){throw console.error("Failed to delete project:",b),b}}async function u(y){try{const b=await K.put(`/api/projects/${y}/toggle-expansion`),S=o.value.get(y);return S&&(S.is_expanded=b.is_expanded,o.value=new Map(o.value)),b.is_expanded}catch(b){throw console.error("Failed to toggle expansion:",b),b}}async function w(y){try{await K.put("/api/projects/reorder",{project_ids:y}),y.forEach((b,S)=>{const x=o.value.get(b);x&&(x.order=S)}),o.value=new Map(o.value),console.log("Reordered projects",y)}catch(b){throw console.error("Failed to reorder projects:",b),b}}async function f(y,b){try{await K.put(`/api/projects/${y}/sessions/reorder`,{session_ids:b});const S=o.value.get(y);S&&(S.session_ids=b,o.value=new Map(o.value)),console.log(`Reordered sessions in project ${y}`,b)}catch(S){throw console.error("Failed to reorder sessions:",S),S}}function $(y){return o.value.get(y)}function j(y){if(!y)return"";const b=y.split(/[/\\]/).filter(S=>S);return b.length===0?"/":b.length===1?`/${b[0]}`:b.length===2?`/${b.join("/")}`:`.../${b.slice(-2).join("/")}`}return{projects:o,currentProjectId:t,currentProject:a,orderedProjects:m,isMultiAgent:r,fetchProjects:l,createProject:d,updateProject:_,updateProjectLocal:i,deleteProject:v,toggleExpansion:u,reorderProjects:w,reorderSessionsInProject:f,getProject:$,formatPath:j}}),B=(o,t)=>{const a=o.__vccOpts||o;for(const[m,r]of t)a[m]=r;return a},st={class:"session-header border-bottom p-3"},ot={class:"project-name"},nt=["title"],lt={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(o){const t=o,a=J(),m=ae(),r=c(()=>a.sessions.get(t.sessionId)),l=c(()=>r.value?.name||t.sessionId),d=c(()=>{for(const i of m.projects.values())if(i.session_ids?.includes(t.sessionId))return i;return null}),_=c(()=>d.value?.name||"Unknown Project");return(i,v)=>(s(),n("div",st,[e("div",null,[e("div",ot,g(_.value),1),e("div",{class:"session-name",title:o.sessionId},g(l.value),9,nt)])]))}},at=B(lt,[["__scopeId","data-v-89e9c269"]]),rt={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},it=["title"],ct={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},dt={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(o){const t=o,a=J(),m=c(()=>a.sessions.get(t.sessionId)),r=c(()=>m.value?m.value.state==="paused"&&m.value.is_processing?"pending-prompt":m.value.is_processing?"processing":m.value.state:"unknown"),l=c(()=>{const i=r.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[i]||"#d3d3d3"}),d=c(()=>{const i=r.value;return i==="starting"||i==="processing"||i==="pending-prompt"}),_=c(()=>{if(!m.value)return"No session selected";const i=r.value,v=i.charAt(0).toUpperCase()+i.slice(1).replace("-"," "),u=m.value.name||"Unnamed Session",w=m.value.is_minion&&m.value.role?` (${m.value.role})`:"";return`${u}${w}: ${v}`});return(i,v)=>(s(),n("div",rt,[m.value?(s(),n("div",{key:0,class:z(["progress-bar",{"progress-bar-striped progress-bar-animated":d.value}]),style:me({width:"100%",backgroundColor:l.value}),title:_.value},null,14,it)):(s(),n("div",ct))]))}},ut=B(dt,[["__scopeId","data-v-e8795bb7"]]),mt={class:"session-status-bar border-top p-2 bg-light"},pt={class:"d-flex justify-content-between align-items-center gap-2"},vt={class:"d-flex gap-2"},ft=["disabled"],gt={class:"mode-label"},_t=["disabled"],ht=["disabled"],bt={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(o){const t=o,a=J(),m=se(),r=c(()=>a.sessions.get(t.sessionId)),l=c(()=>r.value?.current_permission_mode||"default"),d={default:"ðŸ”’",acceptEdits:"âœï¸",plan:"ðŸ“‹",bypassPermissions:"â˜¢ï¸"},_=c(()=>d[l.value]||"ðŸ”’"),i=c(()=>l.value),v=["default","acceptEdits","plan"],u=async()=>{if(!r.value)return;if(l.value==="bypassPermissions"){try{await a.setPermissionMode(t.sessionId,"default")}catch(S){console.error("Failed to cycle permission mode:",S)}return}const y=(v.indexOf(l.value)+1)%v.length,b=v[y];try{await a.setPermissionMode(t.sessionId,b)}catch(S){console.error("Failed to cycle permission mode:",S)}},w=()=>{m.showModal("session-info",{sessionId:t.sessionId})},f=()=>{m.showModal("manage-session",{session:r.value})},$=()=>{m.setAutoScroll(!m.autoScrollEnabled)};return(j,y)=>(s(),n("div",mt,[e("div",pt,[e("div",vt,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:u,disabled:!r.value},[G(g(_.value)+" ",1),e("span",gt,g(i.value),1)],8,ft),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:w,disabled:!r.value},[...y[0]||(y[0]=[G(" â„¹ï¸ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,_t),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:f,disabled:!r.value},[...y[1]||(y[1]=[G(" âš™ï¸ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,ht)]),e("div",null,[e("button",{class:z(["btn btn-sm",we(m).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:$}," â¬‡ï¸ "+g(we(m).autoScrollEnabled?"ON":"OFF"),3)])])]))}},yt=B(bt,[["__scopeId","data-v-fdcd3535"]]),ue=_e("message",()=>{const o=I(new Map),t=I(new Map),a=I(new Map),m=I(new Map),r=I(new Map),l=I(new Map),d=I(new Map),_=c(()=>{const k=J();return o.value.get(k.currentSessionId)||[]}),i=c(()=>{const k=J();return t.value.get(k.currentSessionId)||[]});async function v(k,L=null,O=0){try{const A=L||1e4,P=await K.get(`/api/sessions/${k}/messages?limit=${A}&offset=${O}`),N=P.messages||[],W=P.total_count||N.length,F=P.has_more||!1;if(console.log(`Loaded ${N.length} of ${W} messages for session ${k}`),o.value.set(k,N),N.length>0){const q=N[N.length-1];q.timestamp&&(d.value.set(k,q.timestamp),console.log(`Tracked last received timestamp for session ${k}: ${q.timestamp}`))}const V=new Set;N.forEach(q=>{q.type==="assistant"&&q.metadata?.tool_uses&&q.metadata.tool_uses.forEach(te=>{V.add(te.id)}),q.type==="user"&&q.metadata?.tool_results&&q.metadata.tool_results.forEach(te=>{V.delete(te.tool_use_id);const $e=l.value.get(k);$e&&$e.delete(te.tool_use_id)}),q.type==="system"&&q.metadata?.subtype==="client_launched"&&(V.forEach(te=>{p(k,te,"Session was restarted")}),V.clear()),q.type==="system"&&q.metadata?.subtype==="interrupt"&&(V.forEach(te=>{p(k,te,"Session was interrupted")}),V.clear()),q.metadata?.has_tool_uses&&q.metadata.tool_uses&&q.metadata.tool_uses.forEach(te=>{j(k,te)}),q.metadata?.has_tool_results&&q.metadata.tool_results&&q.metadata.tool_results.forEach(te=>{S(k,te)}),(q.type==="permission_request"||q.metadata?.has_permission_requests)&&y(k,q),q.type==="system"&&(q.subtype==="init"||q.metadata?.subtype==="init")&&q.metadata?.init_data&&J().storeInitData(k,q.metadata.init_data)});const ve=J().sessions.get(k);return ve&&!["active","paused","starting"].includes(ve.state)&&(V.forEach(q=>{p(k,q,"Session was terminated")}),V.clear()),r.value.set(k,V),o.value=new Map(o.value),F&&console.warn(`Warning: Only loaded ${N.length} of ${W} messages. Some messages may be missing.`),{messages:N,totalCount:W,hasMore:F}}catch(A){throw console.error("Failed to load messages:",A),A}}function u(k,L){const O=r.value.get(k)||new Set;L.type==="assistant"&&L.metadata?.tool_uses&&L.metadata.tool_uses.forEach(A=>{O.add(A.id)}),L.type==="user"&&L.metadata?.tool_results&&L.metadata.tool_results.forEach(A=>{O.delete(A.tool_use_id);const P=l.value.get(k);P&&P.delete(A.tool_use_id)}),L.type==="system"&&L.metadata?.subtype==="client_launched"&&(O.forEach(A=>{p(k,A,"Session was restarted")}),O.clear()),L.type==="system"&&L.metadata?.subtype==="interrupt"&&(O.forEach(A=>{p(k,A,"Session was interrupted")}),O.clear()),r.value.set(k,O)}function w(k,L){o.value.has(k)||o.value.set(k,[]),o.value.get(k).push(L),L.timestamp&&d.value.set(k,L.timestamp),u(k,L),o.value=new Map(o.value)}function f(k,L){t.value.has(k)||t.value.set(k,[]),t.value.get(k).push(L),t.value=new Map(t.value)}function $(k,L,O){const A=t.value.get(k);if(A){const P=A.find(N=>N.id===L);P&&(Object.assign(P,O),t.value=new Map(t.value))}}function j(k,L){const O=h(L.name,L.input);a.value.set(O,L.id);const A={id:L.id,name:L.name,input:L.input,signature:O,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return f(k,A),console.log(`Created tool call ${A.id} for ${A.name}`),A}function y(k,L){console.log("handlePermissionRequest received:",L);const O=L.metadata?.tool_name||L.tool_name,A=L.metadata?.input_params||L.input_params,P=L.metadata?.request_id||L.request_id,N=L.metadata?.suggestions||L.suggestions||[];console.log("Extracted data:",{toolName:O,inputParams:A,requestId:P,suggestions:N});const W=h(O,A),F=a.value.get(W);F?(m.value.set(P,F),$(k,F,{status:"permission_required",permissionRequestId:P,suggestions:N}),console.log(`Permission required for tool ${F}`,{suggestions:N})):console.warn("No tool use ID found for permission request signature:",W,{toolName:O,inputParams:A,availableSignatures:Array.from(a.value.keys())})}function b(k,L){const O=m.value.get(L.request_id);if(O){const A={permissionDecision:L.decision,appliedUpdates:L.applied_updates||[]};L.decision==="allow"?A.status="executing":(A.status="completed",A.result={error:!0,message:L.reasoning||"Permission denied"},A.isExpanded=!1),$(k,O,A),console.log(`Permission ${L.decision} for tool ${O}`)}}function S(k,L){const O=L.tool_use_id;$(k,O,{status:L.is_error?"error":"completed",result:{error:L.is_error,content:L.content},isExpanded:!1}),console.log(`Tool ${O} ${L.is_error?"failed":"completed"}`)}function x(k,L){const O=t.value.get(k);if(O){const A=O.find(P=>P.id===L);A&&(A.isExpanded=!A.isExpanded,t.value=new Map(t.value))}}function h(k,L){if(!k)return"unknown:{}";if(!L||typeof L!="object")return`${k}:{}`;const O=JSON.stringify(L,Object.keys(L).sort());return`${k}:${O}`}function p(k,L,O){const A=l.value.get(k)||new Map;A.set(L,{reason:"denied",message:O}),l.value.set(k,A);const P=t.value.get(k);if(P){const N=P.find(W=>W.id===L);N&&N.isExpanded&&(N.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${L} as orphaned: ${O}`)}function R(k,L){return l.value.get(k)?.has(L)||!1}function U(k,L){return l.value.get(k)?.get(L)}function M(k,L){const O=r.value.get(k);O&&O.size>0&&(O.forEach(A=>p(k,A,L)),O.clear())}function T(k){o.value.delete(k),t.value.delete(k),o.value=new Map(o.value),t.value=new Map(t.value)}function H(k){return d.value.get(k)}async function E(k){const L=d.value.get(k);if(!L)return console.log(`No sync needed for session ${k} (no previous messages)`),{syncedCount:0,hasMore:!1};try{console.log(`Syncing messages for session ${k} since ${L}`);const O=await K.get(`/api/sessions/${k}/messages?limit=1000&offset=0`),A=O.messages||[],P=O.has_more||!1,N=new Date(L).getTime(),W=A.filter(q=>q.timestamp?new Date(q.timestamp).getTime()>N:!1);if(W.length===0)return console.log(`No missed messages for session ${k}`),{syncedCount:0,hasMore:!1};console.log(`Synced ${W.length} missed messages for session ${k}`);const F=o.value.get(k)||[],V=new Set(F.map(q=>q.id).filter(Boolean)),oe=W.filter(q=>!q.id||!V.has(q.id));console.log(`After deduplication: ${oe.length} unique new messages`);const ve=[...F,...oe].sort((q,te)=>{const $e=new Date(q.timestamp||0).getTime(),He=new Date(te.timestamp||0).getTime();return $e-He});if(o.value.set(k,ve),oe.forEach(q=>{u(k,q),q.metadata?.has_tool_uses&&q.metadata.tool_uses&&q.metadata.tool_uses.forEach(te=>{j(k,te)}),q.metadata?.has_tool_results&&q.metadata.tool_results&&q.metadata.tool_results.forEach(te=>{S(k,te)}),(q.type==="permission_request"||q.metadata?.has_permission_requests)&&y(k,q),q.type==="system"&&(q.subtype==="init"||q.metadata?.subtype==="init")&&q.metadata?.init_data&&J().storeInitData(k,q.metadata.init_data)}),ve.length>0){const q=ve[ve.length-1];q.timestamp&&d.value.set(k,q.timestamp)}return o.value=new Map(o.value),{syncedCount:oe.length,hasMore:P}}catch(O){return console.error(`Failed to sync messages for session ${k}:`,O),{syncedCount:0,hasMore:!1,error:O.message}}}const C=J();return ee(()=>Array.from(C.sessions.values()).map(L=>({id:L.session_id,state:L.state})),(k,L)=>{L&&k.forEach((O,A)=>{const P=L[A];if(!P||P.id!==O.id)return;const N=["active","paused","starting"].includes(P.state),W=!["active","paused","starting"].includes(O.state);N&&W&&M(O.id,"Session was terminated")})},{deep:!0}),{messagesBySession:o,toolCallsBySession:t,activeToolUses:Pe(r),orphanedToolUses:Pe(l),currentMessages:_,currentToolCalls:i,loadMessages:v,addMessage:w,addToolCall:f,updateToolCall:$,handleToolUse:j,handlePermissionRequest:y,handlePermissionResponse:b,handleToolResult:S,toggleToolExpansion:x,clearMessages:T,markToolUseOrphaned:p,isToolUseOrphaned:R,getOrphanedInfo:U,clearOrphanedToolUses:M,getLastReceivedTimestamp:H,syncMessages:E}}),$t=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:ue},Symbol.toStringTag,{value:"Module"}));function wt(o){if(!o)return new Date;if(typeof o=="string"){const t=new Date(o);return isNaN(t.getTime())?new Date:t}return typeof o=="number"?o<1e10?new Date(o*1e3):new Date(o):new Date}function ke(o){return wt(o).toLocaleTimeString()}const St={class:"message-row message-row-user"},kt=["title"],Ct={class:"message-content-column"},xt=["innerHTML"],Mt={key:0,class:"tool-results mt-2"},jt={class:"tool-results-header text-muted small mb-2"},Tt={class:"d-flex align-items-start gap-2"},Et={class:"flex-grow-1"},Lt={class:"text-muted"},Pt={key:0,class:"text-danger small"},It={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(o){const t=o;be.setOptions({breaks:!0,gfm:!0});const a=c(()=>ke(t.message.timestamp)),m=c(()=>`user
${a.value}`),r=c(()=>{const i=t.message.content||"";let v=be.parse(i);return v=v.replace(/\n</g,"<"),v=v.replace(/\n+$/,""),Ee.sanitize(v)}),l=c(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),d=c(()=>t.message.metadata?.tool_results||[]);function _(i,v){return i?i.length<=v?i:i.substring(0,v)+"...":""}return(i,v)=>(s(),n("div",St,[e("div",{class:"message-speaker",title:m.value},[...v[0]||(v[0]=[e("span",{class:"speaker-label"},"user",-1)])],8,kt),e("div",Ct,[e("div",{class:"message-text",innerHTML:r.value},null,8,xt),l.value?(s(),n("div",Mt,[e("div",jt,[v[1]||(v[1]=e("i",{class:"bi bi-tools"},null,-1)),G(" Tool Results ("+g(d.value.length)+") ",1)]),(s(!0),n(Z,null,X(d.value,(u,w)=>(s(),n("div",{key:w,class:z(["tool-result-summary p-2 mb-2 rounded",u.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",Tt,[e("span",null,g(u.is_error?"âŒ":"âœ…"),1),e("div",Et,[e("small",Lt,"Tool: "+g(u.tool_use_id),1),u.is_error?(s(),n("div",Pt,g(_(u.content,200)),1)):D("",!0)])])],2))),128))])):D("",!0)])]))}},Dt=B(It,[["__scopeId","data-v-09875214"]]),Ot={class:"thinking-block"},Nt={class:"text-muted ms-auto"},At={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},Rt=["innerHTML"],Ut={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(o){const t=o,a=I(!1),m=c(()=>t.thinking?.length||0),r=c(()=>{const d=t.thinking||"",_=be.parse(d);return Ee.sanitize(_)});function l(){a.value=!a.value}return(d,_)=>(s(),n("div",Ot,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:l},[e("i",{class:z(["bi",a.value?"bi-chevron-down":"bi-chevron-right"])},null,2),_[0]||(_[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),G(" Thinking ")],-1)),e("small",Nt,g(m.value)+" characters",1)]),a.value?(s(),n("div",At,[e("div",{class:"thinking-text",innerHTML:r.value},null,8,Rt)])):D("",!0)]))}},qt=B(Ut,[["__scopeId","data-v-619a8344"]]),pe=_e("websocket",()=>{const o=I(null),t=I(!1),a=I(0),m=10,r=I(null),l=I(!1),d=I(0),_=5,i=I(null);let v=null;const u=I(0),w=I(null),f=I(new Map),$=I(null),j=I(!1),y=I(0),b=5,S=I(null),x=c(()=>t.value&&(l.value||!i.value)?"connected":t.value?"partial":"disconnected");function h(P){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${P}`}function p(){if(o.value)return;const P=h("/ws/ui");console.log(`Connecting to UI WebSocket: ${P}`),o.value=new WebSocket(P),o.value.onopen=()=>{t.value=!0,a.value=0,console.log("UI WebSocket connected")},o.value.onmessage=N=>{const W=JSON.parse(N.data);C(W)},o.value.onclose=()=>{if(t.value=!1,o.value=null,console.log("UI WebSocket closed"),a.value<m){a.value++;const N=Math.min(2e3*a.value,3e4);console.log(`Reconnecting UI WebSocket in ${N}ms (attempt ${a.value})`),setTimeout(p,N)}},o.value.onerror=N=>{console.error("UI WebSocket error:",N)}}function R(){o.value&&(o.value.close(),o.value=null,t.value=!1)}async function U(P){u.value++;const N=u.value;if(console.log(`[Gen ${N}] Starting connection to session ${P}`),v&&(clearTimeout(v),v=null),await M(),u.value!==N){console.log(`[Gen ${N}] Connection cancelled (current generation: ${u.value})`);return}i.value=P,w.value=N;const W=h(`/ws/session/${P}`);console.log(`[Gen ${N}] Connecting to Session WebSocket: ${W}`),r.value=new WebSocket(W),r.value.onopen=async()=>{if(w.value!==N){console.log(`[Gen ${N}] Ignoring onopen (stale connection, current: ${w.value})`),r.value.close();return}l.value=!0,d.value=0,console.log(`[Gen ${N}] Session WebSocket connected for ${P}`);const F=f.value.get(P);if(f.value.set(P,!0),F){console.log(`[Gen ${N}] Reconnection detected, syncing missed messages...`);try{const oe=await ue().syncMessages(P);oe.syncedCount>0?console.log(`[Gen ${N}] âœ… Synced ${oe.syncedCount} missed messages`):oe.error?console.warn(`[Gen ${N}] âš ï¸ Message sync failed: ${oe.error}`):console.log(`[Gen ${N}] No missed messages to sync`),oe.hasMore&&console.warn(`[Gen ${N}] âš ï¸ More than 1000 missed messages, showing recent 1000 only`)}catch(V){console.error(`[Gen ${N}] Error during message sync:`,V)}}else console.log(`[Gen ${N}] Initial connection, no sync needed`)},r.value.onmessage=F=>{if(w.value!==N){console.log(`[Gen ${N}] Ignoring message (stale connection, current: ${w.value})`);return}const V=JSON.parse(F.data);k(V,P)},r.value.onclose=()=>{l.value=!1,r.value=null,console.log(`[Gen ${N}] Session WebSocket closed for ${P}`);const F=J();if(F.currentSessionId===P&&w.value===N&&d.value<_){d.value++;const V=Math.min(2e3*d.value,3e4);console.log(`[Gen ${N}] Reconnecting Session WebSocket in ${V}ms (attempt ${d.value})`),v=setTimeout(()=>{w.value===N&&F.currentSessionId===P?(v=null,U(P)):console.log(`[Gen ${N}] Skipping reconnect (generation or session changed)`)},V)}},r.value.onerror=F=>{console.error(`[Gen ${N}] Session WebSocket error:`,F)}}function M(){return new Promise(P=>{if(v&&(clearTimeout(v),v=null,console.log("Cancelled pending session reconnect timer")),r.value){const N=i.value,W=()=>{r.value=null,l.value=!1,i.value=null,w.value=null,d.value=0,N&&f.value.delete(N),P()};if(r.value.readyState===WebSocket.CLOSED)W();else{const F=setTimeout(()=>{console.warn("Session WebSocket close timeout - forcing cleanup"),W()},2e3);r.value.addEventListener("close",()=>{clearTimeout(F),W()},{once:!0}),r.value.close()}}else i.value=null,w.value=null,P()})}function T(P){r.value&&l.value?(r.value.send(JSON.stringify({type:"send_message",content:P})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function H(P,N,W=!1,F=null){if(r.value&&l.value){const V={type:"permission_response",request_id:P,decision:N,apply_suggestions:W,timestamp:new Date().toISOString()};F&&(V.clarification_message=F),r.value.send(JSON.stringify(V)),console.log(`Sent permission ${N} for request ${P}`,{applySuggestions:W,clarification:F})}}function E(){r.value&&l.value&&(r.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function C(P){const N=J(),W=ae();switch(P.type){case"sessions_list":P.sessions&&Array.isArray(P.sessions)&&P.sessions.forEach(F=>{N.updateSession(F.session_id,F)});break;case"state_change":P.data&&P.data.session_id&&P.data.session&&N.updateSession(P.data.session_id,P.data.session);break;case"project_updated":if(P.data&&P.data.project){const F=P.data.project;W.updateProjectLocal(F.project_id,F)}break;case"project_deleted":P.data&&P.data.project_id&&W.projects.delete(P.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":o.value?.readyState===WebSocket.OPEN&&o.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",P.type)}}function k(P,N){const W=J();if(W.currentSessionId!==N){console.warn(`Ignoring message for session ${N} (current: ${W.currentSessionId})`);return}const F=ue();switch(P.type){case"message":const V=P.data;if(!V||!V.type){console.warn("Received message event with invalid data:",P);break}if(V.type==="permission_request"){F.handlePermissionRequest(N,V);break}if(V.type==="permission_response"){F.handlePermissionResponse(N,V);break}V.metadata?.has_tool_uses&&V.metadata.tool_uses.forEach(oe=>{F.handleToolUse(N,oe)}),V.metadata?.has_tool_results&&V.metadata.tool_results.forEach(oe=>{F.handleToolResult(N,oe)}),V.type==="system"&&(V.subtype==="init"||V.metadata?.subtype==="init")&&V.metadata?.init_data&&W.storeInitData(N,V.metadata.init_data),F.addMessage(N,V);break;case"permission_request":F.handlePermissionRequest(N,P);break;case"permission_response":F.handlePermissionResponse(N,P);break;case"tool_result":F.handleToolResult(N,P);break;case"state_change":W.updateSession(N,P.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${N}`);break;case"ping":r.value?.readyState===WebSocket.OPEN&&r.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function L(P){O(),S.value=P;const N=h(`/ws/legion/${P}`);console.log(`Connecting to Legion WebSocket: ${N}`),$.value=new WebSocket(N),$.value.onopen=()=>{j.value=!0,y.value=0,console.log(`Legion WebSocket connected for ${P}`)},$.value.onmessage=W=>{const F=JSON.parse(W.data);A(F,P)},$.value.onclose=()=>{if(j.value=!1,$.value=null,console.log(`Legion WebSocket closed for ${P}`),S.value===P&&y.value<b){y.value++;const W=Math.min(2e3*y.value,3e4);setTimeout(()=>L(P),W)}},$.value.onerror=W=>{console.error("Legion WebSocket error:",W)}}function O(){$.value&&($.value.close(),$.value=null,j.value=!1,S.value=null)}function A(P,N){re(async()=>{const{useLegionStore:W}=await Promise.resolve().then(()=>Ka);return{useLegionStore:W}},void 0).then(({useLegionStore:W})=>{const F=W();switch(P.type){case"comm":P.comm&&(F.addComm(N,P.comm),console.log("Legion WebSocket: Received new comm",P.comm));break;case"minion_created":P.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",P.data),re(async()=>{const{useSessionStore:V}=await Promise.resolve().then(()=>De);return{useSessionStore:V}},void 0).then(({useSessionStore:V})=>{V().loadSessions()}));break;case"minion_updated":P.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",P.data),re(async()=>{const{useSessionStore:V}=await Promise.resolve().then(()=>De);return{useSessionStore:V}},void 0).then(({useSessionStore:V})=>{V().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${N}`);break;case"ping":$.value?.readyState===WebSocket.OPEN&&$.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",P.type)}})}return{uiConnected:t,sessionConnected:l,legionConnected:j,overallStatus:x,connectUI:p,disconnectUI:R,connectSession:U,disconnectSession:M,sendMessage:T,sendPermissionResponse:H,interruptSession:E,connectLegion:L,disconnectLegion:O}}),Wt=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:pe},Symbol.toStringTag,{value:"Module"})),Ht={class:"base-tool-handler"},Ft={class:"tool-section"},Bt={class:"tool-parameters"},Vt={class:"tool-code"},zt={key:0,class:"tool-section"},Gt={class:"tool-section-label"},Jt={class:"tool-code"},Kt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),m=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),r=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),l=c(()=>{if(!m.value)return"";const d=t.toolCall.result;return d.content!==void 0?typeof d.content=="string"?d.content:JSON.stringify(d.content,null,2):d.message?d.message:JSON.stringify(d,null,2)});return(d,_)=>(s(),n("div",Ht,[e("div",Ft,[_[0]||(_[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Bt,[e("pre",Vt,g(a.value),1)])]),m.value?(s(),n("div",zt,[e("div",Gt,g(r.value?"Error:":"Result:"),1),e("div",{class:z(["tool-result",{"tool-result-error":r.value}])},[e("pre",Jt,g(l.value),1)],2)])):D("",!0)]))}},Yt=B(Kt,[["__scopeId","data-v-1e69f57d"]]),Qt={class:"read-tool-handler"},Zt={class:"tool-section"},Xt={class:"read-file-info"},es={class:"file-path"},ts={key:0,class:"read-range"},ss={key:0,class:"tool-section"},os={key:0,class:"tool-result tool-result-error"},ns={class:"tool-code"},ls={key:1,class:"file-content-preview"},as={class:"content-header"},rs={class:"line-count-badge"},is={key:0,class:"preview-note"},cs={class:"tool-code content-display"},ds={key:0,class:"more-indicator"},Me=100,us={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.input?.file_path||"Unknown"),m=c(()=>{const $=t.toolCall.input?.offset,j=t.toolCall.input?.limit;return $!==void 0||j!==void 0}),r=c(()=>{const $=t.toolCall.input?.offset;return $!==void 0?$+1:1}),l=c(()=>{const $=t.toolCall.input?.offset||0,j=t.toolCall.input?.limit;return j!==void 0?$+j:"âˆž"}),d=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),_=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),i=c(()=>{if(!d.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)}),v=c(()=>_.value||!i.value?[]:i.value.split(`
`)),u=c(()=>v.value.length),w=c(()=>u.value>Me),f=c(()=>_.value?"":v.value.slice(0,Me).join(`
`));return($,j)=>(s(),n("div",Qt,[e("div",Zt,[e("div",Xt,[j[0]||(j[0]=e("span",{class:"file-icon"},"ðŸ“„",-1)),j[1]||(j[1]=e("strong",null,"Reading:",-1)),e("code",es,g(a.value),1),m.value?(s(),n("span",ts,"Lines "+g(r.value)+"-"+g(l.value),1)):D("",!0)])]),d.value?(s(),n("div",ss,[_.value?(s(),n("div",os,[e("pre",ns,g(i.value),1)])):(s(),n("div",ls,[e("div",as,[j[2]||(j[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",rs,g(u.value)+" lines",1),w.value?(s(),n("span",is,"(showing first "+g(Me)+")")):D("",!0)]),e("pre",cs,g(f.value),1),w.value?(s(),n("div",ds,"...")):D("",!0)]))])):D("",!0)]))}},ms=B(us,[["__scopeId","data-v-1f2b0569"]]),ps={class:"write-tool-handler"},vs={class:"tool-section"},fs={class:"write-file-info mb-2"},gs={class:"file-path"},_s={class:"write-content-preview"},hs={class:"content-header"},bs={class:"line-count-badge"},ys={key:0,class:"preview-note"},$s={class:"tool-code content-display"},ws={key:0,class:"more-indicator"},Ss={key:0,class:"tool-section"},ks={key:0,class:"tool-result tool-result-error"},Cs={class:"tool-code"},xs={key:1,class:"tool-result tool-result-success"},Ms={class:"success-message"},je=100,js={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.input?.file_path||"Unknown"),m=c(()=>t.toolCall.input?.content||""),r=c(()=>m.value.split(`
`)),l=c(()=>r.value.length),d=c(()=>l.value>je),_=c(()=>r.value.slice(0,je).join(`
`)),i=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),u=c(()=>{if(!i.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)});return(w,f)=>(s(),n("div",ps,[e("div",vs,[e("div",fs,[f[0]||(f[0]=e("span",{class:"file-icon"},"ðŸ“",-1)),f[1]||(f[1]=e("strong",null,"Writing:",-1)),e("code",gs,g(a.value),1)]),e("div",_s,[e("div",hs,[f[2]||(f[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",bs,g(l.value)+" lines",1),d.value?(s(),n("span",ys,"(showing first "+g(je)+")")):D("",!0)]),e("pre",$s,g(_.value),1),d.value?(s(),n("div",ws,"...")):D("",!0)])]),i.value?(s(),n("div",Ss,[v.value?(s(),n("div",ks,[f[3]||(f[3]=e("strong",null,"Error:",-1)),e("pre",Cs,g(u.value),1)])):(s(),n("div",xs,[e("div",Ms,[f[4]||(f[4]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"File created successfully ("+g(l.value)+" lines written)",1)])]))])):D("",!0)]))}},Ts=B(js,[["__scopeId","data-v-ddc24a0f"]]),Es={class:"bash-tool-handler"},Ls={class:"tool-section"},Ps={class:"bash-header"},Is={class:"bash-header-content"},Ds={key:0,class:"bash-description"},Os={key:1,class:"bash-flags"},Ns={class:"bash-command-section"},As={class:"bash-command-content"},Rs={key:0,class:"tool-section"},Us={key:0,class:"bash-output"},qs={key:1,class:"bash-output-empty"},Ws={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.input?.command||""),m=c(()=>t.toolCall.input?.description||""),r=c(()=>t.toolCall.input?.timeout),l=c(()=>t.toolCall.input?.run_in_background||!1),d=c(()=>r.value||l.value),_=c(()=>{const f=[];return r.value&&f.push(`timeout: ${r.value}ms`),l.value&&f.push("background"),f.join(", ")}),i=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),u=c(()=>v.value?"tool-result-error":"tool-result-success"),w=c(()=>{if(!i.value)return"";const f=t.toolCall.result;return f.content!==void 0?typeof f.content=="string"?f.content:JSON.stringify(f.content,null,2):f.message?f.message:JSON.stringify(f,null,2)});return(f,$)=>(s(),n("div",Es,[e("div",Ls,[e("div",Ps,[$[1]||($[1]=e("span",{class:"bash-icon"},"ðŸ’»",-1)),e("div",Is,[m.value?(s(),n("div",Ds,[$[0]||($[0]=e("strong",null,"Description:",-1)),G(" "+g(m.value),1)])):D("",!0),d.value?(s(),n("div",Os,g(_.value),1)):D("",!0)])]),e("div",Ns,[$[2]||($[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",As,g(a.value),1)])]),i.value?(s(),n("div",Rs,[e("div",{class:z(["tool-result",u.value])},[$[3]||($[3]=e("strong",null,"Output:",-1)),w.value?(s(),n("pre",Us,g(w.value),1)):(s(),n("div",qs,"No output"))],2)])):D("",!0)]))}},Hs=B(Ws,[["__scopeId","data-v-ab50fe73"]]),Fs={class:"todo-tool-handler"},Bs={class:"tool-section"},Vs={class:"todo-header"},zs={class:"todo-summary"},Gs={key:0,class:"todo-count todo-count-completed"},Js={key:1,class:"todo-count todo-count-in-progress"},Ks={key:2,class:"todo-count todo-count-pending"},Ys={class:"todo-checklist"},Qs={class:"todo-checkbox"},Zs={class:"todo-content"},Xs={key:0,class:"tool-section"},eo={key:0,class:"tool-result tool-result-error"},to={class:"tool-code"},so={key:1,class:"tool-result tool-result-success"},oo={class:"success-message"},no={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.input?.todos||[]),m=c(()=>a.value.filter(u=>u.status==="completed").length),r=c(()=>a.value.filter(u=>u.status==="in_progress").length),l=c(()=>a.value.filter(u=>u.status==="pending").length);function d(u){return{pending:"â˜",in_progress:"â—",completed:"â˜‘"}[u]||"â˜"}const _=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),i=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),v=c(()=>{if(!_.value)return"";const u=t.toolCall.result;return u.content!==void 0?typeof u.content=="string"?u.content:JSON.stringify(u.content,null,2):u.message?u.message:JSON.stringify(u,null,2)});return(u,w)=>(s(),n("div",Fs,[e("div",Bs,[e("div",Vs,[w[0]||(w[0]=e("span",{class:"todo-icon"},"ðŸ“‹",-1)),w[1]||(w[1]=e("strong",null,"Task List:",-1)),e("div",zs,[m.value>0?(s(),n("span",Gs,g(m.value)+" completed ",1)):D("",!0),r.value>0?(s(),n("span",Js,g(r.value)+" in progress ",1)):D("",!0),l.value>0?(s(),n("span",Ks,g(l.value)+" pending ",1)):D("",!0)])]),e("div",Ys,[(s(!0),n(Z,null,X(a.value,(f,$)=>(s(),n("div",{key:$,class:z(["todo-item",`todo-${f.status}`])},[e("span",Qs,g(d(f.status)),1),e("span",Zs,g(f.content),1)],2))),128))])]),_.value?(s(),n("div",Xs,[i.value?(s(),n("div",eo,[w[2]||(w[2]=e("strong",null,"Error:",-1)),e("pre",to,g(v.value),1)])):(s(),n("div",so,[e("div",oo,[w[3]||(w[3]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"Task list updated ("+g(a.value.length)+" tasks)",1)])]))])):D("",!0)]))}},lo=B(no,[["__scopeId","data-v-bbe55ee7"]]),ao={class:"edit-tool-handler"},ro={class:"tool-section"},io={class:"edit-file-info"},co={class:"file-path"},uo={key:0,class:"replace-all-badge"},mo={class:"edit-diff-container"},po={class:"diff-header"},vo={class:"diff-stats"},fo={class:"stat-removed"},go={class:"stat-added"},_o={class:"unified-diff"},ho={class:"diff-scroll-container"},bo={class:"diff-marker"},yo={class:"diff-content"},$o={key:0,class:"tool-section"},wo={key:0,class:"tool-result tool-result-error"},So={class:"tool-code"},ko={key:1,class:"tool-result tool-result-success"},Co={class:"success-message"},xo={key:0,class:"success-detail"},Mo={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.input?.file_path||"Unknown"),m=c(()=>t.toolCall.input?.old_string||""),r=c(()=>t.toolCall.input?.new_string||""),l=c(()=>t.toolCall.input?.replace_all||!1),d=c(()=>{const $=Ge(a.value,m.value,r.value,"","",{context:3}).split(`
`),j=[];for(let y=4;y<$.length;y++){const b=$[y];b&&(b.startsWith("-")?j.push({type:"removed",content:b.substring(1)}):b.startsWith("+")?j.push({type:"added",content:b.substring(1)}):b.startsWith(" ")?j.push({type:"context",content:b.substring(1)}):b.startsWith("@@")&&j.push({type:"hunk",content:b}))}return j}),_=c(()=>d.value.filter(f=>f.type==="removed").length),i=c(()=>d.value.filter(f=>f.type==="added").length),v=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),u=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),w=c(()=>{if(!v.value)return"";const f=t.toolCall.result;return f.content!==void 0?typeof f.content=="string"?f.content:JSON.stringify(f.content,null,2):f.message?f.message:JSON.stringify(f,null,2)});return(f,$)=>(s(),n("div",ao,[e("div",ro,[e("div",io,[$[0]||($[0]=e("span",{class:"file-icon"},"âœï¸",-1)),$[1]||($[1]=e("strong",null,"Editing:",-1)),e("code",co,g(a.value),1),l.value?(s(),n("span",uo,"Replace All")):D("",!0)]),e("div",mo,[e("div",po,[$[2]||($[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",vo,[e("span",fo,"-"+g(_.value),1),e("span",go,"+"+g(i.value),1)])]),e("div",_o,[e("div",ho,[(s(!0),n(Z,null,X(d.value,(j,y)=>(s(),n("div",{key:y,class:z(["diff-line",{"diff-line-removed":j.type==="removed","diff-line-added":j.type==="added","diff-line-context":j.type==="context","diff-line-hunk":j.type==="hunk"}])},[e("span",bo,g(j.type==="removed"?"-":j.type==="added"?"+":j.type==="hunk"?"@":" "),1),e("span",yo,g(j.content),1)],2))),128))])])])]),v.value?(s(),n("div",$o,[u.value?(s(),n("div",wo,[$[3]||($[3]=e("strong",null,"Error:",-1)),e("pre",So,g(w.value),1)])):(s(),n("div",ko,[e("div",Co,[$[4]||($[4]=e("span",{class:"success-icon"},"âœ…",-1)),$[5]||($[5]=e("strong",null,"File edited successfully",-1)),l.value?(s(),n("span",xo,"(all occurrences replaced)")):D("",!0)])]))])):D("",!0)]))}},jo=B(Mo,[["__scopeId","data-v-16b90adc"]]),To={class:"search-tool-handler"},Eo={class:"tool-section"},Lo={class:"search-info"},Po={class:"search-icon"},Io={class:"search-pattern"},Do={key:0,class:"search-path"},Oo={key:1,class:"search-filters"},No={key:0,class:"filter-badge"},Ao={key:1,class:"filter-badge"},Ro={key:2,class:"filter-badge"},Uo={key:0,class:"tool-section"},qo={key:0,class:"tool-result tool-result-error"},Wo={class:"tool-code"},Ho={key:1,class:"search-results"},Fo={class:"results-header"},Bo={class:"results-label"},Vo={class:"results-count-badge"},zo={class:"results-content"},Go={class:"tool-code"},Jo={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.name==="Grep");c(()=>t.toolCall.name==="Glob");const m=c(()=>t.toolCall.input?.pattern||"Unknown"),r=c(()=>t.toolCall.input?.path||null),l=c(()=>t.toolCall.input?.type||null),d=c(()=>t.toolCall.input?.glob||null),_=c(()=>t.toolCall.input?.["-i"]||!1),i=c(()=>l.value||d.value||_.value),v=c(()=>a.value?"ðŸ”":"ðŸ“"),u=c(()=>a.value?"Searching content":"Finding files"),w=c(()=>a.value?"Matches":"Files found"),f=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),$=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),j=c(()=>{if(!f.value)return"";const b=t.toolCall.result;return b.content!==void 0?typeof b.content=="string"?b.content:JSON.stringify(b.content,null,2):b.message?b.message:JSON.stringify(b,null,2)}),y=c(()=>!f.value||$.value||!j.value?0:j.value.split(`
`).filter(S=>S.trim()).length);return(b,S)=>(s(),n("div",To,[e("div",Eo,[e("div",Lo,[e("span",Po,g(v.value),1),e("strong",null,g(u.value)+":",1),e("code",Io,g(m.value),1),r.value?(s(),n("span",Do,"in "+g(r.value),1)):D("",!0),i.value?(s(),n("span",Oo,[l.value?(s(),n("span",No,"type: "+g(l.value),1)):D("",!0),d.value?(s(),n("span",Ao,"glob: "+g(d.value),1)):D("",!0),_.value?(s(),n("span",Ro,"case-insensitive")):D("",!0)])):D("",!0)])]),f.value?(s(),n("div",Uo,[$.value?(s(),n("div",qo,[S[0]||(S[0]=e("strong",null,"Error:",-1)),e("pre",Wo,g(j.value),1)])):(s(),n("div",Ho,[e("div",Fo,[e("span",Bo,g(w.value)+":",1),e("span",Vo,g(y.value)+" "+g(y.value===1?"match":"matches"),1)]),e("div",zo,[e("pre",Go,g(j.value),1)])]))])):D("",!0)]))}},Oe=B(Jo,[["__scopeId","data-v-0d272c39"]]),Ko={class:"web-tool-handler"},Yo={class:"tool-section"},Qo={class:"web-info"},Zo={class:"web-icon"},Xo=["href"],en={key:1,class:"web-query"},tn={key:0,class:"web-prompt-container"},sn={class:"prompt-content"},on={key:1,class:"web-domains"},nn={class:"domains-label"},ln={key:0,class:"tool-section"},an={key:0,class:"tool-result tool-result-error"},rn={class:"tool-code"},cn={key:1,class:"web-results"},dn={class:"results-header"},un={class:"results-label"},mn={class:"results-content"},pn={class:"tool-code"},vn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.name==="WebFetch");c(()=>t.toolCall.name==="WebSearch");const m=c(()=>t.toolCall.input?.url||null),r=c(()=>t.toolCall.input?.query||null),l=c(()=>t.toolCall.input?.prompt||null),d=c(()=>t.toolCall.input?.allowed_domains||[]),_=c(()=>t.toolCall.input?.blocked_domains||[]),i=c(()=>d.value.length>0?d.value:_.value.length>0?_.value:[]),v=c(()=>d.value.length>0?"Allowed domains":_.value.length>0?"Blocked domains":"Domains"),u=c(()=>a.value?"ðŸŒ":"ðŸ”Ž"),w=c(()=>a.value?"Fetching URL":"Searching web"),f=c(()=>a.value?"Fetched content":"Search results"),$=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),j=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),y=c(()=>{if(!$.value)return"";const b=t.toolCall.result;return b.content!==void 0?typeof b.content=="string"?b.content:JSON.stringify(b.content,null,2):b.message?b.message:JSON.stringify(b,null,2)});return(b,S)=>(s(),n("div",Ko,[e("div",Yo,[e("div",Qo,[e("span",Zo,g(u.value),1),e("strong",null,g(w.value)+":",1),m.value?(s(),n("a",{key:0,href:m.value,target:"_blank",class:"web-url"},g(m.value),9,Xo)):r.value?(s(),n("code",en,g(r.value),1)):D("",!0)]),l.value?(s(),n("div",tn,[S[0]||(S[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",sn,g(l.value),1)])):D("",!0),i.value.length>0?(s(),n("div",on,[e("span",nn,g(v.value)+":",1),(s(!0),n(Z,null,X(i.value,x=>(s(),n("span",{key:x,class:"domain-badge"},g(x),1))),128))])):D("",!0)]),$.value?(s(),n("div",ln,[j.value?(s(),n("div",an,[S[1]||(S[1]=e("strong",null,"Error:",-1)),e("pre",rn,g(y.value),1)])):(s(),n("div",cn,[e("div",dn,[e("span",un,g(f.value)+":",1)]),e("div",mn,[e("pre",pn,g(y.value),1)])]))])):D("",!0)]))}},Ne=B(vn,[["__scopeId","data-v-62b55b55"]]),fn={class:"task-tool-handler"},gn={class:"tool-section"},_n={class:"task-header"},hn={key:0,class:"agent-type-badge"},bn={key:0,class:"task-description"},yn={class:"description-content"},$n={key:1,class:"task-prompt-container"},wn={class:"prompt-header"},Sn={class:"prompt-length"},kn={class:"prompt-code"},Cn={key:0,class:"tool-section"},xn={key:0,class:"tool-result tool-result-error"},Mn={class:"tool-code"},jn={key:1,class:"agent-output"},Tn={class:"output-header"},En={key:0,class:"output-count-badge"},Ln={class:"output-content"},Pn={class:"tool-code"},In={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.input?.description||null),m=c(()=>t.toolCall.input?.prompt||null),r=c(()=>t.toolCall.input?.subagent_type||null),l=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),d=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),_=c(()=>{if(!l.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)}),i=c(()=>_.value?_.value.split(`
`).length:0);return(v,u)=>(s(),n("div",fn,[e("div",gn,[e("div",_n,[u[0]||(u[0]=e("span",{class:"task-icon"},"ðŸ¤–",-1)),u[1]||(u[1]=e("strong",null,"Agent Task:",-1)),r.value?(s(),n("span",hn,g(r.value),1)):D("",!0)]),a.value?(s(),n("div",bn,[u[2]||(u[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",yn,g(a.value),1)])):D("",!0),m.value?(s(),n("div",$n,[e("div",wn,[u[3]||(u[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",Sn,g(m.value.length)+" characters",1)]),e("pre",kn,g(m.value),1)])):D("",!0)]),l.value?(s(),n("div",Cn,[d.value?(s(),n("div",xn,[u[4]||(u[4]=e("strong",null,"Error:",-1)),e("pre",Mn,g(_.value),1)])):(s(),n("div",jn,[e("div",Tn,[u[5]||(u[5]=e("span",{class:"output-label"},"Agent Output:",-1)),i.value>0?(s(),n("span",En,g(i.value)+" lines",1)):D("",!0)]),e("div",Ln,[e("pre",Pn,g(_.value),1)])]))])):D("",!0)]))}},Dn=B(In,[["__scopeId","data-v-c520c244"]]),On={class:"notebook-edit-tool-handler"},Nn={class:"tool-section"},An={class:"notebook-info"},Rn={class:"file-path"},Un={class:"cell-info mt-2"},qn={class:"info-row"},Wn={class:"info-row"},Hn={key:0,class:"info-row"},Fn={class:"badge bg-info"},Bn={key:0,class:"source-preview mt-3"},Vn={class:"preview-header"},zn={class:"preview-stats"},Gn={class:"source-code"},Jn={key:0,class:"tool-section"},Kn={key:0},Yn={key:1,class:"text-danger"},Qn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.input?.notebook_path||"Unknown"),m=c(()=>t.toolCall.input?.cell_id),r=c(()=>t.toolCall.input?.cell_type||"code"),l=c(()=>t.toolCall.input?.edit_mode||"replace"),d=c(()=>t.toolCall.input?.new_source||""),_=c(()=>d.value.split(`
`).length),i=c(()=>r.value==="code"?"bg-primary":"bg-secondary"),v=c(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),u=c(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const w=l.value;return w==="insert"?"Cell inserted successfully":w==="delete"?"Cell deleted successfully":"Cell updated successfully"});return(w,f)=>(s(),n("div",On,[e("div",Nn,[e("div",An,[f[0]||(f[0]=e("span",{class:"notebook-icon"},"ðŸ““",-1)),f[1]||(f[1]=e("strong",null,"Notebook:",-1)),e("code",Rn,g(a.value),1)]),e("div",Un,[e("div",qn,[f[2]||(f[2]=e("strong",null,"Cell ID:",-1)),e("code",null,g(m.value||"N/A"),1)]),e("div",Wn,[f[3]||(f[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:z(["badge",i.value])},g(r.value),3)]),l.value?(s(),n("div",Hn,[f[4]||(f[4]=e("strong",null,"Edit Mode:",-1)),e("span",Fn,g(l.value),1)])):D("",!0)]),d.value?(s(),n("div",Bn,[e("div",Vn,[f[5]||(f[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",zn,g(_.value)+" lines",1)]),e("pre",Gn,[e("code",null,g(d.value),1)])])):D("",!0)]),o.toolCall.result?(s(),n("div",Jn,[f[8]||(f[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:z(["tool-result",v.value])},[o.toolCall.result.success!==!1?(s(),n("div",Kn,[f[6]||(f[6]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+g(u.value),1)])):(s(),n("div",Yn,[f[7]||(f[7]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+g(o.toolCall.result.error||"Operation failed"),1)]))],2)])):D("",!0)]))}},Zn=B(Qn,[["__scopeId","data-v-bf9ef8f9"]]),Xn={class:"shell-tool-handler"},el={class:"tool-section"},tl={class:"shell-info"},sl={class:"shell-icon"},ol={key:0,class:"shell-id"},nl={key:0,class:"filter-info mt-2"},ll={class:"filter-pattern"},al={key:0,class:"tool-section"},rl={class:"result-header mb-2"},il={key:0,class:"shell-output"},cl={key:0},dl={key:1,class:"text-danger"},ul={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.name==="BashOutput"?"ðŸ“¤":t.toolCall.name==="KillShell"?"ðŸ›‘":"ðŸš"),m=c(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),r=c(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),l=c(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),d=c(()=>t.toolCall.input?.filter),_=c(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),i=c(()=>t.toolCall.result?.status),v=c(()=>{const f=i.value;return f==="running"?"bg-success":f==="completed"?"bg-secondary":f==="killed"||f==="terminated"?"bg-danger":"bg-info"}),u=c(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),w=c(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return(f,$)=>(s(),n("div",Xn,[e("div",el,[e("div",tl,[e("span",sl,g(a.value),1),e("strong",null,g(m.value)+":",1),l.value?(s(),n("code",ol,"Shell "+g(l.value),1)):D("",!0)]),o.toolCall.name==="BashOutput"&&d.value?(s(),n("div",nl,[$[0]||($[0]=e("strong",null,"Filter:",-1)),e("code",ll,g(d.value),1)])):D("",!0)]),o.toolCall.result?(s(),n("div",al,[e("div",rl,[e("strong",null,g(r.value)+":",1),i.value?(s(),n("span",{key:0,class:z(["badge",v.value])},g(i.value),3)):D("",!0)]),_.value?(s(),n("div",il,[e("pre",null,[e("code",null,g(_.value),1)])])):(s(),n("div",{key:1,class:z(["tool-result",u.value])},[o.toolCall.result.success!==!1?(s(),n("div",cl,[$[1]||($[1]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+g(w.value),1)])):(s(),n("div",dl,[$[2]||($[2]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+g(o.toolCall.result.error||"Operation failed"),1)]))],2))])):D("",!0)]))}},Ae=B(ul,[["__scopeId","data-v-1a461f4c"]]),ml={class:"skill-tool-handler"},pl={key:0,class:"tool-section"},vl={class:"d-flex align-items-center gap-2"},fl={class:"text-muted small"},gl={key:0,class:"skill-content-body"},_l={class:"skill-content-text"},hl={key:1,class:"tool-section mt-3"},bl={class:"tool-result tool-result-error"},yl={class:"tool-code"},$l={__name:"SkillToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=ue(),m=J(),r=I(!1);function l(){r.value=!r.value}c(()=>t.toolCall.input?.command||"Unknown Skill"),c(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),c(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}});const d=c(()=>{const f=m.currentSessionId;if(!f)return{running:null,content:null};const $=a.messagesBySession.get(f)||[],j=$.findIndex(S=>S.type==="user"&&S.metadata?.has_tool_results&&S.metadata?.tool_results?.some(x=>x.tool_use_id===t.toolCall.id));if(j===-1)return{running:null,content:null};let y=null,b=null;for(let S=j+1;S<Math.min(j+3,$.length);S++){const x=$[S];if(x.type!=="user")continue;const h=x.content||"";h.includes("<command-message>")&&h.includes("skill is running")?y=x:h.startsWith("Base directory for this skill:")&&(b=x)}return{running:y,content:b}});c(()=>{const f=d.value.content;if(!f)return null;const j=(f.content||"").match(/Base directory(?:\s+for\s+this\s+skill)?:\s*(.+?)(?:\n|$)/i);return j&&j[1]?j[1].trim():null});const _=c(()=>{const f=d.value.content;if(!f)return"";const $=f.content||"",j=/Base directory(?:\s+for\s+this\s+skill)?:.*?\n/i;return $.replace(j,"").trim()}),i=c(()=>_.value.length>0),v=c(()=>_.value?_.value.split(`
`).length:0),u=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),w=c(()=>{if(!u.value)return"";const f=t.toolCall.result;return f?.message?f.message:f?.error?f.error:"An error occurred"});return(f,$)=>(s(),n("div",ml,[i.value?(s(),n("div",pl,[e("div",{class:"skill-content-header",onClick:l},[e("div",vl,[e("i",{class:z(["bi",r.value?"bi-chevron-down":"bi-chevron-right"])},null,2),$[0]||($[0]=e("strong",null,"Skill Content",-1)),e("span",fl,"("+g(v.value)+" lines)",1)])]),r.value?(s(),n("div",gl,[e("pre",_l,g(_.value),1)])):D("",!0)])):D("",!0),u.value?(s(),n("div",hl,[$[1]||($[1]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",bl,[e("pre",yl,g(w.value),1)])])):D("",!0)]))}},wl=B($l,[["__scopeId","data-v-ba9a91da"]]),Sl={class:"slashcommand-tool-handler"},kl={key:0,class:"tool-section"},Cl={class:"d-flex align-items-center gap-2"},xl={class:"text-muted small"},Ml={key:0,class:"command-content-body"},jl={class:"command-content-text"},Tl={key:1,class:"tool-section mt-3"},El={class:"tool-result tool-result-error"},Ll={class:"tool-code"},Pl={__name:"SlashCommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=ue(),m=J(),r=I(!1);function l(){r.value=!r.value}c(()=>t.toolCall.input?.command||"Unknown Command"),c(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),c(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}});const d=c(()=>{const f=m.currentSessionId;if(!f)return{running:null,content:null};const $=a.messagesBySession.get(f)||[],j=$.findIndex(S=>S.type==="user"&&S.metadata?.has_tool_results&&S.metadata?.tool_results?.some(x=>x.tool_use_id===t.toolCall.id));if(j===-1)return{running:null,content:null};let y=null,b=null;for(let S=j+1;S<Math.min(j+3,$.length);S++){const x=$[S];if(x.type!=="user")continue;const h=x.content||"";h.includes("<command-message>")&&h.includes("<command-name>")&&h.includes("<command-args>")?y=x:h.includes("ARGUMENTS:")&&(b=x)}return{running:y,content:b}});c(()=>{const f=d.value.running;if(!f)return null;const j=(f.content||"").match(/<command-args>(.+?)<\/command-args>/s);return j&&j[1]?j[1].trim():null});const _=c(()=>{const f=d.value.content;if(!f)return"";const $=f.content||"",j=/\nARGUMENTS:.*$/s;return $.replace(j,"").replace(/<command-message>.*?<\/command-message>/s,"").replace(/<command-name>.*?<\/command-name>/s,"").replace(/<command-args>.*?<\/command-args>/s,"").trim()}),i=c(()=>_.value.length>0),v=c(()=>_.value?_.value.split(`
`).length:0),u=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),w=c(()=>{if(!u.value)return"";const f=t.toolCall.result;return f?.message?f.message:f?.error?f.error:"An error occurred"});return(f,$)=>(s(),n("div",Sl,[i.value?(s(),n("div",kl,[e("div",{class:"command-content-header",onClick:l},[e("div",Cl,[e("i",{class:z(["bi",r.value?"bi-chevron-down":"bi-chevron-right"])},null,2),$[0]||($[0]=e("strong",null,"Command Content",-1)),e("span",xl,"("+g(v.value)+" lines)",1)])]),r.value?(s(),n("div",Ml,[e("pre",jl,g(_.value),1)])):D("",!0)])):D("",!0),u.value?(s(),n("div",Tl,[$[1]||($[1]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",El,[e("pre",Ll,g(w.value),1)])])):D("",!0)]))}},Il=B(Pl,[["__scopeId","data-v-17d3444e"]]),Dl={class:"exit-plan-mode-tool-handler"},Ol={class:"tool-section"},Nl={key:0,class:"plan-content mt-2"},Al={class:"plan-text"},Rl={key:0,class:"tool-section"},Ul={key:0},ql={key:1,class:"text-danger"},Wl={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>t.toolCall.input?.plan),m=c(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(r,l)=>(s(),n("div",Dl,[e("div",Ol,[l[1]||(l[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"ðŸ“‹"),e("strong",null,"Exiting Plan Mode")],-1)),a.value?(s(),n("div",Nl,[l[0]||(l[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",Al,g(a.value),1)])):D("",!0)]),o.toolCall.result?(s(),n("div",Rl,[l[4]||(l[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:z(["tool-result",m.value])},[o.toolCall.result.success!==!1?(s(),n("div",Ul,[...l[2]||(l[2]=[e("i",{class:"bi bi-check-circle"},null,-1),G(" Permission mode reverted to default ",-1)])])):(s(),n("div",ql,[l[3]||(l[3]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+g(o.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):D("",!0)]))}},Hl=B(Wl,[["__scopeId","data-v-bd35183e"]]),Fl={class:"d-flex align-items-center gap-2 flex-grow-1 min-width-0"},Bl={class:"tool-status-icon"},Vl=["title"],zl={class:"d-flex align-items-center gap-2"},Gl={class:"text-muted"},Jl={key:0,class:"card-body"},Kl={key:0,class:"alert alert-warning mb-3"},Yl={class:"d-flex align-items-center"},Ql={class:"mb-0 small"},Zl={key:1,class:"permission-prompt mt-3"},Xl={class:"alert alert-warning mb-3"},ea={class:"mb-0"},ta={class:"tool-name"},sa={key:0,class:"suggestions-section mb-3"},oa={class:"alert alert-info mb-0"},na={class:"suggestion-details p-2 bg-white rounded"},la={class:"permission-buttons d-flex gap-2 mb-3"},aa=["disabled"],ra=["disabled"],ia=["disabled"],ca={class:"guidance-section mt-3"},da=["disabled"],ua=["disabled"],ma={key:2,class:"mt-3"},pa={class:"alert alert-warning mb-0"},va={class:"d-flex align-items-center"},fa={class:"mb-0 small"},ga={key:3,class:"tool-section"},_a={class:"alert alert-danger mb-0"},ha={key:0},ba={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(o){const t=o,a=ue(),m=J(),r=pe(),l=I(!1),d=I(null),_=I(""),i=c(()=>a.isToolUseOrphaned(m.currentSessionId,t.toolCall.id)),v=c(()=>a.getOrphanedInfo(m.currentSessionId,t.toolCall.id)),u={Read:ms,Write:Ts,Bash:Hs,TodoWrite:lo,Edit:jo,Grep:Oe,Glob:Oe,WebFetch:Ne,WebSearch:Ne,Task:Dn,NotebookEdit:Zn,BashOutput:Ae,KillShell:Ae,SlashCommand:Il,Skill:wl,ExitPlanMode:Hl},w=c(()=>{const E=t.toolCall.name;return u[E]?u[E]:Yt}),f=c(()=>{const E=[];switch(t.toolCall.status){case"pending":E.push("border-secondary");break;case"permission_required":E.push("border-warning");break;case"executing":E.push("border-primary");break;case"completed":y.value||t.toolCall.permissionDecision==="deny"?E.push("border-danger"):E.push("border-success");break;case"error":E.push("border-danger");break}return E.join(" ")}),$=c(()=>{switch(t.toolCall.status){case"pending":return"ðŸ”„";case"permission_required":return"â“";case"executing":return"âš¡";case"completed":return t.toolCall.permissionDecision==="deny"?"âŒ":y.value?"ðŸ’¥":"âœ…";case"error":return"ðŸ’¥";default:return"ðŸ”§"}}),j=c(()=>ke(t.toolCall.timestamp)),y=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),b=c(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function S(E){if(!E)return"";const C=E.replace(/\\/g,"/").split("/");return C[C.length-1]}function x(E,C=200){return E?E.length<=C?E:E.substring(0,C)+"...":""}function h(E){if(!E)return null;if(E.content){const C=E.content.match(/exit code (\d+)/i);if(C)return parseInt(C[1])}return E.error?1:0}function p(E,C){const k=E?E.split(`
`).length:0;return{added:C?C.split(`
`).length:0,removed:k}}const R=c(()=>{const E=t.toolCall.name,C=t.toolCall.input||{},k=t.toolCall.result,L=t.toolCall.status;switch(E){case"Bash":case"Shell":case"Command":{const O=x(C.command,200);if(L==="completed"&&k){const A=h(k);return`Bash: ${O} (exit ${A})`}return`Bash: ${O}`}case"SlashCommand":{const O=x(C.command,200);return L==="completed"&&k?`SlashCommand: ${O}`:`SlashCommand: ${O}`}case"Edit":{const O=S(C.file_path);if(L==="completed"&&k&&!k.error){const{added:A,removed:P}=p(C.old_string,C.new_string);return A===P?`Edit: ${O} (${A} lines changed)`:`Edit: ${O} (${A} lines added, ${P} removed)`}return`Edit: ${O}`}case"Read":{const O=S(C.file_path);if(C.offset!==void 0||C.limit!==void 0){const P=(C.offset||0)+1,N=C.limit?(C.offset||0)+C.limit:"âˆž";return`Read: ${O} (lines ${P}-${N})`}return`Read: ${O} (full file)`}case"Write":{const O=S(C.file_path);if(L==="completed"&&k&&!k.error&&C.content){const A=C.content.split(`
`).length;return`Write: ${O} (${A} lines written)`}return`Write: ${O}`}case"Skill":{const O=C.command||"Unknown";return L==="completed"&&k?k.error?`Skill: ${O} (error)`:`Skill: ${O} (completed)`:`Skill: ${O}`}case"Task":{const O=C.subagent_type||"general",A=C.description||"Task";return L==="completed"&&k?k.error?`Task: (${O}) ${A} (error)`:`Task: (${O}) ${A} (completed)`:`Task: (${O}) ${A}`}case"TodoWrite":{if(C.todos&&Array.isArray(C.todos)){const O=C.todos.filter(N=>N.status==="completed").length,A=C.todos.length,P=C.todos.find(N=>N.status==="in_progress");return P?`Todo: Working on "${P.content}"`:`Todo: ${O}/${A} Tasks Completed`}return"Todo: Updated"}case"Grep":case"Glob":{const O=C.pattern||"",A=E==="Grep"?"Grep":"Glob";if(L==="completed"&&k&&!k.error){let P=0;return k.content&&(P=k.content.split(`
`).filter(W=>W.trim()).length),`${A}: "${O}" (${P} results)`}return`${A}: "${O}"`}case"WebFetch":case"WebSearch":{const O=C.url||C.query||"";let A="";try{O&&(A=new URL(O.startsWith("http")?O:`https://${O}`).hostname)}catch{A=O.length>50?O.substring(0,50)+"...":O}return L==="completed"&&k?k.error?`Web: ${A} (error)`:`Web: ${A} (success)`:`Web: ${A||O}`}case"NotebookEdit":{const O=S(C.notebook_path),A=C.cell_number!==void 0?C.cell_number:"?",P=C.edit_mode||"replace";return`NotebookEdit: ${O} cell #${A} (${P})`}case"ExitPlanMode":return"ExitPlanMode: Plan submitted";case"BashOutput":return`BashOutput: Read output from ${C.bash_id||"unknown"}`;case"KillShell":return`KillShell: Terminate ${C.shell_id||"unknown"}`;default:return`${E}: executed`}}),U=c(()=>{const E=t.toolCall.name,C=t.toolCall.input||{};return["Bash","Shell","Command","SlashCommand"].includes(E)?C.command||E:["Edit","Read","Write","NotebookEdit"].includes(E)&&(C.file_path||C.notebook_path)||E});function M(){const E=m.currentSessionId;E&&a.toggleToolExpansion(E,t.toolCall.id)}function T(E){return E.type==="setMode"?`Set permission mode to "${E.mode}"`:E.type==="allow"?`Allow tool: ${E.tool}`:JSON.stringify(E)}async function H(E,C,k=null){if(!l.value){l.value=!0,E==="allow"?d.value=C?"approve-apply":"approve":k?d.value="deny-guidance":d.value="deny";try{const L=m.currentSessionId;if(L){const O=C&&t.toolCall.suggestions?t.toolCall.suggestions:[];a.handlePermissionResponse(L,{request_id:t.toolCall.permissionRequestId,decision:E,reasoning:E==="allow"?"User allowed permission":"User denied permission",applied_updates:O})}await r.sendPermissionResponse(t.toolCall.permissionRequestId,E,C,k)}catch(L){console.error("Failed to send permission response:",L)}finally{l.value=!1,d.value=null}}}return(E,C)=>(s(),n("div",{class:z(["tool-call-card card",f.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:M},[e("div",Fl,[e("span",Bl,g($.value),1),e("strong",{class:"tool-name",title:U.value},g(R.value),9,Vl)]),e("div",zl,[e("small",Gl,g(j.value),1),e("i",{class:z(["bi",o.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),o.toolCall.isExpanded?(s(),n("div",Jl,[i.value?(s(),n("div",Kl,[e("div",Yl,[C[6]||(C[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[C[5]||(C[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",Ql,g(v.value?.message||"Session was terminated"),1)])])])):D("",!0),(s(),de(Ue(w.value),{toolCall:o.toolCall},null,8,["toolCall"])),o.toolCall.status==="permission_required"&&!i.value?(s(),n("div",Zl,[e("div",Xl,[C[9]||(C[9]=e("p",{class:"mb-2"},[e("strong",null,"ðŸ” Permission Required")],-1)),e("p",ea,[C[7]||(C[7]=G("Claude wants to use the ",-1)),e("code",ta,g(o.toolCall.name),1),C[8]||(C[8]=G(" tool.",-1))])]),b.value?(s(),n("div",sa,[e("div",oa,[C[10]||(C[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),G(" Suggested Permission Update ")],-1)),C[11]||(C[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",na,[(s(!0),n(Z,null,X(o.toolCall.suggestions,(k,L)=>(s(),n("div",{key:L,class:"suggestion-item"},[e("code",null,g(T(k)),1)]))),128))]),C[12]||(C[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):D("",!0),e("div",la,[b.value?(s(),n("button",{key:0,class:"btn btn-success",onClick:C[0]||(C[0]=k=>H("allow",!0)),disabled:l.value},[C[13]||(C[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+g(l.value&&d.value==="approve-apply"?"â³ Submitting...":"âœ… Approve & Apply"),1)],8,aa)):D("",!0),e("button",{class:z(["btn",b.value?"btn-outline-success":"btn-success"]),onClick:C[1]||(C[1]=k=>H("allow",!1)),disabled:l.value},[C[14]||(C[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+g(l.value&&d.value==="approve"?"â³ Submitting...":b.value?"âœ… Approve Only":"âœ… Approve"),1)],10,ra),e("button",{class:"btn btn-danger",onClick:C[2]||(C[2]=k=>H("deny",!1)),disabled:l.value},[C[15]||(C[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),G(" "+g(l.value&&d.value==="deny"?"â³ Submitting...":"âŒ Deny"),1)],8,ia)]),e("div",ca,[C[17]||(C[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),G(" Provide Guidance (Optional) ")],-1)),C[18]||(C[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),Y(e("textarea",{"onUpdate:modelValue":C[3]||(C[3]=k=>_.value=k),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:l.value},null,8,da),[[ne,_.value]]),_.value.trim()?(s(),n("button",{key:0,class:"btn btn-warning btn-sm",onClick:C[4]||(C[4]=k=>H("deny",!1,_.value)),disabled:l.value},[C[16]||(C[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),G(" "+g(l.value&&d.value==="deny-guidance"?"â³ Submitting...":"ðŸ’¡ Provide Guidance & Continue"),1)],8,ua)):D("",!0)])])):D("",!0),o.toolCall.status==="permission_required"&&i.value?(s(),n("div",ma,[e("div",pa,[e("div",va,[C[20]||(C[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[C[19]||(C[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",fa,g(v.value?.message||"Session was terminated before permission could be granted"),1)])])])])):D("",!0),o.toolCall.permissionDecision==="deny"?(s(),n("div",ga,[e("div",_a,[C[21]||(C[21]=e("i",{class:"bi bi-x-circle"},null,-1)),C[22]||(C[22]=G(" Permission denied ",-1)),o.toolCall.result?.message?(s(),n("span",ha," - "+g(o.toolCall.result.message),1)):D("",!0)])])):D("",!0)])):D("",!0)],2))}},ya=B(ba,[["__scopeId","data-v-65c848bf"]]),$a={class:"message-row message-row-assistant"},wa=["title"],Sa={class:"message-content-column"},ka={key:0,class:"thinking-block mb-2"},Ca=["innerHTML"],xa={key:2,class:"tool-calls"},Ma={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(o){const t=o,a=ue(),m=J();be.setOptions({breaks:!0,gfm:!0});const r=c(()=>ke(t.message.timestamp)),l=c(()=>t.message.metadata?.model||null),d=c(()=>{const j=r.value;return`assistant${l.value?`
Model: ${l.value}`:""}
${j}`}),_=c(()=>{const j=t.message.content||"";return j.trim().length>0&&j!=="Assistant response"}),i=c(()=>{const j=t.message.content||"";let y=be.parse(j);return y=y.replace(/\n</g,"<"),y=y.replace(/\n+$/,""),Ee.sanitize(y)}),v=c(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),u=c(()=>t.message.metadata?.thinking_content||""),w=c(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),f=c(()=>t.message.metadata?.tool_uses||[]),$=c(()=>{const j=m.currentSessionId;if(!j)return[];const y=a.toolCallsBySession.get(j)||[];return f.value.map(b=>{const S=y.find(x=>x.id===b.id);return S||{id:b.id,name:b.name,input:b.input,status:"pending",result:null,timestamp:b.timestamp||t.message.timestamp,isExpanded:!0}})});return(j,y)=>(s(),n("div",$a,[e("div",{class:"message-speaker",title:d.value},[...y[0]||(y[0]=[e("span",{class:"speaker-label"},"assistant",-1)])],8,wa),e("div",Sa,[v.value?(s(),n("div",ka,[Q(qt,{thinking:u.value},null,8,["thinking"])])):D("",!0),_.value?(s(),n("div",{key:1,class:"message-text",innerHTML:i.value},null,8,Ca)):D("",!0),w.value?(s(),n("div",xa,[(s(!0),n(Z,null,X($.value,b=>(s(),de(ya,{key:b.id,toolCall:b},null,8,["toolCall"]))),128))])):D("",!0)])]))}},ja=B(Ma,[["__scopeId","data-v-726a72a7"]]),Ta={class:"message-row message-row-system"},Ea=["title"],La={class:"message-content-column"},Pa={class:"system-text"},Ia={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>ke(t.message.timestamp)),m=c(()=>`system
${a.value}`);return(r,l)=>(s(),n("div",Ta,[e("div",{class:"message-speaker",title:m.value},[...l[0]||(l[0]=[e("span",{class:"speaker-label"},"system",-1)])],8,Ea),e("div",La,[e("span",Pa,g(o.message.content),1)])]))}},Re=B(Ia,[["__scopeId","data-v-4999cd2b"]]),Da={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(o){const t=o,a=c(()=>{switch(t.message.type){case"user":return Dt;case"assistant":return ja;case"system":return Re;default:return Re}});return(m,r)=>(s(),de(Ue(a.value),{message:o.message},null,8,["message"]))}},Oa=B(Da,[["__scopeId","data-v-f283c218"]]),Na={key:0,class:"text-muted text-center py-5"},Aa={__name:"MessageList",setup(o){const t=ue(),a=se(),m=I(null),r=c(()=>t.currentMessages.filter(i=>d(i)));c(()=>t.currentToolCalls);async function l(){a.autoScrollEnabled&&(await Te(),m.value&&(m.value.scrollTop=m.value.scrollHeight))}ee(()=>t.currentMessages.length,l),ee(()=>t.currentToolCalls.length,l),ee(()=>t.currentToolCalls.map(i=>`${i.id}-${i.status}`).join(","),l),le(()=>{setTimeout(()=>{l()},100)});function d(i){const v=i.subtype||i.metadata?.subtype;if(i.type==="system"&&v==="init"||i.type==="result"||i.type==="permission_request"||i.type==="permission_response")return!1;if(i.type==="user"&&i.metadata?.has_tool_results){const u=i.content||"";if(u.match(/^Tool results?: \d+ results?$/i)||u.trim()==="")return!1}if(i.type==="user"){const u=i.content||"";if(u.includes("<command-message>")&&u.includes("skill is running")||u.startsWith("Base directory for this skill:"))return!1}if(i.type==="user"){const u=i.content||"";if(u.includes("<command-message>")&&u.includes("<command-name>")&&u.includes("<command-args>")||u.includes("ARGUMENTS:")&&(u.includes("<command-name>")||u.match(/\nARGUMENTS:/)))return!1}return!0}function _(i){return{type:i.type||"unknown",content:i.content||"",timestamp:i.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...i.metadata}}}return(i,v)=>(s(),n("div",{class:"messages-area flex-grow-1 overflow-auto",ref_key:"messagesArea",ref:m},[r.value.length===0?(s(),n("div",Na," No messages yet. Start a conversation! ")):D("",!0),(s(!0),n(Z,null,X(r.value,(u,w)=>(s(),de(Oa,{key:`msg-${u.timestamp}-${w}`,message:_(u)},null,8,["message"]))),128))],512))}},Ra=B(Aa,[["__scopeId","data-v-f94a8763"]]),Ua={class:"border-top bg-light"},qa={class:"d-flex gap-2 align-items-end px-2 py-1"},Wa=["placeholder","disabled","onKeydown"],Ha=["disabled"],Fa={__name:"InputArea",setup(o){const t=J(),a=pe(),m=I(null),r=c({get:()=>t.currentInput,set:f=>{t.currentInput=f}}),l=c(()=>t.currentSession?.is_processing||!1),d=c(()=>a.sessionConnected),_=c(()=>t.currentSession?.state==="starting"),i=c(()=>_.value?"Session is starting...":d.value?"Type your message to Claude Code...":"Waiting for connection...");function v(){const f=m.value;if(!f)return;f.style.height="auto";const $=Math.min(f.scrollHeight,parseInt(getComputedStyle(f).maxHeight));f.style.height=$+"px"}function u(){r.value.trim()&&(a.sendMessage(r.value),r.value="",m.value&&(m.value.style.height="auto"))}function w(){a.interruptSession()}return(f,$)=>(s(),n("div",Ua,[e("div",qa,[Y(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:m,"onUpdate:modelValue":$[0]||($[0]=j=>r.value=j),class:"form-control",placeholder:i.value,disabled:_.value||!d.value,rows:"1",onInput:v,onKeydown:Se(ie(u,["exact","prevent"]),["enter"])},null,40,Wa),[[ne,r.value]]),l.value?(s(),n("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:w}," Stop ")):(s(),n("button",{key:1,class:"btn btn-primary",disabled:!r.value.trim()||!d.value||_.value,onClick:u}," Send ",8,Ha))])]))}},Ba=B(Fa,[["__scopeId","data-v-a72bf16a"]]),Va={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},za={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},Ga={class:"text-secondary"},Ja={class:"d-flex flex-column flex-grow-1 overflow-hidden"},We={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(o){const t=o,a=J(),m=se(),r=c(()=>a.currentSession),l=c(()=>m.isLoading),d=c(()=>m.loadingMessage);return le(async()=>{if(t.sessionId!==a.currentSessionId){m.showLoading("Loading session...");try{await a.selectSession(t.sessionId)}finally{m.hideLoading()}}}),ee(()=>t.sessionId,async(_,i)=>{if(_!==i&&_!==a.currentSessionId){m.showLoading("Loading session...");try{await a.selectSession(_)}finally{m.hideLoading()}}}),ce(()=>{}),(_,i)=>(s(),n("div",Va,[l.value?(s(),n("div",za,[i[0]||(i[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Ga,g(d.value),1)])):D("",!0),r.value?(s(),de(at,{key:1,"session-id":t.sessionId},null,8,["session-id"])):D("",!0),e("div",Ja,[Q(Ra)]),Q(Ba),r.value?(s(),de(ut,{key:2,"session-id":t.sessionId},null,8,["session-id"])):D("",!0),r.value?(s(),de(yt,{key:3,"session-id":t.sessionId},null,8,["session-id"])):D("",!0)]))}},Ce=_e("legion",()=>{const o=I(new Map),t=I(new Map),a=I(new Map),m=I(new Map),r=I(null),l=c(()=>o.value.get(r.value)||[]),d=c(()=>t.value.get(r.value)||[]),_=c(()=>a.value.get(r.value)||[]),i=c(()=>m.value.get(r.value)||[]);function v(x){r.value=x}async function u(x,h=100,p=0){try{const R=await K.get(`/api/legions/${x}/timeline?limit=${h}&offset=${p}`),U=R.comms||[],M=R.total_count||U.length,T=R.has_more||!1;return U.sort((H,E)=>new Date(H.timestamp)-new Date(E.timestamp)),console.log(`Loaded ${U.length} of ${M} comms for legion ${x}`),o.value.set(x,U),o.value=new Map(o.value),{comms:U,totalCount:M,hasMore:T}}catch(R){throw console.error("Failed to load timeline:",R),R}}function w(x,h){o.value.has(x)||o.value.set(x,[]),o.value.get(x).push(h),o.value=new Map(o.value)}async function f(x,h){try{const R=(await K.post(`/api/legions/${x}/comms`,h)).comm;return console.log(`Sent comm ${R.comm_id} to legion ${x}`),R}catch(p){throw console.error("Failed to send comm:",p),p}}async function $(x){return console.log(`Minions for legion ${x} are already available in session store`),[]}async function j(x,h){try{const R=(await K.post(`/api/legions/${x}/minions`,h)).minion;return await $(x),console.log(`Created minion ${R.minion_id} in legion ${x}`),R}catch(p){throw console.error("Failed to create minion:",p),p}}async function y(x){try{const p=(await K.get(`/api/legions/${x}/hordes`)).hordes||[];return console.log(`Loaded ${p.length} hordes for legion ${x}`),a.value.set(x,p),a.value=new Map(a.value),p}catch(h){throw console.error("Failed to load hordes:",h),h}}async function b(x){try{const p=(await K.get(`/api/legions/${x}/channels`)).channels||[];return console.log(`Loaded ${p.length} channels for legion ${x}`),m.value.set(x,p),m.value=new Map(m.value),p}catch(h){throw console.error("Failed to load channels:",h),h}}function S(x){o.value.delete(x),t.value.delete(x),a.value.delete(x),m.value.delete(x),o.value=new Map(o.value),t.value=new Map(t.value),a.value=new Map(a.value),m.value=new Map(m.value)}return{commsByLegion:o,minionsByLegion:t,hordesByLegion:a,channelsByLegion:m,currentLegionId:r,currentComms:l,currentMinions:d,currentHordes:_,currentChannels:i,setCurrentLegion:v,loadTimeline:u,addComm:w,sendComm:f,loadMinions:$,createMinion:j,loadHordes:y,loadChannels:b,clearLegionData:S}}),Ka=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:Ce},Symbol.toStringTag,{value:"Module"})),Ya={class:"timeline-header border-bottom p-3"},Qa={class:"project-name"},Za=["title"],Xa={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(o){const t=o,a=ae(),m=c(()=>a.projects.get(t.legionId)),r=c(()=>m.value?.name||"Legion");return(l,d)=>(s(),n("div",Ya,[e("div",null,[e("div",Qa,g(r.value),1),e("div",{class:"view-name",title:o.legionId},"Timeline",8,Za)])]))}},er=B(Xa,[["__scopeId","data-v-44f386f5"]]),tr={class:"timeline-status-bar border-top p-2 bg-light"},sr={class:"d-flex justify-content-end"},or={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(o){const t=se();function a(){t.setAutoScroll(!t.autoScrollEnabled)}return(m,r)=>(s(),n("div",tr,[e("div",sr,[e("button",{class:z(["btn btn-sm",we(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:a}," â¬‡ï¸ "+g(we(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},nr=B(or,[["__scopeId","data-v-891c73db"]]),lr={class:"comm-composer border-top p-3"},ar={class:"d-flex gap-2 mb-2"},rr={class:"flex-grow-1"},ir=["disabled"],cr={label:"Minions"},dr=["value"],ur={key:0,label:"Channels"},mr=["value"],pr={style:{"min-width":"150px"}},vr=["disabled"],fr={class:"d-flex gap-2 align-items-end position-relative"},gr={class:"flex-grow-1 position-relative"},_r=["disabled"],hr=["onClick","onMouseenter"],br=["disabled"],yr={key:0},$r={key:1},wr={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(o){const t=o,a=Ce(),m=J(),r=ae(),l=I(""),d=I("task"),_=I(""),i=I(!1),v=I(!1),u=I([]),w=I(0),f=I(-1),$=I(null),j=I(null),y=c(()=>{const E=r.projects.get(t.legionId);return!E||!E.session_ids?[]:E.session_ids.map(C=>m.sessions.get(C)).filter(C=>C&&C.is_minion)}),b=c(()=>a.currentChannels||[]),S=c(()=>l.value&&_.value.trim().length>0);function x(E){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[E.state]||"â—‹"}function h(E){return E.is_minion&&E.role?`${E.name} (${E.role})`:E.name}function p(){const E=$.value;if(!E)return;E.style.height="auto";const C=Math.min(E.scrollHeight,parseInt(getComputedStyle(E).maxHeight));E.style.height=C+"px"}function R(){const E=$.value;if(!E)return;p();const C=_.value,k=E.selectionStart,L=C.substring(0,k),O=L.lastIndexOf("#");if(O===-1){v.value=!1;return}const A=L.substring(O+1).toLowerCase();if(A.includes(" ")){v.value=!1;return}const P=y.value.filter(N=>N.name.toLowerCase().includes(A)).map(N=>({type:"minion",name:N.name,role:N.role,id:N.session_id,state:N.state}));if(P.length===0){v.value=!1;return}u.value=P,w.value=0,f.value=O,v.value=!0}function U(){if(!j.value)return;const E=j.value,C=E.children[w.value];if(!C)return;const k=C.offsetTop,L=C.offsetHeight,O=E.scrollTop,A=E.clientHeight;k<O?E.scrollTop=k:k+L>O+A&&(E.scrollTop=k+L-A)}function M(E){if(!v.value){E.key==="Enter"&&!E.shiftKey&&S.value&&(E.preventDefault(),H());return}if(E.key==="ArrowDown")E.preventDefault(),w.value=(w.value+1)%u.value.length,U();else if(E.key==="ArrowUp")E.preventDefault(),w.value=w.value===0?u.value.length-1:w.value-1,U();else if(E.key==="Enter"){E.preventDefault();const C=u.value[w.value];C&&T(C)}else E.key==="Escape"&&(v.value=!1)}function T(E){const C=$.value;if(!C)return;const k=_.value,L=C.selectionStart,O=k.substring(0,f.value)+"#"+E.name+" "+k.substring(L);_.value=O;const A=f.value+E.name.length+2;setTimeout(()=>{C.setSelectionRange(A,A),C.focus()},0),v.value=!1}async function H(){if(!(!S.value||i.value)){i.value=!0;try{const[E,C]=l.value.split(":"),k={comm_type:d.value,content:_.value.trim()};E==="minion"?k.to_minion_id=C:E==="channel"&&(k.to_channel_id=C),await a.sendComm(t.legionId,k),_.value="",p()}catch(E){console.error("Failed to send comm:",E),alert(`Failed to send comm: ${E.message}`)}finally{i.value=!1}}}return ee(v,E=>{if(E){const C=k=>{k.target.closest(".comm-composer")||(v.value=!1,document.removeEventListener("click",C))};setTimeout(()=>document.addEventListener("click",C),0)}}),(E,C)=>(s(),n("div",lr,[e("div",ar,[e("div",rr,[Y(e("select",{"onUpdate:modelValue":C[0]||(C[0]=k=>l.value=k),class:"form-select form-select-sm",disabled:i.value},[C[3]||(C[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",cr,[(s(!0),n(Z,null,X(y.value,k=>(s(),n("option",{key:k.session_id,value:`minion:${k.session_id}`},g(x(k))+" "+g(h(k)),9,dr))),128))]),b.value.length>0?(s(),n("optgroup",ur,[(s(!0),n(Z,null,X(b.value,k=>(s(),n("option",{key:k.channel_id,value:`channel:${k.channel_id}`}," #ï¸âƒ£ "+g(k.name),9,mr))),128))])):D("",!0)],8,ir),[[ge,l.value]])]),e("div",pr,[Y(e("select",{"onUpdate:modelValue":C[1]||(C[1]=k=>d.value=k),class:"form-select form-select-sm",disabled:i.value},[...C[4]||(C[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,vr),[[ge,d.value]])])]),e("div",fr,[e("div",gr,[Y(e("textarea",{ref_key:"contentTextarea",ref:$,"onUpdate:modelValue":C[2]||(C[2]=k=>_.value=k),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:i.value,onInput:R,onKeydown:M},null,40,_r),[[ne,_.value]]),v.value?(s(),n("div",{key:0,ref_key:"autocompleteDropdown",ref:j,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(s(!0),n(Z,null,X(u.value,(k,L)=>(s(),n("div",{key:k.id,class:z(["autocomplete-item px-2 py-1",{"bg-light":L===w.value}]),onClick:O=>T(k),onMouseenter:O=>w.value=L},g(k.type==="minion"?x(k):"#ï¸âƒ£")+" "+g(k.name)+g(k.role?` (${k.role})`:""),43,hr))),128))],512)):D("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!S.value||i.value,onClick:H},[i.value?(s(),n("span",yr,[...C[5]||(C[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),G(" Sending... ",-1)])])):(s(),n("span",$r,"Send"))],8,br)])])]))}},Sr=B(wr,[["__scopeId","data-v-ffa54193"]]),kr={class:"timeline-view d-flex flex-column h-100"},Cr={key:0,class:"text-center text-muted"},xr={key:1,class:"text-center text-danger"},Mr={key:2,class:"text-center text-muted"},jr={key:3,class:"comm-list"},Tr={class:"col-auto message-speaker text-end pe-3"},Er={class:"text-muted"},Lr={class:"col message-content-column"},Pr={class:"comm-card card"},Ir={class:"card-body p-2"},Dr={class:"d-flex justify-content-between align-items-start mb-1"},Or={class:"ms-2"},Nr={class:"comm-content"},Ar={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(o){const t=o,a=Ce(),m=ae(),r=J(),l=pe(),d=se(),_=I(!0),i=I(null),v=I(null),u=c(()=>m.projects.get(t.legionId));c(()=>u.value?.name||"Legion");const w=c(()=>a.currentComms);c(()=>a.currentMinions);function f(p){return p.from_user?"You":p.from_minion_id&&r.sessions.get(p.from_minion_id)?.name||"Unknown"}function $(p){return p.to_user?"You":p.to_minion_id?r.sessions.get(p.to_minion_id)?.name||"Unknown":p.to_channel_id?`#${p.to_channel_id}`:"All"}function j(p){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[p]||"bg-secondary"}function y(p){return new Date(p).toLocaleTimeString()}async function b(){d.autoScrollEnabled&&(await Te(),v.value&&(v.value.scrollTop=v.value.scrollHeight))}async function S(){_.value=!0,i.value=null;try{a.setCurrentLegion(t.legionId),await Promise.all([a.loadTimeline(t.legionId),a.loadMinions(t.legionId)]),await Te(),await b(),setTimeout(()=>{b()},100)}catch(p){console.error("Failed to load timeline:",p),p.response?i.value=`${p.message} (${p.response.status})`:i.value=p.message||"Unknown error"}finally{_.value=!1}}function x(){l.connectLegion(t.legionId)}function h(){l.disconnectLegion()}return ee(()=>w.value.length,()=>{b()}),le(()=>{S(),x(),setTimeout(()=>{b()},100)}),ce(()=>{h()}),(p,R)=>(s(),n("div",kr,[Q(er,{"legion-id":o.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:v,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[_.value?(s(),n("div",Cr,[...R[0]||(R[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),G(" Loading timeline... ",-1)])])):i.value?(s(),n("div",xr," Failed to load timeline: "+g(i.value),1)):w.value.length===0?(s(),n("div",Mr," No messages yet. Minions will appear here once they start communicating. ")):(s(),n("div",jr,[(s(!0),n(Z,null,X(w.value,U=>(s(),n("div",{key:U.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",Tr,[e("small",Er,g(y(U.timestamp)),1)]),e("div",Lr,[e("div",Pr,[e("div",Ir,[e("div",Dr,[e("div",null,[e("span",{class:z(["badge",j(U.comm_type)])},g(U.comm_type),3),e("strong",Or,g(f(U)),1),R[1]||(R[1]=e("span",{class:"text-muted mx-1"},"â†’",-1)),e("strong",null,g($(U)),1)])]),e("div",Nr,g(U.content),1)])])])]))),128))]))],512),Q(Sr,{"legion-id":o.legionId},null,8,["legion-id"]),Q(nr,{"legion-id":o.legionId},null,8,["legion-id"])]))}},Rr=B(Ar,[["__scopeId","data-v-d4c7422e"]]),Ur={class:"spy-view d-flex flex-column overflow-hidden"},qr={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(o){return(t,a)=>(s(),n("div",Ur,[Q(We,{"session-id":o.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},Wr=B(qr,[["__scopeId","data-v-43a24eaf"]]),Hr={class:"horde-header border-bottom p-3"},Fr={class:"project-name"},Br={__name:"HordeHeader",props:{legionId:{type:String,required:!0}},setup(o){const t=o,a=ae(),m=c(()=>a.projects.get(t.legionId)),r=c(()=>m.value?.name||"Legion");return(l,d)=>(s(),n("div",Hr,[e("div",null,[e("div",Fr,g(r.value),1),d[0]||(d[0]=e("div",{class:"view-name"},"Minion Hierarchy",-1))])]))}},Vr=B(Br,[["__scopeId","data-v-0c86e2b5"]]),zr={class:"horde-status-bar border-top p-2 bg-light"},Gr={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0}},setup(o){return(t,a)=>(s(),n("div",zr,[...a[0]||(a[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},Jr=B(Gr,[["__scopeId","data-v-f0e64ab0"]]),Kr={class:"minion-card border-start border-2 mb-2"},Yr={class:"node-row"},Qr={class:"node-left"},Zr={key:0,class:"me-2"},Xr={key:1,class:"badge bg-secondary ms-2"},ei={class:"node-right"},ti={key:0,class:"last-comm-preview"},si={class:"comm-direction"},oi=["title"],ni={key:1,class:"text-muted fst-italic small"},li={key:0,class:"minion-children"},ai={key:1,class:"text-danger small ms-4"},ri={__name:"MinionTreeNode",props:{minionData:{type:Object,required:!0},level:{type:Number,default:0}},setup(o){const t=o,a=c(()=>t.level*24),m=c(()=>t.minionData&&t.minionData.children&&t.minionData.children.length>0),r=c(()=>t.minionData&&t.minionData.is_overseer&&m.value),l=c(()=>t.minionData?t.minionData.state==="paused"&&t.minionData.is_processing?"pending-prompt":t.minionData.is_processing?"processing":t.minionData.state||"created":"created"),d=c(()=>{const u=l.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[u]||"status-dot-grey"}),_=c(()=>{const u=l.value;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[u]||"#d3d3d3"}});function i(u){return u.to_user?"User":u.to_minion_name?u.to_minion_name:u.to_channel_name?`#${u.to_channel_name}`:"unknown"}function v(u){const w=u.summary||u.content||"";return w.length>150?w.substring(0,150)+"...":w}return(u,w)=>{const f=qe("MinionTreeNode",!0);return o.minionData?(s(),n("div",{key:0,class:"minion-tree-node",style:me({marginLeft:`${a.value}px`})},[e("div",Kr,[e("div",Yr,[e("div",Qr,[e("div",{class:z(["status-dot me-2",d.value]),style:me(_.value)},null,6),r.value?(s(),n("span",Zr,"ðŸ‘‘")):D("",!0),e("strong",null,g(o.minionData.name),1),r.value?(s(),n("span",Xr,g(o.minionData.children.length)+" "+g(o.minionData.children.length===1?"child":"children"),1)):D("",!0)]),e("div",ei,[o.minionData.last_comm?(s(),n("div",ti,[e("span",si,[w[0]||(w[0]=G(" â†’ ",-1)),e("strong",null,g(i(o.minionData.last_comm)),1),w[1]||(w[1]=G(": ",-1))]),e("span",{class:"comm-content",title:o.minionData.last_comm.content||""},g(v(o.minionData.last_comm)),9,oi)])):(s(),n("div",ni," No communications yet "))])])]),m.value?(s(),n("div",li,[(s(!0),n(Z,null,X(o.minionData.children,$=>(s(),de(f,{key:$.id,"minion-data":$,level:o.level+1},null,8,["minion-data","level"]))),128))])):D("",!0)],4)):(s(),n("div",ai," âš  Minion data is missing "))}}},ii=B(ri,[["__scopeId","data-v-1cd9863f"]]),ci={class:"horde-view d-flex flex-column h-100"},di={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},ui={key:0,class:"text-center py-5"},mi={key:1,class:"alert alert-danger"},pi={class:"mb-0"},vi={key:2,class:"horde-tree"},fi={class:"user-root-node mb-3 border rounded bg-white"},gi={class:"node-row"},_i={class:"node-left"},hi={key:0,class:"badge bg-primary ms-2"},bi={class:"node-right"},yi={key:0,class:"last-comm-preview"},$i={class:"comm-direction"},wi=["title"],Si={key:1,class:"text-muted fst-italic"},ki={key:0,class:"alert alert-info ms-4"},Ci={key:1,class:"root-minions ms-4"},xi={__name:"HordeView",props:{legionId:{type:String,required:!0}},setup(o){const t=o,a=ae(),m=J(),r=pe(),l=Ce(),d=I(null),_=I(!1),i=I(null);c(()=>a.projects.get(t.legionId));const v=c(()=>d.value&&d.value.children&&d.value.children.length>0);async function u(){_.value=!0,i.value=null;try{const y=await K.get(`/api/legions/${t.legionId}/hordes`);d.value=y,console.log("Loaded hierarchy:",y)}catch(y){console.error("Failed to load hierarchy:",y),i.value=y.message||"Unknown error"}finally{_.value=!1}}le(()=>{u()}),ee(()=>t.legionId,()=>{u()});function w(y){return y.to_user?"User":y.to_minion_name?y.to_minion_name:y.to_channel_name?`#${y.to_channel_name}`:"unknown"}function f(y){const b=y.summary||y.content||"";return b.length>150?b.substring(0,150)+"...":b}function $(y,b){if(y.id===b)return y;if(y.children)for(const S of y.children){const x=$(S,b);if(x)return x}return null}function j(y){if(d.value){if(y.from_minion_id){const b=$(d.value,y.from_minion_id);b&&b.type==="minion"&&(b.last_comm=y,console.log(`Updated minion ${b.name} last_comm`))}y.from_user&&d.value.type==="user"&&(d.value.last_comm=y,console.log("Updated user last_comm"))}}return le(()=>{u(),l.setCurrentLegion(t.legionId),r.connectLegion(t.legionId),ee(()=>m.sessions,y=>{if(d.value){for(const[b,S]of y)if(S.is_minion&&S.project_id===t.legionId){const x=$(d.value,b);x&&x.type==="minion"&&(x.state!==S.state&&(x.state=S.state,console.log(`Updated minion ${x.name} state to ${S.state}`)),x.is_processing!==S.is_processing&&(x.is_processing=S.is_processing,console.log(`Updated minion ${x.name} is_processing to ${S.is_processing}`)))}}},{deep:!0}),ee(()=>l.commsByLegion.get(t.legionId),y=>{if(y&&y.length>0){const b=y[y.length-1];j(b)}},{deep:!0}),ee(()=>m.sessions.size,(y,b)=>{y>b&&Array.from(m.sessions.values()).some(h=>h.is_minion&&h.project_id===t.legionId&&!$(d.value,h.session_id))&&(console.log("New minion detected, reloading hierarchy"),u())})}),ce(()=>{console.log("HordeView unmounted")}),(y,b)=>(s(),n("div",ci,[Q(Vr,{"legion-id":o.legionId},null,8,["legion-id"]),e("div",di,[_.value?(s(),n("div",ui,[...b[0]||(b[0]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"text-muted mt-2"},"Loading hierarchy...",-1)])])):i.value?(s(),n("div",mi,[b[1]||(b[1]=e("strong",null,"Failed to load hierarchy",-1)),e("p",pi,g(i.value),1)])):d.value?(s(),n("div",vi,[e("div",fi,[e("div",gi,[e("div",_i,[b[2]||(b[2]=e("span",{class:"me-2",style:{"font-size":"1.2rem"}},"ðŸ‘¤",-1)),e("strong",null,g(d.value.name),1),v.value?(s(),n("span",hi,g(d.value.children.length)+" "+g(d.value.children.length===1?"minion":"minions"),1)):D("",!0)]),e("div",bi,[d.value.last_comm?(s(),n("div",yi,[e("span",$i,[b[3]||(b[3]=G(" â†’ ",-1)),e("strong",null,g(w(d.value.last_comm)),1),b[4]||(b[4]=G(": ",-1))]),e("span",{class:"comm-content",title:d.value.last_comm.content||""},g(f(d.value.last_comm)),9,wi)])):(s(),n("div",Si," No communications yet "))])])]),v.value?(s(),n("div",Ci,[(s(!0),n(Z,null,X(d.value.children,S=>(s(),de(ii,{key:S.id,"minion-data":S,level:1},null,8,["minion-data"]))),128))])):(s(),n("div",ki,[...b[5]||(b[5]=[e("p",{class:"mb-2"},"No minions yet",-1),e("small",{class:"text-muted"},"Create a minion to get started",-1)])]))])):D("",!0)]),Q(Jr,{"legion-id":o.legionId},null,8,["legion-id"])]))}},Mi=B(xi,[["__scopeId","data-v-af6338a3"]]),ji=[{path:"/",name:"home",component:Ke},{path:"/session/:sessionId",name:"session",component:We,props:!0},{path:"/timeline/:legionId",name:"timeline",component:Rr,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:Wr,props:!0},{path:"/horde/:legionId",name:"horde",component:Mi,props:!0}],Ti=Fe({history:Be(),routes:ji}),Ei={__name:"ConnectionIndicator",setup(o){const t=pe(),a=c(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),m=c(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(r,l)=>(s(),n("span",{id:"connection-indicator",class:z(["badge",a.value])},g(m.value),3))}},Li={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},Pi={class:"d-flex align-items-center gap-2"},Ii={__name:"AppHeader",setup(o){const t=se();function a(){t.toggleSidebar()}return(m,r)=>(s(),n("header",Li,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:a},[...r[0]||(r[0]=[e("span",null,"â˜°",-1)])]),r[1]||(r[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",Pi,[Q(Ei)])]))}},Di={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},Oi={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},Ni=["title"],Ai={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(o){const t=o,a=c(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function m(_){return _.state==="paused"&&_.is_processing?"pending-prompt":_.is_processing?"processing":_.state}function r(_){const i=m(_);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[i]||"#d3d3d3"}function l(_){const i=m(_);return i==="starting"||i==="processing"||i==="pending-prompt"}function d(_){const i=m(_),v=i.charAt(0).toUpperCase()+i.slice(1),u=_.name||"Unnamed Session",w=_.is_minion&&_.role?` (${_.role})`:"";return`${u}${w}: ${v}`}return(_,i)=>(s(),n("div",Di,[!o.sessions||o.sessions.length===0?(s(),n("div",Oi)):(s(!0),n(Z,{key:1},X(o.sessions,v=>(s(),n("div",{key:v.session_id,class:z(["progress-bar",{"progress-bar-striped progress-bar-animated":l(v)}]),style:me({width:a.value,backgroundColor:r(v),cursor:"help"}),title:d(v)},null,14,Ni))),128))]))}},Ri=B(Ai,[["__scopeId","data-v-a79cfeec"]]),Ui={class:"flex-grow-1"},qi={key:0,class:"text-muted small ms-1"},Wi={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(o){const t=o,a=fe(),m=J(),r=ae(),l=se(),d=c(()=>m.currentSessionId===t.session.session_id),_=c(()=>m.deletingSessions.has(t.session.session_id)),i=c(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),v=c(()=>{const S=i.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[S]||"status-dot-grey"}),u=c(()=>{const S=i.value,x={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},h={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:x[S]||"#d3d3d3",borderColor:h[S]||"#6c757d"}});function w(){m.selectSession(t.session.session_id),a.push(`/session/${t.session.session_id}`)}function f(){l.showModal("edit-session",{session:t.session})}function $(S){S.dataTransfer.effectAllowed="move",S.dataTransfer.setData("application/session-id",t.session.session_id),S.dataTransfer.setData("application/project-id",t.projectId),S.dataTransfer.setData("text/plain",t.session.session_id),S.target.classList.add("dragging")}function j(S){S.target.classList.remove("dragging")}function y(S){S.preventDefault(),S.dataTransfer.dropEffect="move";const x=S.currentTarget.getBoundingClientRect(),h=x.top+x.height/2;S.clientY<h?(S.currentTarget.classList.add("drop-above"),S.currentTarget.classList.remove("drop-below")):(S.currentTarget.classList.add("drop-below"),S.currentTarget.classList.remove("drop-above"))}function b(S){S.preventDefault(),S.currentTarget.classList.remove("drop-above","drop-below");const x=S.dataTransfer.getData("application/session-id")||S.dataTransfer.getData("text/plain"),h=S.dataTransfer.getData("application/project-id");if(!x||x===t.session.session_id||h!==t.projectId)return;const p=S.currentTarget.getBoundingClientRect(),R=p.top+p.height/2,U=S.clientY<R,M=r.getProject(t.projectId);if(!M||!M.session_ids)return;const T=[...M.session_ids],H=T.indexOf(t.session.session_id),E=T.indexOf(x);if(H===-1||E===-1)return;const C=[...T],[k]=C.splice(E,1);let L=U?H:H+1;E<H&&L--,C.splice(L,0,k),r.reorderSessionsInProject(t.projectId,C)}return(S,x)=>(s(),n("div",{class:z(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:d.value,"session-deleting":_.value}]),style:{cursor:"pointer"},draggable:"true",onClick:w,onDragstart:$,onDragend:j,onDragover:y,onDrop:b},[e("div",{class:z(["status-dot me-2",v.value]),style:me(u.value)},null,6),e("div",Ui,[e("span",null,g(o.session.name||o.session.session_id),1),o.session.is_minion&&o.session.role?(s(),n("span",qi,"("+g(o.session.role)+")",1)):D("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:ie(f,["stop"])}," âœï¸ ")],34))}},Hi=B(Wi,[["__scopeId","data-v-07ecbf94"]]),Fi={class:"d-flex align-items-center gap-2"},Bi=["value"],Vi={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(o){const t=o,a=fe(),m=J(),r=se(),l=I("");ee(()=>a.currentRoute.value,y=>{!l.value&&y.name==="spy"&&y.params.minionId&&y.params.legionId===t.project.project_id&&(l.value=y.params.minionId)},{immediate:!0});const d=c(()=>l.value?t.sessions.find(y=>y.session_id===l.value):null),_=c(()=>{const y=a.currentRoute.value;return y.name==="spy"&&y.params.legionId===t.project.project_id}),i=c(()=>{if(!d.value)return"";if(d.value.state==="paused"&&d.value.is_processing)return"status-blinking";const y=d.value.is_processing?"processing":d.value.state;return y==="starting"||y==="processing"?"status-blinking":""}),v=c(()=>{if(!d.value)return{};if(d.value.state==="paused"&&d.value.is_processing)return{backgroundColor:"#ffc107"};const y=d.value.is_processing?"processing":d.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[y]||"#d3d3d3"}});function u(y){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[y.state]||"â—‹"}function w(y){return y.is_minion&&y.role?`${y.name} (${y.role})`:y.name}function f(){l.value&&a.push(`/spy/${t.project.project_id}/${l.value}`)}function $(){l.value?a.push(`/spy/${t.project.project_id}/${l.value}`):a.push("/")}function j(){d.value&&r.showModal("minion-view",{session:d.value})}return ee(()=>m.currentSessionId,y=>{if(y)t.sessions.some(b=>b.session_id===y)&&(l.value=y);else{l.value="";const b=a.currentRoute.value;b.name==="spy"&&b.params.legionId===t.project.project_id&&a.push("/")}}),(y,b)=>(s(),n("div",{class:z(["list-group-item list-group-item-action p-2",{active:_.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:me({cursor:l.value?"pointer":"default"}),onClick:f},[b[1]||(b[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ”"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),e("div",Fi,[d.value?(s(),n("button",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:ie(j,["stop"]),title:"View minion details"}," ðŸ‘ï¸ ")):D("",!0),d.value?(s(),n("span",{key:1,class:z(["minion-state-indicator",i.value]),style:me(v.value)}," ðŸ‘¤ ",6)):D("",!0)])],4),Y(e("select",{"onUpdate:modelValue":b[0]||(b[0]=S=>l.value=S),class:"form-select form-select-sm",onChange:$},[b[2]||(b[2]=e("option",{value:""},"-- Select Minion --",-1)),(s(!0),n(Z,null,X(o.sessions,S=>(s(),n("option",{key:S.session_id,value:S.session_id},g(u(S))+" "+g(w(S)),9,Bi))),128))],544),[[ge,l.value]])],2))}},zi=B(Vi,[["__scopeId","data-v-579589fb"]]),Gi=["data-project-id"],Ji=["id"],Ki=["aria-expanded","aria-controls","onKeydown"],Yi={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},Qi={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},Zi={class:"fw-semibold",style:{"flex-shrink":"0"}},Xi={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},ec={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},tc=["title"],sc=["title"],oc=["id","aria-labelledby"],nc={class:"accordion-body p-0"},lc={class:"list-group list-group-flush"},ac={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(o){const t=o,a=fe(),m=ae(),r=J(),l=se(),d=I(t.project.is_expanded||!1),_=c(()=>m.formatPath(t.project.working_directory)),i=c(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(U=>r.getSession(U)).filter(U=>U!=null)),v=c(()=>{const U=a.currentRoute.value;return U.name==="timeline"&&U.params.legionId===t.project.project_id}),u=c(()=>{const U=a.currentRoute.value;return U.name==="horde"&&U.params.legionId===t.project.project_id});function w(U){const M=window.bootstrap;if(!M)return;const T=document.getElementById(`collapse-${t.project.project_id}`);if(!T)return;M.Collapse.getOrCreateInstance(T).toggle()}function f(){d.value||(m.toggleExpansion(t.project.project_id),d.value=!0)}function $(){if(d.value){m.toggleExpansion(t.project.project_id),d.value=!1;const U=r.currentSessionId;U&&r.getSession(U)&&t.project.session_ids?.includes(U)&&a.push("/"),m.currentProjectId===t.project.project_id&&a.push("/")}}function j(){l.showModal("edit-project",{project:t.project})}function y(){t.project.is_multi_agent?l.showModal("create-minion",{project:t.project}):l.showModal("create-session",{project:t.project})}function b(){a.push(`/timeline/${t.project.project_id}`)}function S(){a.push(`/horde/${t.project.project_id}`)}function x(U){U.dataTransfer.effectAllowed="move",U.dataTransfer.setData("application/project-id",t.project.project_id),U.dataTransfer.setData("text/plain",t.project.project_id),U.target.classList.add("dragging")}function h(U){U.target.classList.remove("dragging")}function p(U){U.preventDefault(),U.dataTransfer.dropEffect="move";const M=U.currentTarget.getBoundingClientRect(),T=M.top+M.height/2;U.clientY<T?(U.currentTarget.classList.add("drop-above"),U.currentTarget.classList.remove("drop-below")):(U.currentTarget.classList.add("drop-below"),U.currentTarget.classList.remove("drop-above"))}function R(U){U.preventDefault(),U.currentTarget.classList.remove("drop-above","drop-below");const M=U.dataTransfer.getData("application/project-id")||U.dataTransfer.getData("text/plain");if(!M||M===t.project.project_id)return;const T=U.currentTarget.getBoundingClientRect(),H=T.top+T.height/2,E=U.clientY<H,C=m.orderedProjects,k=C.findIndex(W=>W.project_id===t.project.project_id),L=C.findIndex(W=>W.project_id===M);if(k===-1||L===-1)return;const O=[...C],[A]=O.splice(L,1);let P=E?k:k+1;L<k&&P--,O.splice(P,0,A);const N=O.map(W=>W.project_id);m.reorderProjects(N)}return(U,M)=>(s(),n("div",{class:"accordion-item border rounded mb-2","data-project-id":o.project.project_id,draggable:"true",onDragstart:x,onDragend:h,onDragover:p,onDrop:R},[e("h2",{class:"accordion-header",id:`heading-${o.project.project_id}`},[e("div",{class:z(["accordion-button bg-white p-2",{collapsed:!d.value}]),role:"button",tabindex:"0","aria-expanded":d.value,"aria-controls":`collapse-${o.project.project_id}`,onClick:w,onKeydown:[Se(ie(w,["prevent"]),["enter"]),Se(ie(w,["prevent"]),["space"])]},[e("div",Yi,[e("div",Qi,[e("div",Zi,[o.project.is_multi_agent?(s(),n("span",Xi,"ðŸ›")):D("",!0),G(" "+g(o.project.name),1)]),e("div",ec,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:ie(j,["stop"])}," âœï¸ "),e("button",{class:"btn btn-sm btn-outline-primary",title:o.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:ie(y,["stop"])}," âž• ",8,tc)])]),e("small",{class:"text-muted font-monospace",title:o.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},g(_.value),9,sc)])],42,Ki)],8,Ji),Q(Ri,{project:o.project,sessions:i.value},null,8,["project","sessions"]),e("div",{id:`collapse-${o.project.project_id}`,class:z(["accordion-collapse collapse",{show:d.value}]),"aria-labelledby":`heading-${o.project.project_id}`,onShown:f,onHidden:$},[e("div",nc,[e("div",lc,[o.project.is_multi_agent?(s(),n("div",{key:0,class:z(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:v.value}]),style:{cursor:"pointer"},onClick:b},[...M[0]||(M[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ“Š"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):D("",!0),o.project.is_multi_agent?(s(),n(Z,{key:1},[e("div",{class:z(["list-group-item list-group-item-action horde-item d-flex align-items-center p-2",{active:u.value}]),style:{cursor:"pointer"},onClick:S},[...M[1]||(M[1]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸŒ³"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],2),Q(zi,{project:o.project,sessions:i.value},null,8,["project","sessions"])],64)):(s(!0),n(Z,{key:2},X(i.value,T=>(s(),de(Hi,{key:T.session_id,session:T,"project-id":o.project.project_id},null,8,["session","project-id"]))),128))])])],42,oc)],40,Gi))}},rc=B(ac,[["__scopeId","data-v-f20750f9"]]),ic={class:"project-list"},cc={key:0,class:"text-muted text-center py-3"},dc={__name:"ProjectList",setup(o){const t=ae(),a=c(()=>t.orderedProjects);return(m,r)=>(s(),n("div",ic,[a.value.length===0?(s(),n("div",cc,' No projects yet. Click "New" to create one. ')):D("",!0),(s(!0),n(Z,null,X(a.value,l=>(s(),de(rc,{key:l.project_id,project:l},null,8,["project"]))),128))]))}},uc={class:"flex-grow-1 overflow-auto p-3"},mc={id:"sessions-container"},pc={__name:"Sidebar",setup(o){const t=se(),a=c(()=>t.sidebarCollapsed),m=c(()=>t.isMobile),r=c(()=>{if(m.value)return{};const u=`${t.sidebarWidth}px`;return{width:u,minWidth:"200px",maxWidth:"30vw","--sidebar-width":u}});function l(){t.showModal("create-project")}const d=I(!1);function _(u){d.value=!0,document.addEventListener("mousemove",i),document.addEventListener("mouseup",v)}function i(u){d.value&&t.setSidebarWidth(u.clientX)}function v(){d.value=!1,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",v)}return(u,w)=>(s(),n("aside",{id:"sidebar",class:z(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:a.value,"mobile-open":!a.value&&m.value,"desktop-collapsed":a.value&&!m.value}]),style:me(r.value)},[e("div",uc,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[w[0]||(w[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:l}," ðŸ“ New ")]),e("div",mc,[Q(dc)])]),e("div",{class:"sidebar-resize-handle",onMousedown:_},null,32)],6))}},vc=B(pc,[["__scopeId","data-v-d792f0f0"]]),fc={class:"modal-dialog modal-lg"},gc={class:"modal-content"},_c={class:"modal-body"},hc={class:"mb-3"},bc={class:"input-group"},yc=["disabled"],$c={key:0,class:"text-center py-4"},wc={key:1,class:"alert alert-danger",role:"alert"},Sc={key:2,class:"folder-list"},kc=["onClick","onDblclick"],Cc={class:"d-flex align-items-center flex-grow-1"},xc=["onClick"],Mc={key:1,class:"text-center text-muted py-3"},jc={class:"modal-footer"},Tc=["disabled"],Ec={__name:"FolderBrowserModal",setup(o){const t=se(),a=I(""),m=I(""),r=I([]),l=I(!1),d=I(""),_=I(null);let i=null,v=null;const u=c(()=>{if(!a.value)return null;const h=a.value.split(/[\\/]/).filter(Boolean);return h.length<=1?null:(h.pop(),h.length>0?h.join("/"):"/")});function w(h){if(!h)return"";const p=h.split(/[\\/]/).filter(Boolean);return p.length<=2?h:".../"+p.slice(-2).join("/")}async function f(){l.value=!0,d.value="",r.value=[],m.value="";try{const h=a.value?{path:a.value}:{},p=await K.get("/api/filesystem/browse",{params:h});p.current_path&&(a.value=p.current_path),r.value=p.directories||[]}catch(h){console.error("Failed to load directory:",h),d.value=h.message||"Failed to load directory"}finally{l.value=!1}}function $(h){m.value=h.path}function j(h){a.value=h.path,m.value="",f()}function y(){u.value&&(a.value=u.value,m.value="",f())}function b(){const h=m.value||a.value;h&&v&&v(h),i&&i.hide()}function S(){f()}function x(){r.value=[],m.value="",d.value="",v=null,t.hideModal()}return ee(()=>t.currentModal,h=>{if(h?.name==="folder-browser"&&i){const p=h.data||{};a.value=p.currentPath||"",v=p.onSelect||null,i.show()}}),le(()=>{_.value&&re(async()=>{const{default:h}=await import("./modal-B4rHLo2F.js").then(p=>p.m);return{default:h}},__vite__mapDeps([0,1])).then(({default:h})=>{i=new h(_.value),_.value.addEventListener("shown.bs.modal",S),_.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{_.value&&(_.value.removeEventListener("shown.bs.modal",S),_.value.removeEventListener("hidden.bs.modal",x)),i&&i.dispose()}),(h,p)=>(s(),n("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:_},[e("div",fc,[e("div",gc,[p[7]||(p[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",_c,[e("div",hc,[p[2]||(p[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",bc,[Y(e("input",{type:"text",class:"form-control","onUpdate:modelValue":p[0]||(p[0]=R=>a.value=R),onKeyup:Se(f,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[ne,a.value]]),e("button",{class:"btn btn-outline-secondary",onClick:f,disabled:l.value},[...p[1]||(p[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),G(" Refresh ",-1)])],8,yc)])]),l.value?(s(),n("div",$c,[...p[3]||(p[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):d.value?(s(),n("div",wc,g(d.value),1)):(s(),n("div",Sc,[u.value?(s(),n("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:y,role:"button"},[...p[4]||(p[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):D("",!0),(s(!0),n(Z,null,X(r.value,R=>(s(),n("div",{key:R.path,class:z(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:R.path===m.value}]),onClick:U=>$(R),onDblclick:U=>j(R),role:"button"},[e("div",Cc,[p[5]||(p[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,g(R.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:ie(U=>j(R),["stop"])}," Open ",8,xc)],42,kc))),128)),r.value.length===0?(s(),n("div",Mc," No subdirectories found ")):D("",!0)]))]),e("div",jc,[p[6]||(p[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:b,disabled:!m.value},' Select "'+g(w(m.value||a.value))+'" ',9,Tc)])])])],512))}},Lc=B(Ec,[["__scopeId","data-v-667c51a9"]]),Pc={class:"modal-dialog"},Ic={class:"modal-content"},Dc={class:"modal-body"},Oc={class:"mb-3"},Nc={key:0,class:"invalid-feedback"},Ac={class:"mb-3"},Rc={class:"input-group"},Uc={key:0,class:"invalid-feedback"},qc={class:"mb-3 form-check"},Wc={class:"mb-3 form-check"},Hc={class:"form-check-label",for:"createSession"},Fc={key:0,class:"mb-3 ms-4"},Bc={for:"sessionName",class:"form-label"},Vc={key:1,class:"alert alert-danger",role:"alert"},zc={class:"modal-footer"},Gc=["disabled"],Jc={key:0,class:"spinner-border spinner-border-sm me-2"},Kc={__name:"ProjectCreateModal",setup(o){const t=ae(),a=J(),m=se(),r=I({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),l=I({name:"",workingDirectory:""}),d=I(!1),_=I(""),i=I(null);let v=null;function u(){m.showModal("folder-browser",{currentPath:r.value.workingDirectory||"",onSelect:b=>{r.value.workingDirectory=b,l.value.workingDirectory=""}})}function w(){l.value={};let b=!0;return r.value.name.trim()||(l.value.name="Project name is required",b=!1),r.value.workingDirectory.trim()||(l.value.workingDirectory="Working directory is required",b=!1),b}async function f(){if(w()){d.value=!0,_.value="";try{const b=await t.createProject(r.value.name,r.value.workingDirectory,r.value.isMultiAgent);r.value.createSession&&await a.createSession(b.project_id,{name:r.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),v&&v.hide(),$()}catch(b){console.error("Failed to create project:",b),_.value=b.message||"Failed to create project. Please try again."}finally{d.value=!1}}}function $(){r.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},l.value={},_.value=""}function j(){const b=document.getElementById("projectName");b&&b.focus()}function y(){$(),m.hideModal()}return ee(()=>m.currentModal,b=>{b?.name==="create-project"&&v&&v.show()}),le(()=>{i.value&&re(async()=>{const{default:b}=await import("./modal-B4rHLo2F.js").then(S=>S.m);return{default:b}},__vite__mapDeps([0,1])).then(({default:b})=>{v=new b(i.value),i.value.addEventListener("shown.bs.modal",j),i.value.addEventListener("hidden.bs.modal",y)})}),ce(()=>{i.value&&(i.value.removeEventListener("shown.bs.modal",j),i.value.removeEventListener("hidden.bs.modal",y)),v&&v.dispose()}),(b,S)=>(s(),n("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",Pc,[e("div",Ic,[S[11]||(S[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Dc,[e("form",{onSubmit:ie(f,["prevent"])},[e("div",Oc,[S[5]||(S[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),Y(e("input",{type:"text",class:z(["form-control",{"is-invalid":l.value.name}]),id:"projectName","onUpdate:modelValue":S[0]||(S[0]=x=>r.value.name=x),placeholder:"My Project",required:""},null,2),[[ne,r.value.name]]),l.value.name?(s(),n("div",Nc,g(l.value.name),1)):D("",!0)]),e("div",Ac,[S[6]||(S[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",Rc,[Y(e("input",{type:"text",class:z(["form-control",{"is-invalid":l.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":S[1]||(S[1]=x=>r.value.workingDirectory=x),placeholder:"/path/to/project",required:""},null,2),[[ne,r.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:u}," Browse... "),l.value.workingDirectory?(s(),n("div",Uc,g(l.value.workingDirectory),1)):D("",!0)]),S[7]||(S[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",qc,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":S[2]||(S[2]=x=>r.value.isMultiAgent=x)},null,512),[[he,r.value.isMultiAgent]]),S[8]||(S[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," ðŸ› Multi-Agent Project (Legion) ",-1)),S[9]||(S[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",Wc,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":S[3]||(S[3]=x=>r.value.createSession=x)},null,512),[[he,r.value.createSession]]),e("label",Hc," Create initial "+g(r.value.isMultiAgent?"minion":"session"),1)]),r.value.createSession?(s(),n("div",Fc,[e("label",Bc," Initial "+g(r.value.isMultiAgent?"Minion":"Session")+" Name ",1),Y(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":S[4]||(S[4]=x=>r.value.sessionName=x),placeholder:"main"},null,512),[[ne,r.value.sessionName]])])):D("",!0),_.value?(s(),n("div",Vc,g(_.value),1)):D("",!0)],32)]),e("div",zc,[S[10]||(S[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:f,disabled:d.value},[d.value?(s(),n("span",Jc)):D("",!0),G(" "+g(d.value?"Creating...":"Create Project"),1)],8,Gc)])])])],512))}},Yc=B(Kc,[["__scopeId","data-v-adf50394"]]),Qc={class:"modal-dialog"},Zc={class:"modal-content"},Xc={class:"modal-body"},ed={class:"mb-3"},td={key:0,class:"invalid-feedback"},sd={class:"mb-3"},od=["value"],nd={key:0,class:"alert alert-danger",role:"alert"},ld={class:"danger-zone"},ad={class:"text-muted small"},rd=["disabled"],id={key:0,class:"alert alert-warning mt-3",role:"alert"},cd={class:"mb-2"},dd={class:"d-flex gap-2"},ud=["disabled"],md={key:0,class:"spinner-border spinner-border-sm me-2"},pd=["disabled"],vd={class:"modal-footer"},fd=["disabled"],gd={key:0,class:"spinner-border spinner-border-sm me-2"},_d={__name:"ProjectEditModal",setup(o){const t=ae(),a=se(),m=I(null),r=I({name:""}),l=I({name:""}),d=I(!1),_=I(!1),i=I(""),v=I(!1),u=I(null);let w=null;const f=c(()=>m.value?.session_ids?.length||0);function $(){l.value={};let h=!0;return r.value.name.trim()||(l.value.name="Project name is required",h=!1),h}async function j(){if(!(!$()||!m.value)){d.value=!0,i.value="";try{await t.updateProject(m.value.project_id,{name:r.value.name}),w&&w.hide()}catch(h){console.error("Failed to update project:",h),i.value=h.message||"Failed to update project. Please try again."}finally{d.value=!1}}}async function y(){if(m.value){_.value=!0,i.value="";try{await t.deleteProject(m.value.project_id),w&&w.hide()}catch(h){console.error("Failed to delete project:",h),i.value=h.message||"Failed to delete project. Please try again."}finally{_.value=!1}}}function b(){r.value={name:""},l.value={},i.value="",v.value=!1}function S(){const h=document.getElementById("editProjectName");h&&(h.focus(),h.select())}function x(){b(),m.value=null,a.hideModal()}return ee(()=>a.currentModal,h=>{if(h?.name==="edit-project"&&w){const p=h.data||{};m.value=p.project,m.value&&(r.value.name=m.value.name),w.show()}}),le(()=>{u.value&&re(async()=>{const{default:h}=await import("./modal-B4rHLo2F.js").then(p=>p.m);return{default:h}},__vite__mapDeps([0,1])).then(({default:h})=>{w=new h(u.value),u.value.addEventListener("shown.bs.modal",S),u.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{u.value&&(u.value.removeEventListener("shown.bs.modal",S),u.value.removeEventListener("hidden.bs.modal",x)),w&&w.dispose()}),(h,p)=>(s(),n("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:u},[e("div",Qc,[e("div",Zc,[p[11]||(p[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Xc,[e("form",{onSubmit:ie(j,["prevent"])},[e("div",ed,[p[3]||(p[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),Y(e("input",{type:"text",class:z(["form-control",{"is-invalid":l.value.name}]),id:"editProjectName","onUpdate:modelValue":p[0]||(p[0]=R=>r.value.name=R),placeholder:"My Project",required:""},null,2),[[ne,r.value.name]]),l.value.name?(s(),n("div",td,g(l.value.name),1)):D("",!0)]),e("div",sd,[p[4]||(p[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:m.value?.working_directory,disabled:"",readonly:""},null,8,od),p[5]||(p[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),i.value?(s(),n("div",nd,g(i.value),1)):D("",!0)],32),p[9]||(p[9]=e("hr",null,null,-1)),e("div",ld,[p[7]||(p[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",ad," Deleting this project will also delete all "+g(f.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:p[1]||(p[1]=R=>v.value=!0),disabled:_.value},[...p[6]||(p[6]=[e("i",{class:"bi bi-trash"},null,-1),G(" Delete Project ",-1)])],8,rd)]),v.value?(s(),n("div",id,[p[8]||(p[8]=e("strong",null,"Are you sure?",-1)),e("p",cd,' This will permanently delete the project "'+g(m.value?.name)+'" and all '+g(f.value)+" session(s). ",1),e("div",dd,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:y,disabled:_.value},[_.value?(s(),n("span",md)):D("",!0),G(" "+g(_.value?"Deleting...":"Yes, Delete Permanently"),1)],8,ud),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:p[2]||(p[2]=R=>v.value=!1),disabled:_.value}," Cancel ",8,pd)])])):D("",!0)]),e("div",vd,[p[10]||(p[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:j,disabled:d.value},[d.value?(s(),n("span",gd)):D("",!0),G(" "+g(d.value?"Saving...":"Save Changes"),1)],8,fd)])])])],512))}},hd=B(_d,[["__scopeId","data-v-6f299f35"]]),bd={class:"modal-dialog modal-lg"},yd={class:"modal-content"},$d={class:"modal-header"},wd={class:"modal-title",id:"createSessionModalLabel"},Sd={key:0,class:"text-muted small"},kd={class:"modal-body"},Cd={class:"mb-3"},xd={key:0,class:"invalid-feedback"},Md={class:"mb-3"},jd={class:"mb-3"},Td={class:"mb-3"},Ed={class:"form-text d-flex justify-content-between"},Ld={key:0,class:"invalid-feedback"},Pd={class:"mb-3 form-check"},Id={key:0,class:"form-text text-warning"},Dd={class:"mb-3"},Od={class:"mb-3 form-check"},Nd={key:0,class:"alert alert-danger",role:"alert"},Ad={class:"modal-footer"},Rd=["disabled"],Ud={key:0,class:"spinner-border spinner-border-sm me-2"},qd={__name:"SessionCreateModal",setup(o){const t=fe();ae();const a=J(),m=se(),r=I(null),l=I({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0}),d=I({name:""}),_=I(!1),i=I(""),v=I(null);let u=null;const w=c(()=>l.value.system_prompt.length),f=c(()=>w.value>6e3),$=c(()=>w.value>5500&&w.value<=6e3);function j(){d.value={};let h=!0;return l.value.name.trim()||(d.value.name="Session name is required",h=!1),f.value&&(h=!1),h}async function y(){if(!(!j()||!r.value)){_.value=!0,i.value="";try{const h=l.value.tools.split(",").map(U=>U.trim()).filter(U=>U.length>0),p={name:l.value.name,permission_mode:l.value.permission_mode,model:l.value.model,system_prompt:l.value.system_prompt.trim()||null,override_system_prompt:l.value.override_system_prompt,tools:h},R=await a.createSession(r.value.project_id,p);l.value.startImmediately&&await a.startSession(R.session_id),t.push(`/session/${R.session_id}`),u&&u.hide(),b()}catch(h){console.error("Failed to create session:",h),i.value=h.message||"Failed to create session. Please try again."}finally{_.value=!1}}}function b(){l.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0},d.value={},i.value=""}function S(){const h=document.getElementById("sessionName");h&&h.focus()}function x(){b(),r.value=null,m.hideModal()}return ee(()=>m.currentModal,h=>{if(h?.name==="create-session"&&u){const p=h.data||{};r.value=p.project,u.show()}}),le(()=>{v.value&&re(async()=>{const{default:h}=await import("./modal-B4rHLo2F.js").then(p=>p.m);return{default:h}},__vite__mapDeps([0,1])).then(({default:h})=>{u=new h(v.value),v.value.addEventListener("shown.bs.modal",S),v.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{v.value&&(v.value.removeEventListener("shown.bs.modal",S),v.value.removeEventListener("hidden.bs.modal",x)),u&&u.dispose()}),(h,p)=>(s(),n("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",bd,[e("div",yd,[e("div",$d,[e("h5",wd,[p[7]||(p[7]=G(" Create New Session ",-1)),r.value?(s(),n("span",Sd,"in "+g(r.value.name),1)):D("",!0)]),p[8]||(p[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",kd,[e("form",{onSubmit:ie(y,["prevent"])},[e("div",Cd,[p[9]||(p[9]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),Y(e("input",{type:"text",class:z(["form-control",{"is-invalid":d.value.name}]),id:"sessionName","onUpdate:modelValue":p[0]||(p[0]=R=>l.value.name=R),placeholder:"main",required:""},null,2),[[ne,l.value.name]]),d.value.name?(s(),n("div",xd,g(d.value.name),1)):D("",!0)]),e("div",Md,[p[11]||(p[11]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Y(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":p[1]||(p[1]=R=>l.value.permission_mode=R)},[...p[10]||(p[10]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"âš ï¸ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[ge,l.value.permission_mode]]),p[12]||(p[12]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",jd,[p[14]||(p[14]=e("label",{for:"model",class:"form-label"},"Model",-1)),Y(e("select",{class:"form-select",id:"model","onUpdate:modelValue":p[2]||(p[2]=R=>l.value.model=R)},[...p[13]||(p[13]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[ge,l.value.model]])]),e("div",Td,[p[15]||(p[15]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),Y(e("textarea",{class:z(["form-control",{"is-invalid":f.value}]),id:"systemPrompt","onUpdate:modelValue":p[3]||(p[3]=R=>l.value.system_prompt=R),rows:"3",maxlength:6e3,placeholder:"Additional instructions to append to the system prompt..."},null,2),[[ne,l.value.system_prompt]]),e("div",Ed,[e("span",null,g(l.value.override_system_prompt?"These instructions will replace Claude Code's default system prompt":"These instructions will be appended to Claude Code's default system prompt"),1),e("span",{class:z({"text-danger":f.value,"text-warning":$.value})},g(w.value)+" / 6000 chars ",3)]),f.value?(s(),n("div",Ld," System prompt exceeds 6000 character limit (Windows command-line constraint) ")):D("",!0)]),e("div",Pd,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":p[4]||(p[4]=R=>l.value.override_system_prompt=R)},null,512),[[he,l.value.override_system_prompt]]),p[17]||(p[17]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom prompt only) ",-1)),l.value.override_system_prompt?(s(),n("div",Id,[...p[16]||(p[16]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom instructions will be used (no Claude Code preset).",-1)])])):D("",!0)]),e("div",Dd,[p[18]||(p[18]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),Y(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":p[5]||(p[5]=R=>l.value.tools=R),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[ne,l.value.tools]]),p[19]||(p[19]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",Od,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":p[6]||(p[6]=R=>l.value.startImmediately=R)},null,512),[[he,l.value.startImmediately]]),p[20]||(p[20]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),i.value?(s(),n("div",Nd,g(i.value),1)):D("",!0)],32)]),e("div",Ad,[p[21]||(p[21]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:y,disabled:_.value},[_.value?(s(),n("span",Ud)):D("",!0),G(" "+g(_.value?"Creating...":"Create Session"),1)],8,Rd)])])])],512))}},Wd=B(qd,[["__scopeId","data-v-5aef47e0"]]),Hd={class:"modal-dialog"},Fd={class:"modal-content"},Bd={class:"modal-body"},Vd={class:"mb-3"},zd={key:0,class:"invalid-feedback"},Gd={class:"mb-3"},Jd=["value"],Kd={class:"mb-3"},Yd={class:"form-control-plaintext"},Qd={class:"mb-3"},Zd=["disabled"],Xd={key:0,value:"bypassPermissions"},eu={class:"form-text"},tu={key:0,class:"text-warning"},su={key:1},ou={key:0,class:"mb-3"},nu={class:"card"},lu={class:"card-body"},au={key:0,class:"mb-2"},ru={key:1,class:"mb-2"},iu={key:2,class:"mt-2"},cu={class:"form-control",style:{height:"auto","min-height":"60px","white-space":"pre-wrap"},readonly:""},du={key:1,class:"alert alert-danger",role:"alert"},uu={class:"modal-footer"},mu=["disabled"],pu={key:0,class:"spinner-border spinner-border-sm me-2"},vu={__name:"SessionEditModal",setup(o){const t=J(),a=se(),m=I(null),r=I({name:"",permission_mode:"default"}),l=I({name:""}),d=I(!1),_=I(""),i=I(null);let v=null;const u=c(()=>m.value?.state==="active"||m.value?.state==="starting"),w=c(()=>m.value?.initial_permission_mode==="bypassPermissions");function f(x){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[x]||"bg-secondary"}function $(){l.value={};let x=!0;return r.value.name.trim()||(l.value.name="Session name is required",x=!1),x}async function j(){if(!(!$()||!m.value)){d.value=!0,_.value="";try{await t.updateSessionName(m.value.session_id,r.value.name),r.value.permission_mode!==m.value.current_permission_mode&&await t.setPermissionMode(m.value.session_id,r.value.permission_mode),v&&v.hide()}catch(x){console.error("Failed to update session:",x),_.value=x.message||"Failed to update session. Please try again."}finally{d.value=!1}}}function y(){r.value={name:"",permission_mode:"default"},l.value={},_.value=""}function b(){const x=document.getElementById("editSessionName");x&&(x.focus(),x.select())}function S(){y(),m.value=null,a.hideModal()}return ee(()=>a.currentModal,x=>{if(x?.name==="edit-session"&&v){const h=x.data||{};m.value=h.session,m.value&&(r.value.name=m.value.name,r.value.permission_mode=m.value.current_permission_mode||"default"),v.show()}}),le(()=>{i.value&&re(async()=>{const{default:x}=await import("./modal-B4rHLo2F.js").then(h=>h.m);return{default:x}},__vite__mapDeps([0,1])).then(({default:x})=>{v=new x(i.value),i.value.addEventListener("shown.bs.modal",b),i.value.addEventListener("hidden.bs.modal",S)})}),ce(()=>{i.value&&(i.value.removeEventListener("shown.bs.modal",b),i.value.removeEventListener("hidden.bs.modal",S)),v&&v.dispose()}),(x,h)=>(s(),n("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",Hd,[e("div",Fd,[h[15]||(h[15]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Bd,[e("form",{onSubmit:ie(j,["prevent"])},[e("div",Vd,[h[2]||(h[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),Y(e("input",{type:"text",class:z(["form-control",{"is-invalid":l.value.name}]),id:"editSessionName","onUpdate:modelValue":h[0]||(h[0]=p=>r.value.name=p),placeholder:"Session Name",required:""},null,2),[[ne,r.value.name]]),l.value.name?(s(),n("div",zd,g(l.value.name),1)):D("",!0)]),e("div",Gd,[h[3]||(h[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:m.value?.working_directory,disabled:"",readonly:""},null,8,Jd),h[4]||(h[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",Kd,[h[5]||(h[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",Yd,[e("span",{class:z(["badge",f(m.value?.state)])},g(m.value?.state),3)])]),e("div",Qd,[h[9]||(h[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Y(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":h[1]||(h[1]=p=>r.value.permission_mode=p),disabled:!u.value},[h[6]||(h[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),h[7]||(h[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),h[8]||(h[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),w.value?(s(),n("option",Xd,"âš ï¸ Bypass Permissions (No prompts)")):D("",!0)],8,Zd),[[ge,r.value.permission_mode]]),e("div",eu,[u.value?(s(),n("span",su," Controls which tool actions require permission prompts ")):(s(),n("span",tu," âš ï¸ Session must be active to change permission mode. Start the session first. "))])]),m.value?.system_prompt||m.value?.override_system_prompt?(s(),n("div",ou,[h[13]||(h[13]=e("label",{class:"form-label"},"System Prompt Configuration",-1)),e("div",nu,[e("div",lu,[m.value?.override_system_prompt?(s(),n("div",au,[...h[10]||(h[10]=[e("span",{class:"badge bg-warning text-dark"},"Override Mode",-1),e("div",{class:"form-text text-warning mt-1"}," Using custom prompt only (no Claude Code preset) ",-1)])])):(s(),n("div",ru,[...h[11]||(h[11]=[e("span",{class:"badge bg-info"},"Append Mode",-1),e("div",{class:"form-text mt-1"}," Custom instructions appended to Claude Code preset ",-1)])])),m.value?.system_prompt?(s(),n("div",iu,[h[12]||(h[12]=e("strong",{class:"small"},"Custom Instructions:",-1)),e("div",cu,g(m.value.system_prompt),1)])):D("",!0)])])])):D("",!0),_.value?(s(),n("div",du,g(_.value),1)):D("",!0)],32)]),e("div",uu,[h[14]||(h[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:j,disabled:d.value},[d.value?(s(),n("span",pu)):D("",!0),G(" "+g(d.value?"Saving...":"Save Changes"),1)],8,mu)])])])],512))}},fu=B(vu,[["__scopeId","data-v-c99ca17f"]]),gu={class:"modal-dialog modal-dialog-centered"},_u={class:"modal-content"},hu={class:"modal-header"},bu={class:"modal-title",id:"manageSessionModalLabel"},yu={class:"modal-body"},$u={key:0,class:"text-center py-4"},wu={class:"text-muted"},Su={key:1},ku={key:2},Cu={class:"text-muted"},xu={key:3},Mu={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},ju={class:"d-grid gap-2"},Tu=["disabled"],Eu=["disabled"],Lu=["disabled"],Pu=["disabled"],Iu={class:"modal-footer"},Du={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Ou={__name:"SessionManageModal",setup(o){const t=fe(),a=J(),m=se(),r=pe();ue();const l=I(null),d=I(!1),_=I(""),i=I(""),v=I(null),u=I(null);let w=null;const f=c(()=>v.value==="reset"?"Reset Session":v.value==="delete"?"Delete Session":"Manage Session");function $(){v.value="reset"}function j(){v.value="delete"}function y(){v.value=null}async function b(){v.value==="reset"?await h():v.value==="delete"&&await p()}async function S(){if(l.value){d.value=!0,_.value="Restarting session...";try{const M=l.value.session_id,T=await K.post(`/api/sessions/${M}/restart`);if(T.success)console.log("Session restarted successfully, reconnecting"),await r.disconnectSession(),a.currentSessionId=null,await a.selectSession(M),w&&w.hide();else{const H=T.error||T.detail||"Failed to restart session";console.error("Failed to restart session:",H),i.value=`Failed to restart session: ${H}`}}catch(M){console.error("Error restarting session:",M);const T=M.data?.detail||M.message||"Unknown error";i.value=`Error restarting session: ${T}`}finally{d.value=!1}}}async function x(){if(l.value)try{w&&w.hide(),console.log("Ending session",l.value.session_id);const M=l.value.session_id;await K.post(`/api/sessions/${M}/terminate`),await r.disconnectSession(),a.currentSessionId===M&&(a.currentSessionId=null),t.push("/")}catch(M){console.error("Error ending session:",M),await r.disconnectSession(),a.currentSessionId===l.value?.session_id&&(a.currentSessionId=null),t.push("/")}}async function h(){if(l.value){d.value=!0,_.value="Resetting session...";try{const M=l.value.session_id,T=await K.post(`/api/sessions/${M}/reset`);if(T.success)console.log("Session reset successfully, reconnecting"),await r.disconnectSession(),a.currentSessionId=null,await a.selectSession(M),w&&w.hide();else{const H=T.error||T.detail||"Failed to reset session";console.error("Failed to reset session:",H),i.value=`Failed to reset session: ${H}`,v.value=null}}catch(M){console.error("Error resetting session:",M);const T=M.data?.detail||M.message||"Unknown error";i.value=`Error resetting session: ${T}`,v.value=null}finally{d.value=!1}}}async function p(){if(l.value){d.value=!0,_.value="Deleting session...";try{const M=l.value.session_id;await a.deleteSession(M),t.currentRoute.value.params.sessionId===M&&t.push("/"),w&&w.hide()}catch(M){console.error("Error deleting session:",M);const T=M.data?.detail||M.message||"Unknown error";i.value=`Error deleting session: ${T}`,v.value=null}finally{d.value=!1}}}function R(){v.value=null,d.value=!1,_.value="",i.value=""}function U(){R(),l.value=null,m.hideModal()}return ee(()=>m.currentModal,M=>{if(M?.name==="manage-session"&&w){const T=M.data||{};l.value=T.session,R(),w.show()}}),le(()=>{u.value&&re(async()=>{const{default:M}=await import("./modal-B4rHLo2F.js").then(T=>T.m);return{default:M}},__vite__mapDeps([0,1])).then(({default:M})=>{w=new M(u.value),u.value.addEventListener("hidden.bs.modal",U)})}),ce(()=>{u.value&&u.value.removeEventListener("hidden.bs.modal",U),w&&w.dispose()}),(M,T)=>(s(),n("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:u},[e("div",gu,[e("div",_u,[e("div",hu,[e("h5",bu,g(v.value?f.value:"Manage Session"),1),T[1]||(T[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",yu,[d.value?(s(),n("div",$u,[T[2]||(T[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",wu,g(_.value),1)])):v.value==="reset"?(s(),n("div",Su,[...T[3]||(T[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):v.value==="delete"?(s(),n("div",ku,[T[6]||(T[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1)),e("p",Cu,[T[4]||(T[4]=G("This will permanently delete session ",-1)),e("strong",null,g(l.value?.name),1),T[5]||(T[5]=G(".",-1))]),T[7]||(T[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(s(),n("div",xu,[i.value?(s(),n("div",Mu,[T[8]||(T[8]=e("strong",null,"Error:",-1)),G(" "+g(i.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:T[0]||(T[0]=H=>i.value="")})])):D("",!0),T[15]||(T[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",ju,[e("button",{class:"btn btn-outline-primary text-start",onClick:S,disabled:d.value},[...T[9]||(T[9]=[e("strong",null,"ðŸ”„ Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,Tu),e("button",{class:"btn btn-outline-secondary text-start",onClick:x,disabled:d.value},[...T[10]||(T[10]=[e("strong",null,"ðŸšª End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,Eu),T[13]||(T[13]=e("hr",{class:"my-2"},null,-1)),T[14]||(T[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"âš ï¸ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:$,disabled:d.value},[...T[11]||(T[11]=[e("strong",null,"ðŸ—‘ï¸ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,Lu),e("button",{class:"btn btn-outline-danger text-start",onClick:j,disabled:d.value},[...T[12]||(T[12]=[e("strong",null,"âŒ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,Pu)]),T[16]||(T[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),G(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",Iu,[v.value&&!d.value?(s(),n(Z,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:y},"Cancel"),e("button",{type:"button",class:z(["btn",v.value==="delete"?"btn-danger":"btn-warning"]),onClick:b},g(v.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):d.value?D("",!0):(s(),n("button",Du,"Cancel"))])])])],512))}},Nu=B(Ou,[["__scopeId","data-v-de7ff18c"]]),Au={class:"modal-dialog modal-dialog-centered modal-lg"},Ru={class:"modal-content"},Uu={class:"modal-body"},qu={key:0,class:"text-center text-muted py-4"},Wu={key:1},Hu={class:"mb-3"},Fu={class:"font-monospace small"},Bu={class:"mb-3"},Vu={class:"font-monospace small"},zu={class:"mb-3"},Gu={class:"mb-3"},Ju={class:"mb-3"},Ku={key:0},Yu={class:"d-flex flex-wrap gap-1"},Qu={key:1,class:"text-muted small"},Zu={key:0,class:"mb-3"},Xu={class:"d-flex flex-wrap gap-1"},em={key:1,class:"mb-3"},tm={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},sm={class:"mb-3"},om={class:"text-muted"},nm={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},lm={__name:"SessionInfoModal",setup(o){const t=J(),a=ue(),m=se(),r=I(null),l=I(!1),d=I(null);let _=null;const i=c(()=>{if(!r.value)return null;const f=t.initData.get(r.value);return f||(a.messagesBySession.get(r.value)||[]).find(y=>y.type==="system"&&(y.subtype==="init"||y.metadata?.subtype==="init")&&y.metadata?.init_data)?.metadata?.init_data||null});function v(f){return typeof f=="string"?f:typeof f=="object"&&f.type==="preset"?`Preset: ${f.preset}`:JSON.stringify(f,null,2)}function u(){r.value=null,l.value=!1}function w(){u(),m.hideModal()}return ee(()=>m.currentModal,f=>{if(f?.name==="session-info"&&_){const $=f.data||{};r.value=$.sessionId,l.value=!1,_.show()}}),le(()=>{d.value&&re(async()=>{const{default:f}=await import("./modal-B4rHLo2F.js").then($=>$.m);return{default:f}},__vite__mapDeps([0,1])).then(({default:f})=>{_=new f(d.value),d.value.addEventListener("hidden.bs.modal",w)})}),ce(()=>{d.value&&d.value.removeEventListener("hidden.bs.modal",w),_&&_.dispose()}),(f,$)=>(s(),n("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:d},[e("div",Au,[e("div",Ru,[$[9]||($[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Uu,[i.value?(s(),n("div",Wu,[e("div",Hu,[$[1]||($[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Fu,g(r.value),1)]),e("div",Bu,[$[2]||($[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",Vu,g(i.value.cwd||"Not specified"),1)]),e("div",zu,[$[3]||($[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,g(i.value.model||"Default"),1)]),e("div",Gu,[$[4]||($[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,g(i.value.permissionMode||"default"),1)]),e("div",Ju,[$[5]||($[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),i.value.tools&&i.value.tools.length>0?(s(),n("div",Ku,[e("div",Yu,[(s(!0),n(Z,null,X(i.value.tools,j=>(s(),n("span",{key:j,class:"badge bg-secondary"},g(j),1))),128))])])):(s(),n("div",Qu,"All tools available"))]),i.value.commands&&i.value.commands.length>0?(s(),n("div",Zu,[$[6]||($[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",Xu,[(s(!0),n(Z,null,X(i.value.commands,j=>(s(),n("span",{key:j,class:"badge bg-info"},g(j),1))),128))])])):D("",!0),i.value.systemPrompt?(s(),n("div",em,[$[7]||($[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",tm,g(v(i.value.systemPrompt)),1)])):D("",!0),e("div",sm,[e("h6",om,[$[8]||($[8]=G(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:$[0]||($[0]=j=>l.value=!l.value)},g(l.value?"Hide":"Show"),1)]),l.value?(s(),n("pre",nm,g(JSON.stringify(i.value,null,2)),1)):D("",!0)])])):(s(),n("div",qu," No session configuration data available "))]),$[10]||($[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},am=B(lm,[["__scopeId","data-v-809e2099"]]),rm={class:"modal-dialog modal-dialog-centered"},im={class:"modal-content"},cm={class:"modal-body"},dm={class:"mb-3"},um={class:"mb-3"},mm={class:"mb-3"},pm={class:"form-text d-flex justify-content-between"},vm={key:0,class:"invalid-feedback"},fm={class:"mb-3 form-check"},gm={key:0,class:"form-text text-warning"},_m={class:"mb-3"},hm={key:0,class:"alert alert-danger"},bm={class:"modal-footer"},ym=["disabled"],$m={key:0,class:"spinner-border spinner-border-sm me-2"},wm={__name:"CreateMinionModal",setup(o){const t=fe(),a=ae(),m=J(),r=se(),l=I(null);let d=null;const _=I(null),i=I({name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]}),v=I(""),u=I(""),w=I(!1),f=c(()=>v.value.trim()?v.value.split(",").map(h=>h.trim()).filter(h=>h.length>0):[]),$=c(()=>i.value.initialization_context.length),j=c(()=>$.value>2e3),y=c(()=>$.value>1800&&$.value<=2e3);function b(){i.value={name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]},v.value="",u.value="",w.value=!1}function S(){b(),r.hideModal()}async function x(){if(!i.value.name.trim()){u.value="Minion name is required";return}if(i.value.name.includes(" ")){u.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(j.value){u.value="Initialization context exceeds 2000 character limit";return}if(!_.value){u.value="Legion ID is missing";return}w.value=!0,u.value="";try{const h={name:i.value.name.trim(),role:i.value.role.trim(),initialization_context:i.value.initialization_context.trim(),override_system_prompt:i.value.override_system_prompt,capabilities:f.value},p=await K.post(`/api/legions/${_.value}/minions`,h);p.success&&p.minion_id?(await a.fetchProjects(),await m.fetchSessions(),d&&d.hide(),t.push(`/spy/${_.value}/${p.minion_id}`)):u.value="Failed to create minion"}catch(h){console.error("Failed to create minion:",h),u.value=h.response?.data?.detail||"Failed to create minion"}finally{w.value=!1}}return ee(()=>r.currentModal,h=>{if(h?.name==="create-minion"&&d){const p=h.data||{};_.value=p.project?.project_id||null,b(),d.show()}}),le(()=>{l.value&&re(()=>import("./modal-B4rHLo2F.js").then(h=>h.m),__vite__mapDeps([0,1])).then(h=>{const p=h.default;d=new p(l.value),l.value.addEventListener("hidden.bs.modal",S)})}),ce(()=>{l.value&&l.value.removeEventListener("hidden.bs.modal",S),d&&d.dispose()}),(h,p)=>(s(),n("div",{ref_key:"modalElement",ref:l,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",rm,[e("div",im,[p[15]||(p[15]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",cm,[e("form",{onSubmit:ie(x,["prevent"])},[e("div",dm,[p[5]||(p[5]=e("label",{for:"minion-name",class:"form-label"},[G(" Name "),e("span",{class:"text-danger"},"*")],-1)),Y(e("input",{id:"minion-name","onUpdate:modelValue":p[0]||(p[0]=R=>i.value.name=R),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[ne,i.value.name]]),p[6]||(p[6]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",um,[p[7]||(p[7]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),Y(e("input",{id:"minion-role","onUpdate:modelValue":p[1]||(p[1]=R=>i.value.role=R),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[ne,i.value.role]]),p[8]||(p[8]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",mm,[p[9]||(p[9]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),Y(e("textarea",{id:"minion-context","onUpdate:modelValue":p[2]||(p[2]=R=>i.value.initialization_context=R),class:z(["form-control",{"is-invalid":j.value}]),rows:"4",maxlength:2e3,placeholder:"Instructions and context for the minion..."},null,2),[[ne,i.value.initialization_context]]),e("div",pm,[e("span",null,g(i.value.override_system_prompt?"This context will replace Claude Code's preset and legion guide":"This context will be appended to legion guide and Claude Code's preset"),1),e("span",{class:z({"text-danger":j.value,"text-warning":y.value})},g($.value)+" / 2000 chars ",3)]),j.value?(s(),n("div",vm," Initialization context exceeds 2000 character limit (Windows command-line constraint) ")):D("",!0)]),e("div",fm,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":p[3]||(p[3]=R=>i.value.override_system_prompt=R)},null,512),[[he,i.value.override_system_prompt]]),p[11]||(p[11]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom context only) ",-1)),i.value.override_system_prompt?(s(),n("div",gm,[...p[10]||(p[10]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom context will be used (no legion guide or Claude Code preset).",-1)])])):D("",!0)]),e("div",_m,[p[12]||(p[12]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),Y(e("input",{id:"minion-capabilities","onUpdate:modelValue":p[4]||(p[4]=R=>v.value=R),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[ne,v.value]]),p[13]||(p[13]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),u.value?(s(),n("div",hm,g(u.value),1)):D("",!0)],32)]),e("div",bm,[p[14]||(p[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!i.value.name.trim()||w.value,onClick:x},[w.value?(s(),n("span",$m)):D("",!0),G(" "+g(w.value?"Creating...":"Create Minion"),1)],8,ym)])])])],512))}},Sm=B(wm,[["__scopeId","data-v-d7434e2a"]]),km={class:"modal-dialog modal-dialog-centered modal-lg"},Cm={class:"modal-content"},xm={class:"modal-body"},Mm={key:0,class:"text-center text-muted py-4"},jm={key:1},Tm={class:"mb-3"},Em={class:"mb-3"},Lm={class:"font-monospace small"},Pm={class:"mb-3"},Im={class:"mb-3"},Dm={class:"mb-3"},Om={key:0},Nm={class:"d-flex flex-wrap gap-1"},Am={key:1,class:"text-muted small"},Rm={class:"mb-3"},Um={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto","white-space":"pre-wrap"}},qm={key:1,class:"text-muted small"},Wm={class:"mb-3"},Hm={key:0,class:"badge bg-info"},Fm={key:1,class:"badge bg-secondary"},Bm={class:"mb-3"},Vm={key:0,class:"font-monospace small"},zm={key:1,class:"text-muted small"},Gm={key:0,class:"mb-3"},Jm={key:0},Km={class:"list-unstyled mb-0"},Ym={key:1,class:"text-muted small"},Qm={class:"mb-3"},Zm={key:0,class:"font-monospace small"},Xm={key:1,class:"text-muted small"},ep={class:"mb-3"},tp={key:0},sp={class:"d-flex flex-wrap gap-1"},op={key:1,class:"text-muted small"},np={class:"mb-3"},lp={class:"small"},ap={class:"mb-3"},rp={class:"small"},ip={__name:"MinionViewModal",setup(o){const t=se(),a=I(null),m=I(null);let r=null;function l(v){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[v]||"bg-secondary"}function d(v){if(!v)return"N/A";try{const u=new Date(v);return isNaN(u.getTime())?"Invalid date":u.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(u){return console.error("Error formatting timestamp:",u),"Invalid date"}}function _(){a.value=null}function i(){_(),t.hideModal()}return ee(()=>t.currentModal,v=>{if(v?.name==="minion-view"&&r){const u=v.data||{};a.value=u.session,r.show()}}),le(()=>{m.value&&re(async()=>{const{default:v}=await import("./modal-B4rHLo2F.js").then(u=>u.m);return{default:v}},__vite__mapDeps([0,1])).then(({default:v})=>{r=new v(m.value),m.value.addEventListener("hidden.bs.modal",i)})}),ce(()=>{m.value&&m.value.removeEventListener("hidden.bs.modal",i),r&&r.dispose()}),(v,u)=>(s(),n("div",{class:"modal fade",id:"minionViewModal",tabindex:"-1","aria-labelledby":"minionViewModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:m},[e("div",km,[e("div",Cm,[u[13]||(u[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"minionViewModalLabel"},"Minion Details"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",xm,[a.value?(s(),n("div",jm,[e("div",Tm,[u[0]||(u[0]=e("h6",{class:"text-muted"},"Name",-1)),e("div",null,g(a.value.name||"Unnamed Minion"),1)]),e("div",Em,[u[1]||(u[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Lm,g(a.value.session_id),1)]),e("div",Pm,[u[2]||(u[2]=e("h6",{class:"text-muted"},"Role",-1)),e("div",null,g(a.value.role||"Not specified"),1)]),e("div",Im,[u[3]||(u[3]=e("h6",{class:"text-muted"},"Current State",-1)),e("div",null,[e("span",{class:z(["badge",l(a.value.state)])},g(a.value.state),3)])]),e("div",Dm,[u[4]||(u[4]=e("h6",{class:"text-muted"},"Capabilities",-1)),a.value.capabilities&&a.value.capabilities.length>0?(s(),n("div",Om,[e("div",Nm,[(s(!0),n(Z,null,X(a.value.capabilities,w=>(s(),n("span",{key:w,class:"badge bg-secondary"},g(w),1))),128))])])):(s(),n("div",Am,"None"))]),e("div",Rm,[u[5]||(u[5]=e("h6",{class:"text-muted"},"Initialization Context",-1)),a.value.initialization_context?(s(),n("div",Um,g(a.value.initialization_context),1)):(s(),n("div",qm,"Not specified"))]),e("div",Wm,[u[6]||(u[6]=e("h6",{class:"text-muted"},"Overseer",-1)),e("div",null,[a.value.is_overseer?(s(),n("span",Hm,"Yes")):(s(),n("span",Fm,"No"))])]),e("div",Bm,[u[7]||(u[7]=e("h6",{class:"text-muted"},"Parent Overseer",-1)),a.value.parent_overseer_id?(s(),n("div",Vm,g(a.value.parent_overseer_id),1)):(s(),n("div",zm,g(a.value.is_minion?"Root overseer (user-created)":"N/A"),1))]),a.value.is_overseer?(s(),n("div",Gm,[u[8]||(u[8]=e("h6",{class:"text-muted"},"Child Minions",-1)),a.value.child_minion_ids&&a.value.child_minion_ids.length>0?(s(),n("div",Jm,[e("ul",Km,[(s(!0),n(Z,null,X(a.value.child_minion_ids,w=>(s(),n("li",{key:w,class:"font-monospace small"},g(w),1))),128))])])):(s(),n("div",Ym,"No children"))])):D("",!0),e("div",Qm,[u[9]||(u[9]=e("h6",{class:"text-muted"},"Horde Membership",-1)),a.value.horde_id?(s(),n("div",Zm,g(a.value.horde_id),1)):(s(),n("div",Xm,"Not in a horde"))]),e("div",ep,[u[10]||(u[10]=e("h6",{class:"text-muted"},"Channel Memberships",-1)),a.value.channel_ids&&a.value.channel_ids.length>0?(s(),n("div",tp,[e("div",sp,[(s(!0),n(Z,null,X(a.value.channel_ids,w=>(s(),n("span",{key:w,class:"badge bg-info"},g(w),1))),128))])])):(s(),n("div",op,"No channels"))]),e("div",np,[u[11]||(u[11]=e("h6",{class:"text-muted"},"Created",-1)),e("div",lp,g(d(a.value.created_at)),1)]),e("div",ap,[u[12]||(u[12]=e("h6",{class:"text-muted"},"Last Active",-1)),e("div",rp,g(d(a.value.updated_at)),1)])])):(s(),n("div",Mm," No minion data available "))]),u[14]||(u[14]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},cp=B(ip,[["__scopeId","data-v-c44eaee2"]]),dp={class:"container-fluid vh-100 d-flex flex-column p-0"},up={class:"d-flex flex-grow-1 overflow-hidden position-relative"},mp={class:"flex-grow-1 d-flex flex-column overflow-hidden"},pp={__name:"App",setup(o){const t=se(),a=pe(),m=J(),r=ae(),l=fe(),d=c(()=>t.sidebarCollapsed),_=c(()=>t.isMobile);le(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),a.connectUI(),await Promise.all([r.fetchProjects(),m.fetchSessions()]);const u=window.location.hash;if(u.startsWith("#/session/")){const w=u.replace("#/session/","");m.sessions.has(w)&&await m.selectSession(w)}else if(u.startsWith("#/timeline/")){const w=u.replace("#/timeline/","");l.push(`/timeline/${w}`)}window.addEventListener("popstate",i),window.addEventListener("resize",t.handleResize)}),ce(()=>{window.removeEventListener("popstate",i),window.removeEventListener("resize",t.handleResize),a.disconnectUI()});function i(){const u=window.location.hash;if(u.startsWith("#/session/")){const w=u.replace("#/session/","");m.sessions.has(w)&&m.selectSession(w)}}function v(){t.toggleSidebar()}return(u,w)=>{const f=qe("router-view");return s(),n("div",dp,[Q(Ii),e("div",{id:"sidebar-backdrop",class:z({show:!d.value&&_.value}),onClick:v},null,2),e("div",up,[Q(vc),e("main",mp,[Q(f)])]),Q(Lc),Q(Yc),Q(hd),Q(Wd),Q(fu),Q(Nu),Q(am),Q(Sm),Q(cp)])}}},Le=Ve(pp);Le.use(ze());Le.use(Ti);Le.mount("#app");
