const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as o,a as e,o as s,d as _e,r as L,b as d,t as p,n as me,e as H,f as G,u as ke,w as ee,g as Pe,h as D,F as Y,i as Z,j as de,k as Ue,l as Q,v as le,m as X,p as ne,q as Te,s as Se,x as ie,y as ce,z as ge,A as qe,B as He,C as Be,D as pe,E as be,G as Ve,H as ze}from"./vue-vendor-BChC3Sgv.js";import{m as ye,p as Ee}from"./markdown-vendor-CQ3OZdP9.js";import{c as Ge}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))m(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&m(c)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function m(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();const Je={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},Ke={__name:"NoSessionSelected",setup(n){return(t,a)=>(s(),o("div",Je,[...a[0]||(a[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},Ye="modulepreload",Qe=function(n){return"/"+n},Ie={},re=function(t,a,m){let r=Promise.resolve();if(a&&a.length>0){let i=function(v){return Promise.all(v.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),g=c?.nonce||c?.getAttribute("nonce");r=i(a.map(v=>{if(v=Qe(v),v in Ie)return;Ie[v]=!0;const u=v.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":Ye,u||(f.as="script"),f.crossOrigin="",f.href=v,g&&f.setAttribute("nonce",g),document.head.appendChild(f),u)return new Promise(($,T)=>{f.addEventListener("load",$),f.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${v}`)))})}))}function l(c){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=c,window.dispatchEvent(g),!g.defaultPrevented)throw c}return r.then(c=>{for(const g of c||[])g.status==="rejected"&&l(g.reason);return t().catch(l)})};class xe extends Error{constructor(t,a,m){super(t),this.name="APIError",this.status=a,this.data=m}}async function $e(n,t={}){try{const a=await fetch(n,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!a.ok){let r;try{r=await a.json()}catch{r={detail:a.statusText}}throw new xe(r.detail||`HTTP ${a.status}: ${a.statusText}`,a.status,r)}const m=a.headers.get("content-type");return m&&m.includes("application/json")?await a.json():await a.text()}catch(a){throw a instanceof xe?a:(console.error("API request failed:",a),new xe(`Network error: ${a.message}`,0,null))}}async function Ze(n,t={}){let a=n;if(t.params){const m=new URLSearchParams;for(const[g,i]of Object.entries(t.params))i!=null&&m.append(g,i);const r=m.toString();r&&(a=`${n}?${r}`);const{params:l,...c}=t;return $e(a,{...c,method:"GET"})}return $e(a,{...t,method:"GET"})}async function Xe(n,t,a={}){return $e(n,{...a,method:"POST",body:JSON.stringify(t)})}async function et(n,t,a={}){return $e(n,{...a,method:"PUT",body:JSON.stringify(t)})}async function tt(n,t={}){return $e(n,{...t,method:"DELETE"})}const J={get:Ze,post:Xe,put:et,delete:tt},K=_e("session",()=>{const n=L(new Map),t=L(null),a=L(new Map),m=L(new Map),r=L(new Set),l=L(!1);let c=null;const g=d(()=>n.value.get(t.value)),i=d(()=>Array.from(n.value.values()).sort((j,M)=>j.order-M.order)),v=j=>d(()=>i.value.filter(M=>M.project_id===j)),u=d({get:()=>a.value.get(t.value)||"",set:j=>{t.value&&a.value.set(t.value,j)}});async function h(){try{const j=await J.get("/api/sessions");return n.value.clear(),j.sessions.forEach(M=>{n.value.set(M.session_id,M)}),console.log(`Loaded ${n.value.size} sessions`),j.sessions}catch(j){throw console.error("Failed to fetch sessions:",j),j}}async function f(j,M){try{const w=(await J.post("/api/sessions",{project_id:j,...M})).session_id,C=(await J.get(`/api/sessions/${w}`)).session;return n.value.set(w,C),n.value=new Map(n.value),console.log(`Created session ${w}`),C}catch(P){throw console.error("Failed to create session:",P),P}}async function $(j){if(t.value===j&&!l.value)return;c&&(console.log(`Aborting pending selection to switch to ${j}`),c.abort(),c=null);const M=new AbortController;c=M,l.value=!0;try{if(t.value=j,M.signal.aborted){console.log(`Selection of ${j} aborted early`);return}let P=n.value.get(j);if(!P)try{const C=await J.get(`/api/sessions/${j}`);if(M.signal.aborted){console.log(`Selection of ${j} aborted after fetch`);return}P=C.session,n.value.set(j,P),n.value=new Map(n.value),console.log(`Fetched session ${j} for deeplink`)}catch(C){console.error(`Failed to fetch session ${j}:`,C);return}if(P&&(P.state==="created"||P.state==="terminated"))try{if(await N(j),M.signal.aborted){console.log(`Selection of ${j} aborted after start`);return}console.log(`Auto-started session ${j} (was in ${P.state} state)`);const C=6e4,E=200,O=5e3;let R=0,I=0;for(;R<C;){if(M.signal.aborted){console.log(`Selection of ${j} aborted during state wait`);return}const W=n.value.get(j);if(W&&W.state==="active"){console.log(`Session ${j} is now active after ${R}ms`);break}if(R-I>=O){const V=n.value.get(j)?.state||"unknown";console.log(`Waiting for session ${j} to become active (current: ${V}, ${R/1e3}s elapsed)`),I=R}await new Promise(V=>setTimeout(V,E)),R+=E}const A=n.value.get(j);A&&A.state!=="active"&&console.warn(`Session ${j} did not become active within ${C/1e3}s (state: ${A.state}), continuing anyway`)}catch(C){console.error(`Failed to auto-start session ${j}:`,C)}if(M.signal.aborted){console.log(`Selection of ${j} aborted before message load`);return}if(await(await re(()=>Promise.resolve().then(()=>$t),void 0)).useMessageStore().loadMessages(j),M.signal.aborted){console.log(`Selection of ${j} aborted after message load`);return}await(await re(()=>Promise.resolve().then(()=>Ft),void 0)).useWebSocketStore().connectSession(j),M.signal.aborted||console.log(`Selected session ${j}`)}finally{c===M&&(c=null),l.value=!1}}function T(j,M){const P=n.value.get(j);P?Object.assign(P,M):(n.value.set(j,M),console.log(`Added new session ${j} via WebSocket update`)),n.value=new Map(n.value)}async function b(j){r.value.add(j);try{await J.delete(`/api/sessions/${j}`),n.value.delete(j),a.value.delete(j),m.value.delete(j),n.value=new Map(n.value),t.value===j&&(t.value=null),console.log(`Deleted session ${j}`)}catch(M){throw console.error("Failed to delete session:",M),M}finally{r.value.delete(j)}}async function y(j,M){try{await J.put(`/api/sessions/${j}/name`,{name:M}),T(j,{name:M}),console.log(`Updated session ${j} name to "${M}"`)}catch(P){throw console.error("Failed to update session name:",P),P}}async function x(j,M){try{await J.post(`/api/sessions/${j}/permission-mode`,{mode:M}),T(j,{current_permission_mode:M});const P=m.value.get(j);P&&(P.permissionMode=M,m.value.set(j,P)),console.log(`Set permission mode for session ${j} to ${M}`)}catch(P){throw console.error("Failed to set permission mode:",P),P}}async function N(j){try{await J.post(`/api/sessions/${j}/start`),console.log(`Started session ${j}`)}catch(M){throw console.error("Failed to start session:",M),M}}async function k(j){try{await J.post(`/api/sessions/${j}/pause`),console.log(`Paused session ${j}`)}catch(M){throw console.error("Failed to pause session:",M),M}}async function S(j){try{await J.post(`/api/sessions/${j}/terminate`),console.log(`Terminated session ${j}`)}catch(M){throw console.error("Failed to terminate session:",M),M}}function U(j){return n.value.get(j)}function q(j,M){m.value.set(j,M),M.permissionMode&&T(j,{current_permission_mode:M.permissionMode})}return{sessions:n,currentSessionId:t,inputCache:a,initData:m,deletingSessions:r,currentSession:g,orderedSessions:i,sessionsInProject:v,currentInput:u,fetchSessions:h,createSession:f,selectSession:$,updateSession:T,deleteSession:b,updateSessionName:y,setPermissionMode:x,startSession:N,pauseSession:k,terminateSession:S,getSession:U,storeInitData:q}}),De=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:K},Symbol.toStringTag,{value:"Module"})),se=_e("ui",()=>{const n=L(window.innerWidth<768),t=L(300),a=L(window.innerWidth),m=d(()=>a.value<768),r=L(!0),l=L(null),c=L(null),g=d(()=>l.value?{name:l.value,data:c.value}:null),i=L(!1),v=L("Loading...");function u(){n.value=!n.value}function h(k){n.value=k}function f(k){t.value=Math.max(200,Math.min(k,window.innerWidth*.3))}function $(k){r.value=k}function T(k,S=null){l.value=null,c.value=null,setTimeout(()=>{l.value=k,c.value=S},0)}function b(){l.value=null,c.value=null}function y(k="Loading..."){i.value=!0,v.value=k}function x(){i.value=!1}function N(){const k=a.value;a.value=window.innerWidth,a.value<768&&k>=768?n.value=!0:a.value>=768&&k<768&&(n.value=!1)}return{sidebarCollapsed:n,sidebarWidth:t,isMobile:m,autoScrollEnabled:r,activeModal:l,modalData:c,currentModal:g,isLoading:i,loadingMessage:v,toggleSidebar:u,setSidebarCollapsed:h,setSidebarWidth:f,setAutoScroll:$,showModal:T,hideModal:b,showLoading:y,hideLoading:x,handleResize:N}}),ae=_e("project",()=>{const n=L(new Map),t=L(null),a=d(()=>n.value.get(t.value)),m=d(()=>Array.from(n.value.values()).sort((b,y)=>b.order-y.order)),r=b=>n.value.get(b)?.is_multi_agent||!1;async function l(){try{const b=await J.get("/api/projects");return n.value.clear(),b.projects.forEach(y=>{n.value.set(y.project_id,y)}),console.log(`Loaded ${n.value.size} projects`),b.projects}catch(b){throw console.error("Failed to fetch projects:",b),b}}async function c(b,y,x=!1){try{const k=(await J.post("/api/projects",{name:b,working_directory:y,is_multi_agent:x})).project;return n.value.set(k.project_id,k),n.value=new Map(n.value),console.log(`Created project ${k.project_id}`),k}catch(N){throw console.error("Failed to create project:",N),N}}async function g(b,y){try{await J.put(`/api/projects/${b}`,y),i(b,y),console.log(`Updated project ${b}`,y)}catch(x){throw console.error("Failed to update project:",x),x}}function i(b,y){const x=n.value.get(b);x&&(Object.assign(x,y),n.value=new Map(n.value))}async function v(b){try{await J.delete(`/api/projects/${b}`),n.value.delete(b),n.value=new Map(n.value),t.value===b&&(t.value=null),console.log(`Deleted project ${b}`)}catch(y){throw console.error("Failed to delete project:",y),y}}async function u(b){try{const y=await J.put(`/api/projects/${b}/toggle-expansion`),x=n.value.get(b);return x&&(x.is_expanded=y.is_expanded,n.value=new Map(n.value)),y.is_expanded}catch(y){throw console.error("Failed to toggle expansion:",y),y}}async function h(b){try{await J.put("/api/projects/reorder",{project_ids:b}),b.forEach((y,x)=>{const N=n.value.get(y);N&&(N.order=x)}),n.value=new Map(n.value),console.log("Reordered projects",b)}catch(y){throw console.error("Failed to reorder projects:",y),y}}async function f(b,y){try{await J.put(`/api/projects/${b}/sessions/reorder`,{session_ids:y});const x=n.value.get(b);x&&(x.session_ids=y,n.value=new Map(n.value)),console.log(`Reordered sessions in project ${b}`,y)}catch(x){throw console.error("Failed to reorder sessions:",x),x}}function $(b){return n.value.get(b)}function T(b){if(!b)return"";const y=b.split(/[/\\]/).filter(x=>x);return y.length===0?"/":y.length===1?`/${y[0]}`:y.length===2?`/${y.join("/")}`:`.../${y.slice(-2).join("/")}`}return{projects:n,currentProjectId:t,currentProject:a,orderedProjects:m,isMultiAgent:r,fetchProjects:l,createProject:c,updateProject:g,updateProjectLocal:i,deleteProject:v,toggleExpansion:u,reorderProjects:h,reorderSessionsInProject:f,getProject:$,formatPath:T}}),B=(n,t)=>{const a=n.__vccOpts||n;for(const[m,r]of t)a[m]=r;return a},st={class:"session-header border-bottom p-3"},ot={class:"project-name"},nt=["title"],lt={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,a=K(),m=ae(),r=d(()=>a.sessions.get(t.sessionId)),l=d(()=>r.value?.name||t.sessionId),c=d(()=>{for(const i of m.projects.values())if(i.session_ids?.includes(t.sessionId))return i;return null}),g=d(()=>c.value?.name||"Unknown Project");return(i,v)=>(s(),o("div",st,[e("div",null,[e("div",ot,p(g.value),1),e("div",{class:"session-name",title:n.sessionId},p(l.value),9,nt)])]))}},at=B(lt,[["__scopeId","data-v-89e9c269"]]),rt={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},it=["title"],ct={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},dt={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,a=K(),m=d(()=>a.sessions.get(t.sessionId)),r=d(()=>m.value?m.value.state==="paused"&&m.value.is_processing?"pending-prompt":m.value.is_processing?"processing":m.value.state:"unknown"),l=d(()=>{const i=r.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[i]||"#d3d3d3"}),c=d(()=>{const i=r.value;return i==="starting"||i==="processing"||i==="pending-prompt"}),g=d(()=>{if(!m.value)return"No session selected";const i=r.value,v=i.charAt(0).toUpperCase()+i.slice(1).replace("-"," "),u=m.value.name||"Unnamed Session",h=m.value.is_minion&&m.value.role?` (${m.value.role})`:"";return`${u}${h}: ${v}`});return(i,v)=>(s(),o("div",rt,[m.value?(s(),o("div",{key:0,class:H(["progress-bar",{"progress-bar-striped progress-bar-animated":c.value}]),style:me({width:"100%",backgroundColor:l.value}),title:g.value},null,14,it)):(s(),o("div",ct))]))}},ut=B(dt,[["__scopeId","data-v-e8795bb7"]]),mt={class:"session-status-bar border-top p-2 bg-light"},pt={class:"d-flex justify-content-between align-items-center gap-2"},vt={class:"d-flex gap-2"},ft=["disabled"],gt={class:"mode-label"},_t=["disabled"],ht=["disabled"],bt={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,a=K(),m=se(),r=d(()=>a.sessions.get(t.sessionId)),l=d(()=>r.value?.current_permission_mode||"default"),c={default:"ðŸ”’",acceptEdits:"âœï¸",plan:"ðŸ“‹",bypassPermissions:"â˜¢ï¸"},g=d(()=>c[l.value]||"ðŸ”’"),i=d(()=>l.value),v=["default","acceptEdits","plan"],u=async()=>{if(!r.value)return;if(l.value==="bypassPermissions"){try{await a.setPermissionMode(t.sessionId,"default")}catch(x){console.error("Failed to cycle permission mode:",x)}return}const b=(v.indexOf(l.value)+1)%v.length,y=v[b];try{await a.setPermissionMode(t.sessionId,y)}catch(x){console.error("Failed to cycle permission mode:",x)}},h=()=>{m.showModal("session-info",{sessionId:t.sessionId})},f=()=>{m.showModal("manage-session",{session:r.value})},$=()=>{m.setAutoScroll(!m.autoScrollEnabled)};return(T,b)=>(s(),o("div",mt,[e("div",pt,[e("div",vt,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:u,disabled:!r.value},[G(p(g.value)+" ",1),e("span",gt,p(i.value),1)],8,ft),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:h,disabled:!r.value},[...b[0]||(b[0]=[G(" â„¹ï¸ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,_t),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:f,disabled:!r.value},[...b[1]||(b[1]=[G(" âš™ï¸ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,ht)]),e("div",null,[e("button",{class:H(["btn btn-sm",ke(m).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:$}," â¬‡ï¸ "+p(ke(m).autoScrollEnabled?"ON":"OFF"),3)])])]))}},yt=B(bt,[["__scopeId","data-v-fdcd3535"]]),ue=_e("message",()=>{const n=L(new Map),t=L(new Map),a=L(new Map),m=L(new Map),r=L(new Map),l=L(new Map),c=L(new Map),g=d(()=>{const C=K();return n.value.get(C.currentSessionId)||[]}),i=d(()=>{const C=K();return t.value.get(C.currentSessionId)||[]});async function v(C,E=null,O=0){try{const R=E||1e4,I=await J.get(`/api/sessions/${C}/messages?limit=${R}&offset=${O}`),A=I.messages||[],W=I.total_count||A.length,V=I.has_more||!1;if(console.log(`Loaded ${A.length} of ${W} messages for session ${C}`),n.value.set(C,A),A.length>0){const F=A[A.length-1];F.timestamp&&(c.value.set(C,F.timestamp),console.log(`Tracked last received timestamp for session ${C}: ${F.timestamp}`))}const z=new Set;A.forEach(F=>{F.type==="assistant"&&F.metadata?.tool_uses&&F.metadata.tool_uses.forEach(te=>{z.add(te.id)}),F.type==="user"&&F.metadata?.tool_results&&F.metadata.tool_results.forEach(te=>{z.delete(te.tool_use_id);const we=l.value.get(C);we&&we.delete(te.tool_use_id)}),F.type==="system"&&F.metadata?.subtype==="client_launched"&&(z.forEach(te=>{S(C,te,"Session was restarted")}),z.clear()),F.type==="system"&&F.metadata?.subtype==="interrupt"&&(z.forEach(te=>{S(C,te,"Session was interrupted")}),z.clear()),F.metadata?.has_tool_uses&&F.metadata.tool_uses&&F.metadata.tool_uses.forEach(te=>{T(C,te)}),F.metadata?.has_tool_results&&F.metadata.tool_results&&F.metadata.tool_results.forEach(te=>{x(C,te)}),(F.type==="permission_request"||F.metadata?.has_permission_requests)&&b(C,F),F.type==="system"&&(F.subtype==="init"||F.metadata?.subtype==="init")&&F.metadata?.init_data&&K().storeInitData(C,F.metadata.init_data)});const fe=K().sessions.get(C);return fe&&!["active","paused","starting"].includes(fe.state)&&(z.forEach(F=>{S(C,F,"Session was terminated")}),z.clear()),r.value.set(C,z),n.value=new Map(n.value),V&&console.warn(`Warning: Only loaded ${A.length} of ${W} messages. Some messages may be missing.`),{messages:A,totalCount:W,hasMore:V}}catch(R){throw console.error("Failed to load messages:",R),R}}function u(C,E){const O=r.value.get(C)||new Set;E.type==="assistant"&&E.metadata?.tool_uses&&E.metadata.tool_uses.forEach(R=>{O.add(R.id)}),E.type==="user"&&E.metadata?.tool_results&&E.metadata.tool_results.forEach(R=>{O.delete(R.tool_use_id);const I=l.value.get(C);I&&I.delete(R.tool_use_id)}),E.type==="system"&&E.metadata?.subtype==="client_launched"&&(O.forEach(R=>{S(C,R,"Session was restarted")}),O.clear()),E.type==="system"&&E.metadata?.subtype==="interrupt"&&(O.forEach(R=>{S(C,R,"Session was interrupted")}),O.clear()),r.value.set(C,O)}function h(C,E){n.value.has(C)||n.value.set(C,[]),n.value.get(C).push(E),E.timestamp&&c.value.set(C,E.timestamp),u(C,E),n.value=new Map(n.value)}function f(C,E){t.value.has(C)||t.value.set(C,[]),t.value.get(C).push(E),t.value=new Map(t.value)}function $(C,E,O){const R=t.value.get(C);if(R){const I=R.find(A=>A.id===E);I&&(Object.assign(I,O),t.value=new Map(t.value))}}function T(C,E){const O=k(E.name,E.input);a.value.set(O,E.id);const R={id:E.id,name:E.name,input:E.input,signature:O,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return f(C,R),console.log(`Created tool call ${R.id} for ${R.name}`),R}function b(C,E){console.log("handlePermissionRequest received:",E);const O=E.metadata?.tool_name||E.tool_name,R=E.metadata?.input_params||E.input_params,I=E.metadata?.request_id||E.request_id,A=E.metadata?.suggestions||E.suggestions||[];console.log("Extracted data:",{toolName:O,inputParams:R,requestId:I,suggestions:A});const W=k(O,R),V=a.value.get(W);V?(m.value.set(I,V),$(C,V,{status:"permission_required",permissionRequestId:I,suggestions:A}),console.log(`Permission required for tool ${V}`,{suggestions:A})):console.warn("No tool use ID found for permission request signature:",W,{toolName:O,inputParams:R,availableSignatures:Array.from(a.value.keys())})}function y(C,E){const O=m.value.get(E.request_id);if(O){const R={permissionDecision:E.decision,appliedUpdates:E.applied_updates||[]};E.decision==="allow"?R.status="executing":(R.status="completed",R.result={error:!0,message:E.reasoning||"Permission denied"},R.isExpanded=!1),$(C,O,R),console.log(`Permission ${E.decision} for tool ${O}`)}}function x(C,E){const O=E.tool_use_id;$(C,O,{status:E.is_error?"error":"completed",result:{error:E.is_error,content:E.content},isExpanded:!1}),console.log(`Tool ${O} ${E.is_error?"failed":"completed"}`)}function N(C,E){const O=t.value.get(C);if(O){const R=O.find(I=>I.id===E);R&&(R.isExpanded=!R.isExpanded,t.value=new Map(t.value))}}function k(C,E){if(!C)return"unknown:{}";if(!E||typeof E!="object")return`${C}:{}`;const O=JSON.stringify(E,Object.keys(E).sort());return`${C}:${O}`}function S(C,E,O){const R=l.value.get(C)||new Map;R.set(E,{reason:"denied",message:O}),l.value.set(C,R);const I=t.value.get(C);if(I){const A=I.find(W=>W.id===E);A&&A.isExpanded&&(A.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${E} as orphaned: ${O}`)}function U(C,E){return l.value.get(C)?.has(E)||!1}function q(C,E){return l.value.get(C)?.get(E)}function j(C,E){const O=r.value.get(C);O&&O.size>0&&(O.forEach(R=>S(C,R,E)),O.clear())}function M(C){n.value.delete(C),t.value.delete(C),n.value=new Map(n.value),t.value=new Map(t.value)}function P(C){return c.value.get(C)}async function w(C){const E=c.value.get(C);if(!E)return console.log(`No sync needed for session ${C} (no previous messages)`),{syncedCount:0,hasMore:!1};try{console.log(`Syncing messages for session ${C} since ${E}`);const O=await J.get(`/api/sessions/${C}/messages?limit=1000&offset=0`),R=O.messages||[],I=O.has_more||!1,A=new Date(E).getTime(),W=R.filter(F=>F.timestamp?new Date(F.timestamp).getTime()>A:!1);if(W.length===0)return console.log(`No missed messages for session ${C}`),{syncedCount:0,hasMore:!1};console.log(`Synced ${W.length} missed messages for session ${C}`);const V=n.value.get(C)||[],z=new Set(V.map(F=>F.id).filter(Boolean)),oe=W.filter(F=>!F.id||!z.has(F.id));console.log(`After deduplication: ${oe.length} unique new messages`);const fe=[...V,...oe].sort((F,te)=>{const we=new Date(F.timestamp||0).getTime(),We=new Date(te.timestamp||0).getTime();return we-We});if(n.value.set(C,fe),oe.forEach(F=>{u(C,F),F.metadata?.has_tool_uses&&F.metadata.tool_uses&&F.metadata.tool_uses.forEach(te=>{T(C,te)}),F.metadata?.has_tool_results&&F.metadata.tool_results&&F.metadata.tool_results.forEach(te=>{x(C,te)}),(F.type==="permission_request"||F.metadata?.has_permission_requests)&&b(C,F),F.type==="system"&&(F.subtype==="init"||F.metadata?.subtype==="init")&&F.metadata?.init_data&&K().storeInitData(C,F.metadata.init_data)}),fe.length>0){const F=fe[fe.length-1];F.timestamp&&c.value.set(C,F.timestamp)}return n.value=new Map(n.value),{syncedCount:oe.length,hasMore:I}}catch(O){return console.error(`Failed to sync messages for session ${C}:`,O),{syncedCount:0,hasMore:!1,error:O.message}}}const _=K();return ee(()=>Array.from(_.sessions.values()).map(E=>({id:E.session_id,state:E.state})),(C,E)=>{E&&C.forEach((O,R)=>{const I=E[R];if(!I||I.id!==O.id)return;const A=["active","paused","starting"].includes(I.state),W=!["active","paused","starting"].includes(O.state);A&&W&&j(O.id,"Session was terminated")})},{deep:!0}),{messagesBySession:n,toolCallsBySession:t,activeToolUses:Pe(r),orphanedToolUses:Pe(l),currentMessages:g,currentToolCalls:i,loadMessages:v,addMessage:h,addToolCall:f,updateToolCall:$,handleToolUse:T,handlePermissionRequest:b,handlePermissionResponse:y,handleToolResult:x,toggleToolExpansion:N,clearMessages:M,markToolUseOrphaned:S,isToolUseOrphaned:U,getOrphanedInfo:q,clearOrphanedToolUses:j,getLastReceivedTimestamp:P,syncMessages:w}}),$t=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:ue},Symbol.toStringTag,{value:"Module"}));function wt(n){if(!n)return new Date;if(typeof n=="string"){const t=new Date(n);return isNaN(t.getTime())?new Date:t}return typeof n=="number"?n<1e10?new Date(n*1e3):new Date(n):new Date}function Ce(n){return wt(n).toLocaleTimeString()}const kt={class:"message-row message-row-user"},St=["title"],Ct={class:"message-content-column"},xt=["innerHTML"],Mt={key:0,class:"tool-results mt-2"},jt={class:"tool-results-header text-muted small mb-2"},Tt={class:"d-flex align-items-start gap-2"},Et={class:"flex-grow-1"},Lt={class:"text-muted"},Pt={key:0,class:"text-danger small"},It={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n;ye.setOptions({breaks:!0,gfm:!0});const a=d(()=>Ce(t.message.timestamp)),m=d(()=>`user
${a.value}`),r=d(()=>{const i=t.message.content||"";let v=ye.parse(i);return v=v.replace(/\n</g,"<"),v=v.replace(/\n+$/,""),Ee.sanitize(v)}),l=d(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),c=d(()=>t.message.metadata?.tool_results||[]);function g(i,v){return i?i.length<=v?i:i.substring(0,v)+"...":""}return(i,v)=>(s(),o("div",kt,[e("div",{class:"message-speaker",title:m.value},[...v[0]||(v[0]=[e("span",{class:"speaker-label"},"user",-1)])],8,St),e("div",Ct,[e("div",{class:"message-text",innerHTML:r.value},null,8,xt),l.value?(s(),o("div",Mt,[e("div",jt,[v[1]||(v[1]=e("i",{class:"bi bi-tools"},null,-1)),G(" Tool Results ("+p(c.value.length)+") ",1)]),(s(!0),o(Y,null,Z(c.value,(u,h)=>(s(),o("div",{key:h,class:H(["tool-result-summary p-2 mb-2 rounded",u.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",Tt,[e("span",null,p(u.is_error?"âŒ":"âœ…"),1),e("div",Et,[e("small",Lt,"Tool: "+p(u.tool_use_id),1),u.is_error?(s(),o("div",Pt,p(g(u.content,200)),1)):D("",!0)])])],2))),128))])):D("",!0)])]))}},Dt=B(It,[["__scopeId","data-v-09875214"]]),Nt={class:"thinking-block"},Ot={class:"text-muted ms-auto"},At={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},Rt=["innerHTML"],Ut={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(n){const t=n,a=L(!1),m=d(()=>t.thinking?.length||0),r=d(()=>{const c=t.thinking||"",g=ye.parse(c);return Ee.sanitize(g)});function l(){a.value=!a.value}return(c,g)=>(s(),o("div",Nt,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:l},[e("i",{class:H(["bi",a.value?"bi-chevron-down":"bi-chevron-right"])},null,2),g[0]||(g[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),G(" Thinking ")],-1)),e("small",Ot,p(m.value)+" characters",1)]),a.value?(s(),o("div",At,[e("div",{class:"thinking-text",innerHTML:r.value},null,8,Rt)])):D("",!0)]))}},qt=B(Ut,[["__scopeId","data-v-619a8344"]]),ve=_e("websocket",()=>{const n=L(null),t=L(!1),a=L(0),m=10,r=L(null),l=L(!1),c=L(0),g=5,i=L(null);let v=null;const u=L(0),h=L(null),f=L(new Map),$=L(null),T=L(!1),b=L(0),y=5,x=L(null),N=d(()=>t.value&&(l.value||!i.value)?"connected":t.value?"partial":"disconnected");function k(I){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${I}`}function S(){if(n.value)return;const I=k("/ws/ui");console.log(`Connecting to UI WebSocket: ${I}`),n.value=new WebSocket(I),n.value.onopen=()=>{t.value=!0,a.value=0,console.log("UI WebSocket connected")},n.value.onmessage=A=>{const W=JSON.parse(A.data);_(W)},n.value.onclose=()=>{if(t.value=!1,n.value=null,console.log("UI WebSocket closed"),a.value<m){a.value++;const A=Math.min(2e3*a.value,3e4);console.log(`Reconnecting UI WebSocket in ${A}ms (attempt ${a.value})`),setTimeout(S,A)}},n.value.onerror=A=>{console.error("UI WebSocket error:",A)}}function U(){n.value&&(n.value.close(),n.value=null,t.value=!1)}async function q(I){u.value++;const A=u.value;if(console.log(`[Gen ${A}] Starting connection to session ${I}`),v&&(clearTimeout(v),v=null),await j(),u.value!==A){console.log(`[Gen ${A}] Connection cancelled (current generation: ${u.value})`);return}i.value=I,h.value=A;const W=k(`/ws/session/${I}`);console.log(`[Gen ${A}] Connecting to Session WebSocket: ${W}`),r.value=new WebSocket(W),r.value.onopen=async()=>{if(h.value!==A){console.log(`[Gen ${A}] Ignoring onopen (stale connection, current: ${h.value})`),r.value.close();return}l.value=!0,c.value=0,console.log(`[Gen ${A}] Session WebSocket connected for ${I}`);const V=f.value.get(I);if(f.value.set(I,!0),V){console.log(`[Gen ${A}] Reconnection detected, syncing missed messages...`);try{const oe=await ue().syncMessages(I);oe.syncedCount>0?console.log(`[Gen ${A}] âœ… Synced ${oe.syncedCount} missed messages`):oe.error?console.warn(`[Gen ${A}] âš ï¸ Message sync failed: ${oe.error}`):console.log(`[Gen ${A}] No missed messages to sync`),oe.hasMore&&console.warn(`[Gen ${A}] âš ï¸ More than 1000 missed messages, showing recent 1000 only`)}catch(z){console.error(`[Gen ${A}] Error during message sync:`,z)}}else console.log(`[Gen ${A}] Initial connection, no sync needed`)},r.value.onmessage=V=>{if(h.value!==A){console.log(`[Gen ${A}] Ignoring message (stale connection, current: ${h.value})`);return}const z=JSON.parse(V.data);C(z,I)},r.value.onclose=()=>{l.value=!1,r.value=null,console.log(`[Gen ${A}] Session WebSocket closed for ${I}`);const V=K();if(V.currentSessionId===I&&h.value===A&&c.value<g){c.value++;const z=Math.min(2e3*c.value,3e4);console.log(`[Gen ${A}] Reconnecting Session WebSocket in ${z}ms (attempt ${c.value})`),v=setTimeout(()=>{h.value===A&&V.currentSessionId===I?(v=null,q(I)):console.log(`[Gen ${A}] Skipping reconnect (generation or session changed)`)},z)}},r.value.onerror=V=>{console.error(`[Gen ${A}] Session WebSocket error:`,V)}}function j(){return new Promise(I=>{if(v&&(clearTimeout(v),v=null,console.log("Cancelled pending session reconnect timer")),r.value){const A=i.value,W=()=>{r.value=null,l.value=!1,i.value=null,h.value=null,c.value=0,A&&f.value.delete(A),I()};if(r.value.readyState===WebSocket.CLOSED)W();else{const V=setTimeout(()=>{console.warn("Session WebSocket close timeout - forcing cleanup"),W()},2e3);r.value.addEventListener("close",()=>{clearTimeout(V),W()},{once:!0}),r.value.close()}}else i.value=null,h.value=null,I()})}function M(I){r.value&&l.value?(r.value.send(JSON.stringify({type:"send_message",content:I})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function P(I,A,W=!1,V=null){if(r.value&&l.value){const z={type:"permission_response",request_id:I,decision:A,apply_suggestions:W,timestamp:new Date().toISOString()};V&&(z.clarification_message=V),r.value.send(JSON.stringify(z)),console.log(`Sent permission ${A} for request ${I}`,{applySuggestions:W,clarification:V})}}function w(){r.value&&l.value&&(r.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function _(I){const A=K(),W=ae();switch(I.type){case"sessions_list":I.sessions&&Array.isArray(I.sessions)&&I.sessions.forEach(V=>{A.updateSession(V.session_id,V)});break;case"state_change":I.data&&I.data.session_id&&I.data.session&&A.updateSession(I.data.session_id,I.data.session);break;case"project_updated":if(I.data&&I.data.project){const V=I.data.project;W.updateProjectLocal(V.project_id,V)}break;case"project_deleted":I.data&&I.data.project_id&&W.projects.delete(I.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":n.value?.readyState===WebSocket.OPEN&&n.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",I.type)}}function C(I,A){const W=K();if(W.currentSessionId!==A){console.warn(`Ignoring message for session ${A} (current: ${W.currentSessionId})`);return}const V=ue();switch(I.type){case"message":const z=I.data;if(!z||!z.type){console.warn("Received message event with invalid data:",I);break}if(z.type==="permission_request"){V.handlePermissionRequest(A,z);break}if(z.type==="permission_response"){V.handlePermissionResponse(A,z);break}z.metadata?.has_tool_uses&&z.metadata.tool_uses.forEach(oe=>{V.handleToolUse(A,oe)}),z.metadata?.has_tool_results&&z.metadata.tool_results.forEach(oe=>{V.handleToolResult(A,oe)}),z.type==="system"&&(z.subtype==="init"||z.metadata?.subtype==="init")&&z.metadata?.init_data&&W.storeInitData(A,z.metadata.init_data),V.addMessage(A,z);break;case"permission_request":V.handlePermissionRequest(A,I);break;case"permission_response":V.handlePermissionResponse(A,I);break;case"tool_result":V.handleToolResult(A,I);break;case"state_change":W.updateSession(A,I.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${A}`);break;case"ping":r.value?.readyState===WebSocket.OPEN&&r.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function E(I){O(),x.value=I;const A=k(`/ws/legion/${I}`);console.log(`Connecting to Legion WebSocket: ${A}`),$.value=new WebSocket(A),$.value.onopen=()=>{T.value=!0,b.value=0,console.log(`Legion WebSocket connected for ${I}`)},$.value.onmessage=W=>{const V=JSON.parse(W.data);R(V,I)},$.value.onclose=()=>{if(T.value=!1,$.value=null,console.log(`Legion WebSocket closed for ${I}`),x.value===I&&b.value<y){b.value++;const W=Math.min(2e3*b.value,3e4);setTimeout(()=>E(I),W)}},$.value.onerror=W=>{console.error("Legion WebSocket error:",W)}}function O(){$.value&&($.value.close(),$.value=null,T.value=!1,x.value=null)}function R(I,A){re(async()=>{const{useLegionStore:W}=await Promise.resolve().then(()=>Ka);return{useLegionStore:W}},void 0).then(({useLegionStore:W})=>{const V=W();switch(I.type){case"comm":I.comm&&(V.addComm(A,I.comm),console.log("Legion WebSocket: Received new comm",I.comm));break;case"minion_created":I.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",I.data),re(async()=>{const{useSessionStore:z}=await Promise.resolve().then(()=>De);return{useSessionStore:z}},void 0).then(({useSessionStore:z})=>{z().loadSessions()}));break;case"minion_updated":I.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",I.data),re(async()=>{const{useSessionStore:z}=await Promise.resolve().then(()=>De);return{useSessionStore:z}},void 0).then(({useSessionStore:z})=>{z().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${A}`);break;case"ping":$.value?.readyState===WebSocket.OPEN&&$.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",I.type)}})}return{uiConnected:t,sessionConnected:l,legionConnected:T,overallStatus:N,connectUI:S,disconnectUI:U,connectSession:q,disconnectSession:j,sendMessage:M,sendPermissionResponse:P,interruptSession:w,connectLegion:E,disconnectLegion:O}}),Ft=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:ve},Symbol.toStringTag,{value:"Module"})),Wt={class:"base-tool-handler"},Ht={class:"tool-section"},Bt={class:"tool-parameters"},Vt={class:"tool-code"},zt={key:0,class:"tool-section"},Gt={class:"tool-section-label"},Jt={class:"tool-code"},Kt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),m=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),r=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),l=d(()=>{if(!m.value)return"";const c=t.toolCall.result;return c.content!==void 0?typeof c.content=="string"?c.content:JSON.stringify(c.content,null,2):c.message?c.message:JSON.stringify(c,null,2)});return(c,g)=>(s(),o("div",Wt,[e("div",Ht,[g[0]||(g[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Bt,[e("pre",Vt,p(a.value),1)])]),m.value?(s(),o("div",zt,[e("div",Gt,p(r.value?"Error:":"Result:"),1),e("div",{class:H(["tool-result",{"tool-result-error":r.value}])},[e("pre",Jt,p(l.value),1)],2)])):D("",!0)]))}},Yt=B(Kt,[["__scopeId","data-v-1e69f57d"]]),Qt={class:"read-tool-handler"},Zt={class:"tool-section"},Xt={class:"read-file-info"},es={class:"file-path"},ts={key:0,class:"read-range"},ss={key:0,class:"tool-section"},os={key:0,class:"tool-result tool-result-error"},ns={class:"tool-code"},ls={key:1,class:"file-content-preview"},as={class:"content-header"},rs={class:"line-count-badge"},is={key:0,class:"preview-note"},cs={class:"tool-code content-display"},ds={key:0,class:"more-indicator"},Me=100,us={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.file_path||"Unknown"),m=d(()=>{const $=t.toolCall.input?.offset,T=t.toolCall.input?.limit;return $!==void 0||T!==void 0}),r=d(()=>{const $=t.toolCall.input?.offset;return $!==void 0?$+1:1}),l=d(()=>{const $=t.toolCall.input?.offset||0,T=t.toolCall.input?.limit;return T!==void 0?$+T:"âˆž"}),c=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),g=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),i=d(()=>{if(!c.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)}),v=d(()=>g.value||!i.value?[]:i.value.split(`
`)),u=d(()=>v.value.length),h=d(()=>u.value>Me),f=d(()=>g.value?"":v.value.slice(0,Me).join(`
`));return($,T)=>(s(),o("div",Qt,[e("div",Zt,[e("div",Xt,[T[0]||(T[0]=e("span",{class:"file-icon"},"ðŸ“„",-1)),T[1]||(T[1]=e("strong",null,"Reading:",-1)),e("code",es,p(a.value),1),m.value?(s(),o("span",ts,"Lines "+p(r.value)+"-"+p(l.value),1)):D("",!0)])]),c.value?(s(),o("div",ss,[g.value?(s(),o("div",os,[e("pre",ns,p(i.value),1)])):(s(),o("div",ls,[e("div",as,[T[2]||(T[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",rs,p(u.value)+" lines",1),h.value?(s(),o("span",is,"(showing first "+p(Me)+")")):D("",!0)]),e("pre",cs,p(f.value),1),h.value?(s(),o("div",ds,"...")):D("",!0)]))])):D("",!0)]))}},ms=B(us,[["__scopeId","data-v-1f2b0569"]]),ps={class:"write-tool-handler"},vs={class:"tool-section"},fs={class:"write-file-info mb-2"},gs={class:"file-path"},_s={class:"write-content-preview"},hs={class:"content-header"},bs={class:"line-count-badge"},ys={key:0,class:"preview-note"},$s={class:"tool-code content-display"},ws={key:0,class:"more-indicator"},ks={key:0,class:"tool-section"},Ss={key:0,class:"tool-result tool-result-error"},Cs={class:"tool-code"},xs={key:1,class:"tool-result tool-result-success"},Ms={class:"success-message"},je=100,js={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.file_path||"Unknown"),m=d(()=>t.toolCall.input?.content||""),r=d(()=>m.value.split(`
`)),l=d(()=>r.value.length),c=d(()=>l.value>je),g=d(()=>r.value.slice(0,je).join(`
`)),i=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),u=d(()=>{if(!i.value)return"";const h=t.toolCall.result;return h.content!==void 0?typeof h.content=="string"?h.content:JSON.stringify(h.content,null,2):h.message?h.message:JSON.stringify(h,null,2)});return(h,f)=>(s(),o("div",ps,[e("div",vs,[e("div",fs,[f[0]||(f[0]=e("span",{class:"file-icon"},"ðŸ“",-1)),f[1]||(f[1]=e("strong",null,"Writing:",-1)),e("code",gs,p(a.value),1)]),e("div",_s,[e("div",hs,[f[2]||(f[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",bs,p(l.value)+" lines",1),c.value?(s(),o("span",ys,"(showing first "+p(je)+")")):D("",!0)]),e("pre",$s,p(g.value),1),c.value?(s(),o("div",ws,"...")):D("",!0)])]),i.value?(s(),o("div",ks,[v.value?(s(),o("div",Ss,[f[3]||(f[3]=e("strong",null,"Error:",-1)),e("pre",Cs,p(u.value),1)])):(s(),o("div",xs,[e("div",Ms,[f[4]||(f[4]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"File created successfully ("+p(l.value)+" lines written)",1)])]))])):D("",!0)]))}},Ts=B(js,[["__scopeId","data-v-ddc24a0f"]]),Es={class:"bash-tool-handler"},Ls={class:"tool-section"},Ps={class:"bash-header"},Is={class:"bash-header-content"},Ds={key:0,class:"bash-description"},Ns={key:1,class:"bash-flags"},Os={class:"bash-command-section"},As={class:"bash-command-content"},Rs={key:0,class:"tool-section"},Us={key:0,class:"bash-output"},qs={key:1,class:"bash-output-empty"},Fs={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.command||""),m=d(()=>t.toolCall.input?.description||""),r=d(()=>t.toolCall.input?.timeout),l=d(()=>t.toolCall.input?.run_in_background||!1),c=d(()=>r.value||l.value),g=d(()=>{const f=[];return r.value&&f.push(`timeout: ${r.value}ms`),l.value&&f.push("background"),f.join(", ")}),i=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),u=d(()=>v.value?"tool-result-error":"tool-result-success"),h=d(()=>{if(!i.value)return"";const f=t.toolCall.result;return f.content!==void 0?typeof f.content=="string"?f.content:JSON.stringify(f.content,null,2):f.message?f.message:JSON.stringify(f,null,2)});return(f,$)=>(s(),o("div",Es,[e("div",Ls,[e("div",Ps,[$[1]||($[1]=e("span",{class:"bash-icon"},"ðŸ’»",-1)),e("div",Is,[m.value?(s(),o("div",Ds,[$[0]||($[0]=e("strong",null,"Description:",-1)),G(" "+p(m.value),1)])):D("",!0),c.value?(s(),o("div",Ns,p(g.value),1)):D("",!0)])]),e("div",Os,[$[2]||($[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",As,p(a.value),1)])]),i.value?(s(),o("div",Rs,[e("div",{class:H(["tool-result",u.value])},[$[3]||($[3]=e("strong",null,"Output:",-1)),h.value?(s(),o("pre",Us,p(h.value),1)):(s(),o("div",qs,"No output"))],2)])):D("",!0)]))}},Ws=B(Fs,[["__scopeId","data-v-ab50fe73"]]),Hs={class:"todo-tool-handler"},Bs={class:"tool-section"},Vs={class:"todo-header"},zs={class:"todo-summary"},Gs={key:0,class:"todo-count todo-count-completed"},Js={key:1,class:"todo-count todo-count-in-progress"},Ks={key:2,class:"todo-count todo-count-pending"},Ys={class:"todo-checklist"},Qs={class:"todo-checkbox"},Zs={class:"todo-content"},Xs={key:0,class:"tool-section"},eo={key:0,class:"tool-result tool-result-error"},to={class:"tool-code"},so={key:1,class:"tool-result tool-result-success"},oo={class:"success-message"},no={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.todos||[]),m=d(()=>a.value.filter(u=>u.status==="completed").length),r=d(()=>a.value.filter(u=>u.status==="in_progress").length),l=d(()=>a.value.filter(u=>u.status==="pending").length);function c(u){return{pending:"â˜",in_progress:"â—",completed:"â˜‘"}[u]||"â˜"}const g=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),i=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),v=d(()=>{if(!g.value)return"";const u=t.toolCall.result;return u.content!==void 0?typeof u.content=="string"?u.content:JSON.stringify(u.content,null,2):u.message?u.message:JSON.stringify(u,null,2)});return(u,h)=>(s(),o("div",Hs,[e("div",Bs,[e("div",Vs,[h[0]||(h[0]=e("span",{class:"todo-icon"},"ðŸ“‹",-1)),h[1]||(h[1]=e("strong",null,"Task List:",-1)),e("div",zs,[m.value>0?(s(),o("span",Gs,p(m.value)+" completed ",1)):D("",!0),r.value>0?(s(),o("span",Js,p(r.value)+" in progress ",1)):D("",!0),l.value>0?(s(),o("span",Ks,p(l.value)+" pending ",1)):D("",!0)])]),e("div",Ys,[(s(!0),o(Y,null,Z(a.value,(f,$)=>(s(),o("div",{key:$,class:H(["todo-item",`todo-${f.status}`])},[e("span",Qs,p(c(f.status)),1),e("span",Zs,p(f.content),1)],2))),128))])]),g.value?(s(),o("div",Xs,[i.value?(s(),o("div",eo,[h[2]||(h[2]=e("strong",null,"Error:",-1)),e("pre",to,p(v.value),1)])):(s(),o("div",so,[e("div",oo,[h[3]||(h[3]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"Task list updated ("+p(a.value.length)+" tasks)",1)])]))])):D("",!0)]))}},lo=B(no,[["__scopeId","data-v-bbe55ee7"]]),ao={class:"edit-tool-handler"},ro={class:"tool-section"},io={class:"edit-file-info"},co={class:"file-path"},uo={key:0,class:"replace-all-badge"},mo={class:"edit-diff-container"},po={class:"diff-header"},vo={class:"diff-stats"},fo={class:"stat-removed"},go={class:"stat-added"},_o={class:"unified-diff"},ho={class:"diff-scroll-container"},bo={class:"diff-marker"},yo={class:"diff-content"},$o={key:0,class:"tool-section"},wo={key:0,class:"tool-result tool-result-error"},ko={class:"tool-code"},So={key:1,class:"tool-result tool-result-success"},Co={class:"success-message"},xo={key:0,class:"success-detail"},Mo={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.file_path||"Unknown"),m=d(()=>t.toolCall.input?.old_string||""),r=d(()=>t.toolCall.input?.new_string||""),l=d(()=>t.toolCall.input?.replace_all||!1),c=d(()=>{const $=Ge(a.value,m.value,r.value,"","",{context:3}).split(`
`),T=[];for(let b=4;b<$.length;b++){const y=$[b];y&&(y.startsWith("-")?T.push({type:"removed",content:y.substring(1)}):y.startsWith("+")?T.push({type:"added",content:y.substring(1)}):y.startsWith(" ")?T.push({type:"context",content:y.substring(1)}):y.startsWith("@@")&&T.push({type:"hunk",content:y}))}return T}),g=d(()=>c.value.filter(f=>f.type==="removed").length),i=d(()=>c.value.filter(f=>f.type==="added").length),v=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),u=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),h=d(()=>{if(!v.value)return"";const f=t.toolCall.result;return f.content!==void 0?typeof f.content=="string"?f.content:JSON.stringify(f.content,null,2):f.message?f.message:JSON.stringify(f,null,2)});return(f,$)=>(s(),o("div",ao,[e("div",ro,[e("div",io,[$[0]||($[0]=e("span",{class:"file-icon"},"âœï¸",-1)),$[1]||($[1]=e("strong",null,"Editing:",-1)),e("code",co,p(a.value),1),l.value?(s(),o("span",uo,"Replace All")):D("",!0)]),e("div",mo,[e("div",po,[$[2]||($[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",vo,[e("span",fo,"-"+p(g.value),1),e("span",go,"+"+p(i.value),1)])]),e("div",_o,[e("div",ho,[(s(!0),o(Y,null,Z(c.value,(T,b)=>(s(),o("div",{key:b,class:H(["diff-line",{"diff-line-removed":T.type==="removed","diff-line-added":T.type==="added","diff-line-context":T.type==="context","diff-line-hunk":T.type==="hunk"}])},[e("span",bo,p(T.type==="removed"?"-":T.type==="added"?"+":T.type==="hunk"?"@":" "),1),e("span",yo,p(T.content),1)],2))),128))])])])]),v.value?(s(),o("div",$o,[u.value?(s(),o("div",wo,[$[3]||($[3]=e("strong",null,"Error:",-1)),e("pre",ko,p(h.value),1)])):(s(),o("div",So,[e("div",Co,[$[4]||($[4]=e("span",{class:"success-icon"},"âœ…",-1)),$[5]||($[5]=e("strong",null,"File edited successfully",-1)),l.value?(s(),o("span",xo,"(all occurrences replaced)")):D("",!0)])]))])):D("",!0)]))}},jo=B(Mo,[["__scopeId","data-v-16b90adc"]]),To={class:"search-tool-handler"},Eo={class:"tool-section"},Lo={class:"search-info"},Po={class:"search-icon"},Io={class:"search-pattern"},Do={key:0,class:"search-path"},No={key:1,class:"search-filters"},Oo={key:0,class:"filter-badge"},Ao={key:1,class:"filter-badge"},Ro={key:2,class:"filter-badge"},Uo={key:0,class:"tool-section"},qo={key:0,class:"tool-result tool-result-error"},Fo={class:"tool-code"},Wo={key:1,class:"search-results"},Ho={class:"results-header"},Bo={class:"results-label"},Vo={class:"results-count-badge"},zo={class:"results-content"},Go={class:"tool-code"},Jo={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.name==="Grep");d(()=>t.toolCall.name==="Glob");const m=d(()=>t.toolCall.input?.pattern||"Unknown"),r=d(()=>t.toolCall.input?.path||null),l=d(()=>t.toolCall.input?.type||null),c=d(()=>t.toolCall.input?.glob||null),g=d(()=>t.toolCall.input?.["-i"]||!1),i=d(()=>l.value||c.value||g.value),v=d(()=>a.value?"ðŸ”":"ðŸ“"),u=d(()=>a.value?"Searching content":"Finding files"),h=d(()=>a.value?"Matches":"Files found"),f=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),$=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),T=d(()=>{if(!f.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)}),b=d(()=>!f.value||$.value||!T.value?0:T.value.split(`
`).filter(x=>x.trim()).length);return(y,x)=>(s(),o("div",To,[e("div",Eo,[e("div",Lo,[e("span",Po,p(v.value),1),e("strong",null,p(u.value)+":",1),e("code",Io,p(m.value),1),r.value?(s(),o("span",Do,"in "+p(r.value),1)):D("",!0),i.value?(s(),o("span",No,[l.value?(s(),o("span",Oo,"type: "+p(l.value),1)):D("",!0),c.value?(s(),o("span",Ao,"glob: "+p(c.value),1)):D("",!0),g.value?(s(),o("span",Ro,"case-insensitive")):D("",!0)])):D("",!0)])]),f.value?(s(),o("div",Uo,[$.value?(s(),o("div",qo,[x[0]||(x[0]=e("strong",null,"Error:",-1)),e("pre",Fo,p(T.value),1)])):(s(),o("div",Wo,[e("div",Ho,[e("span",Bo,p(h.value)+":",1),e("span",Vo,p(b.value)+" "+p(b.value===1?"match":"matches"),1)]),e("div",zo,[e("pre",Go,p(T.value),1)])]))])):D("",!0)]))}},Ne=B(Jo,[["__scopeId","data-v-0d272c39"]]),Ko={class:"web-tool-handler"},Yo={class:"tool-section"},Qo={class:"web-info"},Zo={class:"web-icon"},Xo=["href"],en={key:1,class:"web-query"},tn={key:0,class:"web-prompt-container"},sn={class:"prompt-content"},on={key:1,class:"web-domains"},nn={class:"domains-label"},ln={key:0,class:"tool-section"},an={key:0,class:"tool-result tool-result-error"},rn={class:"tool-code"},cn={key:1,class:"web-results"},dn={class:"results-header"},un={class:"results-label"},mn={class:"results-content"},pn={class:"tool-code"},vn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.name==="WebFetch");d(()=>t.toolCall.name==="WebSearch");const m=d(()=>t.toolCall.input?.url||null),r=d(()=>t.toolCall.input?.query||null),l=d(()=>t.toolCall.input?.prompt||null),c=d(()=>t.toolCall.input?.allowed_domains||[]),g=d(()=>t.toolCall.input?.blocked_domains||[]),i=d(()=>c.value.length>0?c.value:g.value.length>0?g.value:[]),v=d(()=>c.value.length>0?"Allowed domains":g.value.length>0?"Blocked domains":"Domains"),u=d(()=>a.value?"ðŸŒ":"ðŸ”Ž"),h=d(()=>a.value?"Fetching URL":"Searching web"),f=d(()=>a.value?"Fetched content":"Search results"),$=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),T=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),b=d(()=>{if(!$.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)});return(y,x)=>(s(),o("div",Ko,[e("div",Yo,[e("div",Qo,[e("span",Zo,p(u.value),1),e("strong",null,p(h.value)+":",1),m.value?(s(),o("a",{key:0,href:m.value,target:"_blank",class:"web-url"},p(m.value),9,Xo)):r.value?(s(),o("code",en,p(r.value),1)):D("",!0)]),l.value?(s(),o("div",tn,[x[0]||(x[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",sn,p(l.value),1)])):D("",!0),i.value.length>0?(s(),o("div",on,[e("span",nn,p(v.value)+":",1),(s(!0),o(Y,null,Z(i.value,N=>(s(),o("span",{key:N,class:"domain-badge"},p(N),1))),128))])):D("",!0)]),$.value?(s(),o("div",ln,[T.value?(s(),o("div",an,[x[1]||(x[1]=e("strong",null,"Error:",-1)),e("pre",rn,p(b.value),1)])):(s(),o("div",cn,[e("div",dn,[e("span",un,p(f.value)+":",1)]),e("div",mn,[e("pre",pn,p(b.value),1)])]))])):D("",!0)]))}},Oe=B(vn,[["__scopeId","data-v-62b55b55"]]),fn={class:"task-tool-handler"},gn={class:"tool-section"},_n={class:"task-header"},hn={key:0,class:"agent-type-badge"},bn={key:0,class:"task-description"},yn={class:"description-content"},$n={key:1,class:"task-prompt-container"},wn={class:"prompt-header"},kn={class:"prompt-length"},Sn={class:"prompt-code"},Cn={key:0,class:"tool-section"},xn={key:0,class:"tool-result tool-result-error"},Mn={class:"tool-code"},jn={key:1,class:"agent-output"},Tn={class:"output-header"},En={key:0,class:"output-count-badge"},Ln={class:"output-content"},Pn={class:"tool-code"},In={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.description||null),m=d(()=>t.toolCall.input?.prompt||null),r=d(()=>t.toolCall.input?.subagent_type||null),l=d(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),c=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),g=d(()=>{if(!l.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)}),i=d(()=>g.value?g.value.split(`
`).length:0);return(v,u)=>(s(),o("div",fn,[e("div",gn,[e("div",_n,[u[0]||(u[0]=e("span",{class:"task-icon"},"ðŸ¤–",-1)),u[1]||(u[1]=e("strong",null,"Agent Task:",-1)),r.value?(s(),o("span",hn,p(r.value),1)):D("",!0)]),a.value?(s(),o("div",bn,[u[2]||(u[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",yn,p(a.value),1)])):D("",!0),m.value?(s(),o("div",$n,[e("div",wn,[u[3]||(u[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",kn,p(m.value.length)+" characters",1)]),e("pre",Sn,p(m.value),1)])):D("",!0)]),l.value?(s(),o("div",Cn,[c.value?(s(),o("div",xn,[u[4]||(u[4]=e("strong",null,"Error:",-1)),e("pre",Mn,p(g.value),1)])):(s(),o("div",jn,[e("div",Tn,[u[5]||(u[5]=e("span",{class:"output-label"},"Agent Output:",-1)),i.value>0?(s(),o("span",En,p(i.value)+" lines",1)):D("",!0)]),e("div",Ln,[e("pre",Pn,p(g.value),1)])]))])):D("",!0)]))}},Dn=B(In,[["__scopeId","data-v-c520c244"]]),Nn={class:"notebook-edit-tool-handler"},On={class:"tool-section"},An={class:"notebook-info"},Rn={class:"file-path"},Un={class:"cell-info mt-2"},qn={class:"info-row"},Fn={class:"info-row"},Wn={key:0,class:"info-row"},Hn={class:"badge bg-info"},Bn={key:0,class:"source-preview mt-3"},Vn={class:"preview-header"},zn={class:"preview-stats"},Gn={class:"source-code"},Jn={key:0,class:"tool-section"},Kn={key:0},Yn={key:1,class:"text-danger"},Qn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.notebook_path||"Unknown"),m=d(()=>t.toolCall.input?.cell_id),r=d(()=>t.toolCall.input?.cell_type||"code"),l=d(()=>t.toolCall.input?.edit_mode||"replace"),c=d(()=>t.toolCall.input?.new_source||""),g=d(()=>c.value.split(`
`).length),i=d(()=>r.value==="code"?"bg-primary":"bg-secondary"),v=d(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),u=d(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const h=l.value;return h==="insert"?"Cell inserted successfully":h==="delete"?"Cell deleted successfully":"Cell updated successfully"});return(h,f)=>(s(),o("div",Nn,[e("div",On,[e("div",An,[f[0]||(f[0]=e("span",{class:"notebook-icon"},"ðŸ““",-1)),f[1]||(f[1]=e("strong",null,"Notebook:",-1)),e("code",Rn,p(a.value),1)]),e("div",Un,[e("div",qn,[f[2]||(f[2]=e("strong",null,"Cell ID:",-1)),e("code",null,p(m.value||"N/A"),1)]),e("div",Fn,[f[3]||(f[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:H(["badge",i.value])},p(r.value),3)]),l.value?(s(),o("div",Wn,[f[4]||(f[4]=e("strong",null,"Edit Mode:",-1)),e("span",Hn,p(l.value),1)])):D("",!0)]),c.value?(s(),o("div",Bn,[e("div",Vn,[f[5]||(f[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",zn,p(g.value)+" lines",1)]),e("pre",Gn,[e("code",null,p(c.value),1)])])):D("",!0)]),n.toolCall.result?(s(),o("div",Jn,[f[8]||(f[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:H(["tool-result",v.value])},[n.toolCall.result.success!==!1?(s(),o("div",Kn,[f[6]||(f[6]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+p(u.value),1)])):(s(),o("div",Yn,[f[7]||(f[7]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+p(n.toolCall.result.error||"Operation failed"),1)]))],2)])):D("",!0)]))}},Zn=B(Qn,[["__scopeId","data-v-bf9ef8f9"]]),Xn={class:"shell-tool-handler"},el={class:"tool-section"},tl={class:"shell-info"},sl={class:"shell-icon"},ol={key:0,class:"shell-id"},nl={key:0,class:"filter-info mt-2"},ll={class:"filter-pattern"},al={key:0,class:"tool-section"},rl={class:"result-header mb-2"},il={key:0,class:"shell-output"},cl={key:0},dl={key:1,class:"text-danger"},ul={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.name==="BashOutput"?"ðŸ“¤":t.toolCall.name==="KillShell"?"ðŸ›‘":"ðŸš"),m=d(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),r=d(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),l=d(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),c=d(()=>t.toolCall.input?.filter),g=d(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),i=d(()=>t.toolCall.result?.status),v=d(()=>{const f=i.value;return f==="running"?"bg-success":f==="completed"?"bg-secondary":f==="killed"||f==="terminated"?"bg-danger":"bg-info"}),u=d(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),h=d(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return(f,$)=>(s(),o("div",Xn,[e("div",el,[e("div",tl,[e("span",sl,p(a.value),1),e("strong",null,p(m.value)+":",1),l.value?(s(),o("code",ol,"Shell "+p(l.value),1)):D("",!0)]),n.toolCall.name==="BashOutput"&&c.value?(s(),o("div",nl,[$[0]||($[0]=e("strong",null,"Filter:",-1)),e("code",ll,p(c.value),1)])):D("",!0)]),n.toolCall.result?(s(),o("div",al,[e("div",rl,[e("strong",null,p(r.value)+":",1),i.value?(s(),o("span",{key:0,class:H(["badge",v.value])},p(i.value),3)):D("",!0)]),g.value?(s(),o("div",il,[e("pre",null,[e("code",null,p(g.value),1)])])):(s(),o("div",{key:1,class:H(["tool-result",u.value])},[n.toolCall.result.success!==!1?(s(),o("div",cl,[$[1]||($[1]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+p(h.value),1)])):(s(),o("div",dl,[$[2]||($[2]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+p(n.toolCall.result.error||"Operation failed"),1)]))],2))])):D("",!0)]))}},Ae=B(ul,[["__scopeId","data-v-1a461f4c"]]),ml={class:"skill-tool-handler"},pl={key:0,class:"tool-section"},vl={class:"d-flex align-items-center gap-2"},fl={class:"text-muted small"},gl={key:0,class:"skill-content-body"},_l={class:"skill-content-text"},hl={key:1,class:"tool-section mt-3"},bl={class:"tool-result tool-result-error"},yl={class:"tool-code"},$l={__name:"SkillToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=ue(),m=K(),r=L(!1);function l(){r.value=!r.value}d(()=>t.toolCall.input?.command||"Unknown Skill"),d(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),d(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}});const c=d(()=>{const f=m.currentSessionId;if(!f)return{running:null,content:null};const $=a.messagesBySession.get(f)||[],T=$.findIndex(x=>x.type==="user"&&x.metadata?.has_tool_results&&x.metadata?.tool_results?.some(N=>N.tool_use_id===t.toolCall.id));if(T===-1)return{running:null,content:null};let b=null,y=null;for(let x=T+1;x<Math.min(T+3,$.length);x++){const N=$[x];if(N.type!=="user")continue;const k=N.content||"";k.includes("<command-message>")&&k.includes("skill is running")?b=N:k.startsWith("Base directory for this skill:")&&(y=N)}return{running:b,content:y}});d(()=>{const f=c.value.content;if(!f)return null;const T=(f.content||"").match(/Base directory(?:\s+for\s+this\s+skill)?:\s*(.+?)(?:\n|$)/i);return T&&T[1]?T[1].trim():null});const g=d(()=>{const f=c.value.content;if(!f)return"";const $=f.content||"",T=/Base directory(?:\s+for\s+this\s+skill)?:.*?\n/i;return $.replace(T,"").trim()}),i=d(()=>g.value.length>0),v=d(()=>g.value?g.value.split(`
`).length:0),u=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),h=d(()=>{if(!u.value)return"";const f=t.toolCall.result;return f?.message?f.message:f?.error?f.error:"An error occurred"});return(f,$)=>(s(),o("div",ml,[i.value?(s(),o("div",pl,[e("div",{class:"skill-content-header",onClick:l},[e("div",vl,[e("i",{class:H(["bi",r.value?"bi-chevron-down":"bi-chevron-right"])},null,2),$[0]||($[0]=e("strong",null,"Skill Content",-1)),e("span",fl,"("+p(v.value)+" lines)",1)])]),r.value?(s(),o("div",gl,[e("pre",_l,p(g.value),1)])):D("",!0)])):D("",!0),u.value?(s(),o("div",hl,[$[1]||($[1]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",bl,[e("pre",yl,p(h.value),1)])])):D("",!0)]))}},wl=B($l,[["__scopeId","data-v-ba9a91da"]]),kl={class:"slashcommand-tool-handler"},Sl={key:0,class:"tool-section"},Cl={class:"d-flex align-items-center gap-2"},xl={class:"text-muted small"},Ml={key:0,class:"command-content-body"},jl={class:"command-content-text"},Tl={key:1,class:"tool-section mt-3"},El={class:"tool-result tool-result-error"},Ll={class:"tool-code"},Pl={__name:"SlashCommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=ue(),m=K(),r=L(!1);function l(){r.value=!r.value}d(()=>t.toolCall.input?.command||"Unknown Command"),d(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),d(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}});const c=d(()=>{const f=m.currentSessionId;if(!f)return{running:null,content:null};const $=a.messagesBySession.get(f)||[],T=$.findIndex(x=>x.type==="user"&&x.metadata?.has_tool_results&&x.metadata?.tool_results?.some(N=>N.tool_use_id===t.toolCall.id));if(T===-1)return{running:null,content:null};let b=null,y=null;for(let x=T+1;x<Math.min(T+3,$.length);x++){const N=$[x];if(N.type!=="user")continue;const k=N.content||"";k.includes("<command-message>")&&k.includes("<command-name>")&&k.includes("<command-args>")?b=N:k.includes("ARGUMENTS:")&&(y=N)}return{running:b,content:y}});d(()=>{const f=c.value.running;if(!f)return null;const T=(f.content||"").match(/<command-args>(.+?)<\/command-args>/s);return T&&T[1]?T[1].trim():null});const g=d(()=>{const f=c.value.content;if(!f)return"";const $=f.content||"",T=/\nARGUMENTS:.*$/s;return $.replace(T,"").replace(/<command-message>.*?<\/command-message>/s,"").replace(/<command-name>.*?<\/command-name>/s,"").replace(/<command-args>.*?<\/command-args>/s,"").trim()}),i=d(()=>g.value.length>0),v=d(()=>g.value?g.value.split(`
`).length:0),u=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),h=d(()=>{if(!u.value)return"";const f=t.toolCall.result;return f?.message?f.message:f?.error?f.error:"An error occurred"});return(f,$)=>(s(),o("div",kl,[i.value?(s(),o("div",Sl,[e("div",{class:"command-content-header",onClick:l},[e("div",Cl,[e("i",{class:H(["bi",r.value?"bi-chevron-down":"bi-chevron-right"])},null,2),$[0]||($[0]=e("strong",null,"Command Content",-1)),e("span",xl,"("+p(v.value)+" lines)",1)])]),r.value?(s(),o("div",Ml,[e("pre",jl,p(g.value),1)])):D("",!0)])):D("",!0),u.value?(s(),o("div",Tl,[$[1]||($[1]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",El,[e("pre",Ll,p(h.value),1)])])):D("",!0)]))}},Il=B(Pl,[["__scopeId","data-v-17d3444e"]]),Dl={class:"exit-plan-mode-tool-handler"},Nl={class:"tool-section"},Ol={key:0,class:"plan-content mt-2"},Al={class:"plan-text"},Rl={key:0,class:"tool-section"},Ul={key:0},ql={key:1,class:"text-danger"},Fl={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>t.toolCall.input?.plan),m=d(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(r,l)=>(s(),o("div",Dl,[e("div",Nl,[l[1]||(l[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"ðŸ“‹"),e("strong",null,"Exiting Plan Mode")],-1)),a.value?(s(),o("div",Ol,[l[0]||(l[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",Al,p(a.value),1)])):D("",!0)]),n.toolCall.result?(s(),o("div",Rl,[l[4]||(l[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:H(["tool-result",m.value])},[n.toolCall.result.success!==!1?(s(),o("div",Ul,[...l[2]||(l[2]=[e("i",{class:"bi bi-check-circle"},null,-1),G(" Permission mode reverted to default ",-1)])])):(s(),o("div",ql,[l[3]||(l[3]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+p(n.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):D("",!0)]))}},Wl=B(Fl,[["__scopeId","data-v-bd35183e"]]),Hl={class:"d-flex align-items-center gap-2 flex-grow-1 min-width-0"},Bl={class:"tool-status-icon"},Vl=["title"],zl={class:"d-flex align-items-center gap-2"},Gl={class:"text-muted"},Jl={key:0,class:"card-body"},Kl={key:0,class:"alert alert-warning mb-3"},Yl={class:"d-flex align-items-center"},Ql={class:"mb-0 small"},Zl={key:1,class:"permission-prompt mt-3"},Xl={class:"alert alert-warning mb-3"},ea={class:"mb-0"},ta={class:"tool-name"},sa={key:0,class:"suggestions-section mb-3"},oa={class:"alert alert-info mb-0"},na={class:"suggestion-details p-2 bg-white rounded"},la={class:"permission-buttons d-flex gap-2 mb-3"},aa=["disabled"],ra=["disabled"],ia=["disabled"],ca={class:"guidance-section mt-3"},da=["disabled"],ua=["disabled"],ma={key:2,class:"mt-3"},pa={class:"alert alert-warning mb-0"},va={class:"d-flex align-items-center"},fa={class:"mb-0 small"},ga={key:3,class:"tool-section"},_a={class:"alert alert-danger mb-0"},ha={key:0},ba={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,a=ue(),m=K(),r=ve(),l=L(!1),c=L(null),g=L(""),i=d(()=>a.isToolUseOrphaned(m.currentSessionId,t.toolCall.id)),v=d(()=>a.getOrphanedInfo(m.currentSessionId,t.toolCall.id)),u={Read:ms,Write:Ts,Bash:Ws,TodoWrite:lo,Edit:jo,Grep:Ne,Glob:Ne,WebFetch:Oe,WebSearch:Oe,Task:Dn,NotebookEdit:Zn,BashOutput:Ae,KillShell:Ae,SlashCommand:Il,Skill:wl,ExitPlanMode:Wl},h=d(()=>{const w=t.toolCall.name;return u[w]?u[w]:Yt}),f=d(()=>{const w=[];switch(t.toolCall.status){case"pending":w.push("border-secondary");break;case"permission_required":w.push("border-warning");break;case"executing":w.push("border-primary");break;case"completed":b.value||t.toolCall.permissionDecision==="deny"?w.push("border-danger"):w.push("border-success");break;case"error":w.push("border-danger");break}return w.join(" ")}),$=d(()=>{switch(t.toolCall.status){case"pending":return"ðŸ”„";case"permission_required":return"â“";case"executing":return"âš¡";case"completed":return t.toolCall.permissionDecision==="deny"?"âŒ":b.value?"ðŸ’¥":"âœ…";case"error":return"ðŸ’¥";default:return"ðŸ”§"}}),T=d(()=>Ce(t.toolCall.timestamp)),b=d(()=>t.toolCall.result?.error||t.toolCall.status==="error"),y=d(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function x(w){if(!w)return"";const _=w.replace(/\\/g,"/").split("/");return _[_.length-1]}function N(w,_=200){return w?w.length<=_?w:w.substring(0,_)+"...":""}function k(w){if(!w)return null;if(w.content){const _=w.content.match(/exit code (\d+)/i);if(_)return parseInt(_[1])}return w.error?1:0}function S(w,_){const C=w?w.split(`
`).length:0;return{added:_?_.split(`
`).length:0,removed:C}}const U=d(()=>{const w=t.toolCall.name,_=t.toolCall.input||{},C=t.toolCall.result,E=t.toolCall.status;switch(w){case"Bash":case"Shell":case"Command":{const O=N(_.command,200);if(E==="completed"&&C){const R=k(C);return`Bash: ${O} (exit ${R})`}return`Bash: ${O}`}case"SlashCommand":{const O=N(_.command,200);return E==="completed"&&C?`SlashCommand: ${O}`:`SlashCommand: ${O}`}case"Edit":{const O=x(_.file_path);if(E==="completed"&&C&&!C.error){const{added:R,removed:I}=S(_.old_string,_.new_string);return R===I?`Edit: ${O} (${R} lines changed)`:`Edit: ${O} (${R} lines added, ${I} removed)`}return`Edit: ${O}`}case"Read":{const O=x(_.file_path);if(_.offset!==void 0||_.limit!==void 0){const I=(_.offset||0)+1,A=_.limit?(_.offset||0)+_.limit:"âˆž";return`Read: ${O} (lines ${I}-${A})`}return`Read: ${O} (full file)`}case"Write":{const O=x(_.file_path);if(E==="completed"&&C&&!C.error&&_.content){const R=_.content.split(`
`).length;return`Write: ${O} (${R} lines written)`}return`Write: ${O}`}case"Skill":{const O=_.command||"Unknown";return E==="completed"&&C?C.error?`Skill: ${O} (error)`:`Skill: ${O} (completed)`:`Skill: ${O}`}case"Task":{const O=_.subagent_type||"general",R=_.description||"Task";return E==="completed"&&C?C.error?`Task: (${O}) ${R} (error)`:`Task: (${O}) ${R} (completed)`:`Task: (${O}) ${R}`}case"TodoWrite":{if(_.todos&&Array.isArray(_.todos)){const O=_.todos.filter(A=>A.status==="completed").length,R=_.todos.length,I=_.todos.find(A=>A.status==="in_progress");return I?`Todo: Working on "${I.content}"`:`Todo: ${O}/${R} Tasks Completed`}return"Todo: Updated"}case"Grep":case"Glob":{const O=_.pattern||"",R=w==="Grep"?"Grep":"Glob";if(E==="completed"&&C&&!C.error){let I=0;return C.content&&(I=C.content.split(`
`).filter(W=>W.trim()).length),`${R}: "${O}" (${I} results)`}return`${R}: "${O}"`}case"WebFetch":case"WebSearch":{const O=_.url||_.query||"";let R="";try{O&&(R=new URL(O.startsWith("http")?O:`https://${O}`).hostname)}catch{R=O.length>50?O.substring(0,50)+"...":O}return E==="completed"&&C?C.error?`Web: ${R} (error)`:`Web: ${R} (success)`:`Web: ${R||O}`}case"NotebookEdit":{const O=x(_.notebook_path),R=_.cell_number!==void 0?_.cell_number:"?",I=_.edit_mode||"replace";return`NotebookEdit: ${O} cell #${R} (${I})`}case"ExitPlanMode":return"ExitPlanMode: Plan submitted";case"BashOutput":return`BashOutput: Read output from ${_.bash_id||"unknown"}`;case"KillShell":return`KillShell: Terminate ${_.shell_id||"unknown"}`;default:return`${w}: executed`}}),q=d(()=>{const w=t.toolCall.name,_=t.toolCall.input||{};return["Bash","Shell","Command","SlashCommand"].includes(w)?_.command||w:["Edit","Read","Write","NotebookEdit"].includes(w)&&(_.file_path||_.notebook_path)||w});function j(){const w=m.currentSessionId;w&&a.toggleToolExpansion(w,t.toolCall.id)}function M(w){return w.type==="setMode"?`Set permission mode to "${w.mode}"`:w.type==="allow"?`Allow tool: ${w.tool}`:JSON.stringify(w)}async function P(w,_,C=null){if(!l.value){l.value=!0,w==="allow"?c.value=_?"approve-apply":"approve":C?c.value="deny-guidance":c.value="deny";try{const E=m.currentSessionId;if(E){const O=_&&t.toolCall.suggestions?t.toolCall.suggestions:[];a.handlePermissionResponse(E,{request_id:t.toolCall.permissionRequestId,decision:w,reasoning:w==="allow"?"User allowed permission":"User denied permission",applied_updates:O})}await r.sendPermissionResponse(t.toolCall.permissionRequestId,w,_,C)}catch(E){console.error("Failed to send permission response:",E)}finally{l.value=!1,c.value=null}}}return(w,_)=>(s(),o("div",{class:H(["tool-call-card card",f.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:j},[e("div",Hl,[e("span",Bl,p($.value),1),e("strong",{class:"tool-name",title:q.value},p(U.value),9,Vl)]),e("div",zl,[e("small",Gl,p(T.value),1),e("i",{class:H(["bi",n.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),n.toolCall.isExpanded?(s(),o("div",Jl,[i.value?(s(),o("div",Kl,[e("div",Yl,[_[6]||(_[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[_[5]||(_[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",Ql,p(v.value?.message||"Session was terminated"),1)])])])):D("",!0),(s(),de(Ue(h.value),{toolCall:n.toolCall},null,8,["toolCall"])),n.toolCall.status==="permission_required"&&!i.value?(s(),o("div",Zl,[e("div",Xl,[_[9]||(_[9]=e("p",{class:"mb-2"},[e("strong",null,"ðŸ” Permission Required")],-1)),e("p",ea,[_[7]||(_[7]=G("Claude wants to use the ",-1)),e("code",ta,p(n.toolCall.name),1),_[8]||(_[8]=G(" tool.",-1))])]),y.value?(s(),o("div",sa,[e("div",oa,[_[10]||(_[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),G(" Suggested Permission Update ")],-1)),_[11]||(_[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",na,[(s(!0),o(Y,null,Z(n.toolCall.suggestions,(C,E)=>(s(),o("div",{key:E,class:"suggestion-item"},[e("code",null,p(M(C)),1)]))),128))]),_[12]||(_[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):D("",!0),e("div",la,[y.value?(s(),o("button",{key:0,class:"btn btn-success",onClick:_[0]||(_[0]=C=>P("allow",!0)),disabled:l.value},[_[13]||(_[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+p(l.value&&c.value==="approve-apply"?"â³ Submitting...":"âœ… Approve & Apply"),1)],8,aa)):D("",!0),e("button",{class:H(["btn",y.value?"btn-outline-success":"btn-success"]),onClick:_[1]||(_[1]=C=>P("allow",!1)),disabled:l.value},[_[14]||(_[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+p(l.value&&c.value==="approve"?"â³ Submitting...":y.value?"âœ… Approve Only":"âœ… Approve"),1)],10,ra),e("button",{class:"btn btn-danger",onClick:_[2]||(_[2]=C=>P("deny",!1)),disabled:l.value},[_[15]||(_[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),G(" "+p(l.value&&c.value==="deny"?"â³ Submitting...":"âŒ Deny"),1)],8,ia)]),e("div",ca,[_[17]||(_[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),G(" Provide Guidance (Optional) ")],-1)),_[18]||(_[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),Q(e("textarea",{"onUpdate:modelValue":_[3]||(_[3]=C=>g.value=C),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:l.value},null,8,da),[[le,g.value]]),g.value.trim()?(s(),o("button",{key:0,class:"btn btn-warning btn-sm",onClick:_[4]||(_[4]=C=>P("deny",!1,g.value)),disabled:l.value},[_[16]||(_[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),G(" "+p(l.value&&c.value==="deny-guidance"?"â³ Submitting...":"ðŸ’¡ Provide Guidance & Continue"),1)],8,ua)):D("",!0)])])):D("",!0),n.toolCall.status==="permission_required"&&i.value?(s(),o("div",ma,[e("div",pa,[e("div",va,[_[20]||(_[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[_[19]||(_[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",fa,p(v.value?.message||"Session was terminated before permission could be granted"),1)])])])])):D("",!0),n.toolCall.permissionDecision==="deny"?(s(),o("div",ga,[e("div",_a,[_[21]||(_[21]=e("i",{class:"bi bi-x-circle"},null,-1)),_[22]||(_[22]=G(" Permission denied ",-1)),n.toolCall.result?.message?(s(),o("span",ha," - "+p(n.toolCall.result.message),1)):D("",!0)])])):D("",!0)])):D("",!0)],2))}},ya=B(ba,[["__scopeId","data-v-65c848bf"]]),$a={class:"message-row message-row-assistant"},wa=["title"],ka={class:"message-content-column"},Sa={key:0,class:"thinking-block mb-2"},Ca=["innerHTML"],xa={key:2,class:"tool-calls"},Ma={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n,a=ue(),m=K();ye.setOptions({breaks:!0,gfm:!0});const r=d(()=>Ce(t.message.timestamp)),l=d(()=>t.message.metadata?.model||null),c=d(()=>{const T=r.value;return`assistant${l.value?`
Model: ${l.value}`:""}
${T}`}),g=d(()=>{const T=t.message.content||"";return T.trim().length>0&&T!=="Assistant response"}),i=d(()=>{const T=t.message.content||"";let b=ye.parse(T);return b=b.replace(/\n</g,"<"),b=b.replace(/\n+$/,""),Ee.sanitize(b)}),v=d(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),u=d(()=>t.message.metadata?.thinking_content||""),h=d(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),f=d(()=>t.message.metadata?.tool_uses||[]),$=d(()=>{const T=m.currentSessionId;if(!T)return[];const b=a.toolCallsBySession.get(T)||[];return f.value.map(y=>{const x=b.find(N=>N.id===y.id);return x||{id:y.id,name:y.name,input:y.input,status:"pending",result:null,timestamp:y.timestamp||t.message.timestamp,isExpanded:!0}})});return(T,b)=>(s(),o("div",$a,[e("div",{class:"message-speaker",title:c.value},[...b[0]||(b[0]=[e("span",{class:"speaker-label"},"assistant",-1)])],8,wa),e("div",ka,[v.value?(s(),o("div",Sa,[X(qt,{thinking:u.value},null,8,["thinking"])])):D("",!0),g.value?(s(),o("div",{key:1,class:"message-text",innerHTML:i.value},null,8,Ca)):D("",!0),h.value?(s(),o("div",xa,[(s(!0),o(Y,null,Z($.value,y=>(s(),de(ya,{key:y.id,toolCall:y},null,8,["toolCall"]))),128))])):D("",!0)])]))}},ja=B(Ma,[["__scopeId","data-v-726a72a7"]]),Ta={class:"message-row message-row-system"},Ea=["title"],La={class:"message-content-column"},Pa={class:"system-text"},Ia={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>Ce(t.message.timestamp)),m=d(()=>`system
${a.value}`);return(r,l)=>(s(),o("div",Ta,[e("div",{class:"message-speaker",title:m.value},[...l[0]||(l[0]=[e("span",{class:"speaker-label"},"system",-1)])],8,Ea),e("div",La,[e("span",Pa,p(n.message.content),1)])]))}},Re=B(Ia,[["__scopeId","data-v-4999cd2b"]]),Da={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(n){const t=n,a=d(()=>{switch(t.message.type){case"user":return Dt;case"assistant":return ja;case"system":return Re;default:return Re}});return(m,r)=>(s(),de(Ue(a.value),{message:n.message},null,8,["message"]))}},Na=B(Da,[["__scopeId","data-v-f283c218"]]),Oa={key:0,class:"text-muted text-center py-5"},Aa={__name:"MessageList",setup(n){const t=ue(),a=se(),m=L(null),r=d(()=>t.currentMessages.filter(i=>c(i)));d(()=>t.currentToolCalls);async function l(){a.autoScrollEnabled&&(await Te(),m.value&&(m.value.scrollTop=m.value.scrollHeight))}ee(()=>t.currentMessages.length,l),ee(()=>t.currentToolCalls.length,l),ee(()=>t.currentToolCalls.map(i=>`${i.id}-${i.status}`).join(","),l),ne(()=>{setTimeout(()=>{l()},100)});function c(i){const v=i.subtype||i.metadata?.subtype;if(i.type==="system"&&v==="init"||i.type==="result"||i.type==="permission_request"||i.type==="permission_response")return!1;if(i.type==="user"&&i.metadata?.has_tool_results){const u=i.content||"";if(u.match(/^Tool results?: \d+ results?$/i)||u.trim()==="")return!1}if(i.type==="user"){const u=i.content||"";if(u.includes("<command-message>")&&u.includes("skill is running")||u.startsWith("Base directory for this skill:"))return!1}if(i.type==="user"){const u=i.content||"";if(u.includes("<command-message>")&&u.includes("<command-name>")&&u.includes("<command-args>")||u.includes("ARGUMENTS:")&&(u.includes("<command-name>")||u.match(/\nARGUMENTS:/)))return!1}return!0}function g(i){return{type:i.type||"unknown",content:i.content||"",timestamp:i.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...i.metadata}}}return(i,v)=>(s(),o("div",{class:"messages-area flex-grow-1 overflow-auto",ref_key:"messagesArea",ref:m},[r.value.length===0?(s(),o("div",Oa," No messages yet. Start a conversation! ")):D("",!0),(s(!0),o(Y,null,Z(r.value,(u,h)=>(s(),de(Na,{key:`msg-${u.timestamp}-${h}`,message:g(u)},null,8,["message"]))),128))],512))}},Ra=B(Aa,[["__scopeId","data-v-f94a8763"]]),Ua={class:"border-top bg-light"},qa={class:"d-flex gap-2 align-items-end px-2 py-1"},Fa=["placeholder","disabled","onKeydown"],Wa=["disabled"],Ha={__name:"InputArea",setup(n){const t=K(),a=ve(),m=L(null),r=d({get:()=>t.currentInput,set:f=>{t.currentInput=f}}),l=d(()=>t.currentSession?.is_processing||!1),c=d(()=>a.sessionConnected),g=d(()=>t.currentSession?.state==="starting"),i=d(()=>g.value?"Session is starting...":c.value?"Type your message to Claude Code...":"Waiting for connection...");function v(){const f=m.value;if(!f)return;f.style.height="auto";const $=Math.min(f.scrollHeight,parseInt(getComputedStyle(f).maxHeight));f.style.height=$+"px"}function u(){r.value.trim()&&(a.sendMessage(r.value),r.value="",m.value&&(m.value.style.height="auto"))}function h(){a.interruptSession()}return(f,$)=>(s(),o("div",Ua,[e("div",qa,[Q(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:m,"onUpdate:modelValue":$[0]||($[0]=T=>r.value=T),class:"form-control",placeholder:i.value,disabled:g.value||!c.value,rows:"1",onInput:v,onKeydown:Se(ie(u,["exact","prevent"]),["enter"])},null,40,Fa),[[le,r.value]]),l.value?(s(),o("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:h}," Stop ")):(s(),o("button",{key:1,class:"btn btn-primary",disabled:!r.value.trim()||!c.value||g.value,onClick:u}," Send ",8,Wa))])]))}},Ba=B(Ha,[["__scopeId","data-v-a72bf16a"]]),Va={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},za={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},Ga={class:"text-secondary"},Ja={class:"d-flex flex-column flex-grow-1 overflow-hidden"},Fe={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,a=K(),m=se(),r=d(()=>a.currentSession),l=d(()=>m.isLoading),c=d(()=>m.loadingMessage);return ne(async()=>{if(t.sessionId!==a.currentSessionId){m.showLoading("Loading session...");try{await a.selectSession(t.sessionId)}finally{m.hideLoading()}}}),ee(()=>t.sessionId,async(g,i)=>{if(g!==i&&g!==a.currentSessionId){m.showLoading("Loading session...");try{await a.selectSession(g)}finally{m.hideLoading()}}}),ce(()=>{}),(g,i)=>(s(),o("div",Va,[l.value?(s(),o("div",za,[i[0]||(i[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Ga,p(c.value),1)])):D("",!0),r.value?(s(),de(at,{key:1,"session-id":t.sessionId},null,8,["session-id"])):D("",!0),e("div",Ja,[X(Ra)]),X(Ba),r.value?(s(),de(ut,{key:2,"session-id":t.sessionId},null,8,["session-id"])):D("",!0),r.value?(s(),de(yt,{key:3,"session-id":t.sessionId},null,8,["session-id"])):D("",!0)]))}},he=_e("legion",()=>{const n=L(new Map),t=L(new Map),a=L(new Map),m=L(new Map),r=L(new Map),l=L(new Map),c=L(null),g=d(()=>n.value.get(c.value)||[]),i=d(()=>t.value.get(c.value)||[]),v=d(()=>a.value.get(c.value)||[]),u=d(()=>m.value.get(c.value)||[]);function h(M){c.value=M}async function f(M,P=100,w=0){try{const _=await J.get(`/api/legions/${M}/timeline?limit=${P}&offset=${w}`),C=_.comms||[],E=_.total_count||C.length,O=_.has_more||!1;return C.sort((R,I)=>new Date(R.timestamp)-new Date(I.timestamp)),console.log(`Loaded ${C.length} of ${E} comms for legion ${M}`),n.value.set(M,C),n.value=new Map(n.value),{comms:C,totalCount:E,hasMore:O}}catch(_){throw console.error("Failed to load timeline:",_),_}}function $(M,P){n.value.has(M)||n.value.set(M,[]),n.value.get(M).push(P),n.value=new Map(n.value)}async function T(M,P){try{const _=(await J.post(`/api/legions/${M}/comms`,P)).comm;return console.log(`Sent comm ${_.comm_id} to legion ${M}`),_}catch(w){throw console.error("Failed to send comm:",w),w}}async function b(M){return console.log(`Minions for legion ${M} are already available in session store`),[]}async function y(M,P){try{const _=(await J.post(`/api/legions/${M}/minions`,P)).minion;return await b(M),console.log(`Created minion ${_.minion_id} in legion ${M}`),_}catch(w){throw console.error("Failed to create minion:",w),w}}async function x(M){try{const w=(await J.get(`/api/legions/${M}/hordes`)).hordes||[];return console.log(`Loaded ${w.length} hordes for legion ${M}`),a.value.set(M,w),a.value=new Map(a.value),w}catch(P){throw console.error("Failed to load hordes:",P),P}}async function N(M){try{const w=(await J.get(`/api/legions/${M}/channels`)).channels||[];return console.log(`Loaded ${w.length} channels for legion ${M}`),m.value.set(M,w),m.value=new Map(m.value),w}catch(P){throw console.error("Failed to load channels:",P),P}}async function k(M){try{const P=await J.get(`/api/channels/${M}`),w=P.channel||P;return console.log(`Loaded details for channel ${M}`),r.value.set(M,w),r.value=new Map(r.value),w}catch(P){throw console.error("Failed to load channel details:",P),P}}async function S(M,P=1e3){try{const _=(await J.get(`/api/channels/${M}/comms?limit=${P}`)).comms||[];return console.log(`Loaded ${_.length} comms for channel ${M}`),_.sort((C,E)=>new Date(C.timestamp)-new Date(E.timestamp)),l.value.set(M,_),l.value=new Map(l.value),_}catch(w){throw console.error("Failed to load channel comms:",w),w}}async function U(M,P){try{await J.post(`/api/channels/${M}/members`,{action:"add",self_id:"00000000-0000-0000-0000-000000000000",member_id:P}),console.log(`Added minion ${P} to channel ${M}`),await k(M)}catch(w){throw console.error("Failed to add member to channel:",w),w}}async function q(M,P){try{await J.post(`/api/channels/${M}/members`,{action:"remove",self_id:"00000000-0000-0000-0000-000000000000",member_id:P}),console.log(`Removed minion ${P} from channel ${M}`),await k(M)}catch(w){throw console.error("Failed to remove member from channel:",w),w}}function j(M){n.value.delete(M),t.value.delete(M),a.value.delete(M),m.value.delete(M),n.value=new Map(n.value),t.value=new Map(t.value),a.value=new Map(a.value),m.value=new Map(m.value)}return{commsByLegion:n,minionsByLegion:t,hordesByLegion:a,channelsByLegion:m,channelDetailsByChannel:r,channelCommsByChannel:l,currentLegionId:c,currentComms:g,currentMinions:i,currentHordes:v,currentChannels:u,setCurrentLegion:h,loadTimeline:f,addComm:$,sendComm:T,loadMinions:b,createMinion:y,loadHordes:x,loadChannels:N,loadChannelDetails:k,loadChannelComms:S,addMemberToChannel:U,removeMemberFromChannel:q,clearLegionData:j}}),Ka=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:he},Symbol.toStringTag,{value:"Module"})),Ya={class:"timeline-header border-bottom p-3"},Qa={class:"project-name"},Za=["title"],Xa={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=ae(),m=d(()=>a.projects.get(t.legionId)),r=d(()=>m.value?.name||"Legion");return(l,c)=>(s(),o("div",Ya,[e("div",null,[e("div",Qa,p(r.value),1),e("div",{class:"view-name",title:n.legionId},"Timeline",8,Za)])]))}},er=B(Xa,[["__scopeId","data-v-44f386f5"]]),tr={class:"timeline-status-bar border-top p-2 bg-light"},sr={class:"d-flex justify-content-end"},or={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(n){const t=se();function a(){t.setAutoScroll(!t.autoScrollEnabled)}return(m,r)=>(s(),o("div",tr,[e("div",sr,[e("button",{class:H(["btn btn-sm",ke(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:a}," â¬‡ï¸ "+p(ke(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},nr=B(or,[["__scopeId","data-v-891c73db"]]),lr={class:"comm-composer border-top p-3"},ar={class:"d-flex gap-2 mb-2"},rr={class:"flex-grow-1"},ir=["disabled"],cr={label:"Minions"},dr=["value"],ur={key:0,label:"Channels"},mr=["value"],pr={style:{"min-width":"150px"}},vr=["disabled"],fr={class:"d-flex gap-2 align-items-end position-relative"},gr={class:"flex-grow-1 position-relative"},_r=["disabled"],hr=["onClick","onMouseenter"],br=["disabled"],yr={key:0},$r={key:1},wr={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=he(),m=K(),r=ae(),l=L(""),c=L("task"),g=L(""),i=L(!1),v=L(!1),u=L([]),h=L(0),f=L(-1),$=L(null),T=L(null),b=d(()=>{const w=r.projects.get(t.legionId);return!w||!w.session_ids?[]:w.session_ids.map(_=>m.sessions.get(_)).filter(_=>_&&_.is_minion)}),y=d(()=>a.currentChannels||[]),x=d(()=>l.value&&g.value.trim().length>0);function N(w){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[w.state]||"â—‹"}function k(w){return w.is_minion&&w.role?`${w.name} (${w.role})`:w.name}function S(){const w=$.value;if(!w)return;w.style.height="auto";const _=Math.min(w.scrollHeight,parseInt(getComputedStyle(w).maxHeight));w.style.height=_+"px"}function U(){const w=$.value;if(!w)return;S();const _=g.value,C=w.selectionStart,E=_.substring(0,C),O=E.lastIndexOf("#");if(O===-1){v.value=!1;return}const R=E.substring(O+1).toLowerCase();if(R.includes(" ")){v.value=!1;return}const I=b.value.filter(A=>A.name.toLowerCase().includes(R)).map(A=>({type:"minion",name:A.name,role:A.role,id:A.session_id,state:A.state}));if(I.length===0){v.value=!1;return}u.value=I,h.value=0,f.value=O,v.value=!0}function q(){if(!T.value)return;const w=T.value,_=w.children[h.value];if(!_)return;const C=_.offsetTop,E=_.offsetHeight,O=w.scrollTop,R=w.clientHeight;C<O?w.scrollTop=C:C+E>O+R&&(w.scrollTop=C+E-R)}function j(w){if(!v.value){w.key==="Enter"&&!w.shiftKey&&x.value&&(w.preventDefault(),P());return}if(w.key==="ArrowDown")w.preventDefault(),h.value=(h.value+1)%u.value.length,q();else if(w.key==="ArrowUp")w.preventDefault(),h.value=h.value===0?u.value.length-1:h.value-1,q();else if(w.key==="Enter"){w.preventDefault();const _=u.value[h.value];_&&M(_)}else w.key==="Escape"&&(v.value=!1)}function M(w){const _=$.value;if(!_)return;const C=g.value,E=_.selectionStart,O=C.substring(0,f.value)+"#"+w.name+" "+C.substring(E);g.value=O;const R=f.value+w.name.length+2;setTimeout(()=>{_.setSelectionRange(R,R),_.focus()},0),v.value=!1}async function P(){if(!(!x.value||i.value)){i.value=!0;try{const[w,_]=l.value.split(":"),C={comm_type:c.value,content:g.value.trim()};w==="minion"?C.to_minion_id=_:w==="channel"&&(C.to_channel_id=_),await a.sendComm(t.legionId,C),g.value="",S()}catch(w){console.error("Failed to send comm:",w),alert(`Failed to send comm: ${w.message}`)}finally{i.value=!1}}}return ee(v,w=>{if(w){const _=C=>{C.target.closest(".comm-composer")||(v.value=!1,document.removeEventListener("click",_))};setTimeout(()=>document.addEventListener("click",_),0)}}),(w,_)=>(s(),o("div",lr,[e("div",ar,[e("div",rr,[Q(e("select",{"onUpdate:modelValue":_[0]||(_[0]=C=>l.value=C),class:"form-select form-select-sm",disabled:i.value},[_[3]||(_[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",cr,[(s(!0),o(Y,null,Z(b.value,C=>(s(),o("option",{key:C.session_id,value:`minion:${C.session_id}`},p(N(C))+" "+p(k(C)),9,dr))),128))]),y.value.length>0?(s(),o("optgroup",ur,[(s(!0),o(Y,null,Z(y.value,C=>(s(),o("option",{key:C.channel_id,value:`channel:${C.channel_id}`}," #ï¸âƒ£ "+p(C.name),9,mr))),128))])):D("",!0)],8,ir),[[ge,l.value]])]),e("div",pr,[Q(e("select",{"onUpdate:modelValue":_[1]||(_[1]=C=>c.value=C),class:"form-select form-select-sm",disabled:i.value},[..._[4]||(_[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,vr),[[ge,c.value]])])]),e("div",fr,[e("div",gr,[Q(e("textarea",{ref_key:"contentTextarea",ref:$,"onUpdate:modelValue":_[2]||(_[2]=C=>g.value=C),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:i.value,onInput:U,onKeydown:j},null,40,_r),[[le,g.value]]),v.value?(s(),o("div",{key:0,ref_key:"autocompleteDropdown",ref:T,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(s(!0),o(Y,null,Z(u.value,(C,E)=>(s(),o("div",{key:C.id,class:H(["autocomplete-item px-2 py-1",{"bg-light":E===h.value}]),onClick:O=>M(C),onMouseenter:O=>h.value=E},p(C.type==="minion"?N(C):"#ï¸âƒ£")+" "+p(C.name)+p(C.role?` (${C.role})`:""),43,hr))),128))],512)):D("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!x.value||i.value,onClick:P},[i.value?(s(),o("span",yr,[..._[5]||(_[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),G(" Sending... ",-1)])])):(s(),o("span",$r,"Send"))],8,br)])])]))}},kr=B(wr,[["__scopeId","data-v-ffa54193"]]),Sr={class:"timeline-view d-flex flex-column h-100"},Cr={key:0,class:"text-center text-muted"},xr={key:1,class:"text-center text-danger"},Mr={key:2,class:"text-center text-muted"},jr={key:3,class:"comm-list"},Tr={class:"col-auto message-speaker text-end pe-3"},Er={class:"text-muted"},Lr={class:"col message-content-column"},Pr={class:"card-body p-2"},Ir={class:"d-flex justify-content-between align-items-start mb-1"},Dr={class:"comm-content"},Nr="ffffffff-ffff-ffff-ffff-ffffffffffff",Or={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=he(),m=ae(),r=K(),l=ve(),c=se(),g=L(!0),i=L(null),v=L(null),u=d(()=>m.projects.get(t.legionId));d(()=>u.value?.name||"Legion");const h=d(()=>a.currentComms);d(()=>a.currentMinions);function f(U){return U.from_minion_id===Nr}function $(U){return U.from_user?"You":U.from_minion_id?f(U)?"SYSTEM":r.sessions.get(U.from_minion_id)?.name||"Unknown":"Unknown"}function T(U){return U.to_user?"You":U.to_minion_id?r.sessions.get(U.to_minion_id)?.name||"Unknown":U.to_channel_id?U.to_channel_name?`#${U.to_channel_name}`:U.to_channel_id:"All"}function b(U){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[U]||"bg-secondary"}function y(U){return new Date(U).toLocaleTimeString()}async function x(){c.autoScrollEnabled&&(await Te(),v.value&&(v.value.scrollTop=v.value.scrollHeight))}async function N(){g.value=!0,i.value=null;try{a.setCurrentLegion(t.legionId),await Promise.all([a.loadTimeline(t.legionId),a.loadMinions(t.legionId)]),await Te(),await x(),setTimeout(()=>{x()},100)}catch(U){console.error("Failed to load timeline:",U),U.response?i.value=`${U.message} (${U.response.status})`:i.value=U.message||"Unknown error"}finally{g.value=!1}}function k(){l.connectLegion(t.legionId)}function S(){l.disconnectLegion()}return ee(()=>h.value.length,()=>{x()}),ne(()=>{N(),k(),setTimeout(()=>{x()},100)}),ce(()=>{S()}),(U,q)=>(s(),o("div",Sr,[X(er,{"legion-id":n.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:v,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[g.value?(s(),o("div",Cr,[...q[0]||(q[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),G(" Loading timeline... ",-1)])])):i.value?(s(),o("div",xr," Failed to load timeline: "+p(i.value),1)):h.value.length===0?(s(),o("div",Mr," No messages yet. Minions will appear here once they start communicating. ")):(s(),o("div",jr,[(s(!0),o(Y,null,Z(h.value,j=>(s(),o("div",{key:j.comm_id,class:H(["comm-item message-row row py-2 mb-2",{"system-comm":f(j)}])},[e("div",Tr,[e("small",Er,p(y(j.timestamp)),1)]),e("div",Lr,[e("div",{class:H(["comm-card card",{"system-card":f(j)}])},[e("div",Pr,[e("div",Ir,[e("div",null,[e("span",{class:H(["badge",b(j.comm_type)])},p(j.comm_type),3),e("strong",{class:H(["ms-2",{"system-sender":f(j)}])},p($(j)),3),q[1]||(q[1]=e("span",{class:"text-muted mx-1"},"â†’",-1)),e("strong",{class:H({"recipient-channel":j.to_channel_id})},p(T(j)),3)])]),e("div",Dr,p(j.content),1)])],2)])],2))),128))]))],512),X(kr,{"legion-id":n.legionId},null,8,["legion-id"]),X(nr,{"legion-id":n.legionId},null,8,["legion-id"])]))}},Ar=B(Or,[["__scopeId","data-v-6d97bd0b"]]),Rr={class:"spy-view d-flex flex-column overflow-hidden"},Ur={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(n){return(t,a)=>(s(),o("div",Rr,[X(Fe,{"session-id":n.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},qr=B(Ur,[["__scopeId","data-v-43a24eaf"]]),Fr={class:"horde-header border-bottom p-3"},Wr={class:"project-name"},Hr={__name:"HordeHeader",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=ae(),m=d(()=>a.projects.get(t.legionId)),r=d(()=>m.value?.name||"Legion");return(l,c)=>(s(),o("div",Fr,[e("div",null,[e("div",Wr,p(r.value),1),c[0]||(c[0]=e("div",{class:"view-name"},"Minion Hierarchy",-1))])]))}},Br=B(Hr,[["__scopeId","data-v-0c86e2b5"]]),Vr={class:"horde-status-bar border-top p-2 bg-light"},zr={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0}},setup(n){return(t,a)=>(s(),o("div",Vr,[...a[0]||(a[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},Gr=B(zr,[["__scopeId","data-v-f0e64ab0"]]),Jr={class:"minion-card border-start border-2 mb-2"},Kr={class:"node-row"},Yr={class:"node-left"},Qr={key:0,class:"me-2"},Zr={key:1,class:"badge bg-secondary ms-2"},Xr={class:"node-right"},ei={key:0,class:"last-comm-preview"},ti={class:"comm-direction"},si=["title"],oi={key:1,class:"text-muted fst-italic small"},ni={key:0,class:"minion-children"},li={key:1,class:"text-danger small ms-4"},ai={__name:"MinionTreeNode",props:{minionData:{type:Object,required:!0},level:{type:Number,default:0}},setup(n){const t=n,a=d(()=>t.level*24),m=d(()=>t.minionData&&t.minionData.children&&t.minionData.children.length>0),r=d(()=>t.minionData&&t.minionData.is_overseer&&m.value),l=d(()=>t.minionData?t.minionData.state==="paused"&&t.minionData.is_processing?"pending-prompt":t.minionData.is_processing?"processing":t.minionData.state||"created":"created"),c=d(()=>{const u=l.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[u]||"status-dot-grey"}),g=d(()=>{const u=l.value;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[u]||"#d3d3d3"}});function i(u){return u.to_user?"User":u.to_minion_name?u.to_minion_name:u.to_channel_name?`#${u.to_channel_name}`:"unknown"}function v(u){const h=u.summary||u.content||"";return h.length>150?h.substring(0,150)+"...":h}return(u,h)=>{const f=qe("MinionTreeNode",!0);return n.minionData?(s(),o("div",{key:0,class:"minion-tree-node",style:me({marginLeft:`${a.value}px`})},[e("div",Jr,[e("div",Kr,[e("div",Yr,[e("div",{class:H(["status-dot me-2",c.value]),style:me(g.value)},null,6),r.value?(s(),o("span",Qr,"ðŸ‘‘")):D("",!0),e("strong",null,p(n.minionData.name),1),r.value?(s(),o("span",Zr,p(n.minionData.children.length)+" "+p(n.minionData.children.length===1?"child":"children"),1)):D("",!0)]),e("div",Xr,[n.minionData.last_comm?(s(),o("div",ei,[e("span",ti,[h[0]||(h[0]=G(" â†’ ",-1)),e("strong",null,p(i(n.minionData.last_comm)),1),h[1]||(h[1]=G(": ",-1))]),e("span",{class:"comm-content",title:n.minionData.last_comm.content||""},p(v(n.minionData.last_comm)),9,si)])):(s(),o("div",oi," No communications yet "))])])]),m.value?(s(),o("div",ni,[(s(!0),o(Y,null,Z(n.minionData.children,$=>(s(),de(f,{key:$.id,"minion-data":$,level:n.level+1},null,8,["minion-data","level"]))),128))])):D("",!0)],4)):(s(),o("div",li," âš  Minion data is missing "))}}},ri=B(ai,[["__scopeId","data-v-1cd9863f"]]),ii={class:"horde-view d-flex flex-column h-100"},ci={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},di={key:0,class:"text-center py-5"},ui={key:1,class:"alert alert-danger"},mi={class:"mb-0"},pi={key:2,class:"horde-tree"},vi={class:"user-root-node mb-3 border rounded bg-white"},fi={class:"node-row"},gi={class:"node-left"},_i={key:0,class:"badge bg-primary ms-2"},hi={class:"node-right"},bi={key:0,class:"last-comm-preview"},yi={class:"comm-direction"},$i=["title"],wi={key:1,class:"text-muted fst-italic"},ki={key:0,class:"alert alert-info ms-4"},Si={key:1,class:"root-minions ms-4"},Ci={__name:"HordeView",props:{legionId:{type:String,required:!0}},setup(n){const t=n,a=ae(),m=K(),r=ve(),l=he(),c=L(null),g=L(!1),i=L(null);d(()=>a.projects.get(t.legionId));const v=d(()=>c.value&&c.value.children&&c.value.children.length>0);async function u(){g.value=!0,i.value=null;try{const b=await J.get(`/api/legions/${t.legionId}/hordes`);c.value=b,console.log("Loaded hierarchy:",b)}catch(b){console.error("Failed to load hierarchy:",b),i.value=b.message||"Unknown error"}finally{g.value=!1}}ne(()=>{u()}),ee(()=>t.legionId,()=>{u()});function h(b){return b.to_user?"User":b.to_minion_name?b.to_minion_name:b.to_channel_name?`#${b.to_channel_name}`:"unknown"}function f(b){const y=b.summary||b.content||"";return y.length>150?y.substring(0,150)+"...":y}function $(b,y){if(b.id===y)return b;if(b.children)for(const x of b.children){const N=$(x,y);if(N)return N}return null}function T(b){if(c.value){if(b.from_minion_id){const y=$(c.value,b.from_minion_id);y&&y.type==="minion"&&(y.last_comm=b,console.log(`Updated minion ${y.name} last_comm`))}b.from_user&&c.value.type==="user"&&(c.value.last_comm=b,console.log("Updated user last_comm"))}}return ne(()=>{u(),l.setCurrentLegion(t.legionId),r.connectLegion(t.legionId),ee(()=>m.sessions,b=>{if(c.value){for(const[y,x]of b)if(x.is_minion&&x.project_id===t.legionId){const N=$(c.value,y);N&&N.type==="minion"&&(N.state!==x.state&&(N.state=x.state,console.log(`Updated minion ${N.name} state to ${x.state}`)),N.is_processing!==x.is_processing&&(N.is_processing=x.is_processing,console.log(`Updated minion ${N.name} is_processing to ${x.is_processing}`)))}}},{deep:!0}),ee(()=>l.commsByLegion.get(t.legionId),b=>{if(b&&b.length>0){const y=b[b.length-1];T(y)}},{deep:!0}),ee(()=>m.sessions.size,(b,y)=>{b>y&&Array.from(m.sessions.values()).some(k=>k.is_minion&&k.project_id===t.legionId&&!$(c.value,k.session_id))&&(console.log("New minion detected, reloading hierarchy"),u())})}),ce(()=>{console.log("HordeView unmounted")}),(b,y)=>(s(),o("div",ii,[X(Br,{"legion-id":n.legionId},null,8,["legion-id"]),e("div",ci,[g.value?(s(),o("div",di,[...y[0]||(y[0]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"text-muted mt-2"},"Loading hierarchy...",-1)])])):i.value?(s(),o("div",ui,[y[1]||(y[1]=e("strong",null,"Failed to load hierarchy",-1)),e("p",mi,p(i.value),1)])):c.value?(s(),o("div",pi,[e("div",vi,[e("div",fi,[e("div",gi,[y[2]||(y[2]=e("span",{class:"me-2",style:{"font-size":"1.2rem"}},"ðŸ‘¤",-1)),e("strong",null,p(c.value.name),1),v.value?(s(),o("span",_i,p(c.value.children.length)+" "+p(c.value.children.length===1?"minion":"minions"),1)):D("",!0)]),e("div",hi,[c.value.last_comm?(s(),o("div",bi,[e("span",yi,[y[3]||(y[3]=G(" â†’ ",-1)),e("strong",null,p(h(c.value.last_comm)),1),y[4]||(y[4]=G(": ",-1))]),e("span",{class:"comm-content",title:c.value.last_comm.content||""},p(f(c.value.last_comm)),9,$i)])):(s(),o("div",wi," No communications yet "))])])]),v.value?(s(),o("div",Si,[(s(!0),o(Y,null,Z(c.value.children,x=>(s(),de(ri,{key:x.id,"minion-data":x,level:1},null,8,["minion-data"]))),128))])):(s(),o("div",ki,[...y[5]||(y[5]=[e("p",{class:"mb-2"},"No minions yet",-1),e("small",{class:"text-muted"},"Create a minion to get started",-1)])]))])):D("",!0)]),X(Gr,{"legion-id":n.legionId},null,8,["legion-id"])]))}},xi=B(Ci,[["__scopeId","data-v-af6338a3"]]),Mi={class:"channel-view d-flex flex-column h-100"},ji={class:"channel-header border-bottom p-3"},Ti={class:"d-flex align-items-center justify-content-between"},Ei={class:"mb-0"},Li={class:"text-muted"},Pi={class:"badge bg-secondary"},Ii={class:"channel-content flex-grow-1 overflow-auto"},Di={key:0,class:"text-center text-muted py-4"},Ni={key:1,class:"text-center text-danger py-4"},Oi={key:2,class:"text-center text-muted py-4"},Ai={key:3,class:"p-3"},Ri={class:"overview-section mb-4"},Ui={class:"row g-3"},qi={class:"col-md-6"},Fi={class:"font-monospace small text-muted"},Wi={class:"col-md-6"},Hi={class:"text-muted"},Bi={class:"col-12"},Vi={class:"text-muted"},zi={class:"col-12"},Gi={class:"text-muted"},Ji={class:"members-section mb-4"},Ki={class:"text-muted border-bottom pb-2 d-flex align-items-center justify-content-between"},Yi={key:0,class:"mb-3"},Qi=["value"],Zi={key:1,class:"text-center text-muted py-3"},Xi={key:2,class:"list-group"},ec={class:"d-flex align-items-center gap-2"},tc=["title"],sc={class:"fw-semibold"},oc={class:"text-muted"},nc=["onClick"],lc={class:"comms-section"},ac={class:"text-muted border-bottom pb-2"},rc={key:0,class:"text-center text-muted py-4"},ic={key:1,class:"text-center text-muted py-3"},cc={key:2,class:"comm-list"},dc={class:"card-body p-2"},uc={class:"d-flex justify-content-between align-items-start mb-1"},mc={class:"ms-2"},pc={class:"text-muted ms-2"},vc={key:0,class:"text-muted small mb-1"},fc={class:"comm-content"},gc={__name:"ChannelView",props:{legionId:{type:String,required:!0},channelId:{type:String,required:!0}},setup(n){const t=n,a=he(),m=ae(),r=K(),l=L(!0),c=L(null),g=L(!1),i=L(!1),v=L(""),u=d(()=>m.projects.get(t.legionId)),h=d(()=>a.channelDetailsByChannel.get(t.channelId)),f=d(()=>a.channelCommsByChannel.get(t.channelId)||[]),$=d(()=>h.value?.member_minion_ids?.length||0),T=d(()=>f.value.length),b=d(()=>h.value?.member_minion_ids?h.value.member_minion_ids.map(P=>r.sessions.get(P)).filter(Boolean):[]),y=d(()=>{if(!h.value)return[];const P=new Set(h.value.member_minion_ids||[]);return Array.from(r.sessions.values()).filter(_=>_.is_minion).filter(_=>!P.has(_.session_id))});function x(P){if(P.state==="paused"&&P.is_processing)return"status-blinking";const w=P.is_processing?"processing":P.state;return w==="starting"||w==="processing"?"status-blinking":""}function N(P){if(P.state==="paused"&&P.is_processing)return{backgroundColor:"#ffc107"};const w=P.is_processing?"processing":P.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[w]||"#d3d3d3"}}function k(P){return P.from_user?"You":P.from_minion_name?P.from_minion_name:P.from_minion_id&&r.sessions.get(P.from_minion_id)?.name||"Unknown"}function S(P){return{task:"bg-primary",question:"bg-info",report:"bg-success",info:"bg-secondary",halt:"bg-danger",pivot:"bg-warning"}[P?.toLowerCase()]||"bg-secondary"}function U(P){return P?new Date(P).toLocaleString():"N/A"}function q(P){return P?new Date(P).toLocaleString():"N/A"}async function j(){if(!(!v.value||!t.channelId))try{await a.addMemberToChannel(t.channelId,v.value),v.value="",i.value=!1}catch(P){console.error("Failed to add member:",P),alert("Failed to add member to channel")}}async function M(P){if(confirm("Remove this minion from the channel?"))try{await a.removeMemberFromChannel(t.channelId,P)}catch(_){console.error("Failed to remove member:",_),alert("Failed to remove member from channel")}}return ne(async()=>{l.value=!0;try{await a.loadChannelDetails(t.channelId),g.value=!0,await a.loadChannelComms(t.channelId,1e3),g.value=!1}catch(P){console.error("Failed to load channel:",P),c.value=P.message||"Unknown error"}finally{l.value=!1}}),ee(()=>t.channelId,async P=>{if(P){l.value=!0,c.value=null;try{await a.loadChannelDetails(P),g.value=!0,await a.loadChannelComms(P,1e3),g.value=!1}catch(w){console.error("Failed to load channel:",w),c.value=w.message||"Unknown error"}finally{l.value=!1}}}),(P,w)=>(s(),o("div",Mi,[e("div",ji,[e("div",Ti,[e("div",null,[e("h5",Ei," ðŸ’¬ "+p(h.value?.name||"Channel"),1),e("small",Li,p(u.value?.name||"Legion"),1)]),e("span",Pi,p($.value)+" members",1)])]),e("div",Ii,[l.value?(s(),o("div",Di,[...w[2]||(w[2]=[e("div",{class:"spinner-border spinner-border-sm",role:"status"},null,-1),e("div",{class:"mt-2"},"Loading channel...",-1)])])):c.value?(s(),o("div",Ni," Failed to load channel: "+p(c.value),1)):h.value?(s(),o("div",Ai,[e("div",Ri,[w[7]||(w[7]=e("h6",{class:"text-muted border-bottom pb-2"},"Overview",-1)),e("div",Ui,[e("div",qi,[w[3]||(w[3]=e("strong",null,"Channel ID:",-1)),e("div",Fi,p(h.value.channel_id),1)]),e("div",Wi,[w[4]||(w[4]=e("strong",null,"Created:",-1)),e("div",Hi,p(U(h.value.created_at)),1)]),e("div",Bi,[w[5]||(w[5]=e("strong",null,"Purpose:",-1)),e("div",Vi,p(h.value.purpose||"No purpose specified"),1)]),e("div",zi,[w[6]||(w[6]=e("strong",null,"Description:",-1)),e("div",Gi,p(h.value.description||"No description provided"),1)])])]),e("div",Ji,[e("h6",Ki,[e("span",null,"Members ("+p($.value)+")",1),e("button",{class:"btn btn-sm btn-primary",onClick:w[0]||(w[0]=_=>i.value=!i.value)}," âž• Add Member ")]),i.value?(s(),o("div",Yi,[Q(e("select",{"onUpdate:modelValue":w[1]||(w[1]=_=>v.value=_),class:"form-select form-select-sm",onChange:j},[w[8]||(w[8]=e("option",{value:""},"-- Select Minion to Add --",-1)),(s(!0),o(Y,null,Z(y.value,_=>(s(),o("option",{key:_.session_id,value:_.session_id},p(_.name)+" ("+p(_.role||"No role")+") ",9,Qi))),128))],544),[[ge,v.value]])])):D("",!0),b.value.length===0?(s(),o("div",Zi," No members in this channel yet ")):(s(),o("div",Xi,[(s(!0),o(Y,null,Z(b.value,_=>(s(),o("div",{key:_.session_id,class:"list-group-item d-flex align-items-center justify-content-between"},[e("div",ec,[e("span",{class:H(["status-dot",x(_)]),style:me(N(_)),title:_.state},null,14,tc),e("div",null,[e("div",sc,p(_.name),1),e("small",oc,p(_.role||"No role"),1)])]),e("button",{class:"btn btn-sm btn-outline-danger",onClick:C=>M(_.session_id),title:"Remove member from channel"}," Remove ",8,nc)]))),128))]))]),e("div",lc,[e("h6",ac,"Communications ("+p(T.value)+")",1),g.value?(s(),o("div",rc,[...w[9]||(w[9]=[e("div",{class:"spinner-border spinner-border-sm",role:"status"},null,-1),e("div",{class:"mt-2"},"Loading comms...",-1)])])):f.value.length===0?(s(),o("div",ic," No communications in this channel yet ")):(s(),o("div",cc,[(s(!0),o(Y,null,Z(f.value,_=>(s(),o("div",{key:_.comm_id,class:"comm-item card mb-2"},[e("div",dc,[e("div",uc,[e("div",null,[e("span",{class:H(["badge",S(_.comm_type)])},p(_.comm_type),3),e("strong",mc,p(k(_)),1),e("small",pc,p(q(_.timestamp)),1)])]),_.summary?(s(),o("div",vc,[w[10]||(w[10]=e("strong",null,"Summary:",-1)),G(" "+p(_.summary),1)])):D("",!0),e("div",fc,p(_.content),1)])]))),128))]))])])):(s(),o("div",Oi," Channel not found "))])]))}},_c=B(gc,[["__scopeId","data-v-e09adf09"]]),hc=[{path:"/",name:"home",component:Ke},{path:"/session/:sessionId",name:"session",component:Fe,props:!0},{path:"/timeline/:legionId",name:"timeline",component:Ar,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:qr,props:!0},{path:"/horde/:legionId",name:"horde",component:xi,props:!0},{path:"/channel/:legionId/:channelId",name:"channel",component:_c,props:!0}],bc=He({history:Be(),routes:hc}),yc={__name:"ConnectionIndicator",setup(n){const t=ve(),a=d(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),m=d(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(r,l)=>(s(),o("span",{id:"connection-indicator",class:H(["badge",a.value])},p(m.value),3))}},$c={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},wc={class:"d-flex align-items-center gap-2"},kc={__name:"AppHeader",setup(n){const t=se();function a(){t.toggleSidebar()}return(m,r)=>(s(),o("header",$c,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:a},[...r[0]||(r[0]=[e("span",null,"â˜°",-1)])]),r[1]||(r[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",wc,[X(yc)])]))}},Sc={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},Cc={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},xc=["title"],Mc={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,a=d(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function m(g){return g.state==="paused"&&g.is_processing?"pending-prompt":g.is_processing?"processing":g.state}function r(g){const i=m(g);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[i]||"#d3d3d3"}function l(g){const i=m(g);return i==="starting"||i==="processing"||i==="pending-prompt"}function c(g){const i=m(g),v=i.charAt(0).toUpperCase()+i.slice(1),u=g.name||"Unnamed Session",h=g.is_minion&&g.role?` (${g.role})`:"";return`${u}${h}: ${v}`}return(g,i)=>(s(),o("div",Sc,[!n.sessions||n.sessions.length===0?(s(),o("div",Cc)):(s(!0),o(Y,{key:1},Z(n.sessions,v=>(s(),o("div",{key:v.session_id,class:H(["progress-bar",{"progress-bar-striped progress-bar-animated":l(v)}]),style:me({width:a.value,backgroundColor:r(v),cursor:"help"}),title:c(v)},null,14,xc))),128))]))}},jc=B(Mc,[["__scopeId","data-v-a79cfeec"]]),Tc={class:"flex-grow-1"},Ec={key:0,class:"text-muted small ms-1"},Lc={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(n){const t=n,a=pe(),m=K(),r=ae(),l=se(),c=d(()=>m.currentSessionId===t.session.session_id),g=d(()=>m.deletingSessions.has(t.session.session_id)),i=d(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),v=d(()=>{const x=i.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[x]||"status-dot-grey"}),u=d(()=>{const x=i.value,N={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},k={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:N[x]||"#d3d3d3",borderColor:k[x]||"#6c757d"}});function h(){m.selectSession(t.session.session_id),a.push(`/session/${t.session.session_id}`)}function f(){l.showModal("edit-session",{session:t.session})}function $(x){x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("application/session-id",t.session.session_id),x.dataTransfer.setData("application/project-id",t.projectId),x.dataTransfer.setData("text/plain",t.session.session_id),x.target.classList.add("dragging")}function T(x){x.target.classList.remove("dragging")}function b(x){x.preventDefault(),x.dataTransfer.dropEffect="move";const N=x.currentTarget.getBoundingClientRect(),k=N.top+N.height/2;x.clientY<k?(x.currentTarget.classList.add("drop-above"),x.currentTarget.classList.remove("drop-below")):(x.currentTarget.classList.add("drop-below"),x.currentTarget.classList.remove("drop-above"))}function y(x){x.preventDefault(),x.currentTarget.classList.remove("drop-above","drop-below");const N=x.dataTransfer.getData("application/session-id")||x.dataTransfer.getData("text/plain"),k=x.dataTransfer.getData("application/project-id");if(!N||N===t.session.session_id||k!==t.projectId)return;const S=x.currentTarget.getBoundingClientRect(),U=S.top+S.height/2,q=x.clientY<U,j=r.getProject(t.projectId);if(!j||!j.session_ids)return;const M=[...j.session_ids],P=M.indexOf(t.session.session_id),w=M.indexOf(N);if(P===-1||w===-1)return;const _=[...M],[C]=_.splice(w,1);let E=q?P:P+1;w<P&&E--,_.splice(E,0,C),r.reorderSessionsInProject(t.projectId,_)}return(x,N)=>(s(),o("div",{class:H(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:c.value,"session-deleting":g.value}]),style:{cursor:"pointer"},draggable:"true",onClick:h,onDragstart:$,onDragend:T,onDragover:b,onDrop:y},[e("div",{class:H(["status-dot me-2",v.value]),style:me(u.value)},null,6),e("div",Tc,[e("span",null,p(n.session.name||n.session.session_id),1),n.session.is_minion&&n.session.role?(s(),o("span",Ec,"("+p(n.session.role)+")",1)):D("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:ie(f,["stop"])}," âœï¸ ")],34))}},Pc=B(Lc,[["__scopeId","data-v-07ecbf94"]]),Ic={class:"d-flex align-items-center gap-2"},Dc=["value"],Nc={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,a=pe(),m=K(),r=se(),l=L("");ee(()=>a.currentRoute.value,b=>{!l.value&&b.name==="spy"&&b.params.minionId&&b.params.legionId===t.project.project_id&&(l.value=b.params.minionId)},{immediate:!0});const c=d(()=>l.value?t.sessions.find(b=>b.session_id===l.value):null),g=d(()=>{const b=a.currentRoute.value;return b.name==="spy"&&b.params.legionId===t.project.project_id}),i=d(()=>{if(!c.value)return"";if(c.value.state==="paused"&&c.value.is_processing)return"status-blinking";const b=c.value.is_processing?"processing":c.value.state;return b==="starting"||b==="processing"?"status-blinking":""}),v=d(()=>{if(!c.value)return{};if(c.value.state==="paused"&&c.value.is_processing)return{backgroundColor:"#ffc107"};const b=c.value.is_processing?"processing":c.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[b]||"#d3d3d3"}});function u(b){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[b.state]||"â—‹"}function h(b){return b.is_minion&&b.role?`${b.name} (${b.role})`:b.name}function f(){l.value&&a.push(`/spy/${t.project.project_id}/${l.value}`)}function $(){l.value?a.push(`/spy/${t.project.project_id}/${l.value}`):a.push("/")}function T(){c.value&&r.showModal("minion-view",{session:c.value})}return ee(()=>m.currentSessionId,b=>{if(b)t.sessions.some(y=>y.session_id===b)&&(l.value=b);else{l.value="";const y=a.currentRoute.value;y.name==="spy"&&y.params.legionId===t.project.project_id&&a.push("/")}}),(b,y)=>(s(),o("div",{class:H(["list-group-item list-group-item-action p-2",{active:g.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:me({cursor:l.value?"pointer":"default"}),onClick:f},[y[1]||(y[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ”"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),e("div",Ic,[c.value?(s(),o("button",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:ie(T,["stop"]),title:"View minion details"}," ðŸ‘ï¸ ")):D("",!0),c.value?(s(),o("span",{key:1,class:H(["minion-state-indicator",i.value]),style:me(v.value)}," ðŸ‘¤ ",6)):D("",!0)])],4),Q(e("select",{"onUpdate:modelValue":y[0]||(y[0]=x=>l.value=x),class:"form-select form-select-sm",onChange:$},[y[2]||(y[2]=e("option",{value:""},"-- Select Minion --",-1)),(s(!0),o(Y,null,Z(n.sessions,x=>(s(),o("option",{key:x.session_id,value:x.session_id},p(u(x))+" "+p(h(x)),9,Dc))),128))],544),[[ge,l.value]])],2))}},Oc=B(Nc,[["__scopeId","data-v-579589fb"]]),Ac={class:"accordion mt-2",id:"channelsAccordion"},Rc={class:"accordion-item"},Uc={class:"accordion-header"},qc={class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#channelsCollapsePanel","aria-expanded":"false","aria-controls":"channelsCollapsePanel"},Fc={class:"text-muted ms-2"},Wc={id:"channelsCollapsePanel",class:"accordion-collapse collapse","data-bs-parent":"#channelsAccordion"},Hc={class:"accordion-body p-0"},Bc={key:0,class:"text-muted text-center py-3",style:{"font-size":"0.875rem"}},Vc={key:1,class:"list-group list-group-flush"},zc=["onClick"],Gc={class:"d-flex align-items-center justify-content-between"},Jc={class:"d-flex align-items-center"},Kc={class:"channel-name"},Yc={class:"badge bg-secondary member-count"},Qc={__name:"ChannelList",props:{project:{type:Object,required:!0}},setup(n){const t=n,a=pe(),m=he(),r=d(()=>m.channelsByLegion.get(t.project.project_id)||[]),l=d(()=>r.value.length);function c(g){a.push(`/channel/${t.project.project_id}/${g}`)}return ne(async()=>{if(t.project.is_multi_agent)try{await m.loadChannels(t.project.project_id)}catch(g){console.error("Failed to load channels:",g)}}),(g,i)=>(s(),o("div",Ac,[e("div",Rc,[e("h2",Uc,[e("button",qc,[i[0]||(i[0]=e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ’¬",-1)),i[1]||(i[1]=e("span",{class:"fw-semibold"},"Channels",-1)),e("small",Fc,"("+p(l.value)+")",1)])]),e("div",Wc,[e("div",Hc,[r.value.length===0?(s(),o("div",Bc," No channels yet ")):(s(),o("div",Vc,[(s(!0),o(Y,null,Z(r.value,v=>(s(),o("div",{key:v.channel_id,class:"list-group-item list-group-item-action channel-item",onClick:u=>c(v.channel_id)},[e("div",Gc,[e("div",Jc,[i[2]||(i[2]=e("span",{style:{"font-size":"0.875rem","margin-right":"0.5rem"}},"ðŸ’¬",-1)),e("span",Kc,p(v.name),1)]),e("span",Yc,p(v.member_count||0),1)])],8,zc))),128))]))])])])]))}},Zc=B(Qc,[["__scopeId","data-v-afd27b61"]]),Xc=["data-project-id"],ed=["id"],td=["aria-expanded","aria-controls","onKeydown"],sd={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},od={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},nd={class:"fw-semibold",style:{"flex-shrink":"0"}},ld={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},ad={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},rd=["title"],id=["title"],cd=["id","aria-labelledby"],dd={class:"accordion-body p-0"},ud={class:"list-group list-group-flush"},md={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(n){const t=n,a=pe(),m=ae(),r=K(),l=se(),c=L(t.project.is_expanded||!1),g=d(()=>m.formatPath(t.project.working_directory)),i=d(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(q=>r.getSession(q)).filter(q=>q!=null)),v=d(()=>{const q=a.currentRoute.value;return q.name==="timeline"&&q.params.legionId===t.project.project_id}),u=d(()=>{const q=a.currentRoute.value;return q.name==="horde"&&q.params.legionId===t.project.project_id});function h(q){const j=window.bootstrap;if(!j)return;const M=document.getElementById(`collapse-${t.project.project_id}`);if(!M)return;j.Collapse.getOrCreateInstance(M).toggle()}function f(){c.value||(m.toggleExpansion(t.project.project_id),c.value=!0)}function $(){if(c.value){m.toggleExpansion(t.project.project_id),c.value=!1;const q=r.currentSessionId;q&&r.getSession(q)&&t.project.session_ids?.includes(q)&&a.push("/"),m.currentProjectId===t.project.project_id&&a.push("/")}}function T(){l.showModal("edit-project",{project:t.project})}function b(){t.project.is_multi_agent?l.showModal("create-minion",{project:t.project}):l.showModal("create-session",{project:t.project})}function y(){a.push(`/timeline/${t.project.project_id}`)}function x(){a.push(`/horde/${t.project.project_id}`)}function N(q){q.dataTransfer.effectAllowed="move",q.dataTransfer.setData("application/project-id",t.project.project_id),q.dataTransfer.setData("text/plain",t.project.project_id),q.target.classList.add("dragging")}function k(q){q.target.classList.remove("dragging")}function S(q){q.preventDefault(),q.dataTransfer.dropEffect="move";const j=q.currentTarget.getBoundingClientRect(),M=j.top+j.height/2;q.clientY<M?(q.currentTarget.classList.add("drop-above"),q.currentTarget.classList.remove("drop-below")):(q.currentTarget.classList.add("drop-below"),q.currentTarget.classList.remove("drop-above"))}function U(q){q.preventDefault(),q.currentTarget.classList.remove("drop-above","drop-below");const j=q.dataTransfer.getData("application/project-id")||q.dataTransfer.getData("text/plain");if(!j||j===t.project.project_id)return;const M=q.currentTarget.getBoundingClientRect(),P=M.top+M.height/2,w=q.clientY<P,_=m.orderedProjects,C=_.findIndex(W=>W.project_id===t.project.project_id),E=_.findIndex(W=>W.project_id===j);if(C===-1||E===-1)return;const O=[..._],[R]=O.splice(E,1);let I=w?C:C+1;E<C&&I--,O.splice(I,0,R);const A=O.map(W=>W.project_id);m.reorderProjects(A)}return(q,j)=>(s(),o("div",{class:"accordion-item border rounded mb-2","data-project-id":n.project.project_id,draggable:"true",onDragstart:N,onDragend:k,onDragover:S,onDrop:U},[e("h2",{class:"accordion-header",id:`heading-${n.project.project_id}`},[e("div",{class:H(["accordion-button bg-white p-2",{collapsed:!c.value}]),role:"button",tabindex:"0","aria-expanded":c.value,"aria-controls":`collapse-${n.project.project_id}`,onClick:h,onKeydown:[Se(ie(h,["prevent"]),["enter"]),Se(ie(h,["prevent"]),["space"])]},[e("div",sd,[e("div",od,[e("div",nd,[n.project.is_multi_agent?(s(),o("span",ld,"ðŸ›")):D("",!0),G(" "+p(n.project.name),1)]),e("div",ad,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:ie(T,["stop"])}," âœï¸ "),e("button",{class:"btn btn-sm btn-outline-primary",title:n.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:ie(b,["stop"])}," âž• ",8,rd)])]),e("small",{class:"text-muted font-monospace",title:n.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},p(g.value),9,id)])],42,td)],8,ed),X(jc,{project:n.project,sessions:i.value},null,8,["project","sessions"]),e("div",{id:`collapse-${n.project.project_id}`,class:H(["accordion-collapse collapse",{show:c.value}]),"aria-labelledby":`heading-${n.project.project_id}`,onShown:f,onHidden:$},[e("div",dd,[e("div",ud,[n.project.is_multi_agent?(s(),o("div",{key:0,class:H(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:v.value}]),style:{cursor:"pointer"},onClick:y},[...j[0]||(j[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ“Š"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):D("",!0),n.project.is_multi_agent?(s(),o(Y,{key:1},[e("div",{class:H(["list-group-item list-group-item-action horde-item d-flex align-items-center p-2",{active:u.value}]),style:{cursor:"pointer"},onClick:x},[...j[1]||(j[1]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸŒ³"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],2),X(Oc,{project:n.project,sessions:i.value},null,8,["project","sessions"]),X(Zc,{project:n.project},null,8,["project"])],64)):(s(!0),o(Y,{key:2},Z(i.value,M=>(s(),de(Pc,{key:M.session_id,session:M,"project-id":n.project.project_id},null,8,["session","project-id"]))),128))])])],42,cd)],40,Xc))}},pd=B(md,[["__scopeId","data-v-04f4e534"]]),vd={class:"project-list"},fd={key:0,class:"text-muted text-center py-3"},gd={__name:"ProjectList",setup(n){const t=ae(),a=d(()=>t.orderedProjects);return(m,r)=>(s(),o("div",vd,[a.value.length===0?(s(),o("div",fd,' No projects yet. Click "New" to create one. ')):D("",!0),(s(!0),o(Y,null,Z(a.value,l=>(s(),de(pd,{key:l.project_id,project:l},null,8,["project"]))),128))]))}},_d={class:"flex-grow-1 overflow-auto p-3"},hd={id:"sessions-container"},bd={__name:"Sidebar",setup(n){const t=se(),a=d(()=>t.sidebarCollapsed),m=d(()=>t.isMobile),r=d(()=>{if(m.value)return{};const u=`${t.sidebarWidth}px`;return{width:u,minWidth:"200px",maxWidth:"30vw","--sidebar-width":u}});function l(){t.showModal("create-project")}const c=L(!1);function g(u){c.value=!0,document.addEventListener("mousemove",i),document.addEventListener("mouseup",v)}function i(u){c.value&&t.setSidebarWidth(u.clientX)}function v(){c.value=!1,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",v)}return(u,h)=>(s(),o("aside",{id:"sidebar",class:H(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:a.value,"mobile-open":!a.value&&m.value,"desktop-collapsed":a.value&&!m.value}]),style:me(r.value)},[e("div",_d,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[h[0]||(h[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:l}," ðŸ“ New ")]),e("div",hd,[X(gd)])]),e("div",{class:"sidebar-resize-handle",onMousedown:g},null,32)],6))}},yd=B(bd,[["__scopeId","data-v-d792f0f0"]]),$d={class:"modal-dialog modal-lg"},wd={class:"modal-content"},kd={class:"modal-body"},Sd={class:"mb-3"},Cd={class:"input-group"},xd=["disabled"],Md={key:0,class:"text-center py-4"},jd={key:1,class:"alert alert-danger",role:"alert"},Td={key:2,class:"folder-list"},Ed=["onClick","onDblclick"],Ld={class:"d-flex align-items-center flex-grow-1"},Pd=["onClick"],Id={key:1,class:"text-center text-muted py-3"},Dd={class:"modal-footer"},Nd=["disabled"],Od={__name:"FolderBrowserModal",setup(n){const t=se(),a=L(""),m=L(""),r=L([]),l=L(!1),c=L(""),g=L(null);let i=null,v=null;const u=d(()=>{if(!a.value)return null;const k=a.value.split(/[\\/]/).filter(Boolean);return k.length<=1?null:(k.pop(),k.length>0?k.join("/"):"/")});function h(k){if(!k)return"";const S=k.split(/[\\/]/).filter(Boolean);return S.length<=2?k:".../"+S.slice(-2).join("/")}async function f(){l.value=!0,c.value="",r.value=[],m.value="";try{const k=a.value?{path:a.value}:{},S=await J.get("/api/filesystem/browse",{params:k});S.current_path&&(a.value=S.current_path),r.value=S.directories||[]}catch(k){console.error("Failed to load directory:",k),c.value=k.message||"Failed to load directory"}finally{l.value=!1}}function $(k){m.value=k.path}function T(k){a.value=k.path,m.value="",f()}function b(){u.value&&(a.value=u.value,m.value="",f())}function y(){const k=m.value||a.value;k&&v&&v(k),i&&i.hide()}function x(){f()}function N(){r.value=[],m.value="",c.value="",v=null,t.hideModal()}return ee(()=>t.currentModal,k=>{if(k?.name==="folder-browser"&&i){const S=k.data||{};a.value=S.currentPath||"",v=S.onSelect||null,i.show()}}),ne(()=>{g.value&&re(async()=>{const{default:k}=await import("./modal-B4rHLo2F.js").then(S=>S.m);return{default:k}},__vite__mapDeps([0,1])).then(({default:k})=>{i=new k(g.value),g.value.addEventListener("shown.bs.modal",x),g.value.addEventListener("hidden.bs.modal",N)})}),ce(()=>{g.value&&(g.value.removeEventListener("shown.bs.modal",x),g.value.removeEventListener("hidden.bs.modal",N)),i&&i.dispose()}),(k,S)=>(s(),o("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:g},[e("div",$d,[e("div",wd,[S[7]||(S[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",kd,[e("div",Sd,[S[2]||(S[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",Cd,[Q(e("input",{type:"text",class:"form-control","onUpdate:modelValue":S[0]||(S[0]=U=>a.value=U),onKeyup:Se(f,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[le,a.value]]),e("button",{class:"btn btn-outline-secondary",onClick:f,disabled:l.value},[...S[1]||(S[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),G(" Refresh ",-1)])],8,xd)])]),l.value?(s(),o("div",Md,[...S[3]||(S[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):c.value?(s(),o("div",jd,p(c.value),1)):(s(),o("div",Td,[u.value?(s(),o("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:b,role:"button"},[...S[4]||(S[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):D("",!0),(s(!0),o(Y,null,Z(r.value,U=>(s(),o("div",{key:U.path,class:H(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:U.path===m.value}]),onClick:q=>$(U),onDblclick:q=>T(U),role:"button"},[e("div",Ld,[S[5]||(S[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,p(U.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:ie(q=>T(U),["stop"])}," Open ",8,Pd)],42,Ed))),128)),r.value.length===0?(s(),o("div",Id," No subdirectories found ")):D("",!0)]))]),e("div",Dd,[S[6]||(S[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:y,disabled:!m.value},' Select "'+p(h(m.value||a.value))+'" ',9,Nd)])])])],512))}},Ad=B(Od,[["__scopeId","data-v-667c51a9"]]),Rd={class:"modal-dialog"},Ud={class:"modal-content"},qd={class:"modal-body"},Fd={class:"mb-3"},Wd={key:0,class:"invalid-feedback"},Hd={class:"mb-3"},Bd={class:"input-group"},Vd={key:0,class:"invalid-feedback"},zd={class:"mb-3 form-check"},Gd={class:"mb-3 form-check"},Jd={class:"form-check-label",for:"createSession"},Kd={key:0,class:"mb-3 ms-4"},Yd={for:"sessionName",class:"form-label"},Qd={key:1,class:"alert alert-danger",role:"alert"},Zd={class:"modal-footer"},Xd=["disabled"],eu={key:0,class:"spinner-border spinner-border-sm me-2"},tu={__name:"ProjectCreateModal",setup(n){const t=ae(),a=K(),m=se(),r=L({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),l=L({name:"",workingDirectory:""}),c=L(!1),g=L(""),i=L(null);let v=null;function u(){m.showModal("folder-browser",{currentPath:r.value.workingDirectory||"",onSelect:y=>{r.value.workingDirectory=y,l.value.workingDirectory=""}})}function h(){l.value={};let y=!0;return r.value.name.trim()||(l.value.name="Project name is required",y=!1),r.value.workingDirectory.trim()||(l.value.workingDirectory="Working directory is required",y=!1),y}async function f(){if(h()){c.value=!0,g.value="";try{const y=await t.createProject(r.value.name,r.value.workingDirectory,r.value.isMultiAgent);r.value.createSession&&await a.createSession(y.project_id,{name:r.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),v&&v.hide(),$()}catch(y){console.error("Failed to create project:",y),g.value=y.message||"Failed to create project. Please try again."}finally{c.value=!1}}}function $(){r.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},l.value={},g.value=""}function T(){const y=document.getElementById("projectName");y&&y.focus()}function b(){$(),m.hideModal()}return ee(()=>m.currentModal,y=>{y?.name==="create-project"&&v&&v.show()}),ne(()=>{i.value&&re(async()=>{const{default:y}=await import("./modal-B4rHLo2F.js").then(x=>x.m);return{default:y}},__vite__mapDeps([0,1])).then(({default:y})=>{v=new y(i.value),i.value.addEventListener("shown.bs.modal",T),i.value.addEventListener("hidden.bs.modal",b)})}),ce(()=>{i.value&&(i.value.removeEventListener("shown.bs.modal",T),i.value.removeEventListener("hidden.bs.modal",b)),v&&v.dispose()}),(y,x)=>(s(),o("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",Rd,[e("div",Ud,[x[11]||(x[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",qd,[e("form",{onSubmit:ie(f,["prevent"])},[e("div",Fd,[x[5]||(x[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":l.value.name}]),id:"projectName","onUpdate:modelValue":x[0]||(x[0]=N=>r.value.name=N),placeholder:"My Project",required:""},null,2),[[le,r.value.name]]),l.value.name?(s(),o("div",Wd,p(l.value.name),1)):D("",!0)]),e("div",Hd,[x[6]||(x[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",Bd,[Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":l.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":x[1]||(x[1]=N=>r.value.workingDirectory=N),placeholder:"/path/to/project",required:""},null,2),[[le,r.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:u}," Browse... "),l.value.workingDirectory?(s(),o("div",Vd,p(l.value.workingDirectory),1)):D("",!0)]),x[7]||(x[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",zd,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":x[2]||(x[2]=N=>r.value.isMultiAgent=N)},null,512),[[be,r.value.isMultiAgent]]),x[8]||(x[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," ðŸ› Multi-Agent Project (Legion) ",-1)),x[9]||(x[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",Gd,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":x[3]||(x[3]=N=>r.value.createSession=N)},null,512),[[be,r.value.createSession]]),e("label",Jd," Create initial "+p(r.value.isMultiAgent?"minion":"session"),1)]),r.value.createSession?(s(),o("div",Kd,[e("label",Yd," Initial "+p(r.value.isMultiAgent?"Minion":"Session")+" Name ",1),Q(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":x[4]||(x[4]=N=>r.value.sessionName=N),placeholder:"main"},null,512),[[le,r.value.sessionName]])])):D("",!0),g.value?(s(),o("div",Qd,p(g.value),1)):D("",!0)],32)]),e("div",Zd,[x[10]||(x[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:f,disabled:c.value},[c.value?(s(),o("span",eu)):D("",!0),G(" "+p(c.value?"Creating...":"Create Project"),1)],8,Xd)])])])],512))}},su=B(tu,[["__scopeId","data-v-adf50394"]]),ou={class:"modal-dialog"},nu={class:"modal-content"},lu={class:"modal-body"},au={class:"mb-3"},ru={key:0,class:"invalid-feedback"},iu={class:"mb-3"},cu=["value"],du={key:0,class:"alert alert-danger",role:"alert"},uu={class:"danger-zone"},mu={class:"text-muted small"},pu=["disabled"],vu={key:0,class:"alert alert-warning mt-3",role:"alert"},fu={class:"mb-2"},gu={class:"d-flex gap-2"},_u=["disabled"],hu={key:0,class:"spinner-border spinner-border-sm me-2"},bu=["disabled"],yu={class:"modal-footer"},$u=["disabled"],wu={key:0,class:"spinner-border spinner-border-sm me-2"},ku={__name:"ProjectEditModal",setup(n){const t=ae(),a=se(),m=L(null),r=L({name:""}),l=L({name:""}),c=L(!1),g=L(!1),i=L(""),v=L(!1),u=L(null);let h=null;const f=d(()=>m.value?.session_ids?.length||0);function $(){l.value={};let k=!0;return r.value.name.trim()||(l.value.name="Project name is required",k=!1),k}async function T(){if(!(!$()||!m.value)){c.value=!0,i.value="";try{await t.updateProject(m.value.project_id,{name:r.value.name}),h&&h.hide()}catch(k){console.error("Failed to update project:",k),i.value=k.message||"Failed to update project. Please try again."}finally{c.value=!1}}}async function b(){if(m.value){g.value=!0,i.value="";try{await t.deleteProject(m.value.project_id),h&&h.hide()}catch(k){console.error("Failed to delete project:",k),i.value=k.message||"Failed to delete project. Please try again."}finally{g.value=!1}}}function y(){r.value={name:""},l.value={},i.value="",v.value=!1}function x(){const k=document.getElementById("editProjectName");k&&(k.focus(),k.select())}function N(){y(),m.value=null,a.hideModal()}return ee(()=>a.currentModal,k=>{if(k?.name==="edit-project"&&h){const S=k.data||{};m.value=S.project,m.value&&(r.value.name=m.value.name),h.show()}}),ne(()=>{u.value&&re(async()=>{const{default:k}=await import("./modal-B4rHLo2F.js").then(S=>S.m);return{default:k}},__vite__mapDeps([0,1])).then(({default:k})=>{h=new k(u.value),u.value.addEventListener("shown.bs.modal",x),u.value.addEventListener("hidden.bs.modal",N)})}),ce(()=>{u.value&&(u.value.removeEventListener("shown.bs.modal",x),u.value.removeEventListener("hidden.bs.modal",N)),h&&h.dispose()}),(k,S)=>(s(),o("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:u},[e("div",ou,[e("div",nu,[S[11]||(S[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",lu,[e("form",{onSubmit:ie(T,["prevent"])},[e("div",au,[S[3]||(S[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":l.value.name}]),id:"editProjectName","onUpdate:modelValue":S[0]||(S[0]=U=>r.value.name=U),placeholder:"My Project",required:""},null,2),[[le,r.value.name]]),l.value.name?(s(),o("div",ru,p(l.value.name),1)):D("",!0)]),e("div",iu,[S[4]||(S[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:m.value?.working_directory,disabled:"",readonly:""},null,8,cu),S[5]||(S[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),i.value?(s(),o("div",du,p(i.value),1)):D("",!0)],32),S[9]||(S[9]=e("hr",null,null,-1)),e("div",uu,[S[7]||(S[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",mu," Deleting this project will also delete all "+p(f.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:S[1]||(S[1]=U=>v.value=!0),disabled:g.value},[...S[6]||(S[6]=[e("i",{class:"bi bi-trash"},null,-1),G(" Delete Project ",-1)])],8,pu)]),v.value?(s(),o("div",vu,[S[8]||(S[8]=e("strong",null,"Are you sure?",-1)),e("p",fu,' This will permanently delete the project "'+p(m.value?.name)+'" and all '+p(f.value)+" session(s). ",1),e("div",gu,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:b,disabled:g.value},[g.value?(s(),o("span",hu)):D("",!0),G(" "+p(g.value?"Deleting...":"Yes, Delete Permanently"),1)],8,_u),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:S[2]||(S[2]=U=>v.value=!1),disabled:g.value}," Cancel ",8,bu)])])):D("",!0)]),e("div",yu,[S[10]||(S[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:T,disabled:c.value},[c.value?(s(),o("span",wu)):D("",!0),G(" "+p(c.value?"Saving...":"Save Changes"),1)],8,$u)])])])],512))}},Su=B(ku,[["__scopeId","data-v-6f299f35"]]),Cu={class:"modal-dialog modal-lg"},xu={class:"modal-content"},Mu={class:"modal-header"},ju={class:"modal-title",id:"createSessionModalLabel"},Tu={key:0,class:"text-muted small"},Eu={class:"modal-body"},Lu={class:"mb-3"},Pu={key:0,class:"invalid-feedback"},Iu={class:"mb-3"},Du={class:"mb-3"},Nu={class:"mb-3"},Ou={class:"form-text d-flex justify-content-between"},Au={key:0,class:"invalid-feedback"},Ru={class:"mb-3 form-check"},Uu={key:0,class:"form-text text-warning"},qu={class:"mb-3"},Fu={class:"mb-3 form-check"},Wu={key:0,class:"alert alert-danger",role:"alert"},Hu={class:"modal-footer"},Bu=["disabled"],Vu={key:0,class:"spinner-border spinner-border-sm me-2"},zu={__name:"SessionCreateModal",setup(n){const t=pe();ae();const a=K(),m=se(),r=L(null),l=L({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0}),c=L({name:""}),g=L(!1),i=L(""),v=L(null);let u=null;const h=d(()=>l.value.system_prompt.length),f=d(()=>h.value>6e3),$=d(()=>h.value>5500&&h.value<=6e3);function T(){c.value={};let k=!0;return l.value.name.trim()||(c.value.name="Session name is required",k=!1),f.value&&(k=!1),k}async function b(){if(!(!T()||!r.value)){g.value=!0,i.value="";try{const k=l.value.tools.split(",").map(q=>q.trim()).filter(q=>q.length>0),S={name:l.value.name,permission_mode:l.value.permission_mode,model:l.value.model,system_prompt:l.value.system_prompt.trim()||null,override_system_prompt:l.value.override_system_prompt,tools:k},U=await a.createSession(r.value.project_id,S);l.value.startImmediately&&await a.startSession(U.session_id),t.push(`/session/${U.session_id}`),u&&u.hide(),y()}catch(k){console.error("Failed to create session:",k),i.value=k.message||"Failed to create session. Please try again."}finally{g.value=!1}}}function y(){l.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0},c.value={},i.value=""}function x(){const k=document.getElementById("sessionName");k&&k.focus()}function N(){y(),r.value=null,m.hideModal()}return ee(()=>m.currentModal,k=>{if(k?.name==="create-session"&&u){const S=k.data||{};r.value=S.project,u.show()}}),ne(()=>{v.value&&re(async()=>{const{default:k}=await import("./modal-B4rHLo2F.js").then(S=>S.m);return{default:k}},__vite__mapDeps([0,1])).then(({default:k})=>{u=new k(v.value),v.value.addEventListener("shown.bs.modal",x),v.value.addEventListener("hidden.bs.modal",N)})}),ce(()=>{v.value&&(v.value.removeEventListener("shown.bs.modal",x),v.value.removeEventListener("hidden.bs.modal",N)),u&&u.dispose()}),(k,S)=>(s(),o("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",Cu,[e("div",xu,[e("div",Mu,[e("h5",ju,[S[7]||(S[7]=G(" Create New Session ",-1)),r.value?(s(),o("span",Tu,"in "+p(r.value.name),1)):D("",!0)]),S[8]||(S[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Eu,[e("form",{onSubmit:ie(b,["prevent"])},[e("div",Lu,[S[9]||(S[9]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":c.value.name}]),id:"sessionName","onUpdate:modelValue":S[0]||(S[0]=U=>l.value.name=U),placeholder:"main",required:""},null,2),[[le,l.value.name]]),c.value.name?(s(),o("div",Pu,p(c.value.name),1)):D("",!0)]),e("div",Iu,[S[11]||(S[11]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Q(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":S[1]||(S[1]=U=>l.value.permission_mode=U)},[...S[10]||(S[10]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"âš ï¸ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[ge,l.value.permission_mode]]),S[12]||(S[12]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",Du,[S[14]||(S[14]=e("label",{for:"model",class:"form-label"},"Model",-1)),Q(e("select",{class:"form-select",id:"model","onUpdate:modelValue":S[2]||(S[2]=U=>l.value.model=U)},[...S[13]||(S[13]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[ge,l.value.model]])]),e("div",Nu,[S[15]||(S[15]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),Q(e("textarea",{class:H(["form-control",{"is-invalid":f.value}]),id:"systemPrompt","onUpdate:modelValue":S[3]||(S[3]=U=>l.value.system_prompt=U),rows:"3",maxlength:6e3,placeholder:"Additional instructions to append to the system prompt..."},null,2),[[le,l.value.system_prompt]]),e("div",Ou,[e("span",null,p(l.value.override_system_prompt?"These instructions will replace Claude Code's default system prompt":"These instructions will be appended to Claude Code's default system prompt"),1),e("span",{class:H({"text-danger":f.value,"text-warning":$.value})},p(h.value)+" / 6000 chars ",3)]),f.value?(s(),o("div",Au," System prompt exceeds 6000 character limit (Windows command-line constraint) ")):D("",!0)]),e("div",Ru,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":S[4]||(S[4]=U=>l.value.override_system_prompt=U)},null,512),[[be,l.value.override_system_prompt]]),S[17]||(S[17]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom prompt only) ",-1)),l.value.override_system_prompt?(s(),o("div",Uu,[...S[16]||(S[16]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom instructions will be used (no Claude Code preset).",-1)])])):D("",!0)]),e("div",qu,[S[18]||(S[18]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),Q(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":S[5]||(S[5]=U=>l.value.tools=U),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[le,l.value.tools]]),S[19]||(S[19]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",Fu,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":S[6]||(S[6]=U=>l.value.startImmediately=U)},null,512),[[be,l.value.startImmediately]]),S[20]||(S[20]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),i.value?(s(),o("div",Wu,p(i.value),1)):D("",!0)],32)]),e("div",Hu,[S[21]||(S[21]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:b,disabled:g.value},[g.value?(s(),o("span",Vu)):D("",!0),G(" "+p(g.value?"Creating...":"Create Session"),1)],8,Bu)])])])],512))}},Gu=B(zu,[["__scopeId","data-v-5aef47e0"]]),Ju={class:"modal-dialog"},Ku={class:"modal-content"},Yu={class:"modal-body"},Qu={class:"mb-3"},Zu={key:0,class:"invalid-feedback"},Xu={class:"mb-3"},em=["value"],tm={class:"mb-3"},sm={class:"form-control-plaintext"},om={class:"mb-3"},nm=["disabled"],lm={key:0,value:"bypassPermissions"},am={class:"form-text"},rm={key:0,class:"text-warning"},im={key:1},cm={key:0,class:"mb-3"},dm={class:"card"},um={class:"card-body"},mm={key:0,class:"mb-2"},pm={key:1,class:"mb-2"},vm={key:2,class:"mt-2"},fm={class:"form-control",style:{height:"auto","min-height":"60px","white-space":"pre-wrap"},readonly:""},gm={key:1,class:"alert alert-danger",role:"alert"},_m={class:"modal-footer"},hm=["disabled"],bm={key:0,class:"spinner-border spinner-border-sm me-2"},ym={__name:"SessionEditModal",setup(n){const t=K(),a=se(),m=L(null),r=L({name:"",permission_mode:"default"}),l=L({name:""}),c=L(!1),g=L(""),i=L(null);let v=null;const u=d(()=>m.value?.state==="active"||m.value?.state==="starting"),h=d(()=>m.value?.initial_permission_mode==="bypassPermissions");function f(N){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[N]||"bg-secondary"}function $(){l.value={};let N=!0;return r.value.name.trim()||(l.value.name="Session name is required",N=!1),N}async function T(){if(!(!$()||!m.value)){c.value=!0,g.value="";try{await t.updateSessionName(m.value.session_id,r.value.name),r.value.permission_mode!==m.value.current_permission_mode&&await t.setPermissionMode(m.value.session_id,r.value.permission_mode),v&&v.hide()}catch(N){console.error("Failed to update session:",N),g.value=N.message||"Failed to update session. Please try again."}finally{c.value=!1}}}function b(){r.value={name:"",permission_mode:"default"},l.value={},g.value=""}function y(){const N=document.getElementById("editSessionName");N&&(N.focus(),N.select())}function x(){b(),m.value=null,a.hideModal()}return ee(()=>a.currentModal,N=>{if(N?.name==="edit-session"&&v){const k=N.data||{};m.value=k.session,m.value&&(r.value.name=m.value.name,r.value.permission_mode=m.value.current_permission_mode||"default"),v.show()}}),ne(()=>{i.value&&re(async()=>{const{default:N}=await import("./modal-B4rHLo2F.js").then(k=>k.m);return{default:N}},__vite__mapDeps([0,1])).then(({default:N})=>{v=new N(i.value),i.value.addEventListener("shown.bs.modal",y),i.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{i.value&&(i.value.removeEventListener("shown.bs.modal",y),i.value.removeEventListener("hidden.bs.modal",x)),v&&v.dispose()}),(N,k)=>(s(),o("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",Ju,[e("div",Ku,[k[15]||(k[15]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Yu,[e("form",{onSubmit:ie(T,["prevent"])},[e("div",Qu,[k[2]||(k[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),Q(e("input",{type:"text",class:H(["form-control",{"is-invalid":l.value.name}]),id:"editSessionName","onUpdate:modelValue":k[0]||(k[0]=S=>r.value.name=S),placeholder:"Session Name",required:""},null,2),[[le,r.value.name]]),l.value.name?(s(),o("div",Zu,p(l.value.name),1)):D("",!0)]),e("div",Xu,[k[3]||(k[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:m.value?.working_directory,disabled:"",readonly:""},null,8,em),k[4]||(k[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",tm,[k[5]||(k[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",sm,[e("span",{class:H(["badge",f(m.value?.state)])},p(m.value?.state),3)])]),e("div",om,[k[9]||(k[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Q(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":k[1]||(k[1]=S=>r.value.permission_mode=S),disabled:!u.value},[k[6]||(k[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),k[7]||(k[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),k[8]||(k[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),h.value?(s(),o("option",lm,"âš ï¸ Bypass Permissions (No prompts)")):D("",!0)],8,nm),[[ge,r.value.permission_mode]]),e("div",am,[u.value?(s(),o("span",im," Controls which tool actions require permission prompts ")):(s(),o("span",rm," âš ï¸ Session must be active to change permission mode. Start the session first. "))])]),m.value?.system_prompt||m.value?.override_system_prompt?(s(),o("div",cm,[k[13]||(k[13]=e("label",{class:"form-label"},"System Prompt Configuration",-1)),e("div",dm,[e("div",um,[m.value?.override_system_prompt?(s(),o("div",mm,[...k[10]||(k[10]=[e("span",{class:"badge bg-warning text-dark"},"Override Mode",-1),e("div",{class:"form-text text-warning mt-1"}," Using custom prompt only (no Claude Code preset) ",-1)])])):(s(),o("div",pm,[...k[11]||(k[11]=[e("span",{class:"badge bg-info"},"Append Mode",-1),e("div",{class:"form-text mt-1"}," Custom instructions appended to Claude Code preset ",-1)])])),m.value?.system_prompt?(s(),o("div",vm,[k[12]||(k[12]=e("strong",{class:"small"},"Custom Instructions:",-1)),e("div",fm,p(m.value.system_prompt),1)])):D("",!0)])])])):D("",!0),g.value?(s(),o("div",gm,p(g.value),1)):D("",!0)],32)]),e("div",_m,[k[14]||(k[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:T,disabled:c.value},[c.value?(s(),o("span",bm)):D("",!0),G(" "+p(c.value?"Saving...":"Save Changes"),1)],8,hm)])])])],512))}},$m=B(ym,[["__scopeId","data-v-c99ca17f"]]),wm={class:"modal-dialog modal-dialog-centered"},km={class:"modal-content"},Sm={class:"modal-header"},Cm={class:"modal-title",id:"manageSessionModalLabel"},xm={class:"modal-body"},Mm={key:0,class:"text-center py-4"},jm={class:"text-muted"},Tm={key:1},Em={key:2},Lm={class:"text-muted"},Pm={key:3},Im={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Dm={class:"d-grid gap-2"},Nm=["disabled"],Om=["disabled"],Am=["disabled"],Rm=["disabled"],Um={class:"modal-footer"},qm={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Fm={__name:"SessionManageModal",setup(n){const t=pe(),a=K(),m=se(),r=ve();ue();const l=L(null),c=L(!1),g=L(""),i=L(""),v=L(null),u=L(null);let h=null;const f=d(()=>v.value==="reset"?"Reset Session":v.value==="delete"?"Delete Session":"Manage Session");function $(){v.value="reset"}function T(){v.value="delete"}function b(){v.value=null}async function y(){v.value==="reset"?await k():v.value==="delete"&&await S()}async function x(){if(l.value){c.value=!0,g.value="Restarting session...";try{const j=l.value.session_id,M=await J.post(`/api/sessions/${j}/restart`);if(M.success)console.log("Session restarted successfully, reconnecting"),await r.disconnectSession(),a.currentSessionId=null,await a.selectSession(j),h&&h.hide();else{const P=M.error||M.detail||"Failed to restart session";console.error("Failed to restart session:",P),i.value=`Failed to restart session: ${P}`}}catch(j){console.error("Error restarting session:",j);const M=j.data?.detail||j.message||"Unknown error";i.value=`Error restarting session: ${M}`}finally{c.value=!1}}}async function N(){if(l.value)try{h&&h.hide(),console.log("Ending session",l.value.session_id);const j=l.value.session_id;await J.post(`/api/sessions/${j}/terminate`),await r.disconnectSession(),a.currentSessionId===j&&(a.currentSessionId=null),t.push("/")}catch(j){console.error("Error ending session:",j),await r.disconnectSession(),a.currentSessionId===l.value?.session_id&&(a.currentSessionId=null),t.push("/")}}async function k(){if(l.value){c.value=!0,g.value="Resetting session...";try{const j=l.value.session_id,M=await J.post(`/api/sessions/${j}/reset`);if(M.success)console.log("Session reset successfully, reconnecting"),await r.disconnectSession(),a.currentSessionId=null,await a.selectSession(j),h&&h.hide();else{const P=M.error||M.detail||"Failed to reset session";console.error("Failed to reset session:",P),i.value=`Failed to reset session: ${P}`,v.value=null}}catch(j){console.error("Error resetting session:",j);const M=j.data?.detail||j.message||"Unknown error";i.value=`Error resetting session: ${M}`,v.value=null}finally{c.value=!1}}}async function S(){if(l.value){c.value=!0,g.value="Deleting session...";try{const j=l.value.session_id;await a.deleteSession(j),t.currentRoute.value.params.sessionId===j&&t.push("/"),h&&h.hide()}catch(j){console.error("Error deleting session:",j);const M=j.data?.detail||j.message||"Unknown error";i.value=`Error deleting session: ${M}`,v.value=null}finally{c.value=!1}}}function U(){v.value=null,c.value=!1,g.value="",i.value=""}function q(){U(),l.value=null,m.hideModal()}return ee(()=>m.currentModal,j=>{if(j?.name==="manage-session"&&h){const M=j.data||{};l.value=M.session,U(),h.show()}}),ne(()=>{u.value&&re(async()=>{const{default:j}=await import("./modal-B4rHLo2F.js").then(M=>M.m);return{default:j}},__vite__mapDeps([0,1])).then(({default:j})=>{h=new j(u.value),u.value.addEventListener("hidden.bs.modal",q)})}),ce(()=>{u.value&&u.value.removeEventListener("hidden.bs.modal",q),h&&h.dispose()}),(j,M)=>(s(),o("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:u},[e("div",wm,[e("div",km,[e("div",Sm,[e("h5",Cm,p(v.value?f.value:"Manage Session"),1),M[1]||(M[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",xm,[c.value?(s(),o("div",Mm,[M[2]||(M[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",jm,p(g.value),1)])):v.value==="reset"?(s(),o("div",Tm,[...M[3]||(M[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):v.value==="delete"?(s(),o("div",Em,[M[6]||(M[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1)),e("p",Lm,[M[4]||(M[4]=G("This will permanently delete session ",-1)),e("strong",null,p(l.value?.name),1),M[5]||(M[5]=G(".",-1))]),M[7]||(M[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(s(),o("div",Pm,[i.value?(s(),o("div",Im,[M[8]||(M[8]=e("strong",null,"Error:",-1)),G(" "+p(i.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:M[0]||(M[0]=P=>i.value="")})])):D("",!0),M[15]||(M[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",Dm,[e("button",{class:"btn btn-outline-primary text-start",onClick:x,disabled:c.value},[...M[9]||(M[9]=[e("strong",null,"ðŸ”„ Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,Nm),e("button",{class:"btn btn-outline-secondary text-start",onClick:N,disabled:c.value},[...M[10]||(M[10]=[e("strong",null,"ðŸšª End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,Om),M[13]||(M[13]=e("hr",{class:"my-2"},null,-1)),M[14]||(M[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"âš ï¸ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:$,disabled:c.value},[...M[11]||(M[11]=[e("strong",null,"ðŸ—‘ï¸ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,Am),e("button",{class:"btn btn-outline-danger text-start",onClick:T,disabled:c.value},[...M[12]||(M[12]=[e("strong",null,"âŒ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,Rm)]),M[16]||(M[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),G(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",Um,[v.value&&!c.value?(s(),o(Y,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:b},"Cancel"),e("button",{type:"button",class:H(["btn",v.value==="delete"?"btn-danger":"btn-warning"]),onClick:y},p(v.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):c.value?D("",!0):(s(),o("button",qm,"Cancel"))])])])],512))}},Wm=B(Fm,[["__scopeId","data-v-de7ff18c"]]),Hm={class:"modal-dialog modal-dialog-centered modal-lg"},Bm={class:"modal-content"},Vm={class:"modal-body"},zm={key:0,class:"text-center text-muted py-4"},Gm={key:1},Jm={class:"mb-3"},Km={class:"font-monospace small"},Ym={class:"mb-3"},Qm={class:"font-monospace small"},Zm={class:"mb-3"},Xm={class:"mb-3"},ep={class:"mb-3"},tp={key:0},sp={class:"d-flex flex-wrap gap-1"},op={key:1,class:"text-muted small"},np={key:0,class:"mb-3"},lp={class:"d-flex flex-wrap gap-1"},ap={key:1,class:"mb-3"},rp={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},ip={class:"mb-3"},cp={class:"text-muted"},dp={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},up={__name:"SessionInfoModal",setup(n){const t=K(),a=ue(),m=se(),r=L(null),l=L(!1),c=L(null);let g=null;const i=d(()=>{if(!r.value)return null;const f=t.initData.get(r.value);return f||(a.messagesBySession.get(r.value)||[]).find(b=>b.type==="system"&&(b.subtype==="init"||b.metadata?.subtype==="init")&&b.metadata?.init_data)?.metadata?.init_data||null});function v(f){return typeof f=="string"?f:typeof f=="object"&&f.type==="preset"?`Preset: ${f.preset}`:JSON.stringify(f,null,2)}function u(){r.value=null,l.value=!1}function h(){u(),m.hideModal()}return ee(()=>m.currentModal,f=>{if(f?.name==="session-info"&&g){const $=f.data||{};r.value=$.sessionId,l.value=!1,g.show()}}),ne(()=>{c.value&&re(async()=>{const{default:f}=await import("./modal-B4rHLo2F.js").then($=>$.m);return{default:f}},__vite__mapDeps([0,1])).then(({default:f})=>{g=new f(c.value),c.value.addEventListener("hidden.bs.modal",h)})}),ce(()=>{c.value&&c.value.removeEventListener("hidden.bs.modal",h),g&&g.dispose()}),(f,$)=>(s(),o("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:c},[e("div",Hm,[e("div",Bm,[$[9]||($[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Vm,[i.value?(s(),o("div",Gm,[e("div",Jm,[$[1]||($[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Km,p(r.value),1)]),e("div",Ym,[$[2]||($[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",Qm,p(i.value.cwd||"Not specified"),1)]),e("div",Zm,[$[3]||($[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,p(i.value.model||"Default"),1)]),e("div",Xm,[$[4]||($[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,p(i.value.permissionMode||"default"),1)]),e("div",ep,[$[5]||($[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),i.value.tools&&i.value.tools.length>0?(s(),o("div",tp,[e("div",sp,[(s(!0),o(Y,null,Z(i.value.tools,T=>(s(),o("span",{key:T,class:"badge bg-secondary"},p(T),1))),128))])])):(s(),o("div",op,"All tools available"))]),i.value.commands&&i.value.commands.length>0?(s(),o("div",np,[$[6]||($[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",lp,[(s(!0),o(Y,null,Z(i.value.commands,T=>(s(),o("span",{key:T,class:"badge bg-info"},p(T),1))),128))])])):D("",!0),i.value.systemPrompt?(s(),o("div",ap,[$[7]||($[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",rp,p(v(i.value.systemPrompt)),1)])):D("",!0),e("div",ip,[e("h6",cp,[$[8]||($[8]=G(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:$[0]||($[0]=T=>l.value=!l.value)},p(l.value?"Hide":"Show"),1)]),l.value?(s(),o("pre",dp,p(JSON.stringify(i.value,null,2)),1)):D("",!0)])])):(s(),o("div",zm," No session configuration data available "))]),$[10]||($[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},mp=B(up,[["__scopeId","data-v-809e2099"]]),pp={class:"modal-dialog modal-dialog-centered"},vp={class:"modal-content"},fp={class:"modal-body"},gp={class:"mb-3"},_p={class:"mb-3"},hp={class:"mb-3"},bp={class:"form-text d-flex justify-content-between"},yp={key:0,class:"invalid-feedback"},$p={class:"mb-3 form-check"},wp={key:0,class:"form-text text-warning"},kp={class:"mb-3"},Sp={key:0,class:"alert alert-danger"},Cp={class:"modal-footer"},xp=["disabled"],Mp={key:0,class:"spinner-border spinner-border-sm me-2"},jp={__name:"CreateMinionModal",setup(n){const t=pe(),a=ae(),m=K(),r=se(),l=L(null);let c=null;const g=L(null),i=L({name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]}),v=L(""),u=L(""),h=L(!1),f=d(()=>v.value.trim()?v.value.split(",").map(k=>k.trim()).filter(k=>k.length>0):[]),$=d(()=>i.value.initialization_context.length),T=d(()=>$.value>2e3),b=d(()=>$.value>1800&&$.value<=2e3);function y(){i.value={name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]},v.value="",u.value="",h.value=!1}function x(){y(),r.hideModal()}async function N(){if(!i.value.name.trim()){u.value="Minion name is required";return}if(i.value.name.includes(" ")){u.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(T.value){u.value="Initialization context exceeds 2000 character limit";return}if(!g.value){u.value="Legion ID is missing";return}h.value=!0,u.value="";try{const k={name:i.value.name.trim(),role:i.value.role.trim(),initialization_context:i.value.initialization_context.trim(),override_system_prompt:i.value.override_system_prompt,capabilities:f.value},S=await J.post(`/api/legions/${g.value}/minions`,k);S.success&&S.minion_id?(await a.fetchProjects(),await m.fetchSessions(),c&&c.hide(),t.push(`/spy/${g.value}/${S.minion_id}`)):u.value="Failed to create minion"}catch(k){console.error("Failed to create minion:",k),u.value=k.response?.data?.detail||"Failed to create minion"}finally{h.value=!1}}return ee(()=>r.currentModal,k=>{if(k?.name==="create-minion"&&c){const S=k.data||{};g.value=S.project?.project_id||null,y(),c.show()}}),ne(()=>{l.value&&re(()=>import("./modal-B4rHLo2F.js").then(k=>k.m),__vite__mapDeps([0,1])).then(k=>{const S=k.default;c=new S(l.value),l.value.addEventListener("hidden.bs.modal",x)})}),ce(()=>{l.value&&l.value.removeEventListener("hidden.bs.modal",x),c&&c.dispose()}),(k,S)=>(s(),o("div",{ref_key:"modalElement",ref:l,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",pp,[e("div",vp,[S[15]||(S[15]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",fp,[e("form",{onSubmit:ie(N,["prevent"])},[e("div",gp,[S[5]||(S[5]=e("label",{for:"minion-name",class:"form-label"},[G(" Name "),e("span",{class:"text-danger"},"*")],-1)),Q(e("input",{id:"minion-name","onUpdate:modelValue":S[0]||(S[0]=U=>i.value.name=U),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[le,i.value.name]]),S[6]||(S[6]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",_p,[S[7]||(S[7]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),Q(e("input",{id:"minion-role","onUpdate:modelValue":S[1]||(S[1]=U=>i.value.role=U),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[le,i.value.role]]),S[8]||(S[8]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",hp,[S[9]||(S[9]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),Q(e("textarea",{id:"minion-context","onUpdate:modelValue":S[2]||(S[2]=U=>i.value.initialization_context=U),class:H(["form-control",{"is-invalid":T.value}]),rows:"4",maxlength:2e3,placeholder:"Instructions and context for the minion..."},null,2),[[le,i.value.initialization_context]]),e("div",bp,[e("span",null,p(i.value.override_system_prompt?"This context will replace Claude Code's preset and legion guide":"This context will be appended to legion guide and Claude Code's preset"),1),e("span",{class:H({"text-danger":T.value,"text-warning":b.value})},p($.value)+" / 2000 chars ",3)]),T.value?(s(),o("div",yp," Initialization context exceeds 2000 character limit (Windows command-line constraint) ")):D("",!0)]),e("div",$p,[Q(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":S[3]||(S[3]=U=>i.value.override_system_prompt=U)},null,512),[[be,i.value.override_system_prompt]]),S[11]||(S[11]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom context only) ",-1)),i.value.override_system_prompt?(s(),o("div",wp,[...S[10]||(S[10]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom context will be used (no legion guide or Claude Code preset).",-1)])])):D("",!0)]),e("div",kp,[S[12]||(S[12]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),Q(e("input",{id:"minion-capabilities","onUpdate:modelValue":S[4]||(S[4]=U=>v.value=U),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[le,v.value]]),S[13]||(S[13]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),u.value?(s(),o("div",Sp,p(u.value),1)):D("",!0)],32)]),e("div",Cp,[S[14]||(S[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!i.value.name.trim()||h.value,onClick:N},[h.value?(s(),o("span",Mp)):D("",!0),G(" "+p(h.value?"Creating...":"Create Minion"),1)],8,xp)])])])],512))}},Tp=B(jp,[["__scopeId","data-v-d7434e2a"]]),Ep={class:"modal-dialog modal-dialog-centered modal-lg"},Lp={class:"modal-content"},Pp={class:"modal-body"},Ip={key:0,class:"text-center text-muted py-4"},Dp={key:1},Np={class:"mb-3"},Op={class:"mb-3"},Ap={class:"font-monospace small"},Rp={class:"mb-3"},Up={class:"mb-3"},qp={class:"mb-3"},Fp={key:0},Wp={class:"d-flex flex-wrap gap-1"},Hp={key:1,class:"text-muted small"},Bp={class:"mb-3"},Vp={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto","white-space":"pre-wrap"}},zp={key:1,class:"text-muted small"},Gp={class:"mb-3"},Jp={key:0,class:"badge bg-info"},Kp={key:1,class:"badge bg-secondary"},Yp={class:"mb-3"},Qp={key:0,class:"font-monospace small"},Zp={key:1,class:"text-muted small"},Xp={key:0,class:"mb-3"},ev={key:0},tv={class:"list-unstyled mb-0"},sv={key:1,class:"text-muted small"},ov={class:"mb-3"},nv={key:0,class:"font-monospace small"},lv={key:1,class:"text-muted small"},av={class:"mb-3"},rv={key:0},iv={class:"d-flex flex-wrap gap-1"},cv={key:1,class:"text-muted small"},dv={class:"mb-3"},uv={class:"small"},mv={class:"mb-3"},pv={class:"small"},vv={__name:"MinionViewModal",setup(n){const t=se(),a=L(null),m=L(null);let r=null;function l(v){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[v]||"bg-secondary"}function c(v){if(!v)return"N/A";try{const u=new Date(v);return isNaN(u.getTime())?"Invalid date":u.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(u){return console.error("Error formatting timestamp:",u),"Invalid date"}}function g(){a.value=null}function i(){g(),t.hideModal()}return ee(()=>t.currentModal,v=>{if(v?.name==="minion-view"&&r){const u=v.data||{};a.value=u.session,r.show()}}),ne(()=>{m.value&&re(async()=>{const{default:v}=await import("./modal-B4rHLo2F.js").then(u=>u.m);return{default:v}},__vite__mapDeps([0,1])).then(({default:v})=>{r=new v(m.value),m.value.addEventListener("hidden.bs.modal",i)})}),ce(()=>{m.value&&m.value.removeEventListener("hidden.bs.modal",i),r&&r.dispose()}),(v,u)=>(s(),o("div",{class:"modal fade",id:"minionViewModal",tabindex:"-1","aria-labelledby":"minionViewModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:m},[e("div",Ep,[e("div",Lp,[u[13]||(u[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"minionViewModalLabel"},"Minion Details"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Pp,[a.value?(s(),o("div",Dp,[e("div",Np,[u[0]||(u[0]=e("h6",{class:"text-muted"},"Name",-1)),e("div",null,p(a.value.name||"Unnamed Minion"),1)]),e("div",Op,[u[1]||(u[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Ap,p(a.value.session_id),1)]),e("div",Rp,[u[2]||(u[2]=e("h6",{class:"text-muted"},"Role",-1)),e("div",null,p(a.value.role||"Not specified"),1)]),e("div",Up,[u[3]||(u[3]=e("h6",{class:"text-muted"},"Current State",-1)),e("div",null,[e("span",{class:H(["badge",l(a.value.state)])},p(a.value.state),3)])]),e("div",qp,[u[4]||(u[4]=e("h6",{class:"text-muted"},"Capabilities",-1)),a.value.capabilities&&a.value.capabilities.length>0?(s(),o("div",Fp,[e("div",Wp,[(s(!0),o(Y,null,Z(a.value.capabilities,h=>(s(),o("span",{key:h,class:"badge bg-secondary"},p(h),1))),128))])])):(s(),o("div",Hp,"None"))]),e("div",Bp,[u[5]||(u[5]=e("h6",{class:"text-muted"},"Initialization Context",-1)),a.value.initialization_context?(s(),o("div",Vp,p(a.value.initialization_context),1)):(s(),o("div",zp,"Not specified"))]),e("div",Gp,[u[6]||(u[6]=e("h6",{class:"text-muted"},"Overseer",-1)),e("div",null,[a.value.is_overseer?(s(),o("span",Jp,"Yes")):(s(),o("span",Kp,"No"))])]),e("div",Yp,[u[7]||(u[7]=e("h6",{class:"text-muted"},"Parent Overseer",-1)),a.value.parent_overseer_id?(s(),o("div",Qp,p(a.value.parent_overseer_id),1)):(s(),o("div",Zp,p(a.value.is_minion?"Root overseer (user-created)":"N/A"),1))]),a.value.is_overseer?(s(),o("div",Xp,[u[8]||(u[8]=e("h6",{class:"text-muted"},"Child Minions",-1)),a.value.child_minion_ids&&a.value.child_minion_ids.length>0?(s(),o("div",ev,[e("ul",tv,[(s(!0),o(Y,null,Z(a.value.child_minion_ids,h=>(s(),o("li",{key:h,class:"font-monospace small"},p(h),1))),128))])])):(s(),o("div",sv,"No children"))])):D("",!0),e("div",ov,[u[9]||(u[9]=e("h6",{class:"text-muted"},"Horde Membership",-1)),a.value.horde_id?(s(),o("div",nv,p(a.value.horde_id),1)):(s(),o("div",lv,"Not in a horde"))]),e("div",av,[u[10]||(u[10]=e("h6",{class:"text-muted"},"Channel Memberships",-1)),a.value.channel_ids&&a.value.channel_ids.length>0?(s(),o("div",rv,[e("div",iv,[(s(!0),o(Y,null,Z(a.value.channel_ids,h=>(s(),o("span",{key:h,class:"badge bg-info"},p(h),1))),128))])])):(s(),o("div",cv,"No channels"))]),e("div",dv,[u[11]||(u[11]=e("h6",{class:"text-muted"},"Created",-1)),e("div",uv,p(c(a.value.created_at)),1)]),e("div",mv,[u[12]||(u[12]=e("h6",{class:"text-muted"},"Last Active",-1)),e("div",pv,p(c(a.value.updated_at)),1)])])):(s(),o("div",Ip," No minion data available "))]),u[14]||(u[14]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},fv=B(vv,[["__scopeId","data-v-c44eaee2"]]),gv={class:"container-fluid vh-100 d-flex flex-column p-0"},_v={class:"d-flex flex-grow-1 overflow-hidden position-relative"},hv={class:"flex-grow-1 d-flex flex-column overflow-hidden"},bv={__name:"App",setup(n){const t=se(),a=ve(),m=K(),r=ae(),l=pe(),c=d(()=>t.sidebarCollapsed),g=d(()=>t.isMobile);ne(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),a.connectUI(),await Promise.all([r.fetchProjects(),m.fetchSessions()]);const u=window.location.hash;if(u.startsWith("#/session/")){const h=u.replace("#/session/","");m.sessions.has(h)&&await m.selectSession(h)}else if(u.startsWith("#/timeline/")){const h=u.replace("#/timeline/","");l.push(`/timeline/${h}`)}window.addEventListener("popstate",i),window.addEventListener("resize",t.handleResize)}),ce(()=>{window.removeEventListener("popstate",i),window.removeEventListener("resize",t.handleResize),a.disconnectUI()});function i(){const u=window.location.hash;if(u.startsWith("#/session/")){const h=u.replace("#/session/","");m.sessions.has(h)&&m.selectSession(h)}}function v(){t.toggleSidebar()}return(u,h)=>{const f=qe("router-view");return s(),o("div",gv,[X(kc),e("div",{id:"sidebar-backdrop",class:H({show:!c.value&&g.value}),onClick:v},null,2),e("div",_v,[X(yd),e("main",hv,[X(f)])]),X(Ad),X(su),X(Su),X(Gu),X($m),X(Wm),X(mp),X(Tp),X(fv)])}}},Le=Ve(bv);Le.use(ze());Le.use(bc);Le.mount("#app");
