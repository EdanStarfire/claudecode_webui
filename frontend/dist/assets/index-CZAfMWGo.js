const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as o,a as e,o as s,d as _e,r as D,b as u,t as f,n as me,e as H,f as G,u as we,w as se,g as Le,h as E,F as Z,i as X,j as de,k as qe,l as Y,v as ne,m as Q,p as ie,q as je,s as Se,x as re,y as ce,z as fe,A as Ue,B as Fe,C as Be,D as pe,E as be,G as Ve,H as ze}from"./vue-vendor-BChC3Sgv.js";import{m as he,p as Te}from"./markdown-vendor-CQ3OZdP9.js";import{c as Ge}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const p of a.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function l(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=l(r);fetch(r.href,a)}})();const Je={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},Ke={__name:"NoSessionSelected",setup(n){return(t,l)=>(s(),o("div",Je,[...l[0]||(l[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},Ye="modulepreload",Qe=function(n){return"/"+n},Ie={},ae=function(t,l,i){let r=Promise.resolve();if(l&&l.length>0){let d=function(v){return Promise.all(v.map(m=>Promise.resolve(m).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),g=p?.nonce||p?.getAttribute("nonce");r=d(l.map(v=>{if(v=Qe(v),v in Ie)return;Ie[v]=!0;const m=v.endsWith(".css"),h=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${h}`))return;const $=document.createElement("link");if($.rel=m?"stylesheet":Ye,m||($.as="script"),$.crossOrigin="",$.href=v,g&&$.setAttribute("nonce",g),document.head.appendChild($),m)return new Promise((S,P)=>{$.addEventListener("load",S),$.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${v}`)))})}))}function a(p){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=p,window.dispatchEvent(g),!g.defaultPrevented)throw p}return r.then(p=>{for(const g of p||[])g.status==="rejected"&&a(g.reason);return t().catch(a)})};class Ce extends Error{constructor(t,l,i){super(t),this.name="APIError",this.status=l,this.data=i}}async function ye(n,t={}){try{const l=await fetch(n,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!l.ok){let r;try{r=await l.json()}catch{r={detail:l.statusText}}throw new Ce(r.detail||`HTTP ${l.status}: ${l.statusText}`,l.status,r)}const i=l.headers.get("content-type");return i&&i.includes("application/json")?await l.json():await l.text()}catch(l){throw l instanceof Ce?l:(console.error("API request failed:",l),new Ce(`Network error: ${l.message}`,0,null))}}async function Ze(n,t={}){let l=n;if(t.params){const i=new URLSearchParams;for(const[g,d]of Object.entries(t.params))d!=null&&i.append(g,d);const r=i.toString();r&&(l=`${n}?${r}`);const{params:a,...p}=t;return ye(l,{...p,method:"GET"})}return ye(l,{...t,method:"GET"})}async function Xe(n,t,l={}){return ye(n,{...l,method:"POST",body:JSON.stringify(t)})}async function et(n,t,l={}){return ye(n,{...l,method:"PUT",body:JSON.stringify(t)})}async function tt(n,t={}){return ye(n,{...t,method:"DELETE"})}const K={get:Ze,post:Xe,put:et,delete:tt},J=_e("session",()=>{const n=D(new Map),t=D(null),l=D(new Map),i=D(new Map),r=D(new Set),a=D(!1);let p=null;const g=u(()=>n.value.get(t.value)),d=u(()=>Array.from(n.value.values()).sort((x,I)=>x.order-I.order)),v=x=>u(()=>d.value.filter(I=>I.project_id===x)),m=u({get:()=>l.value.get(t.value)||"",set:x=>{t.value&&l.value.set(t.value,x)}});async function h(){try{const x=await K.get("/api/sessions");return n.value.clear(),x.sessions.forEach(I=>{n.value.set(I.session_id,I)}),console.log(`Loaded ${n.value.size} sessions`),x.sessions}catch(x){throw console.error("Failed to fetch sessions:",x),x}}async function $(x,I){try{const j=(await K.post("/api/sessions",{project_id:x,...I})).session_id,w=(await K.get(`/api/sessions/${j}`)).session;return n.value.set(j,w),n.value=new Map(n.value),console.log(`Created session ${j}`),w}catch(W){throw console.error("Failed to create session:",W),W}}async function S(x){if(t.value===x&&!a.value)return;p&&(console.log(`Aborting pending selection to switch to ${x}`),p.abort(),p=null);const I=new AbortController;p=I,a.value=!0;try{if(t.value=x,I.signal.aborted){console.log(`Selection of ${x} aborted early`);return}let W=n.value.get(x);if(!W)try{const w=await K.get(`/api/sessions/${x}`);if(I.signal.aborted){console.log(`Selection of ${x} aborted after fetch`);return}W=w.session,n.value.set(x,W),n.value=new Map(n.value),console.log(`Fetched session ${x} for deeplink`)}catch(w){console.error(`Failed to fetch session ${x}:`,w);return}if(W&&(W.state==="created"||W.state==="terminated"))try{if(await M(x),I.signal.aborted){console.log(`Selection of ${x} aborted after start`);return}console.log(`Auto-started session ${x} (was in ${W.state} state)`);const w=6e4,L=200,O=5e3;let R=0,T=0;for(;R<w;){if(I.signal.aborted){console.log(`Selection of ${x} aborted during state wait`);return}const B=n.value.get(x);if(B&&B.state==="active"){console.log(`Session ${x} is now active after ${R}ms`);break}if(R-T>=O){const z=n.value.get(x)?.state||"unknown";console.log(`Waiting for session ${x} to become active (current: ${z}, ${R/1e3}s elapsed)`),T=R}await new Promise(z=>setTimeout(z,L)),R+=L}const A=n.value.get(x);A&&A.state!=="active"&&console.warn(`Session ${x} did not become active within ${w/1e3}s (state: ${A.state}), continuing anyway`)}catch(w){console.error(`Failed to auto-start session ${x}:`,w)}if(I.signal.aborted){console.log(`Selection of ${x} aborted before message load`);return}if(await(await ae(()=>Promise.resolve().then(()=>$t),void 0)).useMessageStore().loadMessages(x),I.signal.aborted){console.log(`Selection of ${x} aborted after message load`);return}await(await ae(()=>Promise.resolve().then(()=>Ht),void 0)).useWebSocketStore().connectSession(x),I.signal.aborted||console.log(`Selected session ${x}`)}finally{p===I&&(p=null),a.value=!1}}function P(x,I){const W=n.value.get(x);W&&(Object.assign(W,I),n.value=new Map(n.value))}async function C(x){r.value.add(x);try{await K.delete(`/api/sessions/${x}`),n.value.delete(x),l.value.delete(x),i.value.delete(x),n.value=new Map(n.value),t.value===x&&(t.value=null),console.log(`Deleted session ${x}`)}catch(I){throw console.error("Failed to delete session:",I),I}finally{r.value.delete(x)}}async function y(x,I){try{await K.put(`/api/sessions/${x}/name`,{name:I}),P(x,{name:I}),console.log(`Updated session ${x} name to "${I}"`)}catch(W){throw console.error("Failed to update session name:",W),W}}async function b(x,I){try{await K.post(`/api/sessions/${x}/permission-mode`,{mode:I}),P(x,{current_permission_mode:I});const W=i.value.get(x);W&&(W.permissionMode=I,i.value.set(x,W)),console.log(`Set permission mode for session ${x} to ${I}`)}catch(W){throw console.error("Failed to set permission mode:",W),W}}async function M(x){try{await K.post(`/api/sessions/${x}/start`),console.log(`Started session ${x}`)}catch(I){throw console.error("Failed to start session:",I),I}}async function _(x){try{await K.post(`/api/sessions/${x}/pause`),console.log(`Paused session ${x}`)}catch(I){throw console.error("Failed to pause session:",I),I}}async function c(x){try{await K.post(`/api/sessions/${x}/terminate`),console.log(`Terminated session ${x}`)}catch(I){throw console.error("Failed to terminate session:",I),I}}function N(x){return n.value.get(x)}function q(x,I){i.value.set(x,I),I.permissionMode&&P(x,{current_permission_mode:I.permissionMode})}return{sessions:n,currentSessionId:t,inputCache:l,initData:i,deletingSessions:r,currentSession:g,orderedSessions:d,sessionsInProject:v,currentInput:m,fetchSessions:h,createSession:$,selectSession:S,updateSession:P,deleteSession:C,updateSessionName:y,setPermissionMode:b,startSession:M,pauseSession:_,terminateSession:c,getSession:N,storeInitData:q}}),De=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:J},Symbol.toStringTag,{value:"Module"})),te=_e("ui",()=>{const n=D(window.innerWidth<768),t=D(300),l=D(window.innerWidth),i=u(()=>l.value<768),r=D(!0),a=D(null),p=D(null),g=u(()=>a.value?{name:a.value,data:p.value}:null),d=D(!1),v=D("Loading...");function m(){n.value=!n.value}function h(_){n.value=_}function $(_){t.value=Math.max(200,Math.min(_,window.innerWidth*.3))}function S(_){r.value=_}function P(_,c=null){a.value=null,p.value=null,setTimeout(()=>{a.value=_,p.value=c},0)}function C(){a.value=null,p.value=null}function y(_="Loading..."){d.value=!0,v.value=_}function b(){d.value=!1}function M(){const _=l.value;l.value=window.innerWidth,l.value<768&&_>=768?n.value=!0:l.value>=768&&_<768&&(n.value=!1)}return{sidebarCollapsed:n,sidebarWidth:t,isMobile:i,autoScrollEnabled:r,activeModal:a,modalData:p,currentModal:g,isLoading:d,loadingMessage:v,toggleSidebar:m,setSidebarCollapsed:h,setSidebarWidth:$,setAutoScroll:S,showModal:P,hideModal:C,showLoading:y,hideLoading:b,handleResize:M}}),le=_e("project",()=>{const n=D(new Map),t=D(null),l=u(()=>n.value.get(t.value)),i=u(()=>Array.from(n.value.values()).sort((C,y)=>C.order-y.order)),r=C=>n.value.get(C)?.is_multi_agent||!1;async function a(){try{const C=await K.get("/api/projects");return n.value.clear(),C.projects.forEach(y=>{n.value.set(y.project_id,y)}),console.log(`Loaded ${n.value.size} projects`),C.projects}catch(C){throw console.error("Failed to fetch projects:",C),C}}async function p(C,y,b=!1){try{const _=(await K.post("/api/projects",{name:C,working_directory:y,is_multi_agent:b})).project;return n.value.set(_.project_id,_),n.value=new Map(n.value),console.log(`Created project ${_.project_id}`),_}catch(M){throw console.error("Failed to create project:",M),M}}async function g(C,y){try{await K.put(`/api/projects/${C}`,y),d(C,y),console.log(`Updated project ${C}`,y)}catch(b){throw console.error("Failed to update project:",b),b}}function d(C,y){const b=n.value.get(C);b&&(Object.assign(b,y),n.value=new Map(n.value))}async function v(C){try{await K.delete(`/api/projects/${C}`),n.value.delete(C),n.value=new Map(n.value),t.value===C&&(t.value=null),console.log(`Deleted project ${C}`)}catch(y){throw console.error("Failed to delete project:",y),y}}async function m(C){try{const y=await K.put(`/api/projects/${C}/toggle-expansion`),b=n.value.get(C);return b&&(b.is_expanded=y.is_expanded,n.value=new Map(n.value)),y.is_expanded}catch(y){throw console.error("Failed to toggle expansion:",y),y}}async function h(C){try{await K.put("/api/projects/reorder",{project_ids:C}),C.forEach((y,b)=>{const M=n.value.get(y);M&&(M.order=b)}),n.value=new Map(n.value),console.log("Reordered projects",C)}catch(y){throw console.error("Failed to reorder projects:",y),y}}async function $(C,y){try{await K.put(`/api/projects/${C}/sessions/reorder`,{session_ids:y});const b=n.value.get(C);b&&(b.session_ids=y,n.value=new Map(n.value)),console.log(`Reordered sessions in project ${C}`,y)}catch(b){throw console.error("Failed to reorder sessions:",b),b}}function S(C){return n.value.get(C)}function P(C){if(!C)return"";const y=C.split(/[/\\]/).filter(b=>b);return y.length===0?"/":y.length===1?`/${y[0]}`:y.length===2?`/${y.join("/")}`:`.../${y.slice(-2).join("/")}`}return{projects:n,currentProjectId:t,currentProject:l,orderedProjects:i,isMultiAgent:r,fetchProjects:a,createProject:p,updateProject:g,updateProjectLocal:d,deleteProject:v,toggleExpansion:m,reorderProjects:h,reorderSessionsInProject:$,getProject:S,formatPath:P}}),F=(n,t)=>{const l=n.__vccOpts||n;for(const[i,r]of t)l[i]=r;return l},st={class:"session-header border-bottom p-3"},ot={class:"project-name"},nt=["title"],lt={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=le(),r=u(()=>l.sessions.get(t.sessionId)),a=u(()=>r.value?.name||t.sessionId),p=u(()=>{for(const d of i.projects.values())if(d.session_ids?.includes(t.sessionId))return d;return null}),g=u(()=>p.value?.name||"Unknown Project");return(d,v)=>(s(),o("div",st,[e("div",null,[e("div",ot,f(g.value),1),e("div",{class:"session-name",title:n.sessionId},f(a.value),9,nt)])]))}},at=F(lt,[["__scopeId","data-v-89e9c269"]]),rt={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},it=["title"],ct={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},dt={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=u(()=>l.sessions.get(t.sessionId)),r=u(()=>i.value?i.value.state==="paused"&&i.value.is_processing?"pending-prompt":i.value.is_processing?"processing":i.value.state:"unknown"),a=u(()=>{const d=r.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[d]||"#d3d3d3"}),p=u(()=>{const d=r.value;return d==="starting"||d==="processing"||d==="pending-prompt"}),g=u(()=>{if(!i.value)return"No session selected";const d=r.value,v=d.charAt(0).toUpperCase()+d.slice(1).replace("-"," "),m=i.value.name||"Unnamed Session",h=i.value.is_minion&&i.value.role?` (${i.value.role})`:"";return`${m}${h}: ${v}`});return(d,v)=>(s(),o("div",rt,[i.value?(s(),o("div",{key:0,class:H(["progress-bar",{"progress-bar-striped progress-bar-animated":p.value}]),style:me({width:"100%",backgroundColor:a.value}),title:g.value},null,14,it)):(s(),o("div",ct))]))}},ut=F(dt,[["__scopeId","data-v-e8795bb7"]]),mt={class:"session-status-bar border-top p-2 bg-light"},pt={class:"d-flex justify-content-between align-items-center gap-2"},vt={class:"d-flex gap-2"},ft=["disabled"],gt={class:"mode-label"},_t=["disabled"],bt=["disabled"],ht={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=te(),r=u(()=>l.sessions.get(t.sessionId)),a=u(()=>r.value?.current_permission_mode||"default"),p={default:"🔒",acceptEdits:"✏️",plan:"📋",bypassPermissions:"☢️"},g=u(()=>p[a.value]||"🔒"),d=u(()=>a.value),v=["default","acceptEdits","plan"],m=async()=>{if(!r.value)return;if(a.value==="bypassPermissions"){try{await l.setPermissionMode(t.sessionId,"default")}catch(b){console.error("Failed to cycle permission mode:",b)}return}const C=(v.indexOf(a.value)+1)%v.length,y=v[C];try{await l.setPermissionMode(t.sessionId,y)}catch(b){console.error("Failed to cycle permission mode:",b)}},h=()=>{i.showModal("session-info",{sessionId:t.sessionId})},$=()=>{i.showModal("manage-session",{session:r.value})},S=()=>{i.setAutoScroll(!i.autoScrollEnabled)};return(P,C)=>(s(),o("div",mt,[e("div",pt,[e("div",vt,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:m,disabled:!r.value},[G(f(g.value)+" ",1),e("span",gt,f(d.value),1)],8,ft),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:h,disabled:!r.value},[...C[0]||(C[0]=[G(" ℹ️ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,_t),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:$,disabled:!r.value},[...C[1]||(C[1]=[G(" ⚙️ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,bt)]),e("div",null,[e("button",{class:H(["btn btn-sm",we(i).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:S}," ⬇️ "+f(we(i).autoScrollEnabled?"ON":"OFF"),3)])])]))}},yt=F(ht,[["__scopeId","data-v-fdcd3535"]]),ue=_e("message",()=>{const n=D(new Map),t=D(new Map),l=D(new Map),i=D(new Map),r=D(new Map),a=D(new Map),p=D(new Map),g=u(()=>{const w=J();return n.value.get(w.currentSessionId)||[]}),d=u(()=>{const w=J();return t.value.get(w.currentSessionId)||[]});async function v(w,L=null,O=0){try{const R=L||1e4,T=await K.get(`/api/sessions/${w}/messages?limit=${R}&offset=${O}`),A=T.messages||[],B=T.total_count||A.length,z=T.has_more||!1;if(console.log(`Loaded ${A.length} of ${B} messages for session ${w}`),n.value.set(w,A),A.length>0){const U=A[A.length-1];U.timestamp&&(p.value.set(w,U.timestamp),console.log(`Tracked last received timestamp for session ${w}: ${U.timestamp}`))}const V=new Set;A.forEach(U=>{U.type==="assistant"&&U.metadata?.tool_uses&&U.metadata.tool_uses.forEach(ee=>{V.add(ee.id)}),U.type==="user"&&U.metadata?.tool_results&&U.metadata.tool_results.forEach(ee=>{V.delete(ee.tool_use_id);const $e=a.value.get(w);$e&&$e.delete(ee.tool_use_id)}),U.type==="system"&&U.metadata?.subtype==="client_launched"&&(V.forEach(ee=>{c(w,ee,"Session was restarted")}),V.clear()),U.type==="system"&&U.metadata?.subtype==="interrupt"&&(V.forEach(ee=>{c(w,ee,"Session was interrupted")}),V.clear()),U.metadata?.has_tool_uses&&U.metadata.tool_uses&&U.metadata.tool_uses.forEach(ee=>{P(w,ee)}),U.metadata?.has_tool_results&&U.metadata.tool_results&&U.metadata.tool_results.forEach(ee=>{b(w,ee)}),(U.type==="permission_request"||U.metadata?.has_permission_requests)&&C(w,U),U.type==="system"&&(U.subtype==="init"||U.metadata?.subtype==="init")&&U.metadata?.init_data&&J().storeInitData(w,U.metadata.init_data)});const ve=J().sessions.get(w);return ve&&!["active","paused","starting"].includes(ve.state)&&(V.forEach(U=>{c(w,U,"Session was terminated")}),V.clear()),r.value.set(w,V),n.value=new Map(n.value),z&&console.warn(`Warning: Only loaded ${A.length} of ${B} messages. Some messages may be missing.`),{messages:A,totalCount:B,hasMore:z}}catch(R){throw console.error("Failed to load messages:",R),R}}function m(w,L){const O=r.value.get(w)||new Set;L.type==="assistant"&&L.metadata?.tool_uses&&L.metadata.tool_uses.forEach(R=>{O.add(R.id)}),L.type==="user"&&L.metadata?.tool_results&&L.metadata.tool_results.forEach(R=>{O.delete(R.tool_use_id);const T=a.value.get(w);T&&T.delete(R.tool_use_id)}),L.type==="system"&&L.metadata?.subtype==="client_launched"&&(O.forEach(R=>{c(w,R,"Session was restarted")}),O.clear()),L.type==="system"&&L.metadata?.subtype==="interrupt"&&(O.forEach(R=>{c(w,R,"Session was interrupted")}),O.clear()),r.value.set(w,O)}function h(w,L){n.value.has(w)||n.value.set(w,[]),n.value.get(w).push(L),L.timestamp&&p.value.set(w,L.timestamp),m(w,L),n.value=new Map(n.value)}function $(w,L){t.value.has(w)||t.value.set(w,[]),t.value.get(w).push(L),t.value=new Map(t.value)}function S(w,L,O){const R=t.value.get(w);if(R){const T=R.find(A=>A.id===L);T&&(Object.assign(T,O),t.value=new Map(t.value))}}function P(w,L){const O=_(L.name,L.input);l.value.set(O,L.id);const R={id:L.id,name:L.name,input:L.input,signature:O,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return $(w,R),console.log(`Created tool call ${R.id} for ${R.name}`),R}function C(w,L){console.log("handlePermissionRequest received:",L);const O=L.metadata?.tool_name||L.tool_name,R=L.metadata?.input_params||L.input_params,T=L.metadata?.request_id||L.request_id,A=L.metadata?.suggestions||L.suggestions||[];console.log("Extracted data:",{toolName:O,inputParams:R,requestId:T,suggestions:A});const B=_(O,R),z=l.value.get(B);z?(i.value.set(T,z),S(w,z,{status:"permission_required",permissionRequestId:T,suggestions:A}),console.log(`Permission required for tool ${z}`,{suggestions:A})):console.warn("No tool use ID found for permission request signature:",B,{toolName:O,inputParams:R,availableSignatures:Array.from(l.value.keys())})}function y(w,L){const O=i.value.get(L.request_id);if(O){const R={permissionDecision:L.decision,appliedUpdates:L.applied_updates||[]};L.decision==="allow"?R.status="executing":(R.status="completed",R.result={error:!0,message:L.reasoning||"Permission denied"},R.isExpanded=!1),S(w,O,R),console.log(`Permission ${L.decision} for tool ${O}`)}}function b(w,L){const O=L.tool_use_id;S(w,O,{status:L.is_error?"error":"completed",result:{error:L.is_error,content:L.content},isExpanded:!1}),console.log(`Tool ${O} ${L.is_error?"failed":"completed"}`)}function M(w,L){const O=t.value.get(w);if(O){const R=O.find(T=>T.id===L);R&&(R.isExpanded=!R.isExpanded,t.value=new Map(t.value))}}function _(w,L){if(!w)return"unknown:{}";if(!L||typeof L!="object")return`${w}:{}`;const O=JSON.stringify(L,Object.keys(L).sort());return`${w}:${O}`}function c(w,L,O){const R=a.value.get(w)||new Map;R.set(L,{reason:"denied",message:O}),a.value.set(w,R);const T=t.value.get(w);if(T){const A=T.find(B=>B.id===L);A&&A.isExpanded&&(A.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${L} as orphaned: ${O}`)}function N(w,L){return a.value.get(w)?.has(L)||!1}function q(w,L){return a.value.get(w)?.get(L)}function x(w,L){const O=r.value.get(w);O&&O.size>0&&(O.forEach(R=>c(w,R,L)),O.clear())}function I(w){n.value.delete(w),t.value.delete(w),n.value=new Map(n.value),t.value=new Map(t.value)}function W(w){return p.value.get(w)}async function j(w){const L=p.value.get(w);if(!L)return console.log(`No sync needed for session ${w} (no previous messages)`),{syncedCount:0,hasMore:!1};try{console.log(`Syncing messages for session ${w} since ${L}`);const O=await K.get(`/api/sessions/${w}/messages?limit=1000&offset=0`),R=O.messages||[],T=O.has_more||!1,A=new Date(L).getTime(),B=R.filter(U=>U.timestamp?new Date(U.timestamp).getTime()>A:!1);if(B.length===0)return console.log(`No missed messages for session ${w}`),{syncedCount:0,hasMore:!1};console.log(`Synced ${B.length} missed messages for session ${w}`);const z=n.value.get(w)||[],V=new Set(z.map(U=>U.id).filter(Boolean)),oe=B.filter(U=>!U.id||!V.has(U.id));console.log(`After deduplication: ${oe.length} unique new messages`);const ve=[...z,...oe].sort((U,ee)=>{const $e=new Date(U.timestamp||0).getTime(),He=new Date(ee.timestamp||0).getTime();return $e-He});if(n.value.set(w,ve),oe.forEach(U=>{m(w,U),U.metadata?.has_tool_uses&&U.metadata.tool_uses&&U.metadata.tool_uses.forEach(ee=>{P(w,ee)}),U.metadata?.has_tool_results&&U.metadata.tool_results&&U.metadata.tool_results.forEach(ee=>{b(w,ee)}),(U.type==="permission_request"||U.metadata?.has_permission_requests)&&C(w,U),U.type==="system"&&(U.subtype==="init"||U.metadata?.subtype==="init")&&U.metadata?.init_data&&J().storeInitData(w,U.metadata.init_data)}),ve.length>0){const U=ve[ve.length-1];U.timestamp&&p.value.set(w,U.timestamp)}return n.value=new Map(n.value),{syncedCount:oe.length,hasMore:T}}catch(O){return console.error(`Failed to sync messages for session ${w}:`,O),{syncedCount:0,hasMore:!1,error:O.message}}}const k=J();return se(()=>Array.from(k.sessions.values()).map(L=>({id:L.session_id,state:L.state})),(w,L)=>{L&&w.forEach((O,R)=>{const T=L[R];if(!T||T.id!==O.id)return;const A=["active","paused","starting"].includes(T.state),B=!["active","paused","starting"].includes(O.state);A&&B&&x(O.id,"Session was terminated")})},{deep:!0}),{messagesBySession:n,toolCallsBySession:t,activeToolUses:Le(r),orphanedToolUses:Le(a),currentMessages:g,currentToolCalls:d,loadMessages:v,addMessage:h,addToolCall:$,updateToolCall:S,handleToolUse:P,handlePermissionRequest:C,handlePermissionResponse:y,handleToolResult:b,toggleToolExpansion:M,clearMessages:I,markToolUseOrphaned:c,isToolUseOrphaned:N,getOrphanedInfo:q,clearOrphanedToolUses:x,getLastReceivedTimestamp:W,syncMessages:j}}),$t=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:ue},Symbol.toStringTag,{value:"Module"}));function wt(n){if(!n)return new Date;if(typeof n=="string"){const t=new Date(n);return isNaN(t.getTime())?new Date:t}return typeof n=="number"?n<1e10?new Date(n*1e3):new Date(n):new Date}function ke(n){return wt(n).toLocaleTimeString()}const St={class:"card user-message bg-light border-start border-primary border-3"},kt={class:"card-body"},Ct={class:"d-flex justify-content-between align-items-center mb-2"},xt={class:"text-muted"},Mt=["innerHTML"],jt={key:0,class:"tool-results mt-3"},Tt={class:"tool-results-header text-muted small mb-2"},Et={class:"d-flex align-items-start gap-2"},Pt={class:"flex-grow-1"},Lt={class:"text-muted"},It={key:0,class:"text-danger small"},Dt={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n;he.setOptions({breaks:!0,gfm:!0});const l=u(()=>ke(t.message.timestamp)),i=u(()=>{const g=t.message.content||"",d=he.parse(g);return Te.sanitize(d)}),r=u(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),a=u(()=>t.message.metadata?.tool_results||[]);function p(g,d){return g?g.length<=d?g:g.substring(0,d)+"...":""}return(g,d)=>(s(),o("div",St,[e("div",kt,[e("div",Ct,[d[0]||(d[0]=e("div",{class:"d-flex align-items-center gap-2"},[e("span",{class:"message-icon"},"👤"),e("strong",{class:"message-role"},"User")],-1)),e("small",xt,f(l.value),1)]),e("div",{class:"message-content",innerHTML:i.value},null,8,Mt),r.value?(s(),o("div",jt,[e("div",Tt,[d[1]||(d[1]=e("i",{class:"bi bi-tools"},null,-1)),G(" Tool Results ("+f(a.value.length)+") ",1)]),(s(!0),o(Z,null,X(a.value,(v,m)=>(s(),o("div",{key:m,class:H(["tool-result-summary p-2 mb-2 rounded",v.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",Et,[e("span",null,f(v.is_error?"❌":"✅"),1),e("div",Pt,[e("small",Lt,"Tool: "+f(v.tool_use_id),1),v.is_error?(s(),o("div",It,f(p(v.content,200)),1)):E("",!0)])])],2))),128))])):E("",!0)])]))}},Ot=F(Dt,[["__scopeId","data-v-532549d1"]]),Nt={class:"thinking-block"},At={class:"text-muted ms-auto"},Rt={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},qt=["innerHTML"],Ut={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(n){const t=n,l=D(!1),i=u(()=>t.thinking?.length||0),r=u(()=>{const p=t.thinking||"",g=he.parse(p);return Te.sanitize(g)});function a(){l.value=!l.value}return(p,g)=>(s(),o("div",Nt,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:a},[e("i",{class:H(["bi",l.value?"bi-chevron-down":"bi-chevron-right"])},null,2),g[0]||(g[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),G(" Thinking ")],-1)),e("small",At,f(i.value)+" characters",1)]),l.value?(s(),o("div",Rt,[e("div",{class:"thinking-text",innerHTML:r.value},null,8,qt)])):E("",!0)]))}},Wt=F(Ut,[["__scopeId","data-v-619a8344"]]),ge=_e("websocket",()=>{const n=D(null),t=D(!1),l=D(0),i=10,r=D(null),a=D(!1),p=D(0),g=5,d=D(null);let v=null;const m=D(0),h=D(null),$=D(new Map),S=D(null),P=D(!1),C=D(0),y=5,b=D(null),M=u(()=>t.value&&(a.value||!d.value)?"connected":t.value?"partial":"disconnected");function _(T){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${T}`}function c(){if(n.value)return;const T=_("/ws/ui");console.log(`Connecting to UI WebSocket: ${T}`),n.value=new WebSocket(T),n.value.onopen=()=>{t.value=!0,l.value=0,console.log("UI WebSocket connected")},n.value.onmessage=A=>{const B=JSON.parse(A.data);k(B)},n.value.onclose=()=>{if(t.value=!1,n.value=null,console.log("UI WebSocket closed"),l.value<i){l.value++;const A=Math.min(2e3*l.value,3e4);console.log(`Reconnecting UI WebSocket in ${A}ms (attempt ${l.value})`),setTimeout(c,A)}},n.value.onerror=A=>{console.error("UI WebSocket error:",A)}}function N(){n.value&&(n.value.close(),n.value=null,t.value=!1)}async function q(T){m.value++;const A=m.value;if(console.log(`[Gen ${A}] Starting connection to session ${T}`),v&&(clearTimeout(v),v=null),await x(),m.value!==A){console.log(`[Gen ${A}] Connection cancelled (current generation: ${m.value})`);return}d.value=T,h.value=A;const B=_(`/ws/session/${T}`);console.log(`[Gen ${A}] Connecting to Session WebSocket: ${B}`),r.value=new WebSocket(B),r.value.onopen=async()=>{if(h.value!==A){console.log(`[Gen ${A}] Ignoring onopen (stale connection, current: ${h.value})`),r.value.close();return}a.value=!0,p.value=0,console.log(`[Gen ${A}] Session WebSocket connected for ${T}`);const z=$.value.get(T);if($.value.set(T,!0),z){console.log(`[Gen ${A}] Reconnection detected, syncing missed messages...`);try{const oe=await ue().syncMessages(T);oe.syncedCount>0?console.log(`[Gen ${A}] ✅ Synced ${oe.syncedCount} missed messages`):oe.error?console.warn(`[Gen ${A}] ⚠️ Message sync failed: ${oe.error}`):console.log(`[Gen ${A}] No missed messages to sync`),oe.hasMore&&console.warn(`[Gen ${A}] ⚠️ More than 1000 missed messages, showing recent 1000 only`)}catch(V){console.error(`[Gen ${A}] Error during message sync:`,V)}}else console.log(`[Gen ${A}] Initial connection, no sync needed`)},r.value.onmessage=z=>{if(h.value!==A){console.log(`[Gen ${A}] Ignoring message (stale connection, current: ${h.value})`);return}const V=JSON.parse(z.data);w(V,T)},r.value.onclose=()=>{a.value=!1,r.value=null,console.log(`[Gen ${A}] Session WebSocket closed for ${T}`);const z=J();if(z.currentSessionId===T&&h.value===A&&p.value<g){p.value++;const V=Math.min(2e3*p.value,3e4);console.log(`[Gen ${A}] Reconnecting Session WebSocket in ${V}ms (attempt ${p.value})`),v=setTimeout(()=>{h.value===A&&z.currentSessionId===T?(v=null,q(T)):console.log(`[Gen ${A}] Skipping reconnect (generation or session changed)`)},V)}},r.value.onerror=z=>{console.error(`[Gen ${A}] Session WebSocket error:`,z)}}function x(){return new Promise(T=>{if(v&&(clearTimeout(v),v=null,console.log("Cancelled pending session reconnect timer")),r.value){const A=()=>{r.value=null,a.value=!1,d.value=null,h.value=null,p.value=0,$.value.delete(sessionId),T()};if(r.value.readyState===WebSocket.CLOSED)A();else{const B=setTimeout(()=>{console.warn("Session WebSocket close timeout - forcing cleanup"),A()},2e3);r.value.addEventListener("close",()=>{clearTimeout(B),A()},{once:!0}),r.value.close()}}else d.value=null,h.value=null,T()})}function I(T){r.value&&a.value?(r.value.send(JSON.stringify({type:"send_message",content:T})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function W(T,A,B=!1,z=null){if(r.value&&a.value){const V={type:"permission_response",request_id:T,decision:A,apply_suggestions:B,timestamp:new Date().toISOString()};z&&(V.clarification_message=z),r.value.send(JSON.stringify(V)),console.log(`Sent permission ${A} for request ${T}`,{applySuggestions:B,clarification:z})}}function j(){r.value&&a.value&&(r.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function k(T){const A=J(),B=le();switch(T.type){case"sessions_list":T.sessions&&Array.isArray(T.sessions)&&T.sessions.forEach(z=>{A.updateSession(z.session_id,z)});break;case"state_change":T.data&&T.data.session_id&&T.data.session&&A.updateSession(T.data.session_id,T.data.session);break;case"project_updated":if(T.data&&T.data.project){const z=T.data.project;B.updateProjectLocal(z.project_id,z)}break;case"project_deleted":T.data&&T.data.project_id&&B.projects.delete(T.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":n.value?.readyState===WebSocket.OPEN&&n.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",T.type)}}function w(T,A){const B=J();if(B.currentSessionId!==A){console.warn(`Ignoring message for session ${A} (current: ${B.currentSessionId})`);return}const z=ue();switch(T.type){case"message":const V=T.data;if(!V||!V.type){console.warn("Received message event with invalid data:",T);break}if(V.type==="permission_request"){z.handlePermissionRequest(A,V);break}if(V.type==="permission_response"){z.handlePermissionResponse(A,V);break}V.metadata?.has_tool_uses&&V.metadata.tool_uses.forEach(oe=>{z.handleToolUse(A,oe)}),V.metadata?.has_tool_results&&V.metadata.tool_results.forEach(oe=>{z.handleToolResult(A,oe)}),V.type==="system"&&(V.subtype==="init"||V.metadata?.subtype==="init")&&V.metadata?.init_data&&B.storeInitData(A,V.metadata.init_data),z.addMessage(A,V);break;case"permission_request":z.handlePermissionRequest(A,T);break;case"permission_response":z.handlePermissionResponse(A,T);break;case"tool_result":z.handleToolResult(A,T);break;case"state_change":B.updateSession(A,T.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${A}`);break;case"ping":r.value?.readyState===WebSocket.OPEN&&r.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function L(T){O(),b.value=T;const A=_(`/ws/legion/${T}`);console.log(`Connecting to Legion WebSocket: ${A}`),S.value=new WebSocket(A),S.value.onopen=()=>{P.value=!0,C.value=0,console.log(`Legion WebSocket connected for ${T}`)},S.value.onmessage=B=>{const z=JSON.parse(B.data);R(z,T)},S.value.onclose=()=>{if(P.value=!1,S.value=null,console.log(`Legion WebSocket closed for ${T}`),b.value===T&&C.value<y){C.value++;const B=Math.min(2e3*C.value,3e4);setTimeout(()=>L(T),B)}},S.value.onerror=B=>{console.error("Legion WebSocket error:",B)}}function O(){S.value&&(S.value.close(),S.value=null,P.value=!1,b.value=null)}function R(T,A){ae(async()=>{const{useLegionStore:B}=await Promise.resolve().then(()=>mr);return{useLegionStore:B}},void 0).then(({useLegionStore:B})=>{const z=B();switch(T.type){case"comm":T.comm&&(z.addComm(A,T.comm),console.log("Legion WebSocket: Received new comm",T.comm));break;case"minion_created":T.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",T.data),ae(async()=>{const{useSessionStore:V}=await Promise.resolve().then(()=>De);return{useSessionStore:V}},void 0).then(({useSessionStore:V})=>{V().loadSessions()}));break;case"minion_updated":T.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",T.data),ae(async()=>{const{useSessionStore:V}=await Promise.resolve().then(()=>De);return{useSessionStore:V}},void 0).then(({useSessionStore:V})=>{V().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${A}`);break;case"ping":S.value?.readyState===WebSocket.OPEN&&S.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",T.type)}})}return{uiConnected:t,sessionConnected:a,legionConnected:P,overallStatus:M,connectUI:c,disconnectUI:N,connectSession:q,disconnectSession:x,sendMessage:I,sendPermissionResponse:W,interruptSession:j,connectLegion:L,disconnectLegion:O}}),Ht=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:ge},Symbol.toStringTag,{value:"Module"})),Ft={class:"base-tool-handler"},Bt={class:"tool-section mb-3"},Vt={class:"tool-parameters"},zt={class:"tool-code"},Gt={key:0,class:"tool-section"},Jt={class:"tool-section-label"},Kt={class:"tool-code"},Yt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),i=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),r=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),a=u(()=>{if(!i.value)return"";const p=t.toolCall.result;return p.content!==void 0?typeof p.content=="string"?p.content:JSON.stringify(p.content,null,2):p.message?p.message:JSON.stringify(p,null,2)});return(p,g)=>(s(),o("div",Ft,[e("div",Bt,[g[0]||(g[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Vt,[e("pre",zt,f(l.value),1)])]),i.value?(s(),o("div",Gt,[e("div",Jt,f(r.value?"Error:":"Result:"),1),e("div",{class:H(["tool-result",{"tool-result-error":r.value}])},[e("pre",Kt,f(a.value),1)],2)])):E("",!0)]))}},Qt=F(Yt,[["__scopeId","data-v-06a1b6c0"]]),Zt={class:"read-tool-handler"},Xt={class:"tool-section mb-3"},es={class:"read-file-info"},ts={class:"file-path"},ss={key:0,class:"read-range"},os={key:0,class:"tool-section"},ns={key:0,class:"tool-result tool-result-error"},ls={class:"tool-code"},as={key:1,class:"file-content-preview"},rs={class:"content-header"},is={class:"line-count-badge"},cs={key:0,class:"preview-note"},ds={class:"tool-code content-display"},us={key:0,class:"more-indicator"},xe=100,ms={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.file_path||"Unknown"),i=u(()=>{const S=t.toolCall.input?.offset,P=t.toolCall.input?.limit;return S!==void 0||P!==void 0}),r=u(()=>{const S=t.toolCall.input?.offset;return S!==void 0?S+1:1}),a=u(()=>{const S=t.toolCall.input?.offset||0,P=t.toolCall.input?.limit;return P!==void 0?S+P:"∞"}),p=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),g=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),d=u(()=>{if(!p.value)return"";const S=t.toolCall.result;return S.content!==void 0?typeof S.content=="string"?S.content:JSON.stringify(S.content,null,2):S.message?S.message:JSON.stringify(S,null,2)}),v=u(()=>g.value||!d.value?[]:d.value.split(`
`)),m=u(()=>v.value.length),h=u(()=>m.value>xe),$=u(()=>g.value?"":v.value.slice(0,xe).join(`
`));return(S,P)=>(s(),o("div",Zt,[e("div",Xt,[e("div",es,[P[0]||(P[0]=e("span",{class:"file-icon"},"📄",-1)),P[1]||(P[1]=e("strong",null,"Reading:",-1)),e("code",ts,f(l.value),1),i.value?(s(),o("span",ss,"Lines "+f(r.value)+"-"+f(a.value),1)):E("",!0)])]),p.value?(s(),o("div",os,[g.value?(s(),o("div",ns,[e("pre",ls,f(d.value),1)])):(s(),o("div",as,[e("div",rs,[P[2]||(P[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",is,f(m.value)+" lines",1),h.value?(s(),o("span",cs,"(showing first "+f(xe)+")")):E("",!0)]),e("pre",ds,f($.value),1),h.value?(s(),o("div",us,"...")):E("",!0)]))])):E("",!0)]))}},ps=F(ms,[["__scopeId","data-v-0382f812"]]),vs={class:"write-tool-handler"},fs={class:"tool-section mb-3"},gs={class:"write-file-info mb-2"},_s={class:"file-path"},bs={class:"write-content-preview"},hs={class:"content-header"},ys={class:"line-count-badge"},$s={key:0,class:"preview-note"},ws={class:"tool-code content-display"},Ss={key:0,class:"more-indicator"},ks={key:0,class:"tool-section"},Cs={key:0,class:"tool-result tool-result-error"},xs={class:"tool-code"},Ms={key:1,class:"tool-result tool-result-success"},js={class:"success-message"},Me=100,Ts={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.file_path||"Unknown"),i=u(()=>t.toolCall.input?.content||""),r=u(()=>i.value.split(`
`)),a=u(()=>r.value.length),p=u(()=>a.value>Me),g=u(()=>r.value.slice(0,Me).join(`
`)),d=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),m=u(()=>{if(!d.value)return"";const h=t.toolCall.result;return h.content!==void 0?typeof h.content=="string"?h.content:JSON.stringify(h.content,null,2):h.message?h.message:JSON.stringify(h,null,2)});return(h,$)=>(s(),o("div",vs,[e("div",fs,[e("div",gs,[$[0]||($[0]=e("span",{class:"file-icon"},"📝",-1)),$[1]||($[1]=e("strong",null,"Writing:",-1)),e("code",_s,f(l.value),1)]),e("div",bs,[e("div",hs,[$[2]||($[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",ys,f(a.value)+" lines",1),p.value?(s(),o("span",$s,"(showing first "+f(Me)+")")):E("",!0)]),e("pre",ws,f(g.value),1),p.value?(s(),o("div",Ss,"...")):E("",!0)])]),d.value?(s(),o("div",ks,[v.value?(s(),o("div",Cs,[$[3]||($[3]=e("strong",null,"Error:",-1)),e("pre",xs,f(m.value),1)])):(s(),o("div",Ms,[e("div",js,[$[4]||($[4]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"File created successfully ("+f(a.value)+" lines written)",1)])]))])):E("",!0)]))}},Es=F(Ts,[["__scopeId","data-v-d09b89ef"]]),Ps={class:"bash-tool-handler"},Ls={class:"tool-section mb-3"},Is={class:"bash-header"},Ds={class:"bash-header-content"},Os={key:0,class:"bash-description"},Ns={key:1,class:"bash-flags"},As={class:"bash-command-section"},Rs={class:"bash-command-content"},qs={key:0,class:"tool-section"},Us={key:0,class:"bash-output"},Ws={key:1,class:"bash-output-empty"},Hs={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.command||""),i=u(()=>t.toolCall.input?.description||""),r=u(()=>t.toolCall.input?.timeout),a=u(()=>t.toolCall.input?.run_in_background||!1),p=u(()=>r.value||a.value),g=u(()=>{const $=[];return r.value&&$.push(`timeout: ${r.value}ms`),a.value&&$.push("background"),$.join(", ")}),d=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),m=u(()=>v.value?"tool-result-error":"tool-result-success"),h=u(()=>{if(!d.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)});return($,S)=>(s(),o("div",Ps,[e("div",Ls,[e("div",Is,[S[1]||(S[1]=e("span",{class:"bash-icon"},"💻",-1)),e("div",Ds,[i.value?(s(),o("div",Os,[S[0]||(S[0]=e("strong",null,"Description:",-1)),G(" "+f(i.value),1)])):E("",!0),p.value?(s(),o("div",Ns,f(g.value),1)):E("",!0)])]),e("div",As,[S[2]||(S[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",Rs,f(l.value),1)])]),d.value?(s(),o("div",qs,[e("div",{class:H(["tool-result",m.value])},[S[3]||(S[3]=e("strong",null,"Output:",-1)),h.value?(s(),o("pre",Us,f(h.value),1)):(s(),o("div",Ws,"No output"))],2)])):E("",!0)]))}},Fs=F(Hs,[["__scopeId","data-v-dc93bb16"]]),Bs={class:"todo-tool-handler"},Vs={class:"tool-section mb-3"},zs={class:"todo-header"},Gs={class:"todo-summary"},Js={key:0,class:"todo-count todo-count-completed"},Ks={key:1,class:"todo-count todo-count-in-progress"},Ys={key:2,class:"todo-count todo-count-pending"},Qs={class:"todo-checklist"},Zs={class:"todo-checkbox"},Xs={class:"todo-content"},eo={key:0,class:"tool-section"},to={key:0,class:"tool-result tool-result-error"},so={class:"tool-code"},oo={key:1,class:"tool-result tool-result-success"},no={class:"success-message"},lo={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.todos||[]),i=u(()=>l.value.filter(m=>m.status==="completed").length),r=u(()=>l.value.filter(m=>m.status==="in_progress").length),a=u(()=>l.value.filter(m=>m.status==="pending").length);function p(m){return{pending:"☐",in_progress:"◐",completed:"☑"}[m]||"☐"}const g=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),d=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),v=u(()=>{if(!g.value)return"";const m=t.toolCall.result;return m.content!==void 0?typeof m.content=="string"?m.content:JSON.stringify(m.content,null,2):m.message?m.message:JSON.stringify(m,null,2)});return(m,h)=>(s(),o("div",Bs,[e("div",Vs,[e("div",zs,[h[0]||(h[0]=e("span",{class:"todo-icon"},"📋",-1)),h[1]||(h[1]=e("strong",null,"Task List:",-1)),e("div",Gs,[i.value>0?(s(),o("span",Js,f(i.value)+" completed ",1)):E("",!0),r.value>0?(s(),o("span",Ks,f(r.value)+" in progress ",1)):E("",!0),a.value>0?(s(),o("span",Ys,f(a.value)+" pending ",1)):E("",!0)])]),e("div",Qs,[(s(!0),o(Z,null,X(l.value,($,S)=>(s(),o("div",{key:S,class:H(["todo-item",`todo-${$.status}`])},[e("span",Zs,f(p($.status)),1),e("span",Xs,f($.content),1)],2))),128))])]),g.value?(s(),o("div",eo,[d.value?(s(),o("div",to,[h[2]||(h[2]=e("strong",null,"Error:",-1)),e("pre",so,f(v.value),1)])):(s(),o("div",oo,[e("div",no,[h[3]||(h[3]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"Task list updated ("+f(l.value.length)+" tasks)",1)])]))])):E("",!0)]))}},ao=F(lo,[["__scopeId","data-v-0984bcf9"]]),ro={class:"edit-tool-handler"},io={class:"tool-section mb-3"},co={class:"edit-file-info"},uo={class:"file-path"},mo={key:0,class:"replace-all-badge"},po={class:"edit-diff-container"},vo={class:"diff-header"},fo={class:"diff-stats"},go={class:"stat-removed"},_o={class:"stat-added"},bo={class:"unified-diff"},ho={class:"diff-scroll-container"},yo={class:"diff-marker"},$o={class:"diff-content"},wo={key:0,class:"tool-section"},So={key:0,class:"tool-result tool-result-error"},ko={class:"tool-code"},Co={key:1,class:"tool-result tool-result-success"},xo={class:"success-message"},Mo={key:0,class:"success-detail"},jo={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.file_path||"Unknown"),i=u(()=>t.toolCall.input?.old_string||""),r=u(()=>t.toolCall.input?.new_string||""),a=u(()=>t.toolCall.input?.replace_all||!1),p=u(()=>{const S=Ge(l.value,i.value,r.value,"","",{context:3}).split(`
`),P=[];for(let C=4;C<S.length;C++){const y=S[C];y&&(y.startsWith("-")?P.push({type:"removed",content:y.substring(1)}):y.startsWith("+")?P.push({type:"added",content:y.substring(1)}):y.startsWith(" ")?P.push({type:"context",content:y.substring(1)}):y.startsWith("@@")&&P.push({type:"hunk",content:y}))}return P}),g=u(()=>p.value.filter($=>$.type==="removed").length),d=u(()=>p.value.filter($=>$.type==="added").length),v=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),m=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),h=u(()=>{if(!v.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)});return($,S)=>(s(),o("div",ro,[e("div",io,[e("div",co,[S[0]||(S[0]=e("span",{class:"file-icon"},"✏️",-1)),S[1]||(S[1]=e("strong",null,"Editing:",-1)),e("code",uo,f(l.value),1),a.value?(s(),o("span",mo,"Replace All")):E("",!0)]),e("div",po,[e("div",vo,[S[2]||(S[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",fo,[e("span",go,"-"+f(g.value),1),e("span",_o,"+"+f(d.value),1)])]),e("div",bo,[e("div",ho,[(s(!0),o(Z,null,X(p.value,(P,C)=>(s(),o("div",{key:C,class:H(["diff-line",{"diff-line-removed":P.type==="removed","diff-line-added":P.type==="added","diff-line-context":P.type==="context","diff-line-hunk":P.type==="hunk"}])},[e("span",yo,f(P.type==="removed"?"-":P.type==="added"?"+":P.type==="hunk"?"@":" "),1),e("span",$o,f(P.content),1)],2))),128))])])])]),v.value?(s(),o("div",wo,[m.value?(s(),o("div",So,[S[3]||(S[3]=e("strong",null,"Error:",-1)),e("pre",ko,f(h.value),1)])):(s(),o("div",Co,[e("div",xo,[S[4]||(S[4]=e("span",{class:"success-icon"},"✅",-1)),S[5]||(S[5]=e("strong",null,"File edited successfully",-1)),a.value?(s(),o("span",Mo,"(all occurrences replaced)")):E("",!0)])]))])):E("",!0)]))}},To=F(jo,[["__scopeId","data-v-b06adbf2"]]),Eo={class:"search-tool-handler"},Po={class:"tool-section mb-3"},Lo={class:"search-info"},Io={class:"search-icon"},Do={class:"search-pattern"},Oo={key:0,class:"search-path"},No={key:1,class:"search-filters"},Ao={key:0,class:"filter-badge"},Ro={key:1,class:"filter-badge"},qo={key:2,class:"filter-badge"},Uo={key:0,class:"tool-section"},Wo={key:0,class:"tool-result tool-result-error"},Ho={class:"tool-code"},Fo={key:1,class:"search-results"},Bo={class:"results-header"},Vo={class:"results-label"},zo={class:"results-count-badge"},Go={class:"results-content"},Jo={class:"tool-code"},Ko={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.name==="Grep");u(()=>t.toolCall.name==="Glob");const i=u(()=>t.toolCall.input?.pattern||"Unknown"),r=u(()=>t.toolCall.input?.path||null),a=u(()=>t.toolCall.input?.type||null),p=u(()=>t.toolCall.input?.glob||null),g=u(()=>t.toolCall.input?.["-i"]||!1),d=u(()=>a.value||p.value||g.value),v=u(()=>l.value?"🔍":"📁"),m=u(()=>l.value?"Searching content":"Finding files"),h=u(()=>l.value?"Matches":"Files found"),$=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),S=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),P=u(()=>{if(!$.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)}),C=u(()=>!$.value||S.value||!P.value?0:P.value.split(`
`).filter(b=>b.trim()).length);return(y,b)=>(s(),o("div",Eo,[e("div",Po,[e("div",Lo,[e("span",Io,f(v.value),1),e("strong",null,f(m.value)+":",1),e("code",Do,f(i.value),1),r.value?(s(),o("span",Oo,"in "+f(r.value),1)):E("",!0),d.value?(s(),o("span",No,[a.value?(s(),o("span",Ao,"type: "+f(a.value),1)):E("",!0),p.value?(s(),o("span",Ro,"glob: "+f(p.value),1)):E("",!0),g.value?(s(),o("span",qo,"case-insensitive")):E("",!0)])):E("",!0)])]),$.value?(s(),o("div",Uo,[S.value?(s(),o("div",Wo,[b[0]||(b[0]=e("strong",null,"Error:",-1)),e("pre",Ho,f(P.value),1)])):(s(),o("div",Fo,[e("div",Bo,[e("span",Vo,f(h.value)+":",1),e("span",zo,f(C.value)+" "+f(C.value===1?"match":"matches"),1)]),e("div",Go,[e("pre",Jo,f(P.value),1)])]))])):E("",!0)]))}},Oe=F(Ko,[["__scopeId","data-v-dc01ae0d"]]),Yo={class:"web-tool-handler"},Qo={class:"tool-section mb-3"},Zo={class:"web-info"},Xo={class:"web-icon"},en=["href"],tn={key:1,class:"web-query"},sn={key:0,class:"web-prompt-container"},on={class:"prompt-content"},nn={key:1,class:"web-domains"},ln={class:"domains-label"},an={key:0,class:"tool-section"},rn={key:0,class:"tool-result tool-result-error"},cn={class:"tool-code"},dn={key:1,class:"web-results"},un={class:"results-header"},mn={class:"results-label"},pn={class:"results-content"},vn={class:"tool-code"},fn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.name==="WebFetch");u(()=>t.toolCall.name==="WebSearch");const i=u(()=>t.toolCall.input?.url||null),r=u(()=>t.toolCall.input?.query||null),a=u(()=>t.toolCall.input?.prompt||null),p=u(()=>t.toolCall.input?.allowed_domains||[]),g=u(()=>t.toolCall.input?.blocked_domains||[]),d=u(()=>p.value.length>0?p.value:g.value.length>0?g.value:[]),v=u(()=>p.value.length>0?"Allowed domains":g.value.length>0?"Blocked domains":"Domains"),m=u(()=>l.value?"🌐":"🔎"),h=u(()=>l.value?"Fetching URL":"Searching web"),$=u(()=>l.value?"Fetched content":"Search results"),S=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),P=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),C=u(()=>{if(!S.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)});return(y,b)=>(s(),o("div",Yo,[e("div",Qo,[e("div",Zo,[e("span",Xo,f(m.value),1),e("strong",null,f(h.value)+":",1),i.value?(s(),o("a",{key:0,href:i.value,target:"_blank",class:"web-url"},f(i.value),9,en)):r.value?(s(),o("code",tn,f(r.value),1)):E("",!0)]),a.value?(s(),o("div",sn,[b[0]||(b[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",on,f(a.value),1)])):E("",!0),d.value.length>0?(s(),o("div",nn,[e("span",ln,f(v.value)+":",1),(s(!0),o(Z,null,X(d.value,M=>(s(),o("span",{key:M,class:"domain-badge"},f(M),1))),128))])):E("",!0)]),S.value?(s(),o("div",an,[P.value?(s(),o("div",rn,[b[1]||(b[1]=e("strong",null,"Error:",-1)),e("pre",cn,f(C.value),1)])):(s(),o("div",dn,[e("div",un,[e("span",mn,f($.value)+":",1)]),e("div",pn,[e("pre",vn,f(C.value),1)])]))])):E("",!0)]))}},Ne=F(fn,[["__scopeId","data-v-49e16a90"]]),gn={class:"task-tool-handler"},_n={class:"tool-section mb-3"},bn={class:"task-header"},hn={key:0,class:"agent-type-badge"},yn={key:0,class:"task-description"},$n={class:"description-content"},wn={key:1,class:"task-prompt-container"},Sn={class:"prompt-header"},kn={class:"prompt-length"},Cn={class:"prompt-code"},xn={key:0,class:"tool-section"},Mn={key:0,class:"tool-result tool-result-error"},jn={class:"tool-code"},Tn={key:1,class:"agent-output"},En={class:"output-header"},Pn={key:0,class:"output-count-badge"},Ln={class:"output-content"},In={class:"tool-code"},Dn={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.description||null),i=u(()=>t.toolCall.input?.prompt||null),r=u(()=>t.toolCall.input?.subagent_type||null),a=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),p=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),g=u(()=>{if(!a.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)}),d=u(()=>g.value?g.value.split(`
`).length:0);return(v,m)=>(s(),o("div",gn,[e("div",_n,[e("div",bn,[m[0]||(m[0]=e("span",{class:"task-icon"},"🤖",-1)),m[1]||(m[1]=e("strong",null,"Agent Task:",-1)),r.value?(s(),o("span",hn,f(r.value),1)):E("",!0)]),l.value?(s(),o("div",yn,[m[2]||(m[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",$n,f(l.value),1)])):E("",!0),i.value?(s(),o("div",wn,[e("div",Sn,[m[3]||(m[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",kn,f(i.value.length)+" characters",1)]),e("pre",Cn,f(i.value),1)])):E("",!0)]),a.value?(s(),o("div",xn,[p.value?(s(),o("div",Mn,[m[4]||(m[4]=e("strong",null,"Error:",-1)),e("pre",jn,f(g.value),1)])):(s(),o("div",Tn,[e("div",En,[m[5]||(m[5]=e("span",{class:"output-label"},"Agent Output:",-1)),d.value>0?(s(),o("span",Pn,f(d.value)+" lines",1)):E("",!0)]),e("div",Ln,[e("pre",In,f(g.value),1)])]))])):E("",!0)]))}},On=F(Dn,[["__scopeId","data-v-513043f9"]]),Nn={class:"notebook-edit-tool-handler"},An={class:"tool-section mb-3"},Rn={class:"notebook-info"},qn={class:"file-path"},Un={class:"cell-info mt-2"},Wn={class:"info-row"},Hn={class:"info-row"},Fn={key:0,class:"info-row"},Bn={class:"badge bg-info"},Vn={key:0,class:"source-preview mt-3"},zn={class:"preview-header"},Gn={class:"preview-stats"},Jn={class:"source-code"},Kn={key:0,class:"tool-section"},Yn={key:0},Qn={key:1,class:"text-danger"},Zn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.notebook_path||"Unknown"),i=u(()=>t.toolCall.input?.cell_id),r=u(()=>t.toolCall.input?.cell_type||"code"),a=u(()=>t.toolCall.input?.edit_mode||"replace"),p=u(()=>t.toolCall.input?.new_source||""),g=u(()=>p.value.split(`
`).length),d=u(()=>r.value==="code"?"bg-primary":"bg-secondary"),v=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),m=u(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const h=a.value;return h==="insert"?"Cell inserted successfully":h==="delete"?"Cell deleted successfully":"Cell updated successfully"});return(h,$)=>(s(),o("div",Nn,[e("div",An,[e("div",Rn,[$[0]||($[0]=e("span",{class:"notebook-icon"},"📓",-1)),$[1]||($[1]=e("strong",null,"Notebook:",-1)),e("code",qn,f(l.value),1)]),e("div",Un,[e("div",Wn,[$[2]||($[2]=e("strong",null,"Cell ID:",-1)),e("code",null,f(i.value||"N/A"),1)]),e("div",Hn,[$[3]||($[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:H(["badge",d.value])},f(r.value),3)]),a.value?(s(),o("div",Fn,[$[4]||($[4]=e("strong",null,"Edit Mode:",-1)),e("span",Bn,f(a.value),1)])):E("",!0)]),p.value?(s(),o("div",Vn,[e("div",zn,[$[5]||($[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",Gn,f(g.value)+" lines",1)]),e("pre",Jn,[e("code",null,f(p.value),1)])])):E("",!0)]),n.toolCall.result?(s(),o("div",Kn,[$[8]||($[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:H(["tool-result",v.value])},[n.toolCall.result.success!==!1?(s(),o("div",Yn,[$[6]||($[6]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+f(m.value),1)])):(s(),o("div",Qn,[$[7]||($[7]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+f(n.toolCall.result.error||"Operation failed"),1)]))],2)])):E("",!0)]))}},Xn=F(Zn,[["__scopeId","data-v-3261abc1"]]),el={class:"shell-tool-handler"},tl={class:"tool-section mb-3"},sl={class:"shell-info"},ol={class:"shell-icon"},nl={key:0,class:"shell-id"},ll={key:0,class:"filter-info mt-2"},al={class:"filter-pattern"},rl={key:0,class:"tool-section"},il={class:"result-header mb-2"},cl={key:0,class:"shell-output"},dl={key:0},ul={key:1,class:"text-danger"},ml={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.name==="BashOutput"?"📤":t.toolCall.name==="KillShell"?"🛑":"🐚"),i=u(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),r=u(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),a=u(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),p=u(()=>t.toolCall.input?.filter),g=u(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),d=u(()=>t.toolCall.result?.status),v=u(()=>{const $=d.value;return $==="running"?"bg-success":$==="completed"?"bg-secondary":$==="killed"||$==="terminated"?"bg-danger":"bg-info"}),m=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),h=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return($,S)=>(s(),o("div",el,[e("div",tl,[e("div",sl,[e("span",ol,f(l.value),1),e("strong",null,f(i.value)+":",1),a.value?(s(),o("code",nl,"Shell "+f(a.value),1)):E("",!0)]),n.toolCall.name==="BashOutput"&&p.value?(s(),o("div",ll,[S[0]||(S[0]=e("strong",null,"Filter:",-1)),e("code",al,f(p.value),1)])):E("",!0)]),n.toolCall.result?(s(),o("div",rl,[e("div",il,[e("strong",null,f(r.value)+":",1),d.value?(s(),o("span",{key:0,class:H(["badge",v.value])},f(d.value),3)):E("",!0)]),g.value?(s(),o("div",cl,[e("pre",null,[e("code",null,f(g.value),1)])])):(s(),o("div",{key:1,class:H(["tool-result",m.value])},[n.toolCall.result.success!==!1?(s(),o("div",dl,[S[1]||(S[1]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+f(h.value),1)])):(s(),o("div",ul,[S[2]||(S[2]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+f(n.toolCall.result.error||"Operation failed"),1)]))],2))])):E("",!0)]))}},Ae=F(ml,[["__scopeId","data-v-fc9da4c0"]]),pl={class:"skill-tool-handler"},vl={class:"tool-section mb-3"},fl={class:"skill-info"},gl={class:"skill-name"},_l={key:0,class:"tool-section mb-3"},bl={class:"base-directory-info"},hl={class:"directory-path"},yl={key:1,class:"tool-section"},$l={class:"d-flex align-items-center gap-2"},wl={class:"text-muted small"},Sl={key:0,class:"skill-content-body"},kl={class:"skill-content-text"},Cl={key:2,class:"tool-section mt-3"},xl={class:"tool-result tool-result-error"},Ml={class:"tool-code"},jl={__name:"SkillToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=ue(),i=J(),r=D(!1);function a(){r.value=!r.value}const p=u(()=>t.toolCall.input?.command||"Unknown Skill"),g=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),d=u(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}}),v=u(()=>{const y=i.currentSessionId;if(!y)return{running:null,content:null};const b=l.messagesBySession.get(y)||[],M=b.findIndex(N=>N.type==="user"&&N.metadata?.has_tool_results&&N.metadata?.tool_results?.some(q=>q.tool_use_id===t.toolCall.id));if(M===-1)return{running:null,content:null};let _=null,c=null;for(let N=M+1;N<Math.min(M+3,b.length);N++){const q=b[N];if(q.type!=="user")continue;const x=q.content||"";x.includes("<command-message>")&&x.includes("skill is running")?_=q:x.startsWith("Base directory for this skill:")&&(c=q)}return{running:_,content:c}}),m=u(()=>{const y=v.value.content;if(!y)return null;const M=(y.content||"").match(/Base directory(?:\s+for\s+this\s+skill)?:\s*(.+?)(?:\n|$)/i);return M&&M[1]?M[1].trim():null}),h=u(()=>{const y=v.value.content;if(!y)return"";const b=y.content||"",M=/Base directory(?:\s+for\s+this\s+skill)?:.*?\n/i;return b.replace(M,"").trim()}),$=u(()=>h.value.length>0),S=u(()=>h.value?h.value.split(`
`).length:0),P=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),C=u(()=>{if(!P.value)return"";const y=t.toolCall.result;return y?.message?y.message:y?.error?y.error:"An error occurred"});return(y,b)=>(s(),o("div",pl,[e("div",vl,[e("div",fl,[b[0]||(b[0]=e("span",{class:"skill-icon"},"📋",-1)),b[1]||(b[1]=e("strong",null,"Skill:",-1)),e("code",gl,f(p.value),1),e("span",{class:H(["skill-status-badge",d.value])},f(g.value),3)])]),m.value?(s(),o("div",_l,[e("div",bl,[b[2]||(b[2]=e("span",{class:"directory-icon"},"📁",-1)),b[3]||(b[3]=e("strong",null,"Base directory:",-1)),e("code",hl,f(m.value),1)])])):E("",!0),$.value?(s(),o("div",yl,[e("div",{class:"skill-content-header",onClick:a},[e("div",$l,[e("i",{class:H(["bi",r.value?"bi-chevron-down":"bi-chevron-right"])},null,2),b[4]||(b[4]=e("strong",null,"Skill Content",-1)),e("span",wl,"("+f(S.value)+" lines)",1)])]),r.value?(s(),o("div",Sl,[e("pre",kl,f(h.value),1)])):E("",!0)])):E("",!0),P.value?(s(),o("div",Cl,[b[5]||(b[5]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",xl,[e("pre",Ml,f(C.value),1)])])):E("",!0)]))}},Tl=F(jl,[["__scopeId","data-v-a9fab5d1"]]),El={class:"slashcommand-tool-handler"},Pl={class:"tool-section mb-3"},Ll={class:"command-info"},Il={class:"command-name"},Dl={key:0,class:"tool-section mb-3"},Ol={class:"arguments-info"},Nl={class:"arguments-text"},Al={key:1,class:"tool-section"},Rl={class:"d-flex align-items-center gap-2"},ql={class:"text-muted small"},Ul={key:0,class:"command-content-body"},Wl={class:"command-content-text"},Hl={key:2,class:"tool-section mt-3"},Fl={class:"tool-result tool-result-error"},Bl={class:"tool-code"},Vl={__name:"SlashCommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=ue(),i=J(),r=D(!1);function a(){r.value=!r.value}const p=u(()=>t.toolCall.input?.command||"Unknown Command"),g=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),d=u(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}}),v=u(()=>{const y=i.currentSessionId;if(!y)return{running:null,content:null};const b=l.messagesBySession.get(y)||[],M=b.findIndex(N=>N.type==="user"&&N.metadata?.has_tool_results&&N.metadata?.tool_results?.some(q=>q.tool_use_id===t.toolCall.id));if(M===-1)return{running:null,content:null};let _=null,c=null;for(let N=M+1;N<Math.min(M+3,b.length);N++){const q=b[N];if(q.type!=="user")continue;const x=q.content||"";x.includes("<command-message>")&&x.includes("<command-name>")&&x.includes("<command-args>")?_=q:x.includes("ARGUMENTS:")&&(c=q)}return{running:_,content:c}}),m=u(()=>{const y=v.value.running;if(!y)return null;const M=(y.content||"").match(/<command-args>(.+?)<\/command-args>/s);return M&&M[1]?M[1].trim():null}),h=u(()=>{const y=v.value.content;if(!y)return"";const b=y.content||"",M=/\nARGUMENTS:.*$/s;return b.replace(M,"").replace(/<command-message>.*?<\/command-message>/s,"").replace(/<command-name>.*?<\/command-name>/s,"").replace(/<command-args>.*?<\/command-args>/s,"").trim()}),$=u(()=>h.value.length>0),S=u(()=>h.value?h.value.split(`
`).length:0),P=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),C=u(()=>{if(!P.value)return"";const y=t.toolCall.result;return y?.message?y.message:y?.error?y.error:"An error occurred"});return(y,b)=>(s(),o("div",El,[e("div",Pl,[e("div",Ll,[b[0]||(b[0]=e("span",{class:"command-icon"},"/",-1)),b[1]||(b[1]=e("strong",null,"Slash Command:",-1)),e("code",Il,f(p.value),1),e("span",{class:H(["command-status-badge",d.value])},f(g.value),3)])]),m.value?(s(),o("div",Dl,[e("div",Ol,[b[2]||(b[2]=e("span",{class:"arguments-icon"},"📌",-1)),b[3]||(b[3]=e("strong",null,"Arguments:",-1)),e("code",Nl,f(m.value),1)])])):E("",!0),$.value?(s(),o("div",Al,[e("div",{class:"command-content-header",onClick:a},[e("div",Rl,[e("i",{class:H(["bi",r.value?"bi-chevron-down":"bi-chevron-right"])},null,2),b[4]||(b[4]=e("strong",null,"Command Content",-1)),e("span",ql,"("+f(S.value)+" lines)",1)])]),r.value?(s(),o("div",Ul,[e("pre",Wl,f(h.value),1)])):E("",!0)])):E("",!0),P.value?(s(),o("div",Hl,[b[5]||(b[5]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",Fl,[e("pre",Bl,f(C.value),1)])])):E("",!0)]))}},zl=F(Vl,[["__scopeId","data-v-9be4c14e"]]),Gl={class:"exit-plan-mode-tool-handler"},Jl={class:"tool-section mb-3"},Kl={key:0,class:"plan-content mt-2"},Yl={class:"plan-text"},Ql={key:0,class:"tool-section"},Zl={key:0},Xl={key:1,class:"text-danger"},ea={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>t.toolCall.input?.plan),i=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(r,a)=>(s(),o("div",Gl,[e("div",Jl,[a[1]||(a[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"📋"),e("strong",null,"Exiting Plan Mode")],-1)),l.value?(s(),o("div",Kl,[a[0]||(a[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",Yl,f(l.value),1)])):E("",!0)]),n.toolCall.result?(s(),o("div",Ql,[a[4]||(a[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:H(["tool-result",i.value])},[n.toolCall.result.success!==!1?(s(),o("div",Zl,[...a[2]||(a[2]=[e("i",{class:"bi bi-check-circle"},null,-1),G(" Permission mode reverted to default ",-1)])])):(s(),o("div",Xl,[a[3]||(a[3]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+f(n.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):E("",!0)]))}},ta=F(ea,[["__scopeId","data-v-f1d32203"]]),sa={class:"d-flex align-items-center gap-2 flex-grow-1 min-width-0"},oa={class:"tool-status-icon"},na=["title"],la={class:"d-flex align-items-center gap-2"},aa={class:"text-muted"},ra={key:0,class:"card-body"},ia={key:0,class:"alert alert-warning mb-3"},ca={class:"d-flex align-items-center"},da={class:"mb-0 small"},ua={key:1,class:"permission-prompt mt-3"},ma={class:"alert alert-warning mb-3"},pa={class:"mb-0"},va={class:"tool-name"},fa={key:0,class:"suggestions-section mb-3"},ga={class:"alert alert-info mb-0"},_a={class:"suggestion-details p-2 bg-white rounded"},ba={class:"permission-buttons d-flex gap-2 mb-3"},ha=["disabled"],ya=["disabled"],$a=["disabled"],wa={class:"guidance-section mt-3"},Sa=["disabled"],ka=["disabled"],Ca={key:2,class:"mt-3"},xa={class:"alert alert-warning mb-0"},Ma={class:"d-flex align-items-center"},ja={class:"mb-0 small"},Ta={key:3,class:"tool-section mt-3"},Ea={class:"alert alert-danger mb-0"},Pa={key:0},La={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(n){const t=n,l=ue(),i=J(),r=ge(),a=D(!1),p=D(null),g=D(""),d=u(()=>l.isToolUseOrphaned(i.currentSessionId,t.toolCall.id)),v=u(()=>l.getOrphanedInfo(i.currentSessionId,t.toolCall.id)),m={Read:ps,Write:Es,Bash:Fs,TodoWrite:ao,Edit:To,Grep:Oe,Glob:Oe,WebFetch:Ne,WebSearch:Ne,Task:On,NotebookEdit:Xn,BashOutput:Ae,KillShell:Ae,SlashCommand:zl,Skill:Tl,ExitPlanMode:ta},h=u(()=>{const j=t.toolCall.name;return m[j]?m[j]:Qt}),$=u(()=>{const j=[];switch(t.toolCall.status){case"pending":j.push("border-secondary");break;case"permission_required":j.push("border-warning");break;case"executing":j.push("border-primary");break;case"completed":C.value||t.toolCall.permissionDecision==="deny"?j.push("border-danger"):j.push("border-success");break;case"error":j.push("border-danger");break}return j.join(" ")}),S=u(()=>{switch(t.toolCall.status){case"pending":return"🔄";case"permission_required":return"❓";case"executing":return"⚡";case"completed":return t.toolCall.permissionDecision==="deny"?"❌":C.value?"💥":"✅";case"error":return"💥";default:return"🔧"}}),P=u(()=>ke(t.toolCall.timestamp)),C=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),y=u(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function b(j){if(!j)return"";const k=j.replace(/\\/g,"/").split("/");return k[k.length-1]}function M(j,k=200){return j?j.length<=k?j:j.substring(0,k)+"...":""}function _(j){if(!j)return null;if(j.content){const k=j.content.match(/exit code (\d+)/i);if(k)return parseInt(k[1])}return j.error?1:0}function c(j,k){const w=j?j.split(`
`).length:0;return{added:k?k.split(`
`).length:0,removed:w}}const N=u(()=>{const j=t.toolCall.name,k=t.toolCall.input||{},w=t.toolCall.result,L=t.toolCall.status;switch(j){case"Bash":case"Shell":case"Command":case"SlashCommand":{const O=M(k.command,200);if(L==="completed"&&w){const R=_(w);return`Bash: ${O} (exit ${R})`}return`Bash: ${O}`}case"Edit":{const O=b(k.file_path);if(L==="completed"&&w&&!w.error){const{added:R,removed:T}=c(k.old_string,k.new_string);return R===T?`Edit: ${O} (${R} lines changed)`:`Edit: ${O} (${R} lines added, ${T} removed)`}return`Edit: ${O}`}case"Read":{const O=b(k.file_path);if(k.offset!==void 0||k.limit!==void 0){const T=(k.offset||0)+1,A=k.limit?(k.offset||0)+k.limit:"∞";return`Read: ${O} (lines ${T}-${A})`}return`Read: ${O} (full file)`}case"Write":{const O=b(k.file_path);if(L==="completed"&&w&&!w.error&&k.content){const R=k.content.split(`
`).length;return`Write: ${O} (${R} lines written)`}return`Write: ${O}`}case"Skill":{const O=k.command||"Unknown";return L==="completed"&&w?w.error?`Skill: ${O} (error)`:`Skill: ${O} (completed)`:`Skill: ${O}`}case"Task":{const O=k.subagent_type||"general",R=k.description||"Task";return L==="completed"&&w?w.error?`Task: (${O}) ${R} (error)`:`Task: (${O}) ${R} (completed)`:`Task: (${O}) ${R}`}case"TodoWrite":{if(k.todos&&Array.isArray(k.todos)){const O=k.todos.filter(A=>A.status==="completed").length,R=k.todos.length,T=k.todos.find(A=>A.status==="in_progress");return T?`Todo: Working on "${T.content}"`:`Todo: ${O}/${R} Tasks Completed`}return"Todo: Updated"}case"Grep":case"Glob":{const O=k.pattern||"",R=j==="Grep"?"Grep":"Glob";if(L==="completed"&&w&&!w.error){let T=0;return w.content&&(T=w.content.split(`
`).filter(B=>B.trim()).length),`${R}: "${O}" (${T} results)`}return`${R}: "${O}"`}case"WebFetch":case"WebSearch":{const O=k.url||k.query||"";let R="";try{O&&(R=new URL(O.startsWith("http")?O:`https://${O}`).hostname)}catch{R=O.length>50?O.substring(0,50)+"...":O}return L==="completed"&&w?w.error?`Web: ${R} (error)`:`Web: ${R} (success)`:`Web: ${R||O}`}case"NotebookEdit":{const O=b(k.notebook_path),R=k.cell_number!==void 0?k.cell_number:"?",T=k.edit_mode||"replace";return`NotebookEdit: ${O} cell #${R} (${T})`}case"ExitPlanMode":return"ExitPlanMode: Plan submitted";case"BashOutput":return`BashOutput: Read output from ${k.bash_id||"unknown"}`;case"KillShell":return`KillShell: Terminate ${k.shell_id||"unknown"}`;default:return`${j}: executed`}}),q=u(()=>{const j=t.toolCall.name,k=t.toolCall.input||{};return["Bash","Shell","Command","SlashCommand"].includes(j)?k.command||j:["Edit","Read","Write","NotebookEdit"].includes(j)&&(k.file_path||k.notebook_path)||j});function x(){const j=i.currentSessionId;j&&l.toggleToolExpansion(j,t.toolCall.id)}function I(j){return j.type==="setMode"?`Set permission mode to "${j.mode}"`:j.type==="allow"?`Allow tool: ${j.tool}`:JSON.stringify(j)}async function W(j,k,w=null){if(!a.value){a.value=!0,j==="allow"?p.value=k?"approve-apply":"approve":w?p.value="deny-guidance":p.value="deny";try{const L=i.currentSessionId;if(L){const O=k&&t.toolCall.suggestions?t.toolCall.suggestions:[];l.handlePermissionResponse(L,{request_id:t.toolCall.permissionRequestId,decision:j,reasoning:j==="allow"?"User allowed permission":"User denied permission",applied_updates:O})}await r.sendPermissionResponse(t.toolCall.permissionRequestId,j,k,w)}catch(L){console.error("Failed to send permission response:",L)}finally{a.value=!1,p.value=null}}}return(j,k)=>(s(),o("div",{class:H(["tool-call-card card mb-3",$.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:x},[e("div",sa,[e("span",oa,f(S.value),1),e("strong",{class:"tool-name",title:q.value},f(N.value),9,na)]),e("div",la,[e("small",aa,f(P.value),1),e("i",{class:H(["bi",n.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),n.toolCall.isExpanded?(s(),o("div",ra,[d.value?(s(),o("div",ia,[e("div",ca,[k[6]||(k[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[k[5]||(k[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",da,f(v.value?.message||"Session was terminated"),1)])])])):E("",!0),(s(),de(qe(h.value),{toolCall:n.toolCall},null,8,["toolCall"])),n.toolCall.status==="permission_required"&&!d.value?(s(),o("div",ua,[e("div",ma,[k[9]||(k[9]=e("p",{class:"mb-2"},[e("strong",null,"🔐 Permission Required")],-1)),e("p",pa,[k[7]||(k[7]=G("Claude wants to use the ",-1)),e("code",va,f(n.toolCall.name),1),k[8]||(k[8]=G(" tool.",-1))])]),y.value?(s(),o("div",fa,[e("div",ga,[k[10]||(k[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),G(" Suggested Permission Update ")],-1)),k[11]||(k[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",_a,[(s(!0),o(Z,null,X(n.toolCall.suggestions,(w,L)=>(s(),o("div",{key:L,class:"suggestion-item"},[e("code",null,f(I(w)),1)]))),128))]),k[12]||(k[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):E("",!0),e("div",ba,[y.value?(s(),o("button",{key:0,class:"btn btn-success",onClick:k[0]||(k[0]=w=>W("allow",!0)),disabled:a.value},[k[13]||(k[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+f(a.value&&p.value==="approve-apply"?"⏳ Submitting...":"✅ Approve & Apply"),1)],8,ha)):E("",!0),e("button",{class:H(["btn",y.value?"btn-outline-success":"btn-success"]),onClick:k[1]||(k[1]=w=>W("allow",!1)),disabled:a.value},[k[14]||(k[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+f(a.value&&p.value==="approve"?"⏳ Submitting...":y.value?"✅ Approve Only":"✅ Approve"),1)],10,ya),e("button",{class:"btn btn-danger",onClick:k[2]||(k[2]=w=>W("deny",!1)),disabled:a.value},[k[15]||(k[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),G(" "+f(a.value&&p.value==="deny"?"⏳ Submitting...":"❌ Deny"),1)],8,$a)]),e("div",wa,[k[17]||(k[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),G(" Provide Guidance (Optional) ")],-1)),k[18]||(k[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),Y(e("textarea",{"onUpdate:modelValue":k[3]||(k[3]=w=>g.value=w),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:a.value},null,8,Sa),[[ne,g.value]]),g.value.trim()?(s(),o("button",{key:0,class:"btn btn-warning btn-sm",onClick:k[4]||(k[4]=w=>W("deny",!1,g.value)),disabled:a.value},[k[16]||(k[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),G(" "+f(a.value&&p.value==="deny-guidance"?"⏳ Submitting...":"💡 Provide Guidance & Continue"),1)],8,ka)):E("",!0)])])):E("",!0),n.toolCall.status==="permission_required"&&d.value?(s(),o("div",Ca,[e("div",xa,[e("div",Ma,[k[20]||(k[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[k[19]||(k[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",ja,f(v.value?.message||"Session was terminated before permission could be granted"),1)])])])])):E("",!0),n.toolCall.permissionDecision==="deny"?(s(),o("div",Ta,[e("div",Ea,[k[21]||(k[21]=e("i",{class:"bi bi-x-circle"},null,-1)),k[22]||(k[22]=G(" Permission denied ",-1)),n.toolCall.result?.message?(s(),o("span",Pa," - "+f(n.toolCall.result.message),1)):E("",!0)])])):E("",!0)])):E("",!0)],2))}},Ia=F(La,[["__scopeId","data-v-d3ec782a"]]),Da={class:"card assistant-message bg-white border-start border-success border-3"},Oa={class:"card-body"},Na={class:"d-flex justify-content-between align-items-center mb-2"},Aa={class:"d-flex align-items-center gap-2"},Ra={key:0,class:"text-muted"},qa={class:"text-muted"},Ua={key:0,class:"thinking-block mb-3"},Wa=["innerHTML"],Ha={key:2,class:"tool-calls mt-3"},Fa={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n,l=ue(),i=J();he.setOptions({breaks:!0,gfm:!0});const r=u(()=>ke(t.message.timestamp)),a=u(()=>t.message.metadata?.model||null),p=u(()=>{const S=t.message.content||"";return S.trim().length>0&&S!=="Assistant response"}),g=u(()=>{const S=t.message.content||"",P=he.parse(S);return Te.sanitize(P)}),d=u(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),v=u(()=>t.message.metadata?.thinking_content||""),m=u(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),h=u(()=>t.message.metadata?.tool_uses||[]),$=u(()=>{const S=i.currentSessionId;if(!S)return[];const P=l.toolCallsBySession.get(S)||[];return h.value.map(C=>{const y=P.find(b=>b.id===C.id);return y||{id:C.id,name:C.name,input:C.input,status:"pending",result:null,timestamp:C.timestamp||t.message.timestamp,isExpanded:!0}})});return(S,P)=>(s(),o("div",Da,[e("div",Oa,[e("div",Na,[e("div",Aa,[P[0]||(P[0]=e("span",{class:"message-icon"},"🤖",-1)),P[1]||(P[1]=e("strong",{class:"message-role"},"Assistant",-1)),a.value?(s(),o("small",Ra,f(a.value),1)):E("",!0)]),e("small",qa,f(r.value),1)]),d.value?(s(),o("div",Ua,[Q(Wt,{thinking:v.value},null,8,["thinking"])])):E("",!0),p.value?(s(),o("div",{key:1,class:"message-content",innerHTML:g.value},null,8,Wa)):E("",!0),m.value?(s(),o("div",Ha,[(s(!0),o(Z,null,X($.value,C=>(s(),de(Ia,{key:C.id,toolCall:C},null,8,["toolCall"]))),128))])):E("",!0)])]))}},Ba=F(Fa,[["__scopeId","data-v-25a87a40"]]),Va={class:"card system-message bg-info bg-opacity-10 border-info"},za={class:"card-body py-2 px-3"},Ga={class:"d-flex align-items-center gap-2"},Ja={class:"text-muted flex-grow-1"},Ka={class:"text-muted"},Ya={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>ke(t.message.timestamp));return(i,r)=>(s(),o("div",Va,[e("div",za,[e("div",Ga,[r[0]||(r[0]=e("i",{class:"bi bi-info-circle text-info"},null,-1)),e("small",Ja,f(n.message.content),1),e("small",Ka,f(l.value),1)])])]))}},Re=F(Ya,[["__scopeId","data-v-bba7a395"]]),Qa={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(n){const t=n,l=u(()=>{switch(t.message.type){case"user":return Ot;case"assistant":return Ba;case"system":return Re;default:return Re}});return(i,r)=>(s(),o("div",{class:H(["message-item mb-3",`message-${n.message.type}`])},[(s(),de(qe(l.value),{message:n.message},null,8,["message"]))],2))}},Za=F(Qa,[["__scopeId","data-v-fbd275ac"]]),Xa={key:0,class:"text-muted text-center py-5"},er={__name:"MessageList",setup(n){const t=ue(),l=te(),i=D(null),r=u(()=>t.currentMessages.filter(d=>p(d)));u(()=>t.currentToolCalls);async function a(){l.autoScrollEnabled&&(await je(),i.value&&(i.value.scrollTop=i.value.scrollHeight))}se(()=>t.currentMessages.length,a),se(()=>t.currentToolCalls.length,a),se(()=>t.currentToolCalls.map(d=>`${d.id}-${d.status}`).join(","),a),ie(()=>{setTimeout(()=>{a()},100)});function p(d){const v=d.subtype||d.metadata?.subtype;if(d.type==="system"&&v==="init"||d.type==="result"||d.type==="permission_request"||d.type==="permission_response")return!1;if(d.type==="user"&&d.metadata?.has_tool_results){const m=d.content||"";if(m.match(/^Tool results?: \d+ results?$/i)||m.trim()==="")return!1}if(d.type==="user"){const m=d.content||"";if(m.includes("<command-message>")&&m.includes("skill is running")||m.startsWith("Base directory for this skill:"))return!1}if(d.type==="user"){const m=d.content||"";if(m.includes("<command-message>")&&m.includes("<command-name>")&&m.includes("<command-args>")||m.includes("ARGUMENTS:")&&(m.includes("<command-name>")||m.match(/\nARGUMENTS:/)))return!1}return!0}function g(d){return{type:d.type||"unknown",content:d.content||"",timestamp:d.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...d.metadata}}}return(d,v)=>(s(),o("div",{class:"messages-area flex-grow-1 overflow-auto p-3",ref_key:"messagesArea",ref:i},[r.value.length===0?(s(),o("div",Xa," No messages yet. Start a conversation! ")):E("",!0),(s(!0),o(Z,null,X(r.value,(m,h)=>(s(),de(Za,{key:`msg-${m.timestamp}-${h}`,message:g(m)},null,8,["message"]))),128))],512))}},tr=F(er,[["__scopeId","data-v-54f5badf"]]),sr={class:"border-top bg-light"},or={class:"d-flex gap-2 align-items-end px-2 py-1"},nr=["placeholder","disabled","onKeydown"],lr=["disabled"],ar={__name:"InputArea",setup(n){const t=J(),l=ge(),i=D(null),r=u({get:()=>t.currentInput,set:$=>{t.currentInput=$}}),a=u(()=>t.currentSession?.is_processing||!1),p=u(()=>l.sessionConnected),g=u(()=>t.currentSession?.state==="starting"),d=u(()=>g.value?"Session is starting...":p.value?"Type your message to Claude Code...":"Waiting for connection...");function v(){const $=i.value;if(!$)return;$.style.height="auto";const S=Math.min($.scrollHeight,parseInt(getComputedStyle($).maxHeight));$.style.height=S+"px"}function m(){r.value.trim()&&(l.sendMessage(r.value),r.value="",i.value&&(i.value.style.height="auto"))}function h(){l.interruptSession()}return($,S)=>(s(),o("div",sr,[e("div",or,[Y(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:i,"onUpdate:modelValue":S[0]||(S[0]=P=>r.value=P),class:"form-control",placeholder:d.value,disabled:g.value||!p.value,rows:"1",onInput:v,onKeydown:Se(re(m,["exact","prevent"]),["enter"])},null,40,nr),[[ne,r.value]]),a.value?(s(),o("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:h}," Stop ")):(s(),o("button",{key:1,class:"btn btn-primary",disabled:!r.value.trim()||!p.value||g.value,onClick:m}," Send ",8,lr))])]))}},rr=F(ar,[["__scopeId","data-v-a72bf16a"]]),ir={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},cr={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},dr={class:"text-secondary"},ur={class:"d-flex flex-column flex-grow-1 overflow-hidden"},We={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=te(),r=u(()=>l.currentSession),a=u(()=>i.isLoading),p=u(()=>i.loadingMessage);return ie(async()=>{if(t.sessionId!==l.currentSessionId){i.showLoading("Loading session...");try{await l.selectSession(t.sessionId)}finally{i.hideLoading()}}}),se(()=>t.sessionId,async(g,d)=>{if(g!==d&&g!==l.currentSessionId){i.showLoading("Loading session...");try{await l.selectSession(g)}finally{i.hideLoading()}}}),ce(()=>{}),(g,d)=>(s(),o("div",ir,[a.value?(s(),o("div",cr,[d[0]||(d[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",dr,f(p.value),1)])):E("",!0),r.value?(s(),de(at,{key:1,"session-id":t.sessionId},null,8,["session-id"])):E("",!0),e("div",ur,[Q(tr)]),Q(rr),r.value?(s(),de(ut,{key:2,"session-id":t.sessionId},null,8,["session-id"])):E("",!0),r.value?(s(),de(yt,{key:3,"session-id":t.sessionId},null,8,["session-id"])):E("",!0)]))}},Ee=_e("legion",()=>{const n=D(new Map),t=D(new Map),l=D(new Map),i=D(new Map),r=D(null),a=u(()=>n.value.get(r.value)||[]),p=u(()=>t.value.get(r.value)||[]),g=u(()=>l.value.get(r.value)||[]),d=u(()=>i.value.get(r.value)||[]);function v(M){r.value=M}async function m(M,_=100,c=0){try{const N=await K.get(`/api/legions/${M}/timeline?limit=${_}&offset=${c}`),q=N.comms||[],x=N.total_count||q.length,I=N.has_more||!1;return q.sort((W,j)=>new Date(W.timestamp)-new Date(j.timestamp)),console.log(`Loaded ${q.length} of ${x} comms for legion ${M}`),n.value.set(M,q),n.value=new Map(n.value),{comms:q,totalCount:x,hasMore:I}}catch(N){throw console.error("Failed to load timeline:",N),N}}function h(M,_){n.value.has(M)||n.value.set(M,[]),n.value.get(M).push(_),n.value=new Map(n.value)}async function $(M,_){try{const N=(await K.post(`/api/legions/${M}/comms`,_)).comm;return console.log(`Sent comm ${N.comm_id} to legion ${M}`),N}catch(c){throw console.error("Failed to send comm:",c),c}}async function S(M){return console.log(`Minions for legion ${M} are already available in session store`),[]}async function P(M,_){try{const N=(await K.post(`/api/legions/${M}/minions`,_)).minion;return await S(M),console.log(`Created minion ${N.minion_id} in legion ${M}`),N}catch(c){throw console.error("Failed to create minion:",c),c}}async function C(M){try{const c=(await K.get(`/api/legions/${M}/hordes`)).hordes||[];return console.log(`Loaded ${c.length} hordes for legion ${M}`),l.value.set(M,c),l.value=new Map(l.value),c}catch(_){throw console.error("Failed to load hordes:",_),_}}async function y(M){try{const c=(await K.get(`/api/legions/${M}/channels`)).channels||[];return console.log(`Loaded ${c.length} channels for legion ${M}`),i.value.set(M,c),i.value=new Map(i.value),c}catch(_){throw console.error("Failed to load channels:",_),_}}function b(M){n.value.delete(M),t.value.delete(M),l.value.delete(M),i.value.delete(M),n.value=new Map(n.value),t.value=new Map(t.value),l.value=new Map(l.value),i.value=new Map(i.value)}return{commsByLegion:n,minionsByLegion:t,hordesByLegion:l,channelsByLegion:i,currentLegionId:r,currentComms:a,currentMinions:p,currentHordes:g,currentChannels:d,setCurrentLegion:v,loadTimeline:m,addComm:h,sendComm:$,loadMinions:S,createMinion:P,loadHordes:C,loadChannels:y,clearLegionData:b}}),mr=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:Ee},Symbol.toStringTag,{value:"Module"})),pr={class:"timeline-header border-bottom p-3"},vr={class:"project-name"},fr=["title"],gr={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(n){const t=n,l=le(),i=u(()=>l.projects.get(t.legionId)),r=u(()=>i.value?.name||"Legion");return(a,p)=>(s(),o("div",pr,[e("div",null,[e("div",vr,f(r.value),1),e("div",{class:"view-name",title:n.legionId},"Timeline",8,fr)])]))}},_r=F(gr,[["__scopeId","data-v-44f386f5"]]),br={class:"timeline-status-bar border-top p-2 bg-light"},hr={class:"d-flex justify-content-end"},yr={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(n){const t=te();function l(){t.setAutoScroll(!t.autoScrollEnabled)}return(i,r)=>(s(),o("div",br,[e("div",hr,[e("button",{class:H(["btn btn-sm",we(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:l}," ⬇️ "+f(we(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},$r=F(yr,[["__scopeId","data-v-891c73db"]]),wr={class:"comm-composer border-top p-3"},Sr={class:"d-flex gap-2 mb-2"},kr={class:"flex-grow-1"},Cr=["disabled"],xr={label:"Minions"},Mr=["value"],jr={key:0,label:"Channels"},Tr=["value"],Er={style:{"min-width":"150px"}},Pr=["disabled"],Lr={class:"d-flex gap-2 align-items-end position-relative"},Ir={class:"flex-grow-1 position-relative"},Dr=["disabled"],Or=["onClick","onMouseenter"],Nr=["disabled"],Ar={key:0},Rr={key:1},qr={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(n){const t=n,l=Ee(),i=J(),r=le(),a=D(""),p=D("task"),g=D(""),d=D(!1),v=D(!1),m=D([]),h=D(0),$=D(-1),S=D(null),P=D(null),C=u(()=>{const j=r.projects.get(t.legionId);return!j||!j.session_ids?[]:j.session_ids.map(k=>i.sessions.get(k)).filter(k=>k&&k.is_minion)}),y=u(()=>l.currentChannels||[]),b=u(()=>a.value&&g.value.trim().length>0);function M(j){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[j.state]||"○"}function _(j){return j.is_minion&&j.role?`${j.name} (${j.role})`:j.name}function c(){const j=S.value;if(!j)return;j.style.height="auto";const k=Math.min(j.scrollHeight,parseInt(getComputedStyle(j).maxHeight));j.style.height=k+"px"}function N(){const j=S.value;if(!j)return;c();const k=g.value,w=j.selectionStart,L=k.substring(0,w),O=L.lastIndexOf("#");if(O===-1){v.value=!1;return}const R=L.substring(O+1).toLowerCase();if(R.includes(" ")){v.value=!1;return}const T=C.value.filter(A=>A.name.toLowerCase().includes(R)).map(A=>({type:"minion",name:A.name,role:A.role,id:A.session_id,state:A.state}));if(T.length===0){v.value=!1;return}m.value=T,h.value=0,$.value=O,v.value=!0}function q(){if(!P.value)return;const j=P.value,k=j.children[h.value];if(!k)return;const w=k.offsetTop,L=k.offsetHeight,O=j.scrollTop,R=j.clientHeight;w<O?j.scrollTop=w:w+L>O+R&&(j.scrollTop=w+L-R)}function x(j){if(!v.value){j.key==="Enter"&&!j.shiftKey&&b.value&&(j.preventDefault(),W());return}if(j.key==="ArrowDown")j.preventDefault(),h.value=(h.value+1)%m.value.length,q();else if(j.key==="ArrowUp")j.preventDefault(),h.value=h.value===0?m.value.length-1:h.value-1,q();else if(j.key==="Enter"){j.preventDefault();const k=m.value[h.value];k&&I(k)}else j.key==="Escape"&&(v.value=!1)}function I(j){const k=S.value;if(!k)return;const w=g.value,L=k.selectionStart,O=w.substring(0,$.value)+"#"+j.name+" "+w.substring(L);g.value=O;const R=$.value+j.name.length+2;setTimeout(()=>{k.setSelectionRange(R,R),k.focus()},0),v.value=!1}async function W(){if(!(!b.value||d.value)){d.value=!0;try{const[j,k]=a.value.split(":"),w={comm_type:p.value,content:g.value.trim()};j==="minion"?w.to_minion_id=k:j==="channel"&&(w.to_channel_id=k),await l.sendComm(t.legionId,w),g.value="",c()}catch(j){console.error("Failed to send comm:",j),alert(`Failed to send comm: ${j.message}`)}finally{d.value=!1}}}return se(v,j=>{if(j){const k=w=>{w.target.closest(".comm-composer")||(v.value=!1,document.removeEventListener("click",k))};setTimeout(()=>document.addEventListener("click",k),0)}}),(j,k)=>(s(),o("div",wr,[e("div",Sr,[e("div",kr,[Y(e("select",{"onUpdate:modelValue":k[0]||(k[0]=w=>a.value=w),class:"form-select form-select-sm",disabled:d.value},[k[3]||(k[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",xr,[(s(!0),o(Z,null,X(C.value,w=>(s(),o("option",{key:w.session_id,value:`minion:${w.session_id}`},f(M(w))+" "+f(_(w)),9,Mr))),128))]),y.value.length>0?(s(),o("optgroup",jr,[(s(!0),o(Z,null,X(y.value,w=>(s(),o("option",{key:w.channel_id,value:`channel:${w.channel_id}`}," #️⃣ "+f(w.name),9,Tr))),128))])):E("",!0)],8,Cr),[[fe,a.value]])]),e("div",Er,[Y(e("select",{"onUpdate:modelValue":k[1]||(k[1]=w=>p.value=w),class:"form-select form-select-sm",disabled:d.value},[...k[4]||(k[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,Pr),[[fe,p.value]])])]),e("div",Lr,[e("div",Ir,[Y(e("textarea",{ref_key:"contentTextarea",ref:S,"onUpdate:modelValue":k[2]||(k[2]=w=>g.value=w),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:d.value,onInput:N,onKeydown:x},null,40,Dr),[[ne,g.value]]),v.value?(s(),o("div",{key:0,ref_key:"autocompleteDropdown",ref:P,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(s(!0),o(Z,null,X(m.value,(w,L)=>(s(),o("div",{key:w.id,class:H(["autocomplete-item px-2 py-1",{"bg-light":L===h.value}]),onClick:O=>I(w),onMouseenter:O=>h.value=L},f(w.type==="minion"?M(w):"#️⃣")+" "+f(w.name)+f(w.role?` (${w.role})`:""),43,Or))),128))],512)):E("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!b.value||d.value,onClick:W},[d.value?(s(),o("span",Ar,[...k[5]||(k[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),G(" Sending... ",-1)])])):(s(),o("span",Rr,"Send"))],8,Nr)])])]))}},Ur=F(qr,[["__scopeId","data-v-ffa54193"]]),Wr={class:"timeline-view d-flex flex-column h-100"},Hr={key:0,class:"text-center text-muted"},Fr={key:1,class:"text-center text-danger"},Br={key:2,class:"text-center text-muted"},Vr={key:3,class:"comm-list"},zr={class:"col-auto message-speaker text-end pe-3"},Gr={class:"text-muted"},Jr={class:"col message-content-column"},Kr={class:"comm-card card"},Yr={class:"card-body p-2"},Qr={class:"d-flex justify-content-between align-items-start mb-1"},Zr={class:"ms-2"},Xr={class:"comm-content"},ei={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(n){const t=n,l=Ee(),i=le(),r=J(),a=ge(),p=te(),g=D(!0),d=D(null),v=D(null),m=u(()=>i.projects.get(t.legionId));u(()=>m.value?.name||"Legion");const h=u(()=>l.currentComms);u(()=>l.currentMinions);function $(c){return c.from_user?"You":c.from_minion_id&&r.sessions.get(c.from_minion_id)?.name||"Unknown"}function S(c){return c.to_user?"You":c.to_minion_id?r.sessions.get(c.to_minion_id)?.name||"Unknown":c.to_channel_id?`#${c.to_channel_id}`:"All"}function P(c){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[c]||"bg-secondary"}function C(c){return new Date(c).toLocaleTimeString()}async function y(){p.autoScrollEnabled&&(await je(),v.value&&(v.value.scrollTop=v.value.scrollHeight))}async function b(){g.value=!0,d.value=null;try{l.setCurrentLegion(t.legionId),await Promise.all([l.loadTimeline(t.legionId),l.loadMinions(t.legionId)]),await je(),await y(),setTimeout(()=>{y()},100)}catch(c){console.error("Failed to load timeline:",c),c.response?d.value=`${c.message} (${c.response.status})`:d.value=c.message||"Unknown error"}finally{g.value=!1}}function M(){a.connectLegion(t.legionId)}function _(){a.disconnectLegion()}return se(()=>h.value.length,()=>{y()}),ie(()=>{b(),M(),setTimeout(()=>{y()},100)}),ce(()=>{_()}),(c,N)=>(s(),o("div",Wr,[Q(_r,{"legion-id":n.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:v,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[g.value?(s(),o("div",Hr,[...N[0]||(N[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),G(" Loading timeline... ",-1)])])):d.value?(s(),o("div",Fr," Failed to load timeline: "+f(d.value),1)):h.value.length===0?(s(),o("div",Br," No messages yet. Minions will appear here once they start communicating. ")):(s(),o("div",Vr,[(s(!0),o(Z,null,X(h.value,q=>(s(),o("div",{key:q.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",zr,[e("small",Gr,f(C(q.timestamp)),1)]),e("div",Jr,[e("div",Kr,[e("div",Yr,[e("div",Qr,[e("div",null,[e("span",{class:H(["badge",P(q.comm_type)])},f(q.comm_type),3),e("strong",Zr,f($(q)),1),N[1]||(N[1]=e("span",{class:"text-muted mx-1"},"→",-1)),e("strong",null,f(S(q)),1)])]),e("div",Xr,f(q.content),1)])])])]))),128))]))],512),Q(Ur,{"legion-id":n.legionId},null,8,["legion-id"]),Q($r,{"legion-id":n.legionId},null,8,["legion-id"])]))}},ti=F(ei,[["__scopeId","data-v-d4c7422e"]]),si={class:"spy-view d-flex flex-column overflow-hidden"},oi={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(n){return(t,l)=>(s(),o("div",si,[Q(We,{"session-id":n.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},ni=F(oi,[["__scopeId","data-v-43a24eaf"]]),li={class:"horde-header border-bottom p-3"},ai={class:"project-name"},ri=["title"],ii={__name:"HordeHeader",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(n){const t=n,l=le(),i=J(),r=u(()=>l.projects.get(t.legionId)),a=u(()=>r.value?.name||"Legion"),p=u(()=>i.sessions.get(t.overseerId)),g=u(()=>p.value?.name||"Overseer");return(d,v)=>(s(),o("div",li,[e("div",null,[e("div",ai,f(a.value),1),e("div",{class:"view-name",title:n.overseerId},f(g.value)+"'s Horde",9,ri)])]))}},ci=F(ii,[["__scopeId","data-v-775da47d"]]),di={class:"horde-status-bar border-top p-2 bg-light"},ui={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(n){return(t,l)=>(s(),o("div",di,[...l[0]||(l[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},mi=F(ui,[["__scopeId","data-v-7f3c847f"]]),pi={class:"minion-card p-2 border-start border-2 mb-2"},vi={class:"d-flex align-items-center"},fi={class:"me-2"},gi={key:0,class:"me-2"},_i={key:1,class:"text-muted ms-2"},bi={key:2,class:"badge bg-secondary ms-2"},hi={class:"text-muted small ms-4"},yi={key:0,class:"minion-children"},$i={key:1,class:"text-danger small ms-4"},wi={__name:"MinionTreeNode",props:{minionId:{type:String,required:!0},level:{type:Number,default:0}},setup(n){const t=n,l=J(),i=u(()=>l.sessions.get(t.minionId)),r=u(()=>t.level*24),a=u(()=>{const v=i.value&&i.value.child_minion_ids&&i.value.child_minion_ids.length>0;return i.value&&i.value.child_minion_ids&&i.value.child_minion_ids.length>0&&console.log(`Minion ${i.value.name} has ${i.value.child_minion_ids.length} children:`,i.value.child_minion_ids),v}),p=u(()=>i.value&&i.value.is_overseer&&a.value),g={created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"},d=u(()=>g[i.value?.state]||"○");return(v,m)=>{const h=Ue("MinionTreeNode",!0);return i.value?(s(),o("div",{key:0,class:"minion-tree-node",style:me({marginLeft:`${r.value}px`})},[e("div",pi,[e("div",vi,[e("span",fi,f(d.value),1),p.value?(s(),o("span",gi,"👑")):E("",!0),e("strong",null,f(i.value.name),1),i.value.role?(s(),o("span",_i,f(i.value.role),1)):E("",!0),p.value?(s(),o("span",bi,f(i.value.child_minion_ids.length)+" "+f(i.value.child_minion_ids.length===1?"child":"children"),1)):E("",!0)]),e("div",hi," Level "+f(i.value.overseer_level||0)+" • "+f(i.value.state),1)]),a.value?(s(),o("div",yi,[(s(!0),o(Z,null,X(i.value.child_minion_ids,$=>(s(),de(h,{key:$,"minion-id":$,level:n.level+1},null,8,["minion-id","level"]))),128))])):E("",!0)],4)):t.minionId?(s(),o("div",$i," ⚠ Minion data not found for ID: "+f(t.minionId),1)):E("",!0)}}},Si=F(wi,[["__scopeId","data-v-120682eb"]]),ki={class:"horde-view d-flex flex-column h-100"},Ci={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},xi={key:0,class:"alert alert-danger"},Mi={key:1,class:"horde-tree"},ji={__name:"HordeView",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(n){const t=n,l=J(),i=le(),r=u(()=>i.projects.get(t.legionId));u(()=>r.value?.name||"Legion");const a=u(()=>l.sessions.get(t.overseerId));return(p,g)=>(s(),o("div",ki,[Q(ci,{"legion-id":n.legionId,"overseer-id":n.overseerId},null,8,["legion-id","overseer-id"]),e("div",Ci,[a.value?(s(),o("div",Mi,[Q(Si,{"minion-id":n.overseerId,level:0},null,8,["minion-id"])])):(s(),o("div",xi," Overseer not found "))]),Q(mi,{"legion-id":n.legionId,"overseer-id":n.overseerId},null,8,["legion-id","overseer-id"])]))}},Ti=F(ji,[["__scopeId","data-v-b928719b"]]),Ei=[{path:"/",name:"home",component:Ke},{path:"/session/:sessionId",name:"session",component:We,props:!0},{path:"/timeline/:legionId",name:"timeline",component:ti,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:ni,props:!0},{path:"/horde/:legionId/:overseerId",name:"horde",component:Ti,props:!0}],Pi=Fe({history:Be(),routes:Ei}),Li={__name:"ConnectionIndicator",setup(n){const t=ge(),l=u(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),i=u(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(r,a)=>(s(),o("span",{id:"connection-indicator",class:H(["badge",l.value])},f(i.value),3))}},Ii={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},Di={class:"d-flex align-items-center gap-2"},Oi={__name:"AppHeader",setup(n){const t=te();function l(){t.toggleSidebar()}return(i,r)=>(s(),o("header",Ii,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:l},[...r[0]||(r[0]=[e("span",null,"☰",-1)])]),r[1]||(r[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",Di,[Q(Li)])]))}},Ni={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},Ai={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},Ri=["title"],qi={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,l=u(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function i(g){return g.state==="paused"&&g.is_processing?"pending-prompt":g.is_processing?"processing":g.state}function r(g){const d=i(g);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[d]||"#d3d3d3"}function a(g){const d=i(g);return d==="starting"||d==="processing"||d==="pending-prompt"}function p(g){const d=i(g),v=d.charAt(0).toUpperCase()+d.slice(1),m=g.name||"Unnamed Session",h=g.is_minion&&g.role?` (${g.role})`:"";return`${m}${h}: ${v}`}return(g,d)=>(s(),o("div",Ni,[!n.sessions||n.sessions.length===0?(s(),o("div",Ai)):(s(!0),o(Z,{key:1},X(n.sessions,v=>(s(),o("div",{key:v.session_id,class:H(["progress-bar",{"progress-bar-striped progress-bar-animated":a(v)}]),style:me({width:l.value,backgroundColor:r(v),cursor:"help"}),title:p(v)},null,14,Ri))),128))]))}},Ui=F(qi,[["__scopeId","data-v-a79cfeec"]]),Wi={class:"flex-grow-1"},Hi={key:0,class:"text-muted small ms-1"},Fi={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(n){const t=n,l=pe(),i=J(),r=le(),a=te(),p=u(()=>i.currentSessionId===t.session.session_id),g=u(()=>i.deletingSessions.has(t.session.session_id)),d=u(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),v=u(()=>{const b=d.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[b]||"status-dot-grey"}),m=u(()=>{const b=d.value,M={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},_={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:M[b]||"#d3d3d3",borderColor:_[b]||"#6c757d"}});function h(){i.selectSession(t.session.session_id),l.push(`/session/${t.session.session_id}`)}function $(){a.showModal("edit-session",{session:t.session})}function S(b){b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("application/session-id",t.session.session_id),b.dataTransfer.setData("application/project-id",t.projectId),b.dataTransfer.setData("text/plain",t.session.session_id),b.target.classList.add("dragging")}function P(b){b.target.classList.remove("dragging")}function C(b){b.preventDefault(),b.dataTransfer.dropEffect="move";const M=b.currentTarget.getBoundingClientRect(),_=M.top+M.height/2;b.clientY<_?(b.currentTarget.classList.add("drop-above"),b.currentTarget.classList.remove("drop-below")):(b.currentTarget.classList.add("drop-below"),b.currentTarget.classList.remove("drop-above"))}function y(b){b.preventDefault(),b.currentTarget.classList.remove("drop-above","drop-below");const M=b.dataTransfer.getData("application/session-id")||b.dataTransfer.getData("text/plain"),_=b.dataTransfer.getData("application/project-id");if(!M||M===t.session.session_id||_!==t.projectId)return;const c=b.currentTarget.getBoundingClientRect(),N=c.top+c.height/2,q=b.clientY<N,x=r.getProject(t.projectId);if(!x||!x.session_ids)return;const I=[...x.session_ids],W=I.indexOf(t.session.session_id),j=I.indexOf(M);if(W===-1||j===-1)return;const k=[...I],[w]=k.splice(j,1);let L=q?W:W+1;j<W&&L--,k.splice(L,0,w),r.reorderSessionsInProject(t.projectId,k)}return(b,M)=>(s(),o("div",{class:H(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:p.value,"session-deleting":g.value}]),style:{cursor:"pointer"},draggable:"true",onClick:h,onDragstart:S,onDragend:P,onDragover:C,onDrop:y},[e("div",{class:H(["status-dot me-2",v.value]),style:me(m.value)},null,6),e("div",Wi,[e("span",null,f(n.session.name||n.session.session_id),1),n.session.is_minion&&n.session.role?(s(),o("span",Hi,"("+f(n.session.role)+")",1)):E("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:re($,["stop"])}," ✏️ ")],34))}},Bi=F(Fi,[["__scopeId","data-v-07ecbf94"]]),Vi={class:"d-flex align-items-center gap-2"},zi=["value"],Gi={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,l=pe(),i=J(),r=te(),a=D("");se(()=>l.currentRoute.value,C=>{!a.value&&C.name==="spy"&&C.params.minionId&&C.params.legionId===t.project.project_id&&(a.value=C.params.minionId)},{immediate:!0});const p=u(()=>a.value?t.sessions.find(C=>C.session_id===a.value):null),g=u(()=>{const C=l.currentRoute.value;return C.name==="spy"&&C.params.legionId===t.project.project_id}),d=u(()=>{if(!p.value)return"";if(p.value.state==="paused"&&p.value.is_processing)return"status-blinking";const C=p.value.is_processing?"processing":p.value.state;return C==="starting"||C==="processing"?"status-blinking":""}),v=u(()=>{if(!p.value)return{};if(p.value.state==="paused"&&p.value.is_processing)return{backgroundColor:"#ffc107"};const C=p.value.is_processing?"processing":p.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[C]||"#d3d3d3"}});function m(C){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[C.state]||"○"}function h(C){return C.is_minion&&C.role?`${C.name} (${C.role})`:C.name}function $(){a.value&&l.push(`/spy/${t.project.project_id}/${a.value}`)}function S(){a.value?l.push(`/spy/${t.project.project_id}/${a.value}`):l.push("/")}function P(){p.value&&r.showModal("minion-view",{session:p.value})}return se(()=>i.currentSessionId,C=>{if(C)t.sessions.some(y=>y.session_id===C)&&(a.value=C);else{a.value="";const y=l.currentRoute.value;y.name==="spy"&&y.params.legionId===t.project.project_id&&l.push("/")}}),(C,y)=>(s(),o("div",{class:H(["list-group-item list-group-item-action p-2",{active:g.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:me({cursor:a.value?"pointer":"default"}),onClick:$},[y[1]||(y[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🔍"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),e("div",Vi,[p.value?(s(),o("button",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:re(P,["stop"]),title:"View minion details"}," 👁️ ")):E("",!0),p.value?(s(),o("span",{key:1,class:H(["minion-state-indicator",d.value]),style:me(v.value)}," 👤 ",6)):E("",!0)])],4),Y(e("select",{"onUpdate:modelValue":y[0]||(y[0]=b=>a.value=b),class:"form-select form-select-sm",onChange:S},[y[2]||(y[2]=e("option",{value:""},"-- Select Minion --",-1)),(s(!0),o(Z,null,X(n.sessions,b=>(s(),o("option",{key:b.session_id,value:b.session_id},f(m(b))+" "+f(h(b)),9,zi))),128))],544),[[fe,a.value]])],2))}},Ji=F(Gi,[["__scopeId","data-v-579589fb"]]),Ki=["value"],Yi={__name:"HordeSelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(n){const t=n,l=pe(),i=D("");se(()=>l.currentRoute.value,v=>{!i.value&&v.name==="horde"&&v.params.overseerId&&v.params.legionId===t.project.project_id&&(i.value=v.params.overseerId)},{immediate:!0});const r=u(()=>t.sessions.filter(v=>v.is_overseer===!0)),a=u(()=>{const v=l.currentRoute.value;return v.name==="horde"&&v.params.legionId===t.project.project_id});function p(v){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[v.state]||"○"}function g(){i.value&&l.push(`/horde/${t.project.project_id}/${i.value}`)}function d(){i.value&&l.push(`/horde/${t.project.project_id}/${i.value}`)}return(v,m)=>(s(),o("div",{class:H(["list-group-item list-group-item-action p-2",{active:a.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:me({cursor:i.value?"pointer":"default"}),onClick:g},[...m[1]||(m[1]=[e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🌳"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],4),Y(e("select",{"onUpdate:modelValue":m[0]||(m[0]=h=>i.value=h),class:"form-select form-select-sm",onChange:d},[m[2]||(m[2]=e("option",{value:""},"-- Select Overseer --",-1)),(s(!0),o(Z,null,X(r.value,h=>(s(),o("option",{key:h.session_id,value:h.session_id},f(p(h))+" "+f(h.name),9,Ki))),128))],544),[[fe,i.value]])],2))}},Qi=F(Yi,[["__scopeId","data-v-ca33279d"]]),Zi=["data-project-id"],Xi=["id"],ec=["aria-expanded","aria-controls","onKeydown"],tc={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},sc={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},oc={class:"fw-semibold",style:{"flex-shrink":"0"}},nc={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},lc={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},ac=["title"],rc=["title"],ic=["id","aria-labelledby"],cc={class:"accordion-body p-0"},dc={class:"list-group list-group-flush"},uc={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(n){const t=n,l=pe(),i=le(),r=J(),a=te(),p=D(t.project.is_expanded||!1),g=u(()=>i.formatPath(t.project.working_directory)),d=u(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(c=>r.getSession(c)).filter(c=>c!=null)),v=u(()=>{const c=l.currentRoute.value;return c.name==="timeline"&&c.params.legionId===t.project.project_id});function m(c){const N=window.bootstrap;if(!N)return;const q=document.getElementById(`collapse-${t.project.project_id}`);if(!q)return;N.Collapse.getOrCreateInstance(q).toggle()}function h(){p.value||(i.toggleExpansion(t.project.project_id),p.value=!0)}function $(){if(p.value){i.toggleExpansion(t.project.project_id),p.value=!1;const c=r.currentSessionId;c&&r.getSession(c)&&t.project.session_ids?.includes(c)&&l.push("/"),i.currentProjectId===t.project.project_id&&l.push("/")}}function S(){a.showModal("edit-project",{project:t.project})}function P(){t.project.is_multi_agent?a.showModal("create-minion",{project:t.project}):a.showModal("create-session",{project:t.project})}function C(){l.push(`/timeline/${t.project.project_id}`)}function y(c){c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("application/project-id",t.project.project_id),c.dataTransfer.setData("text/plain",t.project.project_id),c.target.classList.add("dragging")}function b(c){c.target.classList.remove("dragging")}function M(c){c.preventDefault(),c.dataTransfer.dropEffect="move";const N=c.currentTarget.getBoundingClientRect(),q=N.top+N.height/2;c.clientY<q?(c.currentTarget.classList.add("drop-above"),c.currentTarget.classList.remove("drop-below")):(c.currentTarget.classList.add("drop-below"),c.currentTarget.classList.remove("drop-above"))}function _(c){c.preventDefault(),c.currentTarget.classList.remove("drop-above","drop-below");const N=c.dataTransfer.getData("application/project-id")||c.dataTransfer.getData("text/plain");if(!N||N===t.project.project_id)return;const q=c.currentTarget.getBoundingClientRect(),x=q.top+q.height/2,I=c.clientY<x,W=i.orderedProjects,j=W.findIndex(T=>T.project_id===t.project.project_id),k=W.findIndex(T=>T.project_id===N);if(j===-1||k===-1)return;const w=[...W],[L]=w.splice(k,1);let O=I?j:j+1;k<j&&O--,w.splice(O,0,L);const R=w.map(T=>T.project_id);i.reorderProjects(R)}return(c,N)=>(s(),o("div",{class:"accordion-item border rounded mb-2","data-project-id":n.project.project_id,draggable:"true",onDragstart:y,onDragend:b,onDragover:M,onDrop:_},[e("h2",{class:"accordion-header",id:`heading-${n.project.project_id}`},[e("div",{class:H(["accordion-button bg-white p-2",{collapsed:!p.value}]),role:"button",tabindex:"0","aria-expanded":p.value,"aria-controls":`collapse-${n.project.project_id}`,onClick:m,onKeydown:[Se(re(m,["prevent"]),["enter"]),Se(re(m,["prevent"]),["space"])]},[e("div",tc,[e("div",sc,[e("div",oc,[n.project.is_multi_agent?(s(),o("span",nc,"🏛")):E("",!0),G(" "+f(n.project.name),1)]),e("div",lc,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:re(S,["stop"])}," ✏️ "),e("button",{class:"btn btn-sm btn-outline-primary",title:n.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:re(P,["stop"])}," ➕ ",8,ac)])]),e("small",{class:"text-muted font-monospace",title:n.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},f(g.value),9,rc)])],42,ec)],8,Xi),Q(Ui,{project:n.project,sessions:d.value},null,8,["project","sessions"]),e("div",{id:`collapse-${n.project.project_id}`,class:H(["accordion-collapse collapse",{show:p.value}]),"aria-labelledby":`heading-${n.project.project_id}`,onShown:h,onHidden:$},[e("div",cc,[e("div",dc,[n.project.is_multi_agent?(s(),o("div",{key:0,class:H(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:v.value}]),style:{cursor:"pointer"},onClick:C},[...N[0]||(N[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"📊"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):E("",!0),n.project.is_multi_agent?(s(),o(Z,{key:1},[Q(Ji,{project:n.project,sessions:d.value},null,8,["project","sessions"]),Q(Qi,{project:n.project,sessions:d.value},null,8,["project","sessions"])],64)):(s(!0),o(Z,{key:2},X(d.value,q=>(s(),de(Bi,{key:q.session_id,session:q,"project-id":n.project.project_id},null,8,["session","project-id"]))),128))])])],42,ic)],40,Zi))}},mc=F(uc,[["__scopeId","data-v-f7cce2fb"]]),pc={class:"project-list"},vc={key:0,class:"text-muted text-center py-3"},fc={__name:"ProjectList",setup(n){const t=le(),l=u(()=>t.orderedProjects);return(i,r)=>(s(),o("div",pc,[l.value.length===0?(s(),o("div",vc,' No projects yet. Click "New" to create one. ')):E("",!0),(s(!0),o(Z,null,X(l.value,a=>(s(),de(mc,{key:a.project_id,project:a},null,8,["project"]))),128))]))}},gc={class:"flex-grow-1 overflow-auto p-3"},_c={id:"sessions-container"},bc={__name:"Sidebar",setup(n){const t=te(),l=u(()=>t.sidebarCollapsed),i=u(()=>t.isMobile),r=u(()=>{if(i.value)return{};const m=`${t.sidebarWidth}px`;return{width:m,minWidth:"200px",maxWidth:"30vw","--sidebar-width":m}});function a(){t.showModal("create-project")}const p=D(!1);function g(m){p.value=!0,document.addEventListener("mousemove",d),document.addEventListener("mouseup",v)}function d(m){p.value&&t.setSidebarWidth(m.clientX)}function v(){p.value=!1,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",v)}return(m,h)=>(s(),o("aside",{id:"sidebar",class:H(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:l.value,"mobile-open":!l.value&&i.value,"desktop-collapsed":l.value&&!i.value}]),style:me(r.value)},[e("div",gc,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[h[0]||(h[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:a}," 📁 New ")]),e("div",_c,[Q(fc)])]),e("div",{class:"sidebar-resize-handle",onMousedown:g},null,32)],6))}},hc=F(bc,[["__scopeId","data-v-d792f0f0"]]),yc={class:"modal-dialog modal-lg"},$c={class:"modal-content"},wc={class:"modal-body"},Sc={class:"mb-3"},kc={class:"input-group"},Cc=["disabled"],xc={key:0,class:"text-center py-4"},Mc={key:1,class:"alert alert-danger",role:"alert"},jc={key:2,class:"folder-list"},Tc=["onClick","onDblclick"],Ec={class:"d-flex align-items-center flex-grow-1"},Pc=["onClick"],Lc={key:1,class:"text-center text-muted py-3"},Ic={class:"modal-footer"},Dc=["disabled"],Oc={__name:"FolderBrowserModal",setup(n){const t=te(),l=D(""),i=D(""),r=D([]),a=D(!1),p=D(""),g=D(null);let d=null,v=null;const m=u(()=>{if(!l.value)return null;const _=l.value.split(/[\\/]/).filter(Boolean);return _.length<=1?null:(_.pop(),_.length>0?_.join("/"):"/")});function h(_){if(!_)return"";const c=_.split(/[\\/]/).filter(Boolean);return c.length<=2?_:".../"+c.slice(-2).join("/")}async function $(){a.value=!0,p.value="",r.value=[],i.value="";try{const _=l.value?{path:l.value}:{},c=await K.get("/api/filesystem/browse",{params:_});c.current_path&&(l.value=c.current_path),r.value=c.directories||[]}catch(_){console.error("Failed to load directory:",_),p.value=_.message||"Failed to load directory"}finally{a.value=!1}}function S(_){i.value=_.path}function P(_){l.value=_.path,i.value="",$()}function C(){m.value&&(l.value=m.value,i.value="",$())}function y(){const _=i.value||l.value;_&&v&&v(_),d&&d.hide()}function b(){$()}function M(){r.value=[],i.value="",p.value="",v=null,t.hideModal()}return se(()=>t.currentModal,_=>{if(_?.name==="folder-browser"&&d){const c=_.data||{};l.value=c.currentPath||"",v=c.onSelect||null,d.show()}}),ie(()=>{g.value&&ae(async()=>{const{default:_}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:_}},__vite__mapDeps([0,1])).then(({default:_})=>{d=new _(g.value),g.value.addEventListener("shown.bs.modal",b),g.value.addEventListener("hidden.bs.modal",M)})}),ce(()=>{g.value&&(g.value.removeEventListener("shown.bs.modal",b),g.value.removeEventListener("hidden.bs.modal",M)),d&&d.dispose()}),(_,c)=>(s(),o("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:g},[e("div",yc,[e("div",$c,[c[7]||(c[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",wc,[e("div",Sc,[c[2]||(c[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",kc,[Y(e("input",{type:"text",class:"form-control","onUpdate:modelValue":c[0]||(c[0]=N=>l.value=N),onKeyup:Se($,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[ne,l.value]]),e("button",{class:"btn btn-outline-secondary",onClick:$,disabled:a.value},[...c[1]||(c[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),G(" Refresh ",-1)])],8,Cc)])]),a.value?(s(),o("div",xc,[...c[3]||(c[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):p.value?(s(),o("div",Mc,f(p.value),1)):(s(),o("div",jc,[m.value?(s(),o("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:C,role:"button"},[...c[4]||(c[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):E("",!0),(s(!0),o(Z,null,X(r.value,N=>(s(),o("div",{key:N.path,class:H(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:N.path===i.value}]),onClick:q=>S(N),onDblclick:q=>P(N),role:"button"},[e("div",Ec,[c[5]||(c[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,f(N.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:re(q=>P(N),["stop"])}," Open ",8,Pc)],42,Tc))),128)),r.value.length===0?(s(),o("div",Lc," No subdirectories found ")):E("",!0)]))]),e("div",Ic,[c[6]||(c[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:y,disabled:!i.value},' Select "'+f(h(i.value||l.value))+'" ',9,Dc)])])])],512))}},Nc=F(Oc,[["__scopeId","data-v-667c51a9"]]),Ac={class:"modal-dialog"},Rc={class:"modal-content"},qc={class:"modal-body"},Uc={class:"mb-3"},Wc={key:0,class:"invalid-feedback"},Hc={class:"mb-3"},Fc={class:"input-group"},Bc={key:0,class:"invalid-feedback"},Vc={class:"mb-3 form-check"},zc={class:"mb-3 form-check"},Gc={class:"form-check-label",for:"createSession"},Jc={key:0,class:"mb-3 ms-4"},Kc={for:"sessionName",class:"form-label"},Yc={key:1,class:"alert alert-danger",role:"alert"},Qc={class:"modal-footer"},Zc=["disabled"],Xc={key:0,class:"spinner-border spinner-border-sm me-2"},ed={__name:"ProjectCreateModal",setup(n){const t=le(),l=J(),i=te(),r=D({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),a=D({name:"",workingDirectory:""}),p=D(!1),g=D(""),d=D(null);let v=null;function m(){i.showModal("folder-browser",{currentPath:r.value.workingDirectory||"",onSelect:y=>{r.value.workingDirectory=y,a.value.workingDirectory=""}})}function h(){a.value={};let y=!0;return r.value.name.trim()||(a.value.name="Project name is required",y=!1),r.value.workingDirectory.trim()||(a.value.workingDirectory="Working directory is required",y=!1),y}async function $(){if(h()){p.value=!0,g.value="";try{const y=await t.createProject(r.value.name,r.value.workingDirectory,r.value.isMultiAgent);r.value.createSession&&await l.createSession(y.project_id,{name:r.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),v&&v.hide(),S()}catch(y){console.error("Failed to create project:",y),g.value=y.message||"Failed to create project. Please try again."}finally{p.value=!1}}}function S(){r.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},a.value={},g.value=""}function P(){const y=document.getElementById("projectName");y&&y.focus()}function C(){S(),i.hideModal()}return se(()=>i.currentModal,y=>{y?.name==="create-project"&&v&&v.show()}),ie(()=>{d.value&&ae(async()=>{const{default:y}=await import("./modal-B4rHLo2F.js").then(b=>b.m);return{default:y}},__vite__mapDeps([0,1])).then(({default:y})=>{v=new y(d.value),d.value.addEventListener("shown.bs.modal",P),d.value.addEventListener("hidden.bs.modal",C)})}),ce(()=>{d.value&&(d.value.removeEventListener("shown.bs.modal",P),d.value.removeEventListener("hidden.bs.modal",C)),v&&v.dispose()}),(y,b)=>(s(),o("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:d},[e("div",Ac,[e("div",Rc,[b[11]||(b[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",qc,[e("form",{onSubmit:re($,["prevent"])},[e("div",Uc,[b[5]||(b[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),Y(e("input",{type:"text",class:H(["form-control",{"is-invalid":a.value.name}]),id:"projectName","onUpdate:modelValue":b[0]||(b[0]=M=>r.value.name=M),placeholder:"My Project",required:""},null,2),[[ne,r.value.name]]),a.value.name?(s(),o("div",Wc,f(a.value.name),1)):E("",!0)]),e("div",Hc,[b[6]||(b[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",Fc,[Y(e("input",{type:"text",class:H(["form-control",{"is-invalid":a.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":b[1]||(b[1]=M=>r.value.workingDirectory=M),placeholder:"/path/to/project",required:""},null,2),[[ne,r.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:m}," Browse... "),a.value.workingDirectory?(s(),o("div",Bc,f(a.value.workingDirectory),1)):E("",!0)]),b[7]||(b[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",Vc,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":b[2]||(b[2]=M=>r.value.isMultiAgent=M)},null,512),[[be,r.value.isMultiAgent]]),b[8]||(b[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," 🏛 Multi-Agent Project (Legion) ",-1)),b[9]||(b[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",zc,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":b[3]||(b[3]=M=>r.value.createSession=M)},null,512),[[be,r.value.createSession]]),e("label",Gc," Create initial "+f(r.value.isMultiAgent?"minion":"session"),1)]),r.value.createSession?(s(),o("div",Jc,[e("label",Kc," Initial "+f(r.value.isMultiAgent?"Minion":"Session")+" Name ",1),Y(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":b[4]||(b[4]=M=>r.value.sessionName=M),placeholder:"main"},null,512),[[ne,r.value.sessionName]])])):E("",!0),g.value?(s(),o("div",Yc,f(g.value),1)):E("",!0)],32)]),e("div",Qc,[b[10]||(b[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:$,disabled:p.value},[p.value?(s(),o("span",Xc)):E("",!0),G(" "+f(p.value?"Creating...":"Create Project"),1)],8,Zc)])])])],512))}},td=F(ed,[["__scopeId","data-v-adf50394"]]),sd={class:"modal-dialog"},od={class:"modal-content"},nd={class:"modal-body"},ld={class:"mb-3"},ad={key:0,class:"invalid-feedback"},rd={class:"mb-3"},id=["value"],cd={key:0,class:"alert alert-danger",role:"alert"},dd={class:"danger-zone"},ud={class:"text-muted small"},md=["disabled"],pd={key:0,class:"alert alert-warning mt-3",role:"alert"},vd={class:"mb-2"},fd={class:"d-flex gap-2"},gd=["disabled"],_d={key:0,class:"spinner-border spinner-border-sm me-2"},bd=["disabled"],hd={class:"modal-footer"},yd=["disabled"],$d={key:0,class:"spinner-border spinner-border-sm me-2"},wd={__name:"ProjectEditModal",setup(n){const t=le(),l=te(),i=D(null),r=D({name:""}),a=D({name:""}),p=D(!1),g=D(!1),d=D(""),v=D(!1),m=D(null);let h=null;const $=u(()=>i.value?.session_ids?.length||0);function S(){a.value={};let _=!0;return r.value.name.trim()||(a.value.name="Project name is required",_=!1),_}async function P(){if(!(!S()||!i.value)){p.value=!0,d.value="";try{await t.updateProject(i.value.project_id,{name:r.value.name}),h&&h.hide()}catch(_){console.error("Failed to update project:",_),d.value=_.message||"Failed to update project. Please try again."}finally{p.value=!1}}}async function C(){if(i.value){g.value=!0,d.value="";try{await t.deleteProject(i.value.project_id),h&&h.hide()}catch(_){console.error("Failed to delete project:",_),d.value=_.message||"Failed to delete project. Please try again."}finally{g.value=!1}}}function y(){r.value={name:""},a.value={},d.value="",v.value=!1}function b(){const _=document.getElementById("editProjectName");_&&(_.focus(),_.select())}function M(){y(),i.value=null,l.hideModal()}return se(()=>l.currentModal,_=>{if(_?.name==="edit-project"&&h){const c=_.data||{};i.value=c.project,i.value&&(r.value.name=i.value.name),h.show()}}),ie(()=>{m.value&&ae(async()=>{const{default:_}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:_}},__vite__mapDeps([0,1])).then(({default:_})=>{h=new _(m.value),m.value.addEventListener("shown.bs.modal",b),m.value.addEventListener("hidden.bs.modal",M)})}),ce(()=>{m.value&&(m.value.removeEventListener("shown.bs.modal",b),m.value.removeEventListener("hidden.bs.modal",M)),h&&h.dispose()}),(_,c)=>(s(),o("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:m},[e("div",sd,[e("div",od,[c[11]||(c[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",nd,[e("form",{onSubmit:re(P,["prevent"])},[e("div",ld,[c[3]||(c[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),Y(e("input",{type:"text",class:H(["form-control",{"is-invalid":a.value.name}]),id:"editProjectName","onUpdate:modelValue":c[0]||(c[0]=N=>r.value.name=N),placeholder:"My Project",required:""},null,2),[[ne,r.value.name]]),a.value.name?(s(),o("div",ad,f(a.value.name),1)):E("",!0)]),e("div",rd,[c[4]||(c[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:i.value?.working_directory,disabled:"",readonly:""},null,8,id),c[5]||(c[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),d.value?(s(),o("div",cd,f(d.value),1)):E("",!0)],32),c[9]||(c[9]=e("hr",null,null,-1)),e("div",dd,[c[7]||(c[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",ud," Deleting this project will also delete all "+f($.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:c[1]||(c[1]=N=>v.value=!0),disabled:g.value},[...c[6]||(c[6]=[e("i",{class:"bi bi-trash"},null,-1),G(" Delete Project ",-1)])],8,md)]),v.value?(s(),o("div",pd,[c[8]||(c[8]=e("strong",null,"Are you sure?",-1)),e("p",vd,' This will permanently delete the project "'+f(i.value?.name)+'" and all '+f($.value)+" session(s). ",1),e("div",fd,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:C,disabled:g.value},[g.value?(s(),o("span",_d)):E("",!0),G(" "+f(g.value?"Deleting...":"Yes, Delete Permanently"),1)],8,gd),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:c[2]||(c[2]=N=>v.value=!1),disabled:g.value}," Cancel ",8,bd)])])):E("",!0)]),e("div",hd,[c[10]||(c[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:P,disabled:p.value},[p.value?(s(),o("span",$d)):E("",!0),G(" "+f(p.value?"Saving...":"Save Changes"),1)],8,yd)])])])],512))}},Sd=F(wd,[["__scopeId","data-v-6f299f35"]]),kd={class:"modal-dialog modal-lg"},Cd={class:"modal-content"},xd={class:"modal-header"},Md={class:"modal-title",id:"createSessionModalLabel"},jd={key:0,class:"text-muted small"},Td={class:"modal-body"},Ed={class:"mb-3"},Pd={key:0,class:"invalid-feedback"},Ld={class:"mb-3"},Id={class:"mb-3"},Dd={class:"mb-3"},Od={class:"form-text d-flex justify-content-between"},Nd={key:0,class:"invalid-feedback"},Ad={class:"mb-3 form-check"},Rd={key:0,class:"form-text text-warning"},qd={class:"mb-3"},Ud={class:"mb-3 form-check"},Wd={key:0,class:"alert alert-danger",role:"alert"},Hd={class:"modal-footer"},Fd=["disabled"],Bd={key:0,class:"spinner-border spinner-border-sm me-2"},Vd={__name:"SessionCreateModal",setup(n){const t=pe();le();const l=J(),i=te(),r=D(null),a=D({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0}),p=D({name:""}),g=D(!1),d=D(""),v=D(null);let m=null;const h=u(()=>a.value.system_prompt.length),$=u(()=>h.value>6e3),S=u(()=>h.value>5500&&h.value<=6e3);function P(){p.value={};let _=!0;return a.value.name.trim()||(p.value.name="Session name is required",_=!1),$.value&&(_=!1),_}async function C(){if(!(!P()||!r.value)){g.value=!0,d.value="";try{const _=a.value.tools.split(",").map(q=>q.trim()).filter(q=>q.length>0),c={name:a.value.name,permission_mode:a.value.permission_mode,model:a.value.model,system_prompt:a.value.system_prompt.trim()||null,override_system_prompt:a.value.override_system_prompt,tools:_},N=await l.createSession(r.value.project_id,c);a.value.startImmediately&&await l.startSession(N.session_id),t.push(`/session/${N.session_id}`),m&&m.hide(),y()}catch(_){console.error("Failed to create session:",_),d.value=_.message||"Failed to create session. Please try again."}finally{g.value=!1}}}function y(){a.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0},p.value={},d.value=""}function b(){const _=document.getElementById("sessionName");_&&_.focus()}function M(){y(),r.value=null,i.hideModal()}return se(()=>i.currentModal,_=>{if(_?.name==="create-session"&&m){const c=_.data||{};r.value=c.project,m.show()}}),ie(()=>{v.value&&ae(async()=>{const{default:_}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:_}},__vite__mapDeps([0,1])).then(({default:_})=>{m=new _(v.value),v.value.addEventListener("shown.bs.modal",b),v.value.addEventListener("hidden.bs.modal",M)})}),ce(()=>{v.value&&(v.value.removeEventListener("shown.bs.modal",b),v.value.removeEventListener("hidden.bs.modal",M)),m&&m.dispose()}),(_,c)=>(s(),o("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",kd,[e("div",Cd,[e("div",xd,[e("h5",Md,[c[7]||(c[7]=G(" Create New Session ",-1)),r.value?(s(),o("span",jd,"in "+f(r.value.name),1)):E("",!0)]),c[8]||(c[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Td,[e("form",{onSubmit:re(C,["prevent"])},[e("div",Ed,[c[9]||(c[9]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),Y(e("input",{type:"text",class:H(["form-control",{"is-invalid":p.value.name}]),id:"sessionName","onUpdate:modelValue":c[0]||(c[0]=N=>a.value.name=N),placeholder:"main",required:""},null,2),[[ne,a.value.name]]),p.value.name?(s(),o("div",Pd,f(p.value.name),1)):E("",!0)]),e("div",Ld,[c[11]||(c[11]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Y(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":c[1]||(c[1]=N=>a.value.permission_mode=N)},[...c[10]||(c[10]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"⚠️ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[fe,a.value.permission_mode]]),c[12]||(c[12]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",Id,[c[14]||(c[14]=e("label",{for:"model",class:"form-label"},"Model",-1)),Y(e("select",{class:"form-select",id:"model","onUpdate:modelValue":c[2]||(c[2]=N=>a.value.model=N)},[...c[13]||(c[13]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[fe,a.value.model]])]),e("div",Dd,[c[15]||(c[15]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),Y(e("textarea",{class:H(["form-control",{"is-invalid":$.value}]),id:"systemPrompt","onUpdate:modelValue":c[3]||(c[3]=N=>a.value.system_prompt=N),rows:"3",maxlength:6e3,placeholder:"Additional instructions to append to the system prompt..."},null,2),[[ne,a.value.system_prompt]]),e("div",Od,[e("span",null,f(a.value.override_system_prompt?"These instructions will replace Claude Code's default system prompt":"These instructions will be appended to Claude Code's default system prompt"),1),e("span",{class:H({"text-danger":$.value,"text-warning":S.value})},f(h.value)+" / 6000 chars ",3)]),$.value?(s(),o("div",Nd," System prompt exceeds 6000 character limit (Windows command-line constraint) ")):E("",!0)]),e("div",Ad,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":c[4]||(c[4]=N=>a.value.override_system_prompt=N)},null,512),[[be,a.value.override_system_prompt]]),c[17]||(c[17]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom prompt only) ",-1)),a.value.override_system_prompt?(s(),o("div",Rd,[...c[16]||(c[16]=[e("small",null,"⚠️ Override mode may cause unexpected behaviors. Only custom instructions will be used (no Claude Code preset).",-1)])])):E("",!0)]),e("div",qd,[c[18]||(c[18]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),Y(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":c[5]||(c[5]=N=>a.value.tools=N),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[ne,a.value.tools]]),c[19]||(c[19]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",Ud,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":c[6]||(c[6]=N=>a.value.startImmediately=N)},null,512),[[be,a.value.startImmediately]]),c[20]||(c[20]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),d.value?(s(),o("div",Wd,f(d.value),1)):E("",!0)],32)]),e("div",Hd,[c[21]||(c[21]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:C,disabled:g.value},[g.value?(s(),o("span",Bd)):E("",!0),G(" "+f(g.value?"Creating...":"Create Session"),1)],8,Fd)])])])],512))}},zd=F(Vd,[["__scopeId","data-v-5aef47e0"]]),Gd={class:"modal-dialog"},Jd={class:"modal-content"},Kd={class:"modal-body"},Yd={class:"mb-3"},Qd={key:0,class:"invalid-feedback"},Zd={class:"mb-3"},Xd=["value"],eu={class:"mb-3"},tu={class:"form-control-plaintext"},su={class:"mb-3"},ou=["disabled"],nu={key:0,value:"bypassPermissions"},lu={class:"form-text"},au={key:0,class:"text-warning"},ru={key:1},iu={key:0,class:"mb-3"},cu={class:"card"},du={class:"card-body"},uu={key:0,class:"mb-2"},mu={key:1,class:"mb-2"},pu={key:2,class:"mt-2"},vu={class:"form-control",style:{height:"auto","min-height":"60px","white-space":"pre-wrap"},readonly:""},fu={key:1,class:"alert alert-danger",role:"alert"},gu={class:"modal-footer"},_u=["disabled"],bu={key:0,class:"spinner-border spinner-border-sm me-2"},hu={__name:"SessionEditModal",setup(n){const t=J(),l=te(),i=D(null),r=D({name:"",permission_mode:"default"}),a=D({name:""}),p=D(!1),g=D(""),d=D(null);let v=null;const m=u(()=>i.value?.state==="active"||i.value?.state==="starting"),h=u(()=>i.value?.initial_permission_mode==="bypassPermissions");function $(M){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[M]||"bg-secondary"}function S(){a.value={};let M=!0;return r.value.name.trim()||(a.value.name="Session name is required",M=!1),M}async function P(){if(!(!S()||!i.value)){p.value=!0,g.value="";try{await t.updateSessionName(i.value.session_id,r.value.name),r.value.permission_mode!==i.value.current_permission_mode&&await t.setPermissionMode(i.value.session_id,r.value.permission_mode),v&&v.hide()}catch(M){console.error("Failed to update session:",M),g.value=M.message||"Failed to update session. Please try again."}finally{p.value=!1}}}function C(){r.value={name:"",permission_mode:"default"},a.value={},g.value=""}function y(){const M=document.getElementById("editSessionName");M&&(M.focus(),M.select())}function b(){C(),i.value=null,l.hideModal()}return se(()=>l.currentModal,M=>{if(M?.name==="edit-session"&&v){const _=M.data||{};i.value=_.session,i.value&&(r.value.name=i.value.name,r.value.permission_mode=i.value.current_permission_mode||"default"),v.show()}}),ie(()=>{d.value&&ae(async()=>{const{default:M}=await import("./modal-B4rHLo2F.js").then(_=>_.m);return{default:M}},__vite__mapDeps([0,1])).then(({default:M})=>{v=new M(d.value),d.value.addEventListener("shown.bs.modal",y),d.value.addEventListener("hidden.bs.modal",b)})}),ce(()=>{d.value&&(d.value.removeEventListener("shown.bs.modal",y),d.value.removeEventListener("hidden.bs.modal",b)),v&&v.dispose()}),(M,_)=>(s(),o("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:d},[e("div",Gd,[e("div",Jd,[_[15]||(_[15]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Kd,[e("form",{onSubmit:re(P,["prevent"])},[e("div",Yd,[_[2]||(_[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),Y(e("input",{type:"text",class:H(["form-control",{"is-invalid":a.value.name}]),id:"editSessionName","onUpdate:modelValue":_[0]||(_[0]=c=>r.value.name=c),placeholder:"Session Name",required:""},null,2),[[ne,r.value.name]]),a.value.name?(s(),o("div",Qd,f(a.value.name),1)):E("",!0)]),e("div",Zd,[_[3]||(_[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:i.value?.working_directory,disabled:"",readonly:""},null,8,Xd),_[4]||(_[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",eu,[_[5]||(_[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",tu,[e("span",{class:H(["badge",$(i.value?.state)])},f(i.value?.state),3)])]),e("div",su,[_[9]||(_[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Y(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":_[1]||(_[1]=c=>r.value.permission_mode=c),disabled:!m.value},[_[6]||(_[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),_[7]||(_[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),_[8]||(_[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),h.value?(s(),o("option",nu,"⚠️ Bypass Permissions (No prompts)")):E("",!0)],8,ou),[[fe,r.value.permission_mode]]),e("div",lu,[m.value?(s(),o("span",ru," Controls which tool actions require permission prompts ")):(s(),o("span",au," ⚠️ Session must be active to change permission mode. Start the session first. "))])]),i.value?.system_prompt||i.value?.override_system_prompt?(s(),o("div",iu,[_[13]||(_[13]=e("label",{class:"form-label"},"System Prompt Configuration",-1)),e("div",cu,[e("div",du,[i.value?.override_system_prompt?(s(),o("div",uu,[..._[10]||(_[10]=[e("span",{class:"badge bg-warning text-dark"},"Override Mode",-1),e("div",{class:"form-text text-warning mt-1"}," Using custom prompt only (no Claude Code preset) ",-1)])])):(s(),o("div",mu,[..._[11]||(_[11]=[e("span",{class:"badge bg-info"},"Append Mode",-1),e("div",{class:"form-text mt-1"}," Custom instructions appended to Claude Code preset ",-1)])])),i.value?.system_prompt?(s(),o("div",pu,[_[12]||(_[12]=e("strong",{class:"small"},"Custom Instructions:",-1)),e("div",vu,f(i.value.system_prompt),1)])):E("",!0)])])])):E("",!0),g.value?(s(),o("div",fu,f(g.value),1)):E("",!0)],32)]),e("div",gu,[_[14]||(_[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:P,disabled:p.value},[p.value?(s(),o("span",bu)):E("",!0),G(" "+f(p.value?"Saving...":"Save Changes"),1)],8,_u)])])])],512))}},yu=F(hu,[["__scopeId","data-v-c99ca17f"]]),$u={class:"modal-dialog modal-dialog-centered"},wu={class:"modal-content"},Su={class:"modal-header"},ku={class:"modal-title",id:"manageSessionModalLabel"},Cu={class:"modal-body"},xu={key:0,class:"text-center py-4"},Mu={class:"text-muted"},ju={key:1},Tu={key:2},Eu={class:"text-muted"},Pu={key:3},Lu={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Iu={class:"d-grid gap-2"},Du=["disabled"],Ou=["disabled"],Nu=["disabled"],Au=["disabled"],Ru={class:"modal-footer"},qu={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Uu={__name:"SessionManageModal",setup(n){const t=pe(),l=J(),i=te(),r=ge();ue();const a=D(null),p=D(!1),g=D(""),d=D(""),v=D(null),m=D(null);let h=null;const $=u(()=>v.value==="reset"?"Reset Session":v.value==="delete"?"Delete Session":"Manage Session");function S(){v.value="reset"}function P(){v.value="delete"}function C(){v.value=null}async function y(){v.value==="reset"?await _():v.value==="delete"&&await c()}async function b(){if(a.value){p.value=!0,g.value="Restarting session...";try{const x=a.value.session_id,I=await K.post(`/api/sessions/${x}/restart`);if(I.success)console.log("Session restarted successfully, reconnecting"),await r.disconnectSession(),l.currentSessionId=null,await l.selectSession(x),h&&h.hide();else{const W=I.error||I.detail||"Failed to restart session";console.error("Failed to restart session:",W),d.value=`Failed to restart session: ${W}`}}catch(x){console.error("Error restarting session:",x);const I=x.data?.detail||x.message||"Unknown error";d.value=`Error restarting session: ${I}`}finally{p.value=!1}}}async function M(){if(a.value)try{h&&h.hide(),console.log("Ending session",a.value.session_id);const x=a.value.session_id;await K.post(`/api/sessions/${x}/terminate`),await r.disconnectSession(),l.currentSessionId===x&&(l.currentSessionId=null),t.push("/")}catch(x){console.error("Error ending session:",x),await r.disconnectSession(),l.currentSessionId===a.value?.session_id&&(l.currentSessionId=null),t.push("/")}}async function _(){if(a.value){p.value=!0,g.value="Resetting session...";try{const x=a.value.session_id,I=await K.post(`/api/sessions/${x}/reset`);if(I.success)console.log("Session reset successfully, reconnecting"),await r.disconnectSession(),l.currentSessionId=null,await l.selectSession(x),h&&h.hide();else{const W=I.error||I.detail||"Failed to reset session";console.error("Failed to reset session:",W),d.value=`Failed to reset session: ${W}`,v.value=null}}catch(x){console.error("Error resetting session:",x);const I=x.data?.detail||x.message||"Unknown error";d.value=`Error resetting session: ${I}`,v.value=null}finally{p.value=!1}}}async function c(){if(a.value){p.value=!0,g.value="Deleting session...";try{const x=a.value.session_id;await l.deleteSession(x),t.currentRoute.value.params.sessionId===x&&t.push("/"),h&&h.hide()}catch(x){console.error("Error deleting session:",x);const I=x.data?.detail||x.message||"Unknown error";d.value=`Error deleting session: ${I}`,v.value=null}finally{p.value=!1}}}function N(){v.value=null,p.value=!1,g.value="",d.value=""}function q(){N(),a.value=null,i.hideModal()}return se(()=>i.currentModal,x=>{if(x?.name==="manage-session"&&h){const I=x.data||{};a.value=I.session,N(),h.show()}}),ie(()=>{m.value&&ae(async()=>{const{default:x}=await import("./modal-B4rHLo2F.js").then(I=>I.m);return{default:x}},__vite__mapDeps([0,1])).then(({default:x})=>{h=new x(m.value),m.value.addEventListener("hidden.bs.modal",q)})}),ce(()=>{m.value&&m.value.removeEventListener("hidden.bs.modal",q),h&&h.dispose()}),(x,I)=>(s(),o("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:m},[e("div",$u,[e("div",wu,[e("div",Su,[e("h5",ku,f(v.value?$.value:"Manage Session"),1),I[1]||(I[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Cu,[p.value?(s(),o("div",xu,[I[2]||(I[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Mu,f(g.value),1)])):v.value==="reset"?(s(),o("div",ju,[...I[3]||(I[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):v.value==="delete"?(s(),o("div",Tu,[I[6]||(I[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1)),e("p",Eu,[I[4]||(I[4]=G("This will permanently delete session ",-1)),e("strong",null,f(a.value?.name),1),I[5]||(I[5]=G(".",-1))]),I[7]||(I[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(s(),o("div",Pu,[d.value?(s(),o("div",Lu,[I[8]||(I[8]=e("strong",null,"Error:",-1)),G(" "+f(d.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:I[0]||(I[0]=W=>d.value="")})])):E("",!0),I[15]||(I[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",Iu,[e("button",{class:"btn btn-outline-primary text-start",onClick:b,disabled:p.value},[...I[9]||(I[9]=[e("strong",null,"🔄 Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,Du),e("button",{class:"btn btn-outline-secondary text-start",onClick:M,disabled:p.value},[...I[10]||(I[10]=[e("strong",null,"🚪 End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,Ou),I[13]||(I[13]=e("hr",{class:"my-2"},null,-1)),I[14]||(I[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"⚠️ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:S,disabled:p.value},[...I[11]||(I[11]=[e("strong",null,"🗑️ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,Nu),e("button",{class:"btn btn-outline-danger text-start",onClick:P,disabled:p.value},[...I[12]||(I[12]=[e("strong",null,"❌ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,Au)]),I[16]||(I[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),G(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",Ru,[v.value&&!p.value?(s(),o(Z,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:C},"Cancel"),e("button",{type:"button",class:H(["btn",v.value==="delete"?"btn-danger":"btn-warning"]),onClick:y},f(v.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):p.value?E("",!0):(s(),o("button",qu,"Cancel"))])])])],512))}},Wu=F(Uu,[["__scopeId","data-v-de7ff18c"]]),Hu={class:"modal-dialog modal-dialog-centered modal-lg"},Fu={class:"modal-content"},Bu={class:"modal-body"},Vu={key:0,class:"text-center text-muted py-4"},zu={key:1},Gu={class:"mb-3"},Ju={class:"font-monospace small"},Ku={class:"mb-3"},Yu={class:"font-monospace small"},Qu={class:"mb-3"},Zu={class:"mb-3"},Xu={class:"mb-3"},em={key:0},tm={class:"d-flex flex-wrap gap-1"},sm={key:1,class:"text-muted small"},om={key:0,class:"mb-3"},nm={class:"d-flex flex-wrap gap-1"},lm={key:1,class:"mb-3"},am={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},rm={class:"mb-3"},im={class:"text-muted"},cm={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},dm={__name:"SessionInfoModal",setup(n){const t=J(),l=ue(),i=te(),r=D(null),a=D(!1),p=D(null);let g=null;const d=u(()=>{if(!r.value)return null;const $=t.initData.get(r.value);return $||(l.messagesBySession.get(r.value)||[]).find(C=>C.type==="system"&&(C.subtype==="init"||C.metadata?.subtype==="init")&&C.metadata?.init_data)?.metadata?.init_data||null});function v($){return typeof $=="string"?$:typeof $=="object"&&$.type==="preset"?`Preset: ${$.preset}`:JSON.stringify($,null,2)}function m(){r.value=null,a.value=!1}function h(){m(),i.hideModal()}return se(()=>i.currentModal,$=>{if($?.name==="session-info"&&g){const S=$.data||{};r.value=S.sessionId,a.value=!1,g.show()}}),ie(()=>{p.value&&ae(async()=>{const{default:$}=await import("./modal-B4rHLo2F.js").then(S=>S.m);return{default:$}},__vite__mapDeps([0,1])).then(({default:$})=>{g=new $(p.value),p.value.addEventListener("hidden.bs.modal",h)})}),ce(()=>{p.value&&p.value.removeEventListener("hidden.bs.modal",h),g&&g.dispose()}),($,S)=>(s(),o("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:p},[e("div",Hu,[e("div",Fu,[S[9]||(S[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Bu,[d.value?(s(),o("div",zu,[e("div",Gu,[S[1]||(S[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Ju,f(r.value),1)]),e("div",Ku,[S[2]||(S[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",Yu,f(d.value.cwd||"Not specified"),1)]),e("div",Qu,[S[3]||(S[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,f(d.value.model||"Default"),1)]),e("div",Zu,[S[4]||(S[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,f(d.value.permissionMode||"default"),1)]),e("div",Xu,[S[5]||(S[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),d.value.tools&&d.value.tools.length>0?(s(),o("div",em,[e("div",tm,[(s(!0),o(Z,null,X(d.value.tools,P=>(s(),o("span",{key:P,class:"badge bg-secondary"},f(P),1))),128))])])):(s(),o("div",sm,"All tools available"))]),d.value.commands&&d.value.commands.length>0?(s(),o("div",om,[S[6]||(S[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",nm,[(s(!0),o(Z,null,X(d.value.commands,P=>(s(),o("span",{key:P,class:"badge bg-info"},f(P),1))),128))])])):E("",!0),d.value.systemPrompt?(s(),o("div",lm,[S[7]||(S[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",am,f(v(d.value.systemPrompt)),1)])):E("",!0),e("div",rm,[e("h6",im,[S[8]||(S[8]=G(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:S[0]||(S[0]=P=>a.value=!a.value)},f(a.value?"Hide":"Show"),1)]),a.value?(s(),o("pre",cm,f(JSON.stringify(d.value,null,2)),1)):E("",!0)])])):(s(),o("div",Vu," No session configuration data available "))]),S[10]||(S[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},um=F(dm,[["__scopeId","data-v-809e2099"]]),mm={class:"modal-dialog modal-dialog-centered"},pm={class:"modal-content"},vm={class:"modal-body"},fm={class:"mb-3"},gm={class:"mb-3"},_m={class:"mb-3"},bm={class:"form-text d-flex justify-content-between"},hm={key:0,class:"invalid-feedback"},ym={class:"mb-3 form-check"},$m={key:0,class:"form-text text-warning"},wm={class:"mb-3"},Sm={key:0,class:"alert alert-danger"},km={class:"modal-footer"},Cm=["disabled"],xm={key:0,class:"spinner-border spinner-border-sm me-2"},Mm={__name:"CreateMinionModal",setup(n){const t=pe(),l=le(),i=J(),r=te(),a=D(null);let p=null;const g=D(null),d=D({name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]}),v=D(""),m=D(""),h=D(!1),$=u(()=>v.value.trim()?v.value.split(",").map(_=>_.trim()).filter(_=>_.length>0):[]),S=u(()=>d.value.initialization_context.length),P=u(()=>S.value>2e3),C=u(()=>S.value>1800&&S.value<=2e3);function y(){d.value={name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]},v.value="",m.value="",h.value=!1}function b(){y(),r.hideModal()}async function M(){if(!d.value.name.trim()){m.value="Minion name is required";return}if(d.value.name.includes(" ")){m.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(P.value){m.value="Initialization context exceeds 2000 character limit";return}if(!g.value){m.value="Legion ID is missing";return}h.value=!0,m.value="";try{const _={name:d.value.name.trim(),role:d.value.role.trim(),initialization_context:d.value.initialization_context.trim(),override_system_prompt:d.value.override_system_prompt,capabilities:$.value},c=await K.post(`/api/legions/${g.value}/minions`,_);c.success&&c.minion_id?(await l.fetchProjects(),await i.fetchSessions(),p&&p.hide(),t.push(`/spy/${g.value}/${c.minion_id}`)):m.value="Failed to create minion"}catch(_){console.error("Failed to create minion:",_),m.value=_.response?.data?.detail||"Failed to create minion"}finally{h.value=!1}}return se(()=>r.currentModal,_=>{if(_?.name==="create-minion"&&p){const c=_.data||{};g.value=c.project?.project_id||null,y(),p.show()}}),ie(()=>{a.value&&ae(()=>import("./modal-B4rHLo2F.js").then(_=>_.m),__vite__mapDeps([0,1])).then(_=>{const c=_.default;p=new c(a.value),a.value.addEventListener("hidden.bs.modal",b)})}),ce(()=>{a.value&&a.value.removeEventListener("hidden.bs.modal",b),p&&p.dispose()}),(_,c)=>(s(),o("div",{ref_key:"modalElement",ref:a,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",mm,[e("div",pm,[c[15]||(c[15]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",vm,[e("form",{onSubmit:re(M,["prevent"])},[e("div",fm,[c[5]||(c[5]=e("label",{for:"minion-name",class:"form-label"},[G(" Name "),e("span",{class:"text-danger"},"*")],-1)),Y(e("input",{id:"minion-name","onUpdate:modelValue":c[0]||(c[0]=N=>d.value.name=N),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[ne,d.value.name]]),c[6]||(c[6]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",gm,[c[7]||(c[7]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),Y(e("input",{id:"minion-role","onUpdate:modelValue":c[1]||(c[1]=N=>d.value.role=N),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[ne,d.value.role]]),c[8]||(c[8]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",_m,[c[9]||(c[9]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),Y(e("textarea",{id:"minion-context","onUpdate:modelValue":c[2]||(c[2]=N=>d.value.initialization_context=N),class:H(["form-control",{"is-invalid":P.value}]),rows:"4",maxlength:2e3,placeholder:"Instructions and context for the minion..."},null,2),[[ne,d.value.initialization_context]]),e("div",bm,[e("span",null,f(d.value.override_system_prompt?"This context will replace Claude Code's preset and legion guide":"This context will be appended to legion guide and Claude Code's preset"),1),e("span",{class:H({"text-danger":P.value,"text-warning":C.value})},f(S.value)+" / 2000 chars ",3)]),P.value?(s(),o("div",hm," Initialization context exceeds 2000 character limit (Windows command-line constraint) ")):E("",!0)]),e("div",ym,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":c[3]||(c[3]=N=>d.value.override_system_prompt=N)},null,512),[[be,d.value.override_system_prompt]]),c[11]||(c[11]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom context only) ",-1)),d.value.override_system_prompt?(s(),o("div",$m,[...c[10]||(c[10]=[e("small",null,"⚠️ Override mode may cause unexpected behaviors. Only custom context will be used (no legion guide or Claude Code preset).",-1)])])):E("",!0)]),e("div",wm,[c[12]||(c[12]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),Y(e("input",{id:"minion-capabilities","onUpdate:modelValue":c[4]||(c[4]=N=>v.value=N),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[ne,v.value]]),c[13]||(c[13]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),m.value?(s(),o("div",Sm,f(m.value),1)):E("",!0)],32)]),e("div",km,[c[14]||(c[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!d.value.name.trim()||h.value,onClick:M},[h.value?(s(),o("span",xm)):E("",!0),G(" "+f(h.value?"Creating...":"Create Minion"),1)],8,Cm)])])])],512))}},jm=F(Mm,[["__scopeId","data-v-d7434e2a"]]),Tm={class:"modal-dialog modal-dialog-centered modal-lg"},Em={class:"modal-content"},Pm={class:"modal-body"},Lm={key:0,class:"text-center text-muted py-4"},Im={key:1},Dm={class:"mb-3"},Om={class:"mb-3"},Nm={class:"font-monospace small"},Am={class:"mb-3"},Rm={class:"mb-3"},qm={class:"mb-3"},Um={key:0},Wm={class:"d-flex flex-wrap gap-1"},Hm={key:1,class:"text-muted small"},Fm={class:"mb-3"},Bm={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto","white-space":"pre-wrap"}},Vm={key:1,class:"text-muted small"},zm={class:"mb-3"},Gm={key:0,class:"badge bg-info"},Jm={key:1,class:"badge bg-secondary"},Km={class:"mb-3"},Ym={key:0,class:"font-monospace small"},Qm={key:1,class:"text-muted small"},Zm={key:0,class:"mb-3"},Xm={key:0},ep={class:"list-unstyled mb-0"},tp={key:1,class:"text-muted small"},sp={class:"mb-3"},op={key:0,class:"font-monospace small"},np={key:1,class:"text-muted small"},lp={class:"mb-3"},ap={key:0},rp={class:"d-flex flex-wrap gap-1"},ip={key:1,class:"text-muted small"},cp={class:"mb-3"},dp={class:"small"},up={class:"mb-3"},mp={class:"small"},pp={__name:"MinionViewModal",setup(n){const t=te(),l=D(null),i=D(null);let r=null;function a(v){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[v]||"bg-secondary"}function p(v){if(!v)return"N/A";try{const m=new Date(v);return isNaN(m.getTime())?"Invalid date":m.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(m){return console.error("Error formatting timestamp:",m),"Invalid date"}}function g(){l.value=null}function d(){g(),t.hideModal()}return se(()=>t.currentModal,v=>{if(v?.name==="minion-view"&&r){const m=v.data||{};l.value=m.session,r.show()}}),ie(()=>{i.value&&ae(async()=>{const{default:v}=await import("./modal-B4rHLo2F.js").then(m=>m.m);return{default:v}},__vite__mapDeps([0,1])).then(({default:v})=>{r=new v(i.value),i.value.addEventListener("hidden.bs.modal",d)})}),ce(()=>{i.value&&i.value.removeEventListener("hidden.bs.modal",d),r&&r.dispose()}),(v,m)=>(s(),o("div",{class:"modal fade",id:"minionViewModal",tabindex:"-1","aria-labelledby":"minionViewModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:i},[e("div",Tm,[e("div",Em,[m[13]||(m[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"minionViewModalLabel"},"Minion Details"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Pm,[l.value?(s(),o("div",Im,[e("div",Dm,[m[0]||(m[0]=e("h6",{class:"text-muted"},"Name",-1)),e("div",null,f(l.value.name||"Unnamed Minion"),1)]),e("div",Om,[m[1]||(m[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Nm,f(l.value.session_id),1)]),e("div",Am,[m[2]||(m[2]=e("h6",{class:"text-muted"},"Role",-1)),e("div",null,f(l.value.role||"Not specified"),1)]),e("div",Rm,[m[3]||(m[3]=e("h6",{class:"text-muted"},"Current State",-1)),e("div",null,[e("span",{class:H(["badge",a(l.value.state)])},f(l.value.state),3)])]),e("div",qm,[m[4]||(m[4]=e("h6",{class:"text-muted"},"Capabilities",-1)),l.value.capabilities&&l.value.capabilities.length>0?(s(),o("div",Um,[e("div",Wm,[(s(!0),o(Z,null,X(l.value.capabilities,h=>(s(),o("span",{key:h,class:"badge bg-secondary"},f(h),1))),128))])])):(s(),o("div",Hm,"None"))]),e("div",Fm,[m[5]||(m[5]=e("h6",{class:"text-muted"},"Initialization Context",-1)),l.value.initialization_context?(s(),o("div",Bm,f(l.value.initialization_context),1)):(s(),o("div",Vm,"Not specified"))]),e("div",zm,[m[6]||(m[6]=e("h6",{class:"text-muted"},"Overseer",-1)),e("div",null,[l.value.is_overseer?(s(),o("span",Gm,"Yes")):(s(),o("span",Jm,"No"))])]),e("div",Km,[m[7]||(m[7]=e("h6",{class:"text-muted"},"Parent Overseer",-1)),l.value.parent_overseer_id?(s(),o("div",Ym,f(l.value.parent_overseer_id),1)):(s(),o("div",Qm,f(l.value.is_minion?"Root overseer (user-created)":"N/A"),1))]),l.value.is_overseer?(s(),o("div",Zm,[m[8]||(m[8]=e("h6",{class:"text-muted"},"Child Minions",-1)),l.value.child_minion_ids&&l.value.child_minion_ids.length>0?(s(),o("div",Xm,[e("ul",ep,[(s(!0),o(Z,null,X(l.value.child_minion_ids,h=>(s(),o("li",{key:h,class:"font-monospace small"},f(h),1))),128))])])):(s(),o("div",tp,"No children"))])):E("",!0),e("div",sp,[m[9]||(m[9]=e("h6",{class:"text-muted"},"Horde Membership",-1)),l.value.horde_id?(s(),o("div",op,f(l.value.horde_id),1)):(s(),o("div",np,"Not in a horde"))]),e("div",lp,[m[10]||(m[10]=e("h6",{class:"text-muted"},"Channel Memberships",-1)),l.value.channel_ids&&l.value.channel_ids.length>0?(s(),o("div",ap,[e("div",rp,[(s(!0),o(Z,null,X(l.value.channel_ids,h=>(s(),o("span",{key:h,class:"badge bg-info"},f(h),1))),128))])])):(s(),o("div",ip,"No channels"))]),e("div",cp,[m[11]||(m[11]=e("h6",{class:"text-muted"},"Created",-1)),e("div",dp,f(p(l.value.created_at)),1)]),e("div",up,[m[12]||(m[12]=e("h6",{class:"text-muted"},"Last Active",-1)),e("div",mp,f(p(l.value.updated_at)),1)])])):(s(),o("div",Lm," No minion data available "))]),m[14]||(m[14]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},vp=F(pp,[["__scopeId","data-v-c44eaee2"]]),fp={class:"container-fluid vh-100 d-flex flex-column p-0"},gp={class:"d-flex flex-grow-1 overflow-hidden position-relative"},_p={class:"flex-grow-1 d-flex flex-column overflow-hidden"},bp={__name:"App",setup(n){const t=te(),l=ge(),i=J(),r=le(),a=pe(),p=u(()=>t.sidebarCollapsed),g=u(()=>t.isMobile);ie(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),l.connectUI(),await Promise.all([r.fetchProjects(),i.fetchSessions()]);const m=window.location.hash;if(m.startsWith("#/session/")){const h=m.replace("#/session/","");i.sessions.has(h)&&await i.selectSession(h)}else if(m.startsWith("#/timeline/")){const h=m.replace("#/timeline/","");a.push(`/timeline/${h}`)}window.addEventListener("popstate",d),window.addEventListener("resize",t.handleResize)}),ce(()=>{window.removeEventListener("popstate",d),window.removeEventListener("resize",t.handleResize),l.disconnectUI()});function d(){const m=window.location.hash;if(m.startsWith("#/session/")){const h=m.replace("#/session/","");i.sessions.has(h)&&i.selectSession(h)}}function v(){t.toggleSidebar()}return(m,h)=>{const $=Ue("router-view");return s(),o("div",fp,[Q(Oi),e("div",{id:"sidebar-backdrop",class:H({show:!p.value&&g.value}),onClick:v},null,2),e("div",gp,[Q(hc),e("main",_p,[Q($)])]),Q(Nc),Q(td),Q(Sd),Q(zd),Q(yu),Q(Wu),Q(um),Q(jm),Q(vp)])}}},Pe=Ve(bp);Pe.use(ze());Pe.use(Pi);Pe.mount("#app");
