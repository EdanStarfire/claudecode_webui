const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as r,a as e,o as n,d as me,r as I,b as u,t as f,n as re,e as W,f as H,u as fe,w as Q,g as je,h as P,F as G,i as Y,j as le,k as Oe,l as J,v as X,m as z,p as oe,q as ye,s as Ne,x as ae,y as ne,z as de,A as Ae,B as Re,C as Ue,D as ie,E as $e,G as He,H as We}from"./vue-vendor-BChC3Sgv.js";import{m as pe,p as we}from"./markdown-vendor-CQ3OZdP9.js";import{c as Fe}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&l(v)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}})();const Be={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},Ve={__name:"NoSessionSelected",setup(s){return(t,i)=>(n(),r("div",Be,[...i[0]||(i[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},ze="modulepreload",Je=function(s){return"/"+s},Me={},se=function(t,i,l){let o=Promise.resolve();if(i&&i.length>0){let d=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),m=v?.nonce||v?.getAttribute("nonce");o=d(i.map(p=>{if(p=Je(p),p in Me)return;Me[p]=!0;const g=p.endsWith(".css"),w=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${w}`))return;const _=document.createElement("link");if(_.rel=g?"stylesheet":ze,g||(_.as="script"),_.crossOrigin="",_.href=p,m&&_.setAttribute("nonce",m),document.head.appendChild(_),g)return new Promise((h,E)=>{_.addEventListener("load",h),_.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${p}`)))})}))}function a(v){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=v,window.dispatchEvent(m),!m.defaultPrevented)throw v}return o.then(v=>{for(const m of v||[])m.status==="rejected"&&a(m.reason);return t().catch(a)})};class _e extends Error{constructor(t,i,l){super(t),this.name="APIError",this.status=i,this.data=l}}async function ve(s,t={}){try{const i=await fetch(s,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!i.ok){let o;try{o=await i.json()}catch{o={detail:i.statusText}}throw new _e(o.detail||`HTTP ${i.status}: ${i.statusText}`,i.status,o)}const l=i.headers.get("content-type");return l&&l.includes("application/json")?await i.json():await i.text()}catch(i){throw i instanceof _e?i:(console.error("API request failed:",i),new _e(`Network error: ${i.message}`,0,null))}}async function Ke(s,t={}){let i=s;if(t.params){const l=new URLSearchParams;for(const[m,d]of Object.entries(t.params))d!=null&&l.append(m,d);const o=l.toString();o&&(i=`${s}?${o}`);const{params:a,...v}=t;return ve(i,{...v,method:"GET"})}return ve(i,{...t,method:"GET"})}async function Ge(s,t,i={}){return ve(s,{...i,method:"POST",body:JSON.stringify(t)})}async function Ye(s,t,i={}){return ve(s,{...i,method:"PUT",body:JSON.stringify(t)})}async function Qe(s,t={}){return ve(s,{...t,method:"DELETE"})}const B={get:Ke,post:Ge,put:Ye,delete:Qe},F=me("session",()=>{const s=I(new Map),t=I(null),i=I(new Map),l=I(new Map),o=I(new Set),a=u(()=>s.value.get(t.value)),v=u(()=>Array.from(s.value.values()).sort((k,M)=>k.order-M.order)),m=k=>u(()=>v.value.filter(M=>M.project_id===k)),d=u({get:()=>i.value.get(t.value)||"",set:k=>{t.value&&i.value.set(t.value,k)}});async function p(){try{const k=await B.get("/api/sessions");return s.value.clear(),k.sessions.forEach(M=>{s.value.set(M.session_id,M)}),console.log(`Loaded ${s.value.size} sessions`),k.sessions}catch(k){throw console.error("Failed to fetch sessions:",k),k}}async function g(k,M){try{const N=(await B.post("/api/sessions",{project_id:k,...M})).session_id,S=(await B.get(`/api/sessions/${N}`)).session;return s.value.set(N,S),s.value=new Map(s.value),console.log(`Created session ${N}`),S}catch(R){throw console.error("Failed to create session:",R),R}}async function w(k){if(t.value===k)return;t.value=k;let M=s.value.get(k);if(!M)try{M=(await B.get(`/api/sessions/${k}`)).session,s.value.set(k,M),s.value=new Map(s.value),console.log(`Fetched session ${k} for deeplink`)}catch(C){console.error(`Failed to fetch session ${k}:`,C);return}if(M&&(M.state==="created"||M.state==="terminated"))try{await y(k),console.log(`Auto-started session ${k} (was in ${M.state} state)`);const C=6e4,S=200,L=5e3;let $=0,D=0;for(;$<C;){const A=s.value.get(k);if(A&&A.state==="active"){console.log(`Session ${k} is now active after ${$}ms`);break}if($-D>=L){const U=s.value.get(k)?.state||"unknown";console.log(`Waiting for session ${k} to become active (current: ${U}, ${$/1e3}s elapsed)`),D=$}await new Promise(U=>setTimeout(U,S)),$+=S}const O=s.value.get(k);O&&O.state!=="active"&&console.warn(`Session ${k} did not become active within ${C/1e3}s (state: ${O.state}), continuing anyway`)}catch(C){console.error(`Failed to auto-start session ${k}:`,C)}await(await se(()=>Promise.resolve().then(()=>_t),void 0)).useMessageStore().loadMessages(k),(await se(()=>Promise.resolve().then(()=>qt),void 0)).useWebSocketStore().connectSession(k),console.log(`Selected session ${k}`)}function _(k,M){const R=s.value.get(k);R&&(Object.assign(R,M),s.value=new Map(s.value))}async function h(k){o.value.add(k);try{await B.delete(`/api/sessions/${k}`),s.value.delete(k),i.value.delete(k),l.value.delete(k),s.value=new Map(s.value),t.value===k&&(t.value=null),console.log(`Deleted session ${k}`)}catch(M){throw console.error("Failed to delete session:",M),M}finally{o.value.delete(k)}}async function E(k,M){try{await B.put(`/api/sessions/${k}/name`,{name:M}),_(k,{name:M}),console.log(`Updated session ${k} name to "${M}"`)}catch(R){throw console.error("Failed to update session name:",R),R}}async function T(k,M){try{await B.post(`/api/sessions/${k}/permission-mode`,{mode:M}),_(k,{current_permission_mode:M});const R=l.value.get(k);R&&(R.permissionMode=M,l.value.set(k,R)),console.log(`Set permission mode for session ${k} to ${M}`)}catch(R){throw console.error("Failed to set permission mode:",R),R}}async function y(k){try{await B.post(`/api/sessions/${k}/start`),console.log(`Started session ${k}`)}catch(M){throw console.error("Failed to start session:",M),M}}async function c(k){try{await B.post(`/api/sessions/${k}/pause`),console.log(`Paused session ${k}`)}catch(M){throw console.error("Failed to pause session:",M),M}}async function j(k){try{await B.post(`/api/sessions/${k}/terminate`),console.log(`Terminated session ${k}`)}catch(M){throw console.error("Failed to terminate session:",M),M}}function b(k){return s.value.get(k)}function x(k,M){l.value.set(k,M),M.permissionMode&&_(k,{current_permission_mode:M.permissionMode})}return{sessions:s,currentSessionId:t,inputCache:i,initData:l,deletingSessions:o,currentSession:a,orderedSessions:v,sessionsInProject:m,currentInput:d,fetchSessions:p,createSession:g,selectSession:w,updateSession:_,deleteSession:h,updateSessionName:E,setPermissionMode:T,startSession:y,pauseSession:c,terminateSession:j,getSession:b,storeInitData:x}}),Te=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:F},Symbol.toStringTag,{value:"Module"})),Z=me("ui",()=>{const s=I(window.innerWidth<768),t=I(300),i=I(window.innerWidth),l=u(()=>i.value<768),o=I(!0),a=I(null),v=I(null),m=u(()=>a.value?{name:a.value,data:v.value}:null),d=I(!1),p=I("Loading...");function g(){s.value=!s.value}function w(b){s.value=b}function _(b){t.value=Math.max(200,Math.min(b,window.innerWidth*.3))}function h(b){o.value=b}function E(b,x=null){a.value=null,v.value=null,setTimeout(()=>{a.value=b,v.value=x},0)}function T(){a.value=null,v.value=null}function y(b="Loading..."){d.value=!0,p.value=b}function c(){d.value=!1}function j(){const b=i.value;i.value=window.innerWidth,i.value<768&&b>=768?s.value=!0:i.value>=768&&b<768&&(s.value=!1)}return{sidebarCollapsed:s,sidebarWidth:t,isMobile:l,autoScrollEnabled:o,activeModal:a,modalData:v,currentModal:m,isLoading:d,loadingMessage:p,toggleSidebar:g,setSidebarCollapsed:w,setSidebarWidth:_,setAutoScroll:h,showModal:E,hideModal:T,showLoading:y,hideLoading:c,handleResize:j}}),ee=me("project",()=>{const s=I(new Map),t=I(null),i=u(()=>s.value.get(t.value)),l=u(()=>Array.from(s.value.values()).sort((T,y)=>T.order-y.order)),o=T=>s.value.get(T)?.is_multi_agent||!1;async function a(){try{const T=await B.get("/api/projects");return s.value.clear(),T.projects.forEach(y=>{s.value.set(y.project_id,y)}),console.log(`Loaded ${s.value.size} projects`),T.projects}catch(T){throw console.error("Failed to fetch projects:",T),T}}async function v(T,y,c=!1){try{const b=(await B.post("/api/projects",{name:T,working_directory:y,is_multi_agent:c})).project;return s.value.set(b.project_id,b),s.value=new Map(s.value),console.log(`Created project ${b.project_id}`),b}catch(j){throw console.error("Failed to create project:",j),j}}async function m(T,y){try{await B.put(`/api/projects/${T}`,y),d(T,y),console.log(`Updated project ${T}`,y)}catch(c){throw console.error("Failed to update project:",c),c}}function d(T,y){const c=s.value.get(T);c&&(Object.assign(c,y),s.value=new Map(s.value))}async function p(T){try{await B.delete(`/api/projects/${T}`),s.value.delete(T),s.value=new Map(s.value),t.value===T&&(t.value=null),console.log(`Deleted project ${T}`)}catch(y){throw console.error("Failed to delete project:",y),y}}async function g(T){try{const y=await B.put(`/api/projects/${T}/toggle-expansion`),c=s.value.get(T);return c&&(c.is_expanded=y.is_expanded,s.value=new Map(s.value)),y.is_expanded}catch(y){throw console.error("Failed to toggle expansion:",y),y}}async function w(T){try{await B.put("/api/projects/reorder",{project_ids:T}),T.forEach((y,c)=>{const j=s.value.get(y);j&&(j.order=c)}),s.value=new Map(s.value),console.log("Reordered projects",T)}catch(y){throw console.error("Failed to reorder projects:",y),y}}async function _(T,y){try{await B.put(`/api/projects/${T}/sessions/reorder`,{session_ids:y});const c=s.value.get(T);c&&(c.session_ids=y,s.value=new Map(s.value)),console.log(`Reordered sessions in project ${T}`,y)}catch(c){throw console.error("Failed to reorder sessions:",c),c}}function h(T){return s.value.get(T)}function E(T){if(!T)return"";const y=T.split(/[/\\]/).filter(c=>c);return y.length===0?"/":y.length===1?`/${y[0]}`:y.length===2?`/${y.join("/")}`:`.../${y.slice(-2).join("/")}`}return{projects:s,currentProjectId:t,currentProject:i,orderedProjects:l,isMultiAgent:o,fetchProjects:a,createProject:v,updateProject:m,updateProjectLocal:d,deleteProject:p,toggleExpansion:g,reorderProjects:w,reorderSessionsInProject:_,getProject:h,formatPath:E}}),q=(s,t)=>{const i=s.__vccOpts||s;for(const[l,o]of t)i[l]=o;return i},Ze={class:"session-header border-bottom p-3"},Xe={class:"project-name"},et=["title"],tt={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,i=F(),l=ee(),o=u(()=>i.sessions.get(t.sessionId)),a=u(()=>o.value?.name||t.sessionId),v=u(()=>{for(const d of l.projects.values())if(d.session_ids?.includes(t.sessionId))return d;return null}),m=u(()=>v.value?.name||"Unknown Project");return(d,p)=>(n(),r("div",Ze,[e("div",null,[e("div",Xe,f(m.value),1),e("div",{class:"session-name",title:s.sessionId},f(a.value),9,et)])]))}},st=q(tt,[["__scopeId","data-v-89e9c269"]]),ot={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},nt=["title"],lt={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},at={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,i=F(),l=u(()=>i.sessions.get(t.sessionId)),o=u(()=>l.value?l.value.state==="paused"&&l.value.is_processing?"pending-prompt":l.value.is_processing?"processing":l.value.state:"unknown"),a=u(()=>{const d=o.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[d]||"#d3d3d3"}),v=u(()=>{const d=o.value;return d==="starting"||d==="processing"||d==="pending-prompt"}),m=u(()=>{if(!l.value)return"No session selected";const d=o.value,p=d.charAt(0).toUpperCase()+d.slice(1).replace("-"," "),g=l.value.name||"Unnamed Session",w=l.value.is_minion&&l.value.role?` (${l.value.role})`:"";return`${g}${w}: ${p}`});return(d,p)=>(n(),r("div",ot,[l.value?(n(),r("div",{key:0,class:W(["progress-bar",{"progress-bar-striped progress-bar-animated":v.value}]),style:re({width:"100%",backgroundColor:a.value}),title:m.value},null,14,nt)):(n(),r("div",lt))]))}},rt=q(at,[["__scopeId","data-v-e8795bb7"]]),it={class:"session-status-bar border-top p-2 bg-light"},dt={class:"d-flex justify-content-between align-items-center gap-2"},ut={class:"d-flex gap-2"},ct=["disabled"],mt={class:"mode-label"},pt=["disabled"],vt=["disabled"],ft={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,i=F(),l=Z(),o=u(()=>i.sessions.get(t.sessionId)),a=u(()=>o.value?.current_permission_mode||"default"),v={default:"🔒",acceptEdits:"✏️",plan:"📋",bypassPermissions:"☢️"},m=u(()=>v[a.value]||"🔒"),d=u(()=>a.value),p=["default","acceptEdits","plan"],g=async()=>{if(!o.value)return;if(a.value==="bypassPermissions"){try{await i.setPermissionMode(t.sessionId,"default")}catch(c){console.error("Failed to cycle permission mode:",c)}return}const T=(p.indexOf(a.value)+1)%p.length,y=p[T];try{await i.setPermissionMode(t.sessionId,y)}catch(c){console.error("Failed to cycle permission mode:",c)}},w=()=>{l.showModal("session-info",{sessionId:t.sessionId})},_=()=>{l.showModal("manage-session",{session:o.value})},h=()=>{l.setAutoScroll(!l.autoScrollEnabled)};return(E,T)=>(n(),r("div",it,[e("div",dt,[e("div",ut,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:g,disabled:!o.value},[H(f(m.value)+" ",1),e("span",mt,f(d.value),1)],8,ct),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:w,disabled:!o.value},[...T[0]||(T[0]=[H(" ℹ️ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,pt),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:_,disabled:!o.value},[...T[1]||(T[1]=[H(" ⚙️ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,vt)]),e("div",null,[e("button",{class:W(["btn btn-sm",fe(l).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:h}," ⬇️ "+f(fe(l).autoScrollEnabled?"ON":"OFF"),3)])])]))}},gt=q(ft,[["__scopeId","data-v-fdcd3535"]]),ue=me("message",()=>{const s=I(new Map),t=I(new Map),i=I(new Map),l=I(new Map),o=I(new Map),a=I(new Map),v=u(()=>{const C=F();return s.value.get(C.currentSessionId)||[]}),m=u(()=>{const C=F();return t.value.get(C.currentSessionId)||[]});async function d(C,S=null,L=0){try{const $=S||1e4,D=await B.get(`/api/sessions/${C}/messages?limit=${$}&offset=${L}`),O=D.messages||[],A=D.total_count||O.length,U=D.has_more||!1;console.log(`Loaded ${O.length} of ${A} messages for session ${C}`),s.value.set(C,O);const K=new Set;O.forEach(V=>{V.type==="assistant"&&V.metadata?.tool_uses&&V.metadata.tool_uses.forEach(te=>{K.add(te.id)}),V.type==="user"&&V.metadata?.tool_results&&V.metadata.tool_results.forEach(te=>{K.delete(te.tool_use_id);const xe=a.value.get(C);xe&&xe.delete(te.tool_use_id)}),V.type==="system"&&V.metadata?.subtype==="client_launched"&&(K.forEach(te=>{b(C,te,"Session was restarted")}),K.clear()),V.type==="system"&&V.metadata?.subtype==="interrupt"&&(K.forEach(te=>{b(C,te,"Session was interrupted")}),K.clear()),V.metadata?.has_tool_uses&&V.metadata.tool_uses&&V.metadata.tool_uses.forEach(te=>{h(C,te)}),V.metadata?.has_tool_results&&V.metadata.tool_results&&V.metadata.tool_results.forEach(te=>{y(C,te)}),(V.type==="permission_request"||V.metadata?.has_permission_requests)&&E(C,V),V.type==="system"&&(V.subtype==="init"||V.metadata?.subtype==="init")&&V.metadata?.init_data&&F().storeInitData(C,V.metadata.init_data)});const Ce=F().sessions.get(C);return Ce&&!["active","paused","starting"].includes(Ce.state)&&(K.forEach(V=>{b(C,V,"Session was terminated")}),K.clear()),o.value.set(C,K),s.value=new Map(s.value),U&&console.warn(`Warning: Only loaded ${O.length} of ${A} messages. Some messages may be missing.`),{messages:O,totalCount:A,hasMore:U}}catch($){throw console.error("Failed to load messages:",$),$}}function p(C,S){const L=o.value.get(C)||new Set;S.type==="assistant"&&S.metadata?.tool_uses&&S.metadata.tool_uses.forEach($=>{L.add($.id)}),S.type==="user"&&S.metadata?.tool_results&&S.metadata.tool_results.forEach($=>{L.delete($.tool_use_id);const D=a.value.get(C);D&&D.delete($.tool_use_id)}),S.type==="system"&&S.metadata?.subtype==="client_launched"&&(L.forEach($=>{b(C,$,"Session was restarted")}),L.clear()),S.type==="system"&&S.metadata?.subtype==="interrupt"&&(L.forEach($=>{b(C,$,"Session was interrupted")}),L.clear()),o.value.set(C,L)}function g(C,S){s.value.has(C)||s.value.set(C,[]),s.value.get(C).push(S),p(C,S),s.value=new Map(s.value)}function w(C,S){t.value.has(C)||t.value.set(C,[]),t.value.get(C).push(S),t.value=new Map(t.value)}function _(C,S,L){const $=t.value.get(C);if($){const D=$.find(O=>O.id===S);D&&(Object.assign(D,L),t.value=new Map(t.value))}}function h(C,S){const L=j(S.name,S.input);i.value.set(L,S.id);const $={id:S.id,name:S.name,input:S.input,signature:L,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return w(C,$),console.log(`Created tool call ${$.id} for ${$.name}`),$}function E(C,S){console.log("handlePermissionRequest received:",S);const L=S.metadata?.tool_name||S.tool_name,$=S.metadata?.input_params||S.input_params,D=S.metadata?.request_id||S.request_id,O=S.metadata?.suggestions||S.suggestions||[];console.log("Extracted data:",{toolName:L,inputParams:$,requestId:D,suggestions:O});const A=j(L,$),U=i.value.get(A);U?(l.value.set(D,U),_(C,U,{status:"permission_required",permissionRequestId:D,suggestions:O}),console.log(`Permission required for tool ${U}`,{suggestions:O})):console.warn("No tool use ID found for permission request signature:",A,{toolName:L,inputParams:$,availableSignatures:Array.from(i.value.keys())})}function T(C,S){const L=l.value.get(S.request_id);if(L){const $={permissionDecision:S.decision,appliedUpdates:S.applied_updates||[]};S.decision==="allow"?$.status="executing":($.status="completed",$.result={error:!0,message:S.reasoning||"Permission denied"},$.isExpanded=!1),_(C,L,$),console.log(`Permission ${S.decision} for tool ${L}`)}}function y(C,S){const L=S.tool_use_id;_(C,L,{status:S.is_error?"error":"completed",result:{error:S.is_error,content:S.content},isExpanded:!1}),console.log(`Tool ${L} ${S.is_error?"failed":"completed"}`)}function c(C,S){const L=t.value.get(C);if(L){const $=L.find(D=>D.id===S);$&&($.isExpanded=!$.isExpanded,t.value=new Map(t.value))}}function j(C,S){if(!C)return"unknown:{}";if(!S||typeof S!="object")return`${C}:{}`;const L=JSON.stringify(S,Object.keys(S).sort());return`${C}:${L}`}function b(C,S,L){const $=a.value.get(C)||new Map;$.set(S,{reason:"denied",message:L}),a.value.set(C,$);const D=t.value.get(C);if(D){const O=D.find(A=>A.id===S);O&&O.isExpanded&&(O.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${S} as orphaned: ${L}`)}function x(C,S){return a.value.get(C)?.has(S)||!1}function k(C,S){return a.value.get(C)?.get(S)}function M(C,S){const L=o.value.get(C);L&&L.size>0&&(L.forEach($=>b(C,$,S)),L.clear())}function R(C){s.value.delete(C),t.value.delete(C),s.value=new Map(s.value),t.value=new Map(t.value)}const N=F();return Q(()=>Array.from(N.sessions.values()).map(S=>({id:S.session_id,state:S.state})),(C,S)=>{S&&C.forEach((L,$)=>{const D=S[$];if(!D||D.id!==L.id)return;const O=["active","paused","starting"].includes(D.state),A=!["active","paused","starting"].includes(L.state);O&&A&&M(L.id,"Session was terminated")})},{deep:!0}),{messagesBySession:s,toolCallsBySession:t,activeToolUses:je(o),orphanedToolUses:je(a),currentMessages:v,currentToolCalls:m,loadMessages:d,addMessage:g,addToolCall:w,updateToolCall:_,handleToolUse:h,handlePermissionRequest:E,handlePermissionResponse:T,handleToolResult:y,toggleToolExpansion:c,clearMessages:R,markToolUseOrphaned:b,isToolUseOrphaned:x,getOrphanedInfo:k,clearOrphanedToolUses:M}}),_t=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:ue},Symbol.toStringTag,{value:"Module"}));function bt(s){if(!s)return new Date;if(typeof s=="string"){const t=new Date(s);return isNaN(t.getTime())?new Date:t}return typeof s=="number"?s<1e10?new Date(s*1e3):new Date(s):new Date}function ge(s){return bt(s).toLocaleTimeString()}const ht={class:"card user-message bg-light border-start border-primary border-3"},yt={class:"card-body"},$t={class:"d-flex justify-content-between align-items-center mb-2"},wt={class:"text-muted"},St=["innerHTML"],kt={key:0,class:"tool-results mt-3"},Ct={class:"tool-results-header text-muted small mb-2"},xt={class:"d-flex align-items-start gap-2"},jt={class:"flex-grow-1"},Mt={class:"text-muted"},Tt={key:0,class:"text-danger small"},Et={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s;pe.setOptions({breaks:!0,gfm:!0});const i=u(()=>ge(t.message.timestamp)),l=u(()=>{const m=t.message.content||"",d=pe.parse(m);return we.sanitize(d)}),o=u(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),a=u(()=>t.message.metadata?.tool_results||[]);function v(m,d){return m?m.length<=d?m:m.substring(0,d)+"...":""}return(m,d)=>(n(),r("div",ht,[e("div",yt,[e("div",$t,[d[0]||(d[0]=e("div",{class:"d-flex align-items-center gap-2"},[e("span",{class:"message-icon"},"👤"),e("strong",{class:"message-role"},"User")],-1)),e("small",wt,f(i.value),1)]),e("div",{class:"message-content",innerHTML:l.value},null,8,St),o.value?(n(),r("div",kt,[e("div",Ct,[d[1]||(d[1]=e("i",{class:"bi bi-tools"},null,-1)),H(" Tool Results ("+f(a.value.length)+") ",1)]),(n(!0),r(G,null,Y(a.value,(p,g)=>(n(),r("div",{key:g,class:W(["tool-result-summary p-2 mb-2 rounded",p.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",xt,[e("span",null,f(p.is_error?"❌":"✅"),1),e("div",jt,[e("small",Mt,"Tool: "+f(p.tool_use_id),1),p.is_error?(n(),r("div",Tt,f(v(p.content,200)),1)):P("",!0)])])],2))),128))])):P("",!0)])]))}},It=q(Et,[["__scopeId","data-v-532549d1"]]),Pt={class:"thinking-block"},Lt={class:"text-muted ms-auto"},Dt={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},Ot=["innerHTML"],Nt={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(s){const t=s,i=I(!1),l=u(()=>t.thinking?.length||0),o=u(()=>{const v=t.thinking||"",m=pe.parse(v);return we.sanitize(m)});function a(){i.value=!i.value}return(v,m)=>(n(),r("div",Pt,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:a},[e("i",{class:W(["bi",i.value?"bi-chevron-down":"bi-chevron-right"])},null,2),m[0]||(m[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),H(" Thinking ")],-1)),e("small",Lt,f(l.value)+" characters",1)]),i.value?(n(),r("div",Dt,[e("div",{class:"thinking-text",innerHTML:o.value},null,8,Ot)])):P("",!0)]))}},At=q(Nt,[["__scopeId","data-v-619a8344"]]),ce=me("websocket",()=>{const s=I(null),t=I(!1),i=I(0),l=10,o=I(null),a=I(!1),v=I(0),m=5,d=I(null),p=I(null),g=I(!1),w=I(0),_=5,h=I(null),E=u(()=>t.value&&(a.value||!d.value)?"connected":t.value?"partial":"disconnected");function T($){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${$}`}function y(){if(s.value)return;const $=T("/ws/ui");console.log(`Connecting to UI WebSocket: ${$}`),s.value=new WebSocket($),s.value.onopen=()=>{t.value=!0,i.value=0,console.log("UI WebSocket connected")},s.value.onmessage=D=>{const O=JSON.parse(D.data);R(O)},s.value.onclose=()=>{if(t.value=!1,s.value=null,console.log("UI WebSocket closed"),i.value<l){i.value++;const D=Math.min(2e3*i.value,3e4);console.log(`Reconnecting UI WebSocket in ${D}ms (attempt ${i.value})`),setTimeout(y,D)}},s.value.onerror=D=>{console.error("UI WebSocket error:",D)}}function c(){s.value&&(s.value.close(),s.value=null,t.value=!1)}function j($){b(),d.value=$;const D=T(`/ws/session/${$}`);console.log(`Connecting to Session WebSocket: ${D}`),o.value=new WebSocket(D),o.value.onopen=()=>{a.value=!0,v.value=0,console.log(`Session WebSocket connected for ${$}`)},o.value.onmessage=O=>{const A=JSON.parse(O.data);N(A,$)},o.value.onclose=()=>{if(a.value=!1,o.value=null,console.log(`Session WebSocket closed for ${$}`),F().currentSessionId===$&&v.value<m){v.value++;const A=Math.min(2e3*v.value,3e4);console.log(`Reconnecting Session WebSocket in ${A}ms (attempt ${v.value})`),setTimeout(()=>j($),A)}},o.value.onerror=O=>{console.error("Session WebSocket error:",O)}}function b(){return new Promise($=>{if(o.value){const D=()=>{o.value=null,a.value=!1,d.value=null,$()};o.value.readyState===WebSocket.CLOSED?D():(o.value.addEventListener("close",D,{once:!0}),o.value.close())}else $()})}function x($){o.value&&a.value?(o.value.send(JSON.stringify({type:"send_message",content:$})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function k($,D,O=!1,A=null){if(o.value&&a.value){const U={type:"permission_response",request_id:$,decision:D,apply_suggestions:O,timestamp:new Date().toISOString()};A&&(U.clarification_message=A),o.value.send(JSON.stringify(U)),console.log(`Sent permission ${D} for request ${$}`,{applySuggestions:O,clarification:A})}}function M(){o.value&&a.value&&(o.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function R($){const D=F(),O=ee();switch($.type){case"sessions_list":$.sessions&&Array.isArray($.sessions)&&$.sessions.forEach(A=>{D.updateSession(A.session_id,A)});break;case"state_change":$.data&&$.data.session_id&&$.data.session&&D.updateSession($.data.session_id,$.data.session);break;case"project_updated":if($.data&&$.data.project){const A=$.data.project;O.updateProjectLocal(A.project_id,A)}break;case"project_deleted":$.data&&$.data.project_id&&O.projects.delete($.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":s.value?.readyState===WebSocket.OPEN&&s.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",$.type)}}function N($,D){const O=ue(),A=F();switch($.type){case"message":const U=$.data;if(!U||!U.type){console.warn("Received message event with invalid data:",$);break}if(U.type==="permission_request"){O.handlePermissionRequest(D,U);break}if(U.type==="permission_response"){O.handlePermissionResponse(D,U);break}U.metadata?.has_tool_uses&&U.metadata.tool_uses.forEach(K=>{O.handleToolUse(D,K)}),U.metadata?.has_tool_results&&U.metadata.tool_results.forEach(K=>{O.handleToolResult(D,K)}),U.type==="system"&&(U.subtype==="init"||U.metadata?.subtype==="init")&&U.metadata?.init_data&&A.storeInitData(D,U.metadata.init_data),O.addMessage(D,U);break;case"permission_request":O.handlePermissionRequest(D,$);break;case"permission_response":O.handlePermissionResponse(D,$);break;case"tool_result":O.handleToolResult(D,$);break;case"state_change":A.updateSession(D,$.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${D}`);break;case"ping":o.value?.readyState===WebSocket.OPEN&&o.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function C($){S(),h.value=$;const D=T(`/ws/legion/${$}`);console.log(`Connecting to Legion WebSocket: ${D}`),p.value=new WebSocket(D),p.value.onopen=()=>{g.value=!0,w.value=0,console.log(`Legion WebSocket connected for ${$}`)},p.value.onmessage=O=>{const A=JSON.parse(O.data);L(A,$)},p.value.onclose=()=>{if(g.value=!1,p.value=null,console.log(`Legion WebSocket closed for ${$}`),h.value===$&&w.value<_){w.value++;const O=Math.min(2e3*w.value,3e4);setTimeout(()=>C($),O)}},p.value.onerror=O=>{console.error("Legion WebSocket error:",O)}}function S(){p.value&&(p.value.close(),p.value=null,g.value=!1,h.value=null)}function L($,D){se(async()=>{const{useLegionStore:O}=await Promise.resolve().then(()=>Ua);return{useLegionStore:O}},void 0).then(({useLegionStore:O})=>{const A=O();switch($.type){case"comm":$.comm&&(A.addComm(D,$.comm),console.log("Legion WebSocket: Received new comm",$.comm));break;case"minion_created":$.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",$.data),se(async()=>{const{useSessionStore:U}=await Promise.resolve().then(()=>Te);return{useSessionStore:U}},void 0).then(({useSessionStore:U})=>{U().loadSessions()}));break;case"minion_updated":$.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",$.data),se(async()=>{const{useSessionStore:U}=await Promise.resolve().then(()=>Te);return{useSessionStore:U}},void 0).then(({useSessionStore:U})=>{U().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${D}`);break;case"ping":p.value?.readyState===WebSocket.OPEN&&p.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",$.type)}})}return{uiConnected:t,sessionConnected:a,legionConnected:g,overallStatus:E,connectUI:y,disconnectUI:c,connectSession:j,disconnectSession:b,sendMessage:x,sendPermissionResponse:k,interruptSession:M,connectLegion:C,disconnectLegion:S}}),qt=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:ce},Symbol.toStringTag,{value:"Module"})),Rt={class:"base-tool-handler"},Ut={class:"tool-section mb-3"},Ht={class:"tool-parameters"},Wt={class:"tool-code"},Ft={key:0,class:"tool-section"},Bt={class:"tool-section-label"},Vt={class:"tool-code"},zt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),l=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),o=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),a=u(()=>{if(!l.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)});return(v,m)=>(n(),r("div",Rt,[e("div",Ut,[m[0]||(m[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Ht,[e("pre",Wt,f(i.value),1)])]),l.value?(n(),r("div",Ft,[e("div",Bt,f(o.value?"Error:":"Result:"),1),e("div",{class:W(["tool-result",{"tool-result-error":o.value}])},[e("pre",Vt,f(a.value),1)],2)])):P("",!0)]))}},Jt=q(zt,[["__scopeId","data-v-06a1b6c0"]]),Kt={class:"read-tool-handler"},Gt={class:"tool-section mb-3"},Yt={class:"read-file-info"},Qt={class:"file-path"},Zt={key:0,class:"read-range"},Xt={key:0,class:"tool-section"},es={key:0,class:"tool-result tool-result-error"},ts={class:"tool-code"},ss={key:1,class:"file-content-preview"},os={class:"content-header"},ns={class:"line-count-badge"},ls={key:0,class:"preview-note"},as={class:"tool-code content-display"},rs={key:0,class:"more-indicator"},be=100,is={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.file_path||"Unknown"),l=u(()=>{const h=t.toolCall.input?.offset,E=t.toolCall.input?.limit;return h!==void 0||E!==void 0}),o=u(()=>{const h=t.toolCall.input?.offset;return h!==void 0?h+1:1}),a=u(()=>{const h=t.toolCall.input?.offset||0,E=t.toolCall.input?.limit;return E!==void 0?h+E:"∞"}),v=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),m=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),d=u(()=>{if(!v.value)return"";const h=t.toolCall.result;return h.content!==void 0?typeof h.content=="string"?h.content:JSON.stringify(h.content,null,2):h.message?h.message:JSON.stringify(h,null,2)}),p=u(()=>m.value||!d.value?[]:d.value.split(`
`)),g=u(()=>p.value.length),w=u(()=>g.value>be),_=u(()=>m.value?"":p.value.slice(0,be).join(`
`));return(h,E)=>(n(),r("div",Kt,[e("div",Gt,[e("div",Yt,[E[0]||(E[0]=e("span",{class:"file-icon"},"📄",-1)),E[1]||(E[1]=e("strong",null,"Reading:",-1)),e("code",Qt,f(i.value),1),l.value?(n(),r("span",Zt,"Lines "+f(o.value)+"-"+f(a.value),1)):P("",!0)])]),v.value?(n(),r("div",Xt,[m.value?(n(),r("div",es,[e("pre",ts,f(d.value),1)])):(n(),r("div",ss,[e("div",os,[E[2]||(E[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",ns,f(g.value)+" lines",1),w.value?(n(),r("span",ls,"(showing first "+f(be)+")")):P("",!0)]),e("pre",as,f(_.value),1),w.value?(n(),r("div",rs,"...")):P("",!0)]))])):P("",!0)]))}},ds=q(is,[["__scopeId","data-v-0382f812"]]),us={class:"write-tool-handler"},cs={class:"tool-section mb-3"},ms={class:"write-file-info mb-2"},ps={class:"file-path"},vs={class:"write-content-preview"},fs={class:"content-header"},gs={class:"line-count-badge"},_s={key:0,class:"preview-note"},bs={class:"tool-code content-display"},hs={key:0,class:"more-indicator"},ys={key:0,class:"tool-section"},$s={key:0,class:"tool-result tool-result-error"},ws={class:"tool-code"},Ss={key:1,class:"tool-result tool-result-success"},ks={class:"success-message"},he=100,Cs={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.file_path||"Unknown"),l=u(()=>t.toolCall.input?.content||""),o=u(()=>l.value.split(`
`)),a=u(()=>o.value.length),v=u(()=>a.value>he),m=u(()=>o.value.slice(0,he).join(`
`)),d=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),p=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),g=u(()=>{if(!d.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)});return(w,_)=>(n(),r("div",us,[e("div",cs,[e("div",ms,[_[0]||(_[0]=e("span",{class:"file-icon"},"📝",-1)),_[1]||(_[1]=e("strong",null,"Writing:",-1)),e("code",ps,f(i.value),1)]),e("div",vs,[e("div",fs,[_[2]||(_[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",gs,f(a.value)+" lines",1),v.value?(n(),r("span",_s,"(showing first "+f(he)+")")):P("",!0)]),e("pre",bs,f(m.value),1),v.value?(n(),r("div",hs,"...")):P("",!0)])]),d.value?(n(),r("div",ys,[p.value?(n(),r("div",$s,[_[3]||(_[3]=e("strong",null,"Error:",-1)),e("pre",ws,f(g.value),1)])):(n(),r("div",Ss,[e("div",ks,[_[4]||(_[4]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"File created successfully ("+f(a.value)+" lines written)",1)])]))])):P("",!0)]))}},xs=q(Cs,[["__scopeId","data-v-d09b89ef"]]),js={class:"bash-tool-handler"},Ms={class:"tool-section mb-3"},Ts={class:"bash-header"},Es={class:"bash-header-content"},Is={key:0,class:"bash-description"},Ps={key:1,class:"bash-flags"},Ls={class:"bash-command-section"},Ds={class:"bash-command-content"},Os={key:0,class:"tool-section"},Ns={key:0,class:"bash-output"},As={key:1,class:"bash-output-empty"},qs={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.command||""),l=u(()=>t.toolCall.input?.description||""),o=u(()=>t.toolCall.input?.timeout),a=u(()=>t.toolCall.input?.run_in_background||!1),v=u(()=>o.value||a.value),m=u(()=>{const _=[];return o.value&&_.push(`timeout: ${o.value}ms`),a.value&&_.push("background"),_.join(", ")}),d=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),p=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),g=u(()=>p.value?"tool-result-error":"tool-result-success"),w=u(()=>{if(!d.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)});return(_,h)=>(n(),r("div",js,[e("div",Ms,[e("div",Ts,[h[1]||(h[1]=e("span",{class:"bash-icon"},"💻",-1)),e("div",Es,[l.value?(n(),r("div",Is,[h[0]||(h[0]=e("strong",null,"Description:",-1)),H(" "+f(l.value),1)])):P("",!0),v.value?(n(),r("div",Ps,f(m.value),1)):P("",!0)])]),e("div",Ls,[h[2]||(h[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",Ds,f(i.value),1)])]),d.value?(n(),r("div",Os,[e("div",{class:W(["tool-result",g.value])},[h[3]||(h[3]=e("strong",null,"Output:",-1)),w.value?(n(),r("pre",Ns,f(w.value),1)):(n(),r("div",As,"No output"))],2)])):P("",!0)]))}},Rs=q(qs,[["__scopeId","data-v-dc93bb16"]]),Us={class:"todo-tool-handler"},Hs={class:"tool-section mb-3"},Ws={class:"todo-header"},Fs={class:"todo-summary"},Bs={key:0,class:"todo-count todo-count-completed"},Vs={key:1,class:"todo-count todo-count-in-progress"},zs={key:2,class:"todo-count todo-count-pending"},Js={class:"todo-checklist"},Ks={class:"todo-checkbox"},Gs={class:"todo-content"},Ys={key:0,class:"tool-section"},Qs={key:0,class:"tool-result tool-result-error"},Zs={class:"tool-code"},Xs={key:1,class:"tool-result tool-result-success"},eo={class:"success-message"},to={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.todos||[]),l=u(()=>i.value.filter(g=>g.status==="completed").length),o=u(()=>i.value.filter(g=>g.status==="in_progress").length),a=u(()=>i.value.filter(g=>g.status==="pending").length);function v(g){return{pending:"☐",in_progress:"◐",completed:"☑"}[g]||"☐"}const m=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),d=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),p=u(()=>{if(!m.value)return"";const g=t.toolCall.result;return g.content!==void 0?typeof g.content=="string"?g.content:JSON.stringify(g.content,null,2):g.message?g.message:JSON.stringify(g,null,2)});return(g,w)=>(n(),r("div",Us,[e("div",Hs,[e("div",Ws,[w[0]||(w[0]=e("span",{class:"todo-icon"},"📋",-1)),w[1]||(w[1]=e("strong",null,"Task List:",-1)),e("div",Fs,[l.value>0?(n(),r("span",Bs,f(l.value)+" completed ",1)):P("",!0),o.value>0?(n(),r("span",Vs,f(o.value)+" in progress ",1)):P("",!0),a.value>0?(n(),r("span",zs,f(a.value)+" pending ",1)):P("",!0)])]),e("div",Js,[(n(!0),r(G,null,Y(i.value,(_,h)=>(n(),r("div",{key:h,class:W(["todo-item",`todo-${_.status}`])},[e("span",Ks,f(v(_.status)),1),e("span",Gs,f(_.content),1)],2))),128))])]),m.value?(n(),r("div",Ys,[d.value?(n(),r("div",Qs,[w[2]||(w[2]=e("strong",null,"Error:",-1)),e("pre",Zs,f(p.value),1)])):(n(),r("div",Xs,[e("div",eo,[w[3]||(w[3]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"Task list updated ("+f(i.value.length)+" tasks)",1)])]))])):P("",!0)]))}},so=q(to,[["__scopeId","data-v-0984bcf9"]]),oo={class:"edit-tool-handler"},no={class:"tool-section mb-3"},lo={class:"edit-file-info"},ao={class:"file-path"},ro={key:0,class:"replace-all-badge"},io={class:"edit-diff-container"},uo={class:"diff-header"},co={class:"diff-stats"},mo={class:"stat-removed"},po={class:"stat-added"},vo={class:"unified-diff"},fo={class:"diff-scroll-container"},go={class:"diff-marker"},_o={class:"diff-content"},bo={key:0,class:"tool-section"},ho={key:0,class:"tool-result tool-result-error"},yo={class:"tool-code"},$o={key:1,class:"tool-result tool-result-success"},wo={class:"success-message"},So={key:0,class:"success-detail"},ko={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.file_path||"Unknown"),l=u(()=>t.toolCall.input?.old_string||""),o=u(()=>t.toolCall.input?.new_string||""),a=u(()=>t.toolCall.input?.replace_all||!1),v=u(()=>{const h=Fe(i.value,l.value,o.value,"","",{context:3}).split(`
`),E=[];for(let T=4;T<h.length;T++){const y=h[T];y&&(y.startsWith("-")?E.push({type:"removed",content:y.substring(1)}):y.startsWith("+")?E.push({type:"added",content:y.substring(1)}):y.startsWith(" ")?E.push({type:"context",content:y.substring(1)}):y.startsWith("@@")&&E.push({type:"hunk",content:y}))}return E}),m=u(()=>v.value.filter(_=>_.type==="removed").length),d=u(()=>v.value.filter(_=>_.type==="added").length),p=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),g=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),w=u(()=>{if(!p.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)});return(_,h)=>(n(),r("div",oo,[e("div",no,[e("div",lo,[h[0]||(h[0]=e("span",{class:"file-icon"},"✏️",-1)),h[1]||(h[1]=e("strong",null,"Editing:",-1)),e("code",ao,f(i.value),1),a.value?(n(),r("span",ro,"Replace All")):P("",!0)]),e("div",io,[e("div",uo,[h[2]||(h[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",co,[e("span",mo,"-"+f(m.value),1),e("span",po,"+"+f(d.value),1)])]),e("div",vo,[e("div",fo,[(n(!0),r(G,null,Y(v.value,(E,T)=>(n(),r("div",{key:T,class:W(["diff-line",{"diff-line-removed":E.type==="removed","diff-line-added":E.type==="added","diff-line-context":E.type==="context","diff-line-hunk":E.type==="hunk"}])},[e("span",go,f(E.type==="removed"?"-":E.type==="added"?"+":E.type==="hunk"?"@":" "),1),e("span",_o,f(E.content),1)],2))),128))])])])]),p.value?(n(),r("div",bo,[g.value?(n(),r("div",ho,[h[3]||(h[3]=e("strong",null,"Error:",-1)),e("pre",yo,f(w.value),1)])):(n(),r("div",$o,[e("div",wo,[h[4]||(h[4]=e("span",{class:"success-icon"},"✅",-1)),h[5]||(h[5]=e("strong",null,"File edited successfully",-1)),a.value?(n(),r("span",So,"(all occurrences replaced)")):P("",!0)])]))])):P("",!0)]))}},Co=q(ko,[["__scopeId","data-v-b06adbf2"]]),xo={class:"search-tool-handler"},jo={class:"tool-section mb-3"},Mo={class:"search-info"},To={class:"search-icon"},Eo={class:"search-pattern"},Io={key:0,class:"search-path"},Po={key:1,class:"search-filters"},Lo={key:0,class:"filter-badge"},Do={key:1,class:"filter-badge"},Oo={key:2,class:"filter-badge"},No={key:0,class:"tool-section"},Ao={key:0,class:"tool-result tool-result-error"},qo={class:"tool-code"},Ro={key:1,class:"search-results"},Uo={class:"results-header"},Ho={class:"results-label"},Wo={class:"results-count-badge"},Fo={class:"results-content"},Bo={class:"tool-code"},Vo={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.name==="Grep");u(()=>t.toolCall.name==="Glob");const l=u(()=>t.toolCall.input?.pattern||"Unknown"),o=u(()=>t.toolCall.input?.path||null),a=u(()=>t.toolCall.input?.type||null),v=u(()=>t.toolCall.input?.glob||null),m=u(()=>t.toolCall.input?.["-i"]||!1),d=u(()=>a.value||v.value||m.value),p=u(()=>i.value?"🔍":"📁"),g=u(()=>i.value?"Searching content":"Finding files"),w=u(()=>i.value?"Matches":"Files found"),_=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),h=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),E=u(()=>{if(!_.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)}),T=u(()=>!_.value||h.value||!E.value?0:E.value.split(`
`).filter(c=>c.trim()).length);return(y,c)=>(n(),r("div",xo,[e("div",jo,[e("div",Mo,[e("span",To,f(p.value),1),e("strong",null,f(g.value)+":",1),e("code",Eo,f(l.value),1),o.value?(n(),r("span",Io,"in "+f(o.value),1)):P("",!0),d.value?(n(),r("span",Po,[a.value?(n(),r("span",Lo,"type: "+f(a.value),1)):P("",!0),v.value?(n(),r("span",Do,"glob: "+f(v.value),1)):P("",!0),m.value?(n(),r("span",Oo,"case-insensitive")):P("",!0)])):P("",!0)])]),_.value?(n(),r("div",No,[h.value?(n(),r("div",Ao,[c[0]||(c[0]=e("strong",null,"Error:",-1)),e("pre",qo,f(E.value),1)])):(n(),r("div",Ro,[e("div",Uo,[e("span",Ho,f(w.value)+":",1),e("span",Wo,f(T.value)+" "+f(T.value===1?"match":"matches"),1)]),e("div",Fo,[e("pre",Bo,f(E.value),1)])]))])):P("",!0)]))}},Ee=q(Vo,[["__scopeId","data-v-dc01ae0d"]]),zo={class:"web-tool-handler"},Jo={class:"tool-section mb-3"},Ko={class:"web-info"},Go={class:"web-icon"},Yo=["href"],Qo={key:1,class:"web-query"},Zo={key:0,class:"web-prompt-container"},Xo={class:"prompt-content"},en={key:1,class:"web-domains"},tn={class:"domains-label"},sn={key:0,class:"tool-section"},on={key:0,class:"tool-result tool-result-error"},nn={class:"tool-code"},ln={key:1,class:"web-results"},an={class:"results-header"},rn={class:"results-label"},dn={class:"results-content"},un={class:"tool-code"},cn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.name==="WebFetch");u(()=>t.toolCall.name==="WebSearch");const l=u(()=>t.toolCall.input?.url||null),o=u(()=>t.toolCall.input?.query||null),a=u(()=>t.toolCall.input?.prompt||null),v=u(()=>t.toolCall.input?.allowed_domains||[]),m=u(()=>t.toolCall.input?.blocked_domains||[]),d=u(()=>v.value.length>0?v.value:m.value.length>0?m.value:[]),p=u(()=>v.value.length>0?"Allowed domains":m.value.length>0?"Blocked domains":"Domains"),g=u(()=>i.value?"🌐":"🔎"),w=u(()=>i.value?"Fetching URL":"Searching web"),_=u(()=>i.value?"Fetched content":"Search results"),h=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),E=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),T=u(()=>{if(!h.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)});return(y,c)=>(n(),r("div",zo,[e("div",Jo,[e("div",Ko,[e("span",Go,f(g.value),1),e("strong",null,f(w.value)+":",1),l.value?(n(),r("a",{key:0,href:l.value,target:"_blank",class:"web-url"},f(l.value),9,Yo)):o.value?(n(),r("code",Qo,f(o.value),1)):P("",!0)]),a.value?(n(),r("div",Zo,[c[0]||(c[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",Xo,f(a.value),1)])):P("",!0),d.value.length>0?(n(),r("div",en,[e("span",tn,f(p.value)+":",1),(n(!0),r(G,null,Y(d.value,j=>(n(),r("span",{key:j,class:"domain-badge"},f(j),1))),128))])):P("",!0)]),h.value?(n(),r("div",sn,[E.value?(n(),r("div",on,[c[1]||(c[1]=e("strong",null,"Error:",-1)),e("pre",nn,f(T.value),1)])):(n(),r("div",ln,[e("div",an,[e("span",rn,f(_.value)+":",1)]),e("div",dn,[e("pre",un,f(T.value),1)])]))])):P("",!0)]))}},Ie=q(cn,[["__scopeId","data-v-49e16a90"]]),mn={class:"task-tool-handler"},pn={class:"tool-section mb-3"},vn={class:"task-header"},fn={key:0,class:"agent-type-badge"},gn={key:0,class:"task-description"},_n={class:"description-content"},bn={key:1,class:"task-prompt-container"},hn={class:"prompt-header"},yn={class:"prompt-length"},$n={class:"prompt-code"},wn={key:0,class:"tool-section"},Sn={key:0,class:"tool-result tool-result-error"},kn={class:"tool-code"},Cn={key:1,class:"agent-output"},xn={class:"output-header"},jn={key:0,class:"output-count-badge"},Mn={class:"output-content"},Tn={class:"tool-code"},En={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.description||null),l=u(()=>t.toolCall.input?.prompt||null),o=u(()=>t.toolCall.input?.subagent_type||null),a=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),m=u(()=>{if(!a.value)return"";const p=t.toolCall.result;return p.content!==void 0?typeof p.content=="string"?p.content:JSON.stringify(p.content,null,2):p.message?p.message:JSON.stringify(p,null,2)}),d=u(()=>m.value?m.value.split(`
`).length:0);return(p,g)=>(n(),r("div",mn,[e("div",pn,[e("div",vn,[g[0]||(g[0]=e("span",{class:"task-icon"},"🤖",-1)),g[1]||(g[1]=e("strong",null,"Agent Task:",-1)),o.value?(n(),r("span",fn,f(o.value),1)):P("",!0)]),i.value?(n(),r("div",gn,[g[2]||(g[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",_n,f(i.value),1)])):P("",!0),l.value?(n(),r("div",bn,[e("div",hn,[g[3]||(g[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",yn,f(l.value.length)+" characters",1)]),e("pre",$n,f(l.value),1)])):P("",!0)]),a.value?(n(),r("div",wn,[v.value?(n(),r("div",Sn,[g[4]||(g[4]=e("strong",null,"Error:",-1)),e("pre",kn,f(m.value),1)])):(n(),r("div",Cn,[e("div",xn,[g[5]||(g[5]=e("span",{class:"output-label"},"Agent Output:",-1)),d.value>0?(n(),r("span",jn,f(d.value)+" lines",1)):P("",!0)]),e("div",Mn,[e("pre",Tn,f(m.value),1)])]))])):P("",!0)]))}},In=q(En,[["__scopeId","data-v-513043f9"]]),Pn={class:"notebook-edit-tool-handler"},Ln={class:"tool-section mb-3"},Dn={class:"notebook-info"},On={class:"file-path"},Nn={class:"cell-info mt-2"},An={class:"info-row"},qn={class:"info-row"},Rn={key:0,class:"info-row"},Un={class:"badge bg-info"},Hn={key:0,class:"source-preview mt-3"},Wn={class:"preview-header"},Fn={class:"preview-stats"},Bn={class:"source-code"},Vn={key:0,class:"tool-section"},zn={key:0},Jn={key:1,class:"text-danger"},Kn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.notebook_path||"Unknown"),l=u(()=>t.toolCall.input?.cell_id),o=u(()=>t.toolCall.input?.cell_type||"code"),a=u(()=>t.toolCall.input?.edit_mode||"replace"),v=u(()=>t.toolCall.input?.new_source||""),m=u(()=>v.value.split(`
`).length),d=u(()=>o.value==="code"?"bg-primary":"bg-secondary"),p=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),g=u(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const w=a.value;return w==="insert"?"Cell inserted successfully":w==="delete"?"Cell deleted successfully":"Cell updated successfully"});return(w,_)=>(n(),r("div",Pn,[e("div",Ln,[e("div",Dn,[_[0]||(_[0]=e("span",{class:"notebook-icon"},"📓",-1)),_[1]||(_[1]=e("strong",null,"Notebook:",-1)),e("code",On,f(i.value),1)]),e("div",Nn,[e("div",An,[_[2]||(_[2]=e("strong",null,"Cell ID:",-1)),e("code",null,f(l.value||"N/A"),1)]),e("div",qn,[_[3]||(_[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:W(["badge",d.value])},f(o.value),3)]),a.value?(n(),r("div",Rn,[_[4]||(_[4]=e("strong",null,"Edit Mode:",-1)),e("span",Un,f(a.value),1)])):P("",!0)]),v.value?(n(),r("div",Hn,[e("div",Wn,[_[5]||(_[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",Fn,f(m.value)+" lines",1)]),e("pre",Bn,[e("code",null,f(v.value),1)])])):P("",!0)]),s.toolCall.result?(n(),r("div",Vn,[_[8]||(_[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:W(["tool-result",p.value])},[s.toolCall.result.success!==!1?(n(),r("div",zn,[_[6]||(_[6]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+f(g.value),1)])):(n(),r("div",Jn,[_[7]||(_[7]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Operation failed"),1)]))],2)])):P("",!0)]))}},Gn=q(Kn,[["__scopeId","data-v-3261abc1"]]),Yn={class:"shell-tool-handler"},Qn={class:"tool-section mb-3"},Zn={class:"shell-info"},Xn={class:"shell-icon"},el={key:0,class:"shell-id"},tl={key:0,class:"filter-info mt-2"},sl={class:"filter-pattern"},ol={key:0,class:"tool-section"},nl={class:"result-header mb-2"},ll={key:0,class:"shell-output"},al={key:0},rl={key:1,class:"text-danger"},il={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.name==="BashOutput"?"📤":t.toolCall.name==="KillShell"?"🛑":"🐚"),l=u(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),o=u(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),a=u(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),v=u(()=>t.toolCall.input?.filter),m=u(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),d=u(()=>t.toolCall.result?.status),p=u(()=>{const _=d.value;return _==="running"?"bg-success":_==="completed"?"bg-secondary":_==="killed"||_==="terminated"?"bg-danger":"bg-info"}),g=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),w=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return(_,h)=>(n(),r("div",Yn,[e("div",Qn,[e("div",Zn,[e("span",Xn,f(i.value),1),e("strong",null,f(l.value)+":",1),a.value?(n(),r("code",el,"Shell "+f(a.value),1)):P("",!0)]),s.toolCall.name==="BashOutput"&&v.value?(n(),r("div",tl,[h[0]||(h[0]=e("strong",null,"Filter:",-1)),e("code",sl,f(v.value),1)])):P("",!0)]),s.toolCall.result?(n(),r("div",ol,[e("div",nl,[e("strong",null,f(o.value)+":",1),d.value?(n(),r("span",{key:0,class:W(["badge",p.value])},f(d.value),3)):P("",!0)]),m.value?(n(),r("div",ll,[e("pre",null,[e("code",null,f(m.value),1)])])):(n(),r("div",{key:1,class:W(["tool-result",g.value])},[s.toolCall.result.success!==!1?(n(),r("div",al,[h[1]||(h[1]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+f(w.value),1)])):(n(),r("div",rl,[h[2]||(h[2]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Operation failed"),1)]))],2))])):P("",!0)]))}},Pe=q(il,[["__scopeId","data-v-fc9da4c0"]]),dl={class:"command-tool-handler"},ul={class:"tool-section mb-3"},cl={class:"command-info"},ml={class:"command-icon"},pl={class:"command-code"},vl={key:0,class:"prompt-info mt-2"},fl={class:"prompt-content"},gl={key:0,class:"tool-section"},_l={key:0},bl={key:1,class:"text-danger"},hl={__name:"CommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.name==="SlashCommand"?"/":t.toolCall.name==="Skill"?"⚡":"🔧"),l=u(()=>t.toolCall.name==="SlashCommand"?"Slash Command":t.toolCall.name==="Skill"?"Skill":"Command"),o=u(()=>t.toolCall.input?.command||"Unknown"),a=u(()=>t.toolCall.result?.prompt||t.toolCall.result?.description),v=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),m=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="SlashCommand"?"Slash command executed successfully":t.toolCall.name==="Skill"?"Skill executed successfully":"Command completed");return(d,p)=>(n(),r("div",dl,[e("div",ul,[e("div",cl,[e("span",ml,f(i.value),1),e("strong",null,f(l.value)+":",1),e("code",pl,f(o.value),1)]),a.value?(n(),r("div",vl,[p[0]||(p[0]=e("div",{class:"prompt-header"},[e("strong",null,"Expanded Prompt:")],-1)),e("div",fl,f(a.value),1)])):P("",!0)]),s.toolCall.result?(n(),r("div",gl,[p[3]||(p[3]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:W(["tool-result",v.value])},[s.toolCall.result.success!==!1?(n(),r("div",_l,[p[1]||(p[1]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+f(m.value),1)])):(n(),r("div",bl,[p[2]||(p[2]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Command execution failed"),1)]))],2)])):P("",!0)]))}},Le=q(hl,[["__scopeId","data-v-57a8f93b"]]),yl={class:"exit-plan-mode-tool-handler"},$l={class:"tool-section mb-3"},wl={key:0,class:"plan-content mt-2"},Sl={class:"plan-text"},kl={key:0,class:"tool-section"},Cl={key:0},xl={key:1,class:"text-danger"},jl={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.plan),l=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(o,a)=>(n(),r("div",yl,[e("div",$l,[a[1]||(a[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"📋"),e("strong",null,"Exiting Plan Mode")],-1)),i.value?(n(),r("div",wl,[a[0]||(a[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",Sl,f(i.value),1)])):P("",!0)]),s.toolCall.result?(n(),r("div",kl,[a[4]||(a[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:W(["tool-result",l.value])},[s.toolCall.result.success!==!1?(n(),r("div",Cl,[...a[2]||(a[2]=[e("i",{class:"bi bi-check-circle"},null,-1),H(" Permission mode reverted to default ",-1)])])):(n(),r("div",xl,[a[3]||(a[3]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):P("",!0)]))}},Ml=q(jl,[["__scopeId","data-v-f1d32203"]]),Tl={class:"d-flex align-items-center gap-2 flex-grow-1"},El={class:"tool-status-icon"},Il={class:"tool-name"},Pl={class:"text-muted small"},Ll={class:"d-flex align-items-center gap-2"},Dl={class:"text-muted"},Ol={key:0,class:"card-body"},Nl={key:0,class:"alert alert-warning mb-3"},Al={class:"d-flex align-items-center"},ql={class:"mb-0 small"},Rl={key:1,class:"permission-prompt mt-3"},Ul={class:"alert alert-warning mb-3"},Hl={class:"mb-0"},Wl={class:"tool-name"},Fl={key:0,class:"suggestions-section mb-3"},Bl={class:"alert alert-info mb-0"},Vl={class:"suggestion-details p-2 bg-white rounded"},zl={class:"permission-buttons d-flex gap-2 mb-3"},Jl=["disabled"],Kl=["disabled"],Gl=["disabled"],Yl={class:"guidance-section mt-3"},Ql=["disabled"],Zl=["disabled"],Xl={key:2,class:"mt-3"},ea={class:"alert alert-warning mb-0"},ta={class:"d-flex align-items-center"},sa={class:"mb-0 small"},oa={key:3,class:"tool-section mt-3"},na={class:"alert alert-danger mb-0"},la={key:0},aa={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=ue(),l=F(),o=ce(),a=I(!1),v=I(null),m=I(""),d=u(()=>i.isToolUseOrphaned(l.currentSessionId,t.toolCall.id)),p=u(()=>i.getOrphanedInfo(l.currentSessionId,t.toolCall.id)),g={Read:ds,Write:xs,Bash:Rs,TodoWrite:so,Edit:Co,Grep:Ee,Glob:Ee,WebFetch:Ie,WebSearch:Ie,Task:In,NotebookEdit:Gn,BashOutput:Pe,KillShell:Pe,SlashCommand:Le,Skill:Le,ExitPlanMode:Ml},w=u(()=>{const k=t.toolCall.name;return g[k]?g[k]:Jt}),_=u(()=>{const k=[];switch(t.toolCall.status){case"pending":k.push("border-secondary");break;case"permission_required":k.push("border-warning");break;case"executing":k.push("border-primary");break;case"completed":y.value||t.toolCall.permissionDecision==="deny"?k.push("border-danger"):k.push("border-success");break;case"error":k.push("border-danger");break}return k.join(" ")}),h=u(()=>{switch(t.toolCall.status){case"pending":return"🔄";case"permission_required":return"❓";case"executing":return"⚡";case"completed":return t.toolCall.permissionDecision==="deny"?"❌":y.value?"💥":"✅";case"error":return"💥";default:return"🔧"}}),E=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Executing...";case"completed":return t.toolCall.permissionDecision==="deny"?"Denied":y.value?"Error":"Completed";case"error":return"Error";default:return"Unknown"}}),T=u(()=>ge(t.toolCall.timestamp)),y=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),c=u(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function j(){const k=l.currentSessionId;k&&i.toggleToolExpansion(k,t.toolCall.id)}function b(k){return k.type==="setMode"?`Set permission mode to "${k.mode}"`:k.type==="allow"?`Allow tool: ${k.tool}`:JSON.stringify(k)}async function x(k,M,R=null){if(!a.value){a.value=!0,k==="allow"?v.value=M?"approve-apply":"approve":R?v.value="deny-guidance":v.value="deny";try{const N=l.currentSessionId;if(N){const C=M&&t.toolCall.suggestions?t.toolCall.suggestions:[];i.handlePermissionResponse(N,{request_id:t.toolCall.permissionRequestId,decision:k,reasoning:k==="allow"?"User allowed permission":"User denied permission",applied_updates:C})}await o.sendPermissionResponse(t.toolCall.permissionRequestId,k,M,R)}catch(N){console.error("Failed to send permission response:",N)}finally{a.value=!1,v.value=null}}}return(k,M)=>(n(),r("div",{class:W(["tool-call-card card mb-3",_.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:j},[e("div",Tl,[e("span",El,f(h.value),1),e("strong",Il,f(s.toolCall.name),1),e("span",Pl,f(E.value),1)]),e("div",Ll,[e("small",Dl,f(T.value),1),e("i",{class:W(["bi",s.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),s.toolCall.isExpanded?(n(),r("div",Ol,[d.value?(n(),r("div",Nl,[e("div",Al,[M[6]||(M[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[M[5]||(M[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",ql,f(p.value?.message||"Session was terminated"),1)])])])):P("",!0),(n(),le(Oe(w.value),{toolCall:s.toolCall},null,8,["toolCall"])),s.toolCall.status==="permission_required"&&!d.value?(n(),r("div",Rl,[e("div",Ul,[M[9]||(M[9]=e("p",{class:"mb-2"},[e("strong",null,"🔐 Permission Required")],-1)),e("p",Hl,[M[7]||(M[7]=H("Claude wants to use the ",-1)),e("code",Wl,f(s.toolCall.name),1),M[8]||(M[8]=H(" tool.",-1))])]),c.value?(n(),r("div",Fl,[e("div",Bl,[M[10]||(M[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),H(" Suggested Permission Update ")],-1)),M[11]||(M[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",Vl,[(n(!0),r(G,null,Y(s.toolCall.suggestions,(R,N)=>(n(),r("div",{key:N,class:"suggestion-item"},[e("code",null,f(b(R)),1)]))),128))]),M[12]||(M[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):P("",!0),e("div",zl,[c.value?(n(),r("button",{key:0,class:"btn btn-success",onClick:M[0]||(M[0]=R=>x("allow",!0)),disabled:a.value},[M[13]||(M[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),H(" "+f(a.value&&v.value==="approve-apply"?"⏳ Submitting...":"✅ Approve & Apply"),1)],8,Jl)):P("",!0),e("button",{class:W(["btn",c.value?"btn-outline-success":"btn-success"]),onClick:M[1]||(M[1]=R=>x("allow",!1)),disabled:a.value},[M[14]||(M[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),H(" "+f(a.value&&v.value==="approve"?"⏳ Submitting...":c.value?"✅ Approve Only":"✅ Approve"),1)],10,Kl),e("button",{class:"btn btn-danger",onClick:M[2]||(M[2]=R=>x("deny",!1)),disabled:a.value},[M[15]||(M[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),H(" "+f(a.value&&v.value==="deny"?"⏳ Submitting...":"❌ Deny"),1)],8,Gl)]),e("div",Yl,[M[17]||(M[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),H(" Provide Guidance (Optional) ")],-1)),M[18]||(M[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),J(e("textarea",{"onUpdate:modelValue":M[3]||(M[3]=R=>m.value=R),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:a.value},null,8,Ql),[[X,m.value]]),m.value.trim()?(n(),r("button",{key:0,class:"btn btn-warning btn-sm",onClick:M[4]||(M[4]=R=>x("deny",!1,m.value)),disabled:a.value},[M[16]||(M[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),H(" "+f(a.value&&v.value==="deny-guidance"?"⏳ Submitting...":"💡 Provide Guidance & Continue"),1)],8,Zl)):P("",!0)])])):P("",!0),s.toolCall.status==="permission_required"&&d.value?(n(),r("div",Xl,[e("div",ea,[e("div",ta,[M[20]||(M[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[M[19]||(M[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",sa,f(p.value?.message||"Session was terminated before permission could be granted"),1)])])])])):P("",!0),s.toolCall.permissionDecision==="deny"?(n(),r("div",oa,[e("div",na,[M[21]||(M[21]=e("i",{class:"bi bi-x-circle"},null,-1)),M[22]||(M[22]=H(" Permission denied ",-1)),s.toolCall.result?.message?(n(),r("span",la," - "+f(s.toolCall.result.message),1)):P("",!0)])])):P("",!0)])):P("",!0)],2))}},ra=q(aa,[["__scopeId","data-v-194786d1"]]),ia={class:"card assistant-message bg-white border-start border-success border-3"},da={class:"card-body"},ua={class:"d-flex justify-content-between align-items-center mb-2"},ca={class:"d-flex align-items-center gap-2"},ma={key:0,class:"text-muted"},pa={class:"text-muted"},va={key:0,class:"thinking-block mb-3"},fa=["innerHTML"],ga={key:2,class:"tool-calls mt-3"},_a={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,i=ue(),l=F();pe.setOptions({breaks:!0,gfm:!0});const o=u(()=>ge(t.message.timestamp)),a=u(()=>t.message.metadata?.model||null),v=u(()=>{const h=t.message.content||"";return h.trim().length>0&&h!=="Assistant response"}),m=u(()=>{const h=t.message.content||"",E=pe.parse(h);return we.sanitize(E)}),d=u(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),p=u(()=>t.message.metadata?.thinking_content||""),g=u(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),w=u(()=>t.message.metadata?.tool_uses||[]),_=u(()=>{const h=l.currentSessionId;if(!h)return[];const E=i.toolCallsBySession.get(h)||[];return w.value.map(T=>{const y=E.find(c=>c.id===T.id);return y||{id:T.id,name:T.name,input:T.input,status:"pending",result:null,timestamp:T.timestamp||t.message.timestamp,isExpanded:!0}})});return(h,E)=>(n(),r("div",ia,[e("div",da,[e("div",ua,[e("div",ca,[E[0]||(E[0]=e("span",{class:"message-icon"},"🤖",-1)),E[1]||(E[1]=e("strong",{class:"message-role"},"Assistant",-1)),a.value?(n(),r("small",ma,f(a.value),1)):P("",!0)]),e("small",pa,f(o.value),1)]),d.value?(n(),r("div",va,[z(At,{thinking:p.value},null,8,["thinking"])])):P("",!0),v.value?(n(),r("div",{key:1,class:"message-content",innerHTML:m.value},null,8,fa)):P("",!0),g.value?(n(),r("div",ga,[(n(!0),r(G,null,Y(_.value,T=>(n(),le(ra,{key:T.id,toolCall:T},null,8,["toolCall"]))),128))])):P("",!0)])]))}},ba=q(_a,[["__scopeId","data-v-25a87a40"]]),ha={class:"card system-message bg-info bg-opacity-10 border-info"},ya={class:"card-body py-2 px-3"},$a={class:"d-flex align-items-center gap-2"},wa={class:"text-muted flex-grow-1"},Sa={class:"text-muted"},ka={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>ge(t.message.timestamp));return(l,o)=>(n(),r("div",ha,[e("div",ya,[e("div",$a,[o[0]||(o[0]=e("i",{class:"bi bi-info-circle text-info"},null,-1)),e("small",wa,f(s.message.content),1),e("small",Sa,f(i.value),1)])])]))}},De=q(ka,[["__scopeId","data-v-bba7a395"]]),Ca={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>{switch(t.message.type){case"user":return It;case"assistant":return ba;case"system":return De;default:return De}});return(l,o)=>(n(),r("div",{class:W(["message-item mb-3",`message-${s.message.type}`])},[(n(),le(Oe(i.value),{message:s.message},null,8,["message"]))],2))}},xa=q(Ca,[["__scopeId","data-v-fbd275ac"]]),ja={key:0,class:"text-muted text-center py-5"},Ma={__name:"MessageList",setup(s){const t=ue(),i=Z(),l=I(null),o=u(()=>t.currentMessages.filter(d=>v(d)));u(()=>t.currentToolCalls);async function a(){i.autoScrollEnabled&&(await ye(),l.value&&(l.value.scrollTop=l.value.scrollHeight))}Q(()=>t.currentMessages.length,a),Q(()=>t.currentToolCalls.length,a),Q(()=>t.currentToolCalls.map(d=>`${d.id}-${d.status}`).join(","),a),oe(()=>{setTimeout(()=>{a()},100)});function v(d){const p=d.subtype||d.metadata?.subtype;if(d.type==="system"&&p==="init"||d.type==="result"||d.type==="permission_request"||d.type==="permission_response")return!1;if(d.type==="user"&&d.metadata?.has_tool_results){const g=d.content||"";if(g.match(/^Tool results?: \d+ results?$/i)||g.trim()==="")return!1}return!0}function m(d){return{type:d.type||"unknown",content:d.content||"",timestamp:d.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...d.metadata}}}return(d,p)=>(n(),r("div",{class:"messages-area flex-grow-1 overflow-auto p-3",ref_key:"messagesArea",ref:l},[o.value.length===0?(n(),r("div",ja," No messages yet. Start a conversation! ")):P("",!0),(n(!0),r(G,null,Y(o.value,(g,w)=>(n(),le(xa,{key:`msg-${g.timestamp}-${w}`,message:m(g)},null,8,["message"]))),128))],512))}},Ta=q(Ma,[["__scopeId","data-v-1884c681"]]),Ea={class:"border-top bg-light"},Ia={class:"d-flex gap-2 align-items-end px-2 py-1"},Pa=["placeholder","disabled","onKeydown"],La=["disabled"],Da={__name:"InputArea",setup(s){const t=F(),i=ce(),l=I(null),o=u({get:()=>t.currentInput,set:_=>{t.currentInput=_}}),a=u(()=>t.currentSession?.is_processing||!1),v=u(()=>i.sessionConnected),m=u(()=>t.currentSession?.state==="starting"),d=u(()=>m.value?"Session is starting...":v.value?"Type your message to Claude Code...":"Waiting for connection...");function p(){const _=l.value;if(!_)return;_.style.height="auto";const h=Math.min(_.scrollHeight,parseInt(getComputedStyle(_).maxHeight));_.style.height=h+"px"}function g(){o.value.trim()&&(i.sendMessage(o.value),o.value="",l.value&&(l.value.style.height="auto"))}function w(){i.interruptSession()}return(_,h)=>(n(),r("div",Ea,[e("div",Ia,[J(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:l,"onUpdate:modelValue":h[0]||(h[0]=E=>o.value=E),class:"form-control",placeholder:d.value,disabled:m.value,rows:"1",onInput:p,onKeydown:Ne(ae(g,["exact","prevent"]),["enter"])},null,40,Pa),[[X,o.value]]),a.value?(n(),r("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:w}," Stop ")):(n(),r("button",{key:1,class:"btn btn-primary",disabled:!o.value.trim()||!v.value||m.value,onClick:g}," Send ",8,La))])]))}},Oa=q(Da,[["__scopeId","data-v-7f0abd95"]]),Na={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},Aa={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},qa={class:"text-secondary"},Ra={class:"d-flex flex-column flex-grow-1 overflow-hidden"},qe={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,i=F(),l=Z(),o=u(()=>i.currentSession),a=u(()=>l.isLoading),v=u(()=>l.loadingMessage);return oe(async()=>{if(t.sessionId!==i.currentSessionId){l.showLoading("Loading session...");try{await i.selectSession(t.sessionId)}finally{l.hideLoading()}}}),Q(()=>t.sessionId,async(m,d)=>{if(m!==d&&m!==i.currentSessionId){l.showLoading("Loading session...");try{await i.selectSession(m)}finally{l.hideLoading()}}}),ne(()=>{}),(m,d)=>(n(),r("div",Na,[a.value?(n(),r("div",Aa,[d[0]||(d[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",qa,f(v.value),1)])):P("",!0),o.value?(n(),le(st,{key:1,"session-id":t.sessionId},null,8,["session-id"])):P("",!0),e("div",Ra,[z(Ta)]),z(Oa),o.value?(n(),le(rt,{key:2,"session-id":t.sessionId},null,8,["session-id"])):P("",!0),o.value?(n(),le(gt,{key:3,"session-id":t.sessionId},null,8,["session-id"])):P("",!0)]))}},Se=me("legion",()=>{const s=I(new Map),t=I(new Map),i=I(new Map),l=I(new Map),o=I(null),a=u(()=>s.value.get(o.value)||[]),v=u(()=>t.value.get(o.value)||[]),m=u(()=>i.value.get(o.value)||[]),d=u(()=>l.value.get(o.value)||[]);function p(j){o.value=j}async function g(j,b=100,x=0){try{const k=await B.get(`/api/legions/${j}/timeline?limit=${b}&offset=${x}`),M=k.comms||[],R=k.total_count||M.length,N=k.has_more||!1;return M.sort((C,S)=>new Date(C.timestamp)-new Date(S.timestamp)),console.log(`Loaded ${M.length} of ${R} comms for legion ${j}`),s.value.set(j,M),s.value=new Map(s.value),{comms:M,totalCount:R,hasMore:N}}catch(k){throw console.error("Failed to load timeline:",k),k}}function w(j,b){s.value.has(j)||s.value.set(j,[]),s.value.get(j).push(b),s.value=new Map(s.value)}async function _(j,b){try{const k=(await B.post(`/api/legions/${j}/comms`,b)).comm;return console.log(`Sent comm ${k.comm_id} to legion ${j}`),k}catch(x){throw console.error("Failed to send comm:",x),x}}async function h(j){return console.log(`Minions for legion ${j} are already available in session store`),[]}async function E(j,b){try{const k=(await B.post(`/api/legions/${j}/minions`,b)).minion;return await h(j),console.log(`Created minion ${k.minion_id} in legion ${j}`),k}catch(x){throw console.error("Failed to create minion:",x),x}}async function T(j){try{const x=(await B.get(`/api/legions/${j}/hordes`)).hordes||[];return console.log(`Loaded ${x.length} hordes for legion ${j}`),i.value.set(j,x),i.value=new Map(i.value),x}catch(b){throw console.error("Failed to load hordes:",b),b}}async function y(j){try{const x=(await B.get(`/api/legions/${j}/channels`)).channels||[];return console.log(`Loaded ${x.length} channels for legion ${j}`),l.value.set(j,x),l.value=new Map(l.value),x}catch(b){throw console.error("Failed to load channels:",b),b}}function c(j){s.value.delete(j),t.value.delete(j),i.value.delete(j),l.value.delete(j),s.value=new Map(s.value),t.value=new Map(t.value),i.value=new Map(i.value),l.value=new Map(l.value)}return{commsByLegion:s,minionsByLegion:t,hordesByLegion:i,channelsByLegion:l,currentLegionId:o,currentComms:a,currentMinions:v,currentHordes:m,currentChannels:d,setCurrentLegion:p,loadTimeline:g,addComm:w,sendComm:_,loadMinions:h,createMinion:E,loadHordes:T,loadChannels:y,clearLegionData:c}}),Ua=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:Se},Symbol.toStringTag,{value:"Module"})),Ha={class:"timeline-header border-bottom p-3"},Wa={class:"project-name"},Fa=["title"],Ba={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(s){const t=s,i=ee(),l=u(()=>i.projects.get(t.legionId)),o=u(()=>l.value?.name||"Legion");return(a,v)=>(n(),r("div",Ha,[e("div",null,[e("div",Wa,f(o.value),1),e("div",{class:"view-name",title:s.legionId},"Timeline",8,Fa)])]))}},Va=q(Ba,[["__scopeId","data-v-44f386f5"]]),za={class:"timeline-status-bar border-top p-2 bg-light"},Ja={class:"d-flex justify-content-end"},Ka={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(s){const t=Z();function i(){t.setAutoScroll(!t.autoScrollEnabled)}return(l,o)=>(n(),r("div",za,[e("div",Ja,[e("button",{class:W(["btn btn-sm",fe(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:i}," ⬇️ "+f(fe(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},Ga=q(Ka,[["__scopeId","data-v-891c73db"]]),Ya={class:"comm-composer border-top p-3"},Qa={class:"d-flex gap-2 mb-2"},Za={class:"flex-grow-1"},Xa=["disabled"],er={label:"Minions"},tr=["value"],sr={key:0,label:"Channels"},or=["value"],nr={style:{"min-width":"150px"}},lr=["disabled"],ar={class:"d-flex gap-2 align-items-end position-relative"},rr={class:"flex-grow-1 position-relative"},ir=["disabled"],dr=["onClick","onMouseenter"],ur=["disabled"],cr={key:0},mr={key:1},pr={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(s){const t=s,i=Se(),l=F(),o=ee(),a=I(""),v=I("task"),m=I(""),d=I(!1),p=I(!1),g=I([]),w=I(0),_=I(-1),h=I(null),E=I(null),T=u(()=>{const S=o.projects.get(t.legionId);return!S||!S.session_ids?[]:S.session_ids.map(L=>l.sessions.get(L)).filter(L=>L&&L.is_minion)}),y=u(()=>i.currentChannels||[]),c=u(()=>a.value&&m.value.trim().length>0);function j(S){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[S.state]||"○"}function b(S){return S.is_minion&&S.role?`${S.name} (${S.role})`:S.name}function x(){const S=h.value;if(!S)return;S.style.height="auto";const L=Math.min(S.scrollHeight,parseInt(getComputedStyle(S).maxHeight));S.style.height=L+"px"}function k(){const S=h.value;if(!S)return;x();const L=m.value,$=S.selectionStart,D=L.substring(0,$),O=D.lastIndexOf("#");if(O===-1){p.value=!1;return}const A=D.substring(O+1).toLowerCase();if(A.includes(" ")){p.value=!1;return}const U=T.value.filter(K=>K.name.toLowerCase().includes(A)).map(K=>({type:"minion",name:K.name,role:K.role,id:K.session_id,state:K.state}));if(U.length===0){p.value=!1;return}g.value=U,w.value=0,_.value=O,p.value=!0}function M(){if(!E.value)return;const S=E.value,L=S.children[w.value];if(!L)return;const $=L.offsetTop,D=L.offsetHeight,O=S.scrollTop,A=S.clientHeight;$<O?S.scrollTop=$:$+D>O+A&&(S.scrollTop=$+D-A)}function R(S){if(!p.value){S.key==="Enter"&&!S.shiftKey&&c.value&&(S.preventDefault(),C());return}if(S.key==="ArrowDown")S.preventDefault(),w.value=(w.value+1)%g.value.length,M();else if(S.key==="ArrowUp")S.preventDefault(),w.value=w.value===0?g.value.length-1:w.value-1,M();else if(S.key==="Enter"){S.preventDefault();const L=g.value[w.value];L&&N(L)}else S.key==="Escape"&&(p.value=!1)}function N(S){const L=h.value;if(!L)return;const $=m.value,D=L.selectionStart,O=$.substring(0,_.value)+"#"+S.name+" "+$.substring(D);m.value=O;const A=_.value+S.name.length+2;setTimeout(()=>{L.setSelectionRange(A,A),L.focus()},0),p.value=!1}async function C(){if(!(!c.value||d.value)){d.value=!0;try{const[S,L]=a.value.split(":"),$={comm_type:v.value,content:m.value.trim()};S==="minion"?$.to_minion_id=L:S==="channel"&&($.to_channel_id=L),await i.sendComm(t.legionId,$),m.value="",x()}catch(S){console.error("Failed to send comm:",S),alert(`Failed to send comm: ${S.message}`)}finally{d.value=!1}}}return Q(p,S=>{if(S){const L=$=>{$.target.closest(".comm-composer")||(p.value=!1,document.removeEventListener("click",L))};setTimeout(()=>document.addEventListener("click",L),0)}}),(S,L)=>(n(),r("div",Ya,[e("div",Qa,[e("div",Za,[J(e("select",{"onUpdate:modelValue":L[0]||(L[0]=$=>a.value=$),class:"form-select form-select-sm",disabled:d.value},[L[3]||(L[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",er,[(n(!0),r(G,null,Y(T.value,$=>(n(),r("option",{key:$.session_id,value:`minion:${$.session_id}`},f(j($))+" "+f(b($)),9,tr))),128))]),y.value.length>0?(n(),r("optgroup",sr,[(n(!0),r(G,null,Y(y.value,$=>(n(),r("option",{key:$.channel_id,value:`channel:${$.channel_id}`}," #️⃣ "+f($.name),9,or))),128))])):P("",!0)],8,Xa),[[de,a.value]])]),e("div",nr,[J(e("select",{"onUpdate:modelValue":L[1]||(L[1]=$=>v.value=$),class:"form-select form-select-sm",disabled:d.value},[...L[4]||(L[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,lr),[[de,v.value]])])]),e("div",ar,[e("div",rr,[J(e("textarea",{ref_key:"contentTextarea",ref:h,"onUpdate:modelValue":L[2]||(L[2]=$=>m.value=$),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:d.value,onInput:k,onKeydown:R},null,40,ir),[[X,m.value]]),p.value?(n(),r("div",{key:0,ref_key:"autocompleteDropdown",ref:E,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(n(!0),r(G,null,Y(g.value,($,D)=>(n(),r("div",{key:$.id,class:W(["autocomplete-item px-2 py-1",{"bg-light":D===w.value}]),onClick:O=>N($),onMouseenter:O=>w.value=D},f($.type==="minion"?j($):"#️⃣")+" "+f($.name)+f($.role?` (${$.role})`:""),43,dr))),128))],512)):P("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!c.value||d.value,onClick:C},[d.value?(n(),r("span",cr,[...L[5]||(L[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),H(" Sending... ",-1)])])):(n(),r("span",mr,"Send"))],8,ur)])])]))}},vr=q(pr,[["__scopeId","data-v-ffa54193"]]),fr={class:"timeline-view d-flex flex-column h-100"},gr={key:0,class:"text-center text-muted"},_r={key:1,class:"text-center text-danger"},br={key:2,class:"text-center text-muted"},hr={key:3,class:"comm-list"},yr={class:"col-auto message-speaker text-end pe-3"},$r={class:"text-muted"},wr={class:"col message-content-column"},Sr={class:"comm-card card"},kr={class:"card-body p-2"},Cr={class:"d-flex justify-content-between align-items-start mb-1"},xr={class:"ms-2"},jr={class:"comm-content"},Mr={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(s){const t=s,i=Se(),l=ee(),o=F(),a=ce(),v=Z(),m=I(!0),d=I(null),p=I(null),g=u(()=>l.projects.get(t.legionId));u(()=>g.value?.name||"Legion");const w=u(()=>i.currentComms);u(()=>i.currentMinions);function _(x){return x.from_user?"You":x.from_minion_id&&o.sessions.get(x.from_minion_id)?.name||"Unknown"}function h(x){return x.to_user?"You":x.to_minion_id?o.sessions.get(x.to_minion_id)?.name||"Unknown":x.to_channel_id?`#${x.to_channel_id}`:"All"}function E(x){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[x]||"bg-secondary"}function T(x){return new Date(x).toLocaleTimeString()}async function y(){v.autoScrollEnabled&&(await ye(),p.value&&(p.value.scrollTop=p.value.scrollHeight))}async function c(){m.value=!0,d.value=null;try{i.setCurrentLegion(t.legionId),await Promise.all([i.loadTimeline(t.legionId),i.loadMinions(t.legionId)]),await ye(),await y(),setTimeout(()=>{y()},100)}catch(x){console.error("Failed to load timeline:",x),x.response?d.value=`${x.message} (${x.response.status})`:d.value=x.message||"Unknown error"}finally{m.value=!1}}function j(){a.connectLegion(t.legionId)}function b(){a.disconnectLegion()}return Q(()=>w.value.length,()=>{y()}),oe(()=>{c(),j(),setTimeout(()=>{y()},100)}),ne(()=>{b()}),(x,k)=>(n(),r("div",fr,[z(Va,{"legion-id":s.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:p,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[m.value?(n(),r("div",gr,[...k[0]||(k[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),H(" Loading timeline... ",-1)])])):d.value?(n(),r("div",_r," Failed to load timeline: "+f(d.value),1)):w.value.length===0?(n(),r("div",br," No messages yet. Minions will appear here once they start communicating. ")):(n(),r("div",hr,[(n(!0),r(G,null,Y(w.value,M=>(n(),r("div",{key:M.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",yr,[e("small",$r,f(T(M.timestamp)),1)]),e("div",wr,[e("div",Sr,[e("div",kr,[e("div",Cr,[e("div",null,[e("span",{class:W(["badge",E(M.comm_type)])},f(M.comm_type),3),e("strong",xr,f(_(M)),1),k[1]||(k[1]=e("span",{class:"text-muted mx-1"},"→",-1)),e("strong",null,f(h(M)),1)])]),e("div",jr,f(M.content),1)])])])]))),128))]))],512),z(vr,{"legion-id":s.legionId},null,8,["legion-id"]),z(Ga,{"legion-id":s.legionId},null,8,["legion-id"])]))}},Tr=q(Mr,[["__scopeId","data-v-d4c7422e"]]),Er={class:"spy-view d-flex flex-column overflow-hidden"},Ir={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(s){return(t,i)=>(n(),r("div",Er,[z(qe,{"session-id":s.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},Pr=q(Ir,[["__scopeId","data-v-43a24eaf"]]),Lr={class:"horde-header border-bottom p-3"},Dr={class:"project-name"},Or=["title"],Nr={__name:"HordeHeader",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,i=ee(),l=F(),o=u(()=>i.projects.get(t.legionId)),a=u(()=>o.value?.name||"Legion"),v=u(()=>l.sessions.get(t.overseerId)),m=u(()=>v.value?.name||"Overseer");return(d,p)=>(n(),r("div",Lr,[e("div",null,[e("div",Dr,f(a.value),1),e("div",{class:"view-name",title:s.overseerId},f(m.value)+"'s Horde",9,Or)])]))}},Ar=q(Nr,[["__scopeId","data-v-775da47d"]]),qr={class:"horde-status-bar border-top p-2 bg-light"},Rr={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){return(t,i)=>(n(),r("div",qr,[...i[0]||(i[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},Ur=q(Rr,[["__scopeId","data-v-7f3c847f"]]),Hr={class:"minion-card p-2 border-start border-2 mb-2"},Wr={class:"d-flex align-items-center"},Fr={class:"me-2"},Br={key:0,class:"me-2"},Vr={key:1,class:"text-muted ms-2"},zr={key:2,class:"badge bg-secondary ms-2"},Jr={class:"text-muted small ms-4"},Kr={key:0,class:"minion-children"},Gr={key:1,class:"text-danger small ms-4"},Yr={__name:"MinionTreeNode",props:{minionId:{type:String,required:!0},level:{type:Number,default:0}},setup(s){const t=s,i=F(),l=u(()=>i.sessions.get(t.minionId)),o=u(()=>t.level*24),a=u(()=>{const p=l.value&&l.value.child_minion_ids&&l.value.child_minion_ids.length>0;return l.value&&l.value.child_minion_ids&&l.value.child_minion_ids.length>0&&console.log(`Minion ${l.value.name} has ${l.value.child_minion_ids.length} children:`,l.value.child_minion_ids),p}),v=u(()=>l.value&&l.value.is_overseer&&a.value),m={created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"},d=u(()=>m[l.value?.state]||"○");return(p,g)=>{const w=Ae("MinionTreeNode",!0);return l.value?(n(),r("div",{key:0,class:"minion-tree-node",style:re({marginLeft:`${o.value}px`})},[e("div",Hr,[e("div",Wr,[e("span",Fr,f(d.value),1),v.value?(n(),r("span",Br,"👑")):P("",!0),e("strong",null,f(l.value.name),1),l.value.role?(n(),r("span",Vr,f(l.value.role),1)):P("",!0),v.value?(n(),r("span",zr,f(l.value.child_minion_ids.length)+" "+f(l.value.child_minion_ids.length===1?"child":"children"),1)):P("",!0)]),e("div",Jr," Level "+f(l.value.overseer_level||0)+" • "+f(l.value.state),1)]),a.value?(n(),r("div",Kr,[(n(!0),r(G,null,Y(l.value.child_minion_ids,_=>(n(),le(w,{key:_,"minion-id":_,level:s.level+1},null,8,["minion-id","level"]))),128))])):P("",!0)],4)):t.minionId?(n(),r("div",Gr," ⚠ Minion data not found for ID: "+f(t.minionId),1)):P("",!0)}}},Qr=q(Yr,[["__scopeId","data-v-120682eb"]]),Zr={class:"horde-view d-flex flex-column h-100"},Xr={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},ei={key:0,class:"alert alert-danger"},ti={key:1,class:"horde-tree"},si={__name:"HordeView",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,i=F(),l=ee(),o=u(()=>l.projects.get(t.legionId));u(()=>o.value?.name||"Legion");const a=u(()=>i.sessions.get(t.overseerId));return(v,m)=>(n(),r("div",Zr,[z(Ar,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"]),e("div",Xr,[a.value?(n(),r("div",ti,[z(Qr,{"minion-id":s.overseerId,level:0},null,8,["minion-id"])])):(n(),r("div",ei," Overseer not found "))]),z(Ur,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"])]))}},oi=q(si,[["__scopeId","data-v-b928719b"]]),ni=[{path:"/",name:"home",component:Ve},{path:"/session/:sessionId",name:"session",component:qe,props:!0},{path:"/timeline/:legionId",name:"timeline",component:Tr,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:Pr,props:!0},{path:"/horde/:legionId/:overseerId",name:"horde",component:oi,props:!0}],li=Re({history:Ue(),routes:ni}),ai={__name:"ConnectionIndicator",setup(s){const t=ce(),i=u(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),l=u(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(o,a)=>(n(),r("span",{id:"connection-indicator",class:W(["badge",i.value])},f(l.value),3))}},ri={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},ii={class:"d-flex align-items-center gap-2"},di={__name:"AppHeader",setup(s){const t=Z();function i(){t.toggleSidebar()}return(l,o)=>(n(),r("header",ri,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:i},[...o[0]||(o[0]=[e("span",null,"☰",-1)])]),o[1]||(o[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",ii,[z(ai)])]))}},ui={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},ci={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},mi=["title"],pi={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,i=u(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function l(m){return m.state==="paused"&&m.is_processing?"pending-prompt":m.is_processing?"processing":m.state}function o(m){const d=l(m);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[d]||"#d3d3d3"}function a(m){const d=l(m);return d==="starting"||d==="processing"||d==="pending-prompt"}function v(m){const d=l(m),p=d.charAt(0).toUpperCase()+d.slice(1),g=m.name||"Unnamed Session",w=m.is_minion&&m.role?` (${m.role})`:"";return`${g}${w}: ${p}`}return(m,d)=>(n(),r("div",ui,[!s.sessions||s.sessions.length===0?(n(),r("div",ci)):(n(!0),r(G,{key:1},Y(s.sessions,p=>(n(),r("div",{key:p.session_id,class:W(["progress-bar",{"progress-bar-striped progress-bar-animated":a(p)}]),style:re({width:i.value,backgroundColor:o(p),cursor:"help"}),title:v(p)},null,14,mi))),128))]))}},vi=q(pi,[["__scopeId","data-v-a79cfeec"]]),fi={class:"flex-grow-1"},gi={key:0,class:"text-muted small ms-1"},_i={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(s){const t=s,i=ie(),l=F(),o=ee(),a=Z(),v=u(()=>l.currentSessionId===t.session.session_id),m=u(()=>l.deletingSessions.has(t.session.session_id)),d=u(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),p=u(()=>{const c=d.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[c]||"status-dot-grey"}),g=u(()=>{const c=d.value,j={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},b={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:j[c]||"#d3d3d3",borderColor:b[c]||"#6c757d"}});function w(){l.selectSession(t.session.session_id),i.push(`/session/${t.session.session_id}`)}function _(){a.showModal("edit-session",{session:t.session})}function h(c){c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("application/session-id",t.session.session_id),c.dataTransfer.setData("application/project-id",t.projectId),c.dataTransfer.setData("text/plain",t.session.session_id),c.target.classList.add("dragging")}function E(c){c.target.classList.remove("dragging")}function T(c){c.preventDefault(),c.dataTransfer.dropEffect="move";const j=c.currentTarget.getBoundingClientRect(),b=j.top+j.height/2;c.clientY<b?(c.currentTarget.classList.add("drop-above"),c.currentTarget.classList.remove("drop-below")):(c.currentTarget.classList.add("drop-below"),c.currentTarget.classList.remove("drop-above"))}function y(c){c.preventDefault(),c.currentTarget.classList.remove("drop-above","drop-below");const j=c.dataTransfer.getData("application/session-id")||c.dataTransfer.getData("text/plain"),b=c.dataTransfer.getData("application/project-id");if(!j||j===t.session.session_id||b!==t.projectId)return;const x=c.currentTarget.getBoundingClientRect(),k=x.top+x.height/2,M=c.clientY<k,R=o.getProject(t.projectId);if(!R||!R.session_ids)return;const N=[...R.session_ids],C=N.indexOf(t.session.session_id),S=N.indexOf(j);if(C===-1||S===-1)return;const L=[...N],[$]=L.splice(S,1);let D=M?C:C+1;S<C&&D--,L.splice(D,0,$),o.reorderSessionsInProject(t.projectId,L)}return(c,j)=>(n(),r("div",{class:W(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:v.value,"session-deleting":m.value}]),style:{cursor:"pointer"},draggable:"true",onClick:w,onDragstart:h,onDragend:E,onDragover:T,onDrop:y},[e("div",{class:W(["status-dot me-2",p.value]),style:re(g.value)},null,6),e("div",fi,[e("span",null,f(s.session.name||s.session.session_id),1),s.session.is_minion&&s.session.role?(n(),r("span",gi,"("+f(s.session.role)+")",1)):P("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:ae(_,["stop"])}," ✏️ ")],34))}},bi=q(_i,[["__scopeId","data-v-07ecbf94"]]),hi=["value"],yi={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,i=ie(),l=F(),o=I("");Q(()=>i.currentRoute.value,h=>{!o.value&&h.name==="spy"&&h.params.minionId&&h.params.legionId===t.project.project_id&&(o.value=h.params.minionId)},{immediate:!0});const a=u(()=>o.value?t.sessions.find(h=>h.session_id===o.value):null),v=u(()=>{const h=i.currentRoute.value;return h.name==="spy"&&h.params.legionId===t.project.project_id}),m=u(()=>{if(!a.value)return"";if(a.value.state==="paused"&&a.value.is_processing)return"status-blinking";const h=a.value.is_processing?"processing":a.value.state;return h==="starting"||h==="processing"?"status-blinking":""}),d=u(()=>{if(!a.value)return{};if(a.value.state==="paused"&&a.value.is_processing)return{backgroundColor:"#ffc107"};const h=a.value.is_processing?"processing":a.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[h]||"#d3d3d3"}});function p(h){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[h.state]||"○"}function g(h){return h.is_minion&&h.role?`${h.name} (${h.role})`:h.name}function w(){o.value&&i.push(`/spy/${t.project.project_id}/${o.value}`)}function _(){o.value?i.push(`/spy/${t.project.project_id}/${o.value}`):i.push("/")}return Q(()=>l.currentSessionId,h=>{h&&t.sessions.some(E=>E.session_id===h)&&(o.value=h)}),(h,E)=>(n(),r("div",{class:W(["list-group-item list-group-item-action p-2",{active:v.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:re({cursor:o.value?"pointer":"default"}),onClick:w},[E[1]||(E[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🔍"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),a.value?(n(),r("span",{key:0,class:W(["minion-state-indicator",m.value]),style:re(d.value)}," 👤 ",6)):P("",!0)],4),J(e("select",{"onUpdate:modelValue":E[0]||(E[0]=T=>o.value=T),class:"form-select form-select-sm",onChange:_},[E[2]||(E[2]=e("option",{value:""},"-- Select Minion --",-1)),(n(!0),r(G,null,Y(s.sessions,T=>(n(),r("option",{key:T.session_id,value:T.session_id},f(p(T))+" "+f(g(T)),9,hi))),128))],544),[[de,o.value]])],2))}},$i=q(yi,[["__scopeId","data-v-9632f72c"]]),wi=["value"],Si={__name:"HordeSelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,i=ie(),l=I("");Q(()=>i.currentRoute.value,p=>{!l.value&&p.name==="horde"&&p.params.overseerId&&p.params.legionId===t.project.project_id&&(l.value=p.params.overseerId)},{immediate:!0});const o=u(()=>t.sessions.filter(p=>p.is_overseer===!0)),a=u(()=>{const p=i.currentRoute.value;return p.name==="horde"&&p.params.legionId===t.project.project_id});function v(p){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[p.state]||"○"}function m(){l.value&&i.push(`/horde/${t.project.project_id}/${l.value}`)}function d(){l.value&&i.push(`/horde/${t.project.project_id}/${l.value}`)}return(p,g)=>(n(),r("div",{class:W(["list-group-item list-group-item-action p-2",{active:a.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:re({cursor:l.value?"pointer":"default"}),onClick:m},[...g[1]||(g[1]=[e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🌳"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],4),J(e("select",{"onUpdate:modelValue":g[0]||(g[0]=w=>l.value=w),class:"form-select form-select-sm",onChange:d},[g[2]||(g[2]=e("option",{value:""},"-- Select Overseer --",-1)),(n(!0),r(G,null,Y(o.value,w=>(n(),r("option",{key:w.session_id,value:w.session_id},f(v(w))+" "+f(w.name),9,wi))),128))],544),[[de,l.value]])],2))}},ki=q(Si,[["__scopeId","data-v-ca33279d"]]),Ci=["data-project-id"],xi=["id"],ji=["data-bs-target","aria-expanded","aria-controls"],Mi={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},Ti={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},Ei={class:"fw-semibold",style:{"flex-shrink":"0"}},Ii={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},Pi={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},Li=["title"],Di=["title"],Oi=["id","aria-labelledby"],Ni={class:"accordion-body p-0"},Ai={class:"list-group list-group-flush"},qi={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(s){const t=s,i=ie(),l=ee(),o=F(),a=Z(),v=I(t.project.is_expanded||!1),m=u(()=>l.formatPath(t.project.working_directory)),d=u(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(b=>o.getSession(b)).filter(b=>b!=null)),p=u(()=>{const b=i.currentRoute.value;return b.name==="timeline"&&b.params.legionId===t.project.project_id});function g(){v.value||(l.toggleExpansion(t.project.project_id),v.value=!0)}function w(){if(v.value){l.toggleExpansion(t.project.project_id),v.value=!1;const b=o.currentSessionId;b&&o.getSession(b)&&t.project.session_ids?.includes(b)&&i.push("/"),l.currentProjectId===t.project.project_id&&i.push("/")}}function _(){a.showModal("edit-project",{project:t.project})}function h(){t.project.is_multi_agent?a.showModal("create-minion",{project:t.project}):a.showModal("create-session",{project:t.project})}function E(){i.push(`/timeline/${t.project.project_id}`)}function T(b){b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("application/project-id",t.project.project_id),b.dataTransfer.setData("text/plain",t.project.project_id),b.target.classList.add("dragging")}function y(b){b.target.classList.remove("dragging")}function c(b){b.preventDefault(),b.dataTransfer.dropEffect="move";const x=b.currentTarget.getBoundingClientRect(),k=x.top+x.height/2;b.clientY<k?(b.currentTarget.classList.add("drop-above"),b.currentTarget.classList.remove("drop-below")):(b.currentTarget.classList.add("drop-below"),b.currentTarget.classList.remove("drop-above"))}function j(b){b.preventDefault(),b.currentTarget.classList.remove("drop-above","drop-below");const x=b.dataTransfer.getData("application/project-id")||b.dataTransfer.getData("text/plain");if(!x||x===t.project.project_id)return;const k=b.currentTarget.getBoundingClientRect(),M=k.top+k.height/2,R=b.clientY<M,N=l.orderedProjects,C=N.findIndex(A=>A.project_id===t.project.project_id),S=N.findIndex(A=>A.project_id===x);if(C===-1||S===-1)return;const L=[...N],[$]=L.splice(S,1);let D=R?C:C+1;S<C&&D--,L.splice(D,0,$);const O=L.map(A=>A.project_id);l.reorderProjects(O)}return(b,x)=>(n(),r("div",{class:"accordion-item border rounded mb-2","data-project-id":s.project.project_id,draggable:"true",onDragstart:T,onDragend:y,onDragover:c,onDrop:j},[e("h2",{class:"accordion-header",id:`heading-${s.project.project_id}`},[e("button",{class:W(["accordion-button bg-white p-2",{collapsed:!v.value}]),type:"button","data-bs-toggle":"collapse","data-bs-target":`#collapse-${s.project.project_id}`,"aria-expanded":v.value,"aria-controls":`collapse-${s.project.project_id}`},[e("div",Mi,[e("div",Ti,[e("div",Ei,[s.project.is_multi_agent?(n(),r("span",Ii,"🏛")):P("",!0),H(" "+f(s.project.name),1)]),e("div",Pi,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:ae(_,["stop","prevent"])}," ✏️ "),e("button",{class:"btn btn-sm btn-outline-primary",title:s.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:ae(h,["stop","prevent"])}," ➕ ",8,Li)])]),e("small",{class:"text-muted font-monospace",title:s.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},f(m.value),9,Di)])],10,ji)],8,xi),z(vi,{project:s.project,sessions:d.value},null,8,["project","sessions"]),e("div",{id:`collapse-${s.project.project_id}`,class:W(["accordion-collapse collapse",{show:v.value}]),"aria-labelledby":`heading-${s.project.project_id}`,onShown:g,onHidden:w},[e("div",Ni,[e("div",Ai,[s.project.is_multi_agent?(n(),r("div",{key:0,class:W(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:p.value}]),style:{cursor:"pointer"},onClick:E},[...x[0]||(x[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"📊"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):P("",!0),s.project.is_multi_agent?(n(),r(G,{key:1},[z($i,{project:s.project,sessions:d.value},null,8,["project","sessions"]),z(ki,{project:s.project,sessions:d.value},null,8,["project","sessions"])],64)):(n(!0),r(G,{key:2},Y(d.value,k=>(n(),le(bi,{key:k.session_id,session:k,"project-id":s.project.project_id},null,8,["session","project-id"]))),128))])])],42,Oi)],40,Ci))}},Ri=q(qi,[["__scopeId","data-v-4cc3dd53"]]),Ui={class:"project-list"},Hi={key:0,class:"text-muted text-center py-3"},Wi={__name:"ProjectList",setup(s){const t=ee(),i=u(()=>t.orderedProjects);return(l,o)=>(n(),r("div",Ui,[i.value.length===0?(n(),r("div",Hi,' No projects yet. Click "New" to create one. ')):P("",!0),(n(!0),r(G,null,Y(i.value,a=>(n(),le(Ri,{key:a.project_id,project:a},null,8,["project"]))),128))]))}},Fi={class:"flex-grow-1 overflow-auto p-3"},Bi={id:"sessions-container"},Vi={__name:"Sidebar",setup(s){const t=Z(),i=u(()=>t.sidebarCollapsed),l=u(()=>t.isMobile),o=u(()=>{if(l.value)return{};const g=`${t.sidebarWidth}px`;return{width:g,minWidth:"200px",maxWidth:"30vw","--sidebar-width":g}});function a(){t.showModal("create-project")}const v=I(!1);function m(g){v.value=!0,document.addEventListener("mousemove",d),document.addEventListener("mouseup",p)}function d(g){v.value&&t.setSidebarWidth(g.clientX)}function p(){v.value=!1,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",p)}return(g,w)=>(n(),r("aside",{id:"sidebar",class:W(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:i.value,"mobile-open":!i.value&&l.value,"desktop-collapsed":i.value&&!l.value}]),style:re(o.value)},[e("div",Fi,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[w[0]||(w[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:a}," 📁 New ")]),e("div",Bi,[z(Wi)])]),e("div",{class:"sidebar-resize-handle",onMousedown:m},null,32)],6))}},zi=q(Vi,[["__scopeId","data-v-d792f0f0"]]),Ji={class:"modal-dialog modal-lg"},Ki={class:"modal-content"},Gi={class:"modal-body"},Yi={class:"mb-3"},Qi={class:"input-group"},Zi=["disabled"],Xi={key:0,class:"text-center py-4"},ed={key:1,class:"alert alert-danger",role:"alert"},td={key:2,class:"folder-list"},sd=["onClick","onDblclick"],od={class:"d-flex align-items-center flex-grow-1"},nd=["onClick"],ld={key:1,class:"text-center text-muted py-3"},ad={class:"modal-footer"},rd=["disabled"],id={__name:"FolderBrowserModal",setup(s){const t=Z(),i=I(""),l=I(""),o=I([]),a=I(!1),v=I(""),m=I(null);let d=null,p=null;const g=u(()=>{if(!i.value)return null;const b=i.value.split(/[\\/]/).filter(Boolean);return b.length<=1?null:(b.pop(),b.length>0?b.join("/"):"/")});function w(b){if(!b)return"";const x=b.split(/[\\/]/).filter(Boolean);return x.length<=2?b:".../"+x.slice(-2).join("/")}async function _(){a.value=!0,v.value="",o.value=[],l.value="";try{const b=i.value?{path:i.value}:{},x=await B.get("/api/filesystem/browse",{params:b});x.current_path&&(i.value=x.current_path),o.value=x.directories||[]}catch(b){console.error("Failed to load directory:",b),v.value=b.message||"Failed to load directory"}finally{a.value=!1}}function h(b){l.value=b.path}function E(b){i.value=b.path,l.value="",_()}function T(){g.value&&(i.value=g.value,l.value="",_())}function y(){const b=l.value||i.value;b&&p&&p(b),d&&d.hide()}function c(){_()}function j(){o.value=[],l.value="",v.value="",p=null,t.hideModal()}return Q(()=>t.currentModal,b=>{if(b?.name==="folder-browser"&&d){const x=b.data||{};i.value=x.currentPath||"",p=x.onSelect||null,d.show()}}),oe(()=>{m.value&&se(async()=>{const{default:b}=await import("./modal-B4rHLo2F.js").then(x=>x.m);return{default:b}},__vite__mapDeps([0,1])).then(({default:b})=>{d=new b(m.value),m.value.addEventListener("shown.bs.modal",c),m.value.addEventListener("hidden.bs.modal",j)})}),ne(()=>{m.value&&(m.value.removeEventListener("shown.bs.modal",c),m.value.removeEventListener("hidden.bs.modal",j)),d&&d.dispose()}),(b,x)=>(n(),r("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:m},[e("div",Ji,[e("div",Ki,[x[7]||(x[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Gi,[e("div",Yi,[x[2]||(x[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",Qi,[J(e("input",{type:"text",class:"form-control","onUpdate:modelValue":x[0]||(x[0]=k=>i.value=k),onKeyup:Ne(_,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[X,i.value]]),e("button",{class:"btn btn-outline-secondary",onClick:_,disabled:a.value},[...x[1]||(x[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),H(" Refresh ",-1)])],8,Zi)])]),a.value?(n(),r("div",Xi,[...x[3]||(x[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):v.value?(n(),r("div",ed,f(v.value),1)):(n(),r("div",td,[g.value?(n(),r("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:T,role:"button"},[...x[4]||(x[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):P("",!0),(n(!0),r(G,null,Y(o.value,k=>(n(),r("div",{key:k.path,class:W(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:k.path===l.value}]),onClick:M=>h(k),onDblclick:M=>E(k),role:"button"},[e("div",od,[x[5]||(x[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,f(k.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:ae(M=>E(k),["stop"])}," Open ",8,nd)],42,sd))),128)),o.value.length===0?(n(),r("div",ld," No subdirectories found ")):P("",!0)]))]),e("div",ad,[x[6]||(x[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:y,disabled:!l.value},' Select "'+f(w(l.value||i.value))+'" ',9,rd)])])])],512))}},dd=q(id,[["__scopeId","data-v-667c51a9"]]),ud={class:"modal-dialog"},cd={class:"modal-content"},md={class:"modal-body"},pd={class:"mb-3"},vd={key:0,class:"invalid-feedback"},fd={class:"mb-3"},gd={class:"input-group"},_d={key:0,class:"invalid-feedback"},bd={class:"mb-3 form-check"},hd={class:"mb-3 form-check"},yd={class:"form-check-label",for:"createSession"},$d={key:0,class:"mb-3 ms-4"},wd={for:"sessionName",class:"form-label"},Sd={key:1,class:"alert alert-danger",role:"alert"},kd={class:"modal-footer"},Cd=["disabled"],xd={key:0,class:"spinner-border spinner-border-sm me-2"},jd={__name:"ProjectCreateModal",setup(s){const t=ee(),i=F(),l=Z(),o=I({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),a=I({name:"",workingDirectory:""}),v=I(!1),m=I(""),d=I(null);let p=null;function g(){l.showModal("folder-browser",{currentPath:o.value.workingDirectory||"",onSelect:y=>{o.value.workingDirectory=y,a.value.workingDirectory=""}})}function w(){a.value={};let y=!0;return o.value.name.trim()||(a.value.name="Project name is required",y=!1),o.value.workingDirectory.trim()||(a.value.workingDirectory="Working directory is required",y=!1),y}async function _(){if(w()){v.value=!0,m.value="";try{const y=await t.createProject(o.value.name,o.value.workingDirectory,o.value.isMultiAgent);o.value.createSession&&await i.createSession(y.project_id,{name:o.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),p&&p.hide(),h()}catch(y){console.error("Failed to create project:",y),m.value=y.message||"Failed to create project. Please try again."}finally{v.value=!1}}}function h(){o.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},a.value={},m.value=""}function E(){const y=document.getElementById("projectName");y&&y.focus()}function T(){h(),l.hideModal()}return Q(()=>l.currentModal,y=>{y?.name==="create-project"&&p&&p.show()}),oe(()=>{d.value&&se(async()=>{const{default:y}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:y}},__vite__mapDeps([0,1])).then(({default:y})=>{p=new y(d.value),d.value.addEventListener("shown.bs.modal",E),d.value.addEventListener("hidden.bs.modal",T)})}),ne(()=>{d.value&&(d.value.removeEventListener("shown.bs.modal",E),d.value.removeEventListener("hidden.bs.modal",T)),p&&p.dispose()}),(y,c)=>(n(),r("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:d},[e("div",ud,[e("div",cd,[c[11]||(c[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",md,[e("form",{onSubmit:ae(_,["prevent"])},[e("div",pd,[c[5]||(c[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),J(e("input",{type:"text",class:W(["form-control",{"is-invalid":a.value.name}]),id:"projectName","onUpdate:modelValue":c[0]||(c[0]=j=>o.value.name=j),placeholder:"My Project",required:""},null,2),[[X,o.value.name]]),a.value.name?(n(),r("div",vd,f(a.value.name),1)):P("",!0)]),e("div",fd,[c[6]||(c[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",gd,[J(e("input",{type:"text",class:W(["form-control",{"is-invalid":a.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":c[1]||(c[1]=j=>o.value.workingDirectory=j),placeholder:"/path/to/project",required:""},null,2),[[X,o.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:g}," Browse... "),a.value.workingDirectory?(n(),r("div",_d,f(a.value.workingDirectory),1)):P("",!0)]),c[7]||(c[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",bd,[J(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":c[2]||(c[2]=j=>o.value.isMultiAgent=j)},null,512),[[$e,o.value.isMultiAgent]]),c[8]||(c[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," 🏛 Multi-Agent Project (Legion) ",-1)),c[9]||(c[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",hd,[J(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":c[3]||(c[3]=j=>o.value.createSession=j)},null,512),[[$e,o.value.createSession]]),e("label",yd," Create initial "+f(o.value.isMultiAgent?"minion":"session"),1)]),o.value.createSession?(n(),r("div",$d,[e("label",wd," Initial "+f(o.value.isMultiAgent?"Minion":"Session")+" Name ",1),J(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":c[4]||(c[4]=j=>o.value.sessionName=j),placeholder:"main"},null,512),[[X,o.value.sessionName]])])):P("",!0),m.value?(n(),r("div",Sd,f(m.value),1)):P("",!0)],32)]),e("div",kd,[c[10]||(c[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:_,disabled:v.value},[v.value?(n(),r("span",xd)):P("",!0),H(" "+f(v.value?"Creating...":"Create Project"),1)],8,Cd)])])])],512))}},Md=q(jd,[["__scopeId","data-v-adf50394"]]),Td={class:"modal-dialog"},Ed={class:"modal-content"},Id={class:"modal-body"},Pd={class:"mb-3"},Ld={key:0,class:"invalid-feedback"},Dd={class:"mb-3"},Od=["value"],Nd={key:0,class:"alert alert-danger",role:"alert"},Ad={class:"danger-zone"},qd={class:"text-muted small"},Rd=["disabled"],Ud={key:0,class:"alert alert-warning mt-3",role:"alert"},Hd={class:"mb-2"},Wd={class:"d-flex gap-2"},Fd=["disabled"],Bd={key:0,class:"spinner-border spinner-border-sm me-2"},Vd=["disabled"],zd={class:"modal-footer"},Jd=["disabled"],Kd={key:0,class:"spinner-border spinner-border-sm me-2"},Gd={__name:"ProjectEditModal",setup(s){const t=ee(),i=Z(),l=I(null),o=I({name:""}),a=I({name:""}),v=I(!1),m=I(!1),d=I(""),p=I(!1),g=I(null);let w=null;const _=u(()=>l.value?.session_ids?.length||0);function h(){a.value={};let b=!0;return o.value.name.trim()||(a.value.name="Project name is required",b=!1),b}async function E(){if(!(!h()||!l.value)){v.value=!0,d.value="";try{await t.updateProject(l.value.project_id,{name:o.value.name}),w&&w.hide()}catch(b){console.error("Failed to update project:",b),d.value=b.message||"Failed to update project. Please try again."}finally{v.value=!1}}}async function T(){if(l.value){m.value=!0,d.value="";try{await t.deleteProject(l.value.project_id),w&&w.hide()}catch(b){console.error("Failed to delete project:",b),d.value=b.message||"Failed to delete project. Please try again."}finally{m.value=!1}}}function y(){o.value={name:""},a.value={},d.value="",p.value=!1}function c(){const b=document.getElementById("editProjectName");b&&(b.focus(),b.select())}function j(){y(),l.value=null,i.hideModal()}return Q(()=>i.currentModal,b=>{if(b?.name==="edit-project"&&w){const x=b.data||{};l.value=x.project,l.value&&(o.value.name=l.value.name),w.show()}}),oe(()=>{g.value&&se(async()=>{const{default:b}=await import("./modal-B4rHLo2F.js").then(x=>x.m);return{default:b}},__vite__mapDeps([0,1])).then(({default:b})=>{w=new b(g.value),g.value.addEventListener("shown.bs.modal",c),g.value.addEventListener("hidden.bs.modal",j)})}),ne(()=>{g.value&&(g.value.removeEventListener("shown.bs.modal",c),g.value.removeEventListener("hidden.bs.modal",j)),w&&w.dispose()}),(b,x)=>(n(),r("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:g},[e("div",Td,[e("div",Ed,[x[11]||(x[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Id,[e("form",{onSubmit:ae(E,["prevent"])},[e("div",Pd,[x[3]||(x[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),J(e("input",{type:"text",class:W(["form-control",{"is-invalid":a.value.name}]),id:"editProjectName","onUpdate:modelValue":x[0]||(x[0]=k=>o.value.name=k),placeholder:"My Project",required:""},null,2),[[X,o.value.name]]),a.value.name?(n(),r("div",Ld,f(a.value.name),1)):P("",!0)]),e("div",Dd,[x[4]||(x[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:l.value?.working_directory,disabled:"",readonly:""},null,8,Od),x[5]||(x[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),d.value?(n(),r("div",Nd,f(d.value),1)):P("",!0)],32),x[9]||(x[9]=e("hr",null,null,-1)),e("div",Ad,[x[7]||(x[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",qd," Deleting this project will also delete all "+f(_.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:x[1]||(x[1]=k=>p.value=!0),disabled:m.value},[...x[6]||(x[6]=[e("i",{class:"bi bi-trash"},null,-1),H(" Delete Project ",-1)])],8,Rd)]),p.value?(n(),r("div",Ud,[x[8]||(x[8]=e("strong",null,"Are you sure?",-1)),e("p",Hd,' This will permanently delete the project "'+f(l.value?.name)+'" and all '+f(_.value)+" session(s). ",1),e("div",Wd,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:T,disabled:m.value},[m.value?(n(),r("span",Bd)):P("",!0),H(" "+f(m.value?"Deleting...":"Yes, Delete Permanently"),1)],8,Fd),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:x[2]||(x[2]=k=>p.value=!1),disabled:m.value}," Cancel ",8,Vd)])])):P("",!0)]),e("div",zd,[x[10]||(x[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:E,disabled:v.value},[v.value?(n(),r("span",Kd)):P("",!0),H(" "+f(v.value?"Saving...":"Save Changes"),1)],8,Jd)])])])],512))}},Yd=q(Gd,[["__scopeId","data-v-6f299f35"]]),Qd={class:"modal-dialog modal-lg"},Zd={class:"modal-content"},Xd={class:"modal-header"},eu={class:"modal-title",id:"createSessionModalLabel"},tu={key:0,class:"text-muted small"},su={class:"modal-body"},ou={class:"mb-3"},nu={key:0,class:"invalid-feedback"},lu={class:"mb-3"},au={class:"mb-3"},ru={class:"mb-3"},iu={class:"mb-3"},du={class:"mb-3 form-check"},uu={key:0,class:"alert alert-danger",role:"alert"},cu={class:"modal-footer"},mu=["disabled"],pu={key:0,class:"spinner-border spinner-border-sm me-2"},vu={__name:"SessionCreateModal",setup(s){const t=ie();ee();const i=F(),l=Z(),o=I(null),a=I({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",tools:"",startImmediately:!0}),v=I({name:""}),m=I(!1),d=I(""),p=I(null);let g=null;function w(){v.value={};let y=!0;return a.value.name.trim()||(v.value.name="Session name is required",y=!1),y}async function _(){if(!(!w()||!o.value)){m.value=!0,d.value="";try{const y=a.value.tools.split(",").map(b=>b.trim()).filter(b=>b.length>0),c={name:a.value.name,permission_mode:a.value.permission_mode,model:a.value.model,system_prompt:a.value.system_prompt.trim()||null,tools:y},j=await i.createSession(o.value.project_id,c);a.value.startImmediately&&await i.startSession(j.session_id),t.push(`/session/${j.session_id}`),g&&g.hide(),h()}catch(y){console.error("Failed to create session:",y),d.value=y.message||"Failed to create session. Please try again."}finally{m.value=!1}}}function h(){a.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",tools:"",startImmediately:!0},v.value={},d.value=""}function E(){const y=document.getElementById("sessionName");y&&y.focus()}function T(){h(),o.value=null,l.hideModal()}return Q(()=>l.currentModal,y=>{if(y?.name==="create-session"&&g){const c=y.data||{};o.value=c.project,g.show()}}),oe(()=>{p.value&&se(async()=>{const{default:y}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:y}},__vite__mapDeps([0,1])).then(({default:y})=>{g=new y(p.value),p.value.addEventListener("shown.bs.modal",E),p.value.addEventListener("hidden.bs.modal",T)})}),ne(()=>{p.value&&(p.value.removeEventListener("shown.bs.modal",E),p.value.removeEventListener("hidden.bs.modal",T)),g&&g.dispose()}),(y,c)=>(n(),r("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:p},[e("div",Qd,[e("div",Zd,[e("div",Xd,[e("h5",eu,[c[6]||(c[6]=H(" Create New Session ",-1)),o.value?(n(),r("span",tu,"in "+f(o.value.name),1)):P("",!0)]),c[7]||(c[7]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",su,[e("form",{onSubmit:ae(_,["prevent"])},[e("div",ou,[c[8]||(c[8]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),J(e("input",{type:"text",class:W(["form-control",{"is-invalid":v.value.name}]),id:"sessionName","onUpdate:modelValue":c[0]||(c[0]=j=>a.value.name=j),placeholder:"main",required:""},null,2),[[X,a.value.name]]),v.value.name?(n(),r("div",nu,f(v.value.name),1)):P("",!0)]),e("div",lu,[c[10]||(c[10]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),J(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":c[1]||(c[1]=j=>a.value.permission_mode=j)},[...c[9]||(c[9]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"⚠️ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[de,a.value.permission_mode]]),c[11]||(c[11]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",au,[c[13]||(c[13]=e("label",{for:"model",class:"form-label"},"Model",-1)),J(e("select",{class:"form-select",id:"model","onUpdate:modelValue":c[2]||(c[2]=j=>a.value.model=j)},[...c[12]||(c[12]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[de,a.value.model]])]),e("div",ru,[c[14]||(c[14]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),J(e("textarea",{class:"form-control",id:"systemPrompt","onUpdate:modelValue":c[3]||(c[3]=j=>a.value.system_prompt=j),rows:"3",placeholder:"Additional instructions to append to the system prompt..."},null,512),[[X,a.value.system_prompt]]),c[15]||(c[15]=e("div",{class:"form-text"}," These instructions will be appended to Claude Code's default system prompt ",-1))]),e("div",iu,[c[16]||(c[16]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),J(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":c[4]||(c[4]=j=>a.value.tools=j),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[X,a.value.tools]]),c[17]||(c[17]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",du,[J(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":c[5]||(c[5]=j=>a.value.startImmediately=j)},null,512),[[$e,a.value.startImmediately]]),c[18]||(c[18]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),d.value?(n(),r("div",uu,f(d.value),1)):P("",!0)],32)]),e("div",cu,[c[19]||(c[19]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:_,disabled:m.value},[m.value?(n(),r("span",pu)):P("",!0),H(" "+f(m.value?"Creating...":"Create Session"),1)],8,mu)])])])],512))}},fu=q(vu,[["__scopeId","data-v-75934d4f"]]),gu={class:"modal-dialog"},_u={class:"modal-content"},bu={class:"modal-body"},hu={class:"mb-3"},yu={key:0,class:"invalid-feedback"},$u={class:"mb-3"},wu=["value"],Su={class:"mb-3"},ku={class:"form-control-plaintext"},Cu={class:"mb-3"},xu=["disabled"],ju={key:0,value:"bypassPermissions"},Mu={class:"form-text"},Tu={key:0,class:"text-warning"},Eu={key:1},Iu={key:0,class:"alert alert-danger",role:"alert"},Pu={class:"modal-footer"},Lu=["disabled"],Du={key:0,class:"spinner-border spinner-border-sm me-2"},Ou={__name:"SessionEditModal",setup(s){const t=F(),i=Z(),l=I(null),o=I({name:"",permission_mode:"default"}),a=I({name:""}),v=I(!1),m=I(""),d=I(null);let p=null;const g=u(()=>l.value?.state==="active"||l.value?.state==="starting"),w=u(()=>l.value?.initial_permission_mode==="bypassPermissions");function _(j){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[j]||"bg-secondary"}function h(){a.value={};let j=!0;return o.value.name.trim()||(a.value.name="Session name is required",j=!1),j}async function E(){if(!(!h()||!l.value)){v.value=!0,m.value="";try{await t.updateSessionName(l.value.session_id,o.value.name),o.value.permission_mode!==l.value.current_permission_mode&&await t.setPermissionMode(l.value.session_id,o.value.permission_mode),p&&p.hide()}catch(j){console.error("Failed to update session:",j),m.value=j.message||"Failed to update session. Please try again."}finally{v.value=!1}}}function T(){o.value={name:"",permission_mode:"default"},a.value={},m.value=""}function y(){const j=document.getElementById("editSessionName");j&&(j.focus(),j.select())}function c(){T(),l.value=null,i.hideModal()}return Q(()=>i.currentModal,j=>{if(j?.name==="edit-session"&&p){const b=j.data||{};l.value=b.session,l.value&&(o.value.name=l.value.name,o.value.permission_mode=l.value.current_permission_mode||"default"),p.show()}}),oe(()=>{d.value&&se(async()=>{const{default:j}=await import("./modal-B4rHLo2F.js").then(b=>b.m);return{default:j}},__vite__mapDeps([0,1])).then(({default:j})=>{p=new j(d.value),d.value.addEventListener("shown.bs.modal",y),d.value.addEventListener("hidden.bs.modal",c)})}),ne(()=>{d.value&&(d.value.removeEventListener("shown.bs.modal",y),d.value.removeEventListener("hidden.bs.modal",c)),p&&p.dispose()}),(j,b)=>(n(),r("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:d},[e("div",gu,[e("div",_u,[b[11]||(b[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",bu,[e("form",{onSubmit:ae(E,["prevent"])},[e("div",hu,[b[2]||(b[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),J(e("input",{type:"text",class:W(["form-control",{"is-invalid":a.value.name}]),id:"editSessionName","onUpdate:modelValue":b[0]||(b[0]=x=>o.value.name=x),placeholder:"Session Name",required:""},null,2),[[X,o.value.name]]),a.value.name?(n(),r("div",yu,f(a.value.name),1)):P("",!0)]),e("div",$u,[b[3]||(b[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:l.value?.working_directory,disabled:"",readonly:""},null,8,wu),b[4]||(b[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",Su,[b[5]||(b[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",ku,[e("span",{class:W(["badge",_(l.value?.state)])},f(l.value?.state),3)])]),e("div",Cu,[b[9]||(b[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),J(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":b[1]||(b[1]=x=>o.value.permission_mode=x),disabled:!g.value},[b[6]||(b[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),b[7]||(b[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),b[8]||(b[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),w.value?(n(),r("option",ju,"⚠️ Bypass Permissions (No prompts)")):P("",!0)],8,xu),[[de,o.value.permission_mode]]),e("div",Mu,[g.value?(n(),r("span",Eu," Controls which tool actions require permission prompts ")):(n(),r("span",Tu," ⚠️ Session must be active to change permission mode. Start the session first. "))])]),m.value?(n(),r("div",Iu,f(m.value),1)):P("",!0)],32)]),e("div",Pu,[b[10]||(b[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:E,disabled:v.value},[v.value?(n(),r("span",Du)):P("",!0),H(" "+f(v.value?"Saving...":"Save Changes"),1)],8,Lu)])])])],512))}},Nu=q(Ou,[["__scopeId","data-v-ec2f9089"]]),Au={class:"modal-dialog modal-dialog-centered"},qu={class:"modal-content"},Ru={class:"modal-header"},Uu={class:"modal-title",id:"manageSessionModalLabel"},Hu={class:"modal-body"},Wu={key:0,class:"text-center py-4"},Fu={class:"text-muted"},Bu={key:1},Vu={key:2},zu={class:"text-muted"},Ju={key:3},Ku={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Gu={class:"d-grid gap-2"},Yu=["disabled"],Qu=["disabled"],Zu=["disabled"],Xu=["disabled"],ec={class:"modal-footer"},tc={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},sc={__name:"SessionManageModal",setup(s){const t=ie(),i=F(),l=Z(),o=ce(),a=ue(),v=I(null),m=I(!1),d=I(""),p=I(""),g=I(null),w=I(null);let _=null;const h=u(()=>g.value==="reset"?"Reset Session":g.value==="delete"?"Delete Session":"Manage Session");function E(){g.value="reset"}function T(){g.value="delete"}function y(){g.value=null}async function c(){g.value==="reset"?await x():g.value==="delete"&&await k()}async function j(){if(v.value){m.value=!0,d.value="Restarting session...";try{const N=v.value.session_id,C=await B.post(`/api/sessions/${N}/restart`);if(C.success)console.log("Session restarted successfully, reconnecting"),await o.disconnectSession(),await i.selectSession(N),_&&_.hide();else{const S=C.error||C.detail||"Failed to restart session";console.error("Failed to restart session:",S),p.value=`Failed to restart session: ${S}`}}catch(N){console.error("Error restarting session:",N);const C=N.data?.detail||N.message||"Unknown error";p.value=`Error restarting session: ${C}`}finally{m.value=!1}}}async function b(){if(v.value)try{_&&_.hide(),console.log("Ending session",v.value.session_id);const N=v.value.session_id;await B.post(`/api/sessions/${N}/terminate`),await o.disconnectSession(),i.currentSessionId===N&&(i.currentSessionId=null),t.push("/")}catch(N){console.error("Error ending session:",N),await o.disconnectSession(),i.currentSessionId===v.value?.session_id&&(i.currentSessionId=null),t.push("/")}}async function x(){if(v.value){m.value=!0,d.value="Resetting session...";try{const N=v.value.session_id,C=await B.post(`/api/sessions/${N}/reset`);if(C.success)console.log("Session reset successfully, reconnecting"),await o.disconnectSession(),await new Promise(S=>setTimeout(S,200)),await a.loadMessages(N),o.connectSession(N),_&&_.hide();else{const S=C.error||C.detail||"Failed to reset session";console.error("Failed to reset session:",S),p.value=`Failed to reset session: ${S}`,g.value=null}}catch(N){console.error("Error resetting session:",N);const C=N.data?.detail||N.message||"Unknown error";p.value=`Error resetting session: ${C}`,g.value=null}finally{m.value=!1}}}async function k(){if(v.value){m.value=!0,d.value="Deleting session...";try{const N=v.value.session_id;await i.deleteSession(N),t.currentRoute.value.params.sessionId===N&&t.push("/"),_&&_.hide()}catch(N){console.error("Error deleting session:",N);const C=N.data?.detail||N.message||"Unknown error";p.value=`Error deleting session: ${C}`,g.value=null}finally{m.value=!1}}}function M(){g.value=null,m.value=!1,d.value="",p.value=""}function R(){M(),v.value=null,l.hideModal()}return Q(()=>l.currentModal,N=>{if(N?.name==="manage-session"&&_){const C=N.data||{};v.value=C.session,M(),_.show()}}),oe(()=>{w.value&&se(async()=>{const{default:N}=await import("./modal-B4rHLo2F.js").then(C=>C.m);return{default:N}},__vite__mapDeps([0,1])).then(({default:N})=>{_=new N(w.value),w.value.addEventListener("hidden.bs.modal",R)})}),ne(()=>{w.value&&w.value.removeEventListener("hidden.bs.modal",R),_&&_.dispose()}),(N,C)=>(n(),r("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:w},[e("div",Au,[e("div",qu,[e("div",Ru,[e("h5",Uu,f(g.value?h.value:"Manage Session"),1),C[1]||(C[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Hu,[m.value?(n(),r("div",Wu,[C[2]||(C[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Fu,f(d.value),1)])):g.value==="reset"?(n(),r("div",Bu,[...C[3]||(C[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):g.value==="delete"?(n(),r("div",Vu,[C[6]||(C[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1)),e("p",zu,[C[4]||(C[4]=H("This will permanently delete session ",-1)),e("strong",null,f(v.value?.name),1),C[5]||(C[5]=H(".",-1))]),C[7]||(C[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(n(),r("div",Ju,[p.value?(n(),r("div",Ku,[C[8]||(C[8]=e("strong",null,"Error:",-1)),H(" "+f(p.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:C[0]||(C[0]=S=>p.value="")})])):P("",!0),C[15]||(C[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",Gu,[e("button",{class:"btn btn-outline-primary text-start",onClick:j,disabled:m.value},[...C[9]||(C[9]=[e("strong",null,"🔄 Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,Yu),e("button",{class:"btn btn-outline-secondary text-start",onClick:b,disabled:m.value},[...C[10]||(C[10]=[e("strong",null,"🚪 End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,Qu),C[13]||(C[13]=e("hr",{class:"my-2"},null,-1)),C[14]||(C[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"⚠️ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:E,disabled:m.value},[...C[11]||(C[11]=[e("strong",null,"🗑️ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,Zu),e("button",{class:"btn btn-outline-danger text-start",onClick:T,disabled:m.value},[...C[12]||(C[12]=[e("strong",null,"❌ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,Xu)]),C[16]||(C[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),H(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",ec,[g.value&&!m.value?(n(),r(G,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:y},"Cancel"),e("button",{type:"button",class:W(["btn",g.value==="delete"?"btn-danger":"btn-warning"]),onClick:c},f(g.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):m.value?P("",!0):(n(),r("button",tc,"Cancel"))])])])],512))}},oc=q(sc,[["__scopeId","data-v-bcb5ba36"]]),nc={class:"modal-dialog modal-dialog-centered modal-lg"},lc={class:"modal-content"},ac={class:"modal-body"},rc={key:0,class:"text-center text-muted py-4"},ic={key:1},dc={class:"mb-3"},uc={class:"font-monospace small"},cc={class:"mb-3"},mc={class:"font-monospace small"},pc={class:"mb-3"},vc={class:"mb-3"},fc={class:"mb-3"},gc={key:0},_c={class:"d-flex flex-wrap gap-1"},bc={key:1,class:"text-muted small"},hc={key:0,class:"mb-3"},yc={class:"d-flex flex-wrap gap-1"},$c={key:1,class:"mb-3"},wc={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},Sc={class:"mb-3"},kc={class:"text-muted"},Cc={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},xc={__name:"SessionInfoModal",setup(s){const t=F(),i=ue(),l=Z(),o=I(null),a=I(!1),v=I(null);let m=null;const d=u(()=>{if(!o.value)return null;const _=t.initData.get(o.value);return _||(i.messagesBySession.get(o.value)||[]).find(T=>T.type==="system"&&(T.subtype==="init"||T.metadata?.subtype==="init")&&T.metadata?.init_data)?.metadata?.init_data||null});function p(_){return typeof _=="string"?_:typeof _=="object"&&_.type==="preset"?`Preset: ${_.preset}`:JSON.stringify(_,null,2)}function g(){o.value=null,a.value=!1}function w(){g(),l.hideModal()}return Q(()=>l.currentModal,_=>{if(_?.name==="session-info"&&m){const h=_.data||{};o.value=h.sessionId,a.value=!1,m.show()}}),oe(()=>{v.value&&se(async()=>{const{default:_}=await import("./modal-B4rHLo2F.js").then(h=>h.m);return{default:_}},__vite__mapDeps([0,1])).then(({default:_})=>{m=new _(v.value),v.value.addEventListener("hidden.bs.modal",w)})}),ne(()=>{v.value&&v.value.removeEventListener("hidden.bs.modal",w),m&&m.dispose()}),(_,h)=>(n(),r("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",nc,[e("div",lc,[h[9]||(h[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",ac,[d.value?(n(),r("div",ic,[e("div",dc,[h[1]||(h[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",uc,f(o.value),1)]),e("div",cc,[h[2]||(h[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",mc,f(d.value.cwd||"Not specified"),1)]),e("div",pc,[h[3]||(h[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,f(d.value.model||"Default"),1)]),e("div",vc,[h[4]||(h[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,f(d.value.permissionMode||"default"),1)]),e("div",fc,[h[5]||(h[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),d.value.tools&&d.value.tools.length>0?(n(),r("div",gc,[e("div",_c,[(n(!0),r(G,null,Y(d.value.tools,E=>(n(),r("span",{key:E,class:"badge bg-secondary"},f(E),1))),128))])])):(n(),r("div",bc,"All tools available"))]),d.value.commands&&d.value.commands.length>0?(n(),r("div",hc,[h[6]||(h[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",yc,[(n(!0),r(G,null,Y(d.value.commands,E=>(n(),r("span",{key:E,class:"badge bg-info"},f(E),1))),128))])])):P("",!0),d.value.systemPrompt?(n(),r("div",$c,[h[7]||(h[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",wc,f(p(d.value.systemPrompt)),1)])):P("",!0),e("div",Sc,[e("h6",kc,[h[8]||(h[8]=H(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:h[0]||(h[0]=E=>a.value=!a.value)},f(a.value?"Hide":"Show"),1)]),a.value?(n(),r("pre",Cc,f(JSON.stringify(d.value,null,2)),1)):P("",!0)])])):(n(),r("div",rc," No session configuration data available "))]),h[10]||(h[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},jc=q(xc,[["__scopeId","data-v-809e2099"]]),Mc={class:"modal-dialog modal-dialog-centered"},Tc={class:"modal-content"},Ec={class:"modal-body"},Ic={class:"mb-3"},Pc={class:"mb-3"},Lc={class:"mb-3"},Dc={class:"mb-3"},Oc={key:0,class:"alert alert-danger"},Nc={class:"modal-footer"},Ac=["disabled"],qc={key:0,class:"spinner-border spinner-border-sm me-2"},Rc={__name:"CreateMinionModal",setup(s){const t=ie(),i=ee(),l=F(),o=Z(),a=I(null);let v=null;const m=I(null),d=I({name:"",role:"",initialization_context:"",capabilities:[]}),p=I(""),g=I(""),w=I(!1),_=u(()=>p.value.trim()?p.value.split(",").map(y=>y.trim()).filter(y=>y.length>0):[]);function h(){d.value={name:"",role:"",initialization_context:"",capabilities:[]},p.value="",g.value="",w.value=!1}function E(){h(),o.hideModal()}async function T(){if(!d.value.name.trim()){g.value="Minion name is required";return}if(d.value.name.includes(" ")){g.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(!m.value){g.value="Legion ID is missing";return}w.value=!0,g.value="";try{const y={name:d.value.name.trim(),role:d.value.role.trim(),initialization_context:d.value.initialization_context.trim(),capabilities:_.value},c=await B.post(`/api/legions/${m.value}/minions`,y);c.success&&c.minion_id?(await i.fetchProjects(),await l.fetchSessions(),v&&v.hide(),t.push(`/spy/${m.value}/${c.minion_id}`)):g.value="Failed to create minion"}catch(y){console.error("Failed to create minion:",y),g.value=y.response?.data?.detail||"Failed to create minion"}finally{w.value=!1}}return Q(()=>o.currentModal,y=>{if(y?.name==="create-minion"&&v){const c=y.data||{};m.value=c.project?.project_id||null,h(),v.show()}}),oe(()=>{a.value&&se(()=>import("./modal-B4rHLo2F.js").then(y=>y.m),__vite__mapDeps([0,1])).then(y=>{const c=y.default;v=new c(a.value),a.value.addEventListener("hidden.bs.modal",E)})}),ne(()=>{a.value&&a.value.removeEventListener("hidden.bs.modal",E),v&&v.dispose()}),(y,c)=>(n(),r("div",{ref_key:"modalElement",ref:a,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",Mc,[e("div",Tc,[c[13]||(c[13]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Ec,[e("form",{onSubmit:ae(T,["prevent"])},[e("div",Ic,[c[4]||(c[4]=e("label",{for:"minion-name",class:"form-label"},[H(" Name "),e("span",{class:"text-danger"},"*")],-1)),J(e("input",{id:"minion-name","onUpdate:modelValue":c[0]||(c[0]=j=>d.value.name=j),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[X,d.value.name]]),c[5]||(c[5]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",Pc,[c[6]||(c[6]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),J(e("input",{id:"minion-role","onUpdate:modelValue":c[1]||(c[1]=j=>d.value.role=j),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[X,d.value.role]]),c[7]||(c[7]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",Lc,[c[8]||(c[8]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),J(e("textarea",{id:"minion-context","onUpdate:modelValue":c[2]||(c[2]=j=>d.value.initialization_context=j),class:"form-control",rows:"4",placeholder:"Instructions and context for the minion..."},null,512),[[X,d.value.initialization_context]]),c[9]||(c[9]=e("div",{class:"form-text"},"Instructions and context to initialize the minion with",-1))]),e("div",Dc,[c[10]||(c[10]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),J(e("input",{id:"minion-capabilities","onUpdate:modelValue":c[3]||(c[3]=j=>p.value=j),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[X,p.value]]),c[11]||(c[11]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),g.value?(n(),r("div",Oc,f(g.value),1)):P("",!0)],32)]),e("div",Nc,[c[12]||(c[12]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!d.value.name.trim()||w.value,onClick:T},[w.value?(n(),r("span",qc)):P("",!0),H(" "+f(w.value?"Creating...":"Create Minion"),1)],8,Ac)])])])],512))}},Uc=q(Rc,[["__scopeId","data-v-fd1df88d"]]),Hc={class:"container-fluid vh-100 d-flex flex-column p-0"},Wc={class:"d-flex flex-grow-1 overflow-hidden position-relative"},Fc={class:"flex-grow-1 d-flex flex-column overflow-hidden"},Bc={__name:"App",setup(s){const t=Z(),i=ce(),l=F(),o=ee(),a=ie(),v=u(()=>t.sidebarCollapsed),m=u(()=>t.isMobile);oe(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),i.connectUI(),await Promise.all([o.fetchProjects(),l.fetchSessions()]);const g=window.location.hash;if(g.startsWith("#/session/")){const w=g.replace("#/session/","");l.sessions.has(w)&&await l.selectSession(w)}else if(g.startsWith("#/timeline/")){const w=g.replace("#/timeline/","");a.push(`/timeline/${w}`)}window.addEventListener("popstate",d),window.addEventListener("resize",t.handleResize)}),ne(()=>{window.removeEventListener("popstate",d),window.removeEventListener("resize",t.handleResize),i.disconnectUI()});function d(){const g=window.location.hash;if(g.startsWith("#/session/")){const w=g.replace("#/session/","");l.sessions.has(w)&&l.selectSession(w)}}function p(){t.toggleSidebar()}return(g,w)=>{const _=Ae("router-view");return n(),r("div",Hc,[z(di),e("div",{id:"sidebar-backdrop",class:W({show:!v.value&&m.value}),onClick:p},null,2),e("div",Wc,[z(zi),e("main",Fc,[z(_)])]),z(dd),z(Md),z(Yd),z(fu),z(Nu),z(oc),z(jc),z(Uc)])}}},ke=He(Bc);ke.use(We());ke.use(li);ke.mount("#app");
