const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as r,a as e,o as l,d as pe,r as E,b as u,t as f,n as re,e as W,f as H,u as ge,w as Q,g as Me,h as I,F as G,i as Y,j as le,k as Ne,l as K,v as X,m as J,p as oe,q as $e,s as Ae,x as ae,y as ne,z as de,A as Re,B as Ue,C as He,D as ie,E as we,G as We,H as Fe}from"./vue-vendor-BChC3Sgv.js";import{m as ve,p as Se}from"./markdown-vendor-CQ3OZdP9.js";import{c as Be}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const p of n.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();const Ve={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},ze={__name:"NoSessionSelected",setup(s){return(t,i)=>(l(),r("div",Ve,[...i[0]||(i[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},Je="modulepreload",Ke=function(s){return"/"+s},Te={},se=function(t,i,a){let o=Promise.resolve();if(i&&i.length>0){let d=function(m){return Promise.all(m.map(g=>Promise.resolve(g).then($=>({status:"fulfilled",value:$}),$=>({status:"rejected",reason:$}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),v=p?.nonce||p?.getAttribute("nonce");o=d(i.map(m=>{if(m=Ke(m),m in Te)return;Te[m]=!0;const g=m.endsWith(".css"),$=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${$}`))return;const b=document.createElement("link");if(b.rel=g?"stylesheet":Je,g||(b.as="script"),b.crossOrigin="",b.href=m,v&&b.setAttribute("nonce",v),document.head.appendChild(b),g)return new Promise((h,M)=>{b.addEventListener("load",h),b.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${m}`)))})}))}function n(p){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=p,window.dispatchEvent(v),!v.defaultPrevented)throw p}return o.then(p=>{for(const v of p||[])v.status==="rejected"&&n(v.reason);return t().catch(n)})};class be extends Error{constructor(t,i,a){super(t),this.name="APIError",this.status=i,this.data=a}}async function fe(s,t={}){try{const i=await fetch(s,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!i.ok){let o;try{o=await i.json()}catch{o={detail:i.statusText}}throw new be(o.detail||`HTTP ${i.status}: ${i.statusText}`,i.status,o)}const a=i.headers.get("content-type");return a&&a.includes("application/json")?await i.json():await i.text()}catch(i){throw i instanceof be?i:(console.error("API request failed:",i),new be(`Network error: ${i.message}`,0,null))}}async function Ge(s,t={}){let i=s;if(t.params){const a=new URLSearchParams;for(const[v,d]of Object.entries(t.params))d!=null&&a.append(v,d);const o=a.toString();o&&(i=`${s}?${o}`);const{params:n,...p}=t;return fe(i,{...p,method:"GET"})}return fe(i,{...t,method:"GET"})}async function Ye(s,t,i={}){return fe(s,{...i,method:"POST",body:JSON.stringify(t)})}async function Qe(s,t,i={}){return fe(s,{...i,method:"PUT",body:JSON.stringify(t)})}async function Ze(s,t={}){return fe(s,{...t,method:"DELETE"})}const V={get:Ge,post:Ye,put:Qe,delete:Ze},B=pe("session",()=>{const s=E(new Map),t=E(null),i=E(new Map),a=E(new Map),o=E(new Set),n=u(()=>s.value.get(t.value)),p=u(()=>Array.from(s.value.values()).sort((w,x)=>w.order-x.order)),v=w=>u(()=>p.value.filter(x=>x.project_id===w)),d=u({get:()=>i.value.get(t.value)||"",set:w=>{t.value&&i.value.set(t.value,w)}});async function m(){try{const w=await V.get("/api/sessions");return s.value.clear(),w.sessions.forEach(x=>{s.value.set(x.session_id,x)}),console.log(`Loaded ${s.value.size} sessions`),w.sessions}catch(w){throw console.error("Failed to fetch sessions:",w),w}}async function g(w,x){try{const O=(await V.post("/api/sessions",{project_id:w,...x})).session_id,S=(await V.get(`/api/sessions/${O}`)).session;return s.value.set(O,S),s.value=new Map(s.value),console.log(`Created session ${O}`),S}catch(N){throw console.error("Failed to create session:",N),N}}async function $(w){if(t.value===w)return;t.value=w;let x=s.value.get(w);if(!x)try{x=(await V.get(`/api/sessions/${w}`)).session,s.value.set(w,x),s.value=new Map(s.value),console.log(`Fetched session ${w} for deeplink`)}catch(P){console.error(`Failed to fetch session ${w}:`,P);return}if(x&&(x.state==="created"||x.state==="terminated"))try{await y(w),console.log(`Auto-started session ${w} (was in ${x.state} state)`);const P=6e4,S=200,L=5e3;let D=0,T=0;for(;D<P;){const R=s.value.get(w);if(R&&R.state==="active"){console.log(`Session ${w} is now active after ${D}ms`);break}if(D-T>=L){const F=s.value.get(w)?.state||"unknown";console.log(`Waiting for session ${w} to become active (current: ${F}, ${D/1e3}s elapsed)`),T=D}await new Promise(F=>setTimeout(F,S)),D+=S}const A=s.value.get(w);A&&A.state!=="active"&&console.warn(`Session ${w} did not become active within ${P/1e3}s (state: ${A.state}), continuing anyway`)}catch(P){console.error(`Failed to auto-start session ${w}:`,P)}await(await se(()=>Promise.resolve().then(()=>bt),void 0)).useMessageStore().loadMessages(w),(await se(()=>Promise.resolve().then(()=>qt),void 0)).useWebSocketStore().connectSession(w),console.log(`Selected session ${w}`)}function b(w,x){const N=s.value.get(w);N&&(Object.assign(N,x),s.value=new Map(s.value))}async function h(w){o.value.add(w);try{await V.delete(`/api/sessions/${w}`),s.value.delete(w),i.value.delete(w),a.value.delete(w),s.value=new Map(s.value),t.value===w&&(t.value=null),console.log(`Deleted session ${w}`)}catch(x){throw console.error("Failed to delete session:",x),x}finally{o.value.delete(w)}}async function M(w,x){try{await V.put(`/api/sessions/${w}/name`,{name:x}),b(w,{name:x}),console.log(`Updated session ${w} name to "${x}"`)}catch(N){throw console.error("Failed to update session name:",N),N}}async function j(w,x){try{await V.post(`/api/sessions/${w}/permission-mode`,{mode:x}),b(w,{current_permission_mode:x});const N=a.value.get(w);N&&(N.permissionMode=x,a.value.set(w,N)),console.log(`Set permission mode for session ${w} to ${x}`)}catch(N){throw console.error("Failed to set permission mode:",N),N}}async function y(w){try{await V.post(`/api/sessions/${w}/start`),console.log(`Started session ${w}`)}catch(x){throw console.error("Failed to start session:",x),x}}async function c(w){try{await V.post(`/api/sessions/${w}/pause`),console.log(`Paused session ${w}`)}catch(x){throw console.error("Failed to pause session:",x),x}}async function C(w){try{await V.post(`/api/sessions/${w}/terminate`),console.log(`Terminated session ${w}`)}catch(x){throw console.error("Failed to terminate session:",x),x}}function _(w){return s.value.get(w)}function k(w,x){a.value.set(w,x),x.permissionMode&&b(w,{current_permission_mode:x.permissionMode})}return{sessions:s,currentSessionId:t,inputCache:i,initData:a,deletingSessions:o,currentSession:n,orderedSessions:p,sessionsInProject:v,currentInput:d,fetchSessions:m,createSession:g,selectSession:$,updateSession:b,deleteSession:h,updateSessionName:M,setPermissionMode:j,startSession:y,pauseSession:c,terminateSession:C,getSession:_,storeInitData:k}}),Ee=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:B},Symbol.toStringTag,{value:"Module"})),Z=pe("ui",()=>{const s=E(window.innerWidth<768),t=E(300),i=E(window.innerWidth),a=u(()=>i.value<768),o=E(!0),n=E(null),p=E(null),v=u(()=>n.value?{name:n.value,data:p.value}:null),d=E(!1),m=E("Loading...");function g(){s.value=!s.value}function $(_){s.value=_}function b(_){t.value=Math.max(200,Math.min(_,window.innerWidth*.3))}function h(_){o.value=_}function M(_,k=null){n.value=null,p.value=null,setTimeout(()=>{n.value=_,p.value=k},0)}function j(){n.value=null,p.value=null}function y(_="Loading..."){d.value=!0,m.value=_}function c(){d.value=!1}function C(){const _=i.value;i.value=window.innerWidth,i.value<768&&_>=768?s.value=!0:i.value>=768&&_<768&&(s.value=!1)}return{sidebarCollapsed:s,sidebarWidth:t,isMobile:a,autoScrollEnabled:o,activeModal:n,modalData:p,currentModal:v,isLoading:d,loadingMessage:m,toggleSidebar:g,setSidebarCollapsed:$,setSidebarWidth:b,setAutoScroll:h,showModal:M,hideModal:j,showLoading:y,hideLoading:c,handleResize:C}}),ee=pe("project",()=>{const s=E(new Map),t=E(null),i=u(()=>s.value.get(t.value)),a=u(()=>Array.from(s.value.values()).sort((j,y)=>j.order-y.order)),o=j=>s.value.get(j)?.is_multi_agent||!1;async function n(){try{const j=await V.get("/api/projects");return s.value.clear(),j.projects.forEach(y=>{s.value.set(y.project_id,y)}),console.log(`Loaded ${s.value.size} projects`),j.projects}catch(j){throw console.error("Failed to fetch projects:",j),j}}async function p(j,y,c=!1){try{const _=(await V.post("/api/projects",{name:j,working_directory:y,is_multi_agent:c})).project;return s.value.set(_.project_id,_),s.value=new Map(s.value),console.log(`Created project ${_.project_id}`),_}catch(C){throw console.error("Failed to create project:",C),C}}async function v(j,y){try{await V.put(`/api/projects/${j}`,y),d(j,y),console.log(`Updated project ${j}`,y)}catch(c){throw console.error("Failed to update project:",c),c}}function d(j,y){const c=s.value.get(j);c&&(Object.assign(c,y),s.value=new Map(s.value))}async function m(j){try{await V.delete(`/api/projects/${j}`),s.value.delete(j),s.value=new Map(s.value),t.value===j&&(t.value=null),console.log(`Deleted project ${j}`)}catch(y){throw console.error("Failed to delete project:",y),y}}async function g(j){try{const y=await V.put(`/api/projects/${j}/toggle-expansion`),c=s.value.get(j);return c&&(c.is_expanded=y.is_expanded,s.value=new Map(s.value)),y.is_expanded}catch(y){throw console.error("Failed to toggle expansion:",y),y}}async function $(j){try{await V.put("/api/projects/reorder",{project_ids:j}),j.forEach((y,c)=>{const C=s.value.get(y);C&&(C.order=c)}),s.value=new Map(s.value),console.log("Reordered projects",j)}catch(y){throw console.error("Failed to reorder projects:",y),y}}async function b(j,y){try{await V.put(`/api/projects/${j}/sessions/reorder`,{session_ids:y});const c=s.value.get(j);c&&(c.session_ids=y,s.value=new Map(s.value)),console.log(`Reordered sessions in project ${j}`,y)}catch(c){throw console.error("Failed to reorder sessions:",c),c}}function h(j){return s.value.get(j)}function M(j){if(!j)return"";const y=j.split(/[/\\]/).filter(c=>c);return y.length===0?"/":y.length===1?`/${y[0]}`:y.length===2?`/${y.join("/")}`:`.../${y.slice(-2).join("/")}`}return{projects:s,currentProjectId:t,currentProject:i,orderedProjects:a,isMultiAgent:o,fetchProjects:n,createProject:p,updateProject:v,updateProjectLocal:d,deleteProject:m,toggleExpansion:g,reorderProjects:$,reorderSessionsInProject:b,getProject:h,formatPath:M}}),q=(s,t)=>{const i=s.__vccOpts||s;for(const[a,o]of t)i[a]=o;return i},Xe={class:"session-header border-bottom p-3"},et={class:"project-name"},tt=["title"],st={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,i=B(),a=ee(),o=u(()=>i.sessions.get(t.sessionId)),n=u(()=>o.value?.name||t.sessionId),p=u(()=>{for(const d of a.projects.values())if(d.session_ids?.includes(t.sessionId))return d;return null}),v=u(()=>p.value?.name||"Unknown Project");return(d,m)=>(l(),r("div",Xe,[e("div",null,[e("div",et,f(v.value),1),e("div",{class:"session-name",title:s.sessionId},f(n.value),9,tt)])]))}},ot=q(st,[["__scopeId","data-v-89e9c269"]]),nt={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},lt=["title"],at={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},rt={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,i=B(),a=u(()=>i.sessions.get(t.sessionId)),o=u(()=>a.value?a.value.state==="paused"&&a.value.is_processing?"pending-prompt":a.value.is_processing?"processing":a.value.state:"unknown"),n=u(()=>{const d=o.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[d]||"#d3d3d3"}),p=u(()=>{const d=o.value;return d==="starting"||d==="processing"||d==="pending-prompt"}),v=u(()=>{if(!a.value)return"No session selected";const d=o.value,m=d.charAt(0).toUpperCase()+d.slice(1).replace("-"," "),g=a.value.name||"Unnamed Session",$=a.value.is_minion&&a.value.role?` (${a.value.role})`:"";return`${g}${$}: ${m}`});return(d,m)=>(l(),r("div",nt,[a.value?(l(),r("div",{key:0,class:W(["progress-bar",{"progress-bar-striped progress-bar-animated":p.value}]),style:re({width:"100%",backgroundColor:n.value}),title:v.value},null,14,lt)):(l(),r("div",at))]))}},it=q(rt,[["__scopeId","data-v-e8795bb7"]]),dt={class:"session-status-bar border-top p-2 bg-light"},ut={class:"d-flex justify-content-between align-items-center gap-2"},ct={class:"d-flex gap-2"},mt=["disabled"],pt={class:"mode-label"},vt=["disabled"],ft=["disabled"],gt={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,i=B(),a=Z(),o=u(()=>i.sessions.get(t.sessionId)),n=u(()=>o.value?.current_permission_mode||"default"),p={default:"🔒",acceptEdits:"✏️",plan:"📋",bypassPermissions:"☢️"},v=u(()=>p[n.value]||"🔒"),d=u(()=>n.value),m=["default","acceptEdits","plan"],g=async()=>{if(!o.value)return;if(n.value==="bypassPermissions"){try{await i.setPermissionMode(t.sessionId,"default")}catch(c){console.error("Failed to cycle permission mode:",c)}return}const j=(m.indexOf(n.value)+1)%m.length,y=m[j];try{await i.setPermissionMode(t.sessionId,y)}catch(c){console.error("Failed to cycle permission mode:",c)}},$=()=>{a.showModal("session-info",{sessionId:t.sessionId})},b=()=>{a.showModal("manage-session",{session:o.value})},h=()=>{a.setAutoScroll(!a.autoScrollEnabled)};return(M,j)=>(l(),r("div",dt,[e("div",ut,[e("div",ct,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:g,disabled:!o.value},[H(f(v.value)+" ",1),e("span",pt,f(d.value),1)],8,mt),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:$,disabled:!o.value},[...j[0]||(j[0]=[H(" ℹ️ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,vt),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:b,disabled:!o.value},[...j[1]||(j[1]=[H(" ⚙️ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,ft)]),e("div",null,[e("button",{class:W(["btn btn-sm",ge(a).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:h}," ⬇️ "+f(ge(a).autoScrollEnabled?"ON":"OFF"),3)])])]))}},_t=q(gt,[["__scopeId","data-v-fdcd3535"]]),ue=pe("message",()=>{const s=E(new Map),t=E(new Map),i=E(new Map),a=E(new Map),o=E(new Map),n=E(new Map),p=u(()=>{const P=B();return s.value.get(P.currentSessionId)||[]}),v=u(()=>{const P=B();return t.value.get(P.currentSessionId)||[]});async function d(P,S=null,L=0){try{const D=S||1e4,T=await V.get(`/api/sessions/${P}/messages?limit=${D}&offset=${L}`),A=T.messages||[],R=T.total_count||A.length,F=T.has_more||!1;console.log(`Loaded ${A.length} of ${R} messages for session ${P}`),s.value.set(P,A);const U=new Set;A.forEach(z=>{z.type==="assistant"&&z.metadata?.tool_uses&&z.metadata.tool_uses.forEach(te=>{U.add(te.id)}),z.type==="user"&&z.metadata?.tool_results&&z.metadata.tool_results.forEach(te=>{U.delete(te.tool_use_id);const je=n.value.get(P);je&&je.delete(te.tool_use_id)}),z.type==="system"&&z.metadata?.subtype==="client_launched"&&(U.forEach(te=>{_(P,te,"Session was restarted")}),U.clear()),z.type==="system"&&z.metadata?.subtype==="interrupt"&&(U.forEach(te=>{_(P,te,"Session was interrupted")}),U.clear()),z.metadata?.has_tool_uses&&z.metadata.tool_uses&&z.metadata.tool_uses.forEach(te=>{h(P,te)}),z.metadata?.has_tool_results&&z.metadata.tool_results&&z.metadata.tool_results.forEach(te=>{y(P,te)}),(z.type==="permission_request"||z.metadata?.has_permission_requests)&&M(P,z),z.type==="system"&&(z.subtype==="init"||z.metadata?.subtype==="init")&&z.metadata?.init_data&&B().storeInitData(P,z.metadata.init_data)});const xe=B().sessions.get(P);return xe&&!["active","paused","starting"].includes(xe.state)&&(U.forEach(z=>{_(P,z,"Session was terminated")}),U.clear()),o.value.set(P,U),s.value=new Map(s.value),F&&console.warn(`Warning: Only loaded ${A.length} of ${R} messages. Some messages may be missing.`),{messages:A,totalCount:R,hasMore:F}}catch(D){throw console.error("Failed to load messages:",D),D}}function m(P,S){const L=o.value.get(P)||new Set;S.type==="assistant"&&S.metadata?.tool_uses&&S.metadata.tool_uses.forEach(D=>{L.add(D.id)}),S.type==="user"&&S.metadata?.tool_results&&S.metadata.tool_results.forEach(D=>{L.delete(D.tool_use_id);const T=n.value.get(P);T&&T.delete(D.tool_use_id)}),S.type==="system"&&S.metadata?.subtype==="client_launched"&&(L.forEach(D=>{_(P,D,"Session was restarted")}),L.clear()),S.type==="system"&&S.metadata?.subtype==="interrupt"&&(L.forEach(D=>{_(P,D,"Session was interrupted")}),L.clear()),o.value.set(P,L)}function g(P,S){s.value.has(P)||s.value.set(P,[]),s.value.get(P).push(S),m(P,S),s.value=new Map(s.value)}function $(P,S){t.value.has(P)||t.value.set(P,[]),t.value.get(P).push(S),t.value=new Map(t.value)}function b(P,S,L){const D=t.value.get(P);if(D){const T=D.find(A=>A.id===S);T&&(Object.assign(T,L),t.value=new Map(t.value))}}function h(P,S){const L=C(S.name,S.input);i.value.set(L,S.id);const D={id:S.id,name:S.name,input:S.input,signature:L,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return $(P,D),console.log(`Created tool call ${D.id} for ${D.name}`),D}function M(P,S){console.log("handlePermissionRequest received:",S);const L=S.metadata?.tool_name||S.tool_name,D=S.metadata?.input_params||S.input_params,T=S.metadata?.request_id||S.request_id,A=S.metadata?.suggestions||S.suggestions||[];console.log("Extracted data:",{toolName:L,inputParams:D,requestId:T,suggestions:A});const R=C(L,D),F=i.value.get(R);F?(a.value.set(T,F),b(P,F,{status:"permission_required",permissionRequestId:T,suggestions:A}),console.log(`Permission required for tool ${F}`,{suggestions:A})):console.warn("No tool use ID found for permission request signature:",R,{toolName:L,inputParams:D,availableSignatures:Array.from(i.value.keys())})}function j(P,S){const L=a.value.get(S.request_id);if(L){const D={permissionDecision:S.decision,appliedUpdates:S.applied_updates||[]};S.decision==="allow"?D.status="executing":(D.status="completed",D.result={error:!0,message:S.reasoning||"Permission denied"},D.isExpanded=!1),b(P,L,D),console.log(`Permission ${S.decision} for tool ${L}`)}}function y(P,S){const L=S.tool_use_id;b(P,L,{status:S.is_error?"error":"completed",result:{error:S.is_error,content:S.content},isExpanded:!1}),console.log(`Tool ${L} ${S.is_error?"failed":"completed"}`)}function c(P,S){const L=t.value.get(P);if(L){const D=L.find(T=>T.id===S);D&&(D.isExpanded=!D.isExpanded,t.value=new Map(t.value))}}function C(P,S){if(!P)return"unknown:{}";if(!S||typeof S!="object")return`${P}:{}`;const L=JSON.stringify(S,Object.keys(S).sort());return`${P}:${L}`}function _(P,S,L){const D=n.value.get(P)||new Map;D.set(S,{reason:"denied",message:L}),n.value.set(P,D);const T=t.value.get(P);if(T){const A=T.find(R=>R.id===S);A&&A.isExpanded&&(A.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${S} as orphaned: ${L}`)}function k(P,S){return n.value.get(P)?.has(S)||!1}function w(P,S){return n.value.get(P)?.get(S)}function x(P,S){const L=o.value.get(P);L&&L.size>0&&(L.forEach(D=>_(P,D,S)),L.clear())}function N(P){s.value.delete(P),t.value.delete(P),s.value=new Map(s.value),t.value=new Map(t.value)}const O=B();return Q(()=>Array.from(O.sessions.values()).map(S=>({id:S.session_id,state:S.state})),(P,S)=>{S&&P.forEach((L,D)=>{const T=S[D];if(!T||T.id!==L.id)return;const A=["active","paused","starting"].includes(T.state),R=!["active","paused","starting"].includes(L.state);A&&R&&x(L.id,"Session was terminated")})},{deep:!0}),{messagesBySession:s,toolCallsBySession:t,activeToolUses:Me(o),orphanedToolUses:Me(n),currentMessages:p,currentToolCalls:v,loadMessages:d,addMessage:g,addToolCall:$,updateToolCall:b,handleToolUse:h,handlePermissionRequest:M,handlePermissionResponse:j,handleToolResult:y,toggleToolExpansion:c,clearMessages:N,markToolUseOrphaned:_,isToolUseOrphaned:k,getOrphanedInfo:w,clearOrphanedToolUses:x}}),bt=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:ue},Symbol.toStringTag,{value:"Module"}));function ht(s){if(!s)return new Date;if(typeof s=="string"){const t=new Date(s);return isNaN(t.getTime())?new Date:t}return typeof s=="number"?s<1e10?new Date(s*1e3):new Date(s):new Date}function _e(s){return ht(s).toLocaleTimeString()}const yt={class:"card user-message bg-light border-start border-primary border-3"},$t={class:"card-body"},wt={class:"d-flex justify-content-between align-items-center mb-2"},St={class:"text-muted"},kt=["innerHTML"],Ct={key:0,class:"tool-results mt-3"},xt={class:"tool-results-header text-muted small mb-2"},jt={class:"d-flex align-items-start gap-2"},Mt={class:"flex-grow-1"},Tt={class:"text-muted"},Et={key:0,class:"text-danger small"},It={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s;ve.setOptions({breaks:!0,gfm:!0});const i=u(()=>_e(t.message.timestamp)),a=u(()=>{const v=t.message.content||"",d=ve.parse(v);return Se.sanitize(d)}),o=u(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),n=u(()=>t.message.metadata?.tool_results||[]);function p(v,d){return v?v.length<=d?v:v.substring(0,d)+"...":""}return(v,d)=>(l(),r("div",yt,[e("div",$t,[e("div",wt,[d[0]||(d[0]=e("div",{class:"d-flex align-items-center gap-2"},[e("span",{class:"message-icon"},"👤"),e("strong",{class:"message-role"},"User")],-1)),e("small",St,f(i.value),1)]),e("div",{class:"message-content",innerHTML:a.value},null,8,kt),o.value?(l(),r("div",Ct,[e("div",xt,[d[1]||(d[1]=e("i",{class:"bi bi-tools"},null,-1)),H(" Tool Results ("+f(n.value.length)+") ",1)]),(l(!0),r(G,null,Y(n.value,(m,g)=>(l(),r("div",{key:g,class:W(["tool-result-summary p-2 mb-2 rounded",m.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",jt,[e("span",null,f(m.is_error?"❌":"✅"),1),e("div",Mt,[e("small",Tt,"Tool: "+f(m.tool_use_id),1),m.is_error?(l(),r("div",Et,f(p(m.content,200)),1)):I("",!0)])])],2))),128))])):I("",!0)])]))}},Pt=q(It,[["__scopeId","data-v-532549d1"]]),Lt={class:"thinking-block"},Dt={class:"text-muted ms-auto"},Ot={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},Nt=["innerHTML"],At={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(s){const t=s,i=E(!1),a=u(()=>t.thinking?.length||0),o=u(()=>{const p=t.thinking||"",v=ve.parse(p);return Se.sanitize(v)});function n(){i.value=!i.value}return(p,v)=>(l(),r("div",Lt,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:n},[e("i",{class:W(["bi",i.value?"bi-chevron-down":"bi-chevron-right"])},null,2),v[0]||(v[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),H(" Thinking ")],-1)),e("small",Dt,f(a.value)+" characters",1)]),i.value?(l(),r("div",Ot,[e("div",{class:"thinking-text",innerHTML:o.value},null,8,Nt)])):I("",!0)]))}},Rt=q(At,[["__scopeId","data-v-619a8344"]]),ce=pe("websocket",()=>{const s=E(null),t=E(!1),i=E(0),a=10,o=E(null),n=E(!1),p=E(0),v=5,d=E(null);let m=null;const g=E(null),$=E(!1),b=E(0),h=5,M=E(null),j=u(()=>t.value&&(n.value||!d.value)?"connected":t.value?"partial":"disconnected");function y(T){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${T}`}function c(){if(s.value)return;const T=y("/ws/ui");console.log(`Connecting to UI WebSocket: ${T}`),s.value=new WebSocket(T),s.value.onopen=()=>{t.value=!0,i.value=0,console.log("UI WebSocket connected")},s.value.onmessage=A=>{const R=JSON.parse(A.data);O(R)},s.value.onclose=()=>{if(t.value=!1,s.value=null,console.log("UI WebSocket closed"),i.value<a){i.value++;const A=Math.min(2e3*i.value,3e4);console.log(`Reconnecting UI WebSocket in ${A}ms (attempt ${i.value})`),setTimeout(c,A)}},s.value.onerror=A=>{console.error("UI WebSocket error:",A)}}function C(){s.value&&(s.value.close(),s.value=null,t.value=!1)}function _(T){m&&(clearTimeout(m),m=null),k(),d.value=T;const A=y(`/ws/session/${T}`);console.log(`Connecting to Session WebSocket: ${A}`),o.value=new WebSocket(A),o.value.onopen=()=>{n.value=!0,p.value=0,console.log(`Session WebSocket connected for ${T}`)},o.value.onmessage=R=>{const F=JSON.parse(R.data);P(F,T)},o.value.onclose=()=>{if(n.value=!1,o.value=null,console.log(`Session WebSocket closed for ${T}`),B().currentSessionId===T&&p.value<v){p.value++;const F=Math.min(2e3*p.value,3e4);console.log(`Reconnecting Session WebSocket in ${F}ms (attempt ${p.value})`),m=setTimeout(()=>{m=null,_(T)},F)}},o.value.onerror=R=>{console.error("Session WebSocket error:",R)}}function k(){return new Promise(T=>{if(m&&(clearTimeout(m),m=null,console.log("Cancelled pending session reconnect timer")),o.value){const A=()=>{o.value=null,n.value=!1,d.value=null,p.value=0,T()};o.value.readyState===WebSocket.CLOSED?A():(o.value.addEventListener("close",A,{once:!0}),o.value.close())}else T()})}function w(T){o.value&&n.value?(o.value.send(JSON.stringify({type:"send_message",content:T})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function x(T,A,R=!1,F=null){if(o.value&&n.value){const U={type:"permission_response",request_id:T,decision:A,apply_suggestions:R,timestamp:new Date().toISOString()};F&&(U.clarification_message=F),o.value.send(JSON.stringify(U)),console.log(`Sent permission ${A} for request ${T}`,{applySuggestions:R,clarification:F})}}function N(){o.value&&n.value&&(o.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function O(T){const A=B(),R=ee();switch(T.type){case"sessions_list":T.sessions&&Array.isArray(T.sessions)&&T.sessions.forEach(F=>{A.updateSession(F.session_id,F)});break;case"state_change":T.data&&T.data.session_id&&T.data.session&&A.updateSession(T.data.session_id,T.data.session);break;case"project_updated":if(T.data&&T.data.project){const F=T.data.project;R.updateProjectLocal(F.project_id,F)}break;case"project_deleted":T.data&&T.data.project_id&&R.projects.delete(T.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":s.value?.readyState===WebSocket.OPEN&&s.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",T.type)}}function P(T,A){const R=ue(),F=B();switch(T.type){case"message":const U=T.data;if(!U||!U.type){console.warn("Received message event with invalid data:",T);break}if(U.type==="permission_request"){R.handlePermissionRequest(A,U);break}if(U.type==="permission_response"){R.handlePermissionResponse(A,U);break}U.metadata?.has_tool_uses&&U.metadata.tool_uses.forEach(me=>{R.handleToolUse(A,me)}),U.metadata?.has_tool_results&&U.metadata.tool_results.forEach(me=>{R.handleToolResult(A,me)}),U.type==="system"&&(U.subtype==="init"||U.metadata?.subtype==="init")&&U.metadata?.init_data&&F.storeInitData(A,U.metadata.init_data),R.addMessage(A,U);break;case"permission_request":R.handlePermissionRequest(A,T);break;case"permission_response":R.handlePermissionResponse(A,T);break;case"tool_result":R.handleToolResult(A,T);break;case"state_change":F.updateSession(A,T.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${A}`);break;case"ping":o.value?.readyState===WebSocket.OPEN&&o.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function S(T){L(),M.value=T;const A=y(`/ws/legion/${T}`);console.log(`Connecting to Legion WebSocket: ${A}`),g.value=new WebSocket(A),g.value.onopen=()=>{$.value=!0,b.value=0,console.log(`Legion WebSocket connected for ${T}`)},g.value.onmessage=R=>{const F=JSON.parse(R.data);D(F,T)},g.value.onclose=()=>{if($.value=!1,g.value=null,console.log(`Legion WebSocket closed for ${T}`),M.value===T&&b.value<h){b.value++;const R=Math.min(2e3*b.value,3e4);setTimeout(()=>S(T),R)}},g.value.onerror=R=>{console.error("Legion WebSocket error:",R)}}function L(){g.value&&(g.value.close(),g.value=null,$.value=!1,M.value=null)}function D(T,A){se(async()=>{const{useLegionStore:R}=await Promise.resolve().then(()=>Ha);return{useLegionStore:R}},void 0).then(({useLegionStore:R})=>{const F=R();switch(T.type){case"comm":T.comm&&(F.addComm(A,T.comm),console.log("Legion WebSocket: Received new comm",T.comm));break;case"minion_created":T.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",T.data),se(async()=>{const{useSessionStore:U}=await Promise.resolve().then(()=>Ee);return{useSessionStore:U}},void 0).then(({useSessionStore:U})=>{U().loadSessions()}));break;case"minion_updated":T.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",T.data),se(async()=>{const{useSessionStore:U}=await Promise.resolve().then(()=>Ee);return{useSessionStore:U}},void 0).then(({useSessionStore:U})=>{U().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${A}`);break;case"ping":g.value?.readyState===WebSocket.OPEN&&g.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",T.type)}})}return{uiConnected:t,sessionConnected:n,legionConnected:$,overallStatus:j,connectUI:c,disconnectUI:C,connectSession:_,disconnectSession:k,sendMessage:w,sendPermissionResponse:x,interruptSession:N,connectLegion:S,disconnectLegion:L}}),qt=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:ce},Symbol.toStringTag,{value:"Module"})),Ut={class:"base-tool-handler"},Ht={class:"tool-section mb-3"},Wt={class:"tool-parameters"},Ft={class:"tool-code"},Bt={key:0,class:"tool-section"},Vt={class:"tool-section-label"},zt={class:"tool-code"},Jt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),a=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),o=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),n=u(()=>{if(!a.value)return"";const p=t.toolCall.result;return p.content!==void 0?typeof p.content=="string"?p.content:JSON.stringify(p.content,null,2):p.message?p.message:JSON.stringify(p,null,2)});return(p,v)=>(l(),r("div",Ut,[e("div",Ht,[v[0]||(v[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Wt,[e("pre",Ft,f(i.value),1)])]),a.value?(l(),r("div",Bt,[e("div",Vt,f(o.value?"Error:":"Result:"),1),e("div",{class:W(["tool-result",{"tool-result-error":o.value}])},[e("pre",zt,f(n.value),1)],2)])):I("",!0)]))}},Kt=q(Jt,[["__scopeId","data-v-06a1b6c0"]]),Gt={class:"read-tool-handler"},Yt={class:"tool-section mb-3"},Qt={class:"read-file-info"},Zt={class:"file-path"},Xt={key:0,class:"read-range"},es={key:0,class:"tool-section"},ts={key:0,class:"tool-result tool-result-error"},ss={class:"tool-code"},os={key:1,class:"file-content-preview"},ns={class:"content-header"},ls={class:"line-count-badge"},as={key:0,class:"preview-note"},rs={class:"tool-code content-display"},is={key:0,class:"more-indicator"},he=100,ds={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.file_path||"Unknown"),a=u(()=>{const h=t.toolCall.input?.offset,M=t.toolCall.input?.limit;return h!==void 0||M!==void 0}),o=u(()=>{const h=t.toolCall.input?.offset;return h!==void 0?h+1:1}),n=u(()=>{const h=t.toolCall.input?.offset||0,M=t.toolCall.input?.limit;return M!==void 0?h+M:"∞"}),p=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),d=u(()=>{if(!p.value)return"";const h=t.toolCall.result;return h.content!==void 0?typeof h.content=="string"?h.content:JSON.stringify(h.content,null,2):h.message?h.message:JSON.stringify(h,null,2)}),m=u(()=>v.value||!d.value?[]:d.value.split(`
`)),g=u(()=>m.value.length),$=u(()=>g.value>he),b=u(()=>v.value?"":m.value.slice(0,he).join(`
`));return(h,M)=>(l(),r("div",Gt,[e("div",Yt,[e("div",Qt,[M[0]||(M[0]=e("span",{class:"file-icon"},"📄",-1)),M[1]||(M[1]=e("strong",null,"Reading:",-1)),e("code",Zt,f(i.value),1),a.value?(l(),r("span",Xt,"Lines "+f(o.value)+"-"+f(n.value),1)):I("",!0)])]),p.value?(l(),r("div",es,[v.value?(l(),r("div",ts,[e("pre",ss,f(d.value),1)])):(l(),r("div",os,[e("div",ns,[M[2]||(M[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",ls,f(g.value)+" lines",1),$.value?(l(),r("span",as,"(showing first "+f(he)+")")):I("",!0)]),e("pre",rs,f(b.value),1),$.value?(l(),r("div",is,"...")):I("",!0)]))])):I("",!0)]))}},us=q(ds,[["__scopeId","data-v-0382f812"]]),cs={class:"write-tool-handler"},ms={class:"tool-section mb-3"},ps={class:"write-file-info mb-2"},vs={class:"file-path"},fs={class:"write-content-preview"},gs={class:"content-header"},_s={class:"line-count-badge"},bs={key:0,class:"preview-note"},hs={class:"tool-code content-display"},ys={key:0,class:"more-indicator"},$s={key:0,class:"tool-section"},ws={key:0,class:"tool-result tool-result-error"},Ss={class:"tool-code"},ks={key:1,class:"tool-result tool-result-success"},Cs={class:"success-message"},ye=100,xs={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.file_path||"Unknown"),a=u(()=>t.toolCall.input?.content||""),o=u(()=>a.value.split(`
`)),n=u(()=>o.value.length),p=u(()=>n.value>ye),v=u(()=>o.value.slice(0,ye).join(`
`)),d=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),m=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),g=u(()=>{if(!d.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)});return($,b)=>(l(),r("div",cs,[e("div",ms,[e("div",ps,[b[0]||(b[0]=e("span",{class:"file-icon"},"📝",-1)),b[1]||(b[1]=e("strong",null,"Writing:",-1)),e("code",vs,f(i.value),1)]),e("div",fs,[e("div",gs,[b[2]||(b[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",_s,f(n.value)+" lines",1),p.value?(l(),r("span",bs,"(showing first "+f(ye)+")")):I("",!0)]),e("pre",hs,f(v.value),1),p.value?(l(),r("div",ys,"...")):I("",!0)])]),d.value?(l(),r("div",$s,[m.value?(l(),r("div",ws,[b[3]||(b[3]=e("strong",null,"Error:",-1)),e("pre",Ss,f(g.value),1)])):(l(),r("div",ks,[e("div",Cs,[b[4]||(b[4]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"File created successfully ("+f(n.value)+" lines written)",1)])]))])):I("",!0)]))}},js=q(xs,[["__scopeId","data-v-d09b89ef"]]),Ms={class:"bash-tool-handler"},Ts={class:"tool-section mb-3"},Es={class:"bash-header"},Is={class:"bash-header-content"},Ps={key:0,class:"bash-description"},Ls={key:1,class:"bash-flags"},Ds={class:"bash-command-section"},Os={class:"bash-command-content"},Ns={key:0,class:"tool-section"},As={key:0,class:"bash-output"},Rs={key:1,class:"bash-output-empty"},qs={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.command||""),a=u(()=>t.toolCall.input?.description||""),o=u(()=>t.toolCall.input?.timeout),n=u(()=>t.toolCall.input?.run_in_background||!1),p=u(()=>o.value||n.value),v=u(()=>{const b=[];return o.value&&b.push(`timeout: ${o.value}ms`),n.value&&b.push("background"),b.join(", ")}),d=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),m=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),g=u(()=>m.value?"tool-result-error":"tool-result-success"),$=u(()=>{if(!d.value)return"";const b=t.toolCall.result;return b.content!==void 0?typeof b.content=="string"?b.content:JSON.stringify(b.content,null,2):b.message?b.message:JSON.stringify(b,null,2)});return(b,h)=>(l(),r("div",Ms,[e("div",Ts,[e("div",Es,[h[1]||(h[1]=e("span",{class:"bash-icon"},"💻",-1)),e("div",Is,[a.value?(l(),r("div",Ps,[h[0]||(h[0]=e("strong",null,"Description:",-1)),H(" "+f(a.value),1)])):I("",!0),p.value?(l(),r("div",Ls,f(v.value),1)):I("",!0)])]),e("div",Ds,[h[2]||(h[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",Os,f(i.value),1)])]),d.value?(l(),r("div",Ns,[e("div",{class:W(["tool-result",g.value])},[h[3]||(h[3]=e("strong",null,"Output:",-1)),$.value?(l(),r("pre",As,f($.value),1)):(l(),r("div",Rs,"No output"))],2)])):I("",!0)]))}},Us=q(qs,[["__scopeId","data-v-dc93bb16"]]),Hs={class:"todo-tool-handler"},Ws={class:"tool-section mb-3"},Fs={class:"todo-header"},Bs={class:"todo-summary"},Vs={key:0,class:"todo-count todo-count-completed"},zs={key:1,class:"todo-count todo-count-in-progress"},Js={key:2,class:"todo-count todo-count-pending"},Ks={class:"todo-checklist"},Gs={class:"todo-checkbox"},Ys={class:"todo-content"},Qs={key:0,class:"tool-section"},Zs={key:0,class:"tool-result tool-result-error"},Xs={class:"tool-code"},eo={key:1,class:"tool-result tool-result-success"},to={class:"success-message"},so={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.todos||[]),a=u(()=>i.value.filter(g=>g.status==="completed").length),o=u(()=>i.value.filter(g=>g.status==="in_progress").length),n=u(()=>i.value.filter(g=>g.status==="pending").length);function p(g){return{pending:"☐",in_progress:"◐",completed:"☑"}[g]||"☐"}const v=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),d=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),m=u(()=>{if(!v.value)return"";const g=t.toolCall.result;return g.content!==void 0?typeof g.content=="string"?g.content:JSON.stringify(g.content,null,2):g.message?g.message:JSON.stringify(g,null,2)});return(g,$)=>(l(),r("div",Hs,[e("div",Ws,[e("div",Fs,[$[0]||($[0]=e("span",{class:"todo-icon"},"📋",-1)),$[1]||($[1]=e("strong",null,"Task List:",-1)),e("div",Bs,[a.value>0?(l(),r("span",Vs,f(a.value)+" completed ",1)):I("",!0),o.value>0?(l(),r("span",zs,f(o.value)+" in progress ",1)):I("",!0),n.value>0?(l(),r("span",Js,f(n.value)+" pending ",1)):I("",!0)])]),e("div",Ks,[(l(!0),r(G,null,Y(i.value,(b,h)=>(l(),r("div",{key:h,class:W(["todo-item",`todo-${b.status}`])},[e("span",Gs,f(p(b.status)),1),e("span",Ys,f(b.content),1)],2))),128))])]),v.value?(l(),r("div",Qs,[d.value?(l(),r("div",Zs,[$[2]||($[2]=e("strong",null,"Error:",-1)),e("pre",Xs,f(m.value),1)])):(l(),r("div",eo,[e("div",to,[$[3]||($[3]=e("span",{class:"success-icon"},"✅",-1)),e("strong",null,"Task list updated ("+f(i.value.length)+" tasks)",1)])]))])):I("",!0)]))}},oo=q(so,[["__scopeId","data-v-0984bcf9"]]),no={class:"edit-tool-handler"},lo={class:"tool-section mb-3"},ao={class:"edit-file-info"},ro={class:"file-path"},io={key:0,class:"replace-all-badge"},uo={class:"edit-diff-container"},co={class:"diff-header"},mo={class:"diff-stats"},po={class:"stat-removed"},vo={class:"stat-added"},fo={class:"unified-diff"},go={class:"diff-scroll-container"},_o={class:"diff-marker"},bo={class:"diff-content"},ho={key:0,class:"tool-section"},yo={key:0,class:"tool-result tool-result-error"},$o={class:"tool-code"},wo={key:1,class:"tool-result tool-result-success"},So={class:"success-message"},ko={key:0,class:"success-detail"},Co={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.file_path||"Unknown"),a=u(()=>t.toolCall.input?.old_string||""),o=u(()=>t.toolCall.input?.new_string||""),n=u(()=>t.toolCall.input?.replace_all||!1),p=u(()=>{const h=Be(i.value,a.value,o.value,"","",{context:3}).split(`
`),M=[];for(let j=4;j<h.length;j++){const y=h[j];y&&(y.startsWith("-")?M.push({type:"removed",content:y.substring(1)}):y.startsWith("+")?M.push({type:"added",content:y.substring(1)}):y.startsWith(" ")?M.push({type:"context",content:y.substring(1)}):y.startsWith("@@")&&M.push({type:"hunk",content:y}))}return M}),v=u(()=>p.value.filter(b=>b.type==="removed").length),d=u(()=>p.value.filter(b=>b.type==="added").length),m=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),g=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),$=u(()=>{if(!m.value)return"";const b=t.toolCall.result;return b.content!==void 0?typeof b.content=="string"?b.content:JSON.stringify(b.content,null,2):b.message?b.message:JSON.stringify(b,null,2)});return(b,h)=>(l(),r("div",no,[e("div",lo,[e("div",ao,[h[0]||(h[0]=e("span",{class:"file-icon"},"✏️",-1)),h[1]||(h[1]=e("strong",null,"Editing:",-1)),e("code",ro,f(i.value),1),n.value?(l(),r("span",io,"Replace All")):I("",!0)]),e("div",uo,[e("div",co,[h[2]||(h[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",mo,[e("span",po,"-"+f(v.value),1),e("span",vo,"+"+f(d.value),1)])]),e("div",fo,[e("div",go,[(l(!0),r(G,null,Y(p.value,(M,j)=>(l(),r("div",{key:j,class:W(["diff-line",{"diff-line-removed":M.type==="removed","diff-line-added":M.type==="added","diff-line-context":M.type==="context","diff-line-hunk":M.type==="hunk"}])},[e("span",_o,f(M.type==="removed"?"-":M.type==="added"?"+":M.type==="hunk"?"@":" "),1),e("span",bo,f(M.content),1)],2))),128))])])])]),m.value?(l(),r("div",ho,[g.value?(l(),r("div",yo,[h[3]||(h[3]=e("strong",null,"Error:",-1)),e("pre",$o,f($.value),1)])):(l(),r("div",wo,[e("div",So,[h[4]||(h[4]=e("span",{class:"success-icon"},"✅",-1)),h[5]||(h[5]=e("strong",null,"File edited successfully",-1)),n.value?(l(),r("span",ko,"(all occurrences replaced)")):I("",!0)])]))])):I("",!0)]))}},xo=q(Co,[["__scopeId","data-v-b06adbf2"]]),jo={class:"search-tool-handler"},Mo={class:"tool-section mb-3"},To={class:"search-info"},Eo={class:"search-icon"},Io={class:"search-pattern"},Po={key:0,class:"search-path"},Lo={key:1,class:"search-filters"},Do={key:0,class:"filter-badge"},Oo={key:1,class:"filter-badge"},No={key:2,class:"filter-badge"},Ao={key:0,class:"tool-section"},Ro={key:0,class:"tool-result tool-result-error"},qo={class:"tool-code"},Uo={key:1,class:"search-results"},Ho={class:"results-header"},Wo={class:"results-label"},Fo={class:"results-count-badge"},Bo={class:"results-content"},Vo={class:"tool-code"},zo={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.name==="Grep");u(()=>t.toolCall.name==="Glob");const a=u(()=>t.toolCall.input?.pattern||"Unknown"),o=u(()=>t.toolCall.input?.path||null),n=u(()=>t.toolCall.input?.type||null),p=u(()=>t.toolCall.input?.glob||null),v=u(()=>t.toolCall.input?.["-i"]||!1),d=u(()=>n.value||p.value||v.value),m=u(()=>i.value?"🔍":"📁"),g=u(()=>i.value?"Searching content":"Finding files"),$=u(()=>i.value?"Matches":"Files found"),b=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),h=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),M=u(()=>{if(!b.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)}),j=u(()=>!b.value||h.value||!M.value?0:M.value.split(`
`).filter(c=>c.trim()).length);return(y,c)=>(l(),r("div",jo,[e("div",Mo,[e("div",To,[e("span",Eo,f(m.value),1),e("strong",null,f(g.value)+":",1),e("code",Io,f(a.value),1),o.value?(l(),r("span",Po,"in "+f(o.value),1)):I("",!0),d.value?(l(),r("span",Lo,[n.value?(l(),r("span",Do,"type: "+f(n.value),1)):I("",!0),p.value?(l(),r("span",Oo,"glob: "+f(p.value),1)):I("",!0),v.value?(l(),r("span",No,"case-insensitive")):I("",!0)])):I("",!0)])]),b.value?(l(),r("div",Ao,[h.value?(l(),r("div",Ro,[c[0]||(c[0]=e("strong",null,"Error:",-1)),e("pre",qo,f(M.value),1)])):(l(),r("div",Uo,[e("div",Ho,[e("span",Wo,f($.value)+":",1),e("span",Fo,f(j.value)+" "+f(j.value===1?"match":"matches"),1)]),e("div",Bo,[e("pre",Vo,f(M.value),1)])]))])):I("",!0)]))}},Ie=q(zo,[["__scopeId","data-v-dc01ae0d"]]),Jo={class:"web-tool-handler"},Ko={class:"tool-section mb-3"},Go={class:"web-info"},Yo={class:"web-icon"},Qo=["href"],Zo={key:1,class:"web-query"},Xo={key:0,class:"web-prompt-container"},en={class:"prompt-content"},tn={key:1,class:"web-domains"},sn={class:"domains-label"},on={key:0,class:"tool-section"},nn={key:0,class:"tool-result tool-result-error"},ln={class:"tool-code"},an={key:1,class:"web-results"},rn={class:"results-header"},dn={class:"results-label"},un={class:"results-content"},cn={class:"tool-code"},mn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.name==="WebFetch");u(()=>t.toolCall.name==="WebSearch");const a=u(()=>t.toolCall.input?.url||null),o=u(()=>t.toolCall.input?.query||null),n=u(()=>t.toolCall.input?.prompt||null),p=u(()=>t.toolCall.input?.allowed_domains||[]),v=u(()=>t.toolCall.input?.blocked_domains||[]),d=u(()=>p.value.length>0?p.value:v.value.length>0?v.value:[]),m=u(()=>p.value.length>0?"Allowed domains":v.value.length>0?"Blocked domains":"Domains"),g=u(()=>i.value?"🌐":"🔎"),$=u(()=>i.value?"Fetching URL":"Searching web"),b=u(()=>i.value?"Fetched content":"Search results"),h=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),M=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),j=u(()=>{if(!h.value)return"";const y=t.toolCall.result;return y.content!==void 0?typeof y.content=="string"?y.content:JSON.stringify(y.content,null,2):y.message?y.message:JSON.stringify(y,null,2)});return(y,c)=>(l(),r("div",Jo,[e("div",Ko,[e("div",Go,[e("span",Yo,f(g.value),1),e("strong",null,f($.value)+":",1),a.value?(l(),r("a",{key:0,href:a.value,target:"_blank",class:"web-url"},f(a.value),9,Qo)):o.value?(l(),r("code",Zo,f(o.value),1)):I("",!0)]),n.value?(l(),r("div",Xo,[c[0]||(c[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",en,f(n.value),1)])):I("",!0),d.value.length>0?(l(),r("div",tn,[e("span",sn,f(m.value)+":",1),(l(!0),r(G,null,Y(d.value,C=>(l(),r("span",{key:C,class:"domain-badge"},f(C),1))),128))])):I("",!0)]),h.value?(l(),r("div",on,[M.value?(l(),r("div",nn,[c[1]||(c[1]=e("strong",null,"Error:",-1)),e("pre",ln,f(j.value),1)])):(l(),r("div",an,[e("div",rn,[e("span",dn,f(b.value)+":",1)]),e("div",un,[e("pre",cn,f(j.value),1)])]))])):I("",!0)]))}},Pe=q(mn,[["__scopeId","data-v-49e16a90"]]),pn={class:"task-tool-handler"},vn={class:"tool-section mb-3"},fn={class:"task-header"},gn={key:0,class:"agent-type-badge"},_n={key:0,class:"task-description"},bn={class:"description-content"},hn={key:1,class:"task-prompt-container"},yn={class:"prompt-header"},$n={class:"prompt-length"},wn={class:"prompt-code"},Sn={key:0,class:"tool-section"},kn={key:0,class:"tool-result tool-result-error"},Cn={class:"tool-code"},xn={key:1,class:"agent-output"},jn={class:"output-header"},Mn={key:0,class:"output-count-badge"},Tn={class:"output-content"},En={class:"tool-code"},In={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.description||null),a=u(()=>t.toolCall.input?.prompt||null),o=u(()=>t.toolCall.input?.subagent_type||null),n=u(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),p=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),v=u(()=>{if(!n.value)return"";const m=t.toolCall.result;return m.content!==void 0?typeof m.content=="string"?m.content:JSON.stringify(m.content,null,2):m.message?m.message:JSON.stringify(m,null,2)}),d=u(()=>v.value?v.value.split(`
`).length:0);return(m,g)=>(l(),r("div",pn,[e("div",vn,[e("div",fn,[g[0]||(g[0]=e("span",{class:"task-icon"},"🤖",-1)),g[1]||(g[1]=e("strong",null,"Agent Task:",-1)),o.value?(l(),r("span",gn,f(o.value),1)):I("",!0)]),i.value?(l(),r("div",_n,[g[2]||(g[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",bn,f(i.value),1)])):I("",!0),a.value?(l(),r("div",hn,[e("div",yn,[g[3]||(g[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",$n,f(a.value.length)+" characters",1)]),e("pre",wn,f(a.value),1)])):I("",!0)]),n.value?(l(),r("div",Sn,[p.value?(l(),r("div",kn,[g[4]||(g[4]=e("strong",null,"Error:",-1)),e("pre",Cn,f(v.value),1)])):(l(),r("div",xn,[e("div",jn,[g[5]||(g[5]=e("span",{class:"output-label"},"Agent Output:",-1)),d.value>0?(l(),r("span",Mn,f(d.value)+" lines",1)):I("",!0)]),e("div",Tn,[e("pre",En,f(v.value),1)])]))])):I("",!0)]))}},Pn=q(In,[["__scopeId","data-v-513043f9"]]),Ln={class:"notebook-edit-tool-handler"},Dn={class:"tool-section mb-3"},On={class:"notebook-info"},Nn={class:"file-path"},An={class:"cell-info mt-2"},Rn={class:"info-row"},qn={class:"info-row"},Un={key:0,class:"info-row"},Hn={class:"badge bg-info"},Wn={key:0,class:"source-preview mt-3"},Fn={class:"preview-header"},Bn={class:"preview-stats"},Vn={class:"source-code"},zn={key:0,class:"tool-section"},Jn={key:0},Kn={key:1,class:"text-danger"},Gn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.notebook_path||"Unknown"),a=u(()=>t.toolCall.input?.cell_id),o=u(()=>t.toolCall.input?.cell_type||"code"),n=u(()=>t.toolCall.input?.edit_mode||"replace"),p=u(()=>t.toolCall.input?.new_source||""),v=u(()=>p.value.split(`
`).length),d=u(()=>o.value==="code"?"bg-primary":"bg-secondary"),m=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),g=u(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const $=n.value;return $==="insert"?"Cell inserted successfully":$==="delete"?"Cell deleted successfully":"Cell updated successfully"});return($,b)=>(l(),r("div",Ln,[e("div",Dn,[e("div",On,[b[0]||(b[0]=e("span",{class:"notebook-icon"},"📓",-1)),b[1]||(b[1]=e("strong",null,"Notebook:",-1)),e("code",Nn,f(i.value),1)]),e("div",An,[e("div",Rn,[b[2]||(b[2]=e("strong",null,"Cell ID:",-1)),e("code",null,f(a.value||"N/A"),1)]),e("div",qn,[b[3]||(b[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:W(["badge",d.value])},f(o.value),3)]),n.value?(l(),r("div",Un,[b[4]||(b[4]=e("strong",null,"Edit Mode:",-1)),e("span",Hn,f(n.value),1)])):I("",!0)]),p.value?(l(),r("div",Wn,[e("div",Fn,[b[5]||(b[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",Bn,f(v.value)+" lines",1)]),e("pre",Vn,[e("code",null,f(p.value),1)])])):I("",!0)]),s.toolCall.result?(l(),r("div",zn,[b[8]||(b[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:W(["tool-result",m.value])},[s.toolCall.result.success!==!1?(l(),r("div",Jn,[b[6]||(b[6]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+f(g.value),1)])):(l(),r("div",Kn,[b[7]||(b[7]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Operation failed"),1)]))],2)])):I("",!0)]))}},Yn=q(Gn,[["__scopeId","data-v-3261abc1"]]),Qn={class:"shell-tool-handler"},Zn={class:"tool-section mb-3"},Xn={class:"shell-info"},el={class:"shell-icon"},tl={key:0,class:"shell-id"},sl={key:0,class:"filter-info mt-2"},ol={class:"filter-pattern"},nl={key:0,class:"tool-section"},ll={class:"result-header mb-2"},al={key:0,class:"shell-output"},rl={key:0},il={key:1,class:"text-danger"},dl={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.name==="BashOutput"?"📤":t.toolCall.name==="KillShell"?"🛑":"🐚"),a=u(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),o=u(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),n=u(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),p=u(()=>t.toolCall.input?.filter),v=u(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),d=u(()=>t.toolCall.result?.status),m=u(()=>{const b=d.value;return b==="running"?"bg-success":b==="completed"?"bg-secondary":b==="killed"||b==="terminated"?"bg-danger":"bg-info"}),g=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),$=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return(b,h)=>(l(),r("div",Qn,[e("div",Zn,[e("div",Xn,[e("span",el,f(i.value),1),e("strong",null,f(a.value)+":",1),n.value?(l(),r("code",tl,"Shell "+f(n.value),1)):I("",!0)]),s.toolCall.name==="BashOutput"&&p.value?(l(),r("div",sl,[h[0]||(h[0]=e("strong",null,"Filter:",-1)),e("code",ol,f(p.value),1)])):I("",!0)]),s.toolCall.result?(l(),r("div",nl,[e("div",ll,[e("strong",null,f(o.value)+":",1),d.value?(l(),r("span",{key:0,class:W(["badge",m.value])},f(d.value),3)):I("",!0)]),v.value?(l(),r("div",al,[e("pre",null,[e("code",null,f(v.value),1)])])):(l(),r("div",{key:1,class:W(["tool-result",g.value])},[s.toolCall.result.success!==!1?(l(),r("div",rl,[h[1]||(h[1]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+f($.value),1)])):(l(),r("div",il,[h[2]||(h[2]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Operation failed"),1)]))],2))])):I("",!0)]))}},Le=q(dl,[["__scopeId","data-v-fc9da4c0"]]),ul={class:"command-tool-handler"},cl={class:"tool-section mb-3"},ml={class:"command-info"},pl={class:"command-icon"},vl={class:"command-code"},fl={key:0,class:"prompt-info mt-2"},gl={class:"prompt-content"},_l={key:0,class:"tool-section"},bl={key:0},hl={key:1,class:"text-danger"},yl={__name:"CommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.name==="SlashCommand"?"/":t.toolCall.name==="Skill"?"⚡":"🔧"),a=u(()=>t.toolCall.name==="SlashCommand"?"Slash Command":t.toolCall.name==="Skill"?"Skill":"Command"),o=u(()=>t.toolCall.input?.command||"Unknown"),n=u(()=>t.toolCall.result?.prompt||t.toolCall.result?.description),p=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),v=u(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="SlashCommand"?"Slash command executed successfully":t.toolCall.name==="Skill"?"Skill executed successfully":"Command completed");return(d,m)=>(l(),r("div",ul,[e("div",cl,[e("div",ml,[e("span",pl,f(i.value),1),e("strong",null,f(a.value)+":",1),e("code",vl,f(o.value),1)]),n.value?(l(),r("div",fl,[m[0]||(m[0]=e("div",{class:"prompt-header"},[e("strong",null,"Expanded Prompt:")],-1)),e("div",gl,f(n.value),1)])):I("",!0)]),s.toolCall.result?(l(),r("div",_l,[m[3]||(m[3]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:W(["tool-result",p.value])},[s.toolCall.result.success!==!1?(l(),r("div",bl,[m[1]||(m[1]=e("i",{class:"bi bi-check-circle"},null,-1)),H(" "+f(v.value),1)])):(l(),r("div",hl,[m[2]||(m[2]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Command execution failed"),1)]))],2)])):I("",!0)]))}},De=q(yl,[["__scopeId","data-v-57a8f93b"]]),$l={class:"exit-plan-mode-tool-handler"},wl={class:"tool-section mb-3"},Sl={key:0,class:"plan-content mt-2"},kl={class:"plan-text"},Cl={key:0,class:"tool-section"},xl={key:0},jl={key:1,class:"text-danger"},Ml={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>t.toolCall.input?.plan),a=u(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(o,n)=>(l(),r("div",$l,[e("div",wl,[n[1]||(n[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"📋"),e("strong",null,"Exiting Plan Mode")],-1)),i.value?(l(),r("div",Sl,[n[0]||(n[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",kl,f(i.value),1)])):I("",!0)]),s.toolCall.result?(l(),r("div",Cl,[n[4]||(n[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:W(["tool-result",a.value])},[s.toolCall.result.success!==!1?(l(),r("div",xl,[...n[2]||(n[2]=[e("i",{class:"bi bi-check-circle"},null,-1),H(" Permission mode reverted to default ",-1)])])):(l(),r("div",jl,[n[3]||(n[3]=e("i",{class:"bi bi-x-circle"},null,-1)),H(" "+f(s.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):I("",!0)]))}},Tl=q(Ml,[["__scopeId","data-v-f1d32203"]]),El={class:"d-flex align-items-center gap-2 flex-grow-1"},Il={class:"tool-status-icon"},Pl={class:"tool-name"},Ll={class:"text-muted small"},Dl={class:"d-flex align-items-center gap-2"},Ol={class:"text-muted"},Nl={key:0,class:"card-body"},Al={key:0,class:"alert alert-warning mb-3"},Rl={class:"d-flex align-items-center"},ql={class:"mb-0 small"},Ul={key:1,class:"permission-prompt mt-3"},Hl={class:"alert alert-warning mb-3"},Wl={class:"mb-0"},Fl={class:"tool-name"},Bl={key:0,class:"suggestions-section mb-3"},Vl={class:"alert alert-info mb-0"},zl={class:"suggestion-details p-2 bg-white rounded"},Jl={class:"permission-buttons d-flex gap-2 mb-3"},Kl=["disabled"],Gl=["disabled"],Yl=["disabled"],Ql={class:"guidance-section mt-3"},Zl=["disabled"],Xl=["disabled"],ea={key:2,class:"mt-3"},ta={class:"alert alert-warning mb-0"},sa={class:"d-flex align-items-center"},oa={class:"mb-0 small"},na={key:3,class:"tool-section mt-3"},la={class:"alert alert-danger mb-0"},aa={key:0},ra={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,i=ue(),a=B(),o=ce(),n=E(!1),p=E(null),v=E(""),d=u(()=>i.isToolUseOrphaned(a.currentSessionId,t.toolCall.id)),m=u(()=>i.getOrphanedInfo(a.currentSessionId,t.toolCall.id)),g={Read:us,Write:js,Bash:Us,TodoWrite:oo,Edit:xo,Grep:Ie,Glob:Ie,WebFetch:Pe,WebSearch:Pe,Task:Pn,NotebookEdit:Yn,BashOutput:Le,KillShell:Le,SlashCommand:De,Skill:De,ExitPlanMode:Tl},$=u(()=>{const w=t.toolCall.name;return g[w]?g[w]:Kt}),b=u(()=>{const w=[];switch(t.toolCall.status){case"pending":w.push("border-secondary");break;case"permission_required":w.push("border-warning");break;case"executing":w.push("border-primary");break;case"completed":y.value||t.toolCall.permissionDecision==="deny"?w.push("border-danger"):w.push("border-success");break;case"error":w.push("border-danger");break}return w.join(" ")}),h=u(()=>{switch(t.toolCall.status){case"pending":return"🔄";case"permission_required":return"❓";case"executing":return"⚡";case"completed":return t.toolCall.permissionDecision==="deny"?"❌":y.value?"💥":"✅";case"error":return"💥";default:return"🔧"}}),M=u(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Executing...";case"completed":return t.toolCall.permissionDecision==="deny"?"Denied":y.value?"Error":"Completed";case"error":return"Error";default:return"Unknown"}}),j=u(()=>_e(t.toolCall.timestamp)),y=u(()=>t.toolCall.result?.error||t.toolCall.status==="error"),c=u(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function C(){const w=a.currentSessionId;w&&i.toggleToolExpansion(w,t.toolCall.id)}function _(w){return w.type==="setMode"?`Set permission mode to "${w.mode}"`:w.type==="allow"?`Allow tool: ${w.tool}`:JSON.stringify(w)}async function k(w,x,N=null){if(!n.value){n.value=!0,w==="allow"?p.value=x?"approve-apply":"approve":N?p.value="deny-guidance":p.value="deny";try{const O=a.currentSessionId;if(O){const P=x&&t.toolCall.suggestions?t.toolCall.suggestions:[];i.handlePermissionResponse(O,{request_id:t.toolCall.permissionRequestId,decision:w,reasoning:w==="allow"?"User allowed permission":"User denied permission",applied_updates:P})}await o.sendPermissionResponse(t.toolCall.permissionRequestId,w,x,N)}catch(O){console.error("Failed to send permission response:",O)}finally{n.value=!1,p.value=null}}}return(w,x)=>(l(),r("div",{class:W(["tool-call-card card mb-3",b.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:C},[e("div",El,[e("span",Il,f(h.value),1),e("strong",Pl,f(s.toolCall.name),1),e("span",Ll,f(M.value),1)]),e("div",Dl,[e("small",Ol,f(j.value),1),e("i",{class:W(["bi",s.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),s.toolCall.isExpanded?(l(),r("div",Nl,[d.value?(l(),r("div",Al,[e("div",Rl,[x[6]||(x[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[x[5]||(x[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",ql,f(m.value?.message||"Session was terminated"),1)])])])):I("",!0),(l(),le(Ne($.value),{toolCall:s.toolCall},null,8,["toolCall"])),s.toolCall.status==="permission_required"&&!d.value?(l(),r("div",Ul,[e("div",Hl,[x[9]||(x[9]=e("p",{class:"mb-2"},[e("strong",null,"🔐 Permission Required")],-1)),e("p",Wl,[x[7]||(x[7]=H("Claude wants to use the ",-1)),e("code",Fl,f(s.toolCall.name),1),x[8]||(x[8]=H(" tool.",-1))])]),c.value?(l(),r("div",Bl,[e("div",Vl,[x[10]||(x[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),H(" Suggested Permission Update ")],-1)),x[11]||(x[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",zl,[(l(!0),r(G,null,Y(s.toolCall.suggestions,(N,O)=>(l(),r("div",{key:O,class:"suggestion-item"},[e("code",null,f(_(N)),1)]))),128))]),x[12]||(x[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):I("",!0),e("div",Jl,[c.value?(l(),r("button",{key:0,class:"btn btn-success",onClick:x[0]||(x[0]=N=>k("allow",!0)),disabled:n.value},[x[13]||(x[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),H(" "+f(n.value&&p.value==="approve-apply"?"⏳ Submitting...":"✅ Approve & Apply"),1)],8,Kl)):I("",!0),e("button",{class:W(["btn",c.value?"btn-outline-success":"btn-success"]),onClick:x[1]||(x[1]=N=>k("allow",!1)),disabled:n.value},[x[14]||(x[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),H(" "+f(n.value&&p.value==="approve"?"⏳ Submitting...":c.value?"✅ Approve Only":"✅ Approve"),1)],10,Gl),e("button",{class:"btn btn-danger",onClick:x[2]||(x[2]=N=>k("deny",!1)),disabled:n.value},[x[15]||(x[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),H(" "+f(n.value&&p.value==="deny"?"⏳ Submitting...":"❌ Deny"),1)],8,Yl)]),e("div",Ql,[x[17]||(x[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),H(" Provide Guidance (Optional) ")],-1)),x[18]||(x[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),K(e("textarea",{"onUpdate:modelValue":x[3]||(x[3]=N=>v.value=N),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:n.value},null,8,Zl),[[X,v.value]]),v.value.trim()?(l(),r("button",{key:0,class:"btn btn-warning btn-sm",onClick:x[4]||(x[4]=N=>k("deny",!1,v.value)),disabled:n.value},[x[16]||(x[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),H(" "+f(n.value&&p.value==="deny-guidance"?"⏳ Submitting...":"💡 Provide Guidance & Continue"),1)],8,Xl)):I("",!0)])])):I("",!0),s.toolCall.status==="permission_required"&&d.value?(l(),r("div",ea,[e("div",ta,[e("div",sa,[x[20]||(x[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[x[19]||(x[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",oa,f(m.value?.message||"Session was terminated before permission could be granted"),1)])])])])):I("",!0),s.toolCall.permissionDecision==="deny"?(l(),r("div",na,[e("div",la,[x[21]||(x[21]=e("i",{class:"bi bi-x-circle"},null,-1)),x[22]||(x[22]=H(" Permission denied ",-1)),s.toolCall.result?.message?(l(),r("span",aa," - "+f(s.toolCall.result.message),1)):I("",!0)])])):I("",!0)])):I("",!0)],2))}},ia=q(ra,[["__scopeId","data-v-194786d1"]]),da={class:"card assistant-message bg-white border-start border-success border-3"},ua={class:"card-body"},ca={class:"d-flex justify-content-between align-items-center mb-2"},ma={class:"d-flex align-items-center gap-2"},pa={key:0,class:"text-muted"},va={class:"text-muted"},fa={key:0,class:"thinking-block mb-3"},ga=["innerHTML"],_a={key:2,class:"tool-calls mt-3"},ba={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,i=ue(),a=B();ve.setOptions({breaks:!0,gfm:!0});const o=u(()=>_e(t.message.timestamp)),n=u(()=>t.message.metadata?.model||null),p=u(()=>{const h=t.message.content||"";return h.trim().length>0&&h!=="Assistant response"}),v=u(()=>{const h=t.message.content||"",M=ve.parse(h);return Se.sanitize(M)}),d=u(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),m=u(()=>t.message.metadata?.thinking_content||""),g=u(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),$=u(()=>t.message.metadata?.tool_uses||[]),b=u(()=>{const h=a.currentSessionId;if(!h)return[];const M=i.toolCallsBySession.get(h)||[];return $.value.map(j=>{const y=M.find(c=>c.id===j.id);return y||{id:j.id,name:j.name,input:j.input,status:"pending",result:null,timestamp:j.timestamp||t.message.timestamp,isExpanded:!0}})});return(h,M)=>(l(),r("div",da,[e("div",ua,[e("div",ca,[e("div",ma,[M[0]||(M[0]=e("span",{class:"message-icon"},"🤖",-1)),M[1]||(M[1]=e("strong",{class:"message-role"},"Assistant",-1)),n.value?(l(),r("small",pa,f(n.value),1)):I("",!0)]),e("small",va,f(o.value),1)]),d.value?(l(),r("div",fa,[J(Rt,{thinking:m.value},null,8,["thinking"])])):I("",!0),p.value?(l(),r("div",{key:1,class:"message-content",innerHTML:v.value},null,8,ga)):I("",!0),g.value?(l(),r("div",_a,[(l(!0),r(G,null,Y(b.value,j=>(l(),le(ia,{key:j.id,toolCall:j},null,8,["toolCall"]))),128))])):I("",!0)])]))}},ha=q(ba,[["__scopeId","data-v-25a87a40"]]),ya={class:"card system-message bg-info bg-opacity-10 border-info"},$a={class:"card-body py-2 px-3"},wa={class:"d-flex align-items-center gap-2"},Sa={class:"text-muted flex-grow-1"},ka={class:"text-muted"},Ca={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>_e(t.message.timestamp));return(a,o)=>(l(),r("div",ya,[e("div",$a,[e("div",wa,[o[0]||(o[0]=e("i",{class:"bi bi-info-circle text-info"},null,-1)),e("small",Sa,f(s.message.content),1),e("small",ka,f(i.value),1)])])]))}},Oe=q(Ca,[["__scopeId","data-v-bba7a395"]]),xa={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(s){const t=s,i=u(()=>{switch(t.message.type){case"user":return Pt;case"assistant":return ha;case"system":return Oe;default:return Oe}});return(a,o)=>(l(),r("div",{class:W(["message-item mb-3",`message-${s.message.type}`])},[(l(),le(Ne(i.value),{message:s.message},null,8,["message"]))],2))}},ja=q(xa,[["__scopeId","data-v-fbd275ac"]]),Ma={key:0,class:"text-muted text-center py-5"},Ta={__name:"MessageList",setup(s){const t=ue(),i=Z(),a=E(null),o=u(()=>t.currentMessages.filter(d=>p(d)));u(()=>t.currentToolCalls);async function n(){i.autoScrollEnabled&&(await $e(),a.value&&(a.value.scrollTop=a.value.scrollHeight))}Q(()=>t.currentMessages.length,n),Q(()=>t.currentToolCalls.length,n),Q(()=>t.currentToolCalls.map(d=>`${d.id}-${d.status}`).join(","),n),oe(()=>{setTimeout(()=>{n()},100)});function p(d){const m=d.subtype||d.metadata?.subtype;if(d.type==="system"&&m==="init"||d.type==="result"||d.type==="permission_request"||d.type==="permission_response")return!1;if(d.type==="user"&&d.metadata?.has_tool_results){const g=d.content||"";if(g.match(/^Tool results?: \d+ results?$/i)||g.trim()==="")return!1}return!0}function v(d){return{type:d.type||"unknown",content:d.content||"",timestamp:d.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...d.metadata}}}return(d,m)=>(l(),r("div",{class:"messages-area flex-grow-1 overflow-auto p-3",ref_key:"messagesArea",ref:a},[o.value.length===0?(l(),r("div",Ma," No messages yet. Start a conversation! ")):I("",!0),(l(!0),r(G,null,Y(o.value,(g,$)=>(l(),le(ja,{key:`msg-${g.timestamp}-${$}`,message:v(g)},null,8,["message"]))),128))],512))}},Ea=q(Ta,[["__scopeId","data-v-1884c681"]]),Ia={class:"border-top bg-light"},Pa={class:"d-flex gap-2 align-items-end px-2 py-1"},La=["placeholder","disabled","onKeydown"],Da=["disabled"],Oa={__name:"InputArea",setup(s){const t=B(),i=ce(),a=E(null),o=u({get:()=>t.currentInput,set:b=>{t.currentInput=b}}),n=u(()=>t.currentSession?.is_processing||!1),p=u(()=>i.sessionConnected),v=u(()=>t.currentSession?.state==="starting"),d=u(()=>v.value?"Session is starting...":p.value?"Type your message to Claude Code...":"Waiting for connection...");function m(){const b=a.value;if(!b)return;b.style.height="auto";const h=Math.min(b.scrollHeight,parseInt(getComputedStyle(b).maxHeight));b.style.height=h+"px"}function g(){o.value.trim()&&(i.sendMessage(o.value),o.value="",a.value&&(a.value.style.height="auto"))}function $(){i.interruptSession()}return(b,h)=>(l(),r("div",Ia,[e("div",Pa,[K(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:a,"onUpdate:modelValue":h[0]||(h[0]=M=>o.value=M),class:"form-control",placeholder:d.value,disabled:v.value||!p.value,rows:"1",onInput:m,onKeydown:Ae(ae(g,["exact","prevent"]),["enter"])},null,40,La),[[X,o.value]]),n.value?(l(),r("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:$}," Stop ")):(l(),r("button",{key:1,class:"btn btn-primary",disabled:!o.value.trim()||!p.value||v.value,onClick:g}," Send ",8,Da))])]))}},Na=q(Oa,[["__scopeId","data-v-a72bf16a"]]),Aa={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},Ra={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},qa={class:"text-secondary"},Ua={class:"d-flex flex-column flex-grow-1 overflow-hidden"},qe={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,i=B(),a=Z(),o=u(()=>i.currentSession),n=u(()=>a.isLoading),p=u(()=>a.loadingMessage);return oe(async()=>{if(t.sessionId!==i.currentSessionId){a.showLoading("Loading session...");try{await i.selectSession(t.sessionId)}finally{a.hideLoading()}}}),Q(()=>t.sessionId,async(v,d)=>{if(v!==d&&v!==i.currentSessionId){a.showLoading("Loading session...");try{await i.selectSession(v)}finally{a.hideLoading()}}}),ne(()=>{}),(v,d)=>(l(),r("div",Aa,[n.value?(l(),r("div",Ra,[d[0]||(d[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",qa,f(p.value),1)])):I("",!0),o.value?(l(),le(ot,{key:1,"session-id":t.sessionId},null,8,["session-id"])):I("",!0),e("div",Ua,[J(Ea)]),J(Na),o.value?(l(),le(it,{key:2,"session-id":t.sessionId},null,8,["session-id"])):I("",!0),o.value?(l(),le(_t,{key:3,"session-id":t.sessionId},null,8,["session-id"])):I("",!0)]))}},ke=pe("legion",()=>{const s=E(new Map),t=E(new Map),i=E(new Map),a=E(new Map),o=E(null),n=u(()=>s.value.get(o.value)||[]),p=u(()=>t.value.get(o.value)||[]),v=u(()=>i.value.get(o.value)||[]),d=u(()=>a.value.get(o.value)||[]);function m(C){o.value=C}async function g(C,_=100,k=0){try{const w=await V.get(`/api/legions/${C}/timeline?limit=${_}&offset=${k}`),x=w.comms||[],N=w.total_count||x.length,O=w.has_more||!1;return x.sort((P,S)=>new Date(P.timestamp)-new Date(S.timestamp)),console.log(`Loaded ${x.length} of ${N} comms for legion ${C}`),s.value.set(C,x),s.value=new Map(s.value),{comms:x,totalCount:N,hasMore:O}}catch(w){throw console.error("Failed to load timeline:",w),w}}function $(C,_){s.value.has(C)||s.value.set(C,[]),s.value.get(C).push(_),s.value=new Map(s.value)}async function b(C,_){try{const w=(await V.post(`/api/legions/${C}/comms`,_)).comm;return console.log(`Sent comm ${w.comm_id} to legion ${C}`),w}catch(k){throw console.error("Failed to send comm:",k),k}}async function h(C){return console.log(`Minions for legion ${C} are already available in session store`),[]}async function M(C,_){try{const w=(await V.post(`/api/legions/${C}/minions`,_)).minion;return await h(C),console.log(`Created minion ${w.minion_id} in legion ${C}`),w}catch(k){throw console.error("Failed to create minion:",k),k}}async function j(C){try{const k=(await V.get(`/api/legions/${C}/hordes`)).hordes||[];return console.log(`Loaded ${k.length} hordes for legion ${C}`),i.value.set(C,k),i.value=new Map(i.value),k}catch(_){throw console.error("Failed to load hordes:",_),_}}async function y(C){try{const k=(await V.get(`/api/legions/${C}/channels`)).channels||[];return console.log(`Loaded ${k.length} channels for legion ${C}`),a.value.set(C,k),a.value=new Map(a.value),k}catch(_){throw console.error("Failed to load channels:",_),_}}function c(C){s.value.delete(C),t.value.delete(C),i.value.delete(C),a.value.delete(C),s.value=new Map(s.value),t.value=new Map(t.value),i.value=new Map(i.value),a.value=new Map(a.value)}return{commsByLegion:s,minionsByLegion:t,hordesByLegion:i,channelsByLegion:a,currentLegionId:o,currentComms:n,currentMinions:p,currentHordes:v,currentChannels:d,setCurrentLegion:m,loadTimeline:g,addComm:$,sendComm:b,loadMinions:h,createMinion:M,loadHordes:j,loadChannels:y,clearLegionData:c}}),Ha=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:ke},Symbol.toStringTag,{value:"Module"})),Wa={class:"timeline-header border-bottom p-3"},Fa={class:"project-name"},Ba=["title"],Va={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(s){const t=s,i=ee(),a=u(()=>i.projects.get(t.legionId)),o=u(()=>a.value?.name||"Legion");return(n,p)=>(l(),r("div",Wa,[e("div",null,[e("div",Fa,f(o.value),1),e("div",{class:"view-name",title:s.legionId},"Timeline",8,Ba)])]))}},za=q(Va,[["__scopeId","data-v-44f386f5"]]),Ja={class:"timeline-status-bar border-top p-2 bg-light"},Ka={class:"d-flex justify-content-end"},Ga={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(s){const t=Z();function i(){t.setAutoScroll(!t.autoScrollEnabled)}return(a,o)=>(l(),r("div",Ja,[e("div",Ka,[e("button",{class:W(["btn btn-sm",ge(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:i}," ⬇️ "+f(ge(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},Ya=q(Ga,[["__scopeId","data-v-891c73db"]]),Qa={class:"comm-composer border-top p-3"},Za={class:"d-flex gap-2 mb-2"},Xa={class:"flex-grow-1"},er=["disabled"],tr={label:"Minions"},sr=["value"],or={key:0,label:"Channels"},nr=["value"],lr={style:{"min-width":"150px"}},ar=["disabled"],rr={class:"d-flex gap-2 align-items-end position-relative"},ir={class:"flex-grow-1 position-relative"},dr=["disabled"],ur=["onClick","onMouseenter"],cr=["disabled"],mr={key:0},pr={key:1},vr={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(s){const t=s,i=ke(),a=B(),o=ee(),n=E(""),p=E("task"),v=E(""),d=E(!1),m=E(!1),g=E([]),$=E(0),b=E(-1),h=E(null),M=E(null),j=u(()=>{const S=o.projects.get(t.legionId);return!S||!S.session_ids?[]:S.session_ids.map(L=>a.sessions.get(L)).filter(L=>L&&L.is_minion)}),y=u(()=>i.currentChannels||[]),c=u(()=>n.value&&v.value.trim().length>0);function C(S){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[S.state]||"○"}function _(S){return S.is_minion&&S.role?`${S.name} (${S.role})`:S.name}function k(){const S=h.value;if(!S)return;S.style.height="auto";const L=Math.min(S.scrollHeight,parseInt(getComputedStyle(S).maxHeight));S.style.height=L+"px"}function w(){const S=h.value;if(!S)return;k();const L=v.value,D=S.selectionStart,T=L.substring(0,D),A=T.lastIndexOf("#");if(A===-1){m.value=!1;return}const R=T.substring(A+1).toLowerCase();if(R.includes(" ")){m.value=!1;return}const F=j.value.filter(U=>U.name.toLowerCase().includes(R)).map(U=>({type:"minion",name:U.name,role:U.role,id:U.session_id,state:U.state}));if(F.length===0){m.value=!1;return}g.value=F,$.value=0,b.value=A,m.value=!0}function x(){if(!M.value)return;const S=M.value,L=S.children[$.value];if(!L)return;const D=L.offsetTop,T=L.offsetHeight,A=S.scrollTop,R=S.clientHeight;D<A?S.scrollTop=D:D+T>A+R&&(S.scrollTop=D+T-R)}function N(S){if(!m.value){S.key==="Enter"&&!S.shiftKey&&c.value&&(S.preventDefault(),P());return}if(S.key==="ArrowDown")S.preventDefault(),$.value=($.value+1)%g.value.length,x();else if(S.key==="ArrowUp")S.preventDefault(),$.value=$.value===0?g.value.length-1:$.value-1,x();else if(S.key==="Enter"){S.preventDefault();const L=g.value[$.value];L&&O(L)}else S.key==="Escape"&&(m.value=!1)}function O(S){const L=h.value;if(!L)return;const D=v.value,T=L.selectionStart,A=D.substring(0,b.value)+"#"+S.name+" "+D.substring(T);v.value=A;const R=b.value+S.name.length+2;setTimeout(()=>{L.setSelectionRange(R,R),L.focus()},0),m.value=!1}async function P(){if(!(!c.value||d.value)){d.value=!0;try{const[S,L]=n.value.split(":"),D={comm_type:p.value,content:v.value.trim()};S==="minion"?D.to_minion_id=L:S==="channel"&&(D.to_channel_id=L),await i.sendComm(t.legionId,D),v.value="",k()}catch(S){console.error("Failed to send comm:",S),alert(`Failed to send comm: ${S.message}`)}finally{d.value=!1}}}return Q(m,S=>{if(S){const L=D=>{D.target.closest(".comm-composer")||(m.value=!1,document.removeEventListener("click",L))};setTimeout(()=>document.addEventListener("click",L),0)}}),(S,L)=>(l(),r("div",Qa,[e("div",Za,[e("div",Xa,[K(e("select",{"onUpdate:modelValue":L[0]||(L[0]=D=>n.value=D),class:"form-select form-select-sm",disabled:d.value},[L[3]||(L[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",tr,[(l(!0),r(G,null,Y(j.value,D=>(l(),r("option",{key:D.session_id,value:`minion:${D.session_id}`},f(C(D))+" "+f(_(D)),9,sr))),128))]),y.value.length>0?(l(),r("optgroup",or,[(l(!0),r(G,null,Y(y.value,D=>(l(),r("option",{key:D.channel_id,value:`channel:${D.channel_id}`}," #️⃣ "+f(D.name),9,nr))),128))])):I("",!0)],8,er),[[de,n.value]])]),e("div",lr,[K(e("select",{"onUpdate:modelValue":L[1]||(L[1]=D=>p.value=D),class:"form-select form-select-sm",disabled:d.value},[...L[4]||(L[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,ar),[[de,p.value]])])]),e("div",rr,[e("div",ir,[K(e("textarea",{ref_key:"contentTextarea",ref:h,"onUpdate:modelValue":L[2]||(L[2]=D=>v.value=D),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:d.value,onInput:w,onKeydown:N},null,40,dr),[[X,v.value]]),m.value?(l(),r("div",{key:0,ref_key:"autocompleteDropdown",ref:M,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(l(!0),r(G,null,Y(g.value,(D,T)=>(l(),r("div",{key:D.id,class:W(["autocomplete-item px-2 py-1",{"bg-light":T===$.value}]),onClick:A=>O(D),onMouseenter:A=>$.value=T},f(D.type==="minion"?C(D):"#️⃣")+" "+f(D.name)+f(D.role?` (${D.role})`:""),43,ur))),128))],512)):I("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!c.value||d.value,onClick:P},[d.value?(l(),r("span",mr,[...L[5]||(L[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),H(" Sending... ",-1)])])):(l(),r("span",pr,"Send"))],8,cr)])])]))}},fr=q(vr,[["__scopeId","data-v-ffa54193"]]),gr={class:"timeline-view d-flex flex-column h-100"},_r={key:0,class:"text-center text-muted"},br={key:1,class:"text-center text-danger"},hr={key:2,class:"text-center text-muted"},yr={key:3,class:"comm-list"},$r={class:"col-auto message-speaker text-end pe-3"},wr={class:"text-muted"},Sr={class:"col message-content-column"},kr={class:"comm-card card"},Cr={class:"card-body p-2"},xr={class:"d-flex justify-content-between align-items-start mb-1"},jr={class:"ms-2"},Mr={class:"comm-content"},Tr={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(s){const t=s,i=ke(),a=ee(),o=B(),n=ce(),p=Z(),v=E(!0),d=E(null),m=E(null),g=u(()=>a.projects.get(t.legionId));u(()=>g.value?.name||"Legion");const $=u(()=>i.currentComms);u(()=>i.currentMinions);function b(k){return k.from_user?"You":k.from_minion_id&&o.sessions.get(k.from_minion_id)?.name||"Unknown"}function h(k){return k.to_user?"You":k.to_minion_id?o.sessions.get(k.to_minion_id)?.name||"Unknown":k.to_channel_id?`#${k.to_channel_id}`:"All"}function M(k){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[k]||"bg-secondary"}function j(k){return new Date(k).toLocaleTimeString()}async function y(){p.autoScrollEnabled&&(await $e(),m.value&&(m.value.scrollTop=m.value.scrollHeight))}async function c(){v.value=!0,d.value=null;try{i.setCurrentLegion(t.legionId),await Promise.all([i.loadTimeline(t.legionId),i.loadMinions(t.legionId)]),await $e(),await y(),setTimeout(()=>{y()},100)}catch(k){console.error("Failed to load timeline:",k),k.response?d.value=`${k.message} (${k.response.status})`:d.value=k.message||"Unknown error"}finally{v.value=!1}}function C(){n.connectLegion(t.legionId)}function _(){n.disconnectLegion()}return Q(()=>$.value.length,()=>{y()}),oe(()=>{c(),C(),setTimeout(()=>{y()},100)}),ne(()=>{_()}),(k,w)=>(l(),r("div",gr,[J(za,{"legion-id":s.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:m,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[v.value?(l(),r("div",_r,[...w[0]||(w[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),H(" Loading timeline... ",-1)])])):d.value?(l(),r("div",br," Failed to load timeline: "+f(d.value),1)):$.value.length===0?(l(),r("div",hr," No messages yet. Minions will appear here once they start communicating. ")):(l(),r("div",yr,[(l(!0),r(G,null,Y($.value,x=>(l(),r("div",{key:x.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",$r,[e("small",wr,f(j(x.timestamp)),1)]),e("div",Sr,[e("div",kr,[e("div",Cr,[e("div",xr,[e("div",null,[e("span",{class:W(["badge",M(x.comm_type)])},f(x.comm_type),3),e("strong",jr,f(b(x)),1),w[1]||(w[1]=e("span",{class:"text-muted mx-1"},"→",-1)),e("strong",null,f(h(x)),1)])]),e("div",Mr,f(x.content),1)])])])]))),128))]))],512),J(fr,{"legion-id":s.legionId},null,8,["legion-id"]),J(Ya,{"legion-id":s.legionId},null,8,["legion-id"])]))}},Er=q(Tr,[["__scopeId","data-v-d4c7422e"]]),Ir={class:"spy-view d-flex flex-column overflow-hidden"},Pr={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(s){return(t,i)=>(l(),r("div",Ir,[J(qe,{"session-id":s.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},Lr=q(Pr,[["__scopeId","data-v-43a24eaf"]]),Dr={class:"horde-header border-bottom p-3"},Or={class:"project-name"},Nr=["title"],Ar={__name:"HordeHeader",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,i=ee(),a=B(),o=u(()=>i.projects.get(t.legionId)),n=u(()=>o.value?.name||"Legion"),p=u(()=>a.sessions.get(t.overseerId)),v=u(()=>p.value?.name||"Overseer");return(d,m)=>(l(),r("div",Dr,[e("div",null,[e("div",Or,f(n.value),1),e("div",{class:"view-name",title:s.overseerId},f(v.value)+"'s Horde",9,Nr)])]))}},Rr=q(Ar,[["__scopeId","data-v-775da47d"]]),qr={class:"horde-status-bar border-top p-2 bg-light"},Ur={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){return(t,i)=>(l(),r("div",qr,[...i[0]||(i[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},Hr=q(Ur,[["__scopeId","data-v-7f3c847f"]]),Wr={class:"minion-card p-2 border-start border-2 mb-2"},Fr={class:"d-flex align-items-center"},Br={class:"me-2"},Vr={key:0,class:"me-2"},zr={key:1,class:"text-muted ms-2"},Jr={key:2,class:"badge bg-secondary ms-2"},Kr={class:"text-muted small ms-4"},Gr={key:0,class:"minion-children"},Yr={key:1,class:"text-danger small ms-4"},Qr={__name:"MinionTreeNode",props:{minionId:{type:String,required:!0},level:{type:Number,default:0}},setup(s){const t=s,i=B(),a=u(()=>i.sessions.get(t.minionId)),o=u(()=>t.level*24),n=u(()=>{const m=a.value&&a.value.child_minion_ids&&a.value.child_minion_ids.length>0;return a.value&&a.value.child_minion_ids&&a.value.child_minion_ids.length>0&&console.log(`Minion ${a.value.name} has ${a.value.child_minion_ids.length} children:`,a.value.child_minion_ids),m}),p=u(()=>a.value&&a.value.is_overseer&&n.value),v={created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"},d=u(()=>v[a.value?.state]||"○");return(m,g)=>{const $=Re("MinionTreeNode",!0);return a.value?(l(),r("div",{key:0,class:"minion-tree-node",style:re({marginLeft:`${o.value}px`})},[e("div",Wr,[e("div",Fr,[e("span",Br,f(d.value),1),p.value?(l(),r("span",Vr,"👑")):I("",!0),e("strong",null,f(a.value.name),1),a.value.role?(l(),r("span",zr,f(a.value.role),1)):I("",!0),p.value?(l(),r("span",Jr,f(a.value.child_minion_ids.length)+" "+f(a.value.child_minion_ids.length===1?"child":"children"),1)):I("",!0)]),e("div",Kr," Level "+f(a.value.overseer_level||0)+" • "+f(a.value.state),1)]),n.value?(l(),r("div",Gr,[(l(!0),r(G,null,Y(a.value.child_minion_ids,b=>(l(),le($,{key:b,"minion-id":b,level:s.level+1},null,8,["minion-id","level"]))),128))])):I("",!0)],4)):t.minionId?(l(),r("div",Yr," ⚠ Minion data not found for ID: "+f(t.minionId),1)):I("",!0)}}},Zr=q(Qr,[["__scopeId","data-v-120682eb"]]),Xr={class:"horde-view d-flex flex-column h-100"},ei={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},ti={key:0,class:"alert alert-danger"},si={key:1,class:"horde-tree"},oi={__name:"HordeView",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,i=B(),a=ee(),o=u(()=>a.projects.get(t.legionId));u(()=>o.value?.name||"Legion");const n=u(()=>i.sessions.get(t.overseerId));return(p,v)=>(l(),r("div",Xr,[J(Rr,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"]),e("div",ei,[n.value?(l(),r("div",si,[J(Zr,{"minion-id":s.overseerId,level:0},null,8,["minion-id"])])):(l(),r("div",ti," Overseer not found "))]),J(Hr,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"])]))}},ni=q(oi,[["__scopeId","data-v-b928719b"]]),li=[{path:"/",name:"home",component:ze},{path:"/session/:sessionId",name:"session",component:qe,props:!0},{path:"/timeline/:legionId",name:"timeline",component:Er,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:Lr,props:!0},{path:"/horde/:legionId/:overseerId",name:"horde",component:ni,props:!0}],ai=Ue({history:He(),routes:li}),ri={__name:"ConnectionIndicator",setup(s){const t=ce(),i=u(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),a=u(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(o,n)=>(l(),r("span",{id:"connection-indicator",class:W(["badge",i.value])},f(a.value),3))}},ii={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},di={class:"d-flex align-items-center gap-2"},ui={__name:"AppHeader",setup(s){const t=Z();function i(){t.toggleSidebar()}return(a,o)=>(l(),r("header",ii,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:i},[...o[0]||(o[0]=[e("span",null,"☰",-1)])]),o[1]||(o[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",di,[J(ri)])]))}},ci={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},mi={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},pi=["title"],vi={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,i=u(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function a(v){return v.state==="paused"&&v.is_processing?"pending-prompt":v.is_processing?"processing":v.state}function o(v){const d=a(v);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[d]||"#d3d3d3"}function n(v){const d=a(v);return d==="starting"||d==="processing"||d==="pending-prompt"}function p(v){const d=a(v),m=d.charAt(0).toUpperCase()+d.slice(1),g=v.name||"Unnamed Session",$=v.is_minion&&v.role?` (${v.role})`:"";return`${g}${$}: ${m}`}return(v,d)=>(l(),r("div",ci,[!s.sessions||s.sessions.length===0?(l(),r("div",mi)):(l(!0),r(G,{key:1},Y(s.sessions,m=>(l(),r("div",{key:m.session_id,class:W(["progress-bar",{"progress-bar-striped progress-bar-animated":n(m)}]),style:re({width:i.value,backgroundColor:o(m),cursor:"help"}),title:p(m)},null,14,pi))),128))]))}},fi=q(vi,[["__scopeId","data-v-a79cfeec"]]),gi={class:"flex-grow-1"},_i={key:0,class:"text-muted small ms-1"},bi={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(s){const t=s,i=ie(),a=B(),o=ee(),n=Z(),p=u(()=>a.currentSessionId===t.session.session_id),v=u(()=>a.deletingSessions.has(t.session.session_id)),d=u(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),m=u(()=>{const c=d.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[c]||"status-dot-grey"}),g=u(()=>{const c=d.value,C={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},_={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:C[c]||"#d3d3d3",borderColor:_[c]||"#6c757d"}});function $(){a.selectSession(t.session.session_id),i.push(`/session/${t.session.session_id}`)}function b(){n.showModal("edit-session",{session:t.session})}function h(c){c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("application/session-id",t.session.session_id),c.dataTransfer.setData("application/project-id",t.projectId),c.dataTransfer.setData("text/plain",t.session.session_id),c.target.classList.add("dragging")}function M(c){c.target.classList.remove("dragging")}function j(c){c.preventDefault(),c.dataTransfer.dropEffect="move";const C=c.currentTarget.getBoundingClientRect(),_=C.top+C.height/2;c.clientY<_?(c.currentTarget.classList.add("drop-above"),c.currentTarget.classList.remove("drop-below")):(c.currentTarget.classList.add("drop-below"),c.currentTarget.classList.remove("drop-above"))}function y(c){c.preventDefault(),c.currentTarget.classList.remove("drop-above","drop-below");const C=c.dataTransfer.getData("application/session-id")||c.dataTransfer.getData("text/plain"),_=c.dataTransfer.getData("application/project-id");if(!C||C===t.session.session_id||_!==t.projectId)return;const k=c.currentTarget.getBoundingClientRect(),w=k.top+k.height/2,x=c.clientY<w,N=o.getProject(t.projectId);if(!N||!N.session_ids)return;const O=[...N.session_ids],P=O.indexOf(t.session.session_id),S=O.indexOf(C);if(P===-1||S===-1)return;const L=[...O],[D]=L.splice(S,1);let T=x?P:P+1;S<P&&T--,L.splice(T,0,D),o.reorderSessionsInProject(t.projectId,L)}return(c,C)=>(l(),r("div",{class:W(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:p.value,"session-deleting":v.value}]),style:{cursor:"pointer"},draggable:"true",onClick:$,onDragstart:h,onDragend:M,onDragover:j,onDrop:y},[e("div",{class:W(["status-dot me-2",m.value]),style:re(g.value)},null,6),e("div",gi,[e("span",null,f(s.session.name||s.session.session_id),1),s.session.is_minion&&s.session.role?(l(),r("span",_i,"("+f(s.session.role)+")",1)):I("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:ae(b,["stop"])}," ✏️ ")],34))}},hi=q(bi,[["__scopeId","data-v-07ecbf94"]]),yi=["value"],$i={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,i=ie(),a=B(),o=E("");Q(()=>i.currentRoute.value,h=>{!o.value&&h.name==="spy"&&h.params.minionId&&h.params.legionId===t.project.project_id&&(o.value=h.params.minionId)},{immediate:!0});const n=u(()=>o.value?t.sessions.find(h=>h.session_id===o.value):null),p=u(()=>{const h=i.currentRoute.value;return h.name==="spy"&&h.params.legionId===t.project.project_id}),v=u(()=>{if(!n.value)return"";if(n.value.state==="paused"&&n.value.is_processing)return"status-blinking";const h=n.value.is_processing?"processing":n.value.state;return h==="starting"||h==="processing"?"status-blinking":""}),d=u(()=>{if(!n.value)return{};if(n.value.state==="paused"&&n.value.is_processing)return{backgroundColor:"#ffc107"};const h=n.value.is_processing?"processing":n.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[h]||"#d3d3d3"}});function m(h){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[h.state]||"○"}function g(h){return h.is_minion&&h.role?`${h.name} (${h.role})`:h.name}function $(){o.value&&i.push(`/spy/${t.project.project_id}/${o.value}`)}function b(){o.value?i.push(`/spy/${t.project.project_id}/${o.value}`):i.push("/")}return Q(()=>a.currentSessionId,h=>{h&&t.sessions.some(M=>M.session_id===h)&&(o.value=h)}),(h,M)=>(l(),r("div",{class:W(["list-group-item list-group-item-action p-2",{active:p.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:re({cursor:o.value?"pointer":"default"}),onClick:$},[M[1]||(M[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🔍"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),n.value?(l(),r("span",{key:0,class:W(["minion-state-indicator",v.value]),style:re(d.value)}," 👤 ",6)):I("",!0)],4),K(e("select",{"onUpdate:modelValue":M[0]||(M[0]=j=>o.value=j),class:"form-select form-select-sm",onChange:b},[M[2]||(M[2]=e("option",{value:""},"-- Select Minion --",-1)),(l(!0),r(G,null,Y(s.sessions,j=>(l(),r("option",{key:j.session_id,value:j.session_id},f(m(j))+" "+f(g(j)),9,yi))),128))],544),[[de,o.value]])],2))}},wi=q($i,[["__scopeId","data-v-9632f72c"]]),Si=["value"],ki={__name:"HordeSelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,i=ie(),a=E("");Q(()=>i.currentRoute.value,m=>{!a.value&&m.name==="horde"&&m.params.overseerId&&m.params.legionId===t.project.project_id&&(a.value=m.params.overseerId)},{immediate:!0});const o=u(()=>t.sessions.filter(m=>m.is_overseer===!0)),n=u(()=>{const m=i.currentRoute.value;return m.name==="horde"&&m.params.legionId===t.project.project_id});function p(m){return{created:"○",starting:"◐",active:"●",paused:"⏸",terminating:"◍",terminated:"✗",error:"⚠"}[m.state]||"○"}function v(){a.value&&i.push(`/horde/${t.project.project_id}/${a.value}`)}function d(){a.value&&i.push(`/horde/${t.project.project_id}/${a.value}`)}return(m,g)=>(l(),r("div",{class:W(["list-group-item list-group-item-action p-2",{active:n.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:re({cursor:a.value?"pointer":"default"}),onClick:v},[...g[1]||(g[1]=[e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"🌳"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],4),K(e("select",{"onUpdate:modelValue":g[0]||(g[0]=$=>a.value=$),class:"form-select form-select-sm",onChange:d},[g[2]||(g[2]=e("option",{value:""},"-- Select Overseer --",-1)),(l(!0),r(G,null,Y(o.value,$=>(l(),r("option",{key:$.session_id,value:$.session_id},f(p($))+" "+f($.name),9,Si))),128))],544),[[de,a.value]])],2))}},Ci=q(ki,[["__scopeId","data-v-ca33279d"]]),xi=["data-project-id"],ji=["id"],Mi=["data-bs-target","aria-expanded","aria-controls"],Ti={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},Ei={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},Ii={class:"fw-semibold",style:{"flex-shrink":"0"}},Pi={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},Li={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},Di=["title"],Oi=["title"],Ni=["id","aria-labelledby"],Ai={class:"accordion-body p-0"},Ri={class:"list-group list-group-flush"},qi={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(s){const t=s,i=ie(),a=ee(),o=B(),n=Z(),p=E(t.project.is_expanded||!1),v=u(()=>a.formatPath(t.project.working_directory)),d=u(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(_=>o.getSession(_)).filter(_=>_!=null)),m=u(()=>{const _=i.currentRoute.value;return _.name==="timeline"&&_.params.legionId===t.project.project_id});function g(){p.value||(a.toggleExpansion(t.project.project_id),p.value=!0)}function $(){if(p.value){a.toggleExpansion(t.project.project_id),p.value=!1;const _=o.currentSessionId;_&&o.getSession(_)&&t.project.session_ids?.includes(_)&&i.push("/"),a.currentProjectId===t.project.project_id&&i.push("/")}}function b(){n.showModal("edit-project",{project:t.project})}function h(){t.project.is_multi_agent?n.showModal("create-minion",{project:t.project}):n.showModal("create-session",{project:t.project})}function M(){i.push(`/timeline/${t.project.project_id}`)}function j(_){_.dataTransfer.effectAllowed="move",_.dataTransfer.setData("application/project-id",t.project.project_id),_.dataTransfer.setData("text/plain",t.project.project_id),_.target.classList.add("dragging")}function y(_){_.target.classList.remove("dragging")}function c(_){_.preventDefault(),_.dataTransfer.dropEffect="move";const k=_.currentTarget.getBoundingClientRect(),w=k.top+k.height/2;_.clientY<w?(_.currentTarget.classList.add("drop-above"),_.currentTarget.classList.remove("drop-below")):(_.currentTarget.classList.add("drop-below"),_.currentTarget.classList.remove("drop-above"))}function C(_){_.preventDefault(),_.currentTarget.classList.remove("drop-above","drop-below");const k=_.dataTransfer.getData("application/project-id")||_.dataTransfer.getData("text/plain");if(!k||k===t.project.project_id)return;const w=_.currentTarget.getBoundingClientRect(),x=w.top+w.height/2,N=_.clientY<x,O=a.orderedProjects,P=O.findIndex(R=>R.project_id===t.project.project_id),S=O.findIndex(R=>R.project_id===k);if(P===-1||S===-1)return;const L=[...O],[D]=L.splice(S,1);let T=N?P:P+1;S<P&&T--,L.splice(T,0,D);const A=L.map(R=>R.project_id);a.reorderProjects(A)}return(_,k)=>(l(),r("div",{class:"accordion-item border rounded mb-2","data-project-id":s.project.project_id,draggable:"true",onDragstart:j,onDragend:y,onDragover:c,onDrop:C},[e("h2",{class:"accordion-header",id:`heading-${s.project.project_id}`},[e("button",{class:W(["accordion-button bg-white p-2",{collapsed:!p.value}]),type:"button","data-bs-toggle":"collapse","data-bs-target":`#collapse-${s.project.project_id}`,"aria-expanded":p.value,"aria-controls":`collapse-${s.project.project_id}`},[e("div",Ti,[e("div",Ei,[e("div",Ii,[s.project.is_multi_agent?(l(),r("span",Pi,"🏛")):I("",!0),H(" "+f(s.project.name),1)]),e("div",Li,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:ae(b,["stop","prevent"])}," ✏️ "),e("button",{class:"btn btn-sm btn-outline-primary",title:s.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:ae(h,["stop","prevent"])}," ➕ ",8,Di)])]),e("small",{class:"text-muted font-monospace",title:s.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},f(v.value),9,Oi)])],10,Mi)],8,ji),J(fi,{project:s.project,sessions:d.value},null,8,["project","sessions"]),e("div",{id:`collapse-${s.project.project_id}`,class:W(["accordion-collapse collapse",{show:p.value}]),"aria-labelledby":`heading-${s.project.project_id}`,onShown:g,onHidden:$},[e("div",Ai,[e("div",Ri,[s.project.is_multi_agent?(l(),r("div",{key:0,class:W(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:m.value}]),style:{cursor:"pointer"},onClick:M},[...k[0]||(k[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"📊"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):I("",!0),s.project.is_multi_agent?(l(),r(G,{key:1},[J(wi,{project:s.project,sessions:d.value},null,8,["project","sessions"]),J(Ci,{project:s.project,sessions:d.value},null,8,["project","sessions"])],64)):(l(!0),r(G,{key:2},Y(d.value,w=>(l(),le(hi,{key:w.session_id,session:w,"project-id":s.project.project_id},null,8,["session","project-id"]))),128))])])],42,Ni)],40,xi))}},Ui=q(qi,[["__scopeId","data-v-4cc3dd53"]]),Hi={class:"project-list"},Wi={key:0,class:"text-muted text-center py-3"},Fi={__name:"ProjectList",setup(s){const t=ee(),i=u(()=>t.orderedProjects);return(a,o)=>(l(),r("div",Hi,[i.value.length===0?(l(),r("div",Wi,' No projects yet. Click "New" to create one. ')):I("",!0),(l(!0),r(G,null,Y(i.value,n=>(l(),le(Ui,{key:n.project_id,project:n},null,8,["project"]))),128))]))}},Bi={class:"flex-grow-1 overflow-auto p-3"},Vi={id:"sessions-container"},zi={__name:"Sidebar",setup(s){const t=Z(),i=u(()=>t.sidebarCollapsed),a=u(()=>t.isMobile),o=u(()=>{if(a.value)return{};const g=`${t.sidebarWidth}px`;return{width:g,minWidth:"200px",maxWidth:"30vw","--sidebar-width":g}});function n(){t.showModal("create-project")}const p=E(!1);function v(g){p.value=!0,document.addEventListener("mousemove",d),document.addEventListener("mouseup",m)}function d(g){p.value&&t.setSidebarWidth(g.clientX)}function m(){p.value=!1,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",m)}return(g,$)=>(l(),r("aside",{id:"sidebar",class:W(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:i.value,"mobile-open":!i.value&&a.value,"desktop-collapsed":i.value&&!a.value}]),style:re(o.value)},[e("div",Bi,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[$[0]||($[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:n}," 📁 New ")]),e("div",Vi,[J(Fi)])]),e("div",{class:"sidebar-resize-handle",onMousedown:v},null,32)],6))}},Ji=q(zi,[["__scopeId","data-v-d792f0f0"]]),Ki={class:"modal-dialog modal-lg"},Gi={class:"modal-content"},Yi={class:"modal-body"},Qi={class:"mb-3"},Zi={class:"input-group"},Xi=["disabled"],ed={key:0,class:"text-center py-4"},td={key:1,class:"alert alert-danger",role:"alert"},sd={key:2,class:"folder-list"},od=["onClick","onDblclick"],nd={class:"d-flex align-items-center flex-grow-1"},ld=["onClick"],ad={key:1,class:"text-center text-muted py-3"},rd={class:"modal-footer"},id=["disabled"],dd={__name:"FolderBrowserModal",setup(s){const t=Z(),i=E(""),a=E(""),o=E([]),n=E(!1),p=E(""),v=E(null);let d=null,m=null;const g=u(()=>{if(!i.value)return null;const _=i.value.split(/[\\/]/).filter(Boolean);return _.length<=1?null:(_.pop(),_.length>0?_.join("/"):"/")});function $(_){if(!_)return"";const k=_.split(/[\\/]/).filter(Boolean);return k.length<=2?_:".../"+k.slice(-2).join("/")}async function b(){n.value=!0,p.value="",o.value=[],a.value="";try{const _=i.value?{path:i.value}:{},k=await V.get("/api/filesystem/browse",{params:_});k.current_path&&(i.value=k.current_path),o.value=k.directories||[]}catch(_){console.error("Failed to load directory:",_),p.value=_.message||"Failed to load directory"}finally{n.value=!1}}function h(_){a.value=_.path}function M(_){i.value=_.path,a.value="",b()}function j(){g.value&&(i.value=g.value,a.value="",b())}function y(){const _=a.value||i.value;_&&m&&m(_),d&&d.hide()}function c(){b()}function C(){o.value=[],a.value="",p.value="",m=null,t.hideModal()}return Q(()=>t.currentModal,_=>{if(_?.name==="folder-browser"&&d){const k=_.data||{};i.value=k.currentPath||"",m=k.onSelect||null,d.show()}}),oe(()=>{v.value&&se(async()=>{const{default:_}=await import("./modal-B4rHLo2F.js").then(k=>k.m);return{default:_}},__vite__mapDeps([0,1])).then(({default:_})=>{d=new _(v.value),v.value.addEventListener("shown.bs.modal",c),v.value.addEventListener("hidden.bs.modal",C)})}),ne(()=>{v.value&&(v.value.removeEventListener("shown.bs.modal",c),v.value.removeEventListener("hidden.bs.modal",C)),d&&d.dispose()}),(_,k)=>(l(),r("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",Ki,[e("div",Gi,[k[7]||(k[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Yi,[e("div",Qi,[k[2]||(k[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",Zi,[K(e("input",{type:"text",class:"form-control","onUpdate:modelValue":k[0]||(k[0]=w=>i.value=w),onKeyup:Ae(b,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[X,i.value]]),e("button",{class:"btn btn-outline-secondary",onClick:b,disabled:n.value},[...k[1]||(k[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),H(" Refresh ",-1)])],8,Xi)])]),n.value?(l(),r("div",ed,[...k[3]||(k[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):p.value?(l(),r("div",td,f(p.value),1)):(l(),r("div",sd,[g.value?(l(),r("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:j,role:"button"},[...k[4]||(k[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):I("",!0),(l(!0),r(G,null,Y(o.value,w=>(l(),r("div",{key:w.path,class:W(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:w.path===a.value}]),onClick:x=>h(w),onDblclick:x=>M(w),role:"button"},[e("div",nd,[k[5]||(k[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,f(w.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:ae(x=>M(w),["stop"])}," Open ",8,ld)],42,od))),128)),o.value.length===0?(l(),r("div",ad," No subdirectories found ")):I("",!0)]))]),e("div",rd,[k[6]||(k[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:y,disabled:!a.value},' Select "'+f($(a.value||i.value))+'" ',9,id)])])])],512))}},ud=q(dd,[["__scopeId","data-v-667c51a9"]]),cd={class:"modal-dialog"},md={class:"modal-content"},pd={class:"modal-body"},vd={class:"mb-3"},fd={key:0,class:"invalid-feedback"},gd={class:"mb-3"},_d={class:"input-group"},bd={key:0,class:"invalid-feedback"},hd={class:"mb-3 form-check"},yd={class:"mb-3 form-check"},$d={class:"form-check-label",for:"createSession"},wd={key:0,class:"mb-3 ms-4"},Sd={for:"sessionName",class:"form-label"},kd={key:1,class:"alert alert-danger",role:"alert"},Cd={class:"modal-footer"},xd=["disabled"],jd={key:0,class:"spinner-border spinner-border-sm me-2"},Md={__name:"ProjectCreateModal",setup(s){const t=ee(),i=B(),a=Z(),o=E({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),n=E({name:"",workingDirectory:""}),p=E(!1),v=E(""),d=E(null);let m=null;function g(){a.showModal("folder-browser",{currentPath:o.value.workingDirectory||"",onSelect:y=>{o.value.workingDirectory=y,n.value.workingDirectory=""}})}function $(){n.value={};let y=!0;return o.value.name.trim()||(n.value.name="Project name is required",y=!1),o.value.workingDirectory.trim()||(n.value.workingDirectory="Working directory is required",y=!1),y}async function b(){if($()){p.value=!0,v.value="";try{const y=await t.createProject(o.value.name,o.value.workingDirectory,o.value.isMultiAgent);o.value.createSession&&await i.createSession(y.project_id,{name:o.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),m&&m.hide(),h()}catch(y){console.error("Failed to create project:",y),v.value=y.message||"Failed to create project. Please try again."}finally{p.value=!1}}}function h(){o.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},n.value={},v.value=""}function M(){const y=document.getElementById("projectName");y&&y.focus()}function j(){h(),a.hideModal()}return Q(()=>a.currentModal,y=>{y?.name==="create-project"&&m&&m.show()}),oe(()=>{d.value&&se(async()=>{const{default:y}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:y}},__vite__mapDeps([0,1])).then(({default:y})=>{m=new y(d.value),d.value.addEventListener("shown.bs.modal",M),d.value.addEventListener("hidden.bs.modal",j)})}),ne(()=>{d.value&&(d.value.removeEventListener("shown.bs.modal",M),d.value.removeEventListener("hidden.bs.modal",j)),m&&m.dispose()}),(y,c)=>(l(),r("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:d},[e("div",cd,[e("div",md,[c[11]||(c[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",pd,[e("form",{onSubmit:ae(b,["prevent"])},[e("div",vd,[c[5]||(c[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),K(e("input",{type:"text",class:W(["form-control",{"is-invalid":n.value.name}]),id:"projectName","onUpdate:modelValue":c[0]||(c[0]=C=>o.value.name=C),placeholder:"My Project",required:""},null,2),[[X,o.value.name]]),n.value.name?(l(),r("div",fd,f(n.value.name),1)):I("",!0)]),e("div",gd,[c[6]||(c[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",_d,[K(e("input",{type:"text",class:W(["form-control",{"is-invalid":n.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":c[1]||(c[1]=C=>o.value.workingDirectory=C),placeholder:"/path/to/project",required:""},null,2),[[X,o.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:g}," Browse... "),n.value.workingDirectory?(l(),r("div",bd,f(n.value.workingDirectory),1)):I("",!0)]),c[7]||(c[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",hd,[K(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":c[2]||(c[2]=C=>o.value.isMultiAgent=C)},null,512),[[we,o.value.isMultiAgent]]),c[8]||(c[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," 🏛 Multi-Agent Project (Legion) ",-1)),c[9]||(c[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",yd,[K(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":c[3]||(c[3]=C=>o.value.createSession=C)},null,512),[[we,o.value.createSession]]),e("label",$d," Create initial "+f(o.value.isMultiAgent?"minion":"session"),1)]),o.value.createSession?(l(),r("div",wd,[e("label",Sd," Initial "+f(o.value.isMultiAgent?"Minion":"Session")+" Name ",1),K(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":c[4]||(c[4]=C=>o.value.sessionName=C),placeholder:"main"},null,512),[[X,o.value.sessionName]])])):I("",!0),v.value?(l(),r("div",kd,f(v.value),1)):I("",!0)],32)]),e("div",Cd,[c[10]||(c[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:b,disabled:p.value},[p.value?(l(),r("span",jd)):I("",!0),H(" "+f(p.value?"Creating...":"Create Project"),1)],8,xd)])])])],512))}},Td=q(Md,[["__scopeId","data-v-adf50394"]]),Ed={class:"modal-dialog"},Id={class:"modal-content"},Pd={class:"modal-body"},Ld={class:"mb-3"},Dd={key:0,class:"invalid-feedback"},Od={class:"mb-3"},Nd=["value"],Ad={key:0,class:"alert alert-danger",role:"alert"},Rd={class:"danger-zone"},qd={class:"text-muted small"},Ud=["disabled"],Hd={key:0,class:"alert alert-warning mt-3",role:"alert"},Wd={class:"mb-2"},Fd={class:"d-flex gap-2"},Bd=["disabled"],Vd={key:0,class:"spinner-border spinner-border-sm me-2"},zd=["disabled"],Jd={class:"modal-footer"},Kd=["disabled"],Gd={key:0,class:"spinner-border spinner-border-sm me-2"},Yd={__name:"ProjectEditModal",setup(s){const t=ee(),i=Z(),a=E(null),o=E({name:""}),n=E({name:""}),p=E(!1),v=E(!1),d=E(""),m=E(!1),g=E(null);let $=null;const b=u(()=>a.value?.session_ids?.length||0);function h(){n.value={};let _=!0;return o.value.name.trim()||(n.value.name="Project name is required",_=!1),_}async function M(){if(!(!h()||!a.value)){p.value=!0,d.value="";try{await t.updateProject(a.value.project_id,{name:o.value.name}),$&&$.hide()}catch(_){console.error("Failed to update project:",_),d.value=_.message||"Failed to update project. Please try again."}finally{p.value=!1}}}async function j(){if(a.value){v.value=!0,d.value="";try{await t.deleteProject(a.value.project_id),$&&$.hide()}catch(_){console.error("Failed to delete project:",_),d.value=_.message||"Failed to delete project. Please try again."}finally{v.value=!1}}}function y(){o.value={name:""},n.value={},d.value="",m.value=!1}function c(){const _=document.getElementById("editProjectName");_&&(_.focus(),_.select())}function C(){y(),a.value=null,i.hideModal()}return Q(()=>i.currentModal,_=>{if(_?.name==="edit-project"&&$){const k=_.data||{};a.value=k.project,a.value&&(o.value.name=a.value.name),$.show()}}),oe(()=>{g.value&&se(async()=>{const{default:_}=await import("./modal-B4rHLo2F.js").then(k=>k.m);return{default:_}},__vite__mapDeps([0,1])).then(({default:_})=>{$=new _(g.value),g.value.addEventListener("shown.bs.modal",c),g.value.addEventListener("hidden.bs.modal",C)})}),ne(()=>{g.value&&(g.value.removeEventListener("shown.bs.modal",c),g.value.removeEventListener("hidden.bs.modal",C)),$&&$.dispose()}),(_,k)=>(l(),r("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:g},[e("div",Ed,[e("div",Id,[k[11]||(k[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Pd,[e("form",{onSubmit:ae(M,["prevent"])},[e("div",Ld,[k[3]||(k[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),K(e("input",{type:"text",class:W(["form-control",{"is-invalid":n.value.name}]),id:"editProjectName","onUpdate:modelValue":k[0]||(k[0]=w=>o.value.name=w),placeholder:"My Project",required:""},null,2),[[X,o.value.name]]),n.value.name?(l(),r("div",Dd,f(n.value.name),1)):I("",!0)]),e("div",Od,[k[4]||(k[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:a.value?.working_directory,disabled:"",readonly:""},null,8,Nd),k[5]||(k[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),d.value?(l(),r("div",Ad,f(d.value),1)):I("",!0)],32),k[9]||(k[9]=e("hr",null,null,-1)),e("div",Rd,[k[7]||(k[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",qd," Deleting this project will also delete all "+f(b.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:k[1]||(k[1]=w=>m.value=!0),disabled:v.value},[...k[6]||(k[6]=[e("i",{class:"bi bi-trash"},null,-1),H(" Delete Project ",-1)])],8,Ud)]),m.value?(l(),r("div",Hd,[k[8]||(k[8]=e("strong",null,"Are you sure?",-1)),e("p",Wd,' This will permanently delete the project "'+f(a.value?.name)+'" and all '+f(b.value)+" session(s). ",1),e("div",Fd,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:j,disabled:v.value},[v.value?(l(),r("span",Vd)):I("",!0),H(" "+f(v.value?"Deleting...":"Yes, Delete Permanently"),1)],8,Bd),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:k[2]||(k[2]=w=>m.value=!1),disabled:v.value}," Cancel ",8,zd)])])):I("",!0)]),e("div",Jd,[k[10]||(k[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:M,disabled:p.value},[p.value?(l(),r("span",Gd)):I("",!0),H(" "+f(p.value?"Saving...":"Save Changes"),1)],8,Kd)])])])],512))}},Qd=q(Yd,[["__scopeId","data-v-6f299f35"]]),Zd={class:"modal-dialog modal-lg"},Xd={class:"modal-content"},eu={class:"modal-header"},tu={class:"modal-title",id:"createSessionModalLabel"},su={key:0,class:"text-muted small"},ou={class:"modal-body"},nu={class:"mb-3"},lu={key:0,class:"invalid-feedback"},au={class:"mb-3"},ru={class:"mb-3"},iu={class:"mb-3"},du={class:"mb-3"},uu={class:"mb-3 form-check"},cu={key:0,class:"alert alert-danger",role:"alert"},mu={class:"modal-footer"},pu=["disabled"],vu={key:0,class:"spinner-border spinner-border-sm me-2"},fu={__name:"SessionCreateModal",setup(s){const t=ie();ee();const i=B(),a=Z(),o=E(null),n=E({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",tools:"",startImmediately:!0}),p=E({name:""}),v=E(!1),d=E(""),m=E(null);let g=null;function $(){p.value={};let y=!0;return n.value.name.trim()||(p.value.name="Session name is required",y=!1),y}async function b(){if(!(!$()||!o.value)){v.value=!0,d.value="";try{const y=n.value.tools.split(",").map(_=>_.trim()).filter(_=>_.length>0),c={name:n.value.name,permission_mode:n.value.permission_mode,model:n.value.model,system_prompt:n.value.system_prompt.trim()||null,tools:y},C=await i.createSession(o.value.project_id,c);n.value.startImmediately&&await i.startSession(C.session_id),t.push(`/session/${C.session_id}`),g&&g.hide(),h()}catch(y){console.error("Failed to create session:",y),d.value=y.message||"Failed to create session. Please try again."}finally{v.value=!1}}}function h(){n.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",tools:"",startImmediately:!0},p.value={},d.value=""}function M(){const y=document.getElementById("sessionName");y&&y.focus()}function j(){h(),o.value=null,a.hideModal()}return Q(()=>a.currentModal,y=>{if(y?.name==="create-session"&&g){const c=y.data||{};o.value=c.project,g.show()}}),oe(()=>{m.value&&se(async()=>{const{default:y}=await import("./modal-B4rHLo2F.js").then(c=>c.m);return{default:y}},__vite__mapDeps([0,1])).then(({default:y})=>{g=new y(m.value),m.value.addEventListener("shown.bs.modal",M),m.value.addEventListener("hidden.bs.modal",j)})}),ne(()=>{m.value&&(m.value.removeEventListener("shown.bs.modal",M),m.value.removeEventListener("hidden.bs.modal",j)),g&&g.dispose()}),(y,c)=>(l(),r("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:m},[e("div",Zd,[e("div",Xd,[e("div",eu,[e("h5",tu,[c[6]||(c[6]=H(" Create New Session ",-1)),o.value?(l(),r("span",su,"in "+f(o.value.name),1)):I("",!0)]),c[7]||(c[7]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",ou,[e("form",{onSubmit:ae(b,["prevent"])},[e("div",nu,[c[8]||(c[8]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),K(e("input",{type:"text",class:W(["form-control",{"is-invalid":p.value.name}]),id:"sessionName","onUpdate:modelValue":c[0]||(c[0]=C=>n.value.name=C),placeholder:"main",required:""},null,2),[[X,n.value.name]]),p.value.name?(l(),r("div",lu,f(p.value.name),1)):I("",!0)]),e("div",au,[c[10]||(c[10]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),K(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":c[1]||(c[1]=C=>n.value.permission_mode=C)},[...c[9]||(c[9]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"⚠️ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[de,n.value.permission_mode]]),c[11]||(c[11]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",ru,[c[13]||(c[13]=e("label",{for:"model",class:"form-label"},"Model",-1)),K(e("select",{class:"form-select",id:"model","onUpdate:modelValue":c[2]||(c[2]=C=>n.value.model=C)},[...c[12]||(c[12]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[de,n.value.model]])]),e("div",iu,[c[14]||(c[14]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),K(e("textarea",{class:"form-control",id:"systemPrompt","onUpdate:modelValue":c[3]||(c[3]=C=>n.value.system_prompt=C),rows:"3",placeholder:"Additional instructions to append to the system prompt..."},null,512),[[X,n.value.system_prompt]]),c[15]||(c[15]=e("div",{class:"form-text"}," These instructions will be appended to Claude Code's default system prompt ",-1))]),e("div",du,[c[16]||(c[16]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),K(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":c[4]||(c[4]=C=>n.value.tools=C),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[X,n.value.tools]]),c[17]||(c[17]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",uu,[K(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":c[5]||(c[5]=C=>n.value.startImmediately=C)},null,512),[[we,n.value.startImmediately]]),c[18]||(c[18]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),d.value?(l(),r("div",cu,f(d.value),1)):I("",!0)],32)]),e("div",mu,[c[19]||(c[19]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:b,disabled:v.value},[v.value?(l(),r("span",vu)):I("",!0),H(" "+f(v.value?"Creating...":"Create Session"),1)],8,pu)])])])],512))}},gu=q(fu,[["__scopeId","data-v-75934d4f"]]),_u={class:"modal-dialog"},bu={class:"modal-content"},hu={class:"modal-body"},yu={class:"mb-3"},$u={key:0,class:"invalid-feedback"},wu={class:"mb-3"},Su=["value"],ku={class:"mb-3"},Cu={class:"form-control-plaintext"},xu={class:"mb-3"},ju=["disabled"],Mu={key:0,value:"bypassPermissions"},Tu={class:"form-text"},Eu={key:0,class:"text-warning"},Iu={key:1},Pu={key:0,class:"alert alert-danger",role:"alert"},Lu={class:"modal-footer"},Du=["disabled"],Ou={key:0,class:"spinner-border spinner-border-sm me-2"},Nu={__name:"SessionEditModal",setup(s){const t=B(),i=Z(),a=E(null),o=E({name:"",permission_mode:"default"}),n=E({name:""}),p=E(!1),v=E(""),d=E(null);let m=null;const g=u(()=>a.value?.state==="active"||a.value?.state==="starting"),$=u(()=>a.value?.initial_permission_mode==="bypassPermissions");function b(C){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[C]||"bg-secondary"}function h(){n.value={};let C=!0;return o.value.name.trim()||(n.value.name="Session name is required",C=!1),C}async function M(){if(!(!h()||!a.value)){p.value=!0,v.value="";try{await t.updateSessionName(a.value.session_id,o.value.name),o.value.permission_mode!==a.value.current_permission_mode&&await t.setPermissionMode(a.value.session_id,o.value.permission_mode),m&&m.hide()}catch(C){console.error("Failed to update session:",C),v.value=C.message||"Failed to update session. Please try again."}finally{p.value=!1}}}function j(){o.value={name:"",permission_mode:"default"},n.value={},v.value=""}function y(){const C=document.getElementById("editSessionName");C&&(C.focus(),C.select())}function c(){j(),a.value=null,i.hideModal()}return Q(()=>i.currentModal,C=>{if(C?.name==="edit-session"&&m){const _=C.data||{};a.value=_.session,a.value&&(o.value.name=a.value.name,o.value.permission_mode=a.value.current_permission_mode||"default"),m.show()}}),oe(()=>{d.value&&se(async()=>{const{default:C}=await import("./modal-B4rHLo2F.js").then(_=>_.m);return{default:C}},__vite__mapDeps([0,1])).then(({default:C})=>{m=new C(d.value),d.value.addEventListener("shown.bs.modal",y),d.value.addEventListener("hidden.bs.modal",c)})}),ne(()=>{d.value&&(d.value.removeEventListener("shown.bs.modal",y),d.value.removeEventListener("hidden.bs.modal",c)),m&&m.dispose()}),(C,_)=>(l(),r("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:d},[e("div",_u,[e("div",bu,[_[11]||(_[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",hu,[e("form",{onSubmit:ae(M,["prevent"])},[e("div",yu,[_[2]||(_[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),K(e("input",{type:"text",class:W(["form-control",{"is-invalid":n.value.name}]),id:"editSessionName","onUpdate:modelValue":_[0]||(_[0]=k=>o.value.name=k),placeholder:"Session Name",required:""},null,2),[[X,o.value.name]]),n.value.name?(l(),r("div",$u,f(n.value.name),1)):I("",!0)]),e("div",wu,[_[3]||(_[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:a.value?.working_directory,disabled:"",readonly:""},null,8,Su),_[4]||(_[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",ku,[_[5]||(_[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",Cu,[e("span",{class:W(["badge",b(a.value?.state)])},f(a.value?.state),3)])]),e("div",xu,[_[9]||(_[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),K(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":_[1]||(_[1]=k=>o.value.permission_mode=k),disabled:!g.value},[_[6]||(_[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),_[7]||(_[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),_[8]||(_[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),$.value?(l(),r("option",Mu,"⚠️ Bypass Permissions (No prompts)")):I("",!0)],8,ju),[[de,o.value.permission_mode]]),e("div",Tu,[g.value?(l(),r("span",Iu," Controls which tool actions require permission prompts ")):(l(),r("span",Eu," ⚠️ Session must be active to change permission mode. Start the session first. "))])]),v.value?(l(),r("div",Pu,f(v.value),1)):I("",!0)],32)]),e("div",Lu,[_[10]||(_[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:M,disabled:p.value},[p.value?(l(),r("span",Ou)):I("",!0),H(" "+f(p.value?"Saving...":"Save Changes"),1)],8,Du)])])])],512))}},Au=q(Nu,[["__scopeId","data-v-ec2f9089"]]),Ru={class:"modal-dialog modal-dialog-centered"},qu={class:"modal-content"},Uu={class:"modal-header"},Hu={class:"modal-title",id:"manageSessionModalLabel"},Wu={class:"modal-body"},Fu={key:0,class:"text-center py-4"},Bu={class:"text-muted"},Vu={key:1},zu={key:2},Ju={class:"text-muted"},Ku={key:3},Gu={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Yu={class:"d-grid gap-2"},Qu=["disabled"],Zu=["disabled"],Xu=["disabled"],ec=["disabled"],tc={class:"modal-footer"},sc={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},oc={__name:"SessionManageModal",setup(s){const t=ie(),i=B(),a=Z(),o=ce();ue();const n=E(null),p=E(!1),v=E(""),d=E(""),m=E(null),g=E(null);let $=null;const b=u(()=>m.value==="reset"?"Reset Session":m.value==="delete"?"Delete Session":"Manage Session");function h(){m.value="reset"}function M(){m.value="delete"}function j(){m.value=null}async function y(){m.value==="reset"?await _():m.value==="delete"&&await k()}async function c(){if(n.value){p.value=!0,v.value="Restarting session...";try{const N=n.value.session_id,O=await V.post(`/api/sessions/${N}/restart`);if(O.success)console.log("Session restarted successfully, reconnecting"),await o.disconnectSession(),await i.selectSession(N),$&&$.hide();else{const P=O.error||O.detail||"Failed to restart session";console.error("Failed to restart session:",P),d.value=`Failed to restart session: ${P}`}}catch(N){console.error("Error restarting session:",N);const O=N.data?.detail||N.message||"Unknown error";d.value=`Error restarting session: ${O}`}finally{p.value=!1}}}async function C(){if(n.value)try{$&&$.hide(),console.log("Ending session",n.value.session_id);const N=n.value.session_id;await V.post(`/api/sessions/${N}/terminate`),await o.disconnectSession(),i.currentSessionId===N&&(i.currentSessionId=null),t.push("/")}catch(N){console.error("Error ending session:",N),await o.disconnectSession(),i.currentSessionId===n.value?.session_id&&(i.currentSessionId=null),t.push("/")}}async function _(){if(n.value){p.value=!0,v.value="Resetting session...";try{const N=n.value.session_id,O=await V.post(`/api/sessions/${N}/reset`);if(O.success)console.log("Session reset successfully, reconnecting"),await o.disconnectSession(),i.currentSessionId=null,await i.selectSession(N),$&&$.hide();else{const P=O.error||O.detail||"Failed to reset session";console.error("Failed to reset session:",P),d.value=`Failed to reset session: ${P}`,m.value=null}}catch(N){console.error("Error resetting session:",N);const O=N.data?.detail||N.message||"Unknown error";d.value=`Error resetting session: ${O}`,m.value=null}finally{p.value=!1}}}async function k(){if(n.value){p.value=!0,v.value="Deleting session...";try{const N=n.value.session_id;await i.deleteSession(N),t.currentRoute.value.params.sessionId===N&&t.push("/"),$&&$.hide()}catch(N){console.error("Error deleting session:",N);const O=N.data?.detail||N.message||"Unknown error";d.value=`Error deleting session: ${O}`,m.value=null}finally{p.value=!1}}}function w(){m.value=null,p.value=!1,v.value="",d.value=""}function x(){w(),n.value=null,a.hideModal()}return Q(()=>a.currentModal,N=>{if(N?.name==="manage-session"&&$){const O=N.data||{};n.value=O.session,w(),$.show()}}),oe(()=>{g.value&&se(async()=>{const{default:N}=await import("./modal-B4rHLo2F.js").then(O=>O.m);return{default:N}},__vite__mapDeps([0,1])).then(({default:N})=>{$=new N(g.value),g.value.addEventListener("hidden.bs.modal",x)})}),ne(()=>{g.value&&g.value.removeEventListener("hidden.bs.modal",x),$&&$.dispose()}),(N,O)=>(l(),r("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:g},[e("div",Ru,[e("div",qu,[e("div",Uu,[e("h5",Hu,f(m.value?b.value:"Manage Session"),1),O[1]||(O[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Wu,[p.value?(l(),r("div",Fu,[O[2]||(O[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Bu,f(v.value),1)])):m.value==="reset"?(l(),r("div",Vu,[...O[3]||(O[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):m.value==="delete"?(l(),r("div",zu,[O[6]||(O[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"⚠️ Warning: This action cannot be undone")],-1)),e("p",Ju,[O[4]||(O[4]=H("This will permanently delete session ",-1)),e("strong",null,f(n.value?.name),1),O[5]||(O[5]=H(".",-1))]),O[7]||(O[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(l(),r("div",Ku,[d.value?(l(),r("div",Gu,[O[8]||(O[8]=e("strong",null,"Error:",-1)),H(" "+f(d.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:O[0]||(O[0]=P=>d.value="")})])):I("",!0),O[15]||(O[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",Yu,[e("button",{class:"btn btn-outline-primary text-start",onClick:c,disabled:p.value},[...O[9]||(O[9]=[e("strong",null,"🔄 Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,Qu),e("button",{class:"btn btn-outline-secondary text-start",onClick:C,disabled:p.value},[...O[10]||(O[10]=[e("strong",null,"🚪 End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,Zu),O[13]||(O[13]=e("hr",{class:"my-2"},null,-1)),O[14]||(O[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"⚠️ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:h,disabled:p.value},[...O[11]||(O[11]=[e("strong",null,"🗑️ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,Xu),e("button",{class:"btn btn-outline-danger text-start",onClick:M,disabled:p.value},[...O[12]||(O[12]=[e("strong",null,"❌ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,ec)]),O[16]||(O[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),H(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",tc,[m.value&&!p.value?(l(),r(G,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:j},"Cancel"),e("button",{type:"button",class:W(["btn",m.value==="delete"?"btn-danger":"btn-warning"]),onClick:y},f(m.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):p.value?I("",!0):(l(),r("button",sc,"Cancel"))])])])],512))}},nc=q(oc,[["__scopeId","data-v-b466fd33"]]),lc={class:"modal-dialog modal-dialog-centered modal-lg"},ac={class:"modal-content"},rc={class:"modal-body"},ic={key:0,class:"text-center text-muted py-4"},dc={key:1},uc={class:"mb-3"},cc={class:"font-monospace small"},mc={class:"mb-3"},pc={class:"font-monospace small"},vc={class:"mb-3"},fc={class:"mb-3"},gc={class:"mb-3"},_c={key:0},bc={class:"d-flex flex-wrap gap-1"},hc={key:1,class:"text-muted small"},yc={key:0,class:"mb-3"},$c={class:"d-flex flex-wrap gap-1"},wc={key:1,class:"mb-3"},Sc={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},kc={class:"mb-3"},Cc={class:"text-muted"},xc={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},jc={__name:"SessionInfoModal",setup(s){const t=B(),i=ue(),a=Z(),o=E(null),n=E(!1),p=E(null);let v=null;const d=u(()=>{if(!o.value)return null;const b=t.initData.get(o.value);return b||(i.messagesBySession.get(o.value)||[]).find(j=>j.type==="system"&&(j.subtype==="init"||j.metadata?.subtype==="init")&&j.metadata?.init_data)?.metadata?.init_data||null});function m(b){return typeof b=="string"?b:typeof b=="object"&&b.type==="preset"?`Preset: ${b.preset}`:JSON.stringify(b,null,2)}function g(){o.value=null,n.value=!1}function $(){g(),a.hideModal()}return Q(()=>a.currentModal,b=>{if(b?.name==="session-info"&&v){const h=b.data||{};o.value=h.sessionId,n.value=!1,v.show()}}),oe(()=>{p.value&&se(async()=>{const{default:b}=await import("./modal-B4rHLo2F.js").then(h=>h.m);return{default:b}},__vite__mapDeps([0,1])).then(({default:b})=>{v=new b(p.value),p.value.addEventListener("hidden.bs.modal",$)})}),ne(()=>{p.value&&p.value.removeEventListener("hidden.bs.modal",$),v&&v.dispose()}),(b,h)=>(l(),r("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:p},[e("div",lc,[e("div",ac,[h[9]||(h[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",rc,[d.value?(l(),r("div",dc,[e("div",uc,[h[1]||(h[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",cc,f(o.value),1)]),e("div",mc,[h[2]||(h[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",pc,f(d.value.cwd||"Not specified"),1)]),e("div",vc,[h[3]||(h[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,f(d.value.model||"Default"),1)]),e("div",fc,[h[4]||(h[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,f(d.value.permissionMode||"default"),1)]),e("div",gc,[h[5]||(h[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),d.value.tools&&d.value.tools.length>0?(l(),r("div",_c,[e("div",bc,[(l(!0),r(G,null,Y(d.value.tools,M=>(l(),r("span",{key:M,class:"badge bg-secondary"},f(M),1))),128))])])):(l(),r("div",hc,"All tools available"))]),d.value.commands&&d.value.commands.length>0?(l(),r("div",yc,[h[6]||(h[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",$c,[(l(!0),r(G,null,Y(d.value.commands,M=>(l(),r("span",{key:M,class:"badge bg-info"},f(M),1))),128))])])):I("",!0),d.value.systemPrompt?(l(),r("div",wc,[h[7]||(h[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",Sc,f(m(d.value.systemPrompt)),1)])):I("",!0),e("div",kc,[e("h6",Cc,[h[8]||(h[8]=H(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:h[0]||(h[0]=M=>n.value=!n.value)},f(n.value?"Hide":"Show"),1)]),n.value?(l(),r("pre",xc,f(JSON.stringify(d.value,null,2)),1)):I("",!0)])])):(l(),r("div",ic," No session configuration data available "))]),h[10]||(h[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},Mc=q(jc,[["__scopeId","data-v-809e2099"]]),Tc={class:"modal-dialog modal-dialog-centered"},Ec={class:"modal-content"},Ic={class:"modal-body"},Pc={class:"mb-3"},Lc={class:"mb-3"},Dc={class:"mb-3"},Oc={class:"mb-3"},Nc={key:0,class:"alert alert-danger"},Ac={class:"modal-footer"},Rc=["disabled"],qc={key:0,class:"spinner-border spinner-border-sm me-2"},Uc={__name:"CreateMinionModal",setup(s){const t=ie(),i=ee(),a=B(),o=Z(),n=E(null);let p=null;const v=E(null),d=E({name:"",role:"",initialization_context:"",capabilities:[]}),m=E(""),g=E(""),$=E(!1),b=u(()=>m.value.trim()?m.value.split(",").map(y=>y.trim()).filter(y=>y.length>0):[]);function h(){d.value={name:"",role:"",initialization_context:"",capabilities:[]},m.value="",g.value="",$.value=!1}function M(){h(),o.hideModal()}async function j(){if(!d.value.name.trim()){g.value="Minion name is required";return}if(d.value.name.includes(" ")){g.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(!v.value){g.value="Legion ID is missing";return}$.value=!0,g.value="";try{const y={name:d.value.name.trim(),role:d.value.role.trim(),initialization_context:d.value.initialization_context.trim(),capabilities:b.value},c=await V.post(`/api/legions/${v.value}/minions`,y);c.success&&c.minion_id?(await i.fetchProjects(),await a.fetchSessions(),p&&p.hide(),t.push(`/spy/${v.value}/${c.minion_id}`)):g.value="Failed to create minion"}catch(y){console.error("Failed to create minion:",y),g.value=y.response?.data?.detail||"Failed to create minion"}finally{$.value=!1}}return Q(()=>o.currentModal,y=>{if(y?.name==="create-minion"&&p){const c=y.data||{};v.value=c.project?.project_id||null,h(),p.show()}}),oe(()=>{n.value&&se(()=>import("./modal-B4rHLo2F.js").then(y=>y.m),__vite__mapDeps([0,1])).then(y=>{const c=y.default;p=new c(n.value),n.value.addEventListener("hidden.bs.modal",M)})}),ne(()=>{n.value&&n.value.removeEventListener("hidden.bs.modal",M),p&&p.dispose()}),(y,c)=>(l(),r("div",{ref_key:"modalElement",ref:n,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",Tc,[e("div",Ec,[c[13]||(c[13]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Ic,[e("form",{onSubmit:ae(j,["prevent"])},[e("div",Pc,[c[4]||(c[4]=e("label",{for:"minion-name",class:"form-label"},[H(" Name "),e("span",{class:"text-danger"},"*")],-1)),K(e("input",{id:"minion-name","onUpdate:modelValue":c[0]||(c[0]=C=>d.value.name=C),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[X,d.value.name]]),c[5]||(c[5]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",Lc,[c[6]||(c[6]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),K(e("input",{id:"minion-role","onUpdate:modelValue":c[1]||(c[1]=C=>d.value.role=C),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[X,d.value.role]]),c[7]||(c[7]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",Dc,[c[8]||(c[8]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),K(e("textarea",{id:"minion-context","onUpdate:modelValue":c[2]||(c[2]=C=>d.value.initialization_context=C),class:"form-control",rows:"4",placeholder:"Instructions and context for the minion..."},null,512),[[X,d.value.initialization_context]]),c[9]||(c[9]=e("div",{class:"form-text"},"Instructions and context to initialize the minion with",-1))]),e("div",Oc,[c[10]||(c[10]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),K(e("input",{id:"minion-capabilities","onUpdate:modelValue":c[3]||(c[3]=C=>m.value=C),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[X,m.value]]),c[11]||(c[11]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),g.value?(l(),r("div",Nc,f(g.value),1)):I("",!0)],32)]),e("div",Ac,[c[12]||(c[12]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!d.value.name.trim()||$.value,onClick:j},[$.value?(l(),r("span",qc)):I("",!0),H(" "+f($.value?"Creating...":"Create Minion"),1)],8,Rc)])])])],512))}},Hc=q(Uc,[["__scopeId","data-v-fd1df88d"]]),Wc={class:"container-fluid vh-100 d-flex flex-column p-0"},Fc={class:"d-flex flex-grow-1 overflow-hidden position-relative"},Bc={class:"flex-grow-1 d-flex flex-column overflow-hidden"},Vc={__name:"App",setup(s){const t=Z(),i=ce(),a=B(),o=ee(),n=ie(),p=u(()=>t.sidebarCollapsed),v=u(()=>t.isMobile);oe(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),i.connectUI(),await Promise.all([o.fetchProjects(),a.fetchSessions()]);const g=window.location.hash;if(g.startsWith("#/session/")){const $=g.replace("#/session/","");a.sessions.has($)&&await a.selectSession($)}else if(g.startsWith("#/timeline/")){const $=g.replace("#/timeline/","");n.push(`/timeline/${$}`)}window.addEventListener("popstate",d),window.addEventListener("resize",t.handleResize)}),ne(()=>{window.removeEventListener("popstate",d),window.removeEventListener("resize",t.handleResize),i.disconnectUI()});function d(){const g=window.location.hash;if(g.startsWith("#/session/")){const $=g.replace("#/session/","");a.sessions.has($)&&a.selectSession($)}}function m(){t.toggleSidebar()}return(g,$)=>{const b=Re("router-view");return l(),r("div",Wc,[J(ui),e("div",{id:"sidebar-backdrop",class:W({show:!p.value&&v.value}),onClick:m},null,2),e("div",Fc,[J(Ji),e("main",Bc,[J(b)])]),J(ud),J(Td),J(Qd),J(gu),J(Au),J(nc),J(Mc),J(Hc)])}}},Ce=We(Vc);Ce.use(Fe());Ce.use(ai);Ce.mount("#app");
