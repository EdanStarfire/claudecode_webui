const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/modal-B4rHLo2F.js","assets/diff-vendor-DG4m3V_x.js"])))=>i.map(i=>d[i]);
import{c as r,a as e,o as l,d as _e,r as L,b as c,t as f,n as me,e as B,f as G,u as we,w as te,g as Le,h as E,F as Z,i as ee,j as ue,k as qe,l as Y,v as ne,m as Q,p as ie,q as je,s as Se,x as re,y as ce,z as fe,A as Ue,B as Fe,C as Be,D as pe,E as be,G as Ve,H as ze}from"./vue-vendor-BChC3Sgv.js";import{m as he,p as Te}from"./markdown-vendor-CQ3OZdP9.js";import{c as Ge}from"./diff-vendor-DG4m3V_x.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const p of n.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function m(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=m(o);fetch(o.href,n)}})();const Je={class:"flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center p-5"},Ke={__name:"NoSessionSelected",setup(s){return(t,m)=>(l(),r("div",Je,[...m[0]||(m[0]=[e("h2",{class:"text-muted"},"No Session Selected",-1),e("p",{class:"text-secondary"}," Create a new session or select an existing one to start chatting with Claude Code. ",-1)])]))}},Ye="modulepreload",Qe=function(s){return"/"+s},Ie={},ae=function(t,m,i){let o=Promise.resolve();if(m&&m.length>0){let u=function(v){return Promise.all(v.map(_=>Promise.resolve(_).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),g=p?.nonce||p?.getAttribute("nonce");o=u(m.map(v=>{if(v=Qe(v),v in Ie)return;Ie[v]=!0;const _=v.endsWith(".css"),w=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${w}`))return;const $=document.createElement("link");if($.rel=_?"stylesheet":Ye,_||($.as="script"),$.crossOrigin="",$.href=v,g&&$.setAttribute("nonce",g),document.head.appendChild($),_)return new Promise((b,j)=>{$.addEventListener("load",b),$.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${v}`)))})}))}function n(p){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=p,window.dispatchEvent(g),!g.defaultPrevented)throw p}return o.then(p=>{for(const g of p||[])g.status==="rejected"&&n(g.reason);return t().catch(n)})};class Ce extends Error{constructor(t,m,i){super(t),this.name="APIError",this.status=m,this.data=i}}async function ye(s,t={}){try{const m=await fetch(s,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!m.ok){let o;try{o=await m.json()}catch{o={detail:m.statusText}}throw new Ce(o.detail||`HTTP ${m.status}: ${m.statusText}`,m.status,o)}const i=m.headers.get("content-type");return i&&i.includes("application/json")?await m.json():await m.text()}catch(m){throw m instanceof Ce?m:(console.error("API request failed:",m),new Ce(`Network error: ${m.message}`,0,null))}}async function Ze(s,t={}){let m=s;if(t.params){const i=new URLSearchParams;for(const[g,u]of Object.entries(t.params))u!=null&&i.append(g,u);const o=i.toString();o&&(m=`${s}?${o}`);const{params:n,...p}=t;return ye(m,{...p,method:"GET"})}return ye(m,{...t,method:"GET"})}async function Xe(s,t,m={}){return ye(s,{...m,method:"POST",body:JSON.stringify(t)})}async function et(s,t,m={}){return ye(s,{...m,method:"PUT",body:JSON.stringify(t)})}async function tt(s,t={}){return ye(s,{...t,method:"DELETE"})}const K={get:Ze,post:Xe,put:et,delete:tt},J=_e("session",()=>{const s=L(new Map),t=L(null),m=L(new Map),i=L(new Map),o=L(new Set),n=L(!1);let p=null;const g=c(()=>s.value.get(t.value)),u=c(()=>Array.from(s.value.values()).sort((k,P)=>k.order-P.order)),v=k=>c(()=>u.value.filter(P=>P.project_id===k)),_=c({get:()=>m.value.get(t.value)||"",set:k=>{t.value&&m.value.set(t.value,k)}});async function w(){try{const k=await K.get("/api/sessions");return s.value.clear(),k.sessions.forEach(P=>{s.value.set(P.session_id,P)}),console.log(`Loaded ${s.value.size} sessions`),k.sessions}catch(k){throw console.error("Failed to fetch sessions:",k),k}}async function $(k,P){try{const R=(await K.post("/api/sessions",{project_id:k,...P})).session_id,d=(await K.get(`/api/sessions/${R}`)).session;return s.value.set(R,d),s.value=new Map(s.value),console.log(`Created session ${R}`),d}catch(H){throw console.error("Failed to create session:",H),H}}async function b(k){if(t.value===k&&!n.value)return;p&&(console.log(`Aborting pending selection to switch to ${k}`),p.abort(),p=null);const P=new AbortController;p=P,n.value=!0;try{if(t.value=k,P.signal.aborted){console.log(`Selection of ${k} aborted early`);return}let H=s.value.get(k);if(!H)try{const d=await K.get(`/api/sessions/${k}`);if(P.signal.aborted){console.log(`Selection of ${k} aborted after fetch`);return}H=d.session,s.value.set(k,H),s.value=new Map(s.value),console.log(`Fetched session ${k} for deeplink`)}catch(d){console.error(`Failed to fetch session ${k}:`,d);return}if(H&&(H.state==="created"||H.state==="terminated"))try{if(await C(k),P.signal.aborted){console.log(`Selection of ${k} aborted after start`);return}console.log(`Auto-started session ${k} (was in ${H.state} state)`);const d=6e4,M=200,A=5e3;let N=0,x=0;for(;N<d;){if(P.signal.aborted){console.log(`Selection of ${k} aborted during state wait`);return}const W=s.value.get(k);if(W&&W.state==="active"){console.log(`Session ${k} is now active after ${N}ms`);break}if(N-x>=A){const F=s.value.get(k)?.state||"unknown";console.log(`Waiting for session ${k} to become active (current: ${F}, ${N/1e3}s elapsed)`),x=N}await new Promise(F=>setTimeout(F,M)),N+=M}const I=s.value.get(k);I&&I.state!=="active"&&console.warn(`Session ${k} did not become active within ${d/1e3}s (state: ${I.state}), continuing anyway`)}catch(d){console.error(`Failed to auto-start session ${k}:`,d)}if(P.signal.aborted){console.log(`Selection of ${k} aborted before message load`);return}if(await(await ae(()=>Promise.resolve().then(()=>$t),void 0)).useMessageStore().loadMessages(k),P.signal.aborted){console.log(`Selection of ${k} aborted after message load`);return}await(await ae(()=>Promise.resolve().then(()=>Ht),void 0)).useWebSocketStore().connectSession(k),P.signal.aborted||console.log(`Selected session ${k}`)}finally{p===P&&(p=null),n.value=!1}}function j(k,P){const H=s.value.get(k);H&&(Object.assign(H,P),s.value=new Map(s.value))}async function T(k){o.value.add(k);try{await K.delete(`/api/sessions/${k}`),s.value.delete(k),m.value.delete(k),i.value.delete(k),s.value=new Map(s.value),t.value===k&&(t.value=null),console.log(`Deleted session ${k}`)}catch(P){throw console.error("Failed to delete session:",P),P}finally{o.value.delete(k)}}async function S(k,P){try{await K.put(`/api/sessions/${k}/name`,{name:P}),j(k,{name:P}),console.log(`Updated session ${k} name to "${P}"`)}catch(H){throw console.error("Failed to update session name:",H),H}}async function y(k,P){try{await K.post(`/api/sessions/${k}/permission-mode`,{mode:P}),j(k,{current_permission_mode:P});const H=i.value.get(k);H&&(H.permissionMode=P,i.value.set(k,H)),console.log(`Set permission mode for session ${k} to ${P}`)}catch(H){throw console.error("Failed to set permission mode:",H),H}}async function C(k){try{await K.post(`/api/sessions/${k}/start`),console.log(`Started session ${k}`)}catch(P){throw console.error("Failed to start session:",P),P}}async function h(k){try{await K.post(`/api/sessions/${k}/pause`),console.log(`Paused session ${k}`)}catch(P){throw console.error("Failed to pause session:",P),P}}async function a(k){try{await K.post(`/api/sessions/${k}/terminate`),console.log(`Terminated session ${k}`)}catch(P){throw console.error("Failed to terminate session:",P),P}}function O(k){return s.value.get(k)}function q(k,P){i.value.set(k,P),P.permissionMode&&j(k,{current_permission_mode:P.permissionMode})}return{sessions:s,currentSessionId:t,inputCache:m,initData:i,deletingSessions:o,currentSession:g,orderedSessions:u,sessionsInProject:v,currentInput:_,fetchSessions:w,createSession:$,selectSession:b,updateSession:j,deleteSession:T,updateSessionName:S,setPermissionMode:y,startSession:C,pauseSession:h,terminateSession:a,getSession:O,storeInitData:q}}),De=Object.freeze(Object.defineProperty({__proto__:null,useSessionStore:J},Symbol.toStringTag,{value:"Module"})),se=_e("ui",()=>{const s=L(window.innerWidth<768),t=L(300),m=L(window.innerWidth),i=c(()=>m.value<768),o=L(!0),n=L(null),p=L(null),g=c(()=>n.value?{name:n.value,data:p.value}:null),u=L(!1),v=L("Loading...");function _(){s.value=!s.value}function w(h){s.value=h}function $(h){t.value=Math.max(200,Math.min(h,window.innerWidth*.3))}function b(h){o.value=h}function j(h,a=null){n.value=null,p.value=null,setTimeout(()=>{n.value=h,p.value=a},0)}function T(){n.value=null,p.value=null}function S(h="Loading..."){u.value=!0,v.value=h}function y(){u.value=!1}function C(){const h=m.value;m.value=window.innerWidth,m.value<768&&h>=768?s.value=!0:m.value>=768&&h<768&&(s.value=!1)}return{sidebarCollapsed:s,sidebarWidth:t,isMobile:i,autoScrollEnabled:o,activeModal:n,modalData:p,currentModal:g,isLoading:u,loadingMessage:v,toggleSidebar:_,setSidebarCollapsed:w,setSidebarWidth:$,setAutoScroll:b,showModal:j,hideModal:T,showLoading:S,hideLoading:y,handleResize:C}}),le=_e("project",()=>{const s=L(new Map),t=L(null),m=c(()=>s.value.get(t.value)),i=c(()=>Array.from(s.value.values()).sort((T,S)=>T.order-S.order)),o=T=>s.value.get(T)?.is_multi_agent||!1;async function n(){try{const T=await K.get("/api/projects");return s.value.clear(),T.projects.forEach(S=>{s.value.set(S.project_id,S)}),console.log(`Loaded ${s.value.size} projects`),T.projects}catch(T){throw console.error("Failed to fetch projects:",T),T}}async function p(T,S,y=!1){try{const h=(await K.post("/api/projects",{name:T,working_directory:S,is_multi_agent:y})).project;return s.value.set(h.project_id,h),s.value=new Map(s.value),console.log(`Created project ${h.project_id}`),h}catch(C){throw console.error("Failed to create project:",C),C}}async function g(T,S){try{await K.put(`/api/projects/${T}`,S),u(T,S),console.log(`Updated project ${T}`,S)}catch(y){throw console.error("Failed to update project:",y),y}}function u(T,S){const y=s.value.get(T);y&&(Object.assign(y,S),s.value=new Map(s.value))}async function v(T){try{await K.delete(`/api/projects/${T}`),s.value.delete(T),s.value=new Map(s.value),t.value===T&&(t.value=null),console.log(`Deleted project ${T}`)}catch(S){throw console.error("Failed to delete project:",S),S}}async function _(T){try{const S=await K.put(`/api/projects/${T}/toggle-expansion`),y=s.value.get(T);return y&&(y.is_expanded=S.is_expanded,s.value=new Map(s.value)),S.is_expanded}catch(S){throw console.error("Failed to toggle expansion:",S),S}}async function w(T){try{await K.put("/api/projects/reorder",{project_ids:T}),T.forEach((S,y)=>{const C=s.value.get(S);C&&(C.order=y)}),s.value=new Map(s.value),console.log("Reordered projects",T)}catch(S){throw console.error("Failed to reorder projects:",S),S}}async function $(T,S){try{await K.put(`/api/projects/${T}/sessions/reorder`,{session_ids:S});const y=s.value.get(T);y&&(y.session_ids=S,s.value=new Map(s.value)),console.log(`Reordered sessions in project ${T}`,S)}catch(y){throw console.error("Failed to reorder sessions:",y),y}}function b(T){return s.value.get(T)}function j(T){if(!T)return"";const S=T.split(/[/\\]/).filter(y=>y);return S.length===0?"/":S.length===1?`/${S[0]}`:S.length===2?`/${S.join("/")}`:`.../${S.slice(-2).join("/")}`}return{projects:s,currentProjectId:t,currentProject:m,orderedProjects:i,isMultiAgent:o,fetchProjects:n,createProject:p,updateProject:g,updateProjectLocal:u,deleteProject:v,toggleExpansion:_,reorderProjects:w,reorderSessionsInProject:$,getProject:b,formatPath:j}}),V=(s,t)=>{const m=s.__vccOpts||s;for(const[i,o]of t)m[i]=o;return m},st={class:"session-header border-bottom p-3"},ot={class:"project-name"},nt=["title"],lt={__name:"SessionHeader",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,m=J(),i=le(),o=c(()=>m.sessions.get(t.sessionId)),n=c(()=>o.value?.name||t.sessionId),p=c(()=>{for(const u of i.projects.values())if(u.session_ids?.includes(t.sessionId))return u;return null}),g=c(()=>p.value?.name||"Unknown Project");return(u,v)=>(l(),r("div",st,[e("div",null,[e("div",ot,f(g.value),1),e("div",{class:"session-name",title:s.sessionId},f(n.value),9,nt)])]))}},at=V(lt,[["__scopeId","data-v-89e9c269"]]),rt={class:"progress session-state-status-line",style:{height:"4px","border-radius":"0"}},it=["title"],ct={key:1,class:"progress-bar bg-secondary",style:{width:"100%"},title:"No session selected"},ut={__name:"SessionStateStatusLine",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,m=J(),i=c(()=>m.sessions.get(t.sessionId)),o=c(()=>i.value?i.value.state==="paused"&&i.value.is_processing?"pending-prompt":i.value.is_processing?"processing":i.value.state:"unknown"),n=c(()=>{const u=o.value;return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3",unknown:"#d3d3d3"}[u]||"#d3d3d3"}),p=c(()=>{const u=o.value;return u==="starting"||u==="processing"||u==="pending-prompt"}),g=c(()=>{if(!i.value)return"No session selected";const u=o.value,v=u.charAt(0).toUpperCase()+u.slice(1).replace("-"," "),_=i.value.name||"Unnamed Session",w=i.value.is_minion&&i.value.role?` (${i.value.role})`:"";return`${_}${w}: ${v}`});return(u,v)=>(l(),r("div",rt,[i.value?(l(),r("div",{key:0,class:B(["progress-bar",{"progress-bar-striped progress-bar-animated":p.value}]),style:me({width:"100%",backgroundColor:n.value}),title:g.value},null,14,it)):(l(),r("div",ct))]))}},dt=V(ut,[["__scopeId","data-v-e8795bb7"]]),mt={class:"session-status-bar border-top p-2 bg-light"},pt={class:"d-flex justify-content-between align-items-center gap-2"},vt={class:"d-flex gap-2"},ft=["disabled"],gt={class:"mode-label"},_t=["disabled"],bt=["disabled"],ht={__name:"SessionStatusBar",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,m=J(),i=se(),o=c(()=>m.sessions.get(t.sessionId)),n=c(()=>o.value?.current_permission_mode||"default"),p={default:"ðŸ”’",acceptEdits:"âœï¸",plan:"ðŸ“‹",bypassPermissions:"â˜¢ï¸"},g=c(()=>p[n.value]||"ðŸ”’"),u=c(()=>n.value),v=["default","acceptEdits","plan"],_=async()=>{if(!o.value)return;if(n.value==="bypassPermissions"){try{await m.setPermissionMode(t.sessionId,"default")}catch(y){console.error("Failed to cycle permission mode:",y)}return}const T=(v.indexOf(n.value)+1)%v.length,S=v[T];try{await m.setPermissionMode(t.sessionId,S)}catch(y){console.error("Failed to cycle permission mode:",y)}},w=()=>{i.showModal("session-info",{sessionId:t.sessionId})},$=()=>{i.showModal("manage-session",{session:o.value})},b=()=>{i.setAutoScroll(!i.autoScrollEnabled)};return(j,T)=>(l(),r("div",mt,[e("div",pt,[e("div",vt,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:_,disabled:!o.value},[G(f(g.value)+" ",1),e("span",gt,f(u.value),1)],8,ft),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:w,disabled:!o.value},[...T[0]||(T[0]=[G(" â„¹ï¸ ",-1),e("span",{class:"button-label"},"Info",-1)])],8,_t),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:$,disabled:!o.value},[...T[1]||(T[1]=[G(" âš™ï¸ ",-1),e("span",{class:"button-label"},"Manage",-1)])],8,bt)]),e("div",null,[e("button",{class:B(["btn btn-sm",we(i).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:b}," â¬‡ï¸ "+f(we(i).autoScrollEnabled?"ON":"OFF"),3)])])]))}},yt=V(ht,[["__scopeId","data-v-fdcd3535"]]),de=_e("message",()=>{const s=L(new Map),t=L(new Map),m=L(new Map),i=L(new Map),o=L(new Map),n=L(new Map),p=L(new Map),g=c(()=>{const d=J();return s.value.get(d.currentSessionId)||[]}),u=c(()=>{const d=J();return t.value.get(d.currentSessionId)||[]});async function v(d,M=null,A=0){try{const N=M||1e4,x=await K.get(`/api/sessions/${d}/messages?limit=${N}&offset=${A}`),I=x.messages||[],W=x.total_count||I.length,F=x.has_more||!1;if(console.log(`Loaded ${I.length} of ${W} messages for session ${d}`),s.value.set(d,I),I.length>0){const U=I[I.length-1];U.timestamp&&(p.value.set(d,U.timestamp),console.log(`Tracked last received timestamp for session ${d}: ${U.timestamp}`))}const z=new Set;I.forEach(U=>{U.type==="assistant"&&U.metadata?.tool_uses&&U.metadata.tool_uses.forEach(X=>{z.add(X.id)}),U.type==="user"&&U.metadata?.tool_results&&U.metadata.tool_results.forEach(X=>{z.delete(X.tool_use_id);const $e=n.value.get(d);$e&&$e.delete(X.tool_use_id)}),U.type==="system"&&U.metadata?.subtype==="client_launched"&&(z.forEach(X=>{a(d,X,"Session was restarted")}),z.clear()),U.type==="system"&&U.metadata?.subtype==="interrupt"&&(z.forEach(X=>{a(d,X,"Session was interrupted")}),z.clear()),U.metadata?.has_tool_uses&&U.metadata.tool_uses&&U.metadata.tool_uses.forEach(X=>{j(d,X)}),U.metadata?.has_tool_results&&U.metadata.tool_results&&U.metadata.tool_results.forEach(X=>{y(d,X)}),(U.type==="permission_request"||U.metadata?.has_permission_requests)&&T(d,U),U.type==="system"&&(U.subtype==="init"||U.metadata?.subtype==="init")&&U.metadata?.init_data&&J().storeInitData(d,U.metadata.init_data)});const ve=J().sessions.get(d);return ve&&!["active","paused","starting"].includes(ve.state)&&(z.forEach(U=>{a(d,U,"Session was terminated")}),z.clear()),o.value.set(d,z),s.value=new Map(s.value),F&&console.warn(`Warning: Only loaded ${I.length} of ${W} messages. Some messages may be missing.`),{messages:I,totalCount:W,hasMore:F}}catch(N){throw console.error("Failed to load messages:",N),N}}function _(d,M){const A=o.value.get(d)||new Set;M.type==="assistant"&&M.metadata?.tool_uses&&M.metadata.tool_uses.forEach(N=>{A.add(N.id)}),M.type==="user"&&M.metadata?.tool_results&&M.metadata.tool_results.forEach(N=>{A.delete(N.tool_use_id);const x=n.value.get(d);x&&x.delete(N.tool_use_id)}),M.type==="system"&&M.metadata?.subtype==="client_launched"&&(A.forEach(N=>{a(d,N,"Session was restarted")}),A.clear()),M.type==="system"&&M.metadata?.subtype==="interrupt"&&(A.forEach(N=>{a(d,N,"Session was interrupted")}),A.clear()),o.value.set(d,A)}function w(d,M){s.value.has(d)||s.value.set(d,[]),s.value.get(d).push(M),M.timestamp&&p.value.set(d,M.timestamp),_(d,M),s.value=new Map(s.value)}function $(d,M){t.value.has(d)||t.value.set(d,[]),t.value.get(d).push(M),t.value=new Map(t.value)}function b(d,M,A){const N=t.value.get(d);if(N){const x=N.find(I=>I.id===M);x&&(Object.assign(x,A),t.value=new Map(t.value))}}function j(d,M){const A=h(M.name,M.input);m.value.set(A,M.id);const N={id:M.id,name:M.name,input:M.input,signature:A,status:"pending",permissionRequestId:null,permissionDecision:null,result:null,explanation:null,timestamp:new Date().toISOString(),isExpanded:!0};return $(d,N),console.log(`Created tool call ${N.id} for ${N.name}`),N}function T(d,M){console.log("handlePermissionRequest received:",M);const A=M.metadata?.tool_name||M.tool_name,N=M.metadata?.input_params||M.input_params,x=M.metadata?.request_id||M.request_id,I=M.metadata?.suggestions||M.suggestions||[];console.log("Extracted data:",{toolName:A,inputParams:N,requestId:x,suggestions:I});const W=h(A,N),F=m.value.get(W);F?(i.value.set(x,F),b(d,F,{status:"permission_required",permissionRequestId:x,suggestions:I}),console.log(`Permission required for tool ${F}`,{suggestions:I})):console.warn("No tool use ID found for permission request signature:",W,{toolName:A,inputParams:N,availableSignatures:Array.from(m.value.keys())})}function S(d,M){const A=i.value.get(M.request_id);if(A){const N={permissionDecision:M.decision,appliedUpdates:M.applied_updates||[]};M.decision==="allow"?N.status="executing":(N.status="completed",N.result={error:!0,message:M.reasoning||"Permission denied"},N.isExpanded=!1),b(d,A,N),console.log(`Permission ${M.decision} for tool ${A}`)}}function y(d,M){const A=M.tool_use_id;b(d,A,{status:M.is_error?"error":"completed",result:{error:M.is_error,content:M.content},isExpanded:!1}),console.log(`Tool ${A} ${M.is_error?"failed":"completed"}`)}function C(d,M){const A=t.value.get(d);if(A){const N=A.find(x=>x.id===M);N&&(N.isExpanded=!N.isExpanded,t.value=new Map(t.value))}}function h(d,M){if(!d)return"unknown:{}";if(!M||typeof M!="object")return`${d}:{}`;const A=JSON.stringify(M,Object.keys(M).sort());return`${d}:${A}`}function a(d,M,A){const N=n.value.get(d)||new Map;N.set(M,{reason:"denied",message:A}),n.value.set(d,N);const x=t.value.get(d);if(x){const I=x.find(W=>W.id===M);I&&I.isExpanded&&(I.isExpanded=!1,t.value=new Map(t.value))}console.log(`Marked tool use ${M} as orphaned: ${A}`)}function O(d,M){return n.value.get(d)?.has(M)||!1}function q(d,M){return n.value.get(d)?.get(M)}function k(d,M){const A=o.value.get(d);A&&A.size>0&&(A.forEach(N=>a(d,N,M)),A.clear())}function P(d){s.value.delete(d),t.value.delete(d),s.value=new Map(s.value),t.value=new Map(t.value)}function H(d){return p.value.get(d)}async function R(d){const M=p.value.get(d);if(!M)return console.log(`No sync needed for session ${d} (no previous messages)`),{syncedCount:0,hasMore:!1};try{console.log(`Syncing messages for session ${d} since ${M}`);const A=await K.get(`/api/sessions/${d}/messages?limit=1000&offset=0`),N=A.messages||[],x=A.has_more||!1,I=new Date(M).getTime(),W=N.filter(U=>U.timestamp?new Date(U.timestamp).getTime()>I:!1);if(W.length===0)return console.log(`No missed messages for session ${d}`),{syncedCount:0,hasMore:!1};console.log(`Synced ${W.length} missed messages for session ${d}`);const F=s.value.get(d)||[],z=new Set(F.map(U=>U.id).filter(Boolean)),oe=W.filter(U=>!U.id||!z.has(U.id));console.log(`After deduplication: ${oe.length} unique new messages`);const ve=[...F,...oe].sort((U,X)=>{const $e=new Date(U.timestamp||0).getTime(),He=new Date(X.timestamp||0).getTime();return $e-He});if(s.value.set(d,ve),oe.forEach(U=>{_(d,U),U.metadata?.has_tool_uses&&U.metadata.tool_uses&&U.metadata.tool_uses.forEach(X=>{j(d,X)}),U.metadata?.has_tool_results&&U.metadata.tool_results&&U.metadata.tool_results.forEach(X=>{y(d,X)}),(U.type==="permission_request"||U.metadata?.has_permission_requests)&&T(d,U),U.type==="system"&&(U.subtype==="init"||U.metadata?.subtype==="init")&&U.metadata?.init_data&&J().storeInitData(d,U.metadata.init_data)}),ve.length>0){const U=ve[ve.length-1];U.timestamp&&p.value.set(d,U.timestamp)}return s.value=new Map(s.value),{syncedCount:oe.length,hasMore:x}}catch(A){return console.error(`Failed to sync messages for session ${d}:`,A),{syncedCount:0,hasMore:!1,error:A.message}}}const D=J();return te(()=>Array.from(D.sessions.values()).map(M=>({id:M.session_id,state:M.state})),(d,M)=>{M&&d.forEach((A,N)=>{const x=M[N];if(!x||x.id!==A.id)return;const I=["active","paused","starting"].includes(x.state),W=!["active","paused","starting"].includes(A.state);I&&W&&k(A.id,"Session was terminated")})},{deep:!0}),{messagesBySession:s,toolCallsBySession:t,activeToolUses:Le(o),orphanedToolUses:Le(n),currentMessages:g,currentToolCalls:u,loadMessages:v,addMessage:w,addToolCall:$,updateToolCall:b,handleToolUse:j,handlePermissionRequest:T,handlePermissionResponse:S,handleToolResult:y,toggleToolExpansion:C,clearMessages:P,markToolUseOrphaned:a,isToolUseOrphaned:O,getOrphanedInfo:q,clearOrphanedToolUses:k,getLastReceivedTimestamp:H,syncMessages:R}}),$t=Object.freeze(Object.defineProperty({__proto__:null,useMessageStore:de},Symbol.toStringTag,{value:"Module"}));function wt(s){if(!s)return new Date;if(typeof s=="string"){const t=new Date(s);return isNaN(t.getTime())?new Date:t}return typeof s=="number"?s<1e10?new Date(s*1e3):new Date(s):new Date}function ke(s){return wt(s).toLocaleTimeString()}const St={class:"card user-message bg-light border-start border-primary border-3"},kt={class:"card-body"},Ct={class:"d-flex justify-content-between align-items-center mb-2"},xt={class:"text-muted"},Mt=["innerHTML"],jt={key:0,class:"tool-results mt-3"},Tt={class:"tool-results-header text-muted small mb-2"},Et={class:"d-flex align-items-start gap-2"},Pt={class:"flex-grow-1"},Lt={class:"text-muted"},It={key:0,class:"text-danger small"},Dt={__name:"UserMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s;he.setOptions({breaks:!0,gfm:!0});const m=c(()=>ke(t.message.timestamp)),i=c(()=>{const g=t.message.content||"",u=he.parse(g);return Te.sanitize(u)}),o=c(()=>t.message.metadata?.has_tool_results&&t.message.metadata?.tool_results?.length>0),n=c(()=>t.message.metadata?.tool_results||[]);function p(g,u){return g?g.length<=u?g:g.substring(0,u)+"...":""}return(g,u)=>(l(),r("div",St,[e("div",kt,[e("div",Ct,[u[0]||(u[0]=e("div",{class:"d-flex align-items-center gap-2"},[e("span",{class:"message-icon"},"ðŸ‘¤"),e("strong",{class:"message-role"},"User")],-1)),e("small",xt,f(m.value),1)]),e("div",{class:"message-content",innerHTML:i.value},null,8,Mt),o.value?(l(),r("div",jt,[e("div",Tt,[u[1]||(u[1]=e("i",{class:"bi bi-tools"},null,-1)),G(" Tool Results ("+f(n.value.length)+") ",1)]),(l(!0),r(Z,null,ee(n.value,(v,_)=>(l(),r("div",{key:_,class:B(["tool-result-summary p-2 mb-2 rounded",v.is_error?"bg-danger bg-opacity-10":"bg-success bg-opacity-10"])},[e("div",Et,[e("span",null,f(v.is_error?"âŒ":"âœ…"),1),e("div",Pt,[e("small",Lt,"Tool: "+f(v.tool_use_id),1),v.is_error?(l(),r("div",It,f(p(v.content,200)),1)):E("",!0)])])],2))),128))])):E("",!0)])]))}},Ot=V(Dt,[["__scopeId","data-v-532549d1"]]),Nt={class:"thinking-block"},At={class:"text-muted ms-auto"},Rt={key:0,class:"thinking-content mt-2 p-3 bg-light rounded border"},qt=["innerHTML"],Ut={__name:"ThinkingBlock",props:{thinking:{type:String,required:!0}},setup(s){const t=s,m=L(!1),i=c(()=>t.thinking?.length||0),o=c(()=>{const p=t.thinking||"",g=he.parse(p);return Te.sanitize(g)});function n(){m.value=!m.value}return(p,g)=>(l(),r("div",Nt,[e("div",{class:"thinking-header d-flex align-items-center gap-2 p-2 bg-info bg-opacity-10 rounded cursor-pointer",onClick:n},[e("i",{class:B(["bi",m.value?"bi-chevron-down":"bi-chevron-right"])},null,2),g[0]||(g[0]=e("span",{class:"thinking-label"},[e("i",{class:"bi bi-lightbulb"}),G(" Thinking ")],-1)),e("small",At,f(i.value)+" characters",1)]),m.value?(l(),r("div",Rt,[e("div",{class:"thinking-text",innerHTML:o.value},null,8,qt)])):E("",!0)]))}},Wt=V(Ut,[["__scopeId","data-v-619a8344"]]),ge=_e("websocket",()=>{const s=L(null),t=L(!1),m=L(0),i=10,o=L(null),n=L(!1),p=L(0),g=5,u=L(null);let v=null;const _=L(0),w=L(null),$=L(new Map),b=L(null),j=L(!1),T=L(0),S=5,y=L(null),C=c(()=>t.value&&(n.value||!u.value)?"connected":t.value?"partial":"disconnected");function h(x){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${x}`}function a(){if(s.value)return;const x=h("/ws/ui");console.log(`Connecting to UI WebSocket: ${x}`),s.value=new WebSocket(x),s.value.onopen=()=>{t.value=!0,m.value=0,console.log("UI WebSocket connected")},s.value.onmessage=I=>{const W=JSON.parse(I.data);D(W)},s.value.onclose=()=>{if(t.value=!1,s.value=null,console.log("UI WebSocket closed"),m.value<i){m.value++;const I=Math.min(2e3*m.value,3e4);console.log(`Reconnecting UI WebSocket in ${I}ms (attempt ${m.value})`),setTimeout(a,I)}},s.value.onerror=I=>{console.error("UI WebSocket error:",I)}}function O(){s.value&&(s.value.close(),s.value=null,t.value=!1)}async function q(x){_.value++;const I=_.value;if(console.log(`[Gen ${I}] Starting connection to session ${x}`),v&&(clearTimeout(v),v=null),await k(),_.value!==I){console.log(`[Gen ${I}] Connection cancelled (current generation: ${_.value})`);return}u.value=x,w.value=I;const W=h(`/ws/session/${x}`);console.log(`[Gen ${I}] Connecting to Session WebSocket: ${W}`),o.value=new WebSocket(W),o.value.onopen=async()=>{if(w.value!==I){console.log(`[Gen ${I}] Ignoring onopen (stale connection, current: ${w.value})`),o.value.close();return}n.value=!0,p.value=0,console.log(`[Gen ${I}] Session WebSocket connected for ${x}`);const F=$.value.get(x);if($.value.set(x,!0),F){console.log(`[Gen ${I}] Reconnection detected, syncing missed messages...`);try{const oe=await de().syncMessages(x);oe.syncedCount>0?console.log(`[Gen ${I}] âœ… Synced ${oe.syncedCount} missed messages`):oe.error?console.warn(`[Gen ${I}] âš ï¸ Message sync failed: ${oe.error}`):console.log(`[Gen ${I}] No missed messages to sync`),oe.hasMore&&console.warn(`[Gen ${I}] âš ï¸ More than 1000 missed messages, showing recent 1000 only`)}catch(z){console.error(`[Gen ${I}] Error during message sync:`,z)}}else console.log(`[Gen ${I}] Initial connection, no sync needed`)},o.value.onmessage=F=>{if(w.value!==I){console.log(`[Gen ${I}] Ignoring message (stale connection, current: ${w.value})`);return}const z=JSON.parse(F.data);d(z,x)},o.value.onclose=()=>{n.value=!1,o.value=null,console.log(`[Gen ${I}] Session WebSocket closed for ${x}`);const F=J();if(F.currentSessionId===x&&w.value===I&&p.value<g){p.value++;const z=Math.min(2e3*p.value,3e4);console.log(`[Gen ${I}] Reconnecting Session WebSocket in ${z}ms (attempt ${p.value})`),v=setTimeout(()=>{w.value===I&&F.currentSessionId===x?(v=null,q(x)):console.log(`[Gen ${I}] Skipping reconnect (generation or session changed)`)},z)}},o.value.onerror=F=>{console.error(`[Gen ${I}] Session WebSocket error:`,F)}}function k(){return new Promise(x=>{if(v&&(clearTimeout(v),v=null,console.log("Cancelled pending session reconnect timer")),o.value){const I=()=>{o.value=null,n.value=!1,u.value=null,w.value=null,p.value=0,$.value.delete(sessionId),x()};if(o.value.readyState===WebSocket.CLOSED)I();else{const W=setTimeout(()=>{console.warn("Session WebSocket close timeout - forcing cleanup"),I()},2e3);o.value.addEventListener("close",()=>{clearTimeout(W),I()},{once:!0}),o.value.close()}}else u.value=null,w.value=null,x()})}function P(x){o.value&&n.value?(o.value.send(JSON.stringify({type:"send_message",content:x})),console.log("Sent message to session")):console.error("Cannot send message: Session WebSocket not connected")}function H(x,I,W=!1,F=null){if(o.value&&n.value){const z={type:"permission_response",request_id:x,decision:I,apply_suggestions:W,timestamp:new Date().toISOString()};F&&(z.clarification_message=F),o.value.send(JSON.stringify(z)),console.log(`Sent permission ${I} for request ${x}`,{applySuggestions:W,clarification:F})}}function R(){o.value&&n.value&&(o.value.send(JSON.stringify({type:"interrupt_session"})),console.log("Sent interrupt to session"))}function D(x){const I=J(),W=le();switch(x.type){case"sessions_list":x.sessions&&Array.isArray(x.sessions)&&x.sessions.forEach(F=>{I.updateSession(F.session_id,F)});break;case"state_change":x.data&&x.data.session_id&&x.data.session&&I.updateSession(x.data.session_id,x.data.session);break;case"project_updated":if(x.data&&x.data.project){const F=x.data.project;W.updateProjectLocal(F.project_id,F)}break;case"project_deleted":x.data&&x.data.project_id&&W.projects.delete(x.data.project_id);break;case"connection_established":console.log("UI WebSocket: Connection established");break;case"ping":s.value?.readyState===WebSocket.OPEN&&s.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown UI WebSocket message type:",x.type)}}function d(x,I){const W=J();if(W.currentSessionId!==I){console.warn(`Ignoring message for session ${I} (current: ${W.currentSessionId})`);return}const F=de();switch(x.type){case"message":const z=x.data;if(!z||!z.type){console.warn("Received message event with invalid data:",x);break}if(z.type==="permission_request"){F.handlePermissionRequest(I,z);break}if(z.type==="permission_response"){F.handlePermissionResponse(I,z);break}z.metadata?.has_tool_uses&&z.metadata.tool_uses.forEach(oe=>{F.handleToolUse(I,oe)}),z.metadata?.has_tool_results&&z.metadata.tool_results.forEach(oe=>{F.handleToolResult(I,oe)}),z.type==="system"&&(z.subtype==="init"||z.metadata?.subtype==="init")&&z.metadata?.init_data&&W.storeInitData(I,z.metadata.init_data),F.addMessage(I,z);break;case"permission_request":F.handlePermissionRequest(I,x);break;case"permission_response":F.handlePermissionResponse(I,x);break;case"tool_result":F.handleToolResult(I,x);break;case"state_change":W.updateSession(I,x.updates);break;case"connection_established":console.log(`Session WebSocket: Connection established for ${I}`);break;case"ping":o.value?.readyState===WebSocket.OPEN&&o.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Session WebSocket message type:",data.type)}}function M(x){A(),y.value=x;const I=h(`/ws/legion/${x}`);console.log(`Connecting to Legion WebSocket: ${I}`),b.value=new WebSocket(I),b.value.onopen=()=>{j.value=!0,T.value=0,console.log(`Legion WebSocket connected for ${x}`)},b.value.onmessage=W=>{const F=JSON.parse(W.data);N(F,x)},b.value.onclose=()=>{if(j.value=!1,b.value=null,console.log(`Legion WebSocket closed for ${x}`),y.value===x&&T.value<S){T.value++;const W=Math.min(2e3*T.value,3e4);setTimeout(()=>M(x),W)}},b.value.onerror=W=>{console.error("Legion WebSocket error:",W)}}function A(){b.value&&(b.value.close(),b.value=null,j.value=!1,y.value=null)}function N(x,I){ae(async()=>{const{useLegionStore:W}=await Promise.resolve().then(()=>pr);return{useLegionStore:W}},void 0).then(({useLegionStore:W})=>{const F=W();switch(x.type){case"comm":x.comm&&(F.addComm(I,x.comm),console.log("Legion WebSocket: Received new comm",x.comm));break;case"minion_created":x.data&&(console.log("Legion WebSocket: Minion created, reloading sessions",x.data),ae(async()=>{const{useSessionStore:z}=await Promise.resolve().then(()=>De);return{useSessionStore:z}},void 0).then(({useSessionStore:z})=>{z().loadSessions()}));break;case"minion_updated":x.data&&(console.log("Legion WebSocket: Minion updated, reloading sessions",x.data),ae(async()=>{const{useSessionStore:z}=await Promise.resolve().then(()=>De);return{useSessionStore:z}},void 0).then(({useSessionStore:z})=>{z().loadSessions()}));break;case"connection_established":console.log(`Legion WebSocket: Connection established for ${I}`);break;case"ping":b.value?.readyState===WebSocket.OPEN&&b.value.send(JSON.stringify({type:"pong",timestamp:new Date().toISOString()}));break;default:console.warn("Unknown Legion WebSocket message type:",x.type)}})}return{uiConnected:t,sessionConnected:n,legionConnected:j,overallStatus:C,connectUI:a,disconnectUI:O,connectSession:q,disconnectSession:k,sendMessage:P,sendPermissionResponse:H,interruptSession:R,connectLegion:M,disconnectLegion:A}}),Ht=Object.freeze(Object.defineProperty({__proto__:null,useWebSocketStore:ge},Symbol.toStringTag,{value:"Module"})),Ft={class:"base-tool-handler"},Bt={class:"tool-section mb-3"},Vt={class:"tool-parameters"},zt={class:"tool-code"},Gt={key:0,class:"tool-section"},Jt={class:"tool-section-label"},Kt={class:"tool-code"},Yt={__name:"BaseToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.input?JSON.stringify(t.toolCall.input,null,2):"{}"),i=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),o=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),n=c(()=>{if(!i.value)return"";const p=t.toolCall.result;return p.content!==void 0?typeof p.content=="string"?p.content:JSON.stringify(p.content,null,2):p.message?p.message:JSON.stringify(p,null,2)});return(p,g)=>(l(),r("div",Ft,[e("div",Bt,[g[0]||(g[0]=e("div",{class:"tool-section-label"},"Parameters:",-1)),e("div",Vt,[e("pre",zt,f(m.value),1)])]),i.value?(l(),r("div",Gt,[e("div",Jt,f(o.value?"Error:":"Result:"),1),e("div",{class:B(["tool-result",{"tool-result-error":o.value}])},[e("pre",Kt,f(n.value),1)],2)])):E("",!0)]))}},Qt=V(Yt,[["__scopeId","data-v-06a1b6c0"]]),Zt={class:"read-tool-handler"},Xt={class:"tool-section mb-3"},es={class:"read-file-info"},ts={class:"file-path"},ss={key:0,class:"read-range"},os={key:0,class:"tool-section"},ns={key:0,class:"tool-result tool-result-error"},ls={class:"tool-code"},as={key:1,class:"file-content-preview"},rs={class:"content-header"},is={class:"line-count-badge"},cs={key:0,class:"preview-note"},us={class:"tool-code content-display"},ds={key:0,class:"more-indicator"},xe=100,ms={__name:"ReadToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.input?.file_path||"Unknown"),i=c(()=>{const b=t.toolCall.input?.offset,j=t.toolCall.input?.limit;return b!==void 0||j!==void 0}),o=c(()=>{const b=t.toolCall.input?.offset;return b!==void 0?b+1:1}),n=c(()=>{const b=t.toolCall.input?.offset||0,j=t.toolCall.input?.limit;return j!==void 0?b+j:"âˆž"}),p=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),g=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),u=c(()=>{if(!p.value)return"";const b=t.toolCall.result;return b.content!==void 0?typeof b.content=="string"?b.content:JSON.stringify(b.content,null,2):b.message?b.message:JSON.stringify(b,null,2)}),v=c(()=>g.value||!u.value?[]:u.value.split(`
`)),_=c(()=>v.value.length),w=c(()=>_.value>xe),$=c(()=>g.value?"":v.value.slice(0,xe).join(`
`));return(b,j)=>(l(),r("div",Zt,[e("div",Xt,[e("div",es,[j[0]||(j[0]=e("span",{class:"file-icon"},"ðŸ“„",-1)),j[1]||(j[1]=e("strong",null,"Reading:",-1)),e("code",ts,f(m.value),1),i.value?(l(),r("span",ss,"Lines "+f(o.value)+"-"+f(n.value),1)):E("",!0)])]),p.value?(l(),r("div",os,[g.value?(l(),r("div",ns,[e("pre",ls,f(u.value),1)])):(l(),r("div",as,[e("div",rs,[j[2]||(j[2]=e("span",{class:"content-label"},"Content Preview:",-1)),e("span",is,f(_.value)+" lines",1),w.value?(l(),r("span",cs,"(showing first "+f(xe)+")")):E("",!0)]),e("pre",us,f($.value),1),w.value?(l(),r("div",ds,"...")):E("",!0)]))])):E("",!0)]))}},ps=V(ms,[["__scopeId","data-v-0382f812"]]),vs={class:"write-tool-handler"},fs={class:"tool-section mb-3"},gs={class:"write-file-info mb-2"},_s={class:"file-path"},bs={class:"write-content-preview"},hs={class:"content-header"},ys={class:"line-count-badge"},$s={key:0,class:"preview-note"},ws={class:"tool-code content-display"},Ss={key:0,class:"more-indicator"},ks={key:0,class:"tool-section"},Cs={key:0,class:"tool-result tool-result-error"},xs={class:"tool-code"},Ms={key:1,class:"tool-result tool-result-success"},js={class:"success-message"},Me=100,Ts={__name:"WriteToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.input?.file_path||"Unknown"),i=c(()=>t.toolCall.input?.content||""),o=c(()=>i.value.split(`
`)),n=c(()=>o.value.length),p=c(()=>n.value>Me),g=c(()=>o.value.slice(0,Me).join(`
`)),u=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),_=c(()=>{if(!u.value)return"";const w=t.toolCall.result;return w.content!==void 0?typeof w.content=="string"?w.content:JSON.stringify(w.content,null,2):w.message?w.message:JSON.stringify(w,null,2)});return(w,$)=>(l(),r("div",vs,[e("div",fs,[e("div",gs,[$[0]||($[0]=e("span",{class:"file-icon"},"ðŸ“",-1)),$[1]||($[1]=e("strong",null,"Writing:",-1)),e("code",_s,f(m.value),1)]),e("div",bs,[e("div",hs,[$[2]||($[2]=e("span",{class:"content-label"},"Content:",-1)),e("span",ys,f(n.value)+" lines",1),p.value?(l(),r("span",$s,"(showing first "+f(Me)+")")):E("",!0)]),e("pre",ws,f(g.value),1),p.value?(l(),r("div",Ss,"...")):E("",!0)])]),u.value?(l(),r("div",ks,[v.value?(l(),r("div",Cs,[$[3]||($[3]=e("strong",null,"Error:",-1)),e("pre",xs,f(_.value),1)])):(l(),r("div",Ms,[e("div",js,[$[4]||($[4]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"File created successfully ("+f(n.value)+" lines written)",1)])]))])):E("",!0)]))}},Es=V(Ts,[["__scopeId","data-v-d09b89ef"]]),Ps={class:"bash-tool-handler"},Ls={class:"tool-section mb-3"},Is={class:"bash-header"},Ds={class:"bash-header-content"},Os={key:0,class:"bash-description"},Ns={key:1,class:"bash-flags"},As={class:"bash-command-section"},Rs={class:"bash-command-content"},qs={key:0,class:"tool-section"},Us={key:0,class:"bash-output"},Ws={key:1,class:"bash-output-empty"},Hs={__name:"BashToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.input?.command||""),i=c(()=>t.toolCall.input?.description||""),o=c(()=>t.toolCall.input?.timeout),n=c(()=>t.toolCall.input?.run_in_background||!1),p=c(()=>o.value||n.value),g=c(()=>{const $=[];return o.value&&$.push(`timeout: ${o.value}ms`),n.value&&$.push("background"),$.join(", ")}),u=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),v=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),_=c(()=>v.value?"tool-result-error":"tool-result-success"),w=c(()=>{if(!u.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)});return($,b)=>(l(),r("div",Ps,[e("div",Ls,[e("div",Is,[b[1]||(b[1]=e("span",{class:"bash-icon"},"ðŸ’»",-1)),e("div",Ds,[i.value?(l(),r("div",Os,[b[0]||(b[0]=e("strong",null,"Description:",-1)),G(" "+f(i.value),1)])):E("",!0),p.value?(l(),r("div",Ns,f(g.value),1)):E("",!0)])]),e("div",As,[b[2]||(b[2]=e("div",{class:"bash-command-label"},[e("strong",null,"Command:")],-1)),e("div",Rs,f(m.value),1)])]),u.value?(l(),r("div",qs,[e("div",{class:B(["tool-result",_.value])},[b[3]||(b[3]=e("strong",null,"Output:",-1)),w.value?(l(),r("pre",Us,f(w.value),1)):(l(),r("div",Ws,"No output"))],2)])):E("",!0)]))}},Fs=V(Hs,[["__scopeId","data-v-dc93bb16"]]),Bs={class:"todo-tool-handler"},Vs={class:"tool-section mb-3"},zs={class:"todo-header"},Gs={class:"todo-summary"},Js={key:0,class:"todo-count todo-count-completed"},Ks={key:1,class:"todo-count todo-count-in-progress"},Ys={key:2,class:"todo-count todo-count-pending"},Qs={class:"todo-checklist"},Zs={class:"todo-checkbox"},Xs={class:"todo-content"},eo={key:0,class:"tool-section"},to={key:0,class:"tool-result tool-result-error"},so={class:"tool-code"},oo={key:1,class:"tool-result tool-result-success"},no={class:"success-message"},lo={__name:"TodoToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.input?.todos||[]),i=c(()=>m.value.filter(_=>_.status==="completed").length),o=c(()=>m.value.filter(_=>_.status==="in_progress").length),n=c(()=>m.value.filter(_=>_.status==="pending").length);function p(_){return{pending:"â˜",in_progress:"â—",completed:"â˜‘"}[_]||"â˜"}const g=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),u=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),v=c(()=>{if(!g.value)return"";const _=t.toolCall.result;return _.content!==void 0?typeof _.content=="string"?_.content:JSON.stringify(_.content,null,2):_.message?_.message:JSON.stringify(_,null,2)});return(_,w)=>(l(),r("div",Bs,[e("div",Vs,[e("div",zs,[w[0]||(w[0]=e("span",{class:"todo-icon"},"ðŸ“‹",-1)),w[1]||(w[1]=e("strong",null,"Task List:",-1)),e("div",Gs,[i.value>0?(l(),r("span",Js,f(i.value)+" completed ",1)):E("",!0),o.value>0?(l(),r("span",Ks,f(o.value)+" in progress ",1)):E("",!0),n.value>0?(l(),r("span",Ys,f(n.value)+" pending ",1)):E("",!0)])]),e("div",Qs,[(l(!0),r(Z,null,ee(m.value,($,b)=>(l(),r("div",{key:b,class:B(["todo-item",`todo-${$.status}`])},[e("span",Zs,f(p($.status)),1),e("span",Xs,f($.content),1)],2))),128))])]),g.value?(l(),r("div",eo,[u.value?(l(),r("div",to,[w[2]||(w[2]=e("strong",null,"Error:",-1)),e("pre",so,f(v.value),1)])):(l(),r("div",oo,[e("div",no,[w[3]||(w[3]=e("span",{class:"success-icon"},"âœ…",-1)),e("strong",null,"Task list updated ("+f(m.value.length)+" tasks)",1)])]))])):E("",!0)]))}},ao=V(lo,[["__scopeId","data-v-0984bcf9"]]),ro={class:"edit-tool-handler"},io={class:"tool-section mb-3"},co={class:"edit-file-info"},uo={class:"file-path"},mo={key:0,class:"replace-all-badge"},po={class:"edit-diff-container"},vo={class:"diff-header"},fo={class:"diff-stats"},go={class:"stat-removed"},_o={class:"stat-added"},bo={class:"unified-diff"},ho={class:"diff-scroll-container"},yo={class:"diff-marker"},$o={class:"diff-content"},wo={key:0,class:"tool-section"},So={key:0,class:"tool-result tool-result-error"},ko={class:"tool-code"},Co={key:1,class:"tool-result tool-result-success"},xo={class:"success-message"},Mo={key:0,class:"success-detail"},jo={__name:"EditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.input?.file_path||"Unknown"),i=c(()=>t.toolCall.input?.old_string||""),o=c(()=>t.toolCall.input?.new_string||""),n=c(()=>t.toolCall.input?.replace_all||!1),p=c(()=>{const b=Ge(m.value,i.value,o.value,"","",{context:3}).split(`
`),j=[];for(let T=4;T<b.length;T++){const S=b[T];S&&(S.startsWith("-")?j.push({type:"removed",content:S.substring(1)}):S.startsWith("+")?j.push({type:"added",content:S.substring(1)}):S.startsWith(" ")?j.push({type:"context",content:S.substring(1)}):S.startsWith("@@")&&j.push({type:"hunk",content:S}))}return j}),g=c(()=>p.value.filter($=>$.type==="removed").length),u=c(()=>p.value.filter($=>$.type==="added").length),v=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),_=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),w=c(()=>{if(!v.value)return"";const $=t.toolCall.result;return $.content!==void 0?typeof $.content=="string"?$.content:JSON.stringify($.content,null,2):$.message?$.message:JSON.stringify($,null,2)});return($,b)=>(l(),r("div",ro,[e("div",io,[e("div",co,[b[0]||(b[0]=e("span",{class:"file-icon"},"âœï¸",-1)),b[1]||(b[1]=e("strong",null,"Editing:",-1)),e("code",uo,f(m.value),1),n.value?(l(),r("span",mo,"Replace All")):E("",!0)]),e("div",po,[e("div",vo,[b[2]||(b[2]=e("span",{class:"diff-label"},"Changes:",-1)),e("span",fo,[e("span",go,"-"+f(g.value),1),e("span",_o,"+"+f(u.value),1)])]),e("div",bo,[e("div",ho,[(l(!0),r(Z,null,ee(p.value,(j,T)=>(l(),r("div",{key:T,class:B(["diff-line",{"diff-line-removed":j.type==="removed","diff-line-added":j.type==="added","diff-line-context":j.type==="context","diff-line-hunk":j.type==="hunk"}])},[e("span",yo,f(j.type==="removed"?"-":j.type==="added"?"+":j.type==="hunk"?"@":" "),1),e("span",$o,f(j.content),1)],2))),128))])])])]),v.value?(l(),r("div",wo,[_.value?(l(),r("div",So,[b[3]||(b[3]=e("strong",null,"Error:",-1)),e("pre",ko,f(w.value),1)])):(l(),r("div",Co,[e("div",xo,[b[4]||(b[4]=e("span",{class:"success-icon"},"âœ…",-1)),b[5]||(b[5]=e("strong",null,"File edited successfully",-1)),n.value?(l(),r("span",Mo,"(all occurrences replaced)")):E("",!0)])]))])):E("",!0)]))}},To=V(jo,[["__scopeId","data-v-b06adbf2"]]),Eo={class:"search-tool-handler"},Po={class:"tool-section mb-3"},Lo={class:"search-info"},Io={class:"search-icon"},Do={class:"search-pattern"},Oo={key:0,class:"search-path"},No={key:1,class:"search-filters"},Ao={key:0,class:"filter-badge"},Ro={key:1,class:"filter-badge"},qo={key:2,class:"filter-badge"},Uo={key:0,class:"tool-section"},Wo={key:0,class:"tool-result tool-result-error"},Ho={class:"tool-code"},Fo={key:1,class:"search-results"},Bo={class:"results-header"},Vo={class:"results-label"},zo={class:"results-count-badge"},Go={class:"results-content"},Jo={class:"tool-code"},Ko={__name:"SearchToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.name==="Grep");c(()=>t.toolCall.name==="Glob");const i=c(()=>t.toolCall.input?.pattern||"Unknown"),o=c(()=>t.toolCall.input?.path||null),n=c(()=>t.toolCall.input?.type||null),p=c(()=>t.toolCall.input?.glob||null),g=c(()=>t.toolCall.input?.["-i"]||!1),u=c(()=>n.value||p.value||g.value),v=c(()=>m.value?"ðŸ”":"ðŸ“"),_=c(()=>m.value?"Searching content":"Finding files"),w=c(()=>m.value?"Matches":"Files found"),$=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),b=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),j=c(()=>{if(!$.value)return"";const S=t.toolCall.result;return S.content!==void 0?typeof S.content=="string"?S.content:JSON.stringify(S.content,null,2):S.message?S.message:JSON.stringify(S,null,2)}),T=c(()=>!$.value||b.value||!j.value?0:j.value.split(`
`).filter(y=>y.trim()).length);return(S,y)=>(l(),r("div",Eo,[e("div",Po,[e("div",Lo,[e("span",Io,f(v.value),1),e("strong",null,f(_.value)+":",1),e("code",Do,f(i.value),1),o.value?(l(),r("span",Oo,"in "+f(o.value),1)):E("",!0),u.value?(l(),r("span",No,[n.value?(l(),r("span",Ao,"type: "+f(n.value),1)):E("",!0),p.value?(l(),r("span",Ro,"glob: "+f(p.value),1)):E("",!0),g.value?(l(),r("span",qo,"case-insensitive")):E("",!0)])):E("",!0)])]),$.value?(l(),r("div",Uo,[b.value?(l(),r("div",Wo,[y[0]||(y[0]=e("strong",null,"Error:",-1)),e("pre",Ho,f(j.value),1)])):(l(),r("div",Fo,[e("div",Bo,[e("span",Vo,f(w.value)+":",1),e("span",zo,f(T.value)+" "+f(T.value===1?"match":"matches"),1)]),e("div",Go,[e("pre",Jo,f(j.value),1)])]))])):E("",!0)]))}},Oe=V(Ko,[["__scopeId","data-v-dc01ae0d"]]),Yo={class:"web-tool-handler"},Qo={class:"tool-section mb-3"},Zo={class:"web-info"},Xo={class:"web-icon"},en=["href"],tn={key:1,class:"web-query"},sn={key:0,class:"web-prompt-container"},on={class:"prompt-content"},nn={key:1,class:"web-domains"},ln={class:"domains-label"},an={key:0,class:"tool-section"},rn={key:0,class:"tool-result tool-result-error"},cn={class:"tool-code"},un={key:1,class:"web-results"},dn={class:"results-header"},mn={class:"results-label"},pn={class:"results-content"},vn={class:"tool-code"},fn={__name:"WebToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.name==="WebFetch");c(()=>t.toolCall.name==="WebSearch");const i=c(()=>t.toolCall.input?.url||null),o=c(()=>t.toolCall.input?.query||null),n=c(()=>t.toolCall.input?.prompt||null),p=c(()=>t.toolCall.input?.allowed_domains||[]),g=c(()=>t.toolCall.input?.blocked_domains||[]),u=c(()=>p.value.length>0?p.value:g.value.length>0?g.value:[]),v=c(()=>p.value.length>0?"Allowed domains":g.value.length>0?"Blocked domains":"Domains"),_=c(()=>m.value?"ðŸŒ":"ðŸ”Ž"),w=c(()=>m.value?"Fetching URL":"Searching web"),$=c(()=>m.value?"Fetched content":"Search results"),b=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),j=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),T=c(()=>{if(!b.value)return"";const S=t.toolCall.result;return S.content!==void 0?typeof S.content=="string"?S.content:JSON.stringify(S.content,null,2):S.message?S.message:JSON.stringify(S,null,2)});return(S,y)=>(l(),r("div",Yo,[e("div",Qo,[e("div",Zo,[e("span",Xo,f(_.value),1),e("strong",null,f(w.value)+":",1),i.value?(l(),r("a",{key:0,href:i.value,target:"_blank",class:"web-url"},f(i.value),9,en)):o.value?(l(),r("code",tn,f(o.value),1)):E("",!0)]),n.value?(l(),r("div",sn,[y[0]||(y[0]=e("div",{class:"prompt-label"},"Prompt:",-1)),e("div",on,f(n.value),1)])):E("",!0),u.value.length>0?(l(),r("div",nn,[e("span",ln,f(v.value)+":",1),(l(!0),r(Z,null,ee(u.value,C=>(l(),r("span",{key:C,class:"domain-badge"},f(C),1))),128))])):E("",!0)]),b.value?(l(),r("div",an,[j.value?(l(),r("div",rn,[y[1]||(y[1]=e("strong",null,"Error:",-1)),e("pre",cn,f(T.value),1)])):(l(),r("div",un,[e("div",dn,[e("span",mn,f($.value)+":",1)]),e("div",pn,[e("pre",vn,f(T.value),1)])]))])):E("",!0)]))}},Ne=V(fn,[["__scopeId","data-v-49e16a90"]]),gn={class:"task-tool-handler"},_n={class:"tool-section mb-3"},bn={class:"task-header"},hn={key:0,class:"agent-type-badge"},yn={key:0,class:"task-description"},$n={class:"description-content"},wn={key:1,class:"task-prompt-container"},Sn={class:"prompt-header"},kn={class:"prompt-length"},Cn={class:"prompt-code"},xn={key:0,class:"tool-section"},Mn={key:0,class:"tool-result tool-result-error"},jn={class:"tool-code"},Tn={key:1,class:"agent-output"},En={class:"output-header"},Pn={key:0,class:"output-count-badge"},Ln={class:"output-content"},In={class:"tool-code"},Dn={__name:"TaskToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.input?.description||null),i=c(()=>t.toolCall.input?.prompt||null),o=c(()=>t.toolCall.input?.subagent_type||null),n=c(()=>t.toolCall.result!==null&&t.toolCall.result!==void 0),p=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),g=c(()=>{if(!n.value)return"";const v=t.toolCall.result;return v.content!==void 0?typeof v.content=="string"?v.content:JSON.stringify(v.content,null,2):v.message?v.message:JSON.stringify(v,null,2)}),u=c(()=>g.value?g.value.split(`
`).length:0);return(v,_)=>(l(),r("div",gn,[e("div",_n,[e("div",bn,[_[0]||(_[0]=e("span",{class:"task-icon"},"ðŸ¤–",-1)),_[1]||(_[1]=e("strong",null,"Agent Task:",-1)),o.value?(l(),r("span",hn,f(o.value),1)):E("",!0)]),m.value?(l(),r("div",yn,[_[2]||(_[2]=e("div",{class:"description-label"},"Description:",-1)),e("div",$n,f(m.value),1)])):E("",!0),i.value?(l(),r("div",wn,[e("div",Sn,[_[3]||(_[3]=e("span",{class:"prompt-label"},"Task Prompt:",-1)),e("span",kn,f(i.value.length)+" characters",1)]),e("pre",Cn,f(i.value),1)])):E("",!0)]),n.value?(l(),r("div",xn,[p.value?(l(),r("div",Mn,[_[4]||(_[4]=e("strong",null,"Error:",-1)),e("pre",jn,f(g.value),1)])):(l(),r("div",Tn,[e("div",En,[_[5]||(_[5]=e("span",{class:"output-label"},"Agent Output:",-1)),u.value>0?(l(),r("span",Pn,f(u.value)+" lines",1)):E("",!0)]),e("div",Ln,[e("pre",In,f(g.value),1)])]))])):E("",!0)]))}},On=V(Dn,[["__scopeId","data-v-513043f9"]]),Nn={class:"notebook-edit-tool-handler"},An={class:"tool-section mb-3"},Rn={class:"notebook-info"},qn={class:"file-path"},Un={class:"cell-info mt-2"},Wn={class:"info-row"},Hn={class:"info-row"},Fn={key:0,class:"info-row"},Bn={class:"badge bg-info"},Vn={key:0,class:"source-preview mt-3"},zn={class:"preview-header"},Gn={class:"preview-stats"},Jn={class:"source-code"},Kn={key:0,class:"tool-section"},Yn={key:0},Qn={key:1,class:"text-danger"},Zn={__name:"NotebookEditToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.input?.notebook_path||"Unknown"),i=c(()=>t.toolCall.input?.cell_id),o=c(()=>t.toolCall.input?.cell_type||"code"),n=c(()=>t.toolCall.input?.edit_mode||"replace"),p=c(()=>t.toolCall.input?.new_source||""),g=c(()=>p.value.split(`
`).length),u=c(()=>o.value==="code"?"bg-primary":"bg-secondary"),v=c(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),_=c(()=>{if(t.toolCall.result?.message)return t.toolCall.result.message;const w=n.value;return w==="insert"?"Cell inserted successfully":w==="delete"?"Cell deleted successfully":"Cell updated successfully"});return(w,$)=>(l(),r("div",Nn,[e("div",An,[e("div",Rn,[$[0]||($[0]=e("span",{class:"notebook-icon"},"ðŸ““",-1)),$[1]||($[1]=e("strong",null,"Notebook:",-1)),e("code",qn,f(m.value),1)]),e("div",Un,[e("div",Wn,[$[2]||($[2]=e("strong",null,"Cell ID:",-1)),e("code",null,f(i.value||"N/A"),1)]),e("div",Hn,[$[3]||($[3]=e("strong",null,"Cell Type:",-1)),e("span",{class:B(["badge",u.value])},f(o.value),3)]),n.value?(l(),r("div",Fn,[$[4]||($[4]=e("strong",null,"Edit Mode:",-1)),e("span",Bn,f(n.value),1)])):E("",!0)]),p.value?(l(),r("div",Vn,[e("div",zn,[$[5]||($[5]=e("span",{class:"preview-label"},"New Source:",-1)),e("span",Gn,f(g.value)+" lines",1)]),e("pre",Jn,[e("code",null,f(p.value),1)])])):E("",!0)]),s.toolCall.result?(l(),r("div",Kn,[$[8]||($[8]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:B(["tool-result",v.value])},[s.toolCall.result.success!==!1?(l(),r("div",Yn,[$[6]||($[6]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+f(_.value),1)])):(l(),r("div",Qn,[$[7]||($[7]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+f(s.toolCall.result.error||"Operation failed"),1)]))],2)])):E("",!0)]))}},Xn=V(Zn,[["__scopeId","data-v-3261abc1"]]),el={class:"shell-tool-handler"},tl={class:"tool-section mb-3"},sl={class:"shell-info"},ol={class:"shell-icon"},nl={key:0,class:"shell-id"},ll={key:0,class:"filter-info mt-2"},al={class:"filter-pattern"},rl={key:0,class:"tool-section"},il={class:"result-header mb-2"},cl={key:0,class:"shell-output"},ul={key:0},dl={key:1,class:"text-danger"},ml={__name:"ShellToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.name==="BashOutput"?"ðŸ“¤":t.toolCall.name==="KillShell"?"ðŸ›‘":"ðŸš"),i=c(()=>t.toolCall.name==="BashOutput"?"Reading Shell Output":t.toolCall.name==="KillShell"?"Terminating Shell":"Shell Operation"),o=c(()=>t.toolCall.name==="BashOutput"?"Output":t.toolCall.name==="KillShell"?"Status":"Result"),n=c(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id),p=c(()=>t.toolCall.input?.filter),g=c(()=>t.toolCall.name==="BashOutput"?t.toolCall.result?.output||t.toolCall.result?.stdout:null),u=c(()=>t.toolCall.result?.status),v=c(()=>{const $=u.value;return $==="running"?"bg-success":$==="completed"?"bg-secondary":$==="killed"||$==="terminated"?"bg-danger":"bg-info"}),_=c(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success"),w=c(()=>t.toolCall.result?.message?t.toolCall.result.message:t.toolCall.name==="KillShell"?"Shell terminated successfully":"Operation completed");return($,b)=>(l(),r("div",el,[e("div",tl,[e("div",sl,[e("span",ol,f(m.value),1),e("strong",null,f(i.value)+":",1),n.value?(l(),r("code",nl,"Shell "+f(n.value),1)):E("",!0)]),s.toolCall.name==="BashOutput"&&p.value?(l(),r("div",ll,[b[0]||(b[0]=e("strong",null,"Filter:",-1)),e("code",al,f(p.value),1)])):E("",!0)]),s.toolCall.result?(l(),r("div",rl,[e("div",il,[e("strong",null,f(o.value)+":",1),u.value?(l(),r("span",{key:0,class:B(["badge",v.value])},f(u.value),3)):E("",!0)]),g.value?(l(),r("div",cl,[e("pre",null,[e("code",null,f(g.value),1)])])):(l(),r("div",{key:1,class:B(["tool-result",_.value])},[s.toolCall.result.success!==!1?(l(),r("div",ul,[b[1]||(b[1]=e("i",{class:"bi bi-check-circle"},null,-1)),G(" "+f(w.value),1)])):(l(),r("div",dl,[b[2]||(b[2]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+f(s.toolCall.result.error||"Operation failed"),1)]))],2))])):E("",!0)]))}},Ae=V(ml,[["__scopeId","data-v-fc9da4c0"]]),pl={class:"skill-tool-handler"},vl={class:"tool-section mb-3"},fl={class:"skill-info"},gl={class:"skill-name"},_l={key:0,class:"tool-section mb-3"},bl={class:"base-directory-info"},hl={class:"directory-path"},yl={key:1,class:"tool-section"},$l={class:"d-flex align-items-center gap-2"},wl={class:"text-muted small"},Sl={key:0,class:"skill-content-body"},kl={class:"skill-content-text"},Cl={key:2,class:"tool-section mt-3"},xl={class:"tool-result tool-result-error"},Ml={class:"tool-code"},jl={__name:"SkillToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=de(),i=J(),o=L(!1);function n(){o.value=!o.value}const p=c(()=>t.toolCall.input?.command||"Unknown Skill"),g=c(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),u=c(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}}),v=c(()=>{const S=i.currentSessionId;if(!S)return{running:null,content:null};const y=m.messagesBySession.get(S)||[],C=y.findIndex(O=>O.type==="user"&&O.metadata?.has_tool_results&&O.metadata?.tool_results?.some(q=>q.tool_use_id===t.toolCall.id));if(C===-1)return{running:null,content:null};let h=null,a=null;for(let O=C+1;O<Math.min(C+3,y.length);O++){const q=y[O];if(q.type!=="user")continue;const k=q.content||"";k.includes("<command-message>")&&k.includes("skill is running")?h=q:k.startsWith("Base directory for this skill:")&&(a=q)}return{running:h,content:a}}),_=c(()=>{const S=v.value.content;if(!S)return null;const C=(S.content||"").match(/Base directory(?:\s+for\s+this\s+skill)?:\s*(.+?)(?:\n|$)/i);return C&&C[1]?C[1].trim():null}),w=c(()=>{const S=v.value.content;if(!S)return"";const y=S.content||"",C=/Base directory(?:\s+for\s+this\s+skill)?:.*?\n/i;return y.replace(C,"").trim()}),$=c(()=>w.value.length>0),b=c(()=>w.value?w.value.split(`
`).length:0),j=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),T=c(()=>{if(!j.value)return"";const S=t.toolCall.result;return S?.message?S.message:S?.error?S.error:"An error occurred"});return(S,y)=>(l(),r("div",pl,[e("div",vl,[e("div",fl,[y[0]||(y[0]=e("span",{class:"skill-icon"},"ðŸ“‹",-1)),y[1]||(y[1]=e("strong",null,"Skill:",-1)),e("code",gl,f(p.value),1),e("span",{class:B(["skill-status-badge",u.value])},f(g.value),3)])]),_.value?(l(),r("div",_l,[e("div",bl,[y[2]||(y[2]=e("span",{class:"directory-icon"},"ðŸ“",-1)),y[3]||(y[3]=e("strong",null,"Base directory:",-1)),e("code",hl,f(_.value),1)])])):E("",!0),$.value?(l(),r("div",yl,[e("div",{class:"skill-content-header",onClick:n},[e("div",$l,[e("i",{class:B(["bi",o.value?"bi-chevron-down":"bi-chevron-right"])},null,2),y[4]||(y[4]=e("strong",null,"Skill Content",-1)),e("span",wl,"("+f(b.value)+" lines)",1)])]),o.value?(l(),r("div",Sl,[e("pre",kl,f(w.value),1)])):E("",!0)])):E("",!0),j.value?(l(),r("div",Cl,[y[5]||(y[5]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",xl,[e("pre",Ml,f(T.value),1)])])):E("",!0)]))}},Tl=V(jl,[["__scopeId","data-v-a9fab5d1"]]),El={class:"slashcommand-tool-handler"},Pl={class:"tool-section mb-3"},Ll={class:"command-info"},Il={class:"command-name"},Dl={key:0,class:"tool-section mb-3"},Ol={class:"arguments-info"},Nl={class:"arguments-text"},Al={key:1,class:"tool-section"},Rl={class:"d-flex align-items-center gap-2"},ql={class:"text-muted small"},Ul={key:0,class:"command-content-body"},Wl={class:"command-content-text"},Hl={key:2,class:"tool-section mt-3"},Fl={class:"tool-result tool-result-error"},Bl={class:"tool-code"},Vl={__name:"SlashCommandToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=de(),i=J(),o=L(!1);function n(){o.value=!o.value}const p=c(()=>t.toolCall.input?.command||"Unknown Command"),g=c(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Launching";case"completed":return t.toolCall.result?.error?"Error":"Running";case"error":return"Error";default:return"Unknown"}}),u=c(()=>{switch(t.toolCall.status){case"pending":return"badge-secondary";case"permission_required":return"badge-warning";case"executing":return"badge-primary";case"completed":return t.toolCall.result?.error?"badge-danger":"badge-success";case"error":return"badge-danger";default:return"badge-secondary"}}),v=c(()=>{const S=i.currentSessionId;if(!S)return{running:null,content:null};const y=m.messagesBySession.get(S)||[],C=y.findIndex(O=>O.type==="user"&&O.metadata?.has_tool_results&&O.metadata?.tool_results?.some(q=>q.tool_use_id===t.toolCall.id));if(C===-1)return{running:null,content:null};let h=null,a=null;for(let O=C+1;O<Math.min(C+3,y.length);O++){const q=y[O];if(q.type!=="user")continue;const k=q.content||"";k.includes("<command-message>")&&k.includes("<command-name>")&&k.includes("<command-args>")?h=q:k.includes("ARGUMENTS:")&&(a=q)}return{running:h,content:a}}),_=c(()=>{const S=v.value.running;if(!S)return null;const C=(S.content||"").match(/<command-args>(.+?)<\/command-args>/s);return C&&C[1]?C[1].trim():null}),w=c(()=>{const S=v.value.content;if(!S)return"";const y=S.content||"",C=/\nARGUMENTS:.*$/s;return y.replace(C,"").replace(/<command-message>.*?<\/command-message>/s,"").replace(/<command-name>.*?<\/command-name>/s,"").replace(/<command-args>.*?<\/command-args>/s,"").trim()}),$=c(()=>w.value.length>0),b=c(()=>w.value?w.value.split(`
`).length:0),j=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),T=c(()=>{if(!j.value)return"";const S=t.toolCall.result;return S?.message?S.message:S?.error?S.error:"An error occurred"});return(S,y)=>(l(),r("div",El,[e("div",Pl,[e("div",Ll,[y[0]||(y[0]=e("span",{class:"command-icon"},"/",-1)),y[1]||(y[1]=e("strong",null,"Slash Command:",-1)),e("code",Il,f(p.value),1),e("span",{class:B(["command-status-badge",u.value])},f(g.value),3)])]),_.value?(l(),r("div",Dl,[e("div",Ol,[y[2]||(y[2]=e("span",{class:"arguments-icon"},"ðŸ“Œ",-1)),y[3]||(y[3]=e("strong",null,"Arguments:",-1)),e("code",Nl,f(_.value),1)])])):E("",!0),$.value?(l(),r("div",Al,[e("div",{class:"command-content-header",onClick:n},[e("div",Rl,[e("i",{class:B(["bi",o.value?"bi-chevron-down":"bi-chevron-right"])},null,2),y[4]||(y[4]=e("strong",null,"Command Content",-1)),e("span",ql,"("+f(b.value)+" lines)",1)])]),o.value?(l(),r("div",Ul,[e("pre",Wl,f(w.value),1)])):E("",!0)])):E("",!0),j.value?(l(),r("div",Hl,[y[5]||(y[5]=e("div",{class:"tool-section-label text-danger"},[e("i",{class:"bi bi-x-circle"}),G(" Error: ")],-1)),e("div",Fl,[e("pre",Bl,f(T.value),1)])])):E("",!0)]))}},zl=V(Vl,[["__scopeId","data-v-3b9a4c67"]]),Gl={class:"exit-plan-mode-tool-handler"},Jl={class:"tool-section mb-3"},Kl={key:0,class:"plan-content mt-2"},Yl={class:"plan-text"},Ql={key:0,class:"tool-section"},Zl={key:0},Xl={key:1,class:"text-danger"},ea={__name:"ExitPlanModeToolHandler",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>t.toolCall.input?.plan),i=c(()=>t.toolCall.result?.success===!1?"tool-result-error":"tool-result-success");return(o,n)=>(l(),r("div",Gl,[e("div",Jl,[n[1]||(n[1]=e("div",{class:"plan-info"},[e("span",{class:"plan-icon"},"ðŸ“‹"),e("strong",null,"Exiting Plan Mode")],-1)),m.value?(l(),r("div",Kl,[n[0]||(n[0]=e("div",{class:"plan-header"},[e("strong",null,"Proposed Plan:")],-1)),e("div",Yl,f(m.value),1)])):E("",!0)]),s.toolCall.result?(l(),r("div",Ql,[n[4]||(n[4]=e("div",{class:"result-header mb-2"},[e("strong",null,"Result:")],-1)),e("div",{class:B(["tool-result",i.value])},[s.toolCall.result.success!==!1?(l(),r("div",Zl,[...n[2]||(n[2]=[e("i",{class:"bi bi-check-circle"},null,-1),G(" Permission mode reverted to default ",-1)])])):(l(),r("div",Xl,[n[3]||(n[3]=e("i",{class:"bi bi-x-circle"},null,-1)),G(" "+f(s.toolCall.result.error||"Failed to exit plan mode"),1)]))],2)])):E("",!0)]))}},ta=V(ea,[["__scopeId","data-v-f1d32203"]]),sa={class:"d-flex align-items-center gap-2 flex-grow-1 min-width-0"},oa={class:"tool-status-icon"},na=["title"],la={class:"text-muted small"},aa={class:"d-flex align-items-center gap-2"},ra={class:"text-muted"},ia={key:0,class:"card-body"},ca={key:0,class:"alert alert-warning mb-3"},ua={class:"d-flex align-items-center"},da={class:"mb-0 small"},ma={key:1,class:"permission-prompt mt-3"},pa={class:"alert alert-warning mb-3"},va={class:"mb-0"},fa={class:"tool-name"},ga={key:0,class:"suggestions-section mb-3"},_a={class:"alert alert-info mb-0"},ba={class:"suggestion-details p-2 bg-white rounded"},ha={class:"permission-buttons d-flex gap-2 mb-3"},ya=["disabled"],$a=["disabled"],wa=["disabled"],Sa={class:"guidance-section mt-3"},ka=["disabled"],Ca=["disabled"],xa={key:2,class:"mt-3"},Ma={class:"alert alert-warning mb-0"},ja={class:"d-flex align-items-center"},Ta={class:"mb-0 small"},Ea={key:3,class:"tool-section mt-3"},Pa={class:"alert alert-danger mb-0"},La={key:0},Ia={__name:"ToolCallCard",props:{toolCall:{type:Object,required:!0}},setup(s){const t=s,m=de(),i=J(),o=ge(),n=L(!1),p=L(null),g=L(""),u=c(()=>m.isToolUseOrphaned(i.currentSessionId,t.toolCall.id)),v=c(()=>m.getOrphanedInfo(i.currentSessionId,t.toolCall.id)),_={Read:ps,Write:Es,Bash:Fs,TodoWrite:ao,Edit:To,Grep:Oe,Glob:Oe,WebFetch:Ne,WebSearch:Ne,Task:On,NotebookEdit:Xn,BashOutput:Ae,KillShell:Ae,SlashCommand:zl,Skill:Tl,ExitPlanMode:ta},w=c(()=>{const D=t.toolCall.name;return _[D]?_[D]:Qt}),$=c(()=>{const D=[];switch(t.toolCall.status){case"pending":D.push("border-secondary");break;case"permission_required":D.push("border-warning");break;case"executing":D.push("border-primary");break;case"completed":S.value||t.toolCall.permissionDecision==="deny"?D.push("border-danger"):D.push("border-success");break;case"error":D.push("border-danger");break}return D.join(" ")}),b=c(()=>{switch(t.toolCall.status){case"pending":return"ðŸ”„";case"permission_required":return"â“";case"executing":return"âš¡";case"completed":return t.toolCall.permissionDecision==="deny"?"âŒ":S.value?"ðŸ’¥":"âœ…";case"error":return"ðŸ’¥";default:return"ðŸ”§"}}),j=c(()=>{switch(t.toolCall.status){case"pending":return"Pending";case"permission_required":return"Awaiting Permission";case"executing":return"Executing...";case"completed":return t.toolCall.permissionDecision==="deny"?"Denied":S.value?"Error":"Completed";case"error":return"Error";default:return"Unknown"}}),T=c(()=>ke(t.toolCall.timestamp)),S=c(()=>t.toolCall.result?.error||t.toolCall.status==="error"),y=c(()=>t.toolCall.suggestions&&t.toolCall.suggestions.length>0);function C(D){if(!D)return"";const d=D.replace(/\\/g,"/").split("/");return d[d.length-1]}function h(D,d=200){return D?D.length<=d?D:D.substring(0,d)+"...":""}function a(D){if(!D)return null;if(D.content){const d=D.content.match(/exit code (\d+)/i);if(d)return parseInt(d[1])}return D.error?1:0}function O(D,d){const M=D?D.split(`
`).length:0;return{added:d?d.split(`
`).length:0,removed:M}}const q=c(()=>{const D=t.toolCall.name,d=t.toolCall.input||{},M=t.toolCall.result,A=t.toolCall.status;switch(D){case"Bash":case"Shell":case"Command":case"SlashCommand":{const N=h(d.command,200);if(A==="completed"&&M){const x=a(M);return`Bash: ${N} (exit ${x})`}return`Bash: ${N}`}case"Edit":{const N=C(d.file_path);if(A==="completed"&&M&&!M.error){const{added:x,removed:I}=O(d.old_string,d.new_string);return x===I?`Edit: ${N} (${x} lines changed)`:`Edit: ${N} (${x} lines added, ${I} removed)`}return`Edit: ${N}`}case"Read":{const N=C(d.file_path);if(d.offset!==void 0||d.limit!==void 0){const I=(d.offset||0)+1,W=d.limit?(d.offset||0)+d.limit:"âˆž";return`Read: ${N} (lines ${I}-${W})`}return`Read: ${N} (full file)`}case"Write":{const N=C(d.file_path);if(A==="completed"&&M&&!M.error&&d.content){const x=d.content.split(`
`).length;return`Write: ${N} (${x} lines written)`}return`Write: ${N}`}case"Skill":{const N=d.command||"Unknown";return A==="completed"&&M?M.error?`Skill: ${N} (error)`:`Skill: ${N} (completed)`:`Skill: ${N}`}case"Task":{const N=d.subagent_type||"general",x=d.description||"Task";return A==="completed"&&M?M.error?`Task: (${N}) ${x} (error)`:`Task: (${N}) ${x} (completed)`:`Task: (${N}) ${x}`}case"TodoWrite":{if(d.todos&&Array.isArray(d.todos)){const N=d.todos.filter(W=>W.status==="completed").length,x=d.todos.length,I=d.todos.find(W=>W.status==="in_progress");return I?`Todo: Working on "${I.content}"`:`Todo: ${N}/${x} Tasks Completed`}return"Todo: Updated"}case"Grep":case"Glob":{const N=d.pattern||"",x=D==="Grep"?"Grep":"Glob";if(A==="completed"&&M&&!M.error){let I=0;return M.content&&(I=M.content.split(`
`).filter(F=>F.trim()).length),`${x}: "${N}" (${I} results)`}return`${x}: "${N}"`}case"WebFetch":case"WebSearch":{const N=d.url||d.query||"";let x="";try{N&&(x=new URL(N.startsWith("http")?N:`https://${N}`).hostname)}catch{x=N.length>50?N.substring(0,50)+"...":N}return A==="completed"&&M?M.error?`Web: ${x} (error)`:`Web: ${x} (success)`:`Web: ${x||N}`}case"NotebookEdit":{const N=C(d.notebook_path),x=d.cell_number!==void 0?d.cell_number:"?",I=d.edit_mode||"replace";return`NotebookEdit: ${N} cell #${x} (${I})`}case"ExitPlanMode":return"ExitPlanMode: Plan submitted";case"BashOutput":return`BashOutput: Read output from ${d.bash_id||"unknown"}`;case"KillShell":return`KillShell: Terminate ${d.shell_id||"unknown"}`;default:return`${D}: executed`}}),k=c(()=>{const D=t.toolCall.name,d=t.toolCall.input||{};return["Bash","Shell","Command","SlashCommand"].includes(D)?d.command||D:["Edit","Read","Write","NotebookEdit"].includes(D)&&(d.file_path||d.notebook_path)||D});function P(){const D=i.currentSessionId;D&&m.toggleToolExpansion(D,t.toolCall.id)}function H(D){return D.type==="setMode"?`Set permission mode to "${D.mode}"`:D.type==="allow"?`Allow tool: ${D.tool}`:JSON.stringify(D)}async function R(D,d,M=null){if(!n.value){n.value=!0,D==="allow"?p.value=d?"approve-apply":"approve":M?p.value="deny-guidance":p.value="deny";try{const A=i.currentSessionId;if(A){const N=d&&t.toolCall.suggestions?t.toolCall.suggestions:[];m.handlePermissionResponse(A,{request_id:t.toolCall.permissionRequestId,decision:D,reasoning:D==="allow"?"User allowed permission":"User denied permission",applied_updates:N})}await o.sendPermissionResponse(t.toolCall.permissionRequestId,D,d,M)}catch(A){console.error("Failed to send permission response:",A)}finally{n.value=!1,p.value=null}}}return(D,d)=>(l(),r("div",{class:B(["tool-call-card card mb-3",$.value])},[e("div",{class:"card-header d-flex align-items-center justify-content-between cursor-pointer",onClick:P},[e("div",sa,[e("span",oa,f(b.value),1),e("strong",{class:"tool-name",title:k.value},f(q.value),9,na),e("span",la,f(j.value),1)]),e("div",aa,[e("small",ra,f(T.value),1),e("i",{class:B(["bi",s.toolCall.isExpanded?"bi-chevron-up":"bi-chevron-down"])},null,2)])]),s.toolCall.isExpanded?(l(),r("div",ia,[u.value?(l(),r("div",ca,[e("div",ua,[d[6]||(d[6]=e("i",{class:"bi bi-x-circle me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[d[5]||(d[5]=e("strong",null,"Tool Execution Cancelled",-1)),e("p",da,f(v.value?.message||"Session was terminated"),1)])])])):E("",!0),(l(),ue(qe(w.value),{toolCall:s.toolCall},null,8,["toolCall"])),s.toolCall.status==="permission_required"&&!u.value?(l(),r("div",ma,[e("div",pa,[d[9]||(d[9]=e("p",{class:"mb-2"},[e("strong",null,"ðŸ” Permission Required")],-1)),e("p",va,[d[7]||(d[7]=G("Claude wants to use the ",-1)),e("code",fa,f(s.toolCall.name),1),d[8]||(d[8]=G(" tool.",-1))])]),y.value?(l(),r("div",ga,[e("div",_a,[d[10]||(d[10]=e("h6",{class:"mb-2"},[e("i",{class:"bi bi-lightbulb me-2"}),G(" Suggested Permission Update ")],-1)),d[11]||(d[11]=e("p",{class:"mb-2 small"},"Claude suggests updating your permissions:",-1)),e("div",ba,[(l(!0),r(Z,null,ee(s.toolCall.suggestions,(M,A)=>(l(),r("div",{key:A,class:"suggestion-item"},[e("code",null,f(H(M)),1)]))),128))]),d[12]||(d[12]=e("small",{class:"text-muted mt-2 d-block"}," This will prevent future permission prompts for this action. ",-1))])])):E("",!0),e("div",ha,[y.value?(l(),r("button",{key:0,class:"btn btn-success",onClick:d[0]||(d[0]=M=>R("allow",!0)),disabled:n.value},[d[13]||(d[13]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+f(n.value&&p.value==="approve-apply"?"â³ Submitting...":"âœ… Approve & Apply"),1)],8,ya)):E("",!0),e("button",{class:B(["btn",y.value?"btn-outline-success":"btn-success"]),onClick:d[1]||(d[1]=M=>R("allow",!1)),disabled:n.value},[d[14]||(d[14]=e("i",{class:"bi bi-check-circle me-1"},null,-1)),G(" "+f(n.value&&p.value==="approve"?"â³ Submitting...":y.value?"âœ… Approve Only":"âœ… Approve"),1)],10,$a),e("button",{class:"btn btn-danger",onClick:d[2]||(d[2]=M=>R("deny",!1)),disabled:n.value},[d[15]||(d[15]=e("i",{class:"bi bi-x-circle me-1"},null,-1)),G(" "+f(n.value&&p.value==="deny"?"â³ Submitting...":"âŒ Deny"),1)],8,wa)]),e("div",Sa,[d[17]||(d[17]=e("label",{class:"form-label fw-bold"},[e("i",{class:"bi bi-chat-left-text me-1"}),G(" Provide Guidance (Optional) ")],-1)),d[18]||(d[18]=e("p",{class:"text-muted small mb-2"}," Provide guidance to help Claude retry with better context. If provided, Claude will continue with your guidance instead of stopping. ",-1)),Y(e("textarea",{"onUpdate:modelValue":d[3]||(d[3]=M=>g.value=M),class:"form-control mb-2",rows:"3",placeholder:"e.g., 'Try using a different approach...' or 'Make sure to check the file exists first...'",disabled:n.value},null,8,ka),[[ne,g.value]]),g.value.trim()?(l(),r("button",{key:0,class:"btn btn-warning btn-sm",onClick:d[4]||(d[4]=M=>R("deny",!1,g.value)),disabled:n.value},[d[16]||(d[16]=e("i",{class:"bi bi-arrow-repeat me-1"},null,-1)),G(" "+f(n.value&&p.value==="deny-guidance"?"â³ Submitting...":"ðŸ’¡ Provide Guidance & Continue"),1)],8,Ca)):E("",!0)])])):E("",!0),s.toolCall.status==="permission_required"&&u.value?(l(),r("div",xa,[e("div",Ma,[e("div",ja,[d[20]||(d[20]=e("i",{class:"bi bi-shield-x me-2",style:{"font-size":"1.2rem"}},null,-1)),e("div",null,[d[19]||(d[19]=e("strong",null,"Permission Request Cancelled",-1)),e("p",Ta,f(v.value?.message||"Session was terminated before permission could be granted"),1)])])])])):E("",!0),s.toolCall.permissionDecision==="deny"?(l(),r("div",Ea,[e("div",Pa,[d[21]||(d[21]=e("i",{class:"bi bi-x-circle"},null,-1)),d[22]||(d[22]=G(" Permission denied ",-1)),s.toolCall.result?.message?(l(),r("span",La," - "+f(s.toolCall.result.message),1)):E("",!0)])])):E("",!0)])):E("",!0)],2))}},Da=V(Ia,[["__scopeId","data-v-5d9ac928"]]),Oa={class:"card assistant-message bg-white border-start border-success border-3"},Na={class:"card-body"},Aa={class:"d-flex justify-content-between align-items-center mb-2"},Ra={class:"d-flex align-items-center gap-2"},qa={key:0,class:"text-muted"},Ua={class:"text-muted"},Wa={key:0,class:"thinking-block mb-3"},Ha=["innerHTML"],Fa={key:2,class:"tool-calls mt-3"},Ba={__name:"AssistantMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,m=de(),i=J();he.setOptions({breaks:!0,gfm:!0});const o=c(()=>ke(t.message.timestamp)),n=c(()=>t.message.metadata?.model||null),p=c(()=>{const b=t.message.content||"";return b.trim().length>0&&b!=="Assistant response"}),g=c(()=>{const b=t.message.content||"",j=he.parse(b);return Te.sanitize(j)}),u=c(()=>t.message.metadata?.has_thinking&&t.message.metadata?.thinking_content),v=c(()=>t.message.metadata?.thinking_content||""),_=c(()=>t.message.metadata?.has_tool_uses&&t.message.metadata?.tool_uses?.length>0),w=c(()=>t.message.metadata?.tool_uses||[]),$=c(()=>{const b=i.currentSessionId;if(!b)return[];const j=m.toolCallsBySession.get(b)||[];return w.value.map(T=>{const S=j.find(y=>y.id===T.id);return S||{id:T.id,name:T.name,input:T.input,status:"pending",result:null,timestamp:T.timestamp||t.message.timestamp,isExpanded:!0}})});return(b,j)=>(l(),r("div",Oa,[e("div",Na,[e("div",Aa,[e("div",Ra,[j[0]||(j[0]=e("span",{class:"message-icon"},"ðŸ¤–",-1)),j[1]||(j[1]=e("strong",{class:"message-role"},"Assistant",-1)),n.value?(l(),r("small",qa,f(n.value),1)):E("",!0)]),e("small",Ua,f(o.value),1)]),u.value?(l(),r("div",Wa,[Q(Wt,{thinking:v.value},null,8,["thinking"])])):E("",!0),p.value?(l(),r("div",{key:1,class:"message-content",innerHTML:g.value},null,8,Ha)):E("",!0),_.value?(l(),r("div",Fa,[(l(!0),r(Z,null,ee($.value,T=>(l(),ue(Da,{key:T.id,toolCall:T},null,8,["toolCall"]))),128))])):E("",!0)])]))}},Va=V(Ba,[["__scopeId","data-v-25a87a40"]]),za={class:"card system-message bg-info bg-opacity-10 border-info"},Ga={class:"card-body py-2 px-3"},Ja={class:"d-flex align-items-center gap-2"},Ka={class:"text-muted flex-grow-1"},Ya={class:"text-muted"},Qa={__name:"SystemMessage",props:{message:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>ke(t.message.timestamp));return(i,o)=>(l(),r("div",za,[e("div",Ga,[e("div",Ja,[o[0]||(o[0]=e("i",{class:"bi bi-info-circle text-info"},null,-1)),e("small",Ka,f(s.message.content),1),e("small",Ya,f(m.value),1)])])]))}},Re=V(Qa,[["__scopeId","data-v-bba7a395"]]),Za={__name:"MessageItem",props:{message:{type:Object,required:!0}},setup(s){const t=s,m=c(()=>{switch(t.message.type){case"user":return Ot;case"assistant":return Va;case"system":return Re;default:return Re}});return(i,o)=>(l(),r("div",{class:B(["message-item mb-3",`message-${s.message.type}`])},[(l(),ue(qe(m.value),{message:s.message},null,8,["message"]))],2))}},Xa=V(Za,[["__scopeId","data-v-fbd275ac"]]),er={key:0,class:"text-muted text-center py-5"},tr={__name:"MessageList",setup(s){const t=de(),m=se(),i=L(null),o=c(()=>t.currentMessages.filter(u=>p(u)));c(()=>t.currentToolCalls);async function n(){m.autoScrollEnabled&&(await je(),i.value&&(i.value.scrollTop=i.value.scrollHeight))}te(()=>t.currentMessages.length,n),te(()=>t.currentToolCalls.length,n),te(()=>t.currentToolCalls.map(u=>`${u.id}-${u.status}`).join(","),n),ie(()=>{setTimeout(()=>{n()},100)});function p(u){const v=u.subtype||u.metadata?.subtype;if(u.type==="system"&&v==="init"||u.type==="result"||u.type==="permission_request"||u.type==="permission_response")return!1;if(u.type==="user"&&u.metadata?.has_tool_results){const _=u.content||"";if(_.match(/^Tool results?: \d+ results?$/i)||_.trim()==="")return!1}if(u.type==="user"){const _=u.content||"";if(_.includes("<command-message>")&&_.includes("skill is running")||_.startsWith("Base directory for this skill:"))return!1}if(u.type==="user"){const _=u.content||"";if(_.includes("<command-message>")&&_.includes("<command-name>")&&_.includes("<command-args>")||_.includes("ARGUMENTS:")&&(_.includes("<command-name>")||_.match(/\nARGUMENTS:/)))return!1}return!0}function g(u){return{type:u.type||"unknown",content:u.content||"",timestamp:u.timestamp||Date.now()/1e3,metadata:{has_tool_uses:!1,has_tool_results:!1,has_thinking:!1,has_permission_requests:!1,has_permission_responses:!1,tool_uses:[],tool_results:[],thinking_content:"",thinking_blocks:[],...u.metadata}}}return(u,v)=>(l(),r("div",{class:"messages-area flex-grow-1 overflow-auto p-3",ref_key:"messagesArea",ref:i},[o.value.length===0?(l(),r("div",er," No messages yet. Start a conversation! ")):E("",!0),(l(!0),r(Z,null,ee(o.value,(_,w)=>(l(),ue(Xa,{key:`msg-${_.timestamp}-${w}`,message:g(_)},null,8,["message"]))),128))],512))}},sr=V(tr,[["__scopeId","data-v-54f5badf"]]),or={class:"border-top bg-light"},nr={class:"d-flex gap-2 align-items-end px-2 py-1"},lr=["placeholder","disabled","onKeydown"],ar=["disabled"],rr={__name:"InputArea",setup(s){const t=J(),m=ge(),i=L(null),o=c({get:()=>t.currentInput,set:$=>{t.currentInput=$}}),n=c(()=>t.currentSession?.is_processing||!1),p=c(()=>m.sessionConnected),g=c(()=>t.currentSession?.state==="starting"),u=c(()=>g.value?"Session is starting...":p.value?"Type your message to Claude Code...":"Waiting for connection...");function v(){const $=i.value;if(!$)return;$.style.height="auto";const b=Math.min($.scrollHeight,parseInt(getComputedStyle($).maxHeight));$.style.height=b+"px"}function _(){o.value.trim()&&(m.sendMessage(o.value),o.value="",i.value&&(i.value.style.height="auto"))}function w(){m.interruptSession()}return($,b)=>(l(),r("div",or,[e("div",nr,[Y(e("textarea",{id:"message-input",ref_key:"messageTextarea",ref:i,"onUpdate:modelValue":b[0]||(b[0]=j=>o.value=j),class:"form-control",placeholder:u.value,disabled:g.value||!p.value,rows:"1",onInput:v,onKeydown:Se(re(_,["exact","prevent"]),["enter"])},null,40,lr),[[ne,o.value]]),n.value?(l(),r("button",{key:0,class:"btn btn-warning",title:"Stop current processing",onClick:w}," Stop ")):(l(),r("button",{key:1,class:"btn btn-primary",disabled:!o.value.trim()||!p.value||g.value,onClick:_}," Send ",8,ar))])]))}},ir=V(rr,[["__scopeId","data-v-a72bf16a"]]),cr={class:"d-flex flex-column flex-grow-1 overflow-hidden position-relative"},ur={key:0,class:"position-absolute top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex flex-column justify-content-center align-items-center",style:{"z-index":"1000"}},dr={class:"text-secondary"},mr={class:"d-flex flex-column flex-grow-1 overflow-hidden"},We={__name:"SessionView",props:{sessionId:{type:String,required:!0}},setup(s){const t=s,m=J(),i=se(),o=c(()=>m.currentSession),n=c(()=>i.isLoading),p=c(()=>i.loadingMessage);return ie(async()=>{if(t.sessionId!==m.currentSessionId){i.showLoading("Loading session...");try{await m.selectSession(t.sessionId)}finally{i.hideLoading()}}}),te(()=>t.sessionId,async(g,u)=>{if(g!==u&&g!==m.currentSessionId){i.showLoading("Loading session...");try{await m.selectSession(g)}finally{i.hideLoading()}}}),ce(()=>{}),(g,u)=>(l(),r("div",cr,[n.value?(l(),r("div",ur,[u[0]||(u[0]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",dr,f(p.value),1)])):E("",!0),o.value?(l(),ue(at,{key:1,"session-id":t.sessionId},null,8,["session-id"])):E("",!0),e("div",mr,[Q(sr)]),Q(ir),o.value?(l(),ue(dt,{key:2,"session-id":t.sessionId},null,8,["session-id"])):E("",!0),o.value?(l(),ue(yt,{key:3,"session-id":t.sessionId},null,8,["session-id"])):E("",!0)]))}},Ee=_e("legion",()=>{const s=L(new Map),t=L(new Map),m=L(new Map),i=L(new Map),o=L(null),n=c(()=>s.value.get(o.value)||[]),p=c(()=>t.value.get(o.value)||[]),g=c(()=>m.value.get(o.value)||[]),u=c(()=>i.value.get(o.value)||[]);function v(C){o.value=C}async function _(C,h=100,a=0){try{const O=await K.get(`/api/legions/${C}/timeline?limit=${h}&offset=${a}`),q=O.comms||[],k=O.total_count||q.length,P=O.has_more||!1;return q.sort((H,R)=>new Date(H.timestamp)-new Date(R.timestamp)),console.log(`Loaded ${q.length} of ${k} comms for legion ${C}`),s.value.set(C,q),s.value=new Map(s.value),{comms:q,totalCount:k,hasMore:P}}catch(O){throw console.error("Failed to load timeline:",O),O}}function w(C,h){s.value.has(C)||s.value.set(C,[]),s.value.get(C).push(h),s.value=new Map(s.value)}async function $(C,h){try{const O=(await K.post(`/api/legions/${C}/comms`,h)).comm;return console.log(`Sent comm ${O.comm_id} to legion ${C}`),O}catch(a){throw console.error("Failed to send comm:",a),a}}async function b(C){return console.log(`Minions for legion ${C} are already available in session store`),[]}async function j(C,h){try{const O=(await K.post(`/api/legions/${C}/minions`,h)).minion;return await b(C),console.log(`Created minion ${O.minion_id} in legion ${C}`),O}catch(a){throw console.error("Failed to create minion:",a),a}}async function T(C){try{const a=(await K.get(`/api/legions/${C}/hordes`)).hordes||[];return console.log(`Loaded ${a.length} hordes for legion ${C}`),m.value.set(C,a),m.value=new Map(m.value),a}catch(h){throw console.error("Failed to load hordes:",h),h}}async function S(C){try{const a=(await K.get(`/api/legions/${C}/channels`)).channels||[];return console.log(`Loaded ${a.length} channels for legion ${C}`),i.value.set(C,a),i.value=new Map(i.value),a}catch(h){throw console.error("Failed to load channels:",h),h}}function y(C){s.value.delete(C),t.value.delete(C),m.value.delete(C),i.value.delete(C),s.value=new Map(s.value),t.value=new Map(t.value),m.value=new Map(m.value),i.value=new Map(i.value)}return{commsByLegion:s,minionsByLegion:t,hordesByLegion:m,channelsByLegion:i,currentLegionId:o,currentComms:n,currentMinions:p,currentHordes:g,currentChannels:u,setCurrentLegion:v,loadTimeline:_,addComm:w,sendComm:$,loadMinions:b,createMinion:j,loadHordes:T,loadChannels:S,clearLegionData:y}}),pr=Object.freeze(Object.defineProperty({__proto__:null,useLegionStore:Ee},Symbol.toStringTag,{value:"Module"})),vr={class:"timeline-header border-bottom p-3"},fr={class:"project-name"},gr=["title"],_r={__name:"TimelineHeader",props:{legionId:{type:String,required:!0}},setup(s){const t=s,m=le(),i=c(()=>m.projects.get(t.legionId)),o=c(()=>i.value?.name||"Legion");return(n,p)=>(l(),r("div",vr,[e("div",null,[e("div",fr,f(o.value),1),e("div",{class:"view-name",title:s.legionId},"Timeline",8,gr)])]))}},br=V(_r,[["__scopeId","data-v-44f386f5"]]),hr={class:"timeline-status-bar border-top p-2 bg-light"},yr={class:"d-flex justify-content-end"},$r={__name:"TimelineStatusBar",props:{legionId:{type:String,required:!0}},setup(s){const t=se();function m(){t.setAutoScroll(!t.autoScrollEnabled)}return(i,o)=>(l(),r("div",hr,[e("div",yr,[e("button",{class:B(["btn btn-sm",we(t).autoScrollEnabled?"btn-primary":"btn-outline-secondary"]),onClick:m}," â¬‡ï¸ "+f(we(t).autoScrollEnabled?"ON":"OFF"),3)])]))}},wr=V($r,[["__scopeId","data-v-891c73db"]]),Sr={class:"comm-composer border-top p-3"},kr={class:"d-flex gap-2 mb-2"},Cr={class:"flex-grow-1"},xr=["disabled"],Mr={label:"Minions"},jr=["value"],Tr={key:0,label:"Channels"},Er=["value"],Pr={style:{"min-width":"150px"}},Lr=["disabled"],Ir={class:"d-flex gap-2 align-items-end position-relative"},Dr={class:"flex-grow-1 position-relative"},Or=["disabled"],Nr=["onClick","onMouseenter"],Ar=["disabled"],Rr={key:0},qr={key:1},Ur={__name:"CommComposer",props:{legionId:{type:String,required:!0}},setup(s){const t=s,m=Ee(),i=J(),o=le(),n=L(""),p=L("task"),g=L(""),u=L(!1),v=L(!1),_=L([]),w=L(0),$=L(-1),b=L(null),j=L(null),T=c(()=>{const R=o.projects.get(t.legionId);return!R||!R.session_ids?[]:R.session_ids.map(D=>i.sessions.get(D)).filter(D=>D&&D.is_minion)}),S=c(()=>m.currentChannels||[]),y=c(()=>n.value&&g.value.trim().length>0);function C(R){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[R.state]||"â—‹"}function h(R){return R.is_minion&&R.role?`${R.name} (${R.role})`:R.name}function a(){const R=b.value;if(!R)return;R.style.height="auto";const D=Math.min(R.scrollHeight,parseInt(getComputedStyle(R).maxHeight));R.style.height=D+"px"}function O(){const R=b.value;if(!R)return;a();const D=g.value,d=R.selectionStart,M=D.substring(0,d),A=M.lastIndexOf("#");if(A===-1){v.value=!1;return}const N=M.substring(A+1).toLowerCase();if(N.includes(" ")){v.value=!1;return}const x=T.value.filter(I=>I.name.toLowerCase().includes(N)).map(I=>({type:"minion",name:I.name,role:I.role,id:I.session_id,state:I.state}));if(x.length===0){v.value=!1;return}_.value=x,w.value=0,$.value=A,v.value=!0}function q(){if(!j.value)return;const R=j.value,D=R.children[w.value];if(!D)return;const d=D.offsetTop,M=D.offsetHeight,A=R.scrollTop,N=R.clientHeight;d<A?R.scrollTop=d:d+M>A+N&&(R.scrollTop=d+M-N)}function k(R){if(!v.value){R.key==="Enter"&&!R.shiftKey&&y.value&&(R.preventDefault(),H());return}if(R.key==="ArrowDown")R.preventDefault(),w.value=(w.value+1)%_.value.length,q();else if(R.key==="ArrowUp")R.preventDefault(),w.value=w.value===0?_.value.length-1:w.value-1,q();else if(R.key==="Enter"){R.preventDefault();const D=_.value[w.value];D&&P(D)}else R.key==="Escape"&&(v.value=!1)}function P(R){const D=b.value;if(!D)return;const d=g.value,M=D.selectionStart,A=d.substring(0,$.value)+"#"+R.name+" "+d.substring(M);g.value=A;const N=$.value+R.name.length+2;setTimeout(()=>{D.setSelectionRange(N,N),D.focus()},0),v.value=!1}async function H(){if(!(!y.value||u.value)){u.value=!0;try{const[R,D]=n.value.split(":"),d={comm_type:p.value,content:g.value.trim()};R==="minion"?d.to_minion_id=D:R==="channel"&&(d.to_channel_id=D),await m.sendComm(t.legionId,d),g.value="",a()}catch(R){console.error("Failed to send comm:",R),alert(`Failed to send comm: ${R.message}`)}finally{u.value=!1}}}return te(v,R=>{if(R){const D=d=>{d.target.closest(".comm-composer")||(v.value=!1,document.removeEventListener("click",D))};setTimeout(()=>document.addEventListener("click",D),0)}}),(R,D)=>(l(),r("div",Sr,[e("div",kr,[e("div",Cr,[Y(e("select",{"onUpdate:modelValue":D[0]||(D[0]=d=>n.value=d),class:"form-select form-select-sm",disabled:u.value},[D[3]||(D[3]=e("option",{value:""},"-- Select Recipient --",-1)),e("optgroup",Mr,[(l(!0),r(Z,null,ee(T.value,d=>(l(),r("option",{key:d.session_id,value:`minion:${d.session_id}`},f(C(d))+" "+f(h(d)),9,jr))),128))]),S.value.length>0?(l(),r("optgroup",Tr,[(l(!0),r(Z,null,ee(S.value,d=>(l(),r("option",{key:d.channel_id,value:`channel:${d.channel_id}`}," #ï¸âƒ£ "+f(d.name),9,Er))),128))])):E("",!0)],8,xr),[[fe,n.value]])]),e("div",Pr,[Y(e("select",{"onUpdate:modelValue":D[1]||(D[1]=d=>p.value=d),class:"form-select form-select-sm",disabled:u.value},[...D[4]||(D[4]=[e("option",{value:"task"},"Task",-1),e("option",{value:"question"},"Question",-1),e("option",{value:"info"},"Info",-1),e("option",{value:"report"},"Report",-1)])],8,Lr),[[fe,p.value]])])]),e("div",Ir,[e("div",Dr,[Y(e("textarea",{ref_key:"contentTextarea",ref:b,"onUpdate:modelValue":D[2]||(D[2]=d=>g.value=d),class:"form-control form-control-sm",rows:"1",placeholder:"Type message... Use # to mention minions",disabled:u.value,onInput:O,onKeydown:k},null,40,Or),[[ne,g.value]]),v.value?(l(),r("div",{key:0,ref_key:"autocompleteDropdown",ref:j,class:"autocomplete-dropdown position-absolute bg-white border rounded shadow-sm"},[(l(!0),r(Z,null,ee(_.value,(d,M)=>(l(),r("div",{key:d.id,class:B(["autocomplete-item px-2 py-1",{"bg-light":M===w.value}]),onClick:A=>P(d),onMouseenter:A=>w.value=M},f(d.type==="minion"?C(d):"#ï¸âƒ£")+" "+f(d.name)+f(d.role?` (${d.role})`:""),43,Nr))),128))],512)):E("",!0)]),e("div",null,[e("button",{class:"btn btn-primary btn-sm",disabled:!y.value||u.value,onClick:H},[u.value?(l(),r("span",Rr,[...D[5]||(D[5]=[e("span",{class:"spinner-border spinner-border-sm me-1"},null,-1),G(" Sending... ",-1)])])):(l(),r("span",qr,"Send"))],8,Ar)])])]))}},Wr=V(Ur,[["__scopeId","data-v-ffa54193"]]),Hr={class:"timeline-view d-flex flex-column h-100"},Fr={key:0,class:"text-center text-muted"},Br={key:1,class:"text-center text-danger"},Vr={key:2,class:"text-center text-muted"},zr={key:3,class:"comm-list"},Gr={class:"col-auto message-speaker text-end pe-3"},Jr={class:"text-muted"},Kr={class:"col message-content-column"},Yr={class:"comm-card card"},Qr={class:"card-body p-2"},Zr={class:"d-flex justify-content-between align-items-start mb-1"},Xr={class:"ms-2"},ei={class:"comm-content"},ti={__name:"TimelineView",props:{legionId:{type:String,required:!0}},setup(s){const t=s,m=Ee(),i=le(),o=J(),n=ge(),p=se(),g=L(!0),u=L(null),v=L(null),_=c(()=>i.projects.get(t.legionId));c(()=>_.value?.name||"Legion");const w=c(()=>m.currentComms);c(()=>m.currentMinions);function $(a){return a.from_user?"You":a.from_minion_id&&o.sessions.get(a.from_minion_id)?.name||"Unknown"}function b(a){return a.to_user?"You":a.to_minion_id?o.sessions.get(a.to_minion_id)?.name||"Unknown":a.to_channel_id?`#${a.to_channel_id}`:"All"}function j(a){return{task:"bg-primary",question:"bg-info",info:"bg-secondary",report:"bg-success"}[a]||"bg-secondary"}function T(a){return new Date(a).toLocaleTimeString()}async function S(){p.autoScrollEnabled&&(await je(),v.value&&(v.value.scrollTop=v.value.scrollHeight))}async function y(){g.value=!0,u.value=null;try{m.setCurrentLegion(t.legionId),await Promise.all([m.loadTimeline(t.legionId),m.loadMinions(t.legionId)]),await je(),await S(),setTimeout(()=>{S()},100)}catch(a){console.error("Failed to load timeline:",a),a.response?u.value=`${a.message} (${a.response.status})`:u.value=a.message||"Unknown error"}finally{g.value=!1}}function C(){n.connectLegion(t.legionId)}function h(){n.disconnectLegion()}return te(()=>w.value.length,()=>{S()}),ie(()=>{y(),C(),setTimeout(()=>{S()},100)}),ce(()=>{h()}),(a,O)=>(l(),r("div",Hr,[Q(br,{"legion-id":s.legionId},null,8,["legion-id"]),e("div",{ref_key:"messagesArea",ref:v,class:"timeline-messages flex-grow-1 overflow-auto p-3"},[g.value?(l(),r("div",Fr,[...O[0]||(O[0]=[e("div",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),G(" Loading timeline... ",-1)])])):u.value?(l(),r("div",Br," Failed to load timeline: "+f(u.value),1)):w.value.length===0?(l(),r("div",Vr," No messages yet. Minions will appear here once they start communicating. ")):(l(),r("div",zr,[(l(!0),r(Z,null,ee(w.value,q=>(l(),r("div",{key:q.comm_id,class:"comm-item message-row row py-2 mb-2"},[e("div",Gr,[e("small",Jr,f(T(q.timestamp)),1)]),e("div",Kr,[e("div",Yr,[e("div",Qr,[e("div",Zr,[e("div",null,[e("span",{class:B(["badge",j(q.comm_type)])},f(q.comm_type),3),e("strong",Xr,f($(q)),1),O[1]||(O[1]=e("span",{class:"text-muted mx-1"},"â†’",-1)),e("strong",null,f(b(q)),1)])]),e("div",ei,f(q.content),1)])])])]))),128))]))],512),Q(Wr,{"legion-id":s.legionId},null,8,["legion-id"]),Q(wr,{"legion-id":s.legionId},null,8,["legion-id"])]))}},si=V(ti,[["__scopeId","data-v-d4c7422e"]]),oi={class:"spy-view d-flex flex-column overflow-hidden"},ni={__name:"SpyView",props:{legionId:{type:String,required:!0},minionId:{type:String,required:!0}},setup(s){return(t,m)=>(l(),r("div",oi,[Q(We,{"session-id":s.minionId,"is-spy-mode":!0},null,8,["session-id"])]))}},li=V(ni,[["__scopeId","data-v-43a24eaf"]]),ai={class:"horde-header border-bottom p-3"},ri={class:"project-name"},ii=["title"],ci={__name:"HordeHeader",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,m=le(),i=J(),o=c(()=>m.projects.get(t.legionId)),n=c(()=>o.value?.name||"Legion"),p=c(()=>i.sessions.get(t.overseerId)),g=c(()=>p.value?.name||"Overseer");return(u,v)=>(l(),r("div",ai,[e("div",null,[e("div",ri,f(n.value),1),e("div",{class:"view-name",title:s.overseerId},f(g.value)+"'s Horde",9,ii)])]))}},ui=V(ci,[["__scopeId","data-v-775da47d"]]),di={class:"horde-status-bar border-top p-2 bg-light"},mi={__name:"HordeStatusBar",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){return(t,m)=>(l(),r("div",di,[...m[0]||(m[0]=[e("div",{class:"text-center text-muted small"}," Read-only view ",-1)])]))}},pi=V(mi,[["__scopeId","data-v-7f3c847f"]]),vi={class:"minion-card p-2 border-start border-2 mb-2"},fi={class:"d-flex align-items-center"},gi={class:"me-2"},_i={key:0,class:"me-2"},bi={key:1,class:"text-muted ms-2"},hi={key:2,class:"badge bg-secondary ms-2"},yi={class:"text-muted small ms-4"},$i={key:0,class:"minion-children"},wi={key:1,class:"text-danger small ms-4"},Si={__name:"MinionTreeNode",props:{minionId:{type:String,required:!0},level:{type:Number,default:0}},setup(s){const t=s,m=J(),i=c(()=>m.sessions.get(t.minionId)),o=c(()=>t.level*24),n=c(()=>{const v=i.value&&i.value.child_minion_ids&&i.value.child_minion_ids.length>0;return i.value&&i.value.child_minion_ids&&i.value.child_minion_ids.length>0&&console.log(`Minion ${i.value.name} has ${i.value.child_minion_ids.length} children:`,i.value.child_minion_ids),v}),p=c(()=>i.value&&i.value.is_overseer&&n.value),g={created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "},u=c(()=>g[i.value?.state]||"â—‹");return(v,_)=>{const w=Ue("MinionTreeNode",!0);return i.value?(l(),r("div",{key:0,class:"minion-tree-node",style:me({marginLeft:`${o.value}px`})},[e("div",vi,[e("div",fi,[e("span",gi,f(u.value),1),p.value?(l(),r("span",_i,"ðŸ‘‘")):E("",!0),e("strong",null,f(i.value.name),1),i.value.role?(l(),r("span",bi,f(i.value.role),1)):E("",!0),p.value?(l(),r("span",hi,f(i.value.child_minion_ids.length)+" "+f(i.value.child_minion_ids.length===1?"child":"children"),1)):E("",!0)]),e("div",yi," Level "+f(i.value.overseer_level||0)+" â€¢ "+f(i.value.state),1)]),n.value?(l(),r("div",$i,[(l(!0),r(Z,null,ee(i.value.child_minion_ids,$=>(l(),ue(w,{key:$,"minion-id":$,level:s.level+1},null,8,["minion-id","level"]))),128))])):E("",!0)],4)):t.minionId?(l(),r("div",wi," âš  Minion data not found for ID: "+f(t.minionId),1)):E("",!0)}}},ki=V(Si,[["__scopeId","data-v-120682eb"]]),Ci={class:"horde-view d-flex flex-column h-100"},xi={class:"horde-tree-container flex-grow-1 overflow-auto p-3"},Mi={key:0,class:"alert alert-danger"},ji={key:1,class:"horde-tree"},Ti={__name:"HordeView",props:{legionId:{type:String,required:!0},overseerId:{type:String,required:!0}},setup(s){const t=s,m=J(),i=le(),o=c(()=>i.projects.get(t.legionId));c(()=>o.value?.name||"Legion");const n=c(()=>m.sessions.get(t.overseerId));return(p,g)=>(l(),r("div",Ci,[Q(ui,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"]),e("div",xi,[n.value?(l(),r("div",ji,[Q(ki,{"minion-id":s.overseerId,level:0},null,8,["minion-id"])])):(l(),r("div",Mi," Overseer not found "))]),Q(pi,{"legion-id":s.legionId,"overseer-id":s.overseerId},null,8,["legion-id","overseer-id"])]))}},Ei=V(Ti,[["__scopeId","data-v-b928719b"]]),Pi=[{path:"/",name:"home",component:Ke},{path:"/session/:sessionId",name:"session",component:We,props:!0},{path:"/timeline/:legionId",name:"timeline",component:si,props:!0},{path:"/spy/:legionId/:minionId",name:"spy",component:li,props:!0},{path:"/horde/:legionId/:overseerId",name:"horde",component:Ei,props:!0}],Li=Fe({history:Be(),routes:Pi}),Ii={__name:"ConnectionIndicator",setup(s){const t=ge(),m=c(()=>{switch(t.overallStatus){case"connected":return"bg-success";case"partial":return"bg-warning";default:return"bg-secondary"}}),i=c(()=>{switch(t.overallStatus){case"connected":return"Connected";case"partial":return"Partial Connection";default:return"Disconnected"}});return(o,n)=>(l(),r("span",{id:"connection-indicator",class:B(["badge",m.value])},f(i.value),3))}},Di={class:"bg-white border-bottom shadow-sm d-flex justify-content-between align-items-center px-3 py-2"},Oi={class:"d-flex align-items-center gap-2"},Ni={__name:"AppHeader",setup(s){const t=se();function m(){t.toggleSidebar()}return(i,o)=>(l(),r("header",Di,[e("div",{class:"d-flex align-items-center gap-2"},[e("button",{id:"sidebar-toggle-btn",class:"btn btn-sm btn-outline-secondary",title:"Toggle sidebar",onClick:m},[...o[0]||(o[0]=[e("span",null,"â˜°",-1)])]),o[1]||(o[1]=e("h1",{class:"mb-0 fs-4"},"Claude Code WebUI",-1))]),e("div",Oi,[Q(Ii)])]))}},Ai={class:"progress project-status-line",style:{height:"4px","border-radius":"0"}},Ri={key:0,class:"progress-bar bg-secondary",style:{width:"100%"}},qi=["title"],Ui={__name:"ProjectStatusLine",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,m=c(()=>!t.sessions||t.sessions.length===0?"100%":`${100/t.sessions.length}%`);function i(g){return g.state==="paused"&&g.is_processing?"pending-prompt":g.is_processing?"processing":g.state}function o(g){const u=i(g);return{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"}[u]||"#d3d3d3"}function n(g){const u=i(g);return u==="starting"||u==="processing"||u==="pending-prompt"}function p(g){const u=i(g),v=u.charAt(0).toUpperCase()+u.slice(1),_=g.name||"Unnamed Session",w=g.is_minion&&g.role?` (${g.role})`:"";return`${_}${w}: ${v}`}return(g,u)=>(l(),r("div",Ai,[!s.sessions||s.sessions.length===0?(l(),r("div",Ri)):(l(!0),r(Z,{key:1},ee(s.sessions,v=>(l(),r("div",{key:v.session_id,class:B(["progress-bar",{"progress-bar-striped progress-bar-animated":n(v)}]),style:me({width:m.value,backgroundColor:o(v),cursor:"help"}),title:p(v)},null,14,qi))),128))]))}},Wi=V(Ui,[["__scopeId","data-v-a79cfeec"]]),Hi={class:"flex-grow-1"},Fi={key:0,class:"text-muted small ms-1"},Bi={__name:"SessionItem",props:{session:{type:Object,required:!0},projectId:{type:String,required:!0}},setup(s){const t=s,m=pe(),i=J(),o=le(),n=se(),p=c(()=>i.currentSessionId===t.session.session_id),g=c(()=>i.deletingSessions.has(t.session.session_id)),u=c(()=>t.session.state==="paused"&&t.session.is_processing?"pending-prompt":t.session.is_processing?"processing":t.session.state),v=c(()=>{const y=u.value;return{created:"status-dot-grey",starting:"status-dot-green status-blinking",active:"status-dot-green",running:"status-dot-green",processing:"status-dot-purple status-blinking",paused:"status-dot-grey","pending-prompt":"status-dot-yellow status-blinking",terminated:"status-dot-grey",error:"status-dot-red",failed:"status-dot-red"}[y]||"status-dot-grey"}),_=c(()=>{const y=u.value,C={created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",running:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3","pending-prompt":"#ffc107",terminated:"#d3d3d3",error:"#ffb3b3",failed:"#ffb3b3"},h={created:"#6c757d",starting:"#28a745",active:"#28a745",running:"#28a745",processing:"#6f42c1",paused:"#6c757d","pending-prompt":"#e0a800",terminated:"#6c757d",error:"#dc3545",failed:"#dc3545"};return{backgroundColor:C[y]||"#d3d3d3",borderColor:h[y]||"#6c757d"}});function w(){i.selectSession(t.session.session_id),m.push(`/session/${t.session.session_id}`)}function $(){n.showModal("edit-session",{session:t.session})}function b(y){y.dataTransfer.effectAllowed="move",y.dataTransfer.setData("application/session-id",t.session.session_id),y.dataTransfer.setData("application/project-id",t.projectId),y.dataTransfer.setData("text/plain",t.session.session_id),y.target.classList.add("dragging")}function j(y){y.target.classList.remove("dragging")}function T(y){y.preventDefault(),y.dataTransfer.dropEffect="move";const C=y.currentTarget.getBoundingClientRect(),h=C.top+C.height/2;y.clientY<h?(y.currentTarget.classList.add("drop-above"),y.currentTarget.classList.remove("drop-below")):(y.currentTarget.classList.add("drop-below"),y.currentTarget.classList.remove("drop-above"))}function S(y){y.preventDefault(),y.currentTarget.classList.remove("drop-above","drop-below");const C=y.dataTransfer.getData("application/session-id")||y.dataTransfer.getData("text/plain"),h=y.dataTransfer.getData("application/project-id");if(!C||C===t.session.session_id||h!==t.projectId)return;const a=y.currentTarget.getBoundingClientRect(),O=a.top+a.height/2,q=y.clientY<O,k=o.getProject(t.projectId);if(!k||!k.session_ids)return;const P=[...k.session_ids],H=P.indexOf(t.session.session_id),R=P.indexOf(C);if(H===-1||R===-1)return;const D=[...P],[d]=D.splice(R,1);let M=q?H:H+1;R<H&&M--,D.splice(M,0,d),o.reorderSessionsInProject(t.projectId,D)}return(y,C)=>(l(),r("div",{class:B(["list-group-item list-group-item-action d-flex align-items-center p-2",{active:p.value,"session-deleting":g.value}]),style:{cursor:"pointer"},draggable:"true",onClick:w,onDragstart:b,onDragend:j,onDragover:T,onDrop:S},[e("div",{class:B(["status-dot me-2",v.value]),style:me(_.value)},null,6),e("div",Hi,[e("span",null,f(s.session.name||s.session.session_id),1),s.session.is_minion&&s.session.role?(l(),r("span",Fi,"("+f(s.session.role)+")",1)):E("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",title:"Manage session",onClick:re($,["stop"])}," âœï¸ ")],34))}},Vi=V(Bi,[["__scopeId","data-v-07ecbf94"]]),zi=["value"],Gi={__name:"SpySelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,m=pe(),i=J(),o=L("");te(()=>m.currentRoute.value,b=>{!o.value&&b.name==="spy"&&b.params.minionId&&b.params.legionId===t.project.project_id&&(o.value=b.params.minionId)},{immediate:!0});const n=c(()=>o.value?t.sessions.find(b=>b.session_id===o.value):null),p=c(()=>{const b=m.currentRoute.value;return b.name==="spy"&&b.params.legionId===t.project.project_id}),g=c(()=>{if(!n.value)return"";if(n.value.state==="paused"&&n.value.is_processing)return"status-blinking";const b=n.value.is_processing?"processing":n.value.state;return b==="starting"||b==="processing"?"status-blinking":""}),u=c(()=>{if(!n.value)return{};if(n.value.state==="paused"&&n.value.is_processing)return{backgroundColor:"#ffc107"};const b=n.value.is_processing?"processing":n.value.state;return{backgroundColor:{created:"#d3d3d3",starting:"#90ee90",active:"#90ee90",processing:"#dda0dd",paused:"#d3d3d3",terminating:"#ffcccb",terminated:"#d3d3d3",error:"#ffcccb"}[b]||"#d3d3d3"}});function v(b){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[b.state]||"â—‹"}function _(b){return b.is_minion&&b.role?`${b.name} (${b.role})`:b.name}function w(){o.value&&m.push(`/spy/${t.project.project_id}/${o.value}`)}function $(){o.value?m.push(`/spy/${t.project.project_id}/${o.value}`):m.push("/")}return te(()=>i.currentSessionId,b=>{if(b)t.sessions.some(j=>j.session_id===b)&&(o.value=b);else{o.value="";const j=m.currentRoute.value;j.name==="spy"&&j.params.legionId===t.project.project_id&&m.push("/")}}),(b,j)=>(l(),r("div",{class:B(["list-group-item list-group-item-action p-2",{active:p.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:me({cursor:o.value?"pointer":"default"}),onClick:w},[j[1]||(j[1]=e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ”"),e("span",{class:"fw-semibold"},"Spy"),e("small",{class:"text-muted ms-2"},"(Inspect Minion)")],-1)),n.value?(l(),r("span",{key:0,class:B(["minion-state-indicator",g.value]),style:me(u.value)}," ðŸ‘¤ ",6)):E("",!0)],4),Y(e("select",{"onUpdate:modelValue":j[0]||(j[0]=T=>o.value=T),class:"form-select form-select-sm",onChange:$},[j[2]||(j[2]=e("option",{value:""},"-- Select Minion --",-1)),(l(!0),r(Z,null,ee(s.sessions,T=>(l(),r("option",{key:T.session_id,value:T.session_id},f(v(T))+" "+f(_(T)),9,zi))),128))],544),[[fe,o.value]])],2))}},Ji=V(Gi,[["__scopeId","data-v-eda3ced5"]]),Ki=["value"],Yi={__name:"HordeSelector",props:{project:{type:Object,required:!0},sessions:{type:Array,default:()=>[]}},setup(s){const t=s,m=pe(),i=L("");te(()=>m.currentRoute.value,v=>{!i.value&&v.name==="horde"&&v.params.overseerId&&v.params.legionId===t.project.project_id&&(i.value=v.params.overseerId)},{immediate:!0});const o=c(()=>t.sessions.filter(v=>v.is_overseer===!0)),n=c(()=>{const v=m.currentRoute.value;return v.name==="horde"&&v.params.legionId===t.project.project_id});function p(v){return{created:"â—‹",starting:"â—",active:"â—",paused:"â¸",terminating:"â—",terminated:"âœ—",error:"âš "}[v.state]||"â—‹"}function g(){i.value&&m.push(`/horde/${t.project.project_id}/${i.value}`)}function u(){i.value&&m.push(`/horde/${t.project.project_id}/${i.value}`)}return(v,_)=>(l(),r("div",{class:B(["list-group-item list-group-item-action p-2",{active:n.value}])},[e("div",{class:"d-flex align-items-center justify-content-between mb-2",style:me({cursor:i.value?"pointer":"default"}),onClick:g},[..._[1]||(_[1]=[e("div",{class:"d-flex align-items-center"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸŒ³"),e("span",{class:"fw-semibold"},"Horde"),e("small",{class:"text-muted ms-2"},"(Minion Hierarchy)")],-1)])],4),Y(e("select",{"onUpdate:modelValue":_[0]||(_[0]=w=>i.value=w),class:"form-select form-select-sm",onChange:u},[_[2]||(_[2]=e("option",{value:""},"-- Select Overseer --",-1)),(l(!0),r(Z,null,ee(o.value,w=>(l(),r("option",{key:w.session_id,value:w.session_id},f(p(w))+" "+f(w.name),9,Ki))),128))],544),[[fe,i.value]])],2))}},Qi=V(Yi,[["__scopeId","data-v-ca33279d"]]),Zi=["data-project-id"],Xi=["id"],ec=["aria-expanded","aria-controls","onKeydown"],tc={class:"flex-grow-1 d-flex flex-column",style:{"min-width":"0"}},sc={class:"d-flex align-items-center mb-1",style:{gap:"0.5rem"}},oc={class:"fw-semibold",style:{"flex-shrink":"0"}},nc={key:0,class:"legion-icon",style:{"font-size":"1rem","margin-right":"0.25rem"}},lc={class:"d-flex gap-1 ms-auto",style:{"flex-shrink":"0"}},ac=["title"],rc=["title"],ic=["id","aria-labelledby"],cc={class:"accordion-body p-0"},uc={class:"list-group list-group-flush"},dc={__name:"ProjectItem",props:{project:{type:Object,required:!0}},setup(s){const t=s,m=pe(),i=le(),o=J(),n=se(),p=L(t.project.is_expanded||!1),g=c(()=>i.formatPath(t.project.working_directory)),u=c(()=>!t.project?.session_ids||t.project.session_ids.length===0?[]:t.project.session_ids.map(a=>o.getSession(a)).filter(a=>a!=null)),v=c(()=>{const a=m.currentRoute.value;return a.name==="timeline"&&a.params.legionId===t.project.project_id});function _(a){const O=window.bootstrap;if(!O)return;const q=document.getElementById(`collapse-${t.project.project_id}`);if(!q)return;O.Collapse.getOrCreateInstance(q).toggle()}function w(){p.value||(i.toggleExpansion(t.project.project_id),p.value=!0)}function $(){if(p.value){i.toggleExpansion(t.project.project_id),p.value=!1;const a=o.currentSessionId;a&&o.getSession(a)&&t.project.session_ids?.includes(a)&&m.push("/"),i.currentProjectId===t.project.project_id&&m.push("/")}}function b(){n.showModal("edit-project",{project:t.project})}function j(){t.project.is_multi_agent?n.showModal("create-minion",{project:t.project}):n.showModal("create-session",{project:t.project})}function T(){m.push(`/timeline/${t.project.project_id}`)}function S(a){a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("application/project-id",t.project.project_id),a.dataTransfer.setData("text/plain",t.project.project_id),a.target.classList.add("dragging")}function y(a){a.target.classList.remove("dragging")}function C(a){a.preventDefault(),a.dataTransfer.dropEffect="move";const O=a.currentTarget.getBoundingClientRect(),q=O.top+O.height/2;a.clientY<q?(a.currentTarget.classList.add("drop-above"),a.currentTarget.classList.remove("drop-below")):(a.currentTarget.classList.add("drop-below"),a.currentTarget.classList.remove("drop-above"))}function h(a){a.preventDefault(),a.currentTarget.classList.remove("drop-above","drop-below");const O=a.dataTransfer.getData("application/project-id")||a.dataTransfer.getData("text/plain");if(!O||O===t.project.project_id)return;const q=a.currentTarget.getBoundingClientRect(),k=q.top+q.height/2,P=a.clientY<k,H=i.orderedProjects,R=H.findIndex(x=>x.project_id===t.project.project_id),D=H.findIndex(x=>x.project_id===O);if(R===-1||D===-1)return;const d=[...H],[M]=d.splice(D,1);let A=P?R:R+1;D<R&&A--,d.splice(A,0,M);const N=d.map(x=>x.project_id);i.reorderProjects(N)}return(a,O)=>(l(),r("div",{class:"accordion-item border rounded mb-2","data-project-id":s.project.project_id,draggable:"true",onDragstart:S,onDragend:y,onDragover:C,onDrop:h},[e("h2",{class:"accordion-header",id:`heading-${s.project.project_id}`},[e("div",{class:B(["accordion-button bg-white p-2",{collapsed:!p.value}]),role:"button",tabindex:"0","aria-expanded":p.value,"aria-controls":`collapse-${s.project.project_id}`,onClick:_,onKeydown:[Se(re(_,["prevent"]),["enter"]),Se(re(_,["prevent"]),["space"])]},[e("div",tc,[e("div",sc,[e("div",oc,[s.project.is_multi_agent?(l(),r("span",nc,"ðŸ›")):E("",!0),G(" "+f(s.project.name),1)]),e("div",lc,[e("button",{class:"btn btn-sm btn-outline-secondary",title:"Edit or delete project",type:"button",onClick:re(b,["stop"])}," âœï¸ "),e("button",{class:"btn btn-sm btn-outline-primary",title:s.project.is_multi_agent?"Create minion":"Add session to project",type:"button",onClick:re(j,["stop"])}," âž• ",8,ac)])]),e("small",{class:"text-muted font-monospace",title:s.project.working_directory,style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},f(g.value),9,rc)])],42,ec)],8,Xi),Q(Wi,{project:s.project,sessions:u.value},null,8,["project","sessions"]),e("div",{id:`collapse-${s.project.project_id}`,class:B(["accordion-collapse collapse",{show:p.value}]),"aria-labelledby":`heading-${s.project.project_id}`,onShown:w,onHidden:$},[e("div",cc,[e("div",uc,[s.project.is_multi_agent?(l(),r("div",{key:0,class:B(["list-group-item list-group-item-action timeline-item d-flex align-items-center p-2",{active:v.value}]),style:{cursor:"pointer"},onClick:T},[...O[0]||(O[0]=[e("div",{class:"flex-grow-1"},[e("span",{style:{"font-size":"1rem","margin-right":"0.5rem"}},"ðŸ“Š"),e("span",{class:"fw-semibold"},"Timeline"),e("small",{class:"text-muted ms-2"},"(Legion Comms)")],-1)])],2)):E("",!0),s.project.is_multi_agent?(l(),r(Z,{key:1},[Q(Ji,{project:s.project,sessions:u.value},null,8,["project","sessions"]),Q(Qi,{project:s.project,sessions:u.value},null,8,["project","sessions"])],64)):(l(!0),r(Z,{key:2},ee(u.value,q=>(l(),ue(Vi,{key:q.session_id,session:q,"project-id":s.project.project_id},null,8,["session","project-id"]))),128))])])],42,ic)],40,Zi))}},mc=V(dc,[["__scopeId","data-v-f7cce2fb"]]),pc={class:"project-list"},vc={key:0,class:"text-muted text-center py-3"},fc={__name:"ProjectList",setup(s){const t=le(),m=c(()=>t.orderedProjects);return(i,o)=>(l(),r("div",pc,[m.value.length===0?(l(),r("div",vc,' No projects yet. Click "New" to create one. ')):E("",!0),(l(!0),r(Z,null,ee(m.value,n=>(l(),ue(mc,{key:n.project_id,project:n},null,8,["project"]))),128))]))}},gc={class:"flex-grow-1 overflow-auto p-3"},_c={id:"sessions-container"},bc={__name:"Sidebar",setup(s){const t=se(),m=c(()=>t.sidebarCollapsed),i=c(()=>t.isMobile),o=c(()=>{if(i.value)return{};const _=`${t.sidebarWidth}px`;return{width:_,minWidth:"200px",maxWidth:"30vw","--sidebar-width":_}});function n(){t.showModal("create-project")}const p=L(!1);function g(_){p.value=!0,document.addEventListener("mousemove",u),document.addEventListener("mouseup",v)}function u(_){p.value&&t.setSidebarWidth(_.clientX)}function v(){p.value=!1,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",v)}return(_,w)=>(l(),r("aside",{id:"sidebar",class:B(["col-auto bg-light border-end d-flex flex-column overflow-auto",{collapsed:m.value,"mobile-open":!m.value&&i.value,"desktop-collapsed":m.value&&!i.value}]),style:me(o.value)},[e("div",gc,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[w[0]||(w[0]=e("h6",{class:"text-muted mb-0"},"Projects",-1)),e("button",{id:"create-project-btn",class:"btn btn-sm btn-outline-primary",title:"New Project",onClick:n}," ðŸ“ New ")]),e("div",_c,[Q(fc)])]),e("div",{class:"sidebar-resize-handle",onMousedown:g},null,32)],6))}},hc=V(bc,[["__scopeId","data-v-d792f0f0"]]),yc={class:"modal-dialog modal-lg"},$c={class:"modal-content"},wc={class:"modal-body"},Sc={class:"mb-3"},kc={class:"input-group"},Cc=["disabled"],xc={key:0,class:"text-center py-4"},Mc={key:1,class:"alert alert-danger",role:"alert"},jc={key:2,class:"folder-list"},Tc=["onClick","onDblclick"],Ec={class:"d-flex align-items-center flex-grow-1"},Pc=["onClick"],Lc={key:1,class:"text-center text-muted py-3"},Ic={class:"modal-footer"},Dc=["disabled"],Oc={__name:"FolderBrowserModal",setup(s){const t=se(),m=L(""),i=L(""),o=L([]),n=L(!1),p=L(""),g=L(null);let u=null,v=null;const _=c(()=>{if(!m.value)return null;const h=m.value.split(/[\\/]/).filter(Boolean);return h.length<=1?null:(h.pop(),h.length>0?h.join("/"):"/")});function w(h){if(!h)return"";const a=h.split(/[\\/]/).filter(Boolean);return a.length<=2?h:".../"+a.slice(-2).join("/")}async function $(){n.value=!0,p.value="",o.value=[],i.value="";try{const h=m.value?{path:m.value}:{},a=await K.get("/api/filesystem/browse",{params:h});a.current_path&&(m.value=a.current_path),o.value=a.directories||[]}catch(h){console.error("Failed to load directory:",h),p.value=h.message||"Failed to load directory"}finally{n.value=!1}}function b(h){i.value=h.path}function j(h){m.value=h.path,i.value="",$()}function T(){_.value&&(m.value=_.value,i.value="",$())}function S(){const h=i.value||m.value;h&&v&&v(h),u&&u.hide()}function y(){$()}function C(){o.value=[],i.value="",p.value="",v=null,t.hideModal()}return te(()=>t.currentModal,h=>{if(h?.name==="folder-browser"&&u){const a=h.data||{};m.value=a.currentPath||"",v=a.onSelect||null,u.show()}}),ie(()=>{g.value&&ae(async()=>{const{default:h}=await import("./modal-B4rHLo2F.js").then(a=>a.m);return{default:h}},__vite__mapDeps([0,1])).then(({default:h})=>{u=new h(g.value),g.value.addEventListener("shown.bs.modal",y),g.value.addEventListener("hidden.bs.modal",C)})}),ce(()=>{g.value&&(g.value.removeEventListener("shown.bs.modal",y),g.value.removeEventListener("hidden.bs.modal",C)),u&&u.dispose()}),(h,a)=>(l(),r("div",{class:"modal fade folder-browser-modal",id:"folderBrowserModal",tabindex:"-1","aria-labelledby":"folderBrowserModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:g},[e("div",yc,[e("div",$c,[a[7]||(a[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"folderBrowserModalLabel"},"Browse Folders"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",wc,[e("div",Sc,[a[2]||(a[2]=e("label",{class:"form-label"},"Current Path:",-1)),e("div",kc,[Y(e("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=O=>m.value=O),onKeyup:Se($,["enter"]),placeholder:"Enter or select a directory path"},null,544),[[ne,m.value]]),e("button",{class:"btn btn-outline-secondary",onClick:$,disabled:n.value},[...a[1]||(a[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),G(" Refresh ",-1)])],8,Cc)])]),n.value?(l(),r("div",xc,[...a[3]||(a[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):p.value?(l(),r("div",Mc,f(p.value),1)):(l(),r("div",jc,[_.value?(l(),r("div",{key:0,class:"folder-item d-flex align-items-center p-2 border-bottom",onClick:T,role:"button"},[...a[4]||(a[4]=[e("i",{class:"bi bi-arrow-up-circle me-2 text-secondary"},null,-1),e("span",{class:"text-secondary"},"..",-1)])])):E("",!0),(l(!0),r(Z,null,ee(o.value,O=>(l(),r("div",{key:O.path,class:B(["folder-item d-flex align-items-center justify-content-between p-2 border-bottom",{selected:O.path===i.value}]),onClick:q=>b(O),onDblclick:q=>j(O),role:"button"},[e("div",Ec,[a[5]||(a[5]=e("i",{class:"bi bi-folder-fill me-2 text-warning"},null,-1)),e("span",null,f(O.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:re(q=>j(O),["stop"])}," Open ",8,Pc)],42,Tc))),128)),o.value.length===0?(l(),r("div",Lc," No subdirectories found ")):E("",!0)]))]),e("div",Ic,[a[6]||(a[6]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:S,disabled:!i.value},' Select "'+f(w(i.value||m.value))+'" ',9,Dc)])])])],512))}},Nc=V(Oc,[["__scopeId","data-v-667c51a9"]]),Ac={class:"modal-dialog"},Rc={class:"modal-content"},qc={class:"modal-body"},Uc={class:"mb-3"},Wc={key:0,class:"invalid-feedback"},Hc={class:"mb-3"},Fc={class:"input-group"},Bc={key:0,class:"invalid-feedback"},Vc={class:"mb-3 form-check"},zc={class:"mb-3 form-check"},Gc={class:"form-check-label",for:"createSession"},Jc={key:0,class:"mb-3 ms-4"},Kc={for:"sessionName",class:"form-label"},Yc={key:1,class:"alert alert-danger",role:"alert"},Qc={class:"modal-footer"},Zc=["disabled"],Xc={key:0,class:"spinner-border spinner-border-sm me-2"},eu={__name:"ProjectCreateModal",setup(s){const t=le(),m=J(),i=se(),o=L({name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"}),n=L({name:"",workingDirectory:""}),p=L(!1),g=L(""),u=L(null);let v=null;function _(){i.showModal("folder-browser",{currentPath:o.value.workingDirectory||"",onSelect:S=>{o.value.workingDirectory=S,n.value.workingDirectory=""}})}function w(){n.value={};let S=!0;return o.value.name.trim()||(n.value.name="Project name is required",S=!1),o.value.workingDirectory.trim()||(n.value.workingDirectory="Working directory is required",S=!1),S}async function $(){if(w()){p.value=!0,g.value="";try{const S=await t.createProject(o.value.name,o.value.workingDirectory,o.value.isMultiAgent);o.value.createSession&&await m.createSession(S.project_id,{name:o.value.sessionName||"main",permission_mode:"default",tools:[],model:"claude-sonnet-4-5-20250929"}),v&&v.hide(),b()}catch(S){console.error("Failed to create project:",S),g.value=S.message||"Failed to create project. Please try again."}finally{p.value=!1}}}function b(){o.value={name:"",workingDirectory:"",isMultiAgent:!1,createSession:!0,sessionName:"main"},n.value={},g.value=""}function j(){const S=document.getElementById("projectName");S&&S.focus()}function T(){b(),i.hideModal()}return te(()=>i.currentModal,S=>{S?.name==="create-project"&&v&&v.show()}),ie(()=>{u.value&&ae(async()=>{const{default:S}=await import("./modal-B4rHLo2F.js").then(y=>y.m);return{default:S}},__vite__mapDeps([0,1])).then(({default:S})=>{v=new S(u.value),u.value.addEventListener("shown.bs.modal",j),u.value.addEventListener("hidden.bs.modal",T)})}),ce(()=>{u.value&&(u.value.removeEventListener("shown.bs.modal",j),u.value.removeEventListener("hidden.bs.modal",T)),v&&v.dispose()}),(S,y)=>(l(),r("div",{class:"modal fade",id:"createProjectModal",tabindex:"-1","aria-labelledby":"createProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:u},[e("div",Ac,[e("div",Rc,[y[11]||(y[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"createProjectModalLabel"},"Create New Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",qc,[e("form",{onSubmit:re($,["prevent"])},[e("div",Uc,[y[5]||(y[5]=e("label",{for:"projectName",class:"form-label"},"Project Name",-1)),Y(e("input",{type:"text",class:B(["form-control",{"is-invalid":n.value.name}]),id:"projectName","onUpdate:modelValue":y[0]||(y[0]=C=>o.value.name=C),placeholder:"My Project",required:""},null,2),[[ne,o.value.name]]),n.value.name?(l(),r("div",Wc,f(n.value.name),1)):E("",!0)]),e("div",Hc,[y[6]||(y[6]=e("label",{for:"workingDirectory",class:"form-label"},"Working Directory",-1)),e("div",Fc,[Y(e("input",{type:"text",class:B(["form-control",{"is-invalid":n.value.workingDirectory}]),id:"workingDirectory","onUpdate:modelValue":y[1]||(y[1]=C=>o.value.workingDirectory=C),placeholder:"/path/to/project",required:""},null,2),[[ne,o.value.workingDirectory]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:_}," Browse... "),n.value.workingDirectory?(l(),r("div",Bc,f(n.value.workingDirectory),1)):E("",!0)]),y[7]||(y[7]=e("div",{class:"form-text"}," The project's working directory (cannot be changed after creation) ",-1))]),e("div",Vc,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"isMultiAgent","onUpdate:modelValue":y[2]||(y[2]=C=>o.value.isMultiAgent=C)},null,512),[[be,o.value.isMultiAgent]]),y[8]||(y[8]=e("label",{class:"form-check-label",for:"isMultiAgent"}," ðŸ› Multi-Agent Project (Legion) ",-1)),y[9]||(y[9]=e("div",{class:"form-text"}," Legion projects support hierarchical multi-agent coordination ",-1))]),e("div",zc,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"createSession","onUpdate:modelValue":y[3]||(y[3]=C=>o.value.createSession=C)},null,512),[[be,o.value.createSession]]),e("label",Gc," Create initial "+f(o.value.isMultiAgent?"minion":"session"),1)]),o.value.createSession?(l(),r("div",Jc,[e("label",Kc," Initial "+f(o.value.isMultiAgent?"Minion":"Session")+" Name ",1),Y(e("input",{type:"text",class:"form-control",id:"sessionName","onUpdate:modelValue":y[4]||(y[4]=C=>o.value.sessionName=C),placeholder:"main"},null,512),[[ne,o.value.sessionName]])])):E("",!0),g.value?(l(),r("div",Yc,f(g.value),1)):E("",!0)],32)]),e("div",Qc,[y[10]||(y[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:$,disabled:p.value},[p.value?(l(),r("span",Xc)):E("",!0),G(" "+f(p.value?"Creating...":"Create Project"),1)],8,Zc)])])])],512))}},tu=V(eu,[["__scopeId","data-v-adf50394"]]),su={class:"modal-dialog"},ou={class:"modal-content"},nu={class:"modal-body"},lu={class:"mb-3"},au={key:0,class:"invalid-feedback"},ru={class:"mb-3"},iu=["value"],cu={key:0,class:"alert alert-danger",role:"alert"},uu={class:"danger-zone"},du={class:"text-muted small"},mu=["disabled"],pu={key:0,class:"alert alert-warning mt-3",role:"alert"},vu={class:"mb-2"},fu={class:"d-flex gap-2"},gu=["disabled"],_u={key:0,class:"spinner-border spinner-border-sm me-2"},bu=["disabled"],hu={class:"modal-footer"},yu=["disabled"],$u={key:0,class:"spinner-border spinner-border-sm me-2"},wu={__name:"ProjectEditModal",setup(s){const t=le(),m=se(),i=L(null),o=L({name:""}),n=L({name:""}),p=L(!1),g=L(!1),u=L(""),v=L(!1),_=L(null);let w=null;const $=c(()=>i.value?.session_ids?.length||0);function b(){n.value={};let h=!0;return o.value.name.trim()||(n.value.name="Project name is required",h=!1),h}async function j(){if(!(!b()||!i.value)){p.value=!0,u.value="";try{await t.updateProject(i.value.project_id,{name:o.value.name}),w&&w.hide()}catch(h){console.error("Failed to update project:",h),u.value=h.message||"Failed to update project. Please try again."}finally{p.value=!1}}}async function T(){if(i.value){g.value=!0,u.value="";try{await t.deleteProject(i.value.project_id),w&&w.hide()}catch(h){console.error("Failed to delete project:",h),u.value=h.message||"Failed to delete project. Please try again."}finally{g.value=!1}}}function S(){o.value={name:""},n.value={},u.value="",v.value=!1}function y(){const h=document.getElementById("editProjectName");h&&(h.focus(),h.select())}function C(){S(),i.value=null,m.hideModal()}return te(()=>m.currentModal,h=>{if(h?.name==="edit-project"&&w){const a=h.data||{};i.value=a.project,i.value&&(o.value.name=i.value.name),w.show()}}),ie(()=>{_.value&&ae(async()=>{const{default:h}=await import("./modal-B4rHLo2F.js").then(a=>a.m);return{default:h}},__vite__mapDeps([0,1])).then(({default:h})=>{w=new h(_.value),_.value.addEventListener("shown.bs.modal",y),_.value.addEventListener("hidden.bs.modal",C)})}),ce(()=>{_.value&&(_.value.removeEventListener("shown.bs.modal",y),_.value.removeEventListener("hidden.bs.modal",C)),w&&w.dispose()}),(h,a)=>(l(),r("div",{class:"modal fade",id:"editProjectModal",tabindex:"-1","aria-labelledby":"editProjectModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:_},[e("div",su,[e("div",ou,[a[11]||(a[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editProjectModalLabel"},"Edit Project"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",nu,[e("form",{onSubmit:re(j,["prevent"])},[e("div",lu,[a[3]||(a[3]=e("label",{for:"editProjectName",class:"form-label"},"Project Name",-1)),Y(e("input",{type:"text",class:B(["form-control",{"is-invalid":n.value.name}]),id:"editProjectName","onUpdate:modelValue":a[0]||(a[0]=O=>o.value.name=O),placeholder:"My Project",required:""},null,2),[[ne,o.value.name]]),n.value.name?(l(),r("div",au,f(n.value.name),1)):E("",!0)]),e("div",ru,[a[4]||(a[4]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:i.value?.working_directory,disabled:"",readonly:""},null,8,iu),a[5]||(a[5]=e("div",{class:"form-text text-muted"}," Working directory cannot be changed after creation ",-1))]),u.value?(l(),r("div",cu,f(u.value),1)):E("",!0)],32),a[9]||(a[9]=e("hr",null,null,-1)),e("div",uu,[a[7]||(a[7]=e("h6",{class:"text-danger"},"Danger Zone",-1)),e("p",du," Deleting this project will also delete all "+f($.value)+" session(s) and their data. This action cannot be undone. ",1),e("button",{type:"button",class:"btn btn-outline-danger",onClick:a[1]||(a[1]=O=>v.value=!0),disabled:g.value},[...a[6]||(a[6]=[e("i",{class:"bi bi-trash"},null,-1),G(" Delete Project ",-1)])],8,mu)]),v.value?(l(),r("div",pu,[a[8]||(a[8]=e("strong",null,"Are you sure?",-1)),e("p",vu,' This will permanently delete the project "'+f(i.value?.name)+'" and all '+f($.value)+" session(s). ",1),e("div",fu,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:T,disabled:g.value},[g.value?(l(),r("span",_u)):E("",!0),G(" "+f(g.value?"Deleting...":"Yes, Delete Permanently"),1)],8,gu),e("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:a[2]||(a[2]=O=>v.value=!1),disabled:g.value}," Cancel ",8,bu)])])):E("",!0)]),e("div",hu,[a[10]||(a[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:j,disabled:p.value},[p.value?(l(),r("span",$u)):E("",!0),G(" "+f(p.value?"Saving...":"Save Changes"),1)],8,yu)])])])],512))}},Su=V(wu,[["__scopeId","data-v-6f299f35"]]),ku={class:"modal-dialog modal-lg"},Cu={class:"modal-content"},xu={class:"modal-header"},Mu={class:"modal-title",id:"createSessionModalLabel"},ju={key:0,class:"text-muted small"},Tu={class:"modal-body"},Eu={class:"mb-3"},Pu={key:0,class:"invalid-feedback"},Lu={class:"mb-3"},Iu={class:"mb-3"},Du={class:"mb-3"},Ou={class:"form-text d-flex justify-content-between"},Nu={key:0,class:"invalid-feedback"},Au={class:"mb-3 form-check"},Ru={key:0,class:"form-text text-warning"},qu={class:"mb-3"},Uu={class:"mb-3 form-check"},Wu={key:0,class:"alert alert-danger",role:"alert"},Hu={class:"modal-footer"},Fu=["disabled"],Bu={key:0,class:"spinner-border spinner-border-sm me-2"},Vu={__name:"SessionCreateModal",setup(s){const t=pe();le();const m=J(),i=se(),o=L(null),n=L({name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0}),p=L({name:""}),g=L(!1),u=L(""),v=L(null);let _=null;const w=c(()=>n.value.system_prompt.length),$=c(()=>w.value>6e3),b=c(()=>w.value>5500&&w.value<=6e3);function j(){p.value={};let h=!0;return n.value.name.trim()||(p.value.name="Session name is required",h=!1),$.value&&(h=!1),h}async function T(){if(!(!j()||!o.value)){g.value=!0,u.value="";try{const h=n.value.tools.split(",").map(q=>q.trim()).filter(q=>q.length>0),a={name:n.value.name,permission_mode:n.value.permission_mode,model:n.value.model,system_prompt:n.value.system_prompt.trim()||null,override_system_prompt:n.value.override_system_prompt,tools:h},O=await m.createSession(o.value.project_id,a);n.value.startImmediately&&await m.startSession(O.session_id),t.push(`/session/${O.session_id}`),_&&_.hide(),S()}catch(h){console.error("Failed to create session:",h),u.value=h.message||"Failed to create session. Please try again."}finally{g.value=!1}}}function S(){n.value={name:"",permission_mode:"default",model:"claude-sonnet-4-5-20250929",system_prompt:"",override_system_prompt:!1,tools:"",startImmediately:!0},p.value={},u.value=""}function y(){const h=document.getElementById("sessionName");h&&h.focus()}function C(){S(),o.value=null,i.hideModal()}return te(()=>i.currentModal,h=>{if(h?.name==="create-session"&&_){const a=h.data||{};o.value=a.project,_.show()}}),ie(()=>{v.value&&ae(async()=>{const{default:h}=await import("./modal-B4rHLo2F.js").then(a=>a.m);return{default:h}},__vite__mapDeps([0,1])).then(({default:h})=>{_=new h(v.value),v.value.addEventListener("shown.bs.modal",y),v.value.addEventListener("hidden.bs.modal",C)})}),ce(()=>{v.value&&(v.value.removeEventListener("shown.bs.modal",y),v.value.removeEventListener("hidden.bs.modal",C)),_&&_.dispose()}),(h,a)=>(l(),r("div",{class:"modal fade",id:"createSessionModal",tabindex:"-1","aria-labelledby":"createSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",ku,[e("div",Cu,[e("div",xu,[e("h5",Mu,[a[7]||(a[7]=G(" Create New Session ",-1)),o.value?(l(),r("span",ju,"in "+f(o.value.name),1)):E("",!0)]),a[8]||(a[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Tu,[e("form",{onSubmit:re(T,["prevent"])},[e("div",Eu,[a[9]||(a[9]=e("label",{for:"sessionName",class:"form-label"},"Session Name",-1)),Y(e("input",{type:"text",class:B(["form-control",{"is-invalid":p.value.name}]),id:"sessionName","onUpdate:modelValue":a[0]||(a[0]=O=>n.value.name=O),placeholder:"main",required:""},null,2),[[ne,n.value.name]]),p.value.name?(l(),r("div",Pu,f(p.value.name),1)):E("",!0)]),e("div",Lu,[a[11]||(a[11]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Y(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":a[1]||(a[1]=O=>n.value.permission_mode=O)},[...a[10]||(a[10]=[e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1),e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1),e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1),e("option",{value:"bypassPermissions"},"âš ï¸ Bypass Permissions (No prompts - use with caution)",-1)])],512),[[fe,n.value.permission_mode]]),a[12]||(a[12]=e("div",{class:"form-text"}," Controls which tool actions require permission prompts ",-1))]),e("div",Iu,[a[14]||(a[14]=e("label",{for:"model",class:"form-label"},"Model",-1)),Y(e("select",{class:"form-select",id:"model","onUpdate:modelValue":a[2]||(a[2]=O=>n.value.model=O)},[...a[13]||(a[13]=[e("option",{value:"claude-sonnet-4-5-20250929"},"Claude Sonnet 4.5 (Default)",-1),e("option",{value:"claude-sonnet-3-7-20250219"},"Claude Sonnet 3.7",-1),e("option",{value:"claude-opus-4-20250514"},"Claude Opus 4",-1)])],512),[[fe,n.value.model]])]),e("div",Du,[a[15]||(a[15]=e("label",{for:"systemPrompt",class:"form-label"},"Additional Instructions (Optional)",-1)),Y(e("textarea",{class:B(["form-control",{"is-invalid":$.value}]),id:"systemPrompt","onUpdate:modelValue":a[3]||(a[3]=O=>n.value.system_prompt=O),rows:"3",maxlength:6e3,placeholder:"Additional instructions to append to the system prompt..."},null,2),[[ne,n.value.system_prompt]]),e("div",Ou,[e("span",null,f(n.value.override_system_prompt?"These instructions will replace Claude Code's default system prompt":"These instructions will be appended to Claude Code's default system prompt"),1),e("span",{class:B({"text-danger":$.value,"text-warning":b.value})},f(w.value)+" / 6000 chars ",3)]),$.value?(l(),r("div",Nu," System prompt exceeds 6000 character limit (Windows command-line constraint) ")):E("",!0)]),e("div",Au,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":a[4]||(a[4]=O=>n.value.override_system_prompt=O)},null,512),[[be,n.value.override_system_prompt]]),a[17]||(a[17]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom prompt only) ",-1)),n.value.override_system_prompt?(l(),r("div",Ru,[...a[16]||(a[16]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom instructions will be used (no Claude Code preset).",-1)])])):E("",!0)]),e("div",qu,[a[18]||(a[18]=e("label",{for:"tools",class:"form-label"},"Allowed Tools (Optional)",-1)),Y(e("input",{type:"text",class:"form-control",id:"tools","onUpdate:modelValue":a[5]||(a[5]=O=>n.value.tools=O),placeholder:"bash, read, edit, write, glob, grep, webfetch, websearch, task, todo"},null,512),[[ne,n.value.tools]]),a[19]||(a[19]=e("div",{class:"form-text"}," Comma-separated list of allowed tools. Leave empty to allow all tools. ",-1))]),e("div",Uu,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"startImmediately","onUpdate:modelValue":a[6]||(a[6]=O=>n.value.startImmediately=O)},null,512),[[be,n.value.startImmediately]]),a[20]||(a[20]=e("label",{class:"form-check-label",for:"startImmediately"}," Start session immediately after creation ",-1))]),u.value?(l(),r("div",Wu,f(u.value),1)):E("",!0)],32)]),e("div",Hu,[a[21]||(a[21]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:T,disabled:g.value},[g.value?(l(),r("span",Bu)):E("",!0),G(" "+f(g.value?"Creating...":"Create Session"),1)],8,Fu)])])])],512))}},zu=V(Vu,[["__scopeId","data-v-5aef47e0"]]),Gu={class:"modal-dialog"},Ju={class:"modal-content"},Ku={class:"modal-body"},Yu={class:"mb-3"},Qu={key:0,class:"invalid-feedback"},Zu={class:"mb-3"},Xu=["value"],ed={class:"mb-3"},td={class:"form-control-plaintext"},sd={class:"mb-3"},od=["disabled"],nd={key:0,value:"bypassPermissions"},ld={class:"form-text"},ad={key:0,class:"text-warning"},rd={key:1},id={key:0,class:"mb-3"},cd={class:"card"},ud={class:"card-body"},dd={key:0,class:"mb-2"},md={key:1,class:"mb-2"},pd={key:2,class:"mt-2"},vd={class:"form-control",style:{height:"auto","min-height":"60px","white-space":"pre-wrap"},readonly:""},fd={key:1,class:"alert alert-danger",role:"alert"},gd={class:"modal-footer"},_d=["disabled"],bd={key:0,class:"spinner-border spinner-border-sm me-2"},hd={__name:"SessionEditModal",setup(s){const t=J(),m=se(),i=L(null),o=L({name:"",permission_mode:"default"}),n=L({name:""}),p=L(!1),g=L(""),u=L(null);let v=null;const _=c(()=>i.value?.state==="active"||i.value?.state==="starting"),w=c(()=>i.value?.initial_permission_mode==="bypassPermissions");function $(C){return{created:"bg-secondary",starting:"bg-info",active:"bg-success",paused:"bg-warning",terminating:"bg-warning",terminated:"bg-secondary",error:"bg-danger"}[C]||"bg-secondary"}function b(){n.value={};let C=!0;return o.value.name.trim()||(n.value.name="Session name is required",C=!1),C}async function j(){if(!(!b()||!i.value)){p.value=!0,g.value="";try{await t.updateSessionName(i.value.session_id,o.value.name),o.value.permission_mode!==i.value.current_permission_mode&&await t.setPermissionMode(i.value.session_id,o.value.permission_mode),v&&v.hide()}catch(C){console.error("Failed to update session:",C),g.value=C.message||"Failed to update session. Please try again."}finally{p.value=!1}}}function T(){o.value={name:"",permission_mode:"default"},n.value={},g.value=""}function S(){const C=document.getElementById("editSessionName");C&&(C.focus(),C.select())}function y(){T(),i.value=null,m.hideModal()}return te(()=>m.currentModal,C=>{if(C?.name==="edit-session"&&v){const h=C.data||{};i.value=h.session,i.value&&(o.value.name=i.value.name,o.value.permission_mode=i.value.current_permission_mode||"default"),v.show()}}),ie(()=>{u.value&&ae(async()=>{const{default:C}=await import("./modal-B4rHLo2F.js").then(h=>h.m);return{default:C}},__vite__mapDeps([0,1])).then(({default:C})=>{v=new C(u.value),u.value.addEventListener("shown.bs.modal",S),u.value.addEventListener("hidden.bs.modal",y)})}),ce(()=>{u.value&&(u.value.removeEventListener("shown.bs.modal",S),u.value.removeEventListener("hidden.bs.modal",y)),v&&v.dispose()}),(C,h)=>(l(),r("div",{class:"modal fade",id:"editSessionModal",tabindex:"-1","aria-labelledby":"editSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:u},[e("div",Gu,[e("div",Ju,[h[15]||(h[15]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"editSessionModalLabel"},"Edit Session"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Ku,[e("form",{onSubmit:re(j,["prevent"])},[e("div",Yu,[h[2]||(h[2]=e("label",{for:"editSessionName",class:"form-label"},"Session Name",-1)),Y(e("input",{type:"text",class:B(["form-control",{"is-invalid":n.value.name}]),id:"editSessionName","onUpdate:modelValue":h[0]||(h[0]=a=>o.value.name=a),placeholder:"Session Name",required:""},null,2),[[ne,o.value.name]]),n.value.name?(l(),r("div",Qu,f(n.value.name),1)):E("",!0)]),e("div",Zu,[h[3]||(h[3]=e("label",{class:"form-label"},"Working Directory",-1)),e("input",{type:"text",class:"form-control",value:i.value?.working_directory,disabled:"",readonly:""},null,8,Xu),h[4]||(h[4]=e("div",{class:"form-text text-muted"}," Working directory is inherited from project ",-1))]),e("div",ed,[h[5]||(h[5]=e("label",{class:"form-label"},"Current State",-1)),e("div",td,[e("span",{class:B(["badge",$(i.value?.state)])},f(i.value?.state),3)])]),e("div",sd,[h[9]||(h[9]=e("label",{for:"permissionMode",class:"form-label"},"Permission Mode",-1)),Y(e("select",{class:"form-select",id:"permissionMode","onUpdate:modelValue":h[1]||(h[1]=a=>o.value.permission_mode=a),disabled:!_.value},[h[6]||(h[6]=e("option",{value:"default"},"Default (Prompt for tools not in settings)",-1)),h[7]||(h[7]=e("option",{value:"acceptEdits"},"Accept Edits (Auto-approve Edit/Write)",-1)),h[8]||(h[8]=e("option",{value:"plan"},"Plan Mode (Auto-resets after ExitPlanMode)",-1)),w.value?(l(),r("option",nd,"âš ï¸ Bypass Permissions (No prompts)")):E("",!0)],8,od),[[fe,o.value.permission_mode]]),e("div",ld,[_.value?(l(),r("span",rd," Controls which tool actions require permission prompts ")):(l(),r("span",ad," âš ï¸ Session must be active to change permission mode. Start the session first. "))])]),i.value?.system_prompt||i.value?.override_system_prompt?(l(),r("div",id,[h[13]||(h[13]=e("label",{class:"form-label"},"System Prompt Configuration",-1)),e("div",cd,[e("div",ud,[i.value?.override_system_prompt?(l(),r("div",dd,[...h[10]||(h[10]=[e("span",{class:"badge bg-warning text-dark"},"Override Mode",-1),e("div",{class:"form-text text-warning mt-1"}," Using custom prompt only (no Claude Code preset) ",-1)])])):(l(),r("div",md,[...h[11]||(h[11]=[e("span",{class:"badge bg-info"},"Append Mode",-1),e("div",{class:"form-text mt-1"}," Custom instructions appended to Claude Code preset ",-1)])])),i.value?.system_prompt?(l(),r("div",pd,[h[12]||(h[12]=e("strong",{class:"small"},"Custom Instructions:",-1)),e("div",vd,f(i.value.system_prompt),1)])):E("",!0)])])])):E("",!0),g.value?(l(),r("div",fd,f(g.value),1)):E("",!0)],32)]),e("div",gd,[h[14]||(h[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:j,disabled:p.value},[p.value?(l(),r("span",bd)):E("",!0),G(" "+f(p.value?"Saving...":"Save Changes"),1)],8,_d)])])])],512))}},yd=V(hd,[["__scopeId","data-v-c99ca17f"]]),$d={class:"modal-dialog modal-dialog-centered"},wd={class:"modal-content"},Sd={class:"modal-header"},kd={class:"modal-title",id:"manageSessionModalLabel"},Cd={class:"modal-body"},xd={key:0,class:"text-center py-4"},Md={class:"text-muted"},jd={key:1},Td={key:2},Ed={class:"text-muted"},Pd={key:3},Ld={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Id={class:"d-grid gap-2"},Dd=["disabled"],Od=["disabled"],Nd=["disabled"],Ad=["disabled"],Rd={class:"modal-footer"},qd={key:1,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Ud={__name:"SessionManageModal",setup(s){const t=pe(),m=J(),i=se(),o=ge();de();const n=L(null),p=L(!1),g=L(""),u=L(""),v=L(null),_=L(null);let w=null;const $=c(()=>v.value==="reset"?"Reset Session":v.value==="delete"?"Delete Session":"Manage Session");function b(){v.value="reset"}function j(){v.value="delete"}function T(){v.value=null}async function S(){v.value==="reset"?await h():v.value==="delete"&&await a()}async function y(){if(n.value){p.value=!0,g.value="Restarting session...";try{const k=n.value.session_id,P=await K.post(`/api/sessions/${k}/restart`);if(P.success)console.log("Session restarted successfully, reconnecting"),await o.disconnectSession(),m.currentSessionId=null,await m.selectSession(k),w&&w.hide();else{const H=P.error||P.detail||"Failed to restart session";console.error("Failed to restart session:",H),u.value=`Failed to restart session: ${H}`}}catch(k){console.error("Error restarting session:",k);const P=k.data?.detail||k.message||"Unknown error";u.value=`Error restarting session: ${P}`}finally{p.value=!1}}}async function C(){if(n.value)try{w&&w.hide(),console.log("Ending session",n.value.session_id);const k=n.value.session_id;await K.post(`/api/sessions/${k}/terminate`),await o.disconnectSession(),m.currentSessionId===k&&(m.currentSessionId=null),t.push("/")}catch(k){console.error("Error ending session:",k),await o.disconnectSession(),m.currentSessionId===n.value?.session_id&&(m.currentSessionId=null),t.push("/")}}async function h(){if(n.value){p.value=!0,g.value="Resetting session...";try{const k=n.value.session_id,P=await K.post(`/api/sessions/${k}/reset`);if(P.success)console.log("Session reset successfully, reconnecting"),await o.disconnectSession(),m.currentSessionId=null,await m.selectSession(k),w&&w.hide();else{const H=P.error||P.detail||"Failed to reset session";console.error("Failed to reset session:",H),u.value=`Failed to reset session: ${H}`,v.value=null}}catch(k){console.error("Error resetting session:",k);const P=k.data?.detail||k.message||"Unknown error";u.value=`Error resetting session: ${P}`,v.value=null}finally{p.value=!1}}}async function a(){if(n.value){p.value=!0,g.value="Deleting session...";try{const k=n.value.session_id;await m.deleteSession(k),t.currentRoute.value.params.sessionId===k&&t.push("/"),w&&w.hide()}catch(k){console.error("Error deleting session:",k);const P=k.data?.detail||k.message||"Unknown error";u.value=`Error deleting session: ${P}`,v.value=null}finally{p.value=!1}}}function O(){v.value=null,p.value=!1,g.value="",u.value=""}function q(){O(),n.value=null,i.hideModal()}return te(()=>i.currentModal,k=>{if(k?.name==="manage-session"&&w){const P=k.data||{};n.value=P.session,O(),w.show()}}),ie(()=>{_.value&&ae(async()=>{const{default:k}=await import("./modal-B4rHLo2F.js").then(P=>P.m);return{default:k}},__vite__mapDeps([0,1])).then(({default:k})=>{w=new k(_.value),_.value.addEventListener("hidden.bs.modal",q)})}),ce(()=>{_.value&&_.value.removeEventListener("hidden.bs.modal",q),w&&w.dispose()}),(k,P)=>(l(),r("div",{class:"modal fade",id:"manageSessionModal",tabindex:"-1","aria-labelledby":"manageSessionModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:_},[e("div",$d,[e("div",wd,[e("div",Sd,[e("h5",kd,f(v.value?$.value:"Manage Session"),1),P[1]||(P[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Cd,[p.value?(l(),r("div",xd,[P[2]||(P[2]=e("div",{class:"spinner-border text-primary mb-3",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),e("p",Md,f(g.value),1)])):v.value==="reset"?(l(),r("div",jd,[...P[3]||(P[3]=[e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1),e("p",{class:"text-muted"},"This will permanently delete all messages and conversation history for this session.",-1),e("p",{class:"text-muted"},"The session settings and configuration will be preserved, but you will start with a completely fresh conversation.",-1)])])):v.value==="delete"?(l(),r("div",Td,[P[6]||(P[6]=e("div",{class:"alert alert-danger mb-3"},[e("strong",null,"âš ï¸ Warning: This action cannot be undone")],-1)),e("p",Ed,[P[4]||(P[4]=G("This will permanently delete session ",-1)),e("strong",null,f(n.value?.name),1),P[5]||(P[5]=G(".",-1))]),P[7]||(P[7]=e("p",{class:"text-muted"},"All messages, conversation history, settings, and configuration will be completely destroyed. This is more destructive than Reset Session.",-1))])):(l(),r("div",Pd,[u.value?(l(),r("div",Ld,[P[8]||(P[8]=e("strong",null,"Error:",-1)),G(" "+f(u.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:P[0]||(P[0]=H=>u.value="")})])):E("",!0),P[15]||(P[15]=e("p",{class:"text-muted"},"Choose how to manage this session:",-1)),e("div",Id,[e("button",{class:"btn btn-outline-primary text-start",onClick:y,disabled:p.value},[...P[9]||(P[9]=[e("strong",null,"ðŸ”„ Restart Agent",-1),e("div",{class:"small text-muted"},"Disconnect and resume session (keeps all messages)",-1)])],8,Dd),e("button",{class:"btn btn-outline-secondary text-start",onClick:C,disabled:p.value},[...P[10]||(P[10]=[e("strong",null,"ðŸšª End Session",-1),e("div",{class:"small text-muted"},"Close agent and return to session list",-1)])],8,Od),P[13]||(P[13]=e("hr",{class:"my-2"},null,-1)),P[14]||(P[14]=e("div",{class:"danger-zone-header"},[e("h6",{class:"text-danger mb-2"},"âš ï¸ Danger Zone")],-1)),e("button",{class:"btn btn-outline-warning text-start",onClick:b,disabled:p.value},[...P[11]||(P[11]=[e("strong",null,"ðŸ—‘ï¸ Reset Session",-1),e("div",{class:"small text-muted"},"Clear all messages and start fresh (keeps settings)",-1)])],8,Nd),e("button",{class:"btn btn-outline-danger text-start",onClick:j,disabled:p.value},[...P[12]||(P[12]=[e("strong",null,"âŒ Delete Session",-1),e("div",{class:"small text-muted"},"Permanently delete this session and all its data",-1)])],8,Ad)]),P[16]||(P[16]=e("div",{class:"alert alert-warning mt-3 mb-0"},[e("small",null,[e("strong",null,"Note:"),G(" Restart is the recommended option for unsticking the agent.")])],-1))]))]),e("div",Rd,[v.value&&!p.value?(l(),r(Z,{key:0},[e("button",{type:"button",class:"btn btn-secondary",onClick:T},"Cancel"),e("button",{type:"button",class:B(["btn",v.value==="delete"?"btn-danger":"btn-warning"]),onClick:S},f(v.value==="delete"?"Delete Session":"Confirm Reset"),3)],64)):p.value?E("",!0):(l(),r("button",qd,"Cancel"))])])])],512))}},Wd=V(Ud,[["__scopeId","data-v-de7ff18c"]]),Hd={class:"modal-dialog modal-dialog-centered modal-lg"},Fd={class:"modal-content"},Bd={class:"modal-body"},Vd={key:0,class:"text-center text-muted py-4"},zd={key:1},Gd={class:"mb-3"},Jd={class:"font-monospace small"},Kd={class:"mb-3"},Yd={class:"font-monospace small"},Qd={class:"mb-3"},Zd={class:"mb-3"},Xd={class:"mb-3"},em={key:0},tm={class:"d-flex flex-wrap gap-1"},sm={key:1,class:"text-muted small"},om={key:0,class:"mb-3"},nm={class:"d-flex flex-wrap gap-1"},lm={key:1,class:"mb-3"},am={class:"bg-light p-2 rounded small",style:{"max-height":"200px","overflow-y":"auto"}},rm={class:"mb-3"},im={class:"text-muted"},cm={key:0,class:"bg-light p-2 rounded small",style:{"max-height":"300px","overflow-y":"auto"}},um={__name:"SessionInfoModal",setup(s){const t=J(),m=de(),i=se(),o=L(null),n=L(!1),p=L(null);let g=null;const u=c(()=>{if(!o.value)return null;const $=t.initData.get(o.value);return $||(m.messagesBySession.get(o.value)||[]).find(T=>T.type==="system"&&(T.subtype==="init"||T.metadata?.subtype==="init")&&T.metadata?.init_data)?.metadata?.init_data||null});function v($){return typeof $=="string"?$:typeof $=="object"&&$.type==="preset"?`Preset: ${$.preset}`:JSON.stringify($,null,2)}function _(){o.value=null,n.value=!1}function w(){_(),i.hideModal()}return te(()=>i.currentModal,$=>{if($?.name==="session-info"&&g){const b=$.data||{};o.value=b.sessionId,n.value=!1,g.show()}}),ie(()=>{p.value&&ae(async()=>{const{default:$}=await import("./modal-B4rHLo2F.js").then(b=>b.m);return{default:$}},__vite__mapDeps([0,1])).then(({default:$})=>{g=new $(p.value),p.value.addEventListener("hidden.bs.modal",w)})}),ce(()=>{p.value&&p.value.removeEventListener("hidden.bs.modal",w),g&&g.dispose()}),($,b)=>(l(),r("div",{class:"modal fade",id:"sessionInfoModal",tabindex:"-1","aria-labelledby":"sessionInfoModalLabel","aria-hidden":"true",ref_key:"modalElement",ref:p},[e("div",Hd,[e("div",Fd,[b[9]||(b[9]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"sessionInfoModalLabel"},"Session Configuration"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Bd,[u.value?(l(),r("div",zd,[e("div",Gd,[b[1]||(b[1]=e("h6",{class:"text-muted"},"Session ID",-1)),e("div",Jd,f(o.value),1)]),e("div",Kd,[b[2]||(b[2]=e("h6",{class:"text-muted"},"Working Directory",-1)),e("div",Yd,f(u.value.cwd||"Not specified"),1)]),e("div",Qd,[b[3]||(b[3]=e("h6",{class:"text-muted"},"Model",-1)),e("div",null,f(u.value.model||"Default"),1)]),e("div",Zd,[b[4]||(b[4]=e("h6",{class:"text-muted"},"Permission Mode",-1)),e("div",null,f(u.value.permissionMode||"default"),1)]),e("div",Xd,[b[5]||(b[5]=e("h6",{class:"text-muted"},"Available Tools",-1)),u.value.tools&&u.value.tools.length>0?(l(),r("div",em,[e("div",tm,[(l(!0),r(Z,null,ee(u.value.tools,j=>(l(),r("span",{key:j,class:"badge bg-secondary"},f(j),1))),128))])])):(l(),r("div",sm,"All tools available"))]),u.value.commands&&u.value.commands.length>0?(l(),r("div",om,[b[6]||(b[6]=e("h6",{class:"text-muted"},"Commands",-1)),e("div",nm,[(l(!0),r(Z,null,ee(u.value.commands,j=>(l(),r("span",{key:j,class:"badge bg-info"},f(j),1))),128))])])):E("",!0),u.value.systemPrompt?(l(),r("div",lm,[b[7]||(b[7]=e("h6",{class:"text-muted"},"System Prompt",-1)),e("pre",am,f(v(u.value.systemPrompt)),1)])):E("",!0),e("div",rm,[e("h6",im,[b[8]||(b[8]=G(" Raw Configuration ",-1)),e("button",{class:"btn btn-sm btn-outline-secondary ms-2",onClick:b[0]||(b[0]=j=>n.value=!n.value)},f(n.value?"Hide":"Show"),1)]),n.value?(l(),r("pre",cm,f(JSON.stringify(u.value,null,2)),1)):E("",!0)])])):(l(),r("div",Vd," No session configuration data available "))]),b[10]||(b[10]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])],512))}},dm=V(um,[["__scopeId","data-v-809e2099"]]),mm={class:"modal-dialog modal-dialog-centered"},pm={class:"modal-content"},vm={class:"modal-body"},fm={class:"mb-3"},gm={class:"mb-3"},_m={class:"mb-3"},bm={class:"form-text d-flex justify-content-between"},hm={key:0,class:"invalid-feedback"},ym={class:"mb-3 form-check"},$m={key:0,class:"form-text text-warning"},wm={class:"mb-3"},Sm={key:0,class:"alert alert-danger"},km={class:"modal-footer"},Cm=["disabled"],xm={key:0,class:"spinner-border spinner-border-sm me-2"},Mm={__name:"CreateMinionModal",setup(s){const t=pe(),m=le(),i=J(),o=se(),n=L(null);let p=null;const g=L(null),u=L({name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]}),v=L(""),_=L(""),w=L(!1),$=c(()=>v.value.trim()?v.value.split(",").map(h=>h.trim()).filter(h=>h.length>0):[]),b=c(()=>u.value.initialization_context.length),j=c(()=>b.value>2e3),T=c(()=>b.value>1800&&b.value<=2e3);function S(){u.value={name:"",role:"",initialization_context:"",override_system_prompt:!1,capabilities:[]},v.value="",_.value="",w.value=!1}function y(){S(),o.hideModal()}async function C(){if(!u.value.name.trim()){_.value="Minion name is required";return}if(u.value.name.includes(" ")){_.value="Minion name must be a single word with no spaces (for #nametag matching)";return}if(j.value){_.value="Initialization context exceeds 2000 character limit";return}if(!g.value){_.value="Legion ID is missing";return}w.value=!0,_.value="";try{const h={name:u.value.name.trim(),role:u.value.role.trim(),initialization_context:u.value.initialization_context.trim(),override_system_prompt:u.value.override_system_prompt,capabilities:$.value},a=await K.post(`/api/legions/${g.value}/minions`,h);a.success&&a.minion_id?(await m.fetchProjects(),await i.fetchSessions(),p&&p.hide(),t.push(`/spy/${g.value}/${a.minion_id}`)):_.value="Failed to create minion"}catch(h){console.error("Failed to create minion:",h),_.value=h.response?.data?.detail||"Failed to create minion"}finally{w.value=!1}}return te(()=>o.currentModal,h=>{if(h?.name==="create-minion"&&p){const a=h.data||{};g.value=a.project?.project_id||null,S(),p.show()}}),ie(()=>{n.value&&ae(()=>import("./modal-B4rHLo2F.js").then(h=>h.m),__vite__mapDeps([0,1])).then(h=>{const a=h.default;p=new a(n.value),n.value.addEventListener("hidden.bs.modal",y)})}),ce(()=>{n.value&&n.value.removeEventListener("hidden.bs.modal",y),p&&p.dispose()}),(h,a)=>(l(),r("div",{ref_key:"modalElement",ref:n,class:"modal fade",tabindex:"-1","aria-labelledby":"createMinionModalLabel","aria-hidden":"true"},[e("div",mm,[e("div",pm,[a[15]||(a[15]=e("div",{class:"modal-header"},[e("h5",{id:"createMinionModalLabel",class:"modal-title"},"Create Minion"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",vm,[e("form",{onSubmit:re(C,["prevent"])},[e("div",fm,[a[5]||(a[5]=e("label",{for:"minion-name",class:"form-label"},[G(" Name "),e("span",{class:"text-danger"},"*")],-1)),Y(e("input",{id:"minion-name","onUpdate:modelValue":a[0]||(a[0]=O=>u.value.name=O),type:"text",class:"form-control",required:"",placeholder:"main",pattern:"[^\\s]+",title:"Minion name must be a single word with no spaces"},null,512),[[ne,u.value.name]]),a[6]||(a[6]=e("div",{class:"form-text"},"Must be a single word (no spaces) for #nametag matching",-1))]),e("div",gm,[a[7]||(a[7]=e("label",{for:"minion-role",class:"form-label"},"Role",-1)),Y(e("input",{id:"minion-role","onUpdate:modelValue":a[1]||(a[1]=O=>u.value.role=O),type:"text",class:"form-control",placeholder:"e.g., Code Expert, Testing Specialist"},null,512),[[ne,u.value.role]]),a[8]||(a[8]=e("div",{class:"form-text"},"Optional role description for the minion",-1))]),e("div",_m,[a[9]||(a[9]=e("label",{for:"minion-context",class:"form-label"},"Initialization Context",-1)),Y(e("textarea",{id:"minion-context","onUpdate:modelValue":a[2]||(a[2]=O=>u.value.initialization_context=O),class:B(["form-control",{"is-invalid":j.value}]),rows:"4",maxlength:2e3,placeholder:"Instructions and context for the minion..."},null,2),[[ne,u.value.initialization_context]]),e("div",bm,[e("span",null,f(u.value.override_system_prompt?"This context will replace Claude Code's preset and legion guide":"This context will be appended to legion guide and Claude Code's preset"),1),e("span",{class:B({"text-danger":j.value,"text-warning":T.value})},f(b.value)+" / 2000 chars ",3)]),j.value?(l(),r("div",hm," Initialization context exceeds 2000 character limit (Windows command-line constraint) ")):E("",!0)]),e("div",ym,[Y(e("input",{type:"checkbox",class:"form-check-input",id:"overrideSystemPrompt","onUpdate:modelValue":a[3]||(a[3]=O=>u.value.override_system_prompt=O)},null,512),[[be,u.value.override_system_prompt]]),a[11]||(a[11]=e("label",{class:"form-check-label",for:"overrideSystemPrompt"}," Override Claude Code preset (use custom context only) ",-1)),u.value.override_system_prompt?(l(),r("div",$m,[...a[10]||(a[10]=[e("small",null,"âš ï¸ Override mode may cause unexpected behaviors. Only custom context will be used (no legion guide or Claude Code preset).",-1)])])):E("",!0)]),e("div",wm,[a[12]||(a[12]=e("label",{for:"minion-capabilities",class:"form-label"},"Capabilities",-1)),Y(e("input",{id:"minion-capabilities","onUpdate:modelValue":a[4]||(a[4]=O=>v.value=O),type:"text",class:"form-control",placeholder:"e.g., python, testing, debugging"},null,512),[[ne,v.value]]),a[13]||(a[13]=e("div",{class:"form-text"},"Comma-separated list of capability keywords (optional)",-1))]),_.value?(l(),r("div",Sm,f(_.value),1)):E("",!0)],32)]),e("div",km,[a[14]||(a[14]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",disabled:!u.value.name.trim()||w.value,onClick:C},[w.value?(l(),r("span",xm)):E("",!0),G(" "+f(w.value?"Creating...":"Create Minion"),1)],8,Cm)])])])],512))}},jm=V(Mm,[["__scopeId","data-v-d7434e2a"]]),Tm={class:"container-fluid vh-100 d-flex flex-column p-0"},Em={class:"d-flex flex-grow-1 overflow-hidden position-relative"},Pm={class:"flex-grow-1 d-flex flex-column overflow-hidden"},Lm={__name:"App",setup(s){const t=se(),m=ge(),i=J(),o=le(),n=pe(),p=c(()=>t.sidebarCollapsed),g=c(()=>t.isMobile);ie(async()=>{typeof marked<"u"&&marked.setOptions({breaks:!0,gfm:!0}),m.connectUI(),await Promise.all([o.fetchProjects(),i.fetchSessions()]);const _=window.location.hash;if(_.startsWith("#/session/")){const w=_.replace("#/session/","");i.sessions.has(w)&&await i.selectSession(w)}else if(_.startsWith("#/timeline/")){const w=_.replace("#/timeline/","");n.push(`/timeline/${w}`)}window.addEventListener("popstate",u),window.addEventListener("resize",t.handleResize)}),ce(()=>{window.removeEventListener("popstate",u),window.removeEventListener("resize",t.handleResize),m.disconnectUI()});function u(){const _=window.location.hash;if(_.startsWith("#/session/")){const w=_.replace("#/session/","");i.sessions.has(w)&&i.selectSession(w)}}function v(){t.toggleSidebar()}return(_,w)=>{const $=Ue("router-view");return l(),r("div",Tm,[Q(Ni),e("div",{id:"sidebar-backdrop",class:B({show:!p.value&&g.value}),onClick:v},null,2),e("div",Em,[Q(hc),e("main",Pm,[Q($)])]),Q(Nc),Q(tu),Q(Su),Q(zu),Q(yd),Q(Wd),Q(dm),Q(jm)])}}},Pe=Ve(Lm);Pe.use(ze());Pe.use(Li);Pe.mount("#app");
